Attribute VB_Name = "F110010com"
Option Explicit

Public RYOHEN      As String * 2       '良品返品の要因 2009.07.10


Public F110010_LOG  As String           '送受信ﾛｸﾞ  2014.03.19


'-------------------------------------------------------    2012.03.25 Frmより全て移管
Public LocalPort                As Long                 'データ受信ポート番号
Public RemotePort               As Long                 'データ送信ポート番号

Public Normal_End               As Boolean              '終了状態

Public Next_Step                As Integer              '次実行指示

Public Menu_Type                As Integer              '1:個別 2:共通


Public Type NAIGAI_tag
    CODE                        As String * 1
    NAME                        As String
End Type

Public NAIGAI()                 As NAIGAI_tag

Public Const M_Gyo% = 5                                '最大画面行数
Public Const M_Keta% = 20                              '最大画面桁数

Public Type Recv_Text_Tag                              '受信テキスト
    ID                          As Integer              'IDNO
    LCD(0 To M_Gyo - 1)         As String * 20          '受信内容１～５行目
    Time                        As String * 8           '送信時刻
    RETRY                       As Integer              '送信リトライ2004.04.10
End Type

Public Recv_text               As Recv_Text_Tag

Public Const Start_Para$ = "START"     '子機電源ＯＮ
Public Const Can_Para$ = "CANCEL"      'キャンセル要求
Public Const Fin_Para$ = "FINISHI"     '作業終了要求
Public Const Ent_Para$ = "ENT"         'ENTのみ

Public Const P_END_Para$ = "PRINTEND"  '印刷終了

Public Const Qty_OK_Para$ = "OK"       '数量ＯＫ
Public Const Loc_OK_Para$ = "T"        '棚番ＯＫ
Public Const DEN_OK_Para$ = "ALL"      '伝票ＯＫ
Public Const LAST_Para$ = "LAST"       '最終作業




Public Type Box_Type_tag               'ＢＯＸ指定
    Box_Type                    As String * 1           'BOX属性
    LCD(0 To M_Keta - 1)        As Byte                 '表示内容
    INIT                        As String * 10          '初期内容
    Start_Pos                   As String * 2           '開始カーソル位置
    Max_Size                    As String * 2           '入力桁数（最大）
    MENU                        As String * 9           'メニュー内容

    MTS_FLG                     As String * 1           '2017.10.30

    MENU18                      As String * 18          '2017.09.07

End Type

Public Type Send_Text_tag              '送信用バッファー
    sts                         As String * 1           'ステータス 1:OK 2:NG
    Display_Flg                 As String * 1           '表示画面フラグ 1:通常入力画面 2:メニュー画面 3:参照画面
    End_Menu                    As String * 1           '最終メニューフラグ 1:次画面あり　2:最終画面
    Menu_Suu                    As String * 2           'メニュー個数
    FileName                    As String * 12          'ファイル名(*.*)
    buzzer                      As String * 1           'ブザー指定
    Box_Type(0 To M_Gyo - 1)    As Box_Type_tag
    CRLF                        As String * 2
End Type

Public Send_Text           As Send_Text_tag
Public Const Sts_OK$ = "1"             'ステータス　OK
Public Const Sts_NG$ = "2"             'ステータス　NG

Public Const Display_DEF$ = "1"        '表示画面フラグ　通常入力画面
Public Const Display_MENU$ = "2"       '表示画面フラグ　メニュー画面
Public Const Display_REF$ = "3"        '表示画面フラグ　参照画面

Public Const Display_LABEL$ = "4"      '表示画面フラグ　ﾗﾍﾞﾙ発行



'2010.11.30
''''''''''Private Const Display_LABEL$ = "3"      '表示画面フラグ　ﾗﾍﾞﾙ発行



Public Const Menu_Head$ = "1"          '最終メニューフラグ 先頭(前あり／後なし)
Public Const Menu_Mid$ = "2"           '最終メニューフラグ 中間(前あり／後あり)
Public Const MENU_END$ = "3"           '最終メニューフラグ 最終(前あり／後なし)
Public Const Menu_Only$ = "4"          '最終メニューフラグ 単独(前なし／後なし)

Public Const Buzzer_DEF$ = "1"         '標準の音

Public Const Buzzer_DEF_CON$ = "2"     '断続音     2008.12.12



Public Const Buzzer_CONTI$ = "4"       '連続音



Public Const Buzzer_DOUBLE$ = "5"      '二重警告音 2009.04.15



Public Const TYPE_REF$ = "X"           '表示ＢＯＸ
Public Const TYPE_BCANK$ = 1           'バーコード＆英数字
Public Const TYPE_BCNUM$ = 2           'バーコード＆数字
Public Const TYPE_BCONLY$ = 3          'バーコードのみ
Public Const TYPE_MENU$ = "M"          'メニュー表示


Public Type Sagyo_Code_tag
    
    CODE_TYPE       As String * 1       '主バーコードタイプ
    YOIN_CODE       As String * 1       '要因
    PARAM           As String * 2       'パラメータ

End Type


'-----------------------------------------------------  '大阪ＰＣ用検品の項目 2006.12.07
Public Type KEN_DEN_TBL_Tag
    SEQ_NO          As String * 3
    HIN_NO          As String * 20                      '品番
    SURYO           As Long                             '数量
    SUMI            As Boolean                          '済ﾏｰｸ
    CANCEL_F        As Boolean                          'ｷｬﾝｾﾙF
    KAN_KBN         As String * 1                       '完了ﾌﾗｸﾞ   2007.05.14

    KONPOU_F        As String * 1                       '梱包区分           2010.01.18

                                                        '2010.01.18
    KONPOU_CND      As String * 1                       '梱包状態 1:なしのみ　2:ありのみ　3:混在

    TOTAL_SU        As Long                             '2010.01.21
                                                        'トータル検品数
    SAI_SU          As Double                           '才数               2010.01.21
    KUTI_SU         As Integer                          '口数               2010.01.21


    PRINT_SUMI      As Boolean                          '印刷               2010.01.21
    
    OKURI_NO_SEQ    As Integer                          '送り状枝番         2010.01.21

    GAISO_IRI_QTY   As Long                             '外装箱入り数       2012.03.21
    BARA_QTY        As Long                             'バラ数             2012.03.21
        
    
    Y_HIN_CHK_CNT   As Long                             '品番読込み回数     2012.03.21
    J_HIN_CHK_CNT   As Long                             '品番読込み済み回数 2012.03.21
    
    CNT_BARA_SU     As Long                             '品番読込み個数(バラ)   2012.03.21
    CNT_HAKO_SU     As Long                             '品番読込み個数(箱)     2012.03.21


End Type

Public Type CHK_HINBAN_TBL_tag         '2011.03.02
    KO_JGYOBU       As String * 1                       '子　事業部
    KO_NAIGAI       As String * 1                       '子　国内外
    KO_HIN_GAI      As String * 20                      '子　品番
    
    RD_FLAG         As Integer                          '読込み済み
    
        
    KO_QTY          As Double           '2012.03.16
End Type



'-----------------------------------------------------  '大阪ＰＣ　積水用項目 2011.04.25
Public Type SEK_TBL_Tag
    
    SEK_SEQ_NO                  As String * 5           'SEQNO 2011.07.20
    
    SEK_HINB_CD                 As String * 20          '品番
    SEK_JUC_SUU                 As Long                 '品番別梱包数
    SEK_KONPO_F                 As Integer              '梱包　有無
    SEK_DATA_CNT                As Integer              '注文ﾃﾞｰﾀ件数


    SEK_GAISO_IRI_QTY           As Long                 '外装箱入り数       2012.03.21
    SEK_BARA_QTY                As Long                 'バラ数             2012.03.21
    
    
    SEK_Y_HIN_CHK_CNT           As Long                 '品番読込み回数     2012.03.21
    SEK_J_HIN_CHK_CNT           As Long                 '品番読込み済み回数 2012.03.21


    CNT_BARA_SU                 As Long                 '品番読込み個数(バラ)   2012.03.21
    CNT_HAKO_SU                 As Long                 '品番読込み個数(箱)     2012.03.21



End Type
'-----------------------------------------------------  '大阪ＰＣ　積水用項目 2011.04.25



'-----------------------------------------------------  '大阪ＰＣ　積水用検品項目 2011.05.09
Public Type SEK_KENPIN_TBL_Tag
    SEK_ID_NO                   As String * 20          '邸別ID or 梱包ID
        
    SEK_KONPO_CNT               As Integer              '梱包ID毎の件数
    
    SEK_KENPIN_F                As Integer              '検品　有無
    SEK_KONPOU_F                As Integer              '梱包　有無
    
    
    
    SEK_SHOGO_F                 As Integer              '照合　有無


    SEK_SYU_JUN                 As String * 10          '出荷順番
    SEK_TEI_NM                  As String * 30          '邸名


    SEK_KUTI_SU                 As Integer              '口数
    SEK_SAI_SU                  As Double               '才数


'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
    CNT_BARA_SU                 As Long                 '検品実績　バラ
    CNT_HAKO_SU                 As Long                 '検品実績　箱
    
    GAISO_IRI_QTY               As Long                 '外装入り数
    
    
    Y_HIN_CHK_CNT               As Long                 '品番読込み回数
    J_HIN_CHK_CNT               As Long                 '品番読込み済み回数
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02


End Type
'-----------------------------------------------------  '大阪ＰＣ　積水用検品項目 2011.05.09




'-----------------------------------------------------  '大阪ＰＣ　積水用集合梱包項目 2011.05.12
Public Type SEK_SYUGO_TBL_Tag
    SEK_TEI_LABELID             As String * 13          '邸別ﾗﾍﾞﾙ
    SEK_KONPO_F                 As Integer              '梱包　有無
    SEK_SYUGO_F                 As Integer
End Type
'-----------------------------------------------------  '大阪ＰＣ　積水用集合梱包項目 2011.05.12


'-----------------------------------------------------  '大阪ＰＣ　積水用強制完了項目 2011.06.28
Public Type SEK_KYOSEI_TBL_Tag
    SEK_ID                      As String * 20          '邸別ID/梱包ID
    SEK_KONPO_F                 As Integer              '梱包　有無
    SEK_SAI_SU                  As Double               '才数
End Type


Public Type SEK_KYOSEI_HINB_CD_TBL_Tag
    SEK_HINB_CD                 As String * 20          '品番
    SEK_KONPO_F                 As Integer              '梱包　有無
End Type
'-----------------------------------------------------  '大阪ＰＣ　積水用強制完了項目 2011.06.28
Public Type ID_KANRI_TBL_tag               '子機情報の管理
    RETRY                       As Integer              '子機送信リトライ
    ID                          As Integer              'IDNO
    Step                        As Integer              '進捗フラグ
    JGYOBU                      As String * 1           '事業部
    NAIGAI                      As String * 1           '国内外
    
    
    '2010.12.07
'''    Hinban                      As String * 13          '品番（２レスポンス以上の作業時のみ使用）
    Hinban                      As String * 20          '品番（２レスポンス以上の作業時のみ使用）
    '2010.12.07
    HINBAN_DAMMY                As String * 20          '2017.10.30
     
    Inp_QTY                     As Long                 '入力された数量 2015.02.21
    
    
    HIN_NAME                    As String * 20          '品名
    
    Tanaban                     As String * 8           '棚番（２レスポンス以上の作業時のみ使用）
    
    ST_TANABAN                  As String * 8           '標準棚番   2016.12.26
    
    
    GOODS_ON_F                  As String * 1           '商品化用倉庫
    
    '---------------------------------------------------'送信数量
    Send_SUMI_QTY               As Long                 '商品化済み数量（移動時）
    Send_MI_QTY                 As Long                 '未商品数量（移動時）
    Send_Syuka_QTY              As Long                 '出荷数量（出荷時）
    '---------------------------------------------------'出荷処理用▽
    MTS_CODE                    As String * 8           '得意先コード
    SS_CODE                     As String * 8           '直送先コード
    CYU_KBN                     As String * 1           '注文区分
    Y_SYU_CNT                   As Integer              '対象伝票枚数
    ID_NO                       As String * 12          '伝票ID
    DEN_NO                      As String * 6           '伝票番号
    YUKO_SUMI_QTY               As Long                 '使用可能な商品化済み在庫
    YUKO_MI_QTY                 As Long                 '使用可能な未商品在庫
    SYUKA_QTY                   As Long                 '出荷数量（全数）
    
    ITEM_READ_CNT               As Long                 '出荷検品時、品番読込み回数 2018.11.06
    
    
    
    
    BIN_NO                      As String * 2           '便 2007.05.16
    
    '---------------------------------------------------'出荷処理用△
'    MENU_GRP                    As String * 2           '使用メニュー
    
    
    MENU_LV1                    As String * 2           'メニューレベル１   2006.01.30 3-->2
    MENU_LV2                    As String * 2           'メニューレベル２
'    MENU_LV3                    As String * 3           'メニューレベル３  2006.01.30
    
    SAGYO_LOG                   As String * 1           '作業ﾛｸﾞ出力 0:なし　1:あり 2006.01.30
    

    PageNo_LV1                  As Integer              'ページ№（メニュー）
    PageNo_LV2                  As Integer              'ページ№（メニュー）
'    PageNo_LV3                  As Integer              'ページ№（メニュー）  2006.01.30
    Sagyo_Code                  As Sagyo_Code_tag       '作業コード
    YOIN_DNAME                  As String * 5           '表示用名称
    TANTO_CODE                  As String * 5           '担当者コード
    Recv_text(0 To M_Gyo - 1)   As String * 20          '最終受信内容１～５行目
    Send_Text                   As Send_Text_tag        '最終送信内容(正常値)
    Last_Send_Text              As Send_Text_tag        '最終送信内容(全て)
    Time                        As String * 8           '送信時刻
    Last_Send                   As Integer              '0:通常テキスト 1:エラー情報


    S_JGYOBU                    As String * 1           '資材を踏まえての事業部
    S_NAIGAI                    As String * 1           '資材を踏まえての国内外

    RET_JGYOBU                  As String * 1           '読み替え後事業部       2016.12.08
    RET_NAIGAI                  As String * 1           '読み替え後国内外       2016.12.08



    DEN_ID_JGYOBU               As String * 1           'フリー事業部対応 2006.06.01
    
    
    LK_SEQ_NO                   As String * 5           '2020/03/11 パレットNO 荷積明細用で追加
    KENPIN_SURYO                As String * 3           '2020/03/11 箱数 荷積明細用で追加


'-----------------------------------------------------  '大阪ＰＣ用検品の項目 2006.12.07
    KEN_DEN_TBL()               As KEN_DEN_TBL_Tag      '行　情報
    KEN_OKURI_NO                As String * 20          '送り状№
    KEN_HINBAN                  As String * 20          '処理中品番
    KEN_UNSOU_KAISHA            As String * 20          '運送会社
    KEN_OKURI_SAKI              As String * 20          '送り先

    KEN_OKURISAKI_CD            As String * 9           '送り先CD       2015.10.21


    KEN_MUKE_NAME               As String * 20          '向け先

    KEN_SYUKA_YMD               As String * 8           '出荷日         2010.01.21
    KEN_JYUSHO                  As String * 160         '住所           2010.01.21
    KEN_BIKOU                   As String * 100         '備考           2010.01.21
    KEN_OKURI_NO_MAX            As Integer              '次　枝番       2010.02.15


    KEN_INP_SAI_SU              As Double               '入力才数           2010.01.21
    KEN_INP_KUTI_SU             As Integer              '入力口数           2010.01.21

    KEN_TEL_NO                  As String * 20          '電話番号           2010.01.21

    KEN_ING_HINBAN              As String * 20          '検品仕掛中品番     2012.11.15

    KEN_TYAKUTEN                As String * 3           '検品中着店コード   2017.04.06





    SEQ_NO                      As String * 3           'ﾚｺｰﾄﾞSEQ_NO    2007.06.07
    GYO_INS                     As String * 1           '行追加         2007.06.07
    ITEM_GOODS_ON_F             As String * 1           '品目 商品化有無2007.06.07


    TANABAN1                    As String * 10          '棚番1          2009.03.09
    TANABAN2                    As String * 10          '棚番2          2009.03.09
    TANABAN3                    As String * 10          '棚番3          2009.03.09


    LSBU_BinNo                  As String * 5           '移管用便№     2009.03.11


    SIZE_W                      As String * 8           'ﾀﾞﾝﾎﾞｰﾙｻｲｽﾞ（W）   2010.01.21
    SIZE_D                      As String * 8           'ﾀﾞﾝﾎﾞｰﾙｻｲｽﾞ（D）   2010.01.21
    SIZE_H                      As String * 8           'ﾀﾞﾝﾎﾞｰﾙｻｲｽﾞ（H）   2010.01.21

    


    SAI_SU                      As String * 4           '才数           2010.01.21
    KUTI_SU                     As String * 4           '口数           2010.01.21

    CTR_TYPE                    As String * 10          'ハンディ機種   2010.01.21


    KEN_TYPE                    As String * 1           '検品ﾊﾟﾀｰﾝ      2010.01.21



    LABEL_ON                    As Boolean              'ﾗﾍﾞﾙ要求       2010.01.21
    
    LABEL_STEP                  As Integer              '次ﾗﾍﾞﾙｽﾃｯﾌﾟ      1:品番へ　2:口数へ 9:残数確認
    
    LABEL_PRINT_TOTAL_SU        As Long                 'ﾗﾍﾞﾙ印字枚数       2010.01.21
    LABEL_START_PAGE_NO         As Long                 'ﾗﾍﾞﾙ開始ページ№   2010.01.21
    
    
    
    Label_RePrint_Kuti_Su       As Integer
    Label_RePrint_Sai_Su        As Double
    
    
    
    SHIJI_No                    As String * 8           '指図票№       2010.09.03
    
    OYA_HINBAN                  As String * 20          '親品番         2014.10.30
    
    
    SHIJI_QTY                   As String * 11          '指図数         2010.09.03
    
    
    SHIJI_END_QTY               As Long                 '完了数         2018.04.26
    
    
    LABEL_CNT                   As Integer              'ラベル件数     2010.09.03
    GENPIN_CNT                  As Integer              '現品票件数     2010.09.03
    
    GAISOU_CNT                  As Integer              '外装品番件数   2015.11.07
    
    
'    YOIN_LONG_DNAME             As String * 10          '表示用名称     2010.09.15     2017.09.22 桁数　10-＞20
    YOIN_LONG_DNAME             As String * 20          '表示用名称     2010.09.15      2017.09.22 桁数　10-＞20
    
    
    CHK_HINBAN_TBL()            As CHK_HINBAN_TBL_tag   '構成チェック用 2011.03.02
    RD_HINBAN(0 To 2)           As String * 20          '読込み品番     2011.03.02
    Input_Line                  As Integer              '               2011.03.02
    
    '--------------------------------------------------- 大阪　積水　梱包用 2011.04.25
    SEK_TEI_LABELID             As String * 13          '邸別梱包ID
    SEK_SYU_JUN                 As String * 10          '出荷順番
    SEK_HINB_CD_CNT             As Integer              '品番個数
    SEK_TBL()                   As SEK_TBL_Tag          '品番別情報
    
    SEK_TEI_NM                  As String * 30          '邸名
    SEK_HAKO_SU                 As Integer              '総箱数
    SEK_SAI_SU                  As Double               '才数
    
    SEK_LINE                    As Integer              '実行中の行         2011.07.20
    
    '--------------------------------------------------- 大阪　積水　梱包用 2011.04.25
    
    
    '--------------------------------------------------- 大阪　積水　検品用 2011.04.25
    SEK_KENPIN_TBL()            As SEK_KENPIN_TBL_Tag
    SEK_KEN_ID_NO               As String * 20          '処理中指示№
    SEK_PAGE_NO                 As Integer              '荷札印刷開始ﾍﾟｰｼﾞ
    '--------------------------------------------------- 大阪　積水　検品用 2011.04.25
    
    
    '--------------------------------------------------- 大阪  積水  集合梱包用 2011.05.12
    SEK_KONPO_ID                As String * 20          '梱包ID
    SEK_SYUGO_TBL()             As SEK_SYUGO_TBL_Tag
    SEK_SYUGO_SYU_YMD           As String * 8           '出荷確定日
    SEK_SYUGO_L_TOK_NAME        As String * 50          '得意先名
    SEK_KEN_TEI_LABELID         As String * 13          '邸別梱包ID
    SEK_SYUGO_SAI_SU            As Double               '才数
    
    '--------------------------------------------------- 大阪  積水  集合梱包用 2011.05.12
    
    
    '--------------------------------------------------- 大阪  積水  強制完了用 2011.06.28
    SEK_KYOSEI_END_ID           As String * 20
    '--------------------------------------------------- 大阪  積水  強制完了用 2011.06.28
    
    
    '--------------------------------------------------- 大阪  品番振替用 2011.06.01
    FURI_BEF_HINBAN             As String * 20          '振替前品番
    FURI_AFT_HINBAN             As String * 20          '振替後品番
                
    '--------------------------------------------------- 大阪  品番振替用 2011.06.01
    
    JAN_CODE                    As String * 20          'JANｺｰﾄﾞ　2011.08.05

    '--------------------------------------------------- 大阪  部材対応　2012.03.06
    ORDER_QTY                   As Long
    NYUKO_QTY                   As Long
    INPUT_QTY                   As Long
    CUT_SU                      As Long
    
    BEF_QTY                     As Long
    AFT_QTY                     As Long
    
    IDO_OUT_OSAKA_NEW_QTY       As Long                 '2014.11.07
    ODR_QTY                     As Long                 '2014.11.07
    
    
    
    LAST_START_PAGE             As Long
    LAST_END_PAGE               As Long
    
    KO_SHIJI_QTY                As Long                 '指示数 2012.04.13
    
    '--------------------------------------------------- 大阪  部材対応　2012.03.06



    '--------------------------------------------------- 床暖房 2013.06.06
    Model                       As String * 20          '品番
    PLotNo                      As String * 20          '製造番号
    SURYO                       As Long                 '数量
    
    INVNO                       As String * 20          '送り状№   2014.07.01
        
        
    SQty                        As Long                 '在庫数     2014.07.31
        
    '--------------------------------------------------- 床暖房 2013.06.06
    
    
    '--------------------------------------------------- 数量検品 2014.03.05
    Inspe_SU                    As Long
    Inspe_CNT                   As Long
    '--------------------------------------------------- 数量検品 2014.03.05
    

    '--------------------------------------------------- 奈良モジュールメモ 2014.07.02
    MEMO                        As String * 20
    '--------------------------------------------------- 奈良モジュールメモ 2014.07.02


    '--------------------------------------------------- 引取処理(広島) 2015.01.22
    T_back_Hiki_ID              As String * 18          '引取ID
    T_back_SURYO                As Long                 '引取数
    T_back_Jitu_SURYO           As Long                 '実績数
    
'    T_back_F                    As Boolean              '追加　有無(=true 追加) '2016.06.22    2016.07.04
    T_back_KAN_KBN              As String * 1           '完了区分   '2016.06.22
    T_back_IN_HINBAN            As String * 20          '入力品番   '2016.06.22
    T_back_IN_wkHINBAN          As String * 20          '入力品番   '2016.12.08(空白含む)
    
    
    T_back_ID_No                As String * 12          'ID_NO      '2016.07.08
    '--------------------------------------------------- 引取処理(広島) 2015.01.22


    '--------------------------------------------------- 危険在庫チェック 2015.02.21
    HOJYU_P                     As Long                 ''補充点（危険在庫）
    
    IN_HINBAN                   As String * 20          '入力された品番 2016.07.13


    '--------------------------------------------------- 直送検品 2016.10.14
    cho_OKURI_NO                As String * 20          '送り状№
    cho_ChoCode                 As String * 9           '直送先ｺｰﾄﾞ

    '--------------------------------------------------- 商品化ﾁｪｯｸ 2018.09.19
    IN_HINBAN_L                 As String * 20
    IN_HINBAN_G                 As String * 20
    

    PARAM                       As String * 20


End Type

Public ID_KANRI_TBL()           As ID_KANRI_TBL_tag

Public ING_No                   As Integer  '処理中の添字

Public Const Step_Start% = 0           '子機電源ＯＮ
Public Const Step_TANTO_REQ% = 1       '担当者要求
Public Const Step_TANTO_RES% = 2       '担当者回答

Public Const Step_JGYOBU_REQ% = 3      '事業部要求
Public Const Step_JGYOBU_RES% = 4      '事業部回答


Public Const Step_NAIGAI_REQ% = 5      '国内外要求
Public Const Step_NAIGAI_RES% = 6      '国内外回答


Public Const Step_MENU1_REQ% = 10      'メニュー１要求
Public Const Step_MENU1_RES% = 11      'メニュー１回答
Public Const Step_MENU2_REQ% = 12      'メニュー２要求
Public Const Step_MENU2_RES% = 13      'メニュー２回答
'2006.01.30 Private Const Step_MENU3_REQ% = 14      'メニュー３要求
'2006.01.30 Private Const Step_MENU3_RES% = 15      'メニュー３回答

Public Const Step_Sagyo1_REQ% = 20     '作業１要求
Public Const Step_Sagyo1_RES% = 21     '作業１回答
Public Const Step_Sagyo2_REQ% = 22     '作業２要求
Public Const Step_Sagyo2_RES% = 23     '作業２回答
Public Const Step_Sagyo3_REQ% = 24     '作業３要求
Public Const Step_Sagyo3_RES% = 25     '作業３回答
Public Const Step_Sagyo4_REQ% = 26     '作業４要求
Public Const Step_Sagyo4_RES% = 27     '作業４回答
Public Const Step_Sagyo5_REQ% = 28     '作業５要求
Public Const Step_Sagyo5_RES% = 29     '作業５回答




Public Const Step_Sagyo6_REQ% = 30     '作業６要求
Public Const Step_Sagyo6_RES% = 31     '作業６回答
Public Const Step_PRINT_REQ% = 98      'ﾗﾍﾞﾙ印刷要求
Public Const Step_PRINT_RES% = 99      'ﾗﾍﾞﾙ印刷回答


Public Const Step_Check_REQ% = 88       '確認要求       2013.07.25
Public Const Step_Check_RES% = 89       '確認回答       2013.07.25




Public Const BEF_Page$ = "$B"          '前頁
Public Const NEXT_Page$ = "$N"         '次頁


Public TANTO_REF        As String * 2   '担当者照会     2008.08.08
Public MENU_FIN         As String * 2   'メニュー終了   2008.08.08
'Private ST_LOG_OUT_F    As Boolean      '               2008.08.08
Public MENU_UP_F        As Boolean      '               2008.08.08




Public Type Menu_Tbl_tag                            'メニュー送信用テーブル
    MENU_NO     As String * 2
    PARAM       As String * 16
    Disp        As String
    LOG_OUT     As String * 1
End Type



Public Type Wel_Para_Tag                            'WELCAT送信用テーブル
    Box_Type    As String * 1
    'LCD         As String * 10     '2013.06.06
    LCD         As String * 20      '2013.06.06
    Keta        As Integer
End Type

Public Type WEL_Para_Tbl_tag
    Action      As String * 2
    Wel_Para(0 To M_Gyo - 1) As _
                Wel_Para_Tag
End Type
                                                    '※作業宣言の数により増減必須！！   2011.07.05
'Public WEL_Para_Tbl(0 To 23, 0 To 18) As WEL_Para_Tbl_tag
'Public WEL_Para_Tbl(0 To 24, 0 To 18) As WEL_Para_Tbl_tag      '2015.02.21
'Public WEL_Para_Tbl(0 To 25, 0 To 18) As WEL_Para_Tbl_tag       '2015.02.21
'Public WEL_Para_Tbl(0 To 26, 0 To 18) As WEL_Para_Tbl_tag       '2016.10.14
'Public WEL_Para_Tbl(0 To 27, 0 To 18) As WEL_Para_Tbl_tag       '2017.04.10
Public WEL_Para_Tbl(0 To 29, 0 To 18) As WEL_Para_Tbl_tag       '2018.11.05


Public Const LCD_Tanaban$ = "棚番"
Public Const LCD_Hinban$ = "品番"
Public Const LCD_Suryo$ = "数量"
Public Const LCD_Syuka$ = "出荷残"

Public Const LCD_Syuka_QTY$ = "出荷数"              '2015.02.21


Public Const LCD_OSAKA_Syuka$ = "出庫残"            '2010.12.25


Public Const LCD_SUMI_Suryo$ = "商品"
Public Const LCD_MI_Suryo$ = "未商品"
Public Const LCD_ID_No$ = "伝票ID"
Public Const LCD_SYUKO_HYO_No$ = "出庫表№"
Public Const LCD_MTS$ = "向け先"

Public Const LCD_OKURI_NO$ = "送り状№"             '2006.12.07
Public Const LCD_KUTI_SU$ = "口数"                  '2006.12.07
Public Const LCD_SAI_SU$ = "才数"                   '2006.12.07

Public Const LCD_OKURI_NO_S$ = "送№:"              '2006.12.07

Public Const LCD_hakosu$ = "箱数"                   '2020/02/27


Public Const LCD_To_Tanaban$ = "移動先棚番"




Public Const LCD_Syuka_Su1$ = " 出荷数："           '2007.04.21
Public Const LCD_Syuka_Su2$ = "*出荷数："           '2007.04.21

Public Const LCD_DEN_No$ = "伝票№"                 '2007.06.07

Public Const LCD_HIN_ANS$ = "品目追加？"            '2007.06.07

Public Const LCD_SYUSHI$ = "収支"                   '2007.06.28

Public Const LCD_CAN_ANS$ = "1:はい 9:いいえ"       '2007.11.02


Public Const LCD_SIZE_W_S$ = "幅(W):"               '2010.01.21
Public Const LCD_SIZE_D_S$ = "奥(D):"               '2010.01.21
Public Const LCD_SIZE_H_S$ = "高(H):"               '2010.01.21
Public Const LCD_SAI_SU_S1$ = " 才数:"              '2010.01.21
Public Const LCD_KUTI_SU_S1$ = "口数(0=集合):"      '2010.01.21




Public Const LCD_SAI_SU_S$ = "才　　数 ："          '2010.01.21
Public Const LCD_KUTI_SU_S$ = "口　　数 ："         '2010.01.21

Public Const LCD_S_PAGE_S$ = "開　　始 ："          '2010.01.21
Public Const LCD_E_PAGE_S$ = "終　　了 ："          '2010.01.21




                                            '2010.01.21
Public Const LCD_HIN_SYUKON$ = "品番 集合梱包"


                                            
                                            '2010.09.03
Public Const LCD_SHIJI_NO$ = "指図票№"
                                            
                                            '2010.09.03
Public Const LCD_L_HIN_CNT$ = "ラベル品番      件数"
                                            '2010.09.03
Public Const LCD_G_HIN_CNT$ = "現品票品番      件数"
                                            '2015.11.07
Public Const LCD_GAI_HIN_CNT$ = "外装品番  　    件数"
                                            '2010.12.13
Public Const LCD_TANA_USE$ = "使用状況(％):"

                                            
'------------------------------------------- 積水対応 2011.04.25
Public Const LCD_SEK_ID_NO$ = "指示№"
Public Const LCD_SEK_Su1$ = " 数量："
Public Const LCD_SEK_Su2$ = "*数量："

Public Const LCD_SEK_SYUGO_ID_NO$ = "出荷先＋出荷日"

'------------------------------------------- 積水対応 2011.04.25

                                                                                                
'------------------------------------------- 積水対応 2011.06.01
Public Const LCD_BEF_Hinban$ = "振替前品番"
Public Const LCD_AFT_Hinban$ = "振替後品番"
'------------------------------------------- 積水対応 2011.06.01

'------------------------------------------- ﾊﾞｰｺｰﾄﾞ印字　2017.04.10
Public Const LCD_ID$ = "ＩＤ"
Public Const LCD_MAISU$ = "枚数"

Public Const Wel_BCR_DAKUTO$ = "R1"
Public Const Wel_BCR_JAN$ = "R2"
Public Const Wel_BCR_Inspe$ = "R3"
Public Const Wel_BCR_TANA$ = "R4"
'------------------------------------------- ﾊﾞｰｺｰﾄﾞ印字　2017.04.10





Public Const LCD_JAN_CODE$ = "JANｺｰﾄﾞ"              '2011.08.05



Public Const LCD_CNT$ = "回数"                      '2014.03.19


Public Const LCD_ST_Tanaban$ = "標準棚番"           '2016.12.26




Public LCD_SHIJI    As String                       '2018.0.26
Public Const LCD_SHIJI_SHIJI_QTY$ = "指示数："      '2018.04.26
Public Const LCD_SHIJI_END_QTY$ = "完了数："        '2018.04.26

Public FILE_RETRY  As Integer                       'ファイル使用中時のリトライ回数



Public WEL_SEK_IDO_SYUKO   As String                '「WEL 積水用移動出庫」の要因  2011.06.15




Public Const Wel_TANAOROSI$ = "B0"                  '「WEL 棚卸し」の要因
Public Const Wel_TANAHYOJI$ = "B1"                  '「WEL 棚番表示」の要因
Public Const Wel_HIN_SHOGO$ = "B2"                  '「WEL 品番別照合」の要因
Public Const Wel_AVE_SYUKA$ = "B3"                  '「WEL 月平均出荷数」の要因
Public Const Wel_HOST_ZAIKO$ = "B4"                 '「WEL ホスト在庫照会」の要因
Public Const Wel_ST_TANABAN$ = "B5"                 '「WEL 標準棚番設定」の要因
Public Const Wel_RIREKI$ = "B6"                     '「WEL 当日出庫履歴」の要因
Public Const Wel_SUII$ = "B7"                       '「WEL 出荷推移」の要因
Public Const Wel_TANA_HIN_SHOGO$ = "B8"             '「WEL 棚番・品番別照合」の要因

Public Const Wel_TANAHYOJI_KASO$ = "B9"             '「WEL 棚番表示(仮想優先)」の要因

Public Const Wel_COMPO$ = "BA"                      '「WEL 構成表示」の要因 2006.10.15

Public Const Wel_KEN_RIREKI$ = "BB"                 '「WEL 検品実績」の要因 2006.12.21


Public Const Wel_RIREKI2$ = "BD"                    '「WEL 出庫履歴」の要因 2009.01.09
Public Const Wel_AVE_SYUKA_ID$ = "BE"               '「WEL 月平均出荷数 ID読み込み」の要因 2009.03.19

Public Const Wel_KEN_ZAN_ID$ = "BF"                 '「WEL 集約梱包残」の要因 2010.02.15

Public Const Wel_AKI_LOC$ = "BG"                    '「WEL 空きロケーションの検索」の要因


Public Const Wel_S_AVE_SYUKA$ = "BH"                '「WEL 生産計画」の要因   2011.07.05




Public Const Wel_GOODS_ONOFF_ONO$ = "D0"            '「WEL 商品/未商品切り替え　小野」の要因
Public Const Wel_GOODS_ONOFF_SIGA$ = "D1"           '「WEL 商品/未商品切り替え　滋賀」の要因


Public Const Wel_RETURNED_GOODS$ = "E0"             '「WEL 良品返品」の要因
Public Const Wel_LOCATION_MOVE$ = "E1"              '「WEL 棚移動」の要因

'2007.09.12                                         '「WEL 大阪良品返品」の要因
Public Const Wel_RETURNED_GOODS_OSAKA$ = "E2"

'2007.11.02                                         '「WEL 出荷CANCEL」の要因
Public Const Wel_SYUKA_CENCEL$ = "E3"



'2008.11.20                                         '「WEL 在庫精査」の要因
Public Const Wel_ZAIKO_SEISA$ = "E4"
'2008.12.05                                         '「WEL 出庫CANCEL」の要因
Public Const Wel_SYUKO_CANCEL$ = "E5"


'2009.02.26                                         '「WEL 移管処理」の要因
Public Const Wel_IKAN_1$ = "E6"
'2009.02.26                                         '「WEL 移管処理」の要因
Public Const Wel_IKAN_2$ = "E7"
'2009.02.26                                         '「WEL 移管処理」の要因
Public Const Wel_IKAN_3$ = "E8"
'2009.03.09                                         '「WEL 移管削除処理」の要因
Public Const Wel_IKAN_DEL$ = "E9"
'2009.03.09                                         '「WEL 移管表示処理」の要因
Public Const Wel_IKAN_DSP$ = "EA"
'2009.03.17                                         '「WEL 棚番追加処理」の要因
Public Const Wel_TANA_INS$ = "EB"
'2009.03.17                                         '「WEL 出荷削除処理」の要因
Public Const Wel_SYUKA_DEL$ = "EC"


'2010.03.09                                         '「WEL 才数／口数」の要因
Public Const Wel_SAI_SU$ = "ED"



'2010.12.13
Public Const Wel_TANA_USE$ = "EE"                   '「WEL 棚使用状況」の要因
'2010.12.13


'2011.03.05
Public Const Wel_LABEL_PRINT$ = "EF"                '「WEL ラベル発行」の要因

'2011.08.05
Public Const Wel_JAN_SET$ = "EG"                    '「WEL 品番(JAN)登録」の要因

'2015.01.22
Public Const Wel_T_back$ = "EH"                     '「WEL 引取処理(広島)」の要因

'2015.10.06
Public Const Wel_LABEL_PRINT_CNT$ = "EI"            '「WEL ラベル発行 枚数指定」の要因


'2020/04/06
Public Const Wel_sagyoin$ = "EL"            '作業時間の要因



Public Const Wel_Inspe_DEN$ = "F0"                  '「WEL 大阪検品」の要因 2006.12.21
Public Const Wel_KYOSEI_END$ = "F1"                 '「WEL 大阪強制完了」の要因 2006.12.21
'Private Const Wel_Inspe_DEN2$ = "F2"               '「WEL 大阪検品2」の要因 2009.06.03

Public Const Wel_Inspe_E_BAG$ = "F2"                '「WEL 大阪検品ｲｰﾊﾞｯｸ」の要因 2010.01.21

Public Const Wel_LABEL_REPRINT$ = "F3"              '「WEL ラベル再発行」の要因 2010.01.21

Public Const Wel_Inspe_LOGISTIC$ = "F4"             '「WEL ﾛｼﾞｽﾃｯｸｽ」の要因 2010.01.21

Public Const Wel_SEK_PACKING$ = "F5"                '「WEL 積水邸別梱包処理」の要因 2011.04.25

Public Const Wel_SEK_Inspe$ = "F6"                  '「WEL 積水邸別検品処理」の要因 2011.05.09

Public Const Wel_SEK_SYUGO_PACKING$ = "F7"          '「WEL 積水邸別集合梱包処理」の要因 2011.05.12

Public Const Wel_SEK_KYOSEI_END$ = "F8"             '「WEL 積水強制終了処理」の要因 2011.06.28



Public Const Wel_SYUKO_HYO_OSAKA$ = "G0"            '「WEL 大阪出庫表」の要因 2007.03.16

Public Const Wel_IN_KENPIN_OSAKA$ = "H0"            '「WEL 大阪入庫検品」の要因 2007.06.07

Public Const WEL_IN_TANA_S_OSAKA$ = "H1"            '「WEL 資材検収入庫」の要因 2012.03.06

Public Const WEL_MAEGARI_TANA_S_OSAKA$ = "H2"       '「WEL 資材前借入庫」の要因 2016.05.30


Public Const Wel_IN_TANA_OSAKA$ = "I0"              '「WEL 大阪実棚入庫」の要因 2007.06.07




Public Wel_FURIKAE As String * 2                    '「WEL 収支振替」の要因 2007.06.28

Public Wel_HIN_FURIKAE_PLUS     As String * 2       '「WEL 品番振替+」の要因 2011.06.01
Public Wel_HIN_FURIKAE_MAINA    As String * 2       '「WEL 品番振替-」の要因 2011.06.01





'Public Wel_S_SHOUHI             As String * 2       '「WEL 資材消費」の要因 2007.06.28             '2015.03.03 移動
'Public Wel_S_SHOUHI2             As String * 2      '「WEL 資材消費(新)」の要因 2015.02.21                     移動



Public Const Wel_SHOUHINKA_CHECK$ = "M0"            '「WEL 商品化ﾁｪｯｸ」の要因 2010.09.03
Public Const Wel_HINBAN_CHECK$ = "M1"               '「WEL 品番ﾁｪｯｸ」の要因 2010.09.10


Public Const Wel_COMPO_CHECK$ = "M2"                '「WEL 構成ﾁｪｯｸ」の要因 2011.03.02

Public Const Wel_SHOUHINKA_GAI_CHECK$ = "M5"        '「WEL 商品化ﾁｪｯｸ(外装品番)」の要因 2015.11.07



Public Const Wel_SHIJI_END$ = "M8"                  '「WEL 商品化完了登録」の要因 2018.04.26

'------------------------------------------------------ 床暖房　管理№  2013.06.06
Public Const Wel_LotNo_IN_CHECK$ = "N1"             '「WEL 床暖　入荷検品」の要因
Public Const Wel_LotNo_OUT_CHECK$ = "N2"            '「WEL 床暖　出荷検品」の要因
Public Const Wel_LotNo_OUT_CANCEL$ = "N3"           '「WEL 床暖　出荷キャンセル」の要因
Public Const Wel_LotNo_LABEL_PRINT$ = "N4"          '「WEL 床暖　ラベル発行」の要因


Public Const Wel_InvNo_OUT_CHECK$ = "N5"            '「WEL 床暖　出荷検品(送状№)」の要因           2014.07.01
Public Const Wel_InvNo_OUT_CANCEL$ = "N6"           '「WEL 床暖　出荷キャンセル(送状№)」の要因     2014.07.01


'Public Const LCD_LotNo_BCR$ = "ﾊﾞｰｺｰﾄﾞを読込む"    '2014.07.01

'Public Const LCD_InvNo_BCR$ = "送状№を読込む"     '2014.07.01


Public LCD_LotNo_BCR    As String                   '2014.07.01

Public LCD_InvNo_BCR    As String                   '2014.07.01


Public LCD_BCR_N1       As String                   '2014.07.01
Public LCD_BCR_N2       As String                   '2014.07.01
Public LCD_BCR_N3       As String                   '2014.07.01
Public LCD_BCR_N4       As String                   '2014.07.01
Public LCD_BCR_N5       As String                   '2014.07.01
Public LCD_BCR_N6       As String                   '2014.07.01


Public N4_SendFile              As String           '「WEL 床暖　ラベル発行」の送信ファイル名

'------------------------------------------------------ 床暖房　管理№  2013.06.06

'------------------------------------------------------ モジュール  2014.06.24
Public Const Wel_MODULE_INSPE$ = "O1"               '「WEL モジュール検品」の要因
Public Const Wel_MODULE_INSPE2$ = "O2"              '「WEL モジュール検品」の要因   2015.02.19

Public Wel_MODULE_IN        As String * 2           '「WEL モジュール入庫」の要因       2018.10.03
Public Wel_MODULE_IN_SOKO   As String * 2           '「WEL モジュール入庫」の入庫倉庫   2018.10.03

'------------------------------------------------------ モジュール  2014.06.24


'------------------------------------------------------ 送り状・伝票ｾｯﾄ  2016.10.11
Public Const Wel_OKURI_DEN_SET$ = "Q1"              '送り状・伝票ｾｯﾄ処理
Public Const Wel_OKURI_DEN_INSP$ = "Q2"             '送り状・伝票ｾｯﾄ検品
'------------------------------------------------------ 送り状・伝票ｾｯﾄ  2016.10.11





Public WEL_KENPIN_GAI           As String * 2       '2014.03.05 数量検品
Public WEL_KENPIN_Su            As String * 2       '2014.03.05 数量検品



Public B1_SendFile              As String           '「WEL 棚番表示」の送信ファイル名
Public B6_SendFile              As String           '「WEL 当日出庫履歴」の送信ファイル名
Public B7_SendFile              As String           '「WEL 出荷推移」の送信ファイル名

Public B9_SendFile              As String           '「WEL 棚番表示(仮想優先)」の送信ファイル名
Public BA_SendFile              As String           '「WEL 構成表示」の送信ファイル名

Public BB_SendFile              As String           '「WEL 検品履歴」の送信ファイル名

'2009.01.09
Public BD_SendFile              As String           '「WEL 当日出庫履歴2」の送信ファイル名

'2010.02.15
Public BF_SendFile              As String           '「WEL 集約梱包残」の送信ファイル名

'2010.12.13
Public BG_SendFile              As String           '「WEL 空きロケーション検索」の送信ファイル名


'2011.03.05
Public EF_SendFile              As String           '「WEL ﾗﾍﾞﾙ発行」の送信ファイル名

'2015.10.06
Public EI_SendFile              As String           '「WEL ﾗﾍﾞﾙ発行(枚数指定)」の送信ファイル名


'2010.01.21
Public F0_SendFile              As String           '「WEL 大阪検品」の送信ファイル名


'2016.06.27
Public KENPIN_OSAKA_NEW2_FILE   As String           '「WEL 指図表完了」の送信ファイル名


'2017.04.10
Public R1_SendFile              As String           '「ﾊﾞｰｺｰﾄﾞ印字用ﾗﾍﾞﾙ　ﾌｧｲﾙ(1)」の送信ファイル名
Public R2_SendFile              As String           '「ﾊﾞｰｺｰﾄﾞ印字用ﾗﾍﾞﾙ　ﾌｧｲﾙ(2)」の送信ファイル名
Public R3_SendFile              As String           '「ﾊﾞｰｺｰﾄﾞ印字用ﾗﾍﾞﾙ　ﾌｧｲﾙ(3)」の送信ファイル名
Public R4_SendFile              As String           '「ﾊﾞｰｺｰﾄﾞ印字用ﾗﾍﾞﾙ　ﾌｧｲﾙ(4)」の送信ファイル名



Public Type SendFileRec_Tag                '送信ファイルレコード定義
    Title                       As String * 1       'タイトル
    LCD(0 To 19)                As Byte             '表示メッセージ
    CRLF                        As String * 2       'CR/LF
End Type


Public Const Wel_Kbn_Title$ = "0"                   'タイトル行
Public Const Wel_Kbn_Normal$ = "1"                  '通常表示行


Public Type Tanahyoji_tag                           '棚表示用集計テーブル
    Tanaban                     As String * 8
    SUMI_QTY                    As Long
    MI_QTY                      As Long
End Type


Public Type AKI_Tanahyoji_tag                       '空き棚表示用テーブル
    Tanaban                     As String * 4
    Tana_Use                    As String * 3
End Type


Public Inspection_Flg           As Integer          '検品チェックフラグ(0:出庫未完NG 1:出庫未完でもOK)

Public B2_MEMO                  As String           '品番別在庫照合（要因＝B2）のメモ
Public B8_MEMO                  As String           '品番別棚別在庫照合（要因＝B8）のメモ

Public ALL_MENU_GRP             As String * 2


Public Type SHIMUKE_TBL_Tag
    JGYOBU                      As String * 1
    NAIGAI                      As String * 1
    SHIMUKE_CODE                As String * 2
End Type

Public SHIMUKE_TBL()            As SHIMUKE_TBL_Tag


'運送会社の読み替え 2006.12.22
Public UNSOU_KAISHA_CODE        As String
Public UNSOU_KAISHA_NAME        As String


'久留米読み替え 2007.01.09
'Private KURUME()    As String
'Private KURUME_F    As Boolean
'福山読み替え   2007.01.09
'Private FUKUYAMA()  As String
'Private FUKUYAMA_F  As Boolean
'佐川読み替え   2007.01.09
'Private SAGAWA()    As String

Public FUKUYAMA_Name            As String
Public FUKUYAMA_Length          As Integer
Public FUKUYAMA_CODE()          As String



Public SEIBU_Name               As String
Public SEIBU_Length             As Integer
Public SEIBU_CODE()             As String


Public KURUME_Name              As String
Public KURUME_Length            As Integer
Public KURUME_CODE()            As String


Public SAGAWA_Name              As String
Public SAGAWA_Length            As Integer
Public SAGAWA_CODE()            As String

Public YAMATO_Name              As String
Public YAMATO_Length            As Integer
Public YAMATO_CODE()            As String



'ﾊﾟﾅﾎｰﾑ 2011.06.06
Public PANA_Name                As String
Public PANA_Length              As Integer
Public PANA_CODE()              As String
'積水ﾊｳｽ 2011.06.06
Public SEKISUI_Name             As String
Public SEKISUI_Length           As Integer
Public SEKISUI_CODE()           As String





'-----------------  >　運送会社セレクト 2018.10.05
Public Type UNSOU_TBL_tag
    CODE        As String * 2
    NAME        As String
End Type

Public UNSOU_TBL()  As UNSOU_TBL_tag
'-----------------  >　運送会社セレクト 2018.10.05


'送り先集約CD   2015.04.27
Public COL_OKURISAKI_CD()       As String * 20
Public COL_OKURISAKI_NAME()     As String * 40


'送り先CD       2015.04.27
Public OKURISAKI_CD()           As String * 9
Public OKURISAKI_NAME()         As String * 40









'検品数初期表示(0:出庫未完NG 1:出庫未完でもOK)
Public Inspection_QTY           As Integer
'入荷検品時の入荷倉庫   2007.06.07
Public NYUKA_SOKO_NO            As String * 2
'出庫時の数量入力　必須有無 2007.08.02
Public SYUKO_QTY                As Integer

'再検品のﾁｪｯｸ 0:OK 1:NG 2007.10.10
Public Inspection_CHK           As Integer


'事業部読み替え対象 '2008.07.24
Public JGYOBU_YOMIKAE_F         As Boolean
Public JGYOBU_YOMIKAE_T         As Variant

'ＣＡＮＣＥＬ時の動作   2008.09.01
Public CANCEL_OPE               As Boolean

'チャーター便   2010.01.21
Public KEN_CHARTER_CD           As String
Public KEN_CHARTER_NM           As String

'赤帽   2010.01.21
Public KEN_AKABOU_CD            As String
Public KEN_AKABOU_NM            As String


'ロジステック   2010.01.21
Public KEN_LOGISTIC_CD          As String


'精査要因   2008.11.20
Public ZAIKO_SEISA_PURA         As String
Public ZAIKO_SEISA_MAINA        As String

'出荷検品BUZEER音   2009.07.27
Public Wel_Inspe_BUZZER         As String * 1
'出荷BUZEER音       2009.07.27
Public Wel_SYUKA_BUZZER         As String * 1



'口数入力有無　false:入力不可 ture:可
Public Inspection_Input         As Boolean

'廃棄処理向け先
Public HAIKI_MTS                As Variant
Public HAIKI_MTS_F              As Boolean


'異常対処 2011.04.02
Public RECOVER_F                As Boolean




'構成ﾁｪｯｸ対応　種別     2011.04.18
Public Kousei_check_Tb          As Variant
Public Kousei_check_F           As Boolean




'大阪積水対応           2011.05.27
Public SEK_KONPO_F              As Boolean  '集合梱包時、梱包有無　0:未梱包でもＯＫ（デフォルト） 1:未梱包はＮＧ

Public SEK_KEN_SHOGO_F          As Boolean  '検品時、照合有無　0:未照合でもＯＫ（デフォルト） 1:未照合はＮＧ

Public SEK_KEN_KONPO_F          As Boolean  '検品時、梱包有無　0:未梱包でもＯＫ（デフォルト） 1:未梱包はＮＧ

Public SEK_KEN_KENPIN_F         As Boolean  '検品時、再検品可否　0:検品済みでもＯＫ（デフォルト） 1:検品済みはＮＧ


Public SEK_LABEL_PAGE           As Integer
'大阪積水対応           2011.05.27


'大阪品番振替対応　2011.06.01
Public YOIN_BEF_HINBAN          As String * 2   '品番振替－

Public YOIN_AFT_HINBAN          As String * 2   '品番振替＋
'大阪品番振替対応　2011.06.01

'生産計画対応   2011.07.05
Public TUKI1                    As Integer      '月平均出荷　期間
Public TUKI2                    As Integer      '生産計画月平均出荷　期間
'生産計画対応   2011.07.05



'------------------------------------------------------------------ 大阪  部材対応　2012.03.06
Public USE_YM                   As String * 6           '使用月

Public BUZAI_DATE_S             As String * 8           '使用月範囲　開始
Public BUZAI_DATE_E             As String * 8           '使用月範囲　終了


Public IN_TANA_S_OSAKA          As Variant              '検収～棚入れの要因


Public Wel_IDO_OUT_OSAKA        As String * 2           '③出庫処理の要因
Public Wel_IDO_OUT_OSAKA2       As String * 2           '③出庫処理の要因   2014.11.07

Public Wel_IDO_OUT_OSAKA3       As String * 2           '③出庫処理の要因   2016.05.11


Public IDO_OUT_ZAIKO_SOKO_F     As Boolean              '部材出庫処理時の在庫集計対象倉庫   2014.10.30

Public Wel_HIN_FURIKA_S         As String * 2           '○振替出庫の要因
Public Wel_IDO_IN_OSAKA         As String * 2           '○振替出庫の要因



Public Const LCD_BEF_Su$ = "振替前数："
Public Const LCD_AFT_Su$ = "振替後数："


Public Const LCD_OSAKA_IDO_OUT$ = "出庫数"              '指図票出庫　出庫数 2012.04.06


Public YOIN_BEF_HINBAN_S        As String * 2           '部材品番振替時の振替前品番－
Public YOIN_AFT_HINBAN_S        As String * 2           '部材品番振替時の振替前品番＋

Public Wel_COMPO_OSAKA_CHECK    As String * 2           '「WEL 構成ﾁｪｯｸ」の要因


Public Wel_KENPIN_OSAKA         As String * 2           '「WEL 検品ﾁｪｯｸ」の要因
Public KENPIN_OSAKA_SOKO_No     As String * 2           '「WEL 検品ﾁｪｯｸ」の要因


Public Wel_KENPIN_OSAKA_NEW     As String * 2           '「WEL 検品ﾁｪｯｸ」の要因     2016.05.20
Public Wel_KENPIN_OSAKA_NEW2    As String * 2           '「WEL 検品ﾁｪｯｸ(エラー表示有り)」の要因     2016.06.27



Public Const LCD_SHIJI_END$ = "商品化作業終了？"


Public LABEL_88_SendFile        As String               '「WEL ﾗﾍﾞﾙ発行」の送信ファイル名


Public YUKO_JGYOBU              As String * 1           '
'------------------------------------------------------------------ 大阪  部材対応　2012.03.06

'------------------------------------------------------------------ 全数検品対応    2012.03.21
Public Const Wel_Inspe_DEN_ALL$ = "F9"                  '「WEL 大阪検品」の要因
Public Const Wel_Inspe_LOGISTIC_ALL$ = "FA"             '「WEL ﾛｼﾞｽﾃｯｸｽ」の要因
Public Const Wel_SEK_PACKING_ALL$ = "FB"                '「WEL 積水邸別梱包処理」の要因

Public Const Wel_Inspe_E_BAG_ALL$ = "FC"                '「WEL ｲｰﾊﾞｯｸ」の要因  2012.06.20

'------------------------------------------------------------------ 全数検品対応    2012.03.21


Public WAIT_TIME                As Long                 '2013.01.04 受信待ち時間


Public start_op                 As String               '2013.12.25




'------------------------------------------------------------------ 奈良モジュール用    2014.07.01
Public Nara_Soko_T              As Variant
'------------------------------------------------------------------ 奈良モジュール用    2014.07.01


'------------------------------------------------------------------ 特定送り先（集合梱包振替）    2015.12.22
Public KONPOU_OKURISAKI_CD()    As String * 9
'------------------------------------------------------------------ 特定送り先（集合梱包振替）    2015.12.22

'------------------------------------------------------------------ ラベルプリンター印字濃度    2016.02.15
Public DK_DEF                   As Integer
'------------------------------------------------------------------ ラベルプリンター印字濃度    2016.02.15

'------------------------------------------------------------------ ラベルプリンター パラメータ 2017.04.10
Public LABEL01_DEF              As String
Public LABEL01_HIN_F            As String
Public LABEL01_HIN_T            As String
Public LABEL01_HIN_B            As String
Public LABEL01_BIK_F            As String
Public LABEL01_BIK_T            As String

Public LABEL01_IRI_F            As String
Public LABEL01_IRI_T            As String


Public LABEL01_LOC_F            As String
Public LABEL01_LOC_T            As String
Public LABEL01_LOC_B            As String
Public LABEL01_QTY_F            As String
Public LABEL01_QTY_T            As String

Public LABEL02_DEF              As String
Public LABEL02_HIN_F            As String
Public LABEL02_HIN_T            As String
Public LABEL02_HIN_B            As String

Public LABEL03_DEF              As String
Public LABEL03_ID_F             As String
Public LABEL03_ID_T             As String
Public LABEL03_ID_B             As String
Public LABEL03_UN_F             As String
Public LABEL03_UN_T             As String
Public LABEL03_OKURI_F          As String
Public LABEL03_OKURI_T          As String
Public LABEL03_DEN_F          As String
Public LABEL03_DEN_T          As String



Public LABEL04_DEF              As String
Public LABEL04_LOC_F            As String
Public LABEL04_LOC_T            As String
Public LABEL04_LOC_B            As String

'------------------------------------------------------------------ ラベルプリンター パラメータ 2017.04.10



'------------------------------------------------------------------ 大阪移動出庫　１未満時の丸め    2016.07.16
Public IDO_OUT_OSAKA_RND        As Integer
'------------------------------------------------------------------ 大阪移動出庫　１未満時の丸め    2016.07.16



'------------------------------------------------------------------ 直送検品有無　1:有り 2016.10.14
Public Inspe_DelvNo_F           As Integer


'------------------------------------------------------------------ 着店コード印字有無　1:有り 2017.04.07
Public TYAKUTEN_PRINT           As Integer


'------------------------------------------------------------------ 出庫(P0)在庫残表示　0(ﾃﾞﾌｫﾙﾄ)=総在庫 1=出庫棚在庫   2017.12.05
Public ZAIKO_DISP_FLG           As Integer


'------------------------------------------------------------------ タイトル 2017.12.09　PUBLICに変更
Public MAIN_TITLE      As String

'-------------------------------------------------------
'
'   『出荷予定のKEY定義』
'
'   2011.03.30
'-------------------------------------------------------

'   2011.08.02 DELETE
'Type KEY8_Y_SYU            'ＫＥＹ８
'    JGYOBU(0 To 0)              As Byte     '事業部区分
'    NAIGAI(0 To 0)              As Byte     '国内外
'    KEY_HIN_NO(0 To 19)         As Byte     '品目番号
'    KAN_YMD(0 To 7)             As Byte     '完了日付
'    KAN_HMS(0 To 13)            As Byte     '完了日時
'End Type
'
'Public K8_Y_SYU                 As KEY8_Y_SYU
'   2011.08.02 DELETE


'
Type F110010_Y_SYU_FSpeck
    ks0     As BtKeySpeck                   ' ｷｰ ｽﾍﾟｯｸ構造体
    ks1     As BtKeySpeck                   ' ｷｰ ｽﾍﾟｯｸ構造体
    ks2     As BtKeySpeck                   ' ｷｰ ｽﾍﾟｯｸ構造体
    ks3     As BtKeySpeck                   ' ｷｰ ｽﾍﾟｯｸ構造体
    ks4     As BtKeySpeck                   ' ｷｰ ｽﾍﾟｯｸ構造体
End Type
Private F110010_Y_SYU_Speck As F110010_Y_SYU_FSpeck

Sub Main()
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2013.12.25
    
    
    start_op = Trim(Command)

    F1100101.Show
End Sub

Public Function Y_SYU_Create_Index() As Integer
'-------------------------------------------------------
'
'   『出荷予定のKEY追加』
'
'   2011.03.30
'-------------------------------------------------------
Dim sts As Integer


    Y_SYU_Create_Index = True


    F110010_Y_SYU_Speck.ks0.keypos = 14                     ' キーポジション
    F110010_Y_SYU_Speck.ks0.keyleng = 1                     ' キー長
                                                            ' キーフラグ
    F110010_Y_SYU_Speck.ks0.keyflag = BtKfExt + BtKfDup + BtKfChg + BtKfSeg
    F110010_Y_SYU_Speck.ks0.keytype = Chr(BtKtString)       ' キータイプ
    F110010_Y_SYU_Speck.ks0.reserve = &H0                   ' 予約済み

    F110010_Y_SYU_Speck.ks1.keypos = 28                     ' キーポジション
    F110010_Y_SYU_Speck.ks1.keyleng = 1                     ' キー長
                                                    ' キーフラグ
    F110010_Y_SYU_Speck.ks1.keyflag = BtKfExt + BtKfDup + BtKfChg + BtKfSeg
    F110010_Y_SYU_Speck.ks1.keytype = Chr(BtKtString)       ' キータイプ
    F110010_Y_SYU_Speck.ks1.reserve = &H0                   ' 予約済み

    F110010_Y_SYU_Speck.ks2.keypos = 29                     ' キーポジション
    F110010_Y_SYU_Speck.ks2.keyleng = 20                    ' キー長
                                                            ' キーフラグ
    F110010_Y_SYU_Speck.ks2.keyflag = BtKfExt + BtKfDup + BtKfChg + BtKfSeg
    F110010_Y_SYU_Speck.ks2.keytype = Chr(BtKtString)       ' キータイプ
    F110010_Y_SYU_Speck.ks2.reserve = &H0                   ' 予約済み

    F110010_Y_SYU_Speck.ks3.keypos = 664                    ' キーポジション
    F110010_Y_SYU_Speck.ks3.keyleng = 8                     ' キー長
                                                            ' キーフラグ
    F110010_Y_SYU_Speck.ks3.keyflag = BtKfExt + BtKfDup + BtKfChg + BtKfSeg
    F110010_Y_SYU_Speck.ks3.keytype = Chr(BtKtString)      ' キータイプ
    F110010_Y_SYU_Speck.ks3.reserve = &H0                  ' 予約済み



    F110010_Y_SYU_Speck.ks4.keypos = 757                    ' キーポジション
    F110010_Y_SYU_Speck.ks4.keyleng = 6                     ' キー長
                                                            ' キーフラグ
    F110010_Y_SYU_Speck.ks4.keyflag = BtKfExt + BtKfDup + BtKfChg
    F110010_Y_SYU_Speck.ks4.keytype = Chr(BtKtString)      ' キータイプ
    F110010_Y_SYU_Speck.ks3.reserve = &H0                  ' 予約済み


    sts = BTRV(BtOpCreatSupIndex, Y_SYU_POS, F110010_Y_SYU_Speck, Len(F110010_Y_SYU_Speck), K8_Y_SYU, Len(K8_Y_SYU), 8)
    If sts Then
        Call File_Error(sts, BtOpCreatSupIndex, "出荷予定データ")
        Exit Function
    End If

    Y_SYU_Create_Index = False

End Function
Public Function Ave_Syuka_ID_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『月平均出荷数表示処理(ID読み込み)』
'           2009.03.19
'
'           2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer

Dim Tanaban         As String * 11
Dim Hinban          As String * 20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1
Dim HIN_NO          As String * 13
Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1

Dim AVE_SYUKA_ED    As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2   '2008.08.08

Dim MSG             As String       '2009.03.14


    Ave_Syuka_ID_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            
            
            Case LCD_ID_No      '伝票ＩＤ

                ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        NAIGAI, _
                                        Hinban, _
                                        MTS_CODE, _
                                        SS_CODE, _
                                        CYU_KBN, _
                                        Y_SYU_CNT, _
                                        ID_NO, _
                                        SYUKA_QTY, _
                                        DEN_NO, _
                                        KAN_KBN, _
                                        JITU_QTY)
                Select Case sts
                    Case False          '正常
                        If Y_SYU_CNT = 0 Then   '対象データなし
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ave_Syuka_ID_Proc = False
                            Exit Function
                        End If
        
                    Case True
                    Case SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    Case SYS_CANCEL
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")   '2017.09.22
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Sendbuf = Text_Create_Proc()
                        Ave_Syuka_ID_Proc = False
                        Exit Function
                End Select
            
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")          '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Ave_Syuka_ID_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
                                '月平均出荷数読み込み
''''''''''''''''2006.01.06 資材に対応
'                Call UniCode_Conv(K0_AVE_SYUKA.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_AVE_SYUKA.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                Call UniCode_Conv(K0_AVE_SYUKA.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K0_AVE_SYUKA.NAIGAI, RET_NAIGAI)
''''''''''''''''2006.01.06 資材に対応
                Call UniCode_Conv(K0_AVE_SYUKA.HIN_GAI, Hinban)
                sts = BTRV(BtOpGetEqual, AVE_SYUKA_POS, AVE_SYUKAREC, Len(AVE_SYUKAREC), K0_AVE_SYUKA, Len(K0_AVE_SYUKA), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                        Call UniCode_Conv(AVE_SYUKAREC.AVE_SYUKA, "00000000")
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "月平均出荷数", 0)
                        Exit Function
                End Select
        
        End Select
    Next i
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = ""
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１行目
                                                            'BOX属性
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    '>>>>>  2017.09.22
'    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
    
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    '>>>>>  2017.09.22
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(0).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                            'メニュ―番号
    Send_Text.Box_Type(0).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    
    '-----------------------------------------------２行目
                                                            'BOX属性
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(1).Max_Size = "13"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "13"
                                                            'メニュ―番号
    Send_Text.Box_Type(1).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    '-----------------------------------------------３行目
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            
                                                            
    AVE_SYUKA_ED = Format(CLng(StrConv(AVE_SYUKAREC.AVE_SYUKA, vbUnicode)), "#0")
    AVE_SYUKA_ED = "[" & Space(8 - Len(AVE_SYUKA_ED)) & AVE_SYUKA_ED & "]"
                                                             
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "月平均:" & AVE_SYUKA_ED)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "月平均:" & AVE_SYUKA_ED)
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "08"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "08"
                                                            'メニュ―番号
    Send_Text.Box_Type(2).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    '-----------------------------------------------４行目      2008.10.08 ロット数表示を追加
                                                            'BOX属性
    Send_Text.Box_Type(3).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
    
    If IsNumeric(StrConv(ITEMREC.SEI_LOT, vbUnicode)) Then
        AVE_SYUKA_ED = Format(CLng(StrConv(ITEMREC.SEI_LOT, vbUnicode)), "#0")
    Else
        AVE_SYUKA_ED = "0"
    End If
    AVE_SYUKA_ED = "[" & Space(8 - Len(AVE_SYUKA_ED)) & AVE_SYUKA_ED & "]"
    
    
    
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "ロット:" & AVE_SYUKA_ED)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "ロット:" & AVE_SYUKA_ED)
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = "08"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "08"
                                                            'メニュ―番号
    Send_Text.Box_Type(3).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    '-----------------------------------------------５行目
                                                            'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    
    MSG = StrConv(ITEMREC.STAT, vbUnicode) & " "            '2009.03.14
    
    
    
    
    
    
    
    
    
    Select Case StrConv(ITEMREC.STAT, vbUnicode)
        
        Case "0"
            MSG = MSG & "供給非対"
        
        Case "1"
            MSG = MSG & "供給対象"
        
        Case "2"
            MSG = MSG & "打切中　"
        
        Case "3"
            MSG = MSG & "打切　　"
        
        
        Case "6"
            MSG = MSG & "移管外　"
    
        Case "7"
            MSG = MSG & "移管対象"
        
        Case "8"
            MSG = MSG & "部分廃棄"
    
        Case "9"
            MSG = MSG & "全数廃棄"
    
        Case Else
            MSG = MSG & "　　　　"
    
    
    End Select
    
    
    MSG = MSG & " " & StrConv(ITEMREC.BIKOU_TANA, vbUnicode)
    
    
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, MSG)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, MSG)
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                            'メニュ―番号
    Send_Text.Box_Type(4).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        

    Sendbuf = Text_Create_Proc()
    
    
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Ave_Syuka_ID_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    
    
    Ave_Syuka_ID_Proc = False
    

End Function
Public Function S_Ave_Syuka_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『生産計画月平均出荷数表示処理』
'
'       2011.07.05
'
'       2012.03.25  frm より　移管
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer

Dim Hinban          As String * 20
Dim Tanaban         As String * 8

Dim AVE_SYUKA_ED    As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim MSG             As String

Dim MSG2            As String       '2019/12/11 生産計画要因 海外供給区分確認追加

    S_Ave_Syuka_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                
                
                
    
    
                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))  'ID№
                
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                    
                        Hinban = StrConv(Y_SYUREC.HIN_NO, vbUnicode)
                    
                    Case BtErrKeyNotFound
                    
                    
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                    
                    
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                End Select
                
                
                
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        S_Ave_Syuka_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
                                '月平均出荷数読み込み
''''''''''''''''2006.01.06 資材に対応
'                Call UniCode_Conv(K0_AVE_SYUKA.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_AVE_SYUKA.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                Call UniCode_Conv(K0_AVE_SYUKA.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K0_AVE_SYUKA.NAIGAI, RET_NAIGAI)
''''''''''''''''2006.01.06 資材に対応
                Call UniCode_Conv(K0_AVE_SYUKA.HIN_GAI, Hinban)
                sts = BTRV(BtOpGetEqual, AVE_SYUKA_POS, AVE_SYUKAREC, Len(AVE_SYUKAREC), K0_AVE_SYUKA, Len(K0_AVE_SYUKA), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                        Call UniCode_Conv(AVE_SYUKAREC.S_AVE_SYUKA_QTY1, "00000000")
                        Call UniCode_Conv(AVE_SYUKAREC.S_AVE_SYUKA_CNT1, "00000000")
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "月平均出荷数", 0)
                        Exit Function
                End Select
        
        End Select
    Next i
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = ""
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１行目
                                                            'BOX属性
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    '>>>>>>>    2017.09.22
    'Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
    'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
    
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    '>>>>>>>    2017.09.22
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(0).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                            'メニュ―番号
    Send_Text.Box_Type(0).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    
    '-----------------------------------------------２行目
                                                            'BOX属性
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    '2011.07.05
'    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)
'    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(Hinban, 15) & Format(TUKI2, "#0") & "ｶ月")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban & Format(TUKI2, "#0") & "ｶ月")
    '2011.07.05
                                                            
                                                            
                                                            
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
    '2010.12.07
'    Send_Text.Box_Type(1).Max_Size = "13"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "13"
    Send_Text.Box_Type(1).Max_Size = "20"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "20"
    '2010.12.07
                                                            'メニュ―番号
    Send_Text.Box_Type(1).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    '-----------------------------------------------３行目
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            
                                                            
    If Numeric_Check(EDIT_ONLY, 8, 1, 0, 1, 0, StrConv(AVE_SYUKAREC.S_AVE_SYUKA_QTY1, vbUnicode), AVE_SYUKA_ED) Then
        AVE_SYUKA_ED = Format(0, "#0.0")
    End If
                                                            
                                                            
                                                            
'    If IsNumeric(StrConv(AVE_SYUKAREC.S_AVE_SYUKA_QTY1, vbUnicode)) Then
'        AVE_SYUKA_ED = Format(CDbl(StrConv(AVE_SYUKAREC.S_AVE_SYUKA_QTY1, vbUnicode)), "#0.0")
'    Else
'        AVE_SYUKA_ED = Format(0, "#0.0")
'    End If
    
    
    
    
    
    AVE_SYUKA_ED = "[" & Space(8 - Len(AVE_SYUKA_ED)) & AVE_SYUKA_ED & "]"
                                                             
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "月平均数:" & AVE_SYUKA_ED)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "月平均数:" & AVE_SYUKA_ED)
                                                            
                                                            
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "08"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "08"
                                                            'メニュ―番号
    Send_Text.Box_Type(2).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    '-----------------------------------------------４行目      2008.10.08 ロット数表示を追加
                                                            'BOX属性
    Send_Text.Box_Type(3).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
    
    
    If Numeric_Check(EDIT_ONLY, 8, 1, 0, 1, 0, StrConv(AVE_SYUKAREC.S_AVE_SYUKA_CNT1, vbUnicode), AVE_SYUKA_ED) Then
        AVE_SYUKA_ED = Format(0, "#0.0")
    End If
    
    
'    If IsNumeric(StrConv(AVE_SYUKAREC.S_AVE_SYUKA_CNT1, vbUnicode)) Then
'        AVE_SYUKA_ED = Format(CDbl(StrConv(AVE_SYUKAREC.S_AVE_SYUKA_CNT1, vbUnicode)), "#0.0")
'    Else
'        AVE_SYUKA_ED = Format(0, "#0.0")
'    End If
    AVE_SYUKA_ED = "[" & Space(8 - Len(AVE_SYUKA_ED)) & AVE_SYUKA_ED & "]"
                                                             
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "月平均件:" & AVE_SYUKA_ED)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "月平均件:" & AVE_SYUKA_ED)
    
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = "08"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "08"
                                                            'メニュ―番号
    Send_Text.Box_Type(3).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    '-----------------------------------------------５行目
                                                            'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    
    MSG = StrConv(ITEMREC.NAI_BUHIN, vbUnicode) & " "            '2009.03.14
    
    Select Case StrConv(ITEMREC.NAI_BUHIN, vbUnicode)
        
        Case "0"
            MSG = MSG & "国内非"
        
        Case "1"
            MSG = MSG & "国内供"
        
        Case "2"
            MSG = MSG & "国打中"
        
        Case "3"
            MSG = MSG & "国打切"
        
        Case "6"
            MSG = MSG & "移管外"
    
        Case "7"
            MSG = MSG & "移管対象"
        
        Case "8"
            MSG = MSG & "部分廃棄"
    
        Case "9"
            MSG = MSG & "全数廃棄"
    
        Case Else
            MSG = MSG & "　　　　"
    
    End Select
    
    MSG2 = StrConv(ITEMREC.GAI_BUHIN, vbUnicode) & " "

    Select Case StrConv(ITEMREC.GAI_BUHIN, vbUnicode)          ' 2019/12/11 生産計画要因 海外供給区分追加

        Case "0"
            MSG2 = MSG2 & "海外非"

        Case "1"
            MSG2 = MSG2 & "海外供"

        Case "2"
            MSG2 = MSG2 & "外打中"

        Case "3"
            MSG2 = MSG2 & "外打切"

        Case Else
            MSG2 = MSG2 & "　　　"

    End Select
    

    MSG = MSG & " " & MSG2
    
    
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, MSG)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, MSG)
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                            'メニュ―番号
    Send_Text.Box_Type(4).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        

    Sendbuf = Text_Create_Proc()
    
    
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            S_Ave_Syuka_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    
    
    S_Ave_Syuka_Proc = False
    

End Function

Public Function Zaitei_In_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『在訂+指定時のチェック＆更新処理』
'
'   2007.11.02 資材の入庫については未商品のみとする
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim i           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07


Dim Tanaban     As String * 8
Dim sts         As Integer

Dim QTY         As Long
Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1

Dim MENU_NO     As String * 2

Dim WK_CODE     As String * 5       '2007.05.28
Dim WK_TANKA    As String * 11      '2007.05.28


    Zaitei_In_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Tanaban        '棚番
                Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                
                If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                Else
                '------------------ 倉庫マスタ読込み
                    Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                    sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                            Zaitei_In_Proc = False
                            Exit Function
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                            Exit Function
                    End Select
                    '------------------ 混載チェック
                    If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                        If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                            StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")      '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")  '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Zaitei_In_Proc = False
                            Exit Function
                        End If
                    End If
                    '------------------ 棚マスタ読込み
                    Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                    Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                    Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                    Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Zaitei_In_Proc = False
                            Exit Function
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                            Exit Function
                    End Select
            
                    '------------------ 禁止棚のチェック
                    If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                        Zaitei_In_Proc = False
                        Exit Function
                    End If
            
            
                End If
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                '------------------ 品目マスタ読込み
'                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                        If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                            Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                    Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Zaitei_In_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                        End If
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Zaitei_In_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
            
            Case LCD_Suryo          '数量（ここは無い）
                If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Zaitei_In_Proc = False
                    Exit Function
                End If
                
                QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                If QTY = 0 Then
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2107.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Zaitei_In_Proc = False
                    Exit Function
                End If
            
            
            Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Zaitei_In_Proc = False
                    Exit Function
                End If
                
                
                If Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD) = LCD_SUMI_Suryo Then
                    
                    
                    SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                
                
                    If RET_JGYOBU = SHIZAI Then     '2007.11.02
                        If SUMI_QTY <> 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "商品化済み不可", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "商品化済み不可", "", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                            Zaitei_In_Proc = False
                            Exit Function
                        End If
                    
                    End If
                
                
                
                Else
                    MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                End If
        
                If i = M_Gyo - 1 Then
                    If SUMI_QTY = 0 And MI_QTY = 0 Then
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")    '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                        Zaitei_In_Proc = False
                        Exit Function
                    End If
                End If
        
        End Select
    Next i
    '----------------------------------- データ更新処理開始 -----------
                                        
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Exit Function
    End If
                                        
                                        
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
                                        
                                        
    If RET_JGYOBU = SHIZAI Then
        Call UniCode_Conv(K0_ITEM.JGYOBU, RET_JGYOBU)
        Call UniCode_Conv(K0_ITEM.NAIGAI, RET_NAIGAI)
        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        Select Case sts
            Case BtNoErr
            Case Else
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
        End Select
    
        '品目ﾏｽﾀの最新仕入先／単価が設定されていた時は、こちらの項目を使用  2007.05.28
        If Not IsNumeric(StrConv(ITEMREC.LAST_TANKA, vbUnicode)) Then
            
            WK_CODE = StrConv(ITEMREC.G_SHIIRE_TBL(0).CODE, vbUnicode)
            WK_TANKA = StrConv(ITEMREC.G_SHIIRE_TBL(0).TANKA, vbUnicode)
        Else
            WK_CODE = StrConv(ITEMREC.LAST_CODE, vbUnicode)
            WK_TANKA = StrConv(ITEMREC.LAST_TANKA, vbUnicode)
        
        End If
    
    
    
        sts = Nyuko_Update_Proc(RET_JGYOBU, _
                                RET_NAIGAI, _
                                Hinban, _
                                Format(Now, "YYYYMMDD"), _
                                Tanaban, _
                                (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                SUMI_QTY, _
                                MI_QTY, _
                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                FILE_RETRY, , _
                                WK_CODE, _
                                WK_TANKA, , _
                                MENU_NO)
 
        Select Case sts
            Case False
            Case True           '入庫時は発生しない
            Case SYS_CANCEL
                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                Zaitei_In_Proc = False
                GoTo Abort_Tran
            Case SYS_ERR
                Sendbuf = Text_Create_Proc()
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Zaitei_In_Proc = SYS_ERR    'システム異常発生
                
                GoTo Abort_Tran
        End Select
    
    
    
    
    
    
    Else
                                        
                                            
                                            '入庫更新
        sts = Nyuko_Update_Proc(RET_JGYOBU, _
                                RET_NAIGAI, _
                                Hinban, _
                                Format(Now, "YYYYMMDD"), _
                                Tanaban, _
                                (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                SUMI_QTY, _
                                MI_QTY, _
                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                FILE_RETRY, , , , , MENU_NO)
        Select Case sts
            Case False
            Case True           '入庫時は発生しない
            Case SYS_CANCEL
                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                Zaitei_In_Proc = False
                GoTo Abort_Tran
            Case SYS_ERR
                Sendbuf = Text_Create_Proc()
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Zaitei_In_Proc = SYS_ERR    'システム異常発生
                
                GoTo Abort_Tran
        End Select
    End If

End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        GoTo Abort_Tran
    End If
                                        '次の作業要求
    
    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
    Select Case sts
        Case BtNoErr
        '   -------------------------------- エラーメッセージ作成
        Case Else
        '重要な要因なので未登録はシステム停止とする
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
        Exit Function
    End Select
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
    If Sagyo_Send_Proc() Then
        Sendbuf = Text_Create_Proc()
        Exit Function
    End If
            
    Sendbuf = Text_Create_Proc()
    
    
    
    Zaitei_In_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Public Function Zaitei_Out_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『在訂（－）指定時のチェック＆更新処理』
'
'       2012.03.25  frm より　移管
'-------------------------------------------------------
Dim i               As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim Tanaban         As String * 8
Dim sts             As Integer

Dim QTY             As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Zaitei_Out_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Tanaban        '棚番
                Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                
                If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                Else
                '------------------ 倉庫マスタ読込み
                    Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                    sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                            Zaitei_Out_Proc = False
                            Exit Function
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                            Exit Function
                    End Select
                    '------------------ 混載チェック
                    If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                        If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                            StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Tanaban, "混載エラー", "", "")         '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "混載エラー", "", "")     '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Zaitei_Out_Proc = False
                            Exit Function
                        End If
                    End If
                    '------------------ 棚マスタ読込み
                    Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                    Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                    Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                    Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Zaitei_Out_Proc = False
                            Exit Function
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                            Exit Function
                    End Select
            
                    '------------------ 禁止棚のチェック
                    If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                        Zaitei_Out_Proc = False
                        Exit Function
                    End If
            
                End If
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                '------------------ 品目マスタ読込み
'                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                        If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                            Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                    Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Zaitei_Out_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                        End If
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Zaitei_Out_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
            
            Case LCD_Suryo          '数量（ここは無い）
                If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Zaitei_Out_Proc = False
                    Exit Function
                End If
                
                QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                If QTY = 0 Then
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Zaitei_Out_Proc = False
                    Exit Function
                End If
            
            
            Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Zaitei_Out_Proc = False
                    Exit Function
                End If
                
                
                If Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD) = LCD_SUMI_Suryo Then
                    SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                Else
                    MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                End If
        
                If i = M_Gyo - 1 Then
                    If SUMI_QTY = 0 And MI_QTY = 0 Then
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")    '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                        Zaitei_Out_Proc = False
                        Exit Function
                    End If
                End If
        
        End Select
    Next i
    '----------------------------------- データ更新処理開始 -----------
                                        
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Exit Function
    End If
                                        
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
                                        
                                        
                                        '出庫更新
    sts = Syuko_Update_Proc(RET_JGYOBU, _
                            RET_NAIGAI, _
                            Hinban, _
                            "", _
                            Tanaban, _
                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                            SUMI_QTY, _
                            MI_QTY, _
                            0, _
                            Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                            ID_KANRI_TBL(ING_No).TANTO_CODE, _
                            FILE_RETRY, , , , , , , MENU_NO)
    Select Case sts
        Case False
        
        Case True       '在庫不足時に発生
            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "在庫数不足", "")        '2017.09.22
            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "在庫数不足", "")    '2017.09.22
            Sendbuf = Text_Create_Proc()
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
            Zaitei_Out_Proc = False
            GoTo Abort_Tran
        Case SYS_CANCEL
            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
            Sendbuf = Text_Create_Proc()
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
            Zaitei_Out_Proc = False
            GoTo Abort_Tran
        Case SYS_ERR
            Sendbuf = Text_Create_Proc()
            Call Err_Send_Proc("システム異常発生", "", "", "", "")
            Zaitei_Out_Proc = SYS_ERR    'システム異常発生
            
            GoTo Abort_Tran
    End Select


End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        GoTo Abort_Tran
    End If
                                        '次の作業要求
    
    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
    Select Case sts
        Case BtNoErr
        '   -------------------------------- エラーメッセージ作成
        Case Else
        '重要な要因なので未登録はシステム停止とする
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
        Exit Function
    End Select
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
    If Sagyo_Send_Proc() Then
        Sendbuf = Text_Create_Proc()
        Exit Function
    End If
            
    Sendbuf = Text_Create_Proc()
    
    
    
    Zaitei_Out_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function Ido_In_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『移動入庫指定時のチェック＆更新処理』
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Ido_In_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        TO_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(TO_Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            
                            
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(TO_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2), "倉庫エラー", "", "")         '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2), "倉庫エラー", "", "")     '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Ido_In_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 混載チェック
                            If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                                If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                    StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")      '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")  '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Ido_In_Proc = False
                                    Exit Function
                                End If
                            End If
                            
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(TO_Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(TO_Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(TO_Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(TO_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    
                                    If Len(Trim(TO_Tanaban)) < 8 Then
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, TO_Tanaban, "棚番エラー", "", "")                                                                                                  '2017.09.22
                                    Else
                                        
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    End If
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Ido_In_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                                                
                                If Len(Trim(TO_Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, TO_Tanaban, "棚使用不可", "", "")                                                                                                  '2017.09.22
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                                End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Ido_In_Proc = False
                                Exit Function
                            End If
            
            
                            '------------------ From To 棚番チェック 2016.04.15
                            FROM_Tanaban = ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"
                            If FROM_Tanaban = TO_Tanaban Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "入庫棚と出庫棚が", "同じです。", "")        '2017.09.22
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "入庫棚と出庫棚が", "同じです。", "")    '2017.09.22
                                
                                If Len(Trim(TO_Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, TO_Tanaban, "入庫棚と出庫棚が", "同じです。", "")                                                                                                  '2017.09.22
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "入庫棚と出庫棚が", "同じです。", "")    '2017.09.22
                                End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_In_Proc = False
                                Exit Function
                            End If
            
            
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(TO_Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            TO_Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            
                                            If Len(Trim(TO_Tanaban)) < 8 Then
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, TO_Tanaban, "棚番エラー", "", "")                                                                                                  '2017.09.22
                                            Else
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            End If
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            Ido_In_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Ido_In_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
        
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                        'FROM 仮想棚番
            FROM_Tanaban = ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    'Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    
                    If Len(Trim(FROM_Tanaban)) < 8 Then
                        Call Err_Send_Proc("在庫使用中", FROM_Tanaban, Hinban, "", "")
                    Else
                        Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    End If
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    
                    
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_In_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                
                '有効桁数により棚番の編集を変える   '2017.09.23
                'Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                
                If Len(Trim(FROM_Tanaban)) < 8 Then
                    Call Err_Send_Proc("有効在庫無し", FROM_Tanaban, Hinban, "", "")
                Else
                    
                    Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                End If
                '有効桁数により棚番の編集を変える   '2017.09.23
                
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                Ido_In_Proc = False
                Exit Function
            End If
        
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = TO_Tanaban       '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
                                                        
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                        
                                                        
                                                        '商品化用倉庫区分をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>>>>   2017.09.22
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            '>>>>>>>>   2017.09.22
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            
            '有効桁数により棚番の編集を変える   '2017.09.23
'            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
'                            Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
'
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
'                            Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
                                                            
            If Len(Trim(TO_Tanaban)) < 8 Then
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, TO_Tanaban)
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, TO_Tanaban)
            Else
                
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                    Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
                                                            
            End If
            '有効桁数により棚番の編集を変える   '2017.09.23
                                                            
                                                            
                                                            
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
            '2010.12.07
'            Send_Text.Box_Type(2).Max_Size = "13"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
            '2010.12.07
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Ido_In_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Ido_In_Proc = False
                            Exit Function
                        End If
            
            
                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Ido_In_Proc = False
                            Exit Function
                        End If
                
                
                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            
                            If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Ido_In_Proc = False
                                Exit Function
                            
                            End If
                        Else
                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        
                            If MI_QTY > ID_KANRI_TBL(ING_No).Send_MI_QTY Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Ido_In_Proc = False
                                Exit Function
                            End If
                        End If
        
                        If i = M_Gyo - 1 Then       '最終行だったら
                            If SUMI_QTY = 0 And MI_QTY = 0 Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")    '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                Ido_In_Proc = False
                                Exit Function
                            End If
                        End If
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")       '2017.09.22
                    
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    If Len(Trim(ID_KANRI_TBL(ING_No).Tanaban)) < 8 Then
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Tanaban, "在庫数不足", "", "")   '2017.09.22
                    Else
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    End If
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Ido_In_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_In_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Ido_In_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Ido_In_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function Ido_Out_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『移動出庫指定時のチェック＆更新処理』
'
'       2012.03.25  frm より　移管
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Ido_Out_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(FROM_Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Ido_Out_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    
                                    
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    If Len(Trim(FROM_Tanaban)) < 8 Then
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, FROM_Tanaban, "棚番エラー", "", "")    '2017.09.22
                                    Else
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    End If
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    
                                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Ido_Out_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                                If Len(Trim(FROM_Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, FROM_Tanaban, "棚使用不可", "", "")    '2017.09.22
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                                End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Ido_Out_Proc = False
                                Exit Function
                            End If
            
                            '------------------ From To 棚番チェック 2016.04.15
                            TO_Tanaban = ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"
                            If FROM_Tanaban = TO_Tanaban Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "入庫棚と出庫棚が", "同じです。", "")        '2017.09.22
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                If Len(Trim(FROM_Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, FROM_Tanaban, "入庫棚と出庫棚が", "同じです。", "")    '2017.09.22
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "入庫棚と出庫棚が", "同じです。", "")    '2017.09.22
                                End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_Out_Proc = False
                                Exit Function
                            End If
            
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(TO_Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            FROM_Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            If Len(Trim(FROM_Tanaban)) < 8 Then
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, FROM_Tanaban, "棚番エラー", "", "")    '2017.09.22
                                            Else
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            End If
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            Ido_Out_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Ido_Out_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                        'FROM 実棚番
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    'Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    If Len(Trim(FROM_Tanaban)) < 8 Then
                    
                        Call Err_Send_Proc("在庫使用中", FROM_Tanaban, Hinban, "", "")
                    Else
                    
                        Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    End If
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                '有効桁数により棚番の編集を変える   '2017.09.23
                'Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                If Len(Trim(FROM_Tanaban)) < 8 Then
                    Call Err_Send_Proc("有効在庫無し", FROM_Tanaban, Hinban, "", "")
                Else
                    Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                End If
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                Ido_Out_Proc = False
                Exit Function
            End If
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban     '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品の数量
                                                            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                            
                                                            
                                                            
                                                            '商品化用倉庫区分をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>>>>>>>>>> 2017.09.22
            'Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            '>>>>>>>>>>>>>> 2017.09.22
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            
            
            '有効桁数により棚番の編集を変える   '2017.09.23
'            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
'                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))

'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
'                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
            If Len(Trim(FROM_Tanaban)) < 8 Then
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, FROM_Tanaban)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, FROM_Tanaban)
            Else
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                        Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                        Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
            End If
            '有効桁数により棚番の編集を変える   '2017.09.23
                                                            
                                                            
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                             '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                           '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
            '2010.12.07
'            Send_Text.Box_Type(2).Max_Size = "13"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
            '2010.12.07
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            
            
            '積水へだったらを追加   2011.06.15
            If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = WEL_SEK_IDO_SYUKO Then
            
            
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "#"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "#"))
                                                                '数値初期表示
                Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
            
            Else
                    
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
                                                                '数値初期表示
                Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            
            End If
            '積水へだったらを追加   2011.06.15
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            
            
            '積水へだったらを追加   2011.06.15
            If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = WEL_SEK_IDO_SYUKO Then
            
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "#"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "#"))
                                                                '数値初期表示
                Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
            
            
            
            Else
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
                                                                '数値初期表示
                Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
            End If
                                                            
            '積水へだったらを追加   2011.06.15
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Ido_Out_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Ido_Out_Proc = False
                            Exit Function
                        End If
            
            
                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Ido_Out_Proc = False
                            Exit Function
                        End If
                
                
                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Ido_Out_Proc = False
                                Exit Function
                            End If
                        Else
                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Ido_Out_Proc = False
                                Exit Function
                            End If
                        End If
        
                        If i = M_Gyo - 1 Then       '最終行だったら
                            If SUMI_QTY = 0 And MI_QTY = 0 Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")    '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                Ido_Out_Proc = False
                                Exit Function
                            End If
                        End If
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
        
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")       '2017.09.22
                    
                    
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    If Len(Trim(FROM_Tanaban)) < 8 Then
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Tanaban, ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                        Else
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    End If
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Ido_Out_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Ido_Out_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        '次の作業要求
            
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Ido_Out_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function S_SHOUHI_Out_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『資材消費指定時のチェック＆更新処理』
'   2007.10.02
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim FROM_Tanaban    As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim myPOS           As Integer

    S_SHOUHI_Out_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(FROM_Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    S_SHOUHI_Out_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    S_SHOUHI_Out_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                S_SHOUHI_Out_Proc = False
                                Exit Function
                            End If
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(FROM_Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            FROM_Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            S_SHOUHI_Out_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                S_SHOUHI_Out_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                        'FROM 実棚番
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    S_SHOUHI_Out_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                S_SHOUHI_Out_Proc = False
                Exit Function
            End If
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban     '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品の数量
                                                            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                            
                                                            
                                                            
                                                            '商品化用倉庫区分をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>>>>>>>>   2017.09.22
            'Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            '>>>>>>>>>>>>   2017.09.22
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                             '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                           '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
            '2010.12.07
'            Send_Text.Box_Type(2).Max_Size = "13"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
            '2010.12.07
                                                                                
                                                                                
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & ":" & Format(SUMI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & ":" & Format(SUMI_QTY, "#0"))
                                                            '数値初期表示
            
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
            
            
'            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & ":" & Format(MI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & ":" & Format(MI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                    
                            
                myPOS = InStr(1, StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), ":") - 1
                            
                                    
                If myPOS < 0 Then
                Else
                    Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), myPOS))
                
                
                        Case LCD_Suryo          '数量（ここは無い）
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                S_SHOUHI_Out_Proc = False
                                Exit Function
                            End If
                    
                            QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If QTY = 0 Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                S_SHOUHI_Out_Proc = False
                                Exit Function
                            End If
                
                
                        Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                    
                           If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                S_SHOUHI_Out_Proc = False
                                Exit Function
                            End If
                    
                    
                            If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                                SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                                If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                    S_SHOUHI_Out_Proc = False
                                    Exit Function
                                End If
                            Else
                                MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                                If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                    S_SHOUHI_Out_Proc = False
                                    Exit Function
                                End If
                            End If
            
                            If i = M_Gyo - 1 Then       '最終行だったら
                                If SUMI_QTY = 0 And MI_QTY = 0 Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                    S_SHOUHI_Out_Proc = False
                                    Exit Function
                                End If
                            End If
                    End Select
                End If
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
        
                                                '出庫更新
            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, , , , , , , MENU_NO)
    
    
    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    S_SHOUHI_Out_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2107.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    S_SHOUHI_Out_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    S_SHOUHI_Out_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        '次の作業要求
            
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    S_SHOUHI_Out_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Public Function S_SHOUHI_Out2_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『資材消費(新)指定時のチェック＆更新処理』
'   2015.02.21
'
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim FROM_Tanaban    As String * 8

Dim Hinban          As String * 20

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim myPOS           As Integer

Dim wkORDER_QTY     As Long     '2019.03.15
Dim wkUKEIRE_QTY    As Long     '2019.03.15
Dim wkMAEGARI_QTY   As Long     '2019.04.04


    S_SHOUHI_Out2_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(FROM_Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    S_SHOUHI_Out2_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    S_SHOUHI_Out2_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")    '2107.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                S_SHOUHI_Out2_Proc = False
                                Exit Function
                            End If
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(FROM_Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            FROM_Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            S_SHOUHI_Out2_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                S_SHOUHI_Out2_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                        'FROM 実棚番
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    S_SHOUHI_Out2_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                S_SHOUHI_Out2_Proc = False
                Exit Function
            End If
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban     '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品の数量
                                                            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                            
                                                            
                                                            
                                                            '商品化用倉庫区分をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
                                                            '補充点（危険在庫）
            ID_KANRI_TBL(ING_No).HOJYU_P = Val(StrConv(ITEMREC.HOJYU_P, vbUnicode))
            
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>> 2017.09.22
            'Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            '>>>>>> 2017.09.22
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                             '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                           '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
            '2010.12.07
'            Send_Text.Box_Type(2).Max_Size = "13"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
            '2010.12.07
                                                                                
                                                                                
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & ":" & Format(SUMI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & ":" & Format(SUMI_QTY, "#0"))
                                                            '数値初期表示
            
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
            
            
'            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & ":" & Format(MI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & ":" & Format(MI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                    
                            
                myPOS = InStr(1, StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), ":") - 1
                            
                                    
                If myPOS < 0 Then
                Else
                    Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), myPOS))
                
                
                        Case LCD_Suryo          '数量（ここは無い）
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                S_SHOUHI_Out2_Proc = False
                                Exit Function
                            End If
                    
                            QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If QTY = 0 Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                S_SHOUHI_Out2_Proc = False
                                Exit Function
                            End If
                
                
                        Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                    
                           If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2107.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                S_SHOUHI_Out2_Proc = False
                                Exit Function
                            End If
                    
                    
                            If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                                SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                                If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                    S_SHOUHI_Out2_Proc = False
                                    Exit Function
                                End If
                            Else
                                MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                                If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                    S_SHOUHI_Out2_Proc = False
                                    Exit Function
                                End If
                            End If
            
                            If i = M_Gyo - 1 Then       '最終行だったら
                                If SUMI_QTY = 0 And MI_QTY = 0 Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                    S_SHOUHI_Out2_Proc = False
                                    Exit Function
                                End If
                            End If
                    End Select
                End If
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
        
                                                '出庫更新
            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, , , , , , , MENU_NO)
    
    
    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    S_SHOUHI_Out2_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    S_SHOUHI_Out2_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    S_SHOUHI_Out2_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
            '---------------------------------- 在庫チェック
            
            If ID_KANRI_TBL(ING_No).HOJYU_P <> 0 Then
            
                If Zaiko_Syukei_Proc(SUMI_QTY, _
                                    MI_QTY, _
                                    ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban) Then
                                    
            
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            
                End If
            
                If ID_KANRI_TBL(ING_No).HOJYU_P <= (SUMI_QTY + MI_QTY) Then
                
                                        
                                        '次の作業要求
                    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                    Select Case sts
                        Case BtNoErr
                        '   -------------------------------- エラーメッセージ作成
                        Case Else
                        '重要な要因なので未登録はシステム停止とする
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                        Exit Function
                    End Select
                    
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                    If Sagyo_Send_Proc() Then
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    End If
                    
                    Sendbuf = Text_Create_Proc()
    
    
                Else
                    
                    
                    
                    
'>>>>>>>>>>>>>>>>   2019.03.15 注文済み数　集計
                    If ORDER_SYUKEI_PROC(wkORDER_QTY, _
                                        wkUKEIRE_QTY, _
                                        wkMAEGARI_QTY, _
                                        ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban) Then
    
    
    
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
    
    
                    End If


                    If ID_KANRI_TBL(ING_No).HOJYU_P <= (SUMI_QTY + MI_QTY) + (wkORDER_QTY - wkMAEGARI_QTY - wkUKEIRE_QTY) Then
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '警告メッセージを作成する
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　二重警告音
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
        
                
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Trim(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Trim(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME))
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
        
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
        
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "残在庫:" & Format(SUMI_QTY + MI_QTY))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "残在庫:" & Format(SUMI_QTY + MI_QTY))
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
        
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "危険在庫:" & Format(ID_KANRI_TBL(ING_No).HOJYU_P))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "危険在庫:" & Format(ID_KANRI_TBL(ING_No).HOJYU_P))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
        
        
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "注文残:" & Format((wkORDER_QTY - wkMAEGARI_QTY - wkUKEIRE_QTY)))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "注文残:" & Format((wkORDER_QTY - wkUKEIRE_QTY)))
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
                        Sendbuf = Text_Create_Proc()





'>>>>>>>>>>>>>>>>   2019.03.15 注文済み数　集計
                    Else
                    
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '警告メッセージを作成する
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DOUBLE                        'ブザー音　二重警告音
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
        
                
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "発注して下さい")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "発注して下さい")
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
        
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
        
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "残在庫:" & Format(SUMI_QTY + MI_QTY))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "残在庫:" & Format(SUMI_QTY + MI_QTY))
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
        
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "危険在庫:" & Format(ID_KANRI_TBL(ING_No).HOJYU_P))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "危険在庫:" & Format(ID_KANRI_TBL(ING_No).HOJYU_P))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
        
        
                        '-----------------------------------------------５行目
                                                                        'BOX属性
'>>>>                   2019.03.28
'                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
'                        Send_Text.Box_Type(4).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        
                                                                        '初期カーソル位置
'                        Send_Text.Box_Type(4).Start_Pos = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
'                        Send_Text.Box_Type(4).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
'                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
        
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "注文残:" & Format((wkORDER_QTY - wkMAEGARI_QTY - wkUKEIRE_QTY)))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "注文残:" & Format((wkORDER_QTY - wkMAEGARI_QTY - wkUKEIRE_QTY)))
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
'>>>>                   2019.03.28
        
        
        
        
                        Sendbuf = Text_Create_Proc()
                    
                    End If                                  '2019.03.15
    
                End If
            Else
            
                                    '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                    Case BtNoErr
                    '   -------------------------------- エラーメッセージ作成
                    Case Else
                    '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                If Sagyo_Send_Proc() Then
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                End If
                
                Sendbuf = Text_Create_Proc()
            
            
            End If
    
        Case Step_Sagyo3_RES        '３回目の受信（在庫数確認）
    
                                '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    S_SHOUHI_Out2_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Public Function Tanaorosi_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『棚卸照会処理』
'
'
'       2012.03.25  frm より　移管

'-------------------------------------------------------
Dim sts             As Integer
Dim i               As Integer
Dim Hinban          As String
Dim Tanaban         As String
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long

Dim Sumi_ED         As String
Dim Mi_ED           As String
Dim Total_ED        As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2   '2008.08.08


    Tanaorosi_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            
            Case LCD_Tanaban        '棚番
                
                Tanaban = Trim(Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1))
                
                
            Case LCD_Hinban         '品番
                
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
        
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                    
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Tanaorosi_Proc = False
                        Exit Function
                    
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                
                End Select
        
        End Select
    Next i
    
    sts = Zaiko_Syukei_Proc(SUMI_QTY, _
                            MI_QTY, _
                            ID_KANRI_TBL(ING_No).JGYOBU, _
                            ID_KANRI_TBL(ING_No).NAIGAI, _
                            Hinban, _
                            Tanaban)
    If sts Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Exit Function
    End If
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
    Send_Text.FileName = ""                                 '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１行目
                                                        'BOX属性
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                        '表示内容
    
    '>>>>>>>    2017.09.22
'    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                        
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    '>>>>>>>    2017.09.22
                                                        
                                                        
                                                        
                                                        '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                        '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                        '入力桁数
    Send_Text.Box_Type(0).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
    Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    '-----------------------------------------------２行目
                                                            'BOX属性
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
    '2010.12.07
'    Send_Text.Box_Type(1).Max_Size = "13"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "13"
    Send_Text.Box_Type(1).Max_Size = "20"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "20"
    '2010.12.07
                                                                                
    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    '-----------------------------------------------３行目
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "05"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "05"
                                                                                
    Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    '-----------------------------------------------４行目
                                                             'BOX属性
    Send_Text.Box_Type(3).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "商 品/未 品/合 計")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "商 品/未 品/合 計")
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = "05"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
    Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
       
    '-----------------------------------------------５行目
                                                             'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    Sumi_ED = Space(5 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0") & "/"
    Mi_ED = Space(5 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0") & "/"
    Total_ED = Space(5 - Len(Format(SUMI_QTY + MI_QTY, "#0"))) & Format(SUMI_QTY + MI_QTY, "#0")
    
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Sumi_ED & Mi_ED & Total_ED)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Sumi_ED & Mi_ED & Total_ED)
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = "05"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
    Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
    
    Sendbuf = Text_Create_Proc()
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Tanaorosi_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    Tanaorosi_Proc = False
    

End Function
Public Function Zaiko_Reserve_Proc(ID_NO As Integer, _
                                    FROM_LOCATION As String, _
                                    JGYOBU As String, _
                                    NAIGAI As String, _
                                    Hinban As String, _
                                    SUMI_QTY As Long, _
                                    MI_QTY As Long) As Integer
'-------------------------------------------------------
'
'   『在庫データの使用予約』
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

    Zaiko_Reserve_Proc = True
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, ZAIKO_POS, ZAIKOREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Zaiko_Reserve_Proc = SYS_ERR
        Exit Function
    End If

    sts = Zaiko_Lock_Proc(FROM_LOCATION, JGYOBU, NAIGAI, Hinban, Format(ID_NO, "000"), SUMI_QTY, MI_QTY, FILE_RETRY)
    If sts Then
        Zaiko_Reserve_Proc = sts
        GoTo Abort_Tran
    End If
End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        Zaiko_Reserve_Proc = SYS_ERR
        GoTo Abort_Tran
    End If
    
    Zaiko_Reserve_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function St_Tanaban_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『標準棚番設定処理』
'
'
'       2012.03.25  frm より　移管
'
'   2016.12.26
'
'-------------------------------------------------------
Dim sts         As Integer
Dim i           As Integer
Dim Hinban      As String
'Dim Tanaban     As String          '2017.09.21
Dim Tanaban     As String * 8       '2017.09.21

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2   '2008.08.08



    St_Tanaban_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                St_Tanaban_Proc = False
                                Exit Function
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
                        ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
                                                                        '標準棚番をセーブ
                        ID_KANRI_TBL(ING_No).ST_TANABAN = StrConv(ITEMREC.ST_SOKO, vbUnicode) & _
                                                            StrConv(ITEMREC.ST_RETU, vbUnicode) & _
                                                            StrConv(ITEMREC.ST_REN, vbUnicode) & _
                                                            StrConv(ITEMREC.ST_DAN, vbUnicode)
                                                        
                                                        
                                                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                        
                                                        
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).ST_TANABAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).ST_TANABAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_ST_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_ST_Tanaban)
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "12"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                    
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
    '---------------------------------------------------------------
    
        Case Step_Sagyo2_RES        '２回目の受信（標準棚番）
    
            For i = 0 To M_Gyo - 1
                Select Case i
            
                    Case 3          '標準棚番
                        Tanaban = Trim(Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1))
                                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                        
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                St_Tanaban_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                            
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成

                                '>>>>>>>>>>>>>  2017.09.21
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                                
                                If Len(Trim(Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                                End If
                                '>>>>>>>>>>>>>  2017.09.21
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                St_Tanaban_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                            End Select
            
                        '------------------ 混載チェック
                        If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                            If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).RET_JGYOBU Or _
                                StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).RET_NAIGAI Then
                                
                                '>>>>>>>>>>>>>> 2017.09.21
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                
                                If Len(Trim(Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                End If
                                '>>>>>>>>>>>>>> 2017.09.21
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                St_Tanaban_Proc = False
                                Exit Function
                            End If
                        End If
    
    
    
                    '----------------------------------- データ更新処理開始 -----------
                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).S_JGYOBU)
                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).S_NAIGAI)
                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).Hinban)
                    
                    Do
                        '------------------ 品目マスタ読込み
                        sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品番エラー", "未登録です。", "")
                                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                St_Tanaban_Proc = False
                                Exit Function
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品目マスタ", "他端末で使用中", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品目マスタ", "他端末で使用中", "")   '2017.09.22
                                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                
                                St_Tanaban_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                    Loop
                                                        '標準棚番設定
                    Call UniCode_Conv(ITEMREC.ST_SOKO, Left(Tanaban, 2))
                    Call UniCode_Conv(ITEMREC.ST_RETU, Mid(Tanaban, 3, 2))
                    Call UniCode_Conv(ITEMREC.ST_REN, Mid(Tanaban, 5, 2))
                    Call UniCode_Conv(ITEMREC.ST_DAN, Right(Tanaban, 2))
                    Call UniCode_Conv(ITEMREC.ST_SET_DT, Format(Now, "YYYYMMDD"))
                                                        
                    Do
                        '------------------ 品目マスタ更新
                        sts = BTRV(BtOpUpdate, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品目マスタ", "他端末で使用中", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品目マスタ", "他端末で使用中", "")   '2017.09.22
                                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                
                                St_Tanaban_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpUpdate, "品目マスタ", 0)
                                Exit Function
                        End Select
                    Loop
                                                        
                                                        
                                                        
                                                        
                    '作業ﾛｸﾞ出力    2008.08.08
                    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                
                    Else
                                
                        MENU_NO = ""
                    End If
                    If Trim(MENU_NO) = "" Then
                    Else
                    '作業ﾛｸﾞ出力
                        
                        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                            ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                            ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                            MENU_NO, _
                                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                            ID_KANRI_TBL(ING_No).Hinban, , , ID_KANRI_TBL(ING_No).ST_TANABAN, Tanaban) Then
                            St_Tanaban_Proc = SYS_ERR
                            Exit Function
                        End If
                    End If
                    '作業ﾛｸﾞ出力    2008.08.08
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        '次の作業要求
                    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                    Select Case sts
                        Case BtNoErr
                        '   -------------------------------- エラーメッセージ作成
                        Case Else
                        '重要な要因なので未登録はシステム停止とする
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                        Exit Function
                    End Select
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                    If Sagyo_Send_Proc() Then
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    End If
                            
                    Sendbuf = Text_Create_Proc()
    
    
    
    
    
                End Select
            Next i
    End Select
    
    
    
    St_Tanaban_Proc = False
    

End Function
Public Function OLD_St_Tanaban_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『標準棚番設定処理』
'
'
'       2012.03.25  frm より　移管
'
'   2016.12.26
'
'-------------------------------------------------------
Dim sts         As Integer
Dim i           As Integer
Dim Hinban      As String
Dim Tanaban     As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2   '2008.08.08



    OLD_St_Tanaban_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            
            Case LCD_Tanaban        '棚番
                Tanaban = Trim(Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1))
                                '------------------ 倉庫マスタ読込み
                Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                        OLD_St_Tanaban_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                        Exit Function
                End Select
                    
                '------------------ 混載チェック    2006.01.06 品番ﾁｪｯｸ後に移動↓
'                If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
'                    If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
'                        StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
'                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
'                        Sendbuf = Text_Create_Proc()
'                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                        St_Tanaban_Proc = False
'                        Exit Function
'                    End If
'                End If
                '------------------ 棚マスタ読込み
                Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                    '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        OLD_St_Tanaban_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                        Exit Function
                    End Select
   
            Case LCD_Hinban         '品番
                
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                '------------------ 品目マスタ読込み
'                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                    '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        OLD_St_Tanaban_Proc = False
                        Exit Function
                    
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
        
        
                '------------------ 混載チェック
                If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                    If StrConv(SOKOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                        StrConv(SOKOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Then
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")  '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        OLD_St_Tanaban_Proc = False
                        Exit Function
                    End If
                End If
        
        
        
        End Select
    Next i
    '----------------------------------- データ更新処理開始 -----------
    Call UniCode_Conv(K0_ITEM.JGYOBU, RET_JGYOBU)
    Call UniCode_Conv(K0_ITEM.NAIGAI, RET_NAIGAI)
    Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
    
    Do
        '------------------ 品目マスタ読込み
        sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrKeyNotFound
            '   -------------------------------- エラーメッセージ作成
                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                OLD_St_Tanaban_Proc = False
                Exit Function
            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
            '   -------------------------------- エラーメッセージ作成
                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")      '2017.09.22
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "他端末で使用中", "", "")  '2017.09.22
                        
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                OLD_St_Tanaban_Proc = False
                Exit Function
            Case Else
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                Exit Function
        End Select
    
    Loop
                                        '標準棚番設定
    Call UniCode_Conv(ITEMREC.ST_SOKO, Left(Tanaban, 2))
    Call UniCode_Conv(ITEMREC.ST_RETU, Mid(Tanaban, 3, 2))
    Call UniCode_Conv(ITEMREC.ST_REN, Mid(Tanaban, 5, 2))
    Call UniCode_Conv(ITEMREC.ST_DAN, Right(Tanaban, 2))
    Call UniCode_Conv(ITEMREC.ST_SET_DT, Format(Now, "YYYYMMDD"))
                                        
    Do
        '------------------ 品目マスタ更新
        sts = BTRV(BtOpUpdate, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
            '   -------------------------------- エラーメッセージ作成
                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")      '2017.09.22
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "他端末で使用中", "", "")  '2017.09.22
                    
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                OLD_St_Tanaban_Proc = False
                Exit Function
            Case Else
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpUpdate, "品目マスタ", 0)
                Exit Function
        End Select
    Loop
                                        
                                        
                                        
                                        
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            OLD_St_Tanaban_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
                                        
                                        
                                        
                                        
                                        
                                        '次の作業要求
    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
    Select Case sts
        Case BtNoErr
        '   -------------------------------- エラーメッセージ作成
        Case Else
        '重要な要因なので未登録はシステム停止とする
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
        Exit Function
    End Select
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
    If Sagyo_Send_Proc() Then
        Sendbuf = Text_Create_Proc()
        Exit Function
    End If
            
    Sendbuf = Text_Create_Proc()
    
    
    
    OLD_St_Tanaban_Proc = False
    

End Function


Public Function Data_Clear_Proc(Mode As Integer, Sendbuf As String) As Integer
'-------------------------------------------------------
'
'   『出荷予定／在庫の予約キャンセル』
'   入荷予定のｸﾘｱｰ追加      2007.06.07
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim RETRY_CNT   As Integer
    
    
    Data_Clear_Proc = True
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Data_Clear_Proc = SYS_ERR
        Exit Function
    End If
    
    If Mode = 0 Then
                                        '出荷予約の開放
        Call UniCode_Conv(K4_Y_SYU.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
        Call UniCode_Conv(K4_Y_SYU.PRG_ID, StrConv(App.EXEName, vbUpperCase))
        com = BtOpGetGreaterEqual
    Else
        Call UniCode_Conv(K4_Y_SYU.WEL_ID, "")
        Call UniCode_Conv(K4_Y_SYU.PRG_ID, "")
        com = BtOpGetGreater
    End If

    Do
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        RETRY_CNT = 0
        Do
            sts = BTRV(com + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K4_Y_SYU, Len(K4_Y_SYU), 4)
            Select Case sts
                                
                Case BtNoErr
                    If Mode = 0 Then
                        If Format(ID_KANRI_TBL(ING_No).ID, "000") <> StrConv(Y_SYUREC.WEL_ID, vbUnicode) Or _
                             StrConv(App.EXEName, vbUpperCase) <> Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode)) Then
                        
                            sts = BTRV(BtOpUnlock, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K4_Y_SYU, Len(K4_Y_SYU), 4)
                            If sts Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                Data_Clear_Proc = SYS_ERR
                                GoTo Abort_Tran
                            End If
                        
                        
                            sts = BtErrEOF
                        
                        End If
                    End If
                    
                    Exit Do
                
                Case BtErrEOF
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call Err_Send_Proc("出荷使用中", "", "", "", "")
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Data_Clear_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                        
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                    Data_Clear_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        Loop
    
        If sts = BtErrEOF Then
            Exit Do
        End If
    
        
        RETRY_CNT = 0
        
        Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
        Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
        Do
        
            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K4_Y_SYU, Len(K4_Y_SYU), 4)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call Err_Send_Proc("出荷使用中", "", "", "", "")
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Data_Clear_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                        
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                    Data_Clear_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        
        Loop
    
        com = BtOpGetNext
    
    Loop


    If Mode = 0 Then
                                        '在庫の開放
        Call UniCode_Conv(K3_ZAIKO.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
        Call UniCode_Conv(K3_ZAIKO.PRG_ID, StrConv(App.EXEName, vbUpperCase))
        com = BtOpGetGreaterEqual
    Else
        Call UniCode_Conv(K3_ZAIKO.WEL_ID, "")
        Call UniCode_Conv(K3_ZAIKO.PRG_ID, "")
        com = BtOpGetGreater
    End If
    
    Do
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        
        RETRY_CNT = 0
        Do
            sts = BTRV(com + BtSNoWait, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K3_ZAIKO, Len(K3_ZAIKO), 3)
            Select Case sts
                Case BtNoErr
                    
                    If Mode = 0 Then
                        If Format(ID_KANRI_TBL(ING_No).ID, "000") <> StrConv(ZAIKOREC.WEL_ID, vbUnicode) Or _
                             StrConv(App.EXEName, vbUpperCase) <> Trim(StrConv(ZAIKOREC.PRG_ID, vbUnicode)) Then
                            sts = BtErrEOF
                        
                        
                            sts = BTRV(BtOpUnlock, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K3_ZAIKO, Len(K3_ZAIKO), 3)
                            If sts Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "在庫データ", 0)
                                Data_Clear_Proc = SYS_ERR
                                GoTo Abort_Tran
                            End If
                        
                        
                        End If
                    End If
                    Exit Do
                Case BtErrEOF
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call Err_Send_Proc("在庫使用中", "", "", "", "")
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "在庫データ", 0)
                        Data_Clear_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                        
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "在庫データ", 0)
                    Data_Clear_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        Loop
    
        If sts = BtErrEOF Then
            Exit Do
        End If
    
        
        RETRY_CNT = 0
        
        Call UniCode_Conv(ZAIKOREC.WEL_ID, "")
        Call UniCode_Conv(ZAIKOREC.PRG_ID, "")
        Call UniCode_Conv(ZAIKOREC.LOCK_F, LOCK_OFF)
        Do
        
            sts = BTRV(BtOpUpdate, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K3_ZAIKO, Len(K3_ZAIKO), 3)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call Err_Send_Proc("在庫使用中", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "在庫データ", 0)
                        Data_Clear_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                        
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "在庫データ", 0)
                    Data_Clear_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        
        Loop
    
        com = BtOpGetNext
    
    Loop



    '---------------------  入荷予定の開放
    If Mode = 0 Then
                                        '入荷予約の開放
        Call UniCode_Conv(K2_Y_NYU_O.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
        Call UniCode_Conv(K2_Y_NYU_O.PRG_ID, StrConv(App.EXEName, vbUpperCase))
        com = BtOpGetGreaterEqual
    Else
        Call UniCode_Conv(K2_Y_NYU_O.WEL_ID, "")
        Call UniCode_Conv(K2_Y_NYU_O.PRG_ID, "")
        com = BtOpGetGreater
    End If

    Do
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        RETRY_CNT = 0
        Do
            sts = BTRV(com + BtSNoWait, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K2_Y_NYU_O, Len(K2_Y_NYU_O), 2)
            Select Case sts
                                
                Case BtNoErr
                    If Mode = 0 Then
                        If Format(ID_KANRI_TBL(ING_No).ID, "000") <> StrConv(Y_NYU_O_REC.WEL_ID, vbUnicode) Or _
                             StrConv(App.EXEName, vbUpperCase) <> Trim(StrConv(Y_NYU_O_REC.PRG_ID, vbUnicode)) Then
                            sts = BtErrEOF
                        
                            sts = BTRV(BtOpUnlock, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K2_Y_NYU_O, Len(K2_Y_NYU_O), 2)
                            If sts Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "入荷予定", 0)
                                Data_Clear_Proc = SYS_ERR
                                GoTo Abort_Tran
                            End If
                        
                        End If
                    End If
                    
                    Exit Do
                
                Case BtErrEOF
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call Err_Send_Proc("入荷使用中", "", "", "", "")
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "入荷予定", 0)
                        Data_Clear_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                        
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "入荷予定", 0)
                    Data_Clear_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        Loop
    
        If sts = BtErrEOF Then
            Exit Do
        End If
    
        
        RETRY_CNT = 0
        
        Call UniCode_Conv(Y_NYU_O_REC.WEL_ID, "")
        Call UniCode_Conv(Y_NYU_O_REC.PRG_ID, "")
        Do
        
            sts = BTRV(BtOpUpdate, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K2_Y_NYU_O, Len(K2_Y_NYU_O), 2)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call Err_Send_Proc("入荷使用中", "", "", "", "")
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "入荷予定", 0)
                        Data_Clear_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                        
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "入荷予定", 0)
                    Data_Clear_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        
        Loop
    
        com = BtOpGetNext
    
    Loop


End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        Data_Clear_Proc = SYS_ERR
        GoTo Abort_Tran
    End If
    
    Data_Clear_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Public Function Ave_Syuka_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『月平均出荷数表示処理』
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer

Dim Hinban          As String * 20
Dim Tanaban         As String * 8

Dim AVE_SYUKA_ED    As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2   '2008.08.08

Dim MSG             As String       '2009.03.14

    Ave_Syuka_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                
                
                
    
    
                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))  'ID№
                
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                    
                        Hinban = StrConv(Y_SYUREC.HIN_NO, vbUnicode)
                    
                    Case BtErrKeyNotFound
                    
                    
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                    
                    
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                End Select
                
                
                
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Ave_Syuka_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
                                '月平均出荷数読み込み
''''''''''''''''2006.01.06 資材に対応
'                Call UniCode_Conv(K0_AVE_SYUKA.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_AVE_SYUKA.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                Call UniCode_Conv(K0_AVE_SYUKA.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K0_AVE_SYUKA.NAIGAI, RET_NAIGAI)
''''''''''''''''2006.01.06 資材に対応
                Call UniCode_Conv(K0_AVE_SYUKA.HIN_GAI, Hinban)
                sts = BTRV(BtOpGetEqual, AVE_SYUKA_POS, AVE_SYUKAREC, Len(AVE_SYUKAREC), K0_AVE_SYUKA, Len(K0_AVE_SYUKA), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                        Call UniCode_Conv(AVE_SYUKAREC.AVE_SYUKA, "00000000")
                        Call UniCode_Conv(AVE_SYUKAREC.TOTAL_AVE_CNT, "00000000")
                    
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "月平均出荷数", 0)
                        Exit Function
                End Select
        
        End Select
    Next i
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = ""
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１行目
                                                            'BOX属性
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    '>>>>>>>>>  2017.09.22
'    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
    
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    
    '>>>>>>>>>  2017.09.22
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(0).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                            'メニュ―番号
    Send_Text.Box_Type(0).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    
    '-----------------------------------------------２行目
                                                            'BOX属性
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    '2011.07.05
'    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)
'    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(Hinban, 15) & Format(TUKI1, "#0") & "ｶ月")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban & Format(TUKI1, "#0") & "ｶ月")
    '2011.07.05
                                                            
                                                            
                                                            
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
    '2010.12.07
'    Send_Text.Box_Type(1).Max_Size = "13"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "13"
    Send_Text.Box_Type(1).Max_Size = "20"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "20"
    '2010.12.07
                                                            'メニュ―番号
    Send_Text.Box_Type(1).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    '-----------------------------------------------３行目
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            
'2011.07.05
'    AVE_SYUKA_ED = Format(CLng(StrConv(AVE_SYUKAREC.AVE_SYUKA, vbUnicode)), "#0")
    
    
    If Numeric_Check(EDIT_ONLY, 8, 1, 0, 1, 1, StrConv(AVE_SYUKAREC.AVE_SYUKA, vbUnicode), AVE_SYUKA_ED) Then
        AVE_SYUKA_ED = Format(0, "#0.0")
    End If
    
'    If IsNumeric(StrConv(AVE_SYUKAREC.AVE_SYUKA, vbUnicode)) Then
'        AVE_SYUKA_ED = Format(CDbl(StrConv(AVE_SYUKAREC.AVE_SYUKA, vbUnicode)), "#0.0")
'    Else
'        AVE_SYUKA_ED = Format(0, "#0.0")
'    End If
'2011.07.05
    
    AVE_SYUKA_ED = "[" & Space(8 - Len(AVE_SYUKA_ED)) & AVE_SYUKA_ED & "]"
                                                             
                                                            '表示内容
'2011.07.05
'    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "月平均:" & AVE_SYUKA_ED)
'    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "月平均:" & AVE_SYUKA_ED)
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "月平均数:" & AVE_SYUKA_ED)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "月平均:" & AVE_SYUKA_ED)
'2011.07.05
                                                            
                                                            
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "08"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "08"
                                                            'メニュ―番号
    Send_Text.Box_Type(2).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    
    
''''''''''''''''''''    2011.07.05
''    '-----------------------------------------------４行目      2008.10.08 ロット数表示を追加
''                                                            'BOX属性
''    Send_Text.Box_Type(3).Box_Type = TYPE_REF
''    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
''                                                            '表示内容
''
''    If IsNumeric(StrConv(ITEMREC.SEI_LOT, vbUnicode)) Then
''        AVE_SYUKA_ED = Format(CLng(StrConv(ITEMREC.SEI_LOT, vbUnicode)), "#0")
''    Else
''        AVE_SYUKA_ED = "0"
''    End If
''    AVE_SYUKA_ED = "[" & Space(8 - Len(AVE_SYUKA_ED)) & AVE_SYUKA_ED & "]"
''
''
''
''    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "ロット:" & AVE_SYUKA_ED)
''    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "ロット:" & AVE_SYUKA_ED)
''                                                            '数値初期表示
''    Send_Text.Box_Type(3).INIT = ""
''    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
''                                                            '初期カーソル位置
''    Send_Text.Box_Type(3).Start_Pos = "01"
''    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
''                                                            '入力桁数
''    Send_Text.Box_Type(3).Max_Size = "08"
''    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "08"
''                                                            'メニュ―番号
''    Send_Text.Box_Type(3).MENU = ""
''    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
''    '-----------------------------------------------５行目
''                                                            'BOX属性
''    Send_Text.Box_Type(4).Box_Type = TYPE_REF
''    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
''                                                            '表示内容
''
''    MSG = StrConv(ITEMREC.STAT, vbUnicode) & " "            '2009.03.14
''
''    Select Case StrConv(ITEMREC.STAT, vbUnicode)
''
''        Case "0"
''            MSG = MSG & "供給非対"
''
''        Case "1"
''            MSG = MSG & "供給対象"
''
''        Case "2"
''            MSG = MSG & "打切中　"
''
''        Case "3"
''            MSG = MSG & "打切　　"
''
''
''        Case "6"
''            MSG = MSG & "移管外　"
''
''        Case "7"
''            MSG = MSG & "移管対象"
''
''        Case "8"
''            MSG = MSG & "部分廃棄"
''
''        Case "9"
''            MSG = MSG & "全数廃棄"
''
''        Case Else
''            MSG = MSG & "　　　　"
''
''
''    End Select
''
''
''    MSG = MSG & " " & StrConv(ITEMREC.BIKOU_TANA, vbUnicode)
''
''
''    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, MSG)
''    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, MSG)
''                                                            '数値初期表示
''    Send_Text.Box_Type(4).INIT = ""
''    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
''                                                            '初期カーソル位置
''    Send_Text.Box_Type(4).Start_Pos = ""
''    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
''                                                            '入力桁数
''    Send_Text.Box_Type(4).Max_Size = "00"
''    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
''                                                            'メニュ―番号
''    Send_Text.Box_Type(4).MENU = ""
''    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        







    '-----------------------------------------------４行目
                                                            'BOX属性
    Send_Text.Box_Type(3).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            
                                                            
                                                            
    If Numeric_Check(EDIT_ONLY, 8, 1, 0, 1, 1, StrConv(AVE_SYUKAREC.TOTAL_AVE_CNT, vbUnicode), AVE_SYUKA_ED) Then
        AVE_SYUKA_ED = Format(0, "#0.0")
    End If
                                                            
                                                            
                                                            
'    If IsNumeric(StrConv(AVE_SYUKAREC.TOTAL_AVE_CNT, vbUnicode)) Then
'        AVE_SYUKA_ED = Format(CDbl(StrConv(AVE_SYUKAREC.TOTAL_AVE_CNT, vbUnicode)), "#0.0")
'    Else
'        AVE_SYUKA_ED = Format(0, "#0.0")
'    End If
    AVE_SYUKA_ED = "[" & Space(8 - Len(AVE_SYUKA_ED)) & AVE_SYUKA_ED & "]"
                                                             
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "月平均件:" & AVE_SYUKA_ED)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "月平件:" & AVE_SYUKA_ED)
                                                            
                                                            
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = "08"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "08"
                                                            'メニュ―番号
    Send_Text.Box_Type(3).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    '-----------------------------------------------５行目      2008.10.08 ロット数表示を追加
                                                            'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    
    
    If Numeric_Check(EDIT_ONLY, 8, 0, 0, 1, 1, StrConv(ITEMREC.SEI_LOT, vbUnicode), AVE_SYUKA_ED) Then
        AVE_SYUKA_ED = Format(0, "#0")
    End If
    
    
'    If IsNumeric(StrConv(ITEMREC.SEI_LOT, vbUnicode)) Then
'        AVE_SYUKA_ED = Format(CLng(StrConv(ITEMREC.SEI_LOT, vbUnicode)), "#0")
'    Else
'        AVE_SYUKA_ED = "0"
'    End If
    AVE_SYUKA_ED = "[" & Space(8 - Len(AVE_SYUKA_ED)) & AVE_SYUKA_ED & "]"
    
    
    
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "ロット  :" & AVE_SYUKA_ED)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "ロット 　:" & AVE_SYUKA_ED)
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = "08"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "08"
                                                            'メニュ―番号
    Send_Text.Box_Type(4).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

''''''''''''''''''''    2011.07.05

    Sendbuf = Text_Create_Proc()
    
    
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Ave_Syuka_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    
    
    Ave_Syuka_Proc = False
    

End Function
Public Function Host_Zaiko_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『ホスト在庫（理論在庫）照会処理』
'
'       2012.03.25  frm より　移管
'-------------------------------------------------------
Dim sts             As Integer
Dim i               As Integer
Dim Hinban          As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1
    
Dim MENU_NO         As String * 2   '2008.08.08
    
    Host_Zaiko_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                    
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Host_Zaiko_Proc = False
                        Exit Function
                    
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                
                End Select
                '------------------ 在庫集計データ読込み
'2008.07.24                Call UniCode_Conv(K0_SUMZ.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'2008.07.24                Call UniCode_Conv(K0_SUMZ.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                
                Call UniCode_Conv(K0_SUMZ.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K0_SUMZ.NAIGAI, RET_NAIGAI)
                
                
                
                Call UniCode_Conv(K0_SUMZ.HIN_GAI, Hinban)
                sts = BTRV(BtOpGetEqual, SUMZ_POS, SUMZREC, Len(SUMZREC), K0_SUMZ, Len(K0_SUMZ), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                        Call UniCode_Conv(SUMZREC.HS_ZAIQTY, "00000000")
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "在庫集計データ", 0)
                        Exit Function
                End Select
            
        
        End Select
    Next i
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
    Send_Text.FileName = ""                                 '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    
    '-----------------------------------------------１行目
                                                    'BOX属性
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                    '表示内容
    '>>>>>> 2017.09.22
'    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                    
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    '>>>>>> 2017.09.22
                                                    
                                                    '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                    
                                                    '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                    '入力桁数
    Send_Text.Box_Type(0).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
    Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    
    
    '-----------------------------------------------２行目
                                                            'BOX属性
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
    '2010.12.07
'    Send_Text.Box_Type(1).Max_Size = "13"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "13"
    Send_Text.Box_Type(1).Max_Size = "20"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "20"
    '2010.12.07
                                                                                
    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    '-----------------------------------------------３行目
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "ホスト在庫:" & Format(CLng(StrConv(SUMZREC.HS_ZAIQTY, vbUnicode)), "#0"))
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "ホスト在庫:" & Format(CLng(StrConv(SUMZREC.HS_ZAIQTY, vbUnicode)), "#0"))
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "05"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "05"
                                                                                
    Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    '-----------------------------------------------４行目
                                                             'BOX属性
    Send_Text.Box_Type(3).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = "05"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
    Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
       
    '-----------------------------------------------５行目
                                                             'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = "05"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
    Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
    
    Sendbuf = Text_Create_Proc()
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Host_Zaiko_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    Host_Zaiko_Proc = False
    

End Function
Public Function LSBU_IKAN_BinNo_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『LSBU 移管便№処理』
'       2009.03.11
'
'
'       2012.03.25  frm より　移管
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 11
Dim Hinban          As String * 20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07


Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1


Dim i               As Integer

Dim MENU_NO         As String * 2

Dim Tanaban_Name    As String


Dim LSBU_BinNo      As String * 5


    LSBU_IKAN_BinNo_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        
        
        
        Case Step_Sagyo1_RES        '１回目の受信 (便№)
            For i = 0 To M_Gyo - 1
            
            
            
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case "ﾄﾗｯｸ便"  'ﾄﾗｯｸ便
            
            
            
            
            
                        ID_KANRI_TBL(ING_No).LSBU_BinNo = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))

                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>>   2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '>>>>>>>>   2017.09.22
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "ﾄﾗｯｸ便:" & ID_KANRI_TBL(ING_No).LSBU_BinNo)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "ﾄﾗｯｸ便:" & ID_KANRI_TBL(ING_No).LSBU_BinNo)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "13"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
            
            
            
            
            
            
            
            
            
            
                End Select
            
            
            
            
            Next i
        
        
        
        
        
        
        
        
        
        
        
        
        Case Step_Sagyo2_RES        '２回目の受信 (伝票ＩＤ)
            For i = 0 To M_Gyo - 1
                
                Select Case i
                    Case 2      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "移管処理不可", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "移管処理不可", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LSBU_IKAN_BinNo_Proc = False
                            Exit Function
                        End If
    
    
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "") '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    LSBU_IKAN_BinNo_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")   '2017.09.22
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                LSBU_IKAN_BinNo_Proc = False
                                Exit Function
                        End Select
                
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        
                        
'                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
'
'
'
'                        '-----------------------------------------------ヘッダー
'                        Send_Text.sts = Sts_OK                                  'ステータス　OK
'                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
'
'                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
'                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
'
'                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
'                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
'
'                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
'                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
'
'                        Send_Text.fileName = ""                                 '送信データファイル名
'                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
'
'                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
'                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
'
'                        '-----------------------------------------------１行目
'                                                                                'BOX属性
'                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(0).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(0).Start_Pos = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(0).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
'                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
'
'
'
'                        '-----------------------------------------------２行目
'                                                                                'BOX属性
'                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "ﾄﾗｯｸ便:" & ID_KANRI_TBL(ING_No).LSBU_BinNo)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "ﾄﾗｯｸ便:" & ID_KANRI_TBL(ING_No).LSBU_BinNo)
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(1).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(1).Start_Pos = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(1).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
'
'                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
'
'
'
'
'                        '-----------------------------------------------３行目
'                                                                                'BOX属性
'                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(2).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(2).Start_Pos = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(2).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'
'                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
'                        '-----------------------------------------------４行目
'                                                                                'BOX属性
'                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "品番:" & Trim(Hinban))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "品番:" & Trim(Hinban))
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(3).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(3).Start_Pos = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
'
'                        Send_Text.Box_Type(3).Max_Size = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
'
'
'
'                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
'                        '-----------------------------------------------５行目
'                                                                                'BOX属性
'                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(4).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                                                                                '入力桁数
'                         Send_Text.Box_Type(4).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'
'                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""'
'
'                        Sendbuf = Text_Create_Proc()
'
'                End Select
'            Next i
'
'
'
'
'        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
            
            '----------------------------------- データ更新処理開始 -----------
                                                'トランザクション開始
                sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                If sts <> BtNoErr Then
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                    Exit Function
                End If
                                                '出荷予定の読み込み
                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'ID№
        
                Do
                
                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrKeyNotFound
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LSBU_IKAN_BinNo_Proc = False
                            GoTo Abort_Tran
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2107.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LSBU_IKAN_BinNo_Proc = False
                            GoTo Abort_Tran
                        Case Else
                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
            
                Loop
        
        
                Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                
                                                
                Call UniCode_Conv(Y_SYUREC.SS_CODE, ID_KANRI_TBL(ING_No).LSBU_BinNo)
                                                
                                                
                                                
                                                '出荷予定書込み
                Do
                    sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LSBU_IKAN_BinNo_Proc = False
                            GoTo Abort_Tran
                    
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                            LSBU_IKAN_BinNo_Proc = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                                            
                                            
                                            
                                            
                                            
                                                '品目マスタの読み込み
                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)      '事業部
                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)      '内外
                Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).Hinban)     '品目
        
                Do
                
                    sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrKeyNotFound
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品目マスタ不明", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品目マスタ不明", "", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LSBU_IKAN_BinNo_Proc = False
                            GoTo Abort_Tran
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "品目マスタ使用中", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "品目マスタ使用中", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LSBU_IKAN_BinNo_Proc = False
                            GoTo Abort_Tran
                        Case Else
                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目マスタ", 0)
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
            
                Loop
                                            
                                            
                Call UniCode_Conv(ITEMREC.BIKOU_TANA, ID_KANRI_TBL(ING_No).LSBU_BinNo)
                                            
                                            
                                            
                                            
                Do
                    sts = BTRV(BtOpUpdate, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "品目マスタ使用中", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "品目マスタ使用中", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LSBU_IKAN_BinNo_Proc = False
                            GoTo Abort_Tran
                    
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "品目マスタ", 0)
                            LSBU_IKAN_BinNo_Proc = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                                            
                                            
                                            
                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                    MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                            
                Else
                            
                    MENU_NO = ""
                End If
                                            
                '2004.07.16 ↓
                sts = IDOREKI_OUTPUT_PROC("", _
                                            "", _
                                            ID_KANRI_TBL(ING_No).JGYOBU, _
                                            ID_KANRI_TBL(ING_No).NAIGAI, _
                                            ID_KANRI_TBL(ING_No).Hinban, _
                                            "", _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            0, _
                                            0, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            FILE_RETRY, _
                                            , _
                                            ID_KANRI_TBL(ING_No).LSBU_BinNo, "", , , , MENU_NO, , _
                                            ID_KANRI_TBL(ING_No).LSBU_BinNo, ID_KANRI_TBL(ING_No).ID_NO, _
                                            ID_KANRI_TBL(ING_No).ID_NO)
                Select Case sts
                    Case False      '正常終了
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        LSBU_IKAN_BinNo_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
                '2004.07.16 ↑
                                            
                                            'トランザクション終了
                sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                If sts <> BtNoErr Then
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpEndTransaction, "", 0)
                    GoTo Abort_Tran
                End If
                '次の作業要求
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                '>>>>>>>    2017.09.22
'                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                '>>>>>>>    2017.09.22
                                                                        
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "ﾄﾗｯｸ便:" & ID_KANRI_TBL(ING_No).LSBU_BinNo)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "ﾄﾗｯｸ便:" & ID_KANRI_TBL(ING_No).LSBU_BinNo)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(2).Max_Size = "13"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                        
                Send_Text.Box_Type(3).Max_Size = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                Sendbuf = Text_Create_Proc()
            End Select
        Next i
    End Select

    LSBU_IKAN_BinNo_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Public Function LSBU_IKAN_DEL_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『LSBU 移管削除処理』
'       2009.03.10
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 11
Dim Hinban          As String * 20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1

'210.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'210.12.07
Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1


Dim i               As Integer

Dim MENU_NO         As String * 2

Dim Tanaban_Name    As String

Dim SEQ_NO          As String * 1
Dim ans             As String * 1


    LSBU_IKAN_DEL_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "移管処理不可", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "移管処理不可", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LSBU_IKAN_DEL_Proc = False
                            Exit Function
                        End If
    
    
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "") '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    LSBU_IKAN_DEL_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")   '2017.09.22
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                LSBU_IKAN_DEL_Proc = False
                                Exit Function
                        End Select
                
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        
                        
                        ID_KANRI_TBL(ING_No).TANABAN1 = StrConv(Y_SYUREC.TANABAN1, vbUnicode)
                        ID_KANRI_TBL(ING_No).TANABAN2 = StrConv(Y_SYUREC.TANABAN2, vbUnicode)
                        ID_KANRI_TBL(ING_No).TANABAN3 = StrConv(Y_SYUREC.TANABAN3, vbUnicode)
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "棚削除:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "棚削除:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "棚番1:" & StrConv(Y_SYUREC.TANABAN1, vbUnicode))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "棚番1:" & StrConv(Y_SYUREC.TANABAN1, vbUnicode))
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(1).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = ""  '2007.07.21
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "棚番2:" & StrConv(Y_SYUREC.TANABAN2, vbUnicode))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "棚番2:" & StrConv(Y_SYUREC.TANABAN2, vbUnicode))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(2).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = ""  '2007.07.21
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "棚番3:" & StrConv(Y_SYUREC.TANABAN3, vbUnicode))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "棚番3:" & StrConv(Y_SYUREC.TANABAN3, vbUnicode))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""



                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "削除行(1,2,3):")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "削除行(1,2,3):")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "20"
                                                                                
                        Send_Text.Box_Type(4).Max_Size = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""


                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（削除行）
            For i = 0 To M_Gyo - 1
                
                Select Case i
                    
                    Case 4         '削除行
                    
                        SEQ_NO = Right(ID_KANRI_TBL(ING_No).Recv_text(i), 1)
                
                                        
                        If SEQ_NO <> "1" And SEQ_NO <> "2" And SEQ_NO <> "3" Then
                                        
                                        
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, SEQ_NO, "行指定ｴﾗｰ", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, SEQ_NO, "行指定ｴﾗｰ", "", "")   '2107.09.22
    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            LSBU_IKAN_DEL_Proc = False
                            Exit Function
                    
                        End If
                    
                    
                    
                    
                    
                
                
                
                
                        ID_KANRI_TBL(ING_No).SEQ_NO = SEQ_NO
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        
                        Select Case SEQ_NO
                            Case "1"
                                Tanaban = ID_KANRI_TBL(ING_No).TANABAN1
                            Case "2"
                                Tanaban = ID_KANRI_TBL(ING_No).TANABAN2
                            Case "3"
                                Tanaban = ID_KANRI_TBL(ING_No).TANABAN3
                        End Select
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>>>>>    2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '>>>>>>>>>>>    2017.09.22
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).Hinban)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        '2010.12.07
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "棚番" & SEQ_NO & ":" & Trim(Tanaban))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "棚番" & SEQ_NO & ":" & Trim(Tanaban))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "20"                  '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "20"
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                
                
                
                
                End Select
            
            Next i
            
            
            
            
        Case Step_Sagyo4_RES        '4回目の受信（Any Key）
            
            
            
            For i = 0 To M_Gyo - 1
                
                Select Case i
                    
                    Case 4         '確認
                    
                    
                    
                    
                        ans = Right(ID_KANRI_TBL(ING_No).Recv_text(i), 1)
                
                                        
                        If ans <> "1" And ans <> "9" Then
                                        
                                        
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ans, "(1 OR 9)", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ans, "(1 OR 9)", "", "")   '2107.09.22
    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            LSBU_IKAN_DEL_Proc = False
                            Exit Function
                    
                        End If
            
            
                        If ans = "1" Then
            
            
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                Exit Function
                            End If
                                                            '出荷予定の読み込み
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'ID№
                    
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")    '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        LSBU_IKAN_DEL_Proc = False
                                        GoTo Abort_Tran
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        LSBU_IKAN_DEL_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
            
                           
                           
                            Select Case Trim(ID_KANRI_TBL(ING_No).SEQ_NO)
                            
                                Case "1"
                                                                
                                    Call UniCode_Conv(Y_SYUREC.TANABAN1, StrConv(Y_SYUREC.TANABAN2, vbUnicode))
                                    Call UniCode_Conv(Y_SYUREC.TANABAN2, StrConv(Y_SYUREC.TANABAN3, vbUnicode))
                                    Call UniCode_Conv(Y_SYUREC.TANABAN3, "")
                            
                                Case "2"
                                                                
                                    Call UniCode_Conv(Y_SYUREC.TANABAN2, StrConv(Y_SYUREC.TANABAN3, vbUnicode))
                                    Call UniCode_Conv(Y_SYUREC.TANABAN3, "")
                                
                                Case "3"
                            
                                    Call UniCode_Conv(Y_SYUREC.TANABAN3, "")
                            
                            
                            
                            
                            End Select
                                            
                                            
                            Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                            Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                            
                            Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                                            
                                                            
                                                            
                                                            '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2107.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        LSBU_IKAN_DEL_Proc = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        LSBU_IKAN_DEL_Proc = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                                        
                            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                        
                            Else
                                        
                                MENU_NO = ""
                            End If
                                                        
                            '2004.07.16 ↓
                            sts = IDOREKI_OUTPUT_PROC("", _
                                                        "", _
                                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                                        ID_KANRI_TBL(ING_No).Hinban, _
                                                        "", _
                                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                        0, _
                                                        0, _
                                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                        FILE_RETRY, _
                                                        , _
                                                        "", , , , , MENU_NO, _
                                                        , , _
                                                        ID_KANRI_TBL(ING_No).ID_NO)
                            Select Case sts
                                Case False      '正常終了
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    LSBU_IKAN_DEL_Proc = SYS_ERR
                                    GoTo Abort_Tran
                            End Select
                            '2004.07.16 ↑
                                                        
                                                        'トランザクション終了
                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                            End If
            
                        End If
                End Select
            Next i
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    LSBU_IKAN_DEL_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function
Public Function LSBU_IKAN_DSP_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『LSBU 移管表示処理』
'       2009.03.10
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 11
Dim Hinban          As String * 20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1
Dim HIN_NO          As String * 13
Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1


Dim i               As Integer

Dim MENU_NO         As String * 2

Dim Tanaban_Name    As String

    LSBU_IKAN_DSP_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "移管処理不可", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "移管処理不可", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LSBU_IKAN_DSP_Proc = False
                            Exit Function
                        End If
    
    
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))  'ID№
                        
                        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷予定無し", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷予定無し", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    LSBU_IKAN_DSP_Proc = False
                                    Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "伝票ID:" & StrConv(Y_SYUREC.ID_NO, vbUnicode))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "伝票ID:" & StrConv(Y_SYUREC.ID_NO, vbUnicode))
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "品番:" & Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "品番:" & Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)))
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)))
                        '2010.12.07
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(1).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = ""
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "棚番1:" & Trim(StrConv(Y_SYUREC.TANABAN1, vbUnicode)))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "棚番1:" & Trim(StrConv(Y_SYUREC.TANABAN1, vbUnicode)))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "棚番2:" & Trim(StrConv(Y_SYUREC.TANABAN2, vbUnicode)))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "棚番2:" & Trim(StrConv(Y_SYUREC.TANABAN2, vbUnicode)))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""


                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "棚番3:" & Trim(StrConv(Y_SYUREC.TANABAN3, vbUnicode)))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "棚番3:" & Trim(StrConv(Y_SYUREC.TANABAN3, vbUnicode)))
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""


                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
            
            
        Case Step_Sagyo2_RES        '３回目の受信（Any Key）
            
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    LSBU_IKAN_DSP_Proc = False
    


End Function
Public Function LSBU_IKAN_Proc(Sendbuf As String, Ti As Integer, Tj As Integer, Mode As Integer) As Integer
'-------------------------------------------------------
'
'   『LSBU 移管処理』
'       2009.02.26
'
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 11
Dim Hinban          As String * 20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1


Dim i               As Integer

Dim MENU_NO         As String * 2

Dim Tanaban_Name    As String

    LSBU_IKAN_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "移管処理不可", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "移管処理不可", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LSBU_IKAN_Proc = False
                            Exit Function
                        End If
    
    
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "") '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    LSBU_IKAN_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")   '2017.09.22
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                LSBU_IKAN_Proc = False
                                Exit Function
                        End Select
                
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                                                
'                        Select Case Mode
'                            Case 1
'
'                                Tanaban = StrConv(Y_SYUREC.TANABAN1, vbUnicode)
'                            Case 2
'                                Tanaban = StrConv(Y_SYUREC.TANABAN2, vbUnicode)
'                            Case 3
'                                Tanaban = StrConv(Y_SYUREC.TANABAN3, vbUnicode)
'                        End Select
                        
                        
                        If Trim(StrConv(Y_SYUREC.TANABAN3, vbUnicode)) <> "" Then
                            Tanaban = StrConv(Y_SYUREC.TANABAN3, vbUnicode)
                            Tanaban_Name = "棚番3:"
                        Else
                            If Trim(StrConv(Y_SYUREC.TANABAN2, vbUnicode)) <> "" Then
                                Tanaban = StrConv(Y_SYUREC.TANABAN2, vbUnicode)
                                Tanaban_Name = "棚番2:"
                            Else
                                Tanaban = StrConv(Y_SYUREC.TANABAN1, vbUnicode)
                                Tanaban_Name = "棚番1:"
                            End If
                        End If
                        
                        
                        If Mid(Tanaban, 1, 1) = "." Then
                            ID_KANRI_TBL(ING_No).TANABAN1 = Right(Tanaban, 10)
                        End If
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>>>> 2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        
                        '>>>>>>>>>> 2017.09.22
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(Hinban))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(Hinban))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Tanaban_Name & Trim(Tanaban))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Tanaban_Name & Trim(Tanaban))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "11"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "11"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（品番，棚番）
            For i = 0 To M_Gyo - 1
                
                Select Case i
                    
                    Case 2         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        If Trim(Hinban) = "" Then
                            Hinban = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, vbUnicode))
                        End If
                                        
                                        
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                                        
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(Hinban), "品番エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(Hinban), "品番エラー", "", "")    '2017.09.22
    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            LSBU_IKAN_Proc = False
                            Exit Function
                    
                        End If
                    
                    
                    
                    
                    
                    
                    
                    Case 3        '棚番
                        Tanaban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                
                        If Mid(Tanaban, 1, 2) = "棚番" Then
                            Tanaban = Trim(Mid(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, vbUnicode), 5, 11))
                        End If
                
                        If Mid(Tanaban, 1, 1) = "." Then
                            Tanaban = Right(Tanaban, 10)
                        End If
                
                
                
    
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)  'ID№
                        
                        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷予定無し", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷予定無し", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    LSBU_IKAN_Proc = False
                                    Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                
                
                        If Trim(Tanaban) = "" Then

                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(Tanaban), "棚番入力してください", "", "")         '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(Tanaban), "棚番入力してください", "", "")     '2017.09.22
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            LSBU_IKAN_Proc = False
                            Exit Function
                        End If

                
                
                        If Trim(Tanaban) = Trim(StrConv(Y_SYUREC.TANABAN1, vbUnicode)) Or _
                            Trim(Tanaban) = Trim(StrConv(Y_SYUREC.TANABAN2, vbUnicode)) Or _
                            Trim(Tanaban) = Trim(StrConv(Y_SYUREC.TANABAN3, vbUnicode)) Then
                        
                        
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(Tanaban), "棚番登録済み", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(Tanaban), "棚番登録済み", "", "") '2017.09.22
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            LSBU_IKAN_Proc = False
                            Exit Function
                        End If
            
                        If Left(Tanaban, 1) <> "E" Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(Tanaban), "棚番(E)エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(Tanaban), "棚番(E)エラー", "", "")    '2017.09.22
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            LSBU_IKAN_Proc = False
                            Exit Function
                        End If

            
            
            
                        If Trim(StrConv(Y_SYUREC.TANABAN1, vbUnicode)) = "" Then
                            Tanaban_Name = "棚番1:"
                        Else
                            If Trim(StrConv(Y_SYUREC.TANABAN2, vbUnicode)) = "" Then
                                Tanaban_Name = "棚番2:"
                            Else
                                If Trim(StrConv(Y_SYUREC.TANABAN3, vbUnicode)) = "" Then
                                    Tanaban_Name = "棚番3:"
                                Else
                                    Tanaban_Name = "棚番3:"
                                
                                End If
                            End If
                        End If
                
                
                
                
                        ID_KANRI_TBL(ING_No).TANABAN1 = Tanaban
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>    2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '>>>>>>>    2017.09.22
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "品番:" & Hinban)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "品番:" & Hinban)
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                        '2010.12.07
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Tanaban_Name & Trim(Tanaban))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Tanaban_Name & Trim(Tanaban))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                End Select
            
            Next i
            
            
            
            
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            '出荷予定の読み込み
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'ID№
    
            Do
            
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrKeyNotFound
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")    '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        LSBU_IKAN_Proc = False
                        GoTo Abort_Tran
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        LSBU_IKAN_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
        
            Loop
    
    
            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
            
            
'            Select Case Mode
'
'                Case 1
'
'                    Call UniCode_Conv(Y_SYUREC.TANABAN1, Tanaban)
'
'
'                Case 2
'
'                    Call UniCode_Conv(Y_SYUREC.TANABAN2, Tanaban)
'
'                Case 3
'
'                    Call UniCode_Conv(Y_SYUREC.TANABAN3, Tanaban)
'
'            End Select
                                            
                                            
            If Trim(ID_KANRI_TBL(ING_No).Tanaban) = Trim(StrConv(Y_SYUREC.TANABAN1, vbUnicode)) Or _
                Trim(ID_KANRI_TBL(ING_No).Tanaban) = Trim(StrConv(Y_SYUREC.TANABAN2, vbUnicode)) Or _
                Trim(ID_KANRI_TBL(ING_No).Tanaban) = Trim(StrConv(Y_SYUREC.TANABAN3, vbUnicode)) Then
            Else
                If Trim(StrConv(Y_SYUREC.TANABAN1, vbUnicode)) = "" Then
                    Call UniCode_Conv(Y_SYUREC.TANABAN1, ID_KANRI_TBL(ING_No).TANABAN1)
                Else
                    If Trim(StrConv(Y_SYUREC.TANABAN2, vbUnicode)) = "" Then
                        Call UniCode_Conv(Y_SYUREC.TANABAN2, ID_KANRI_TBL(ING_No).TANABAN1)
                    Else
                        If Trim(StrConv(Y_SYUREC.TANABAN3, vbUnicode)) = "" Then
                            Call UniCode_Conv(Y_SYUREC.TANABAN3, ID_KANRI_TBL(ING_No).TANABAN1)
                        Else
                            Call UniCode_Conv(Y_SYUREC.TANABAN1, StrConv(Y_SYUREC.TANABAN2, vbUnicode))
                            Call UniCode_Conv(Y_SYUREC.TANABAN2, StrConv(Y_SYUREC.TANABAN3, vbUnicode))
                            Call UniCode_Conv(Y_SYUREC.TANABAN3, ID_KANRI_TBL(ING_No).TANABAN1)
                        End If
                    End If
                End If
            End If
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
            Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
            Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                            
            Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                                            
                                            
                                            '出荷予定書込み
            Do
                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        LSBU_IKAN_Proc = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        LSBU_IKAN_Proc = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop
                                        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                        
            '2004.07.16 ↓
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        "", , , , , MENU_NO, _
                                        , , _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    LSBU_IKAN_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
            '2004.07.16 ↑
                                        
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    LSBU_IKAN_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Public Function TANA_INS_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『棚番追加処理』
'       2009.03.17
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 11

Dim SOKO_NO         As String * 2
Dim Retu            As String * 2
Dim Ren             As String * 2
Dim Dan             As String * 2


Dim i               As Integer

Dim MENU_NO         As String * 2


    TANA_INS_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                    
                Select Case i
                
                    Case 1          '棚番
                        Tanaban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        If Mid(Tanaban, 1, 1) = "/" Then
                            Tanaban = Right(Tanaban, Len(Tanaban) - 1)
                        End If
                                    
                        If Mid(Tanaban, 1, 1) = "." Then                        '2017.09.21
                            Tanaban = Right(Tanaban, Len(Tanaban) - 1)          '2017.09.21
                        End If                                                  '2017.09.21
                                    
                                    
                                    
                        SOKO_NO = Mid(Tanaban, 1, 2)
                        Retu = Mid(Tanaban, 3, 2)
                        Ren = Mid(Tanaban, 5, 2)
                        Dan = Mid(Tanaban, 7, 2)
                                    '倉庫マスタﾁｪｯｸ
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, SOKO_NO)
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Tanaban, "倉庫マスタ無し", "", "")     '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "倉庫マスタ無し", "", "") '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    TANA_INS_Proc = False
                                    Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                    
                                    
'<<<<<<<<<<<<<<<<<<<<<  2017.09.21
'                                    '棚番ﾁｪｯｸ
'                        If Not IsNumeric(Retu) Or Not IsNumeric(Ren) Or Not IsNumeric(Ren) Then
'                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Tanaban, "列連段は数値のみ！", "", "")         '2017.09.21
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Tanaban, "列連段は数値のみ", "", "")            '2017.09.21
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                            TANA_INS_Proc = False
'                            Exit Function
'                        End If
'<<<<<<<<<<<<<<<<<<<<<  2017.09.21
                
                        Call UniCode_Conv(K0_TANA.SOKO_NO, SOKO_NO)
                        Call UniCode_Conv(K0_TANA.Retu, Retu)
                        Call UniCode_Conv(K0_TANA.Ren, Ren)
                        Call UniCode_Conv(K0_TANA.Dan, Dan)
                
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Tanaban, "棚登録済み！", "", "")           '2017.09.21
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Tanaban, "棚登録済み", "", "")             '2017.09.21--> DEL 2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚登録済み", "", "")         '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                TANA_INS_Proc = False
                                Exit Function
                            
                            
                            Case BtErrKeyNotFound
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
            
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                                
                                                
                        Call UniCode_Conv(TANAREC.SOKO_NO, SOKO_NO)
                        Call UniCode_Conv(TANAREC.Retu, Retu)
                        Call UniCode_Conv(TANAREC.Ren, Ren)
                        Call UniCode_Conv(TANAREC.Dan, Dan)
                                                
                                                
                        Call UniCode_Conv(TANAREC.KAHI_KBN, KAHI_KBN_OK)
                        Call UniCode_Conv(TANAREC.TANA_COND, "0")
                        Call UniCode_Conv(TANAREC.ZAIKO_SHOGO_FLG, ZAIKO_SHOGO_FLG_OK)
                        Call UniCode_Conv(TANAREC.FILLER, "")
                                                
                                                '棚マスタ書込み
                        Do
                            sts = BTRV(BtOpInsert, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Tanaban, "棚マスタ使用中", "", "")         '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚マスタ使用中", "", "")     '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    TANA_INS_Proc = False
                                    GoTo Abort_Tran
                            
                                Case BtErrDuplicates
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                    TANA_INS_Proc = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                        

'>>>>>>>>>>>>>>>>   2017.12.09
'                        sts = IDOREKI_OUTPUT_PROC("", _
'                                                    Tanaban, _
'                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
'                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
'                                                    "", _
'                                                    "", _
'                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
'                                                    0, _
'                                                    0, _
'                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
'                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                                    FILE_RETRY, _
'                                                    , _
'                                                    "", , , , , MENU_NO, _
'                                                    , , _
'                                                    ID_KANRI_TBL(ING_No).ID_NO)
                        
                        
                        
                        
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    Tanaban, _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    "", _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    , _
                                                    "", , , , , MENU_NO)
'>>>>>>>>>>>>>>>>   2017.12.09
                        
                        
                        
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                TANA_INS_Proc = SYS_ERR
                                GoTo Abort_Tran
                        End Select
                                            
                                                    'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        '次の作業要求
        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>> 2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '>>>>>> 2017.09.22
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "11"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "11"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>>>>>>>>>>   2017.09.21
                        'Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "前回:" & Mid(Tanaban, 1, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Mid(Tanaban, 7, 2))
                        'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "前回:" & Mid(Tanaban, 1, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Mid(Tanaban, 7, 2))
                        
                        If Len(Trim(Tanaban)) < 8 Then
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "前回:" & Tanaban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "前回:" & Tanaban)
                        Else
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "前回:" & Mid(Tanaban, 1, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Mid(Tanaban, 7, 2))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "前回:" & Mid(Tanaban, 1, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Mid(Tanaban, 7, 2))
                        End If
                        
                        
                        '>>>>>>>>>>>>>>>>   2017.09.21
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                
                        Sendbuf = Text_Create_Proc()
    
    
    
                    
                End Select
            Next i
    End Select

    TANA_INS_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Public Function GOODS_ONOFF_Ono_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『商品化済み→未商品の切り替え（小野用）』
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim Tanaban         As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim MENU_NO         As String * 2

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

    GOODS_ONOFF_Ono_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.07.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.07.22
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    GOODS_ONOFF_Ono_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                GOODS_ONOFF_Ono_Proc = False
                                Exit Function
                            End If
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.07.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.07.22
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            GOODS_ONOFF_Ono_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            
                                                
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.07.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.07.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                GOODS_ONOFF_Ono_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
        
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
'2008.07.24            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    GOODS_ONOFF_Ono_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                GOODS_ONOFF_Ono_Proc = False
                Exit Function
            End If
        
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = Tanaban          '棚番をセーブ
            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '事業部をセーブ 2008.07.24
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '国内外をセーブ 2008.07.24
            
            
            
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            
                        
            
            
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
                                                        
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>>>>   2017.07.22
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            
            '>>>>>>>>   2017.07.22
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
            '2010.12.07
'            Send_Text.Box_Type(2).Max_Size = "13"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
            '2010.12.07
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "総在庫：" & Format((SUMI_QTY + MI_QTY), "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "総在庫：" & Format((SUMI_QTY + MI_QTY), "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            
            
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            GOODS_ONOFF_Ono_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            GOODS_ONOFF_Ono_Proc = False
                            Exit Function
                        End If
            
            
                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            GOODS_ONOFF_Ono_Proc = False
                            Exit Function
                        End If
                
                
                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            
                        Else
                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        
                        End If
        
                        If i = M_Gyo - 1 Then       '最終行だったら
'                            If SUMI_QTY = 0 And MI_QTY = 0 Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                GOODS_ONOFF_Siga_Proc = False
'                                Exit Function'                            End If
                
                
                            MI_QTY = (ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY) - SUMI_QTY
                
                
                            If (SUMI_QTY + MI_QTY) <> (ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "総数量変更不可", "数量入力ミス", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "総数量変更不可", "数量入力ミス", "", "")  '2017.09.122
                                Sendbuf = Text_Create_Proc()
                                
                                
                                
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                GOODS_ONOFF_Ono_Proc = False
                                Exit Function
                    
                            End If
                        End If
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
        
        
        
            '商品化←→未商品の切り替え更新
'2008.07.24            sts = GOODS_ONOFF_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
'                                            ID_KANRI_TBL(ING_No).NAIGAI, _
'                                            ID_KANRI_TBL(ING_No).Hinban, _
'                                            ID_KANRI_TBL(ING_No).Tanaban, _
'                                            SUMI_QTY, _
'                                            MI_QTY, _
'                                            Format(ID_KANRI_TBL(ING_No).ID, "000"), _
'                                            ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                            FILE_RETRY)
            
        '作業ﾛｸﾞ出力    2008.08.08
        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                    
        Else
                    
            MENU_NO = ""
        End If
            
        sts = GOODS_ONOFF_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        ID_KANRI_TBL(ING_No).Tanaban, _
                                        SUMI_QTY, _
                                        MI_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, MENU_NO)
            
            
            Select Case sts
                Case False

                Case True       '在庫不足時に発生
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                    GOODS_ONOFF_Ono_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    GOODS_ONOFF_Ono_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    GOODS_ONOFF_Ono_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
   
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    GOODS_ONOFF_Ono_Proc = False

    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Public Function GOODS_ONOFF_Siga_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『商品化済み→未商品の切り替え（滋賀用）』
'
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim Tanaban         As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2   '2008.08.08


    GOODS_ONOFF_Siga_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    
                                    
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2107.09.22
                                    
                                    If Len(Trim(Tanaban)) < 8 Then
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")    '2107.09.22
                                    Else
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2107.09.22
                                    End If
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                    
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    GOODS_ONOFF_Siga_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                                If Len(Trim(Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚使用不可", "", "")    '2017.09.22
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                                End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                GOODS_ONOFF_Siga_Proc = False
                                Exit Function
                            End If
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            If Len(Trim(Tanaban)) < 8 Then
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")    '2017.09.22
                                            Else
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            End If
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            GOODS_ONOFF_Siga_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            
                                                
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                GOODS_ONOFF_Siga_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
        
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    'Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                    If Len(Trim(Tanaban)) < 8 Then
                        Call Err_Send_Proc("在庫使用中", Tanaban, Hinban, "", "")
                    Else
                        Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                    End If
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    GOODS_ONOFF_Siga_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                
                '有効桁数により棚番の編集を変える   '2017.09.23
                'Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                If Len(Trim(Tanaban)) < 8 Then
                    Call Err_Send_Proc("有効在庫無し", Tanaban, Hinban, "", "")
                Else
                    Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                End If
                '有効桁数により棚番の編集を変える   '2017.09.23
           
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                GOODS_ONOFF_Siga_Proc = False
                Exit Function
            End If
        
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = Tanaban          '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
                                                        
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>>>>   2017.09.22
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            '>>>>>>>>   2017.09.22
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            
            '有効桁数により棚番の編集を変える   '2017.09.23
        
'            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
'                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
'
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
'                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                            
                                                            
            If Len(Trim(Tanaban)) < 8 Then
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Tanaban)
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Tanaban)
            Else
                                                                
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
            End If
            '有効桁数により棚番の編集を変える   '2017.09.23
                                                            
                                                            
                                                            
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
            '2010.12.07
'            Send_Text.Box_Type(2).Max_Size = "13"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
            '2010.12.07
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            GOODS_ONOFF_Siga_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            GOODS_ONOFF_Siga_Proc = False
                            Exit Function
                        End If
            
            
                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            GOODS_ONOFF_Siga_Proc = False
                            Exit Function
                        End If
                
                
                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            
                        Else
                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        
                        End If
        
                        If i = M_Gyo - 1 Then       '最終行だったら
'                            If SUMI_QTY = 0 And MI_QTY = 0 Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                GOODS_ONOFF_Siga_Proc = False
'                                Exit Function
'                            End If
                
                
                
                            If (SUMI_QTY + MI_QTY) <> (ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "総数量変更不可", "数量入力ミス", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "総数量変更不可", "数量入力ミス", "", "")  '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                
                                
                                
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                GOODS_ONOFF_Siga_Proc = False
                                Exit Function
                    
                            End If
                        End If
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
        
            
            '作業ﾛｸﾞ出力    2008.08.08
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            
            '商品化←→未商品の切り替え更新
            sts = GOODS_ONOFF_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                            ID_KANRI_TBL(ING_No).NAIGAI, _
                                            ID_KANRI_TBL(ING_No).Hinban, _
                                            ID_KANRI_TBL(ING_No).Tanaban, _
                                            SUMI_QTY, _
                                            MI_QTY, _
                                            Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                            ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            FILE_RETRY, MENU_NO)
            
            Select Case sts
                Case False

                Case True       '在庫不足時に発生
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")       '2017.09.22
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    If Len(Trim(ID_KANRI_TBL(ING_No).Tanaban)) < 8 Then
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Tanaban, ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    Else
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    End If
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                    GOODS_ONOFF_Siga_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    GOODS_ONOFF_Siga_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    GOODS_ONOFF_Siga_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
   
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    GOODS_ONOFF_Siga_Proc = False

    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function RETURNED_GOODS_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『良品返品』
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim Tanaban         As String * 8
'2010.12.08
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.08

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    RETURNED_GOODS_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                RETURNED_GOODS_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
        
        
            SUMI_QTY = 0
            MI_QTY = 0
        
        
            '-----------------------------------------------送信テキスト作成
        
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Hinban = Hinban                    '品番をセーブ
                                                        
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                        
                                                        
                                                        
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>>>    2017.09.22
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).YOIN_DNAME, 2) & "[" & StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & StrConv(ITEMREC.ST_DAN, vbUnicode) & "]")
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).YOIN_DNAME, 2) & "[" & StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & StrConv(ITEMREC.ST_DAN, vbUnicode) & "]")
                                                            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, 2) & "[" & StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & StrConv(ITEMREC.ST_DAN, vbUnicode) & "]")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, 2) & "[" & StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & StrConv(ITEMREC.ST_DAN, vbUnicode) & "]")
            '>>>>>>>    2017.09.22
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            '2010.12.07
'            Send_Text.Box_Type(1).Max_Size = "08"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
            Send_Text.Box_Type(1).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "20"
            '2010.12.07
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                                    'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                    '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(2).Max_Size = "09"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                    
            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#")))) & Format(SUMI_QTY, "#"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#")))) & Format(SUMI_QTY, "#"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#"))) & Format(SUMI_QTY, "#")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#"))) & Format(SUMI_QTY, "#")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#")))) & Format(MI_QTY, "#"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#")))) & Format(MI_QTY, "#"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#"))) & Format(MI_QTY, "#")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#"))) & Format(MI_QTY, "#")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                        '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                        
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                    RETURNED_GOODS_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 混載チェック
                            If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                                If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                    StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")      '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")  '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    RETURNED_GOODS_Proc = False
                                    Exit Function
                                End If
                            End If
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                        
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                            
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                    RETURNED_GOODS_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                    
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                                    
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                        
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                
                                RETURNED_GOODS_Proc = False
                                Exit Function
                            End If
                    
                    
                        End If
            
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            RETURNED_GOODS_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            RETURNED_GOODS_Proc = False
                            Exit Function
                        End If
            
            
                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")        '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            RETURNED_GOODS_Proc = False
                            Exit Function
                        End If
                
                
                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))

'                            If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                RETURNED_GOODS_Proc = False
'                                Exit Function
'
'                            End If
                        Else
                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        
'                            If MI_QTY > ID_KANRI_TBL(ING_No).Send_MI_QTY Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                RETURNED_GOODS_Proc = False
'                                Exit Function
'                            End If
                        End If
        
                        If i = M_Gyo - 1 Then       '最終行だったら
                            If SUMI_QTY = 0 And MI_QTY = 0 Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")    '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                RETURNED_GOODS_Proc = False
                                Exit Function
                            End If
                        End If
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                        
                                        
                                                'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                                
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                                
                                                '入庫更新
            sts = Nyuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    Format(Now, "YYYYMMDD"), _
                                    Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, , , , , MENU_NO)
            Select Case sts
                Case False
                Case True           '入庫時は発生しない
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                    RETURNED_GOODS_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Sendbuf = Text_Create_Proc()
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    RETURNED_GOODS_Proc = SYS_ERR    'システム異常発生
                    
                    GoTo Abort_Tran
            End Select
                                        
                                        
                                        
End_Tran:
                                            'トランザクション終了
        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        If sts <> BtNoErr Then
            Call Err_Send_Proc("システム異常発生", "", "", "", "")
            Sendbuf = Text_Create_Proc()
            Call File_Error(sts, BtOpEndTransaction, "", 0)
            GoTo Abort_Tran
        End If
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    RETURNED_GOODS_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Private Function GOODS_ONOFF_Update_Proc(JGYOBU As String, _
                                        NAIGAI As String, _
                                        HIN_GAI As String, _
                                        Location As String, _
                                        SUMI_JITU_QTY As Long, _
                                        MI_JITU_QTY As Long, _
                                        ID As String, _
                                        TANTO_CODE As String, _
                                        Optional RETRY As Integer = 10, _
                                        Optional MENU_NO As String) As Integer
'****************************************************
'*      「商品化／未商品切り替え処理」在庫データ更新
'*
'*  在庫データの更新を行う。
'*  (引数の設定ミスはこちらではチェックしない)
'*  使用ﾌｧｲﾙ    :   在庫データ
'*                  在庫データ(一時ファイル)
'*  引数：  事業部（省略不可）
'*          国内外（省略不可）
'*          品番外部(省略不可)
'*          棚番（XXXXXXXX(倉庫№+列+連+段)省略不可）
'*          商品化済み実績数（何れか一方必須）
'*          未商品実績数　　（　　〃　　　　）
'*          ID(省略不可)
'*          担当者（省略不可）
'*          リトライ(省略可 １桁目:1=画面メッセージ有 0:無，２桁目:リトライ回数(0～9 0:無限))
'*          ﾒﾆｭｰ№  2008.08.08 (作業ﾛｸﾞ出力 ON/OFF)
'*  戻り値: false       :正常
'*          true        :継続可能な異常
'*          SYS_ERR     :継続できない異常
'*          SYS_CANCEL  :更新ｷｬﾝｾﾙ
'*
'*      2012.03.25  frm より　移管
'*
'*
'****************************************************
Dim sts         As Integer
Dim com         As Integer
Dim Upd_com     As Integer


Dim RETRY_CNT   As Integer
Dim MESG_FLG    As Integer
Dim RETRY_SU    As Integer
    
Dim Zan_Qty     As Long
Dim WK_Qty      As Long
    
    

    GOODS_ONOFF_Update_Proc = True
                                                                      
                                                                      
    MESG_FLG = CInt(Mid(Format(RETRY, "00"), 1, 1))
    RETRY_SU = CInt(Mid(Format(RETRY, "00"), 2, 1))
    
    
        '作業ﾛｸﾞ出力    '2008.08.06
    If Trim(MENU_NO) <> "" Then
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    ID, _
                                    JGYOBU, _
                                    NAIGAI, _
                                    MENU_NO, _
                                    ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                    HIN_GAI, _
                                    SUMI_JITU_QTY, _
                                    MI_JITU_QTY, _
                                    Location, _
                                    Location) Then
            Exit Function
        End If
    End If
    
'============================================================ 対象在庫データを在庫一時データに全件移動する。
    
    Call UniCode_Conv(K4_ZAIKO.JGYOBU, JGYOBU)
    Call UniCode_Conv(K4_ZAIKO.NAIGAI, NAIGAI)
    Call UniCode_Conv(K4_ZAIKO.HIN_GAI, HIN_GAI)
    Call UniCode_Conv(K4_ZAIKO.SOKO_NO, Left(Location, 2))
    Call UniCode_Conv(K4_ZAIKO.Retu, Mid(Location, 3, 2))
    Call UniCode_Conv(K4_ZAIKO.Ren, Mid(Location, 5, 2))
    Call UniCode_Conv(K4_ZAIKO.Dan, Right(Location, 2))
    
    
    com = BtOpGetGreaterEqual
    
    RETRY_CNT = 0
    
    
    Do
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
'------- 元在庫読込み
        Do
            sts = BTRV(com + BtSNoWait, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K4_ZAIKO, Len(K4_ZAIKO), 4)
            Select Case sts
                Case BtNoErr
                    If JGYOBU <> StrConv(ZAIKOREC.JGYOBU, vbUnicode) Or _
                        NAIGAI <> StrConv(ZAIKOREC.NAIGAI, vbUnicode) Or _
                        Trim(HIN_GAI) <> Trim(StrConv(ZAIKOREC.HIN_GAI, vbUnicode)) Or _
                        Location <> (StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & _
                                        StrConv(ZAIKOREC.Retu, vbUnicode) & _
                                        StrConv(ZAIKOREC.Ren, vbUnicode) & _
                                        StrConv(ZAIKOREC.Dan, vbUnicode)) Then
                        sts = BtErrEOF
                    
                    End If
                
                    Exit Do
                
                Case BtErrEOF
    
                    Exit Do
                
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                'リトライ回数チェック
                    If RETRY_SU <> 0 Then
    
                        RETRY_CNT = RETRY_CNT + 1
                        If RETRY_CNT > RETRY_SU Then
                                '回数オーバー
                            Call File_Error(sts, com + BtSNoWait, "在庫データ", 0)
                            GOODS_ONOFF_Update_Proc = SYS_CANCEL
                            Exit Function
    
                        End If
    
                    End If
    
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                Case Else
                    Call File_Error(sts, com + BtSNoWait, "在庫データ")
                    GOODS_ONOFF_Update_Proc = SYS_ERR
                    Exit Function
            End Select
    
        Loop
        
        If sts = BtErrEOF Then
            Exit Do
        End If
'------- 在庫(一時データ)読込み
        Call UniCode_Conv(K0_tmpZAIKO.SOKO_NO, StrConv(ZAIKOREC.SOKO_NO, vbUnicode))
        Call UniCode_Conv(K0_tmpZAIKO.Retu, StrConv(ZAIKOREC.Retu, vbUnicode))
        Call UniCode_Conv(K0_tmpZAIKO.Ren, StrConv(ZAIKOREC.Ren, vbUnicode))
        Call UniCode_Conv(K0_tmpZAIKO.Dan, StrConv(ZAIKOREC.Dan, vbUnicode))
        Call UniCode_Conv(K0_tmpZAIKO.JGYOBU, StrConv(ZAIKOREC.JGYOBU, vbUnicode))
        Call UniCode_Conv(K0_tmpZAIKO.NAIGAI, StrConv(ZAIKOREC.NAIGAI, vbUnicode))
        Call UniCode_Conv(K0_tmpZAIKO.HIN_GAI, StrConv(ZAIKOREC.HIN_GAI, vbUnicode))
        Call UniCode_Conv(K0_tmpZAIKO.NYUKA_DT, StrConv(ZAIKOREC.NYUKA_DT, vbUnicode))
    
        
        Do
        
            sts = BTRV(BtOpGetEqual + BtSNoWait, tmpZAIKO_POS, tmpZAIKOREC, Len(tmpZAIKOREC), K0_tmpZAIKO, Len(K0_tmpZAIKO), 0)
            Select Case sts
                Case BtNoErr
                    Upd_com = BtOpUpdate
                    Exit Do
                
                Case BtErrKeyNotFound
                    Upd_com = BtOpInsert
    
                    Exit Do
                
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                'リトライ回数チェック
                    If RETRY_SU <> 0 Then
    
                        RETRY_CNT = RETRY_CNT + 1
                        If RETRY_CNT > RETRY_SU Then
                                '回数オーバー
                            Call File_Error(sts, com + BtSNoWait, "在庫データ（一時データ）", 0)
                            GOODS_ONOFF_Update_Proc = SYS_CANCEL
                            Exit Function
    
                        End If
    
                    End If
    
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                Case Else
                    Call File_Error(sts, com + BtSNoWait, "在庫データ（一時データ）")
                    GOODS_ONOFF_Update_Proc = SYS_ERR
                    Exit Function
            End Select
        
        
        Loop
'------- 在庫(一時データ)を出力
        Select Case Upd_com
        
            Case BtOpInsert
            '------- 新規追加
                Do
                    sts = BTRV(BtOpInsert, tmpZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K0_tmpZAIKO, Len(K0_tmpZAIKO), 0)
                
                
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'リトライ回数チェック
                            If RETRY_SU <> 0 Then
        
                                RETRY_CNT = RETRY_CNT + 1
                                If RETRY_CNT > RETRY_SU Then
                                        '回数オーバー
                                    Call File_Error(sts, BtOpInsert, "在庫データ（一時データ）", 0)
                                    GOODS_ONOFF_Update_Proc = SYS_CANCEL
                                    Exit Function
        
                                End If
        
                            End If
        
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                        Case Else
                            Call File_Error(sts, Upd_com, "在庫データ（一時データ）")
                            GOODS_ONOFF_Update_Proc = SYS_ERR
                            Exit Function
        
                    End Select
                
                Loop
    
        
            Case BtOpUpdate
            '------- 在庫数加算（更新）
                Call UniCode_Conv(tmpZAIKOREC.YUKO_Z_QTY, Format(CLng(StrConv(tmpZAIKOREC.YUKO_Z_QTY, vbUnicode)) + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode)), "00000000"))
        
        
                Do
                    sts = BTRV(BtOpUpdate, tmpZAIKO_POS, tmpZAIKOREC, Len(tmpZAIKOREC), K0_tmpZAIKO, Len(K0_tmpZAIKO), 0)
                
                
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'リトライ回数チェック
                            If RETRY_SU <> 0 Then
        
                                RETRY_CNT = RETRY_CNT + 1
                                If RETRY_CNT > RETRY_SU Then
                                        '回数オーバー
                                    Call File_Error(sts, BtOpInsert, "在庫データ（一時データ）", 0)
                                    GOODS_ONOFF_Update_Proc = SYS_CANCEL
                                    Exit Function
        
                                End If
        
                            End If
        
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                        Case Else
                            Call File_Error(sts, Upd_com, "在庫データ（一時データ）")
                            GOODS_ONOFF_Update_Proc = SYS_ERR
                            Exit Function
        
                    End Select
                
                Loop
        
        End Select
   
'------- 元在庫削除
        Do
            sts = BTRV(BtOpDelete, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K4_ZAIKO, Len(K4_ZAIKO), 4)
        
        
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                'リトライ回数チェック
                    If RETRY_SU <> 0 Then

                        RETRY_CNT = RETRY_CNT + 1
                        If RETRY_CNT > RETRY_SU Then
                                '回数オーバー
                            Call File_Error(sts, BtOpDelete, "在庫データ", 0)
                            GOODS_ONOFF_Update_Proc = SYS_CANCEL
                            Exit Function

                        End If

                    End If

'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                Case Else
                    Call File_Error(sts, Upd_com, "在庫データ")
                    GOODS_ONOFF_Update_Proc = SYS_ERR
                    Exit Function

            End Select
        
        Loop
    
    
        com = BtOpGetNext
    
    Loop
    
'============================================================ 商品化済みの処理(古い日付より引き当てる)
    If SUMI_JITU_QTY <> 0 Then
    
        Zan_Qty = SUMI_JITU_QTY




        Call UniCode_Conv(K0_tmpZAIKO.SOKO_NO, Left(Location, 2))
        Call UniCode_Conv(K0_tmpZAIKO.Retu, Mid(Location, 3, 2))
        Call UniCode_Conv(K0_tmpZAIKO.Ren, Mid(Location, 5, 2))
        Call UniCode_Conv(K0_tmpZAIKO.Dan, Right(Location, 2))
        Call UniCode_Conv(K0_tmpZAIKO.JGYOBU, JGYOBU)
        Call UniCode_Conv(K0_tmpZAIKO.NAIGAI, NAIGAI)
        Call UniCode_Conv(K0_tmpZAIKO.HIN_GAI, HIN_GAI)
        Call UniCode_Conv(K0_tmpZAIKO.NYUKA_DT, "")

        
        com = BtOpGetGreaterEqual
        
        Do

            RETRY_CNT = 0
'------- 在庫（一時データ）読込み
            Do
                sts = BTRV(com + BtSNoWait, tmpZAIKO_POS, tmpZAIKOREC, Len(tmpZAIKOREC), K0_tmpZAIKO, Len(K0_tmpZAIKO), 0)
                Select Case sts
                    Case BtNoErr
                    
                    
                        If JGYOBU <> StrConv(tmpZAIKOREC.JGYOBU, vbUnicode) Or _
                            NAIGAI <> StrConv(tmpZAIKOREC.NAIGAI, vbUnicode) Or _
                            Trim(HIN_GAI) <> Trim(StrConv(tmpZAIKOREC.HIN_GAI, vbUnicode)) Or _
                            Location <> (StrConv(tmpZAIKOREC.SOKO_NO, vbUnicode) & _
                                            StrConv(tmpZAIKOREC.Retu, vbUnicode) & _
                                            StrConv(tmpZAIKOREC.Ren, vbUnicode) & _
                                            StrConv(tmpZAIKOREC.Dan, vbUnicode)) Then
                            sts = BtErrEOF
                        
                        End If
                    
                    
                        If Zan_Qty < CLng(StrConv(tmpZAIKOREC.YUKO_Z_QTY, vbUnicode)) Then
                            Upd_com = BtOpUpdate
                            WK_Qty = Zan_Qty
                        Else
                            Upd_com = BtOpDelete
                            WK_Qty = CLng(StrConv(tmpZAIKOREC.YUKO_Z_QTY, vbUnicode))
                        End If

                        Exit Do
                    Case BtErrEOF
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    'リトライ回数チェック
                        If RETRY_SU <> 0 Then

                            RETRY_CNT = RETRY_CNT + 1
                            If RETRY_CNT > RETRY_SU Then
                                    '回数オーバー
                                Call File_Error(sts, com + BtSNoWait, "在庫データ（一時データ）", 0)
                                GOODS_ONOFF_Update_Proc = SYS_CANCEL
                                Exit Function

                            End If

                        End If

'                        DoEvents
                        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                            DoEvents                                                    '2016.01.26
                        End If                                                          '2016.01.26
                    
                    Case Else
                        Call File_Error(sts, com + BtSNoWait, "在庫データ（一時データ）")
                        GOODS_ONOFF_Update_Proc = SYS_ERR
                        Exit Function
                End Select

            Loop

            If sts = BtErrEOF Then
                Exit Do
            End If

            If Upd_com = BtOpUpdate Then
                                                                            '有効在庫数
                Call UniCode_Conv(tmpZAIKOREC.YUKO_Z_QTY, Format(CLng(StrConv(tmpZAIKOREC.YUKO_Z_QTY, vbUnicode)) - WK_Qty, "00000000"))
            
            End If


            RETRY_CNT = 0
'------- 在庫（一時データ）消し込み
            Do
                sts = BTRV(Upd_com, tmpZAIKO_POS, tmpZAIKOREC, Len(tmpZAIKOREC), K0_tmpZAIKO, Len(K0_tmpZAIKO), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    'リトライ回数チェック
                        If RETRY_SU <> 0 Then

                            RETRY_CNT = RETRY_CNT + 1
                            If RETRY_CNT > RETRY_SU Then
                                    '回数オーバー
                                Call File_Error(sts, Upd_com, "在庫データ（一時データ）", 0)
                                GOODS_ONOFF_Update_Proc = SYS_CANCEL
                                Exit Function

                            End If

                        End If
'                        DoEvents
                        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                            DoEvents                                                    '2016.01.26
                        End If                                                          '2016.01.26
                    Case Else
                        Call File_Error(sts, Upd_com, "在庫データ（一時データ）")
                        GOODS_ONOFF_Update_Proc = SYS_ERR
                        Exit Function

                End Select
            
            Loop
'============================================================ 実際の在庫データに移動
                                                '常に新規追加
            Call UniCode_Conv(ZAIKOREC.SOKO_NO, Left(Location, 2))          '倉庫№
            Call UniCode_Conv(ZAIKOREC.Retu, Mid(Location, 3, 2))           '列
            Call UniCode_Conv(ZAIKOREC.Ren, Mid(Location, 5, 2))            '連
            Call UniCode_Conv(ZAIKOREC.Dan, Right(Location, 2))             '段
            Call UniCode_Conv(ZAIKOREC.JGYOBU, JGYOBU)                      '事業部
            Call UniCode_Conv(ZAIKOREC.NAIGAI, NAIGAI)                      '内外
            Call UniCode_Conv(ZAIKOREC.HIN_GAI, HIN_GAI)                    '品番（外部）
            Call UniCode_Conv(ZAIKOREC.GOODS_ON, "0")                       '商品／未商品
                                                                            '入荷日
            Call UniCode_Conv(ZAIKOREC.NYUKA_DT, StrConv(tmpZAIKOREC.NYUKA_DT, vbUnicode))
                                                                            '入庫日
            Call UniCode_Conv(ZAIKOREC.NYUKO_DT, StrConv(tmpZAIKOREC.NYUKO_DT, vbUnicode))
                                                                            '品番（内部）
'            Call UniCode_Conv(ZAIKOREC.HIN_NAI, StrConv(tmpZAIKOREC.NYUKO_DT, vbUnicode))  2005.09.03
            Call UniCode_Conv(ZAIKOREC.HIN_NAI, StrConv(tmpZAIKOREC.HIN_NAI, vbUnicode))
                                                                            '有効在庫数
            Call UniCode_Conv(ZAIKOREC.YUKO_Z_QTY, Format(WK_Qty, "00000000"))
            Call UniCode_Conv(ZAIKOREC.LOCK_F, LOCK_OFF)                   '排他フラグ
            Call UniCode_Conv(ZAIKOREC.WEL_ID, "")                         '使用中子機ID
            Call UniCode_Conv(ZAIKOREC.PRG_ID, "")                         '使用中ﾌﾟﾛｸﾞﾗﾑ
            Call UniCode_Conv(ZAIKOREC.GOODS_YMD, Format(Now, "YYYYMMDD"))  '商品化日付



    '----------------   2010.07.08 ▽
                    Call UniCode_Conv(ZAIKOREC.GENSANKOKU, StrConv(tmpZAIKOREC.GENSANKOKU, vbUnicode))
                    Call UniCode_Conv(ZAIKOREC.SHIIRE_WORK_CENTER, StrConv(tmpZAIKOREC.SHIIRE_WORK_CENTER, vbUnicode))
                    Call UniCode_Conv(ZAIKOREC.ID_NO2, StrConv(tmpZAIKOREC.ID_NO2, vbUnicode))
                    Call UniCode_Conv(ZAIKOREC.YOSAN_FROM, StrConv(tmpZAIKOREC.YOSAN_FROM, vbUnicode))
                    Call UniCode_Conv(ZAIKOREC.YOSAN_TO, StrConv(tmpZAIKOREC.YOSAN_TO, vbUnicode))
    '----------------   2010.07.08 △




            Call UniCode_Conv(ZAIKOREC.FILLER, "")

            RETRY_CNT = 0
'*------------------------------------------------------'在庫データ出力
            Do
                sts = BTRV(BtOpInsert, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K0_ZAIKO, Len(K0_ZAIKO), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    'リトライ回数チェック
                        If RETRY_SU <> 0 Then

                            RETRY_CNT = RETRY_CNT + 1
                            If RETRY_CNT > RETRY_SU Then
                                    '回数オーバー
                                Call File_Error(sts, Upd_com, "在庫データ", 0)
                                GOODS_ONOFF_Update_Proc = SYS_CANCEL
                                Exit Function

                            End If

                        End If
'                        DoEvents
                        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                            DoEvents                                                    '2016.01.26
                        End If                                                          '2016.01.26
                    Case Else
                        Call File_Error(sts, BtOpInsert, "在庫データ")
                        GOODS_ONOFF_Update_Proc = SYS_ERR
                        Exit Function

                End Select
            Loop

            Zan_Qty = Zan_Qty - WK_Qty

            If Zan_Qty <= 0 Then
                Exit Do                     '引き落とし終了（商品化済み分）
            End If

        Loop
                
    End If
'================================================================================
    '*
    '*--------------------  未商品化の処理(一時在庫に残っている分は全て未商品として計上)
    
    Call UniCode_Conv(K0_tmpZAIKO.SOKO_NO, Left(Location, 2))
    Call UniCode_Conv(K0_tmpZAIKO.Retu, Mid(Location, 3, 2))
    Call UniCode_Conv(K0_tmpZAIKO.Ren, Mid(Location, 5, 2))
    Call UniCode_Conv(K0_tmpZAIKO.Dan, Right(Location, 2))
    Call UniCode_Conv(K0_tmpZAIKO.JGYOBU, JGYOBU)
    Call UniCode_Conv(K0_tmpZAIKO.NAIGAI, NAIGAI)
    Call UniCode_Conv(K0_tmpZAIKO.HIN_GAI, HIN_GAI)
    Call UniCode_Conv(K0_tmpZAIKO.NYUKA_DT, "")
    
    
    com = BtOpGetGreaterEqual
    
    Do


'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26


        RETRY_CNT = 0
        Do
            sts = BTRV(com + BtSNoWait, tmpZAIKO_POS, tmpZAIKOREC, Len(tmpZAIKOREC), K0_tmpZAIKO, Len(K0_tmpZAIKO), 0)
            Select Case sts
                Case BtNoErr
                                        '棚＋品ブレーク
                    If Location <> (StrConv(tmpZAIKOREC.SOKO_NO, vbUnicode) & _
                                        StrConv(tmpZAIKOREC.Retu, vbUnicode) & _
                                        StrConv(tmpZAIKOREC.Ren, vbUnicode) & _
                                        StrConv(tmpZAIKOREC.Dan, vbUnicode)) Or _
                        JGYOBU <> StrConv(tmpZAIKOREC.JGYOBU, vbUnicode) Or _
                        NAIGAI <> StrConv(tmpZAIKOREC.NAIGAI, vbUnicode) Or _
                        Trim(HIN_GAI) <> Trim(StrConv(tmpZAIKOREC.HIN_GAI, vbUnicode)) Then


                        sts = BtErrEOF

                    End If
                    Exit Do
                Case BtErrEOF
                    
                    Exit Do

                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                'リトライ回数チェック
                    If RETRY_SU <> 0 Then

                        RETRY_CNT = RETRY_CNT + 1
                        If RETRY_CNT > RETRY_SU Then
                                '回数オーバー
                            Call File_Error(sts, com + BtSNoWait, "在庫データ（一時データ）", 0)
                            GOODS_ONOFF_Update_Proc = SYS_CANCEL
                            Exit Function

                        End If

                    End If

'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                Case Else
                    Call File_Error(sts, com + BtSNoWait, "在庫データ（一時データ）")
                    GOODS_ONOFF_Update_Proc = SYS_ERR
                    Exit Function
            End Select

        Loop


        If sts = BtErrEOF Then
            Exit Do
        End If

'============================================================ 実際の在庫データに移動
                                                '常に新規追加
        Call UniCode_Conv(ZAIKOREC.SOKO_NO, Left(Location, 2))          '倉庫№
        Call UniCode_Conv(ZAIKOREC.Retu, Mid(Location, 3, 2))           '列
        Call UniCode_Conv(ZAIKOREC.Ren, Mid(Location, 5, 2))            '連
        Call UniCode_Conv(ZAIKOREC.Dan, Right(Location, 2))          '段
        Call UniCode_Conv(ZAIKOREC.JGYOBU, JGYOBU)                      '事業部
        Call UniCode_Conv(ZAIKOREC.NAIGAI, NAIGAI)                      '内外
        Call UniCode_Conv(ZAIKOREC.HIN_GAI, HIN_GAI)                    '品番（外部）
        Call UniCode_Conv(ZAIKOREC.GOODS_ON, "1")                       '商品／未商品
                                                                        '入荷日
        Call UniCode_Conv(ZAIKOREC.NYUKA_DT, StrConv(tmpZAIKOREC.NYUKA_DT, vbUnicode))
                                                                        '入庫日
        Call UniCode_Conv(ZAIKOREC.NYUKO_DT, StrConv(tmpZAIKOREC.NYUKO_DT, vbUnicode))
                                                                        '品番（内部）
        Call UniCode_Conv(ZAIKOREC.HIN_NAI, StrConv(tmpZAIKOREC.HIN_NAI, vbUnicode))
                                                                        '有効在庫数
        Call UniCode_Conv(ZAIKOREC.YUKO_Z_QTY, StrConv(tmpZAIKOREC.YUKO_Z_QTY, vbUnicode))
        Call UniCode_Conv(ZAIKOREC.LOCK_F, LOCK_OFF)                   '排他フラグ
        Call UniCode_Conv(ZAIKOREC.WEL_ID, "")                         '使用中子機ID
        Call UniCode_Conv(ZAIKOREC.PRG_ID, "")                         '使用中ﾌﾟﾛｸﾞﾗﾑ
        Call UniCode_Conv(ZAIKOREC.GOODS_YMD, Format(Now, "YYYYMMDD"))  '商品化日付


    '----------------   2010.07.08 ▽
                    Call UniCode_Conv(ZAIKOREC.GENSANKOKU, StrConv(tmpZAIKOREC.GENSANKOKU, vbUnicode))
                    Call UniCode_Conv(ZAIKOREC.SHIIRE_WORK_CENTER, StrConv(tmpZAIKOREC.SHIIRE_WORK_CENTER, vbUnicode))
                    Call UniCode_Conv(ZAIKOREC.ID_NO2, StrConv(tmpZAIKOREC.ID_NO2, vbUnicode))
                    Call UniCode_Conv(ZAIKOREC.YOSAN_FROM, StrConv(tmpZAIKOREC.YOSAN_FROM, vbUnicode))
                    Call UniCode_Conv(ZAIKOREC.YOSAN_TO, StrConv(tmpZAIKOREC.YOSAN_TO, vbUnicode))
    '----------------   2010.07.08 △



        Call UniCode_Conv(ZAIKOREC.FILLER, "")

        RETRY_CNT = 0
'*------------------------------------------------------'在庫データ出力
        Do
            sts = BTRV(BtOpInsert, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K0_ZAIKO, Len(K0_ZAIKO), 0)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                'リトライ回数チェック
                    If RETRY_SU <> 0 Then

                        RETRY_CNT = RETRY_CNT + 1
                        If RETRY_CNT > RETRY_SU Then
                                '回数オーバー
                            Call File_Error(sts, Upd_com, "在庫データ", 0)
                            GOODS_ONOFF_Update_Proc = SYS_CANCEL
                            Exit Function

                        End If

                    End If
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                Case Else
                    Call File_Error(sts, BtOpInsert, "在庫データ")
                    GOODS_ONOFF_Update_Proc = SYS_ERR
                    Exit Function

            End Select
        Loop

'*------------------------------------------------------'在庫（一時データ）削除
        Do
            sts = BTRV(BtOpDelete, tmpZAIKO_POS, tmpZAIKOREC, Len(tmpZAIKOREC), K0_tmpZAIKO, Len(K0_tmpZAIKO), 0)
        
        
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                'リトライ回数チェック
                    If RETRY_SU <> 0 Then

                        RETRY_CNT = RETRY_CNT + 1
                        If RETRY_CNT > RETRY_SU Then
                                '回数オーバー
                            Call File_Error(sts, BtOpDelete, "在庫データ（一時データ）", 0)
                            GOODS_ONOFF_Update_Proc = SYS_CANCEL
                            Exit Function

                        End If

                    End If

'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                Case Else
                    Call File_Error(sts, BtOpDelete, "在庫データ（一時データ）")
                    GOODS_ONOFF_Update_Proc = SYS_ERR
                    Exit Function

            End Select
        
        Loop


        com = BtOpGetNext
    
    Loop
                
    
    
    GOODS_ONOFF_Update_Proc = False

End Function
Public Function RETURNED_GOODS_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　良品返品』
'   2007.09.12
'
'
'       2012.03.25  frm より　移管
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim Tanaban         As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07
Dim DEN_NO          As String * 6
Dim SEQ_NO          As String * 3

Dim ST_TANABAN      As String * 11


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    RETURNED_GOODS_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                RETURNED_GOODS_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
        
            If Trim(StrConv(ITEMREC.ST_SOKO, vbUnicode)) = "" Then
                ST_TANABAN = ""
            Else
                ST_TANABAN = StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & _
                                StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & _
                                StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & _
                                StrConv(ITEMREC.ST_DAN, vbUnicode)
            End If
        
            '-----------------------------------------------送信テキスト作成
        
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Hinban = Hinban                    '品番をセーブ
                                                        
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                                    '商品化有無をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(ITEMREC.GOODS_KBN, vbUnicode)
                                                        
                                                        
                                                        
                                                        
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>  2017.09.22
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            '>>>>>  2017.09.22
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            '2010.12.07
'            Send_Text.Box_Type(1).Max_Size = "08"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
            Send_Text.Box_Type(1).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "20"
            '2010.12.07
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                                    'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban & " " & ST_TANABAN)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban & " " & ST_TANABAN)
                                                                    '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(2).Max_Size = "16"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "16"
                                                                    
            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(QTY, "#")))) & Format(QTY, "#"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(QTY, "#")))) & Format(QTY, "#"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(QTY, "#"))) & Format(QTY, "#")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(QTY, "#"))) & Format(QTY, "#")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_DEN_No)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_DEN_No)
                                                                    '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 5, "00")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 5, "00")
                                                                    '入力桁数
            Send_Text.Box_Type(4).Max_Size = "06"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "06"
                                                                    
            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（棚番／数量／伝票№）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                        '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                        
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                    RETURNED_GOODS_OSAKA_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 混載チェック
                            If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                                If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                    StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")      '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")  '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    RETURNED_GOODS_OSAKA_Proc = False
                                    Exit Function
                                End If
                            End If
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                        
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22

                            
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                    RETURNED_GOODS_OSAKA_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                    
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                                    
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                        
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                
                                RETURNED_GOODS_OSAKA_Proc = False
                                Exit Function
                            End If
                    
                    
                        End If
            
            
            
                    Case LCD_Suryo          '数量
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            RETURNED_GOODS_OSAKA_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            RETURNED_GOODS_OSAKA_Proc = False
                            Exit Function
                        End If
            
            
                
                
                    Case LCD_DEN_No         '伝票№
                
                        If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) = "" Then
                        
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "伝票№エラー", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "伝票№エラー", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            RETURNED_GOODS_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        
                        If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            If CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 0 Then
                            Else
                                DEN_NO = Format(CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))), "000000")
                            End If
                        End If
                 
                
                
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                        
                                        
                                                'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                                
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                                
                                                
            If ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = GOODS_ON Then
                MI_QTY = QTY
                SUMI_QTY = 0
            Else
                MI_QTY = 0
                SUMI_QTY = QTY
            End If
                                                
                                                
                                                
                                                '入庫更新
            sts = Nyuko_OSAKA_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    Format(Now, "YYYYMMDD"), _
                                    Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    "9", DEN_NO, 0, FILE_RETRY, , MENU_NO)
                                    
            Select Case sts
                Case False
                Case True           '入庫時は発生しない
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                    RETURNED_GOODS_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Sendbuf = Text_Create_Proc()
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    RETURNED_GOODS_OSAKA_Proc = SYS_ERR    'システム異常発生
                    
                    GoTo Abort_Tran
            End Select
                                        
                                        
                                        
End_Tran:
                                            'トランザクション終了
        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        If sts <> BtNoErr Then
            Call Err_Send_Proc("システム異常発生", "", "", "", "")
            Sendbuf = Text_Create_Proc()
            Call File_Error(sts, BtOpEndTransaction, "", 0)
            GoTo Abort_Tran
        End If
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    RETURNED_GOODS_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function Location_Move_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『棚移動指定時のチェック＆更新処理』
'
'       2012.03.25  frm より　移管
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

'Dim FROM_Tanaban    As String * 8      '2018.07.02
'Dim TO_Tanaban      As String * 8      '2018.07.02

Dim FROM_Tanaban    As String * 20      '2018.07.02
Dim TO_Tanaban      As String * 20      '2018.07.02


'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2
    
    Location_Move_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(FROM_Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Location_Move_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                            'Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))         '2018.09.18
                            Call UniCode_Conv(K0_TANA.Dan, Mid(FROM_Tanaban, 7, 2))         '2018.09.18
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    If Len(Trim(TO_Tanaban)) < 8 Then
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, TO_Tanaban, "棚番エラー", "", "")    '2017.09.22
                                    Else
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    End If
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Location_Move_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                                
                                If Len(Trim(FROM_Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, FROM_Tanaban, "棚使用不可", "", "")   '2017.09.22
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Mid(FROM_Tanaban, 7, 2), "棚使用不可", "", "")   '2017.09.22 -- >2018.09.18
                                End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Location_Move_Proc = False
                                Exit Function
                            End If
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(FROM_Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            FROM_Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            If Len(Trim(FROM_Tanaban)) < 8 Then
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, FROM_Tanaban, "棚番エラー", "", "")    '2017.09.22
                                            Else
                                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22-->2018.09.18 DEL
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Mid(FROM_Tanaban, 7, 2), "棚番エラー", "", "")   '2018.09.18
                                            End If
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            Location_Move_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Location_Move_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
        
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    'Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    If Len(Trim(FROM_Tanaban)) < 8 Then
                        Call Err_Send_Proc("在庫使用中", FROM_Tanaban, Hinban, "", "")
                    Else
                        Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Mid(FROM_Tanaban, 7, 2), Hinban, "", "") '2018.09.18
                    End If
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Location_Move_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                
                '有効桁数により棚番の編集を変える   '2017.09.23
                'Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                If Len(Trim(FROM_Tanaban)) < 8 Then
                    Call Err_Send_Proc("有効在庫無し", FROM_Tanaban, Hinban, "", "")
                Else
                    Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Mid(FROM_Tanaban, 7, 2), Hinban, "", "")   '2018.09.18
                End If
                '有効桁数により棚番の編集を変える   '2017.09.23
                
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                Location_Move_Proc = False
                Exit Function
            End If
        
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban       '棚番をセーブ
            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
            
            
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
            
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>>>>   2017.09.22
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            '>>>>>>>>   2017.09.22
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            '有効桁数により棚番の編集を変える   '2017.09.23
'            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
'                            Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
'
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
'                            Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
                                                            
            If Len(Trim(FROM_Tanaban)) < 8 Then
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, FROM_Tanaban)
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, FROM_Tanaban)
            Else
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
            End If
            '有効桁数により棚番の編集を変える   '2017.09.23
                                                            
                                                            
                                                            
                                                            
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Suryo & ":" & Format(SUMI_QTY + MI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Suryo & ":" & Format(SUMI_QTY + MI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_To_Tanaban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_To_Tanaban)
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = "01"          '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（移動先棚番）
            
            
            
            For i = 0 To M_Gyo - 1
            
                
'2018.07.02                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case i       '2018.07.02
            
'2018.07.02                    'Case LCD_To_Tanaban         '移動先棚番
                    Case 4         '2018.07.02移動先棚番
                    
                    
                        TO_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(FROM_Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(TO_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2), "倉庫エラー", "", "")     '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2), "倉庫エラー", "", "") '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Location_Move_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 混載チェック
                            If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                                If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                    StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")      '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")  '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Location_Move_Proc = False
                                    Exit Function
                                End If
                            End If
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(TO_Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(TO_Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(TO_Tanaban, 5, 2))
                            'Call UniCode_Conv(K0_TANA.Dan, Right(TO_Tanaban, 2))       '2018.09.18
                            Call UniCode_Conv(K0_TANA.Dan, Mid(TO_Tanaban, 7, 2))       '2018.09.18
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    If Len(Trim(TO_Tanaban)) < 8 Then
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, TO_Tanaban, "棚番エラー", "", "")    '2017.09.22
                                    Else
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Mid(TO_Tanaban, 7, 2), "棚番エラー", "", "")   '2017.09.22--> 2018.09.18
                                    End If
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Location_Move_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                                If Len(Trim(TO_Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, TO_Tanaban, "棚使用不可", "", "")    '2017.09.22
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Mid(TO_Tanaban, 7, 2), "棚使用不可", "", "")   '2017.09.22 -->2018.09.18
                                End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Location_Move_Proc = False
                                Exit Function
                            End If
            
                            '------------------ From To のチェック  2016.05.10
                            If ID_KANRI_TBL(ING_No).Tanaban = TO_Tanaban Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "入庫棚と出庫棚が", "同じです。", "")        '2107.09.22
                                
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "入庫棚と出庫棚が", "同じです。", "")    '2017.09.22
                                If Len(Trim(TO_Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, TO_Tanaban, "入庫棚と出庫棚が", "同じです。", "")    '2017.09.22
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Mid(TO_Tanaban, 7, 2), "入庫棚と出庫棚が", "同じです。", "")   '2017.09.22--> 2018.09.18
                                End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Location_Move_Proc = False
                                Exit Function
                            
                            End If
            
            
            
            
                        End If
                    
                    
                    
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    TO_Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    ID_KANRI_TBL(ING_No).Send_SUMI_QTY, _
                                    ID_KANRI_TBL(ING_No).Send_MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")       '2017.09.22
                    
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    If Len(Trim(ID_KANRI_TBL(ING_No).Tanaban)) < 8 Then
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Tanaban, ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    Else
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    End If
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Location_Move_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Location_Move_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Location_Move_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Location_Move_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function JAN_SET_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『品番(JAN)登録処理』
'
'   2011.08.05
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts         As Integer
Dim i           As Integer
Dim Hinban      As String
Dim JAN_CODE    As String

Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1

Dim MENU_NO     As String * 2   '2008.08.08



    JAN_SET_Proc = True

    
    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
    
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    
           
                    Case LCD_Hinban         '品番
                        
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        '------------------ 品目マスタ読込み
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "マスタに品番が", "登録されていません。", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                JAN_SET_Proc = False
                                Exit Function
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI
                
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        If Trim(StrConv(ITEMREC.JAN_CODE, vbUnicode)) = "" Then
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_JAN_CODE)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_JAN_CODE)
                        Else
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(StrConv(ITEMREC.JAN_CODE, vbUnicode)))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(StrConv(ITEMREC.JAN_CODE, vbUnicode)))
                        End If
                        
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                
                End Select
            Next i
    
        Case Step_Sagyo2_RES        '１回目の受信（JANｺｰﾄﾞ）
    
            If Trim(ID_KANRI_TBL(ING_No).Recv_text(2)) = "" Then
                ID_KANRI_TBL(ING_No).Recv_text(2) = StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, vbUnicode)
            End If
    
    
    
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    
           
                    Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, vbUnicode)), LCD_JAN_CODE  'JANCODE
                        
                        JAN_CODE = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        If Not IsNumeric(JAN_CODE) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, JAN_CODE, "読み込んだJANｺｰﾄﾞに", "誤りが有ります。", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            JAN_SET_Proc = False
                            Exit Function
                        End If
                        
                        
                        '------------------ 品目マスタ読込み
                        
                        If WEL_Para_Tbl(Ti, Tj).Wel_Para(2).LCD <> StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, vbUnicode) Then
                        
                        
                        
                        
                        
                            Call UniCode_Conv(K4_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).S_JGYOBU)
                            Call UniCode_Conv(K4_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).S_NAIGAI)
                            Call UniCode_Conv(K4_ITEM.JAN_CODE, JAN_CODE)
                                            
                            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K4_ITEM, Len(K4_ITEM), 4)
                            Select Case sts
                                Case BtNoErr
                                
                                '   -------------------------------- エラーメッセージ作成
                                    
                                    If Trim(ID_KANRI_TBL(ING_No).Hinban) <> Trim(StrConv(ITEMREC.HIN_GAI, vbUnicode)) Then
                                    
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, JAN_CODE, "他品番で登録済みです", "", "")
                                    
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                
                                        JAN_SET_Proc = False
                                        Exit Function
                                    
                                    End If
                                
                                Case BtErrKeyNotFound
                                
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                    Exit Function
                            End Select
                    
                    
                            '----------------------------------- データ更新処理開始 -----------
                            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).S_JGYOBU)
                            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).S_NAIGAI)
                            Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).Hinban)
                    
                            Do
                                '------------------ 品目マスタ読込み
                                sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                    '   -------------------------------- エラーメッセージ作成
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                                            
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                
                                        JAN_SET_Proc = False
                                        Exit Function
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    '   -------------------------------- エラーメッセージ作成
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "他端末で使用中", "", "")
                                            
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        
                                        JAN_SET_Proc = False
                                        Exit Function
                                    Case Else
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                        Exit Function
                                End Select
                            
                            Loop
                                                                'JANｺｰﾄﾞ設定
                            
                            
                            If Trim(JAN_CODE) = Trim(StrConv(ITEMREC.JAN_CODE, vbUnicode)) Then
                            Else
                                If Trim(JAN_CODE) = "0" Then
                                    Call UniCode_Conv(ITEMREC.JAN_CODE, "")
                                Else
                                    Call UniCode_Conv(ITEMREC.JAN_CODE, JAN_CODE)
                                End If
                                '>>>>>>>>   2017.12.09
                                'Call UniCode_Conv(ITEMREC.UPD_TANTO, "11010")
                                Call UniCode_Conv(ITEMREC.UPD_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                'Call UniCode_Conv(ITEMREC.UPD_TANTO, Format(Now, "YYYYMMDD"))
                                Call UniCode_Conv(ITEMREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMDD"))
                                '>>>>>>>>   2017.12.09
                            End If
                                                                
                                                                
                            Do
                                '------------------ 品目マスタ更新
                                sts = BTRV(BtOpUpdate, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    '   -------------------------------- エラーメッセージ作成
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "他端末で使用中", "", "")
                                            
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        
                                        JAN_SET_Proc = False
                                        Exit Function
                                    Case Else
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                        Exit Function
                                End Select
                            Loop
                        End If
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                        If Trim(MENU_NO) = "" Then
                        Else
                        '作業ﾛｸﾞ出力
                                
                            If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                                ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                                ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                                MENU_NO, _
                                                                (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                                ID_KANRI_TBL(ING_No).Hinban, , , , , , , , , , , , , JAN_CODE) Then
                                JAN_SET_Proc = SYS_ERR
                                Exit Function
                            End If
                        End If
                                                            '次の作業要求
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        Sendbuf = Text_Create_Proc()
                        JAN_SET_Proc = False
                        Exit Function
                End Select
            Next i
                
                
                
    End Select
    
    
    
    
    JAN_SET_Proc = False
    

End Function
Public Function Out_Plan_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『計画外（データ無し）の出荷処理』
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim i               As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim Tanaban         As String * 8
Dim sts             As Integer

Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2
    
    Out_Plan_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Tanaban        '棚番
                Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                
                If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                Else
                '------------------ 倉庫マスタ読込み
                    Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                    sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                            Out_Plan_Proc = False
                            Exit Function
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                            Exit Function
                    End Select
                    '------------------ 混載チェック
                    If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                        If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                            StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")      '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")  '2017.09.22
                             
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                             
                             Out_Plan_Proc = False
                            Exit Function
                        End If
                    End If
                    '------------------ 棚マスタ読込み
                    Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                    Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                    Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                    Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Out_Plan_Proc = False
                            Exit Function
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                            Exit Function
                    End Select
            
                    '------------------ 禁止棚のチェック
                    If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2107.09.22
                
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                        Out_Plan_Proc = False
                        Exit Function
                    End If
            
                End If
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                '------------------ 品目マスタ読込み
'                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                        If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                            Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                    Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Out_Plan_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                        End If
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")   '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Out_Plan_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
            
            Case LCD_Suryo          '数量
                If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Out_Plan_Proc = False
                    Exit Function
                End If
                
                SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                If SYUKA_QTY = 0 Then
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Out_Plan_Proc = False
                    Exit Function
                End If
            
            
        
        End Select
    Next i
    '----------------------------------- データ更新処理開始 -----------
                                        
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Exit Function
    End If
                                        
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
                                        
                                        '出庫更新
    sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                            ID_KANRI_TBL(ING_No).NAIGAI, _
                            Hinban, _
                            "", _
                            Tanaban, _
                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                            SUMI_QTY, _
                            MI_QTY, _
                            SYUKA_QTY, _
                            Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                            ID_KANRI_TBL(ING_No).TANTO_CODE, _
                            FILE_RETRY, _
                            "", _
                            ID_KANRI_TBL(ING_No).CYU_KBN, _
                            ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                            Format(Now, "YYYYMMDD"), _
                            "", _
                            "", MENU_NO)

    Select Case sts
        Case False
        
        Case True       '在庫不足時に発生
            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "在庫数不足", "")        '2017.09.22
            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "在庫数不足", "")    '2017.09.22
            Sendbuf = Text_Create_Proc()
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
            Out_Plan_Proc = False
            GoTo Abort_Tran
        Case SYS_CANCEL
            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
            Sendbuf = Text_Create_Proc()
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
            Out_Plan_Proc = False
            GoTo Abort_Tran
        Case SYS_ERR
            Call Err_Send_Proc("システム異常発生", "", "", "", "")
            Sendbuf = Text_Create_Proc()
            Out_Plan_Proc = SYS_ERR    'システム異常発生
            
            GoTo Abort_Tran
    End Select


End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        GoTo Abort_Tran
    End If
                                        '次の作業要求
    
    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
    Select Case sts
        Case BtNoErr
        '   -------------------------------- エラーメッセージ作成
        Case Else
        '重要な要因なので未登録はシステム停止とする
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
        Exit Function
    End Select
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
    If Sagyo_Send_Proc() Then
        Sendbuf = Text_Create_Proc()
        Exit Function
    End If
            
    Sendbuf = Text_Create_Proc()
    
    
    
    Out_Plan_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function Suii_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『出荷推移表示処理』
'
'       2012.03.25  frm より　移管
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1


Dim SUMI_QTY    As Long
Dim MI_QTY      As Long




Dim Start_YMD   As String * 8
Dim End_YMD     As String * 8
Dim Save_YMD    As String * 6
Dim SYUKA_QTY   As Long


Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag


Dim DATA_CNT    As Integer

Dim MENU_NO     As String * 2   '2008.08.08


    Suii_Proc = True

    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & B7_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & B7_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 31 To 28 Step -1
        Start_YMD = Left(Format(DateAdd("m", -1, Now), "YYYYMMDD"), 6) & Format(i, "00")
        If IsDate(Left(Start_YMD, 4) & "/" & Mid(Start_YMD, 5, 2) & "/" & Right(Start_YMD, 2)) Then
            Exit For
        End If
    Next i

'    Start_YMD = Left(Format(DateAdd("m", -1, Now), "YYYYMMDD"), 6) & "31"
    
    End_YMD = Left(Format(DateAdd("m", -11, (Left(Start_YMD, 4) & "/" & Mid(Start_YMD, 5, 2) & "/" & Right(Start_YMD, 2))), "YYYYMMDD"), 6) & "01"

    Save_YMD = ""

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                    
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Suii_Proc = False
                        Exit Function
                    
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                
                End Select
                                    
                                    '空読みしてデータ件数獲得
                
                Call UniCode_Conv(K1_IDO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K1_IDO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K1_IDO.HIN_GAI, Hinban)
                Call UniCode_Conv(K1_IDO.JITU_DT, Start_YMD)
                Call UniCode_Conv(K1_IDO.JITU_TM, "zzzzzz")
                
                DATA_CNT = 0
                
                com = BtOpGetLess
                
                
                Do
                    
                    sts = BTRV(com, IDO_POS, IDOREC, Len(IDOREC), K1_IDO, Len(K1_IDO), 1)
                    Select Case sts
                        Case BtNoErr
                            '事業部／内外／品番ブレーク？
                            If StrConv(IDOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                                StrConv(IDOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                                Trim(StrConv(IDOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                                
                                If Len(Trim(Save_YMD)) <> 0 Then
                                    DATA_CNT = DATA_CNT + 1
                                End If
                                
                                Exit Do
                            
                            End If
                            '日付？
                            If StrConv(IDOREC.JITU_DT, vbUnicode) < End_YMD Then
                                
                                If Len(Trim(Save_YMD)) <> 0 Then
                                    DATA_CNT = DATA_CNT + 1
                                End If
                                
                                Exit Do
                            End If
                        
                        Case BtErrEOF
                            If Len(Trim(Save_YMD)) <> 0 Then
                                DATA_CNT = DATA_CNT + 1
                            End If
                            
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫移動歴", 0)
                            Exit Function
                    End Select
                    
                    
                    If Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_KEI Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_HYO Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_GAI Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID2 Then   'ACT_DENPYO_ID2 追加 2015.02.11
                        
                        
                        If Len(Trim(Save_YMD)) = 0 Then
                            Save_YMD = Left(StrConv(IDOREC.JITU_DT, vbUnicode), 6)
                        End If
                        If Save_YMD <> Left(StrConv(IDOREC.JITU_DT, vbUnicode), 6) Then
                            DATA_CNT = DATA_CNT + 1
                            Save_YMD = Left(StrConv(IDOREC.JITU_DT, vbUnicode), 6)
                        End If
                    
                    
                    
                    End If
                    
                    com = BtOpGetPrev
                Loop
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
                SendFileRec.Title = "0"     'タイトル行
                'Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME & Format(DATA_CNT, "#0") & "件")                '2017.09.22
                Call UniCode_Conv(SendFileRec.LCD, Left(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, 5) & Format(DATA_CNT, "#0") & "件")   '2017.09.22
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                SendFileRec.Title = "0"     '品番
                Call UniCode_Conv(SendFileRec.LCD, Hinban)
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                    
                    
                Save_YMD = ""
                    
                Call UniCode_Conv(K1_IDO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K1_IDO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K1_IDO.HIN_GAI, Hinban)
                Call UniCode_Conv(K1_IDO.JITU_DT, Start_YMD)
                Call UniCode_Conv(K1_IDO.JITU_TM, "zzzzzz")
                
                com = BtOpGetLess
                
                
                Do
                    
                    sts = BTRV(com, IDO_POS, IDOREC, Len(IDOREC), K1_IDO, Len(K1_IDO), 1)
                    Select Case sts
                        Case BtNoErr
                            '事業部／内外／品番ブレーク？
                            If StrConv(IDOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                                StrConv(IDOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                                Trim(StrConv(IDOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                                
                                If Len(Trim(Save_YMD)) <> 0 Then
                                    SendFileRec.Title = "1"
                                    Call UniCode_Conv(SendFileRec.LCD, Left(Save_YMD, 4) & "/" & Right(Save_YMD, 2) & _
                                                        Space(13 - Len(Format(SYUKA_QTY, "#0"))) & _
                                                        Format(SYUKA_QTY, "#0"))
                                    SendFileRec.CRLF = vbCrLf
                                    Put #FileNo, , SendFileRec
                                End If
                                
                                Exit Do
                            
                            End If
                            '日付？
                            If StrConv(IDOREC.JITU_DT, vbUnicode) < End_YMD Then
                                
                                If Len(Trim(Save_YMD)) <> 0 Then
                                    SendFileRec.Title = "1"
                                    Call UniCode_Conv(SendFileRec.LCD, Left(Save_YMD, 4) & "/" & Right(Save_YMD, 2) & _
                                                        Space(13 - Len(Format(SYUKA_QTY, "#0"))) & _
                                                        Format(SYUKA_QTY, "#0"))
                                    SendFileRec.CRLF = vbCrLf
                                    Put #FileNo, , SendFileRec
                                End If
                                
                                Exit Do
                            End If
                        
                        Case BtErrEOF
                            If Len(Trim(Save_YMD)) <> 0 Then
                                SendFileRec.Title = "1"
                                Call UniCode_Conv(SendFileRec.LCD, Left(Save_YMD, 4) & "/" & Right(Save_YMD, 2) & _
                                                    Space(13 - Len(Format(SYUKA_QTY, "#0"))) & _
                                                    Format(SYUKA_QTY, "#0"))
                                SendFileRec.CRLF = vbCrLf
                                Put #FileNo, , SendFileRec
                            End If
                            
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫移動歴", 0)
                            Exit Function
                    End Select
                    
                    
                    If Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_KEI Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_HYO Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_GAI Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID2 Then       'ACT_DENPYO_ID2 追加　2015.02.21
                        
                        
                        If Len(Trim(Save_YMD)) = 0 Then
                            Save_YMD = Left(StrConv(IDOREC.JITU_DT, vbUnicode), 6)
                            SYUKA_QTY = 0
                        End If
                        If Save_YMD <> Left(StrConv(IDOREC.JITU_DT, vbUnicode), 6) Then
                                
                            SendFileRec.Title = "1"
                            Call UniCode_Conv(SendFileRec.LCD, Left(Save_YMD, 4) & "/" & Right(Save_YMD, 2) & _
                                                Space(13 - Len(Format(SYUKA_QTY, "#0"))) & _
                                                Format(SYUKA_QTY, "#0"))
                            SendFileRec.CRLF = vbCrLf
                            Put #FileNo, , SendFileRec
                            
                            Save_YMD = Left(StrConv(IDOREC.JITU_DT, vbUnicode), 6)
                            SYUKA_QTY = 0
                                                
                        End If
                    
                        SYUKA_QTY = SYUKA_QTY + (CLng(StrConv(IDOREC.SUMI_JITU_QTY, vbUnicode)) + CLng(StrConv(IDOREC.MI_JITU_QTY, vbUnicode)))
                    
                    
                    End If
                    
                    com = BtOpGetPrev
                Loop
        
                Close #FileNo
        
        
        End Select
    Next i
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = B7_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.FileName = B7_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１～５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Suii_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    Suii_Proc = False
    

End Function
Public Function Tana_Hin_Shogo_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『棚番別品番別在庫照合処理』
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim Tanaban         As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MEMO            As String

Dim MENU_NO         As String * 2
    
    Tana_Hin_Shogo_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then     '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Tana_Hin_Shogo_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 混載チェック
                            If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                                If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                    StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")      '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")  '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Tana_Hin_Shogo_Proc = False
                                    Exit Function
                                End If
                            End If
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    If Len(Trim(Tanaban)) < 8 Then
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")    '2017.09.22
                                    Else
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    End If
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Tana_Hin_Shogo_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
            
                            '------------------ 禁止棚のチェック
'                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
'
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(To_Tanaban, 2) & "-" & Mid(To_Tanaban, 3, 2) & "-" & Mid(To_Tanaban, 5, 2) & "-" & Right(To_Tanaban, 2), "棚使用不可", "", "")
'
'                                SendBuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                Ido_In_Proc = False
'                                Exit Function
'                            End If
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            
                                            
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            If Len(Trim(Tanaban)) < 8 Then
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")    '2017.09.22
                                            Else
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            End If
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            Tana_Hin_Shogo_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Tana_Hin_Shogo_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            '   -------------------------------- 在庫数集計
            If Zaiko_Syukei_Proc(SUMI_QTY, _
                                    MI_QTY, _
                                    RET_JGYOBU, _
                                    RET_NAIGAI, _
                                    Hinban, _
                                    Tanaban) Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            '   -------------------------------- 送信テキスト作成
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = Tanaban          '棚番をセーブ
            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
            
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
                                                        
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>> 2017.09.22
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            '>>>>>> 2017.09.22
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            '有効桁数により棚番の編集を変える   '2017.09.23
'            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
'                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
'
'
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
'                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                            
                                                            
            If Len(Trim(Tanaban)) < 8 Then
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Tanaban)
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Tanaban)
                                                            
            Else
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                            
            End If
            '有効桁数により棚番の編集を変える   '2017.09.23
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
            '2010.12.07
'            Send_Text.Box_Type(2).Max_Size = "13"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
            '2010.12.07
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Tana_Hin_Shogo_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
            
            
                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Tana_Hin_Shogo_Proc = False
                            Exit Function
                        End If
                
                
                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            
                        Else
                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        
                        End If
        
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                        '品目マスタ読込み
'            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'            Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).Hinban)
'            Do
'                sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                Select Case sts
'                    Case BtNoErr
'                        Exit Do
'                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'                    '   -------------------------------- エラーメッセージ作成
'                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")
'
'                        SendBuf = Text_Create_Proc()
'                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                        Hin_Shogo_Proc = False
'                        GoTo Abort_Tran
'                    Case BtErrKeyNotFound
'                    '   -------------------------------- エラーメッセージ作成
'                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品番未登録", "", "")
'
'                        SendBuf = Text_Create_Proc()
'                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                        Hin_Shogo_Proc = False
'                        GoTo Abort_Tran
'                    Case Else
'                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                        SendBuf = Text_Create_Proc()
'                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目マスタ", 0)
'                        Hin_Shogo_Proc = SYS_ERR
'                        GoTo Abort_Tran
'                End Select
'
'            Loop
'                                        '最終照合日付
'            Call UniCode_Conv(ITEMREC.LAST_CHK_DT, Format(Date, "yyyymmdd"))
'                                        '最終照合在庫数
'            Call UniCode_Conv(ITEMREC.LAST_CHK_QTY, Format(SUMI_QTY + MI_QTY, "00000000"))
'                                        '品目マスタ書き込み
'            Do
'                sts = BTRV(BtOpUpdate, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                Select Case sts
'                    Case BtNoErr
'                        Exit Do
'                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'
'                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")
'
'                        SendBuf = Text_Create_Proc()
'                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                        Hin_Shogo_Proc = False
'                        GoTo Abort_Tran
'
'                    Case Else
'                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                        SendBuf = Text_Create_Proc()
'                        Call File_Error(sts, BtOpUpdate, "品目マスタ", 0)
'                        Hin_Shogo_Proc = SYS_ERR
'                        GoTo Abort_Tran
'                End Select
'            Loop
        
            If (SUMI_QTY + MI_QTY) = (ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY) Then
                MEMO = B8_MEMO & StrConv(Format((SUMI_QTY + MI_QTY), "#0"), vbWide) & "[OK]"
            Else
                MEMO = B8_MEMO & StrConv(Format((ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY), "#0"), vbWide) & "[" & StrConv(Format(SUMI_QTY + MI_QTY, "#0"), vbWide) & "]"
            End If
                                
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                
'>>>>>>>    2017.09.21
'            sts = IDOREKI_OUTPUT_PROC(ID_KANRI_TBL(ING_No).Tanaban, _
'                                        "", _
'                                        ID_KANRI_TBL(ING_No).S_JGYOBU, _
'                                        ID_KANRI_TBL(ING_No).S_NAIGAI, _
'                                        ID_KANRI_TBL(ING_No).Hinban, _
'                                        "", _
'                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
'                                        0, _
'                                        0, _
'                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
'                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                        FILE_RETRY, _
'                                        , _
'                                        MEMO, , , , , MENU_NO)

            sts = IDOREKI_OUTPUT_PROC(ID_KANRI_TBL(ING_No).Tanaban, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        SUMI_QTY, _
                                        MI_QTY, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        MEMO, , , , , MENU_NO)

'>>>>>>>    2017.09.21
            
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Tana_Hin_Shogo_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        '次の作業要求
            
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Tana_Hin_Shogo_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function TANA_USE_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『棚使用状況設定処理』
'       2010.12.13
'
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts         As Integer
Dim i           As Integer
Dim Tanaban     As String


Dim MENU_NO     As String * 2
Dim Tana_Use    As String




    TANA_USE_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番）

            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    
                    Case LCD_Tanaban        '棚番
                        Tanaban = Trim(Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1))
                                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                        
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                TANA_USE_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                            
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                TANA_USE_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).Tanaban = Tanaban
                                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "棚番:" & ID_KANRI_TBL(ING_No).Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "棚番:" & ID_KANRI_TBL(ING_No).Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                        If IsNumeric(StrConv(TANAREC.Tana_Use, vbUnicode)) Then
                            Tana_Use = Format(CInt(StrConv(TANAREC.Tana_Use, vbUnicode)))
                        Else
                            
                            If Trim(StrConv(TANAREC.Tana_Use, vbUnicode)) = "." Then
                                Tana_Use = "."
                            Else
                                Tana_Use = "100"
                            End If
                        End If
                                                                                        
                                                                                        
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_TANA_USE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_TANA_USE)
                                                                                '数値初期表示
                        
                        If Tana_Use = "." Then
                            Send_Text.Box_Type(2).INIT = "."
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = "."
                        Else
                            Send_Text.Box_Type(2).INIT = Format(Tana_Use, "#0")
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = Format(Tana_Use, "#0")
                        End If
                                                                                        
                                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "14"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "14"
                                                                                        '入力桁数
                                                                                        
                        Send_Text.Box_Type(2).Max_Size = "03"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "03"
                                                                                        
                                                                                        
                                                                                        
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                        Sendbuf = Text_Create_Proc()
                
                
                
                
                End Select
            Next i
    
    
        Case Step_Sagyo2_RES        '２回目の受信（使用状況）
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 8)
            
            
            
                    Case LCD_TANA_USE    '使用状況
                       
                        If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) = "." Then
                            ID_KANRI_TBL(ING_No).Recv_text(i) = "0."
                        End If
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "使用状況入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "使用状況入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            TANA_USE_Proc = False
                            Exit Function
                        End If
                
                        
                
                        Tana_Use = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                    
''                        Select Case Tana_Use
''                            Case -1, 0, 30, 50, 70, 100
''                            Case Else
''
''
''                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "使用状況入力ミス", "", "")
''                                Sendbuf = Text_Create_Proc()
''                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
''
''                                TANA_USE_Proc = False
''                                Exit Function
''                        End Select
                
                
        
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                        '棚マスタ読込み
            Call UniCode_Conv(K0_TANA.SOKO_NO, Mid(ID_KANRI_TBL(ING_No).Tanaban, 1, 2))
            Call UniCode_Conv(K0_TANA.Retu, Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2))
            Call UniCode_Conv(K0_TANA.Ren, Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2))
            Call UniCode_Conv(K0_TANA.Dan, Mid(ID_KANRI_TBL(ING_No).Tanaban, 7, 2))
            
            
            
            Do
                sts = BTRV(BtOpGetEqual + BtSNoWait, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")     '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "") '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        TANA_USE_Proc = False
                        Exit Function
                    Case BtErrKeyNotFound
                    '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "棚番未登録", "", "")     '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "棚番未登録", "", "") '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        TANA_USE_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "棚マスタ", 0)
                        TANA_USE_Proc = SYS_ERR
                        Exit Function
                End Select
        
            Loop
                                        '使用状況
            If Tana_Use = "0." Then
                Call UniCode_Conv(TANAREC.Tana_Use, ".    ")
            Else
                Call UniCode_Conv(TANAREC.Tana_Use, Format(Tana_Use, "000"))
            End If
                                        '品目マスタ書き込み
            Do
                sts = BTRV(BtOpUpdate, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
            
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")     '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "") '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        TANA_USE_Proc = False
                        Exit Function
            
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpUpdate, "棚マスタ", 0)
                        TANA_USE_Proc = SYS_ERR
                        Exit Function
                End Select
            Loop
                                        'トランザクション終了
    
                                        
                                        
                                        
                                        
        '作業ﾛｸﾞ出力    2008.08.08
        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                    
        Else
                    
            MENU_NO = ""
        End If
        If Trim(MENU_NO) = "" Then
        Else
        '作業ﾛｸﾞ出力
            
            If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                ID_KANRI_TBL(ING_No).NAIGAI, _
                                                MENU_NO, _
                                                (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                , , , ID_KANRI_TBL(ING_No).Tanaban) Then
                TANA_USE_Proc = SYS_ERR
                Exit Function
            End If
        End If
        '作業ﾛｸﾞ出力    2008.08.08
                                            '次の作業要求
        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
        Select Case sts
            Case BtNoErr
            '   -------------------------------- エラーメッセージ作成
            Case Else
            '重要な要因なので未登録はシステム停止とする
            Call Err_Send_Proc("システム異常発生", "", "", "", "")
            Sendbuf = Text_Create_Proc()
            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
            Exit Function
        End Select
        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
        If Sagyo_Send_Proc() Then
            Sendbuf = Text_Create_Proc()
            Exit Function
        End If
                
        Sendbuf = Text_Create_Proc()
    End Select
    
    
    TANA_USE_Proc = False
    

End Function
Public Function Zaiko_Seisa_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『在庫精査時のチェック＆更新処理』
'       2008.11.20
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim Tanaban         As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Zaiko_Seisa_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Zaiko_Seisa_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 混載チェック
                        If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                            If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")  '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Zaiko_Seisa_Proc = False
                                Exit Function
                            End If
                        End If
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                
                                
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                If Len(Trim(Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")    '2017.09.22
                                Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Zaiko_Seisa_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
            
            
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                        
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                            '有効桁数により棚番の編集を変える   '2017.09.23
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                            If Len(Trim(Tanaban)) < 8 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚使用不可", "", "")    '2017.09.22
                            Else
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                            End If
                            '有効桁数により棚番の編集を変える   '2017.09.23
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Zaiko_Seisa_Proc = False
                            Exit Function
                        End If
            
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            If Len(Trim(Tanaban)) < 8 Then
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")    '2017.09.22
                                            Else
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            End If
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            
                                            
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            Zaiko_Seisa_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Zaiko_Seisa_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
        
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    'Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                    If Len(Trim(Tanaban)) < 8 Then
                        Call Err_Send_Proc("在庫使用中", Tanaban, Hinban, "", "")
                    Else
                        Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                    End If
                    '有効桁数により棚番の編集を変える   '2017.09.23
                    
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Zaiko_Seisa_Proc = False
                    Exit Function
            End Select
                    
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = Tanaban          '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
                                                        
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                        
                                                        
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>> 2017.09.22
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            
            '>>>>>> 2017.09.22
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            
            '有効桁数により棚番の編集を変える   '2017.09.23
'            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
'                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
'
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
'                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                            
                                                            
            If Len(Trim(Tanaban)) < 8 Then
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Tanaban)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Tanaban)
            
            Else
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
            End If
            '有効桁数により棚番の編集を変える   '2017.09.23
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
            '2010.12.07
'            Send_Text.Box_Type(2).Max_Size = "13"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
            '2010.12.07
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Zaiko_Seisa_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Zaiko_Seisa_Proc = False
                            Exit Function
                        End If
            
            
                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")        '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Zaiko_Seisa_Proc = False
                            Exit Function
                        End If
                
                
                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        Else
                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        End If
        
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
                    
        
        
        
        
            sts = Zaiko_Seisa_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    ID_KANRI_TBL(ING_No).Send_SUMI_QTY, _
                                    ID_KANRI_TBL(ING_No).Send_MI_QTY, _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, _
                                    MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")       '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")   '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Zaiko_Seisa_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")        '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Zaiko_Seisa_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Zaiko_Seisa_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Zaiko_Seisa_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Private Function Zaiko_Seisa_Update_Proc(JGYOBU As String, _
                                        NAIGAI As String, _
                                        HIN_GAI As String, _
                                        Location As String, _
                                        BEF_SUMI_JITU_QTY As Long, _
                                        BEF_MI_JITU_QTY As Long, _
                                        AFT_SUMI_JITU_QTY As Long, _
                                        AFT_MI_JITU_QTY As Long, _
                                        ID As String, _
                                        TANTO_CODE As String, _
                                        Optional RETRY As Integer = 10, _
                                        Optional MENU_NO As String) As Integer











'****************************************************
'*      「在庫精査処理」
'*
'*  在庫データの更新を行う。
'*  (引数の設定ミスはこちらではチェックしない)
'*  使用ﾌｧｲﾙ    :   在庫データ
'*                  在庫データ(一時ファイル)
'*  引数：  事業部（省略不可）
'*          国内外（省略不可）
'*          品番外部(省略不可)
'*          棚番（XXXXXXXX(倉庫№+列+連+段)省略不可）
'*          修正前　商品化済み実績数（何れか一方必須）
'*          修正前　未商品実績数　　（　　〃　　　　）
'*          修正後　商品化済み実績数（何れか一方必須）
'*          修正後　未商品実績数　　（　　〃　　　　）
'*          ID(省略不可)
'*          担当者（省略不可）
'*          リトライ(省略可 １桁目:1=画面メッセージ有 0:無，２桁目:リトライ回数(0～9 0:無限))
'*          ﾒﾆｭｰ№  2008.08.08 (作業ﾛｸﾞ出力 ON/OFF)
'*  戻り値: false       :正常
'*          true        :継続可能な異常
'*          SYS_ERR     :継続できない異常
'*          SYS_CANCEL  :更新ｷｬﾝｾﾙ
'*
'*          2012.03.25  frm より　移管
'*
'****************************************************
Dim sts         As Integer
Dim com         As Integer
Dim Upd_com     As Integer


Dim RETRY_CNT   As Integer
Dim MESG_FLG    As Integer
Dim RETRY_SU    As Integer
    
Dim Zan_Qty     As Long
Dim WK_Qty      As Long
    
Dim TO_LOCATION As String
Dim wkMI_QTY    As Long
Dim wkSUMI_QTY  As Long
    

    Zaiko_Seisa_Update_Proc = True
                                                                      
                                                                      
    MESG_FLG = CInt(Mid(Format(RETRY, "00"), 1, 1))
    RETRY_SU = CInt(Mid(Format(RETRY, "00"), 2, 1))
    
    
    If BEF_SUMI_JITU_QTY = AFT_SUMI_JITU_QTY And BEF_MI_JITU_QTY = AFT_MI_JITU_QTY Then
        TO_LOCATION = ""
    Else
        TO_LOCATION = Location
    End If
    
    
    wkSUMI_QTY = AFT_SUMI_JITU_QTY - BEF_SUMI_JITU_QTY
    
    wkMI_QTY = AFT_MI_JITU_QTY - BEF_MI_JITU_QTY
    
    
    
        '作業ﾛｸﾞ出力    '2008.08.06
    If Trim(MENU_NO) <> "" Then
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    ID, _
                                    JGYOBU, _
                                    NAIGAI, _
                                    MENU_NO, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    HIN_GAI, _
                                    wkSUMI_QTY, _
                                    wkMI_QTY, _
                                    Location, _
                                    TO_LOCATION) Then
            Exit Function
        End If
    End If
    
    If BEF_SUMI_JITU_QTY = AFT_SUMI_JITU_QTY And BEF_MI_JITU_QTY = AFT_MI_JITU_QTY Then
        Zaiko_Seisa_Update_Proc = False
        Exit Function
    End If
    
    
    If BEF_SUMI_JITU_QTY < AFT_SUMI_JITU_QTY Then
    
    
    
                                            '入庫更新
        sts = Nyuko_Update_Proc(JGYOBU, _
                                NAIGAI, _
                                HIN_GAI, _
                                Format(Now, "YYYYMMDD"), _
                                Location, _
                                ZAIKO_SEISA_PURA, _
                                (AFT_SUMI_JITU_QTY - BEF_SUMI_JITU_QTY), _
                                0, _
                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                FILE_RETRY, , , , , , 1)
        Select Case sts
            Case False
            Case True           '入庫時は発生しない
            Case SYS_CANCEL
                
                Zaiko_Seisa_Update_Proc = SYS_CANCEL
                Exit Function
            Case SYS_ERR
                Zaiko_Seisa_Update_Proc = SYS_ERR    'システム異常発生
                Exit Function
        End Select
    
    
    Else
    
                                            '出庫更新
        sts = Syuko_Update_Proc(JGYOBU, _
                                NAIGAI, _
                                HIN_GAI, _
                                "", _
                                Location, _
                                ZAIKO_SEISA_MAINA, _
                                (BEF_SUMI_JITU_QTY - AFT_SUMI_JITU_QTY), _
                                0, _
                                0, _
                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                FILE_RETRY, , , , , , , , 1)
        Select Case sts
            Case False
            
            Case True       '在庫不足時に発生
                Zaiko_Seisa_Update_Proc = SYS_CANCEL
                Exit Function
            Case SYS_CANCEL
                Zaiko_Seisa_Update_Proc = SYS_CANCEL
                Exit Function
            Case SYS_ERR
                Zaiko_Seisa_Update_Proc = SYS_ERR    'システム異常発生
                
                Exit Function
        End Select
    End If
    
    
    
    
    If BEF_MI_JITU_QTY < AFT_MI_JITU_QTY Then
    
    
    
                                            '入庫更新
        sts = Nyuko_Update_Proc(JGYOBU, _
                                NAIGAI, _
                                HIN_GAI, _
                                Format(Now, "YYYYMMDD"), _
                                Location, _
                                ZAIKO_SEISA_PURA, _
                                0, _
                                (AFT_MI_JITU_QTY - BEF_MI_JITU_QTY), _
                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                FILE_RETRY, , , , , , 1)
        Select Case sts
            Case False
            Case True           '入庫時は発生しない
            Case SYS_CANCEL
                Zaiko_Seisa_Update_Proc = SYS_CANCEL
                Exit Function
            Case SYS_ERR
                Zaiko_Seisa_Update_Proc = SYS_ERR
                Exit Function
        End Select
    
    
    Else
    
                                            '出庫更新
        sts = Syuko_Update_Proc(JGYOBU, _
                                NAIGAI, _
                                HIN_GAI, _
                                "", _
                                Location, _
                                ZAIKO_SEISA_MAINA, _
                                0, _
                                (BEF_MI_JITU_QTY - AFT_MI_JITU_QTY), _
                                0, _
                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                FILE_RETRY, , , , , , , , 1)
        Select Case sts
            Case False
            
            Case True       '在庫不足時に発生
                Zaiko_Seisa_Update_Proc = SYS_CANCEL
                Exit Function
            Case SYS_CANCEL
                Zaiko_Seisa_Update_Proc = SYS_CANCEL
                Exit Function
            Case SYS_ERR
                Zaiko_Seisa_Update_Proc = SYS_ERR
                Exit Function
        End Select
    End If
    
    
    
    
    Zaiko_Seisa_Update_Proc = False

End Function

Public Function Y_Syuka_Chek_Proc(Mode As String, _
                                        JGYOBU As String, _
                                        NAIGAI As String, _
                                        Hinban As String, _
                                        MTS_CODE As String, _
                                        SS_CODE As String, _
                                        CYU_KBN As String, _
                                        Y_SYU_CNT As Integer, _
                                        ID_NO As String, _
                                        SYUKA_QTY As Long, _
                                        DEN_NO As String, _
                                        KAN_KBN As String, _
                                        Optional JITU_QTY As Long, _
                                        Optional DEN_ID_JGYOBU As String = " ", _
                                        Optional KENPIN_YMD As String = " ", _
                                        Optional SYUKO_QTY As Long = 0, _
                                        Optional LK_MUKE_CODE As String = "        ", _
                                        Optional Y_SYUKA_QTY As Long = 0) As Integer
'-------------------------------------------------------
'
'   『単一出荷予定の使用予約』
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer


Dim ans         As Integer

Dim RETRY_CNT   As Integer

Dim WK_ID_NO    As String * 12
Dim WK_DEN_NO   As String * 6




    Y_Syuka_Chek_Proc = True
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Y_Syuka_Chek_Proc = SYS_ERR
        Exit Function
    End If


    WK_ID_NO = ""
    WK_DEN_NO = ""

    Y_SYU_CNT = 0
    
    If Len(Trim(ID_NO)) <> 0 Then
        
        DEN_ID_JGYOBU = JGYOBU      '2006.06.01
        
        '伝票ＩＤ指定での処理
        Call UniCode_Conv(K0_Y_SYU.JGYOBU, JGYOBU)              '事業部
        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_NO)            'ID№
    
        RETRY_CNT = 0
    
        Do
'            DoEvents
            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                DoEvents                                                    '2016.01.26
            End If                                                          '2016.01.26
            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrKeyNotFound
                    'データなし
                    Y_Syuka_Chek_Proc = False
                    GoTo Abort_Tran
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Y_Syuka_Chek_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                Case Else
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                    Y_Syuka_Chek_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        
        Loop
                                                
                                                
        If Len(Trim(StrConv(Y_SYUREC.WEL_ID, vbUnicode))) = 0 And _
            Len(Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode))) = 0 Then
        Else
            If StrConv(Y_SYUREC.WEL_ID, vbUnicode) <> Format(ID_KANRI_TBL(ING_No).ID, "000") Or _
                Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode)) <> StrConv(App.EXEName, vbUpperCase) Then
                                '他で使用中
                Y_Syuka_Chek_Proc = SYS_CANCEL
                GoTo Abort_Tran
            End If
        End If
            
            
            
            
            
            
            
        Call UniCode_Conv(Y_SYUREC.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
        Call UniCode_Conv(Y_SYUREC.PRG_ID, StrConv(App.EXEName, vbUpperCase))
                                            
        RETRY_CNT = 0
                                            
                                            '出荷予定書込み
        Do
'            DoEvents
            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                DoEvents                                                    '2016.01.26
            End If                                                          '2016.01.26
            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K3_Y_SYU, Len(K3_Y_SYU), 3)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Y_Syuka_Chek_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                
                Case Else
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    Y_Syuka_Chek_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        Loop
                                
                                '1件のみ伝票№＆出荷数KEEP
        SYUKA_QTY = CLng(StrConv(Y_SYUREC.SURYO, vbUnicode)) - CLng(StrConv(Y_SYUREC.JITU_SURYO, vbUnicode))
        
            
        
        WK_ID_NO = StrConv(Y_SYUREC.ID_NO, vbUnicode)
        WK_DEN_NO = Left(StrConv(Y_SYUREC.DEN_NO, vbUnicode), 6)
        Y_SYU_CNT = 1
        
        NAIGAI = StrConv(Y_SYUREC.NAIGAI, vbUnicode)
        Hinban = StrConv(Y_SYUREC.HIN_NO, vbUnicode)
        MTS_CODE = StrConv(Y_SYUREC.MUKE_CODE, vbUnicode)
        SS_CODE = StrConv(Y_SYUREC.SS_CODE, vbUnicode)
        CYU_KBN = StrConv(Y_SYUREC.CYU_KBN, vbUnicode)
        KAN_KBN = StrConv(Y_SYUREC.KAN_KBN, vbUnicode)
        JITU_QTY = CLng(StrConv(Y_SYUREC.SURYO, vbUnicode))
'        SYUKA_QTY = CLng(StrConv(Y_SYUREC.SURYO, vbUnicode))
        '2007.10.10 検品日付を追加
        KENPIN_YMD = StrConv(Y_SYUREC.KENPIN_YMD, vbUnicode)
    
        '2007.11.02
        SYUKO_QTY = CLng(StrConv(Y_SYUREC.JITU_SURYO, vbUnicode))
        '2017.09.23
        Y_SYUKA_QTY = CLng(StrConv(Y_SYUREC.SURYO, vbUnicode))
        
    
        '2009.08.08
        LK_MUKE_CODE = StrConv(Y_SYUREC.LK_MUKE_CODE, vbUnicode)
    Else
        '注文区分／向け先／品番での処理
        Call UniCode_Conv(K3_Y_SYU.JGYOBU, JGYOBU)              '事業部
        Call UniCode_Conv(K3_Y_SYU.KEY_CYU_KBN, CYU_KBN)        '注文区分
        Call UniCode_Conv(K3_Y_SYU.KEY_MUKE_CODE, MTS_CODE)     '得意先コード
        Call UniCode_Conv(K3_Y_SYU.KEY_SS_CODE, SS_CODE)        '得意先コード
        Call UniCode_Conv(K3_Y_SYU.NAIGAI, NAIGAI)              '国内外
        Call UniCode_Conv(K3_Y_SYU.KEY_HIN_NO, Hinban)          '品番
        Call UniCode_Conv(K3_Y_SYU.KEY_ID_NO, "")               'ID№
    
        com = BtOpGetGreaterEqual
    
    
        Do
            RETRY_CNT = 0
            Do
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
                sts = BTRV(com + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K3_Y_SYU, Len(K3_Y_SYU), 3)
                Select Case sts
                    Case BtNoErr
                        If StrConv(Y_SYUREC.JGYOBU, vbUnicode) <> JGYOBU Or _
                            StrConv(Y_SYUREC.CYU_KBN, vbUnicode) <> CYU_KBN Or _
                            Trim(StrConv(Y_SYUREC.MUKE_CODE, vbUnicode)) <> Trim(MTS_CODE) Or _
                            Trim(StrConv(Y_SYUREC.SS_CODE, vbUnicode)) <> Trim(SS_CODE) Or _
                            StrConv(Y_SYUREC.NAIGAI, vbUnicode) <> NAIGAI Or _
                            Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)) <> Trim(Hinban) Then

                            sts = BTRV(BtOpUnlock, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K3_Y_SYU, Len(K3_Y_SYU), 3)
                            If sts Then
                                Call File_Error(sts, BtOpUnlock, "出荷予定", 0)
                                Y_Syuka_Chek_Proc = SYS_ERR
                                GoTo Abort_Tran
                            End If
                        
                            sts = BtErrEOF
                    
                        End If
                                        
                    
                        Exit Do
                    Case BtErrEOF
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        RETRY_CNT = RETRY_CNT + 1
                        If RETRY_CNT > FILE_RETRY Then
                            Y_Syuka_Chek_Proc = SYS_CANCEL
                            GoTo Abort_Tran
                        End If
                   Case Else
                        Call File_Error(sts, com + BtSNoWait, "出荷予定", 0)
                        Y_Syuka_Chek_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
            Loop
                                        
            If sts = BtErrEOF Then
                Exit Do
            End If
        
        
'            If StrConv(Y_SYUREC.KAN_KBN, vbUnicode) <> KAN_KBN_FIN And _
'                  Len(Trim(StrConv(Y_SYUREC.PRINT_YMD, vbUnicode))) = 0 Then
                                            
            If Len(Trim(StrConv(Y_SYUREC.WEL_ID, vbUnicode))) = 0 And _
                Len(Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode))) = 0 Then
            Else
                If StrConv(Y_SYUREC.WEL_ID, vbUnicode) <> Format(ID_KANRI_TBL(ING_No).ID, "000") Or _
                    Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode)) <> StrConv(App.EXEName, vbUpperCase) Then
                                            '他で使用中
                    Y_Syuka_Chek_Proc = SYS_CANCEL
                    GoTo Abort_Tran
                End If
            End If
                    
            Call UniCode_Conv(Y_SYUREC.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
            Call UniCode_Conv(Y_SYUREC.PRG_ID, StrConv(App.EXEName, vbUpperCase))
                                            
            RETRY_CNT = 0
                                            
                                            '出荷予定書込み
            Do
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K3_Y_SYU, Len(K3_Y_SYU), 3)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        RETRY_CNT = RETRY_CNT + 1
                        If RETRY_CNT > FILE_RETRY Then
                            Y_Syuka_Chek_Proc = SYS_CANCEL
                            GoTo Abort_Tran
                        End If
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        Y_Syuka_Chek_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
            Loop
                                
            
            If StrConv(Y_SYUREC.KAN_KBN, vbUnicode) = Mode Then
                        
            
                Y_SYU_CNT = Y_SYU_CNT + 1
                If Y_SYU_CNT > 1 Then
                                            '複数伝票あり
                    Y_Syuka_Chek_Proc = False
                    GoTo Abort_Tran
            
                End If
                                '1件のみ伝票№＆出荷数KEEP
                SYUKA_QTY = CLng(StrConv(Y_SYUREC.SURYO, vbUnicode)) - CLng(StrConv(Y_SYUREC.JITU_SURYO, vbUnicode))
        
                WK_ID_NO = StrConv(Y_SYUREC.ID_NO, vbUnicode)
                WK_DEN_NO = Left(StrConv(Y_SYUREC.DEN_NO, vbUnicode), 6)
                                   
            End If
            
            com = BtOpGetNext
    
        Loop
    
    End If


    If Len(Trim(WK_ID_NO)) <> 0 Then
        ID_NO = WK_ID_NO
        DEN_NO = WK_DEN_NO
    End If

End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        Y_Syuka_Chek_Proc = SYS_ERR
        GoTo Abort_Tran
    End If
    
    Y_Syuka_Chek_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function

Public Sub Err_Send_Proc(Errmsg0 As String, _
                            Errmsg1 As String, _
                            Errmsg2 As String, _
                            Errmsg3 As String, _
                            Errmsg4 As String)
'-------------------------------------------------------
'
'   『エラーメッセージ電文の作成』
'
'       2012.03.25  frm より　移管
'-------------------------------------------------------
    
    Send_Text.sts = Sts_NG                  'ステータス
    Send_Text.Display_Flg = Display_DEF     '表示画面フラグ
    Send_Text.End_Menu = ""                 '最終メニューフラグ
    Send_Text.Menu_Suu = ""                 'メニュー個数
    Send_Text.FileName = ""                 'ファイル名
    Send_Text.buzzer = Buzzer_CONTI         'ブザー音
    
'-------------------------------------------------------
    Send_Text.Box_Type(0).Box_Type = TYPE_REF               '行１　 BOX属性
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Errmsg0)   '       表示内容
    Send_Text.Box_Type(0).INIT = ""                         '       数値初期値
    Send_Text.Box_Type(0).Start_Pos = ""                    '       開始位置
    Send_Text.Box_Type(0).Max_Size = ""                     '       入力桁数
    Send_Text.Box_Type(0).MENU = ""                         '       メニュー内容
'-------------------------------------------------------
    Send_Text.Box_Type(1).Box_Type = TYPE_REF               '行２   BOX属性
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Errmsg1)   '       表示内容
    Send_Text.Box_Type(1).INIT = ""                         '       数値初期値
    Send_Text.Box_Type(1).Start_Pos = ""                    '       開始位置
    Send_Text.Box_Type(1).Max_Size = ""                     '       入力桁数
    Send_Text.Box_Type(1).MENU = ""                         '       メニュー内容
'-------------------------------------------------------
    Send_Text.Box_Type(2).Box_Type = TYPE_REF               '行３　 BOX属性
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Errmsg2)   '       表示内容
    Send_Text.Box_Type(2).INIT = ""                         '       数値初期値
    Send_Text.Box_Type(2).Start_Pos = ""                    '       開始位置
    Send_Text.Box_Type(2).Max_Size = ""                     '       入力桁数
    Send_Text.Box_Type(2).MENU = ""                         '       メニュー内容
'-------------------------------------------------------
    Send_Text.Box_Type(3).Box_Type = TYPE_REF               '行４　 BOX属性
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Errmsg3)   '       表示内容
    Send_Text.Box_Type(3).INIT = ""                         '       数値初期値
    Send_Text.Box_Type(3).Start_Pos = ""                    '       開始位置
    Send_Text.Box_Type(3).Max_Size = ""                     '       入力桁数
    Send_Text.Box_Type(3).MENU = ""                         '       メニュー内容
'-------------------------------------------------------
    Send_Text.Box_Type(4).Box_Type = TYPE_REF               '行５　 BOX属性
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Errmsg4)   '       表示内容
    Send_Text.Box_Type(4).INIT = ""                         '       数値初期値
    Send_Text.Box_Type(4).Start_Pos = ""                    '       開始位置
    Send_Text.Box_Type(4).Max_Size = ""                     '       入力桁数
    Send_Text.Box_Type(4).MENU = ""                         '       メニュー内容
'-------------------------------------------------------
    Send_Text.CRLF = vbCrLf
        
    ID_KANRI_TBL(ING_No).Last_Send = 1                      'エラー送信

End Sub


Public Function Text_Create_Proc() As String
'-------------------------------------------------------
'
'   『送信テキスト作成』
'
'       2012.03.25  frm より　移管
'-------------------------------------------------------
Dim i   As Integer
    
    Text_Create_Proc = Send_Text.sts & _
                Send_Text.Display_Flg & _
                Send_Text.End_Menu & _
                Send_Text.Menu_Suu & _
                Send_Text.FileName & _
                Send_Text.buzzer

    For i = 0 To 4
        Text_Create_Proc = Text_Create_Proc & Send_Text.Box_Type(i).Box_Type & _
                            StrConv(Send_Text.Box_Type(i).LCD, vbUnicode) & _
                            Send_Text.Box_Type(i).INIT & _
                            Send_Text.Box_Type(i).Start_Pos & _
                            Send_Text.Box_Type(i).Max_Size & _
                            Send_Text.Box_Type(i).MENU
    
    Next i
    
    Text_Create_Proc = Text_Create_Proc & Send_Text.CRLF

End Function


Public Function Item_Read_Proc(JGYOBU As String, NAIGAI As String, Hinban As String, RET_JGYOBU As String, RET_NAIGAI As String, _
                                Optional Shizai_mode As Integer = 0, Optional Shizai_code As String = "S") As Integer
'-------------------------------------------------------
'
'   『品目マスタ』の読み込み処理
'
'   「外部品番」⇒[Ｊａｎ]⇒「読み替えコード」順次に読み込む
'
'   返り値
'       BtNoErr             :正常終了
'       BtErrKeyNotFound    :未登録
'       上記以外            :Pervasive リターンコード
'
'       2012.03.25  frm より　移管
'
'
'-------------------------------------------------------
Dim sts As Integer
Dim i   As Integer
Dim j   As Integer

    
    '--------------------------------------------------外部品番
    Call UniCode_Conv(K0_ITEM.JGYOBU, JGYOBU)
    Call UniCode_Conv(K0_ITEM.NAIGAI, NAIGAI)
    Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
    
    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    Select Case sts
        Case BtNoErr
            RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
            RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
            Item_Read_Proc = sts
            Exit Function
        Case BtErrKeyNotFound
        
            If JGYOBU_YOMIKAE_F Then
                        
                For i = 0 To UBound(JGYOBU_YOMIKAE_T)
                    
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                    
                    If (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = JGYOBU_YOMIKAE_T(i) Then
                    
                    
                        For j = 0 To UBound(JGYOBU_T)
                         
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                         
                         
                            If JGYOBU_T(j).CODE = SHIZAI Then
                            Else
                        
                                Call UniCode_Conv(K0_ITEM.JGYOBU, JGYOBU_T(j).CODE)
                                Call UniCode_Conv(K0_ITEM.NAIGAI, NAIGAI)
                                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
                                
                                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                Select Case sts
                                    Case BtNoErr
                                        RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                                        RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                                        Item_Read_Proc = sts
                                        Exit Function
                        
                                    Case BtErrKeyNotFound
                                    Case Else
                                        Item_Read_Proc = sts
                                        Exit Function
                                End Select
                            End If
                        Next j
                    
                    
                    End If
                
                
                
                
                
                
                
                
                Next i
                
        
        
        
            End If
        Case Else
            Item_Read_Proc = sts
            Exit Function
    End Select
    '--------------------------------------------------Ｊａｎコード
    Call UniCode_Conv(K4_ITEM.JGYOBU, JGYOBU)
    Call UniCode_Conv(K4_ITEM.NAIGAI, NAIGAI)
    Call UniCode_Conv(K4_ITEM.JAN_CODE, Hinban)
    
    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K4_ITEM, Len(K4_ITEM), 4)
    Select Case sts
        Case BtNoErr
            Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
            RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
            RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
            Item_Read_Proc = sts
            Exit Function
        Case BtErrKeyNotFound
        Case Else
            Item_Read_Proc = sts
            Exit Function
    End Select
    '--------------------------------------------------読替えコード
    Call UniCode_Conv(K5_ITEM.JGYOBU, JGYOBU)
    Call UniCode_Conv(K5_ITEM.NAIGAI, NAIGAI)
    Call UniCode_Conv(K5_ITEM.HIN_CHANGE, Hinban)
    
    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K5_ITEM, Len(K5_ITEM), 5)
    Select Case sts
        Case BtNoErr
            Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
            RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
            RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
            Item_Read_Proc = sts
            Exit Function
        Case BtErrKeyNotFound   '2006.01.06 '資材品番での読み替えを追加
        Case Else
            Item_Read_Proc = sts
            Exit Function
    End Select
    '--------------------------------------------------資材品番で読み替え
    
    '2010.10.01
    If Shizai_mode = 1 Then
        Item_Read_Proc = BtErrKeyNotFound
        Exit Function
    End If
    '2010.10.01
    
    
    Call UniCode_Conv(K0_ITEM.JGYOBU, Shizai_code)
    Call UniCode_Conv(K0_ITEM.NAIGAI, NAIGAI)
    Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
    
    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    Select Case sts
        Case BtNoErr
            Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
            RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
            RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
            Item_Read_Proc = sts
            Exit Function
        Case Else
            Item_Read_Proc = sts
            Exit Function
    End Select

End Function


Public Function Item_Read2_Proc(JGYOBU As String, NAIGAI As String, Hinban As String, RET_JGYOBU As String, RET_NAIGAI As String, Optional Y_Jgyobu As String = "B") As Integer
'-------------------------------------------------------
'
'   『品目マスタ』の読み込み処理
'
'   [Ｊａｎ]⇒「読み替えコード」順次に読み込む
'
'   返り値
'       BtNoErr             :正常終了
'       BtErrKeyNotFound    :未登録
'       上記以外            :Pervasive リターンコード
'
'       2016.05.27
'
'
'-------------------------------------------------------
Dim sts As Integer
Dim i   As Integer
Dim j   As Integer

    
    '--------------------------------------------------Ｊａｎコード
    Call UniCode_Conv(K4_ITEM.JGYOBU, Y_Jgyobu)
    Call UniCode_Conv(K4_ITEM.NAIGAI, NAIGAI)
    Call UniCode_Conv(K4_ITEM.JAN_CODE, Hinban)
    
    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K4_ITEM, Len(K4_ITEM), 4)
    Select Case sts
        Case BtNoErr
            Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
            RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
            RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
            Item_Read2_Proc = sts
            Exit Function
        Case BtErrKeyNotFound
        
        
        
            Call UniCode_Conv(K4_ITEM.JGYOBU, JGYOBU)
            Call UniCode_Conv(K4_ITEM.NAIGAI, NAIGAI)
            Call UniCode_Conv(K4_ITEM.JAN_CODE, Hinban)
            
            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K4_ITEM, Len(K4_ITEM), 4)
            Select Case sts
                Case BtNoErr
                    Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
                    RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                    RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                    Item_Read2_Proc = sts
                    Exit Function
                Case BtErrKeyNotFound
                Case Else
                    Item_Read2_Proc = sts
                    Exit Function
            End Select
        
        
        Case Else
            Item_Read2_Proc = sts
            Exit Function
    End Select
    '--------------------------------------------------読替えコード
    Call UniCode_Conv(K5_ITEM.JGYOBU, Y_Jgyobu)
    Call UniCode_Conv(K5_ITEM.NAIGAI, NAIGAI)
    Call UniCode_Conv(K5_ITEM.HIN_CHANGE, Hinban)
    
    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K5_ITEM, Len(K5_ITEM), 5)
    Select Case sts
        Case BtNoErr
            Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
            RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
            RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
            Item_Read2_Proc = sts
            Exit Function
        Case BtErrKeyNotFound   '2006.01.06 '資材品番での読み替えを追加
        
        
            Call UniCode_Conv(K5_ITEM.JGYOBU, JGYOBU)
            Call UniCode_Conv(K5_ITEM.NAIGAI, NAIGAI)
            Call UniCode_Conv(K5_ITEM.HIN_CHANGE, Hinban)
            
            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K5_ITEM, Len(K5_ITEM), 5)
            Select Case sts
                Case BtNoErr
                    Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
                    RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                    RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                    Item_Read2_Proc = sts
                    Exit Function
                Case BtErrKeyNotFound   '2006.01.06 '資材品番での読み替えを追加
                Case Else
                    Item_Read2_Proc = sts
                    Exit Function
            End Select
        
        
        
        Case Else
            Item_Read2_Proc = sts
            Exit Function
    End Select

End Function



Public Function Item_Read3_Proc(JGYOBU As String, NAIGAI As String, Hinban As String, RET_JGYOBU As String, RET_NAIGAI As String, _
                                Optional Shizai_mode As Integer = 0, Optional Shizai_code As String = "S", Optional JGYOBU_READ As Integer = 0) As Integer
'-------------------------------------------------------
'
'   『品目マスタ』の読み込み処理
'
'   「外部品番」⇒「内部品番」⇒[Ｊａｎ]⇒「読み替えコード」順次に読み込む
'
'   返り値
'       BtNoErr             :正常終了
'       BtErrKeyNotFound    :未登録
'       上記以外            :Pervasive リターンコード
'
'       2016.07.13
'       2016.12.08 事業部読み替え有無 0:なし
'
'
'-------------------------------------------------------
Dim sts         As Integer
Dim i           As Integer
Dim j           As Integer
    
Dim wkJgyobu    As String * 1           '2016.12.08

    
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> '2016.12.08
    For i = 0 To UBound(JGYOBU_T)

        If (JGYOBU_READ = 0 And JGYOBU_T(i).CODE <> JGYOBU) Then
        Else
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> '2016.12.08
            '--------------------------------------------------外部品番
            'Call UniCode_Conv(K0_ITEM.JGYOBU, JGYOBU)              '2016.12.08
            Call UniCode_Conv(K0_ITEM.JGYOBU, JGYOBU_T(i).CODE)     '2016.12.08
            Call UniCode_Conv(K0_ITEM.NAIGAI, NAIGAI)
            Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
            
            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            Select Case sts
                Case BtNoErr
                    RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                    RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                    Item_Read3_Proc = sts
                    Exit Function
                Case BtErrKeyNotFound
                
                                
                    '--------------------------------------------------内部品番
                    'Call UniCode_Conv(K2_ITEM.JGYOBU, JGYOBU)              '2016.12.08
                    Call UniCode_Conv(K2_ITEM.JGYOBU, JGYOBU_T(i).CODE)     '2016.12.08
                    Call UniCode_Conv(K2_ITEM.NAIGAI, NAIGAI)
                    Call UniCode_Conv(K2_ITEM.HIN_NAI, Hinban)
                                        
                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K2_ITEM, Len(K2_ITEM), 2)
                    Select Case sts
                        Case BtNoErr
                            Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
                            RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                            RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                            Item_Read3_Proc = sts
                            Exit Function
            
                        Case BtErrKeyNotFound
                        Case Else
                            Item_Read3_Proc = sts
                            Exit Function
                    End Select
                        
                Case Else
                    Item_Read3_Proc = sts
                    Exit Function
            End Select
            '--------------------------------------------------Ｊａｎコード
            'Call UniCode_Conv(K4_ITEM.JGYOBU, JGYOBU)              '2016.12.08
            Call UniCode_Conv(K4_ITEM.JGYOBU, JGYOBU_T(i).CODE)     '2016.12.08
            Call UniCode_Conv(K4_ITEM.NAIGAI, NAIGAI)
            Call UniCode_Conv(K4_ITEM.JAN_CODE, Hinban)
            
            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K4_ITEM, Len(K4_ITEM), 4)
            Select Case sts
                Case BtNoErr
                    Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
                    RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                    RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                    Item_Read3_Proc = sts
                    Exit Function
                Case BtErrKeyNotFound
                Case Else
                    Item_Read3_Proc = sts
                    Exit Function
            End Select
            '--------------------------------------------------読替えコード
            'Call UniCode_Conv(K5_ITEM.JGYOBU, JGYOBU)              '2016.12.08
            Call UniCode_Conv(K5_ITEM.JGYOBU, JGYOBU_T(i).CODE)     '2016.12.08
            Call UniCode_Conv(K5_ITEM.NAIGAI, NAIGAI)
            Call UniCode_Conv(K5_ITEM.HIN_CHANGE, Hinban)
            
            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K5_ITEM, Len(K5_ITEM), 5)
            Select Case sts
                Case BtNoErr
                    Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
                    RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                    RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                    Item_Read3_Proc = sts
                    Exit Function
                Case BtErrKeyNotFound   '2006.01.06 '資材品番での読み替えを追加
                Case Else
                    Item_Read3_Proc = sts
                    Exit Function
            End Select
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> '2016.12.08
        End If
    Next i
    Item_Read3_Proc = BtErrKeyNotFound
    Exit Function
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> '2016.12.08
End Function




Public Function Item_Read4_Proc(JGYOBU As String, NAIGAI As String, Hinban As String, RET_JGYOBU As String, RET_NAIGAI As String, _
                                Optional Shizai_mode As Integer = 0, Optional Shizai_code As String = "S", Optional JGYOBU_READ As Integer = 0, Optional HIN_NAI_READ As Integer = 0, Optional HIN_NAI As String = "                    ") As Integer
'-------------------------------------------------------
'
'   『品目マスタ』の読み込み処理
'
'   「外部品番」⇒「内部品番」順次に読み込む
'
'   返り値
'       BtNoErr             :正常終了
'       BtErrKeyNotFound    :未登録
'       上記以外            :Pervasive リターンコード
'
'       2018.09.19
'
'
'-------------------------------------------------------
Dim sts         As Integer
Dim i           As Integer
Dim j           As Integer
    
Dim wkJgyobu    As String * 1           '2016.12.08

    
    HIN_NAI_READ = 0
    HIN_NAI = Space(20)
    For i = 0 To UBound(JGYOBU_T)

        If (JGYOBU_READ = 0 And JGYOBU_T(i).CODE <> JGYOBU) Then
        Else
            '--------------------------------------------------外部品番
            Call UniCode_Conv(K0_ITEM.JGYOBU, JGYOBU_T(i).CODE)     '2016.12.08
            Call UniCode_Conv(K0_ITEM.NAIGAI, NAIGAI)
            Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
            
            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            Select Case sts
                Case BtNoErr
                    RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                    RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                    Item_Read4_Proc = sts
                    Exit Function
                Case BtErrKeyNotFound
                
                                
                    '--------------------------------------------------内部品番
                    Call UniCode_Conv(K2_ITEM.JGYOBU, JGYOBU_T(i).CODE)     '2016.12.08
                    Call UniCode_Conv(K2_ITEM.NAIGAI, NAIGAI)
                    Call UniCode_Conv(K2_ITEM.HIN_NAI, Hinban)
                                        
                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K2_ITEM, Len(K2_ITEM), 2)
                    Select Case sts
                        Case BtNoErr
                            
                            HIN_NAI_READ = 1
                            HIN_NAI = Hinban
                            Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
                            
                            
                            RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                            RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                            Item_Read4_Proc = sts
                            Exit Function
            
                        Case BtErrKeyNotFound
                        
                        
                            '--------------------------------------------------Ｊａｎコード
                            Call UniCode_Conv(K4_ITEM.JGYOBU, JGYOBU_T(i).CODE)
                            Call UniCode_Conv(K4_ITEM.NAIGAI, NAIGAI)
                            Call UniCode_Conv(K4_ITEM.JAN_CODE, Hinban)
                            
                            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K4_ITEM, Len(K4_ITEM), 4)
                            Select Case sts
                                Case BtNoErr
                                    Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
                                    RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                                    RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                                    Item_Read4_Proc = sts
                                    Exit Function
                                Case BtErrKeyNotFound
                                
                                
                                
                                '---------------
                                    Call UniCode_Conv(K5_ITEM.JGYOBU, JGYOBU_T(i).CODE)
                                    Call UniCode_Conv(K5_ITEM.NAIGAI, NAIGAI)
                                    Call UniCode_Conv(K5_ITEM.HIN_CHANGE, Hinban)
                                    
                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K5_ITEM, Len(K5_ITEM), 5)
                                    Select Case sts
                                        Case BtNoErr
                                            Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
                                            RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
                                            RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
                                            Item_Read4_Proc = sts
                                            Exit Function
                                        Case BtErrKeyNotFound   '2006.01.06 '資材品番での読み替えを追加
                                        Case Else
                                            Item_Read4_Proc = sts
                                            Exit Function
                                    End Select
                                    '--------------------------------------------------資材品番で読み替え
                                
                                
                                
                                Case Else
                                    Item_Read4_Proc = sts
                                    Exit Function
                            End Select
                            '--------------------------------------------------読替えコード
                        
                        Case Else
                            Item_Read4_Proc = sts
                            Exit Function
                    End Select
                        
                Case Else
                    Item_Read4_Proc = sts
                    Exit Function
            End Select
        End If
    Next i
    
    
    
    '2010.10.01
    If Shizai_mode = 1 Then
        Item_Read4_Proc = BtErrKeyNotFound
        Exit Function
    End If
    '2010.10.01
    
    
    Call UniCode_Conv(K0_ITEM.JGYOBU, Shizai_code)
    Call UniCode_Conv(K0_ITEM.NAIGAI, NAIGAI)
    Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
    
    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    Select Case sts
        Case BtNoErr
            Hinban = StrConv(ITEMREC.HIN_GAI, vbUnicode)
            RET_JGYOBU = StrConv(ITEMREC.JGYOBU, vbUnicode)
            RET_NAIGAI = StrConv(ITEMREC.NAIGAI, vbUnicode)
            Item_Read4_Proc = sts
            Exit Function
        Case Else
            Item_Read4_Proc = sts
            Exit Function
    End Select

    
    
    
'---------------
    
    
    
    Item_Read4_Proc = BtErrKeyNotFound
    Exit Function
End Function



Public Function Sagyo_Send_Proc() As Integer
'-------------------------------------------------------
'
'   『作業の送信』
'
'       2012.03.25  frm より　移管
'
'-------------------------------------------------------
Dim i           As Integer
Dim j           As Integer
Dim k           As Integer

Dim Found_Flg   As Boolean

Dim sts         As Integer

Dim MENU_NO     As String * 2   '2017.09.23


    Sagyo_Send_Proc = True
    
                        '要因の読み込み
    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
    
    Select Case sts
        Case BtNoErr
        '   -------------------------------- エラーメッセージ作成
        Case Else
        '「要因未登録は考えられないエラーシステム停止とする」
            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                Sendbuf = Text_Create_Proc()
            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
            Exit Function
    End Select
    
    
    
    '   -------------------------------- 送信パラメータの検索
    Found_Flg = False
    For i = 0 To UBound(WEL_Para_Tbl, 1)
        For j = 0 To UBound(WEL_Para_Tbl, 2)
                                        '最初は２桁で検索
            If StrConv(YOINREC.CODE_TYPE, vbUnicode) & StrConv(YOINREC.YOIN_CODE, vbUnicode) = _
                WEL_Para_Tbl(i, j).Action Then
                Found_Flg = True
                Exit For
            End If
        Next j
            
        If Found_Flg Then
            Exit For
        End If
    
    Next i


    If Not Found_Flg Then
        
        For i = 0 To UBound(WEL_Para_Tbl, 1)
            For j = 0 To UBound(WEL_Para_Tbl, 2)
                                        '最後は１桁で検索
               If StrConv(YOINREC.CODE_TYPE, vbUnicode) = Left(WEL_Para_Tbl(i, j).Action, 1) Then
                    Found_Flg = True
                    Exit For
                End If
        
            Next j
            
            If Found_Flg Then
                Exit For
            End If
        
        
        Next i
            
    End If

    If Not Found_Flg Then
        '信じられないエラー
        Call LOG_OUT(LOG_F, "要因マスタ＜＞WLECATパラメータ（INIファイル）")
        Exit Function
    End If



'    ST_LOG_OUT_F = True     '2008.08.08



'2011.03.05
    If (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_LABEL_PRINT Then

        If Trim(EF_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
            Call Err_Send_Proc("ｽｷｬﾅCTR-800-11では、", "ﾗﾍﾞﾙ発行できません。", "", "", "")
            Sagyo_Send_Proc = False
            Exit Function

        End If

    End If
'2011.03.05


'2013.06.06
    If (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_LotNo_LABEL_PRINT Then

        If Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            Call Err_Send_Proc("ｽｷｬﾅCTR-800-11では、", "ﾗﾍﾞﾙ発行できません。", "", "", "")
            Sagyo_Send_Proc = False
            Exit Function
        Else
            If Trim(N4_SendFile) = "" Then
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                Call Err_Send_Proc("ﾗﾍﾞﾙ発行できません。", "[SYS.INI]", "[F110010]", "N4=未設定", "")
                Sagyo_Send_Proc = False
                Exit Function
            End If
        End If

    End If
'2013.06.06

'2015.10.06
    If (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_LABEL_PRINT_CNT Then

        If Trim(EI_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
            Call Err_Send_Proc("ｽｷｬﾅCTR-800-11では、", "ﾗﾍﾞﾙ発行できません。", "", "", "")
            Sagyo_Send_Proc = False
            Exit Function

        End If

    End If
'2015.10.06




    '   -------------------------------- 作業作成
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ                     '通常作業開始
    '---------------------------------------------------------------
    Send_Text.sts = Sts_OK                                          'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_DEF                             '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
    Send_Text.End_Menu = Menu_Only                                  '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                                       'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
    Send_Text.FileName = ""                                         '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
    Send_Text.buzzer = Buzzer_DEF                        'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
'    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF_CON
    
                                                                    'パラメータの1行目には要因名称をセット
    
    
'>>>>>>>>>>>>>>>>>>>>>>>>>  2017.09.22 全て　ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME　から表題をセットする
'    '2011.06.01
'    '2015.01.22 Wel_T_back 追加
'    If (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_HIN_FURIKAE_PLUS Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_HIN_FURIKAE_MAINA Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_SEK_KYOSEI_END Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_JAN_SET Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_IDO_OUT_OSAKA Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_IDO_OUT_OSAKA2 Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_IDO_OUT_OSAKA3 Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_HIN_FURIKA_S Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_IDO_IN_OSAKA Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_COMPO_OSAKA_CHECK Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_LotNo_IN_CHECK Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_LotNo_OUT_CHECK Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_LotNo_OUT_CANCEL Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_LotNo_LABEL_PRINT Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_InvNo_OUT_CHECK Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_InvNo_OUT_CANCEL Or _
'        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = Wel_T_back Then
'
'        WEL_Para_Tbl(i, j).Wel_Para(0).LCD = ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME
'    Else
'    '2011.06.01
'        WEL_Para_Tbl(i, j).Wel_Para(0).LCD = StrConv(YOINREC.YOIN_DNAME, vbUnicode)
'    End If
'
'
'
'    If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_DENPYO_ID Then               '2016.09.21
'        WEL_Para_Tbl(i, j).Wel_Para(0).LCD = ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME   '2016.09.21
'    End If                                                                          '2016.09.21
'
'
'
'    If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_BCR_PRINT Then               '2017.04.22
'        WEL_Para_Tbl(i, j).Wel_Para(0).LCD = ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME   '2017.04.22
'    End If                                                                          '2017.04.22
        
    WEL_Para_Tbl(i, j).Wel_Para(0).LCD = ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME
    
'>>>>>>>>>>>>>>>>>>>>>>>>>  2017.09.22 全て　ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME　から表題をセットする
    
    
    
    '---------------------------------------------------------------
    
    
    For k = 0 To M_Gyo - 1
        
                                                            'BOX属性
        Send_Text.Box_Type(k).Box_Type = WEL_Para_Tbl(i, j).Wel_Para(k).Box_Type
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(k).Box_Type = WEL_Para_Tbl(i, j).Wel_Para(k).Box_Type
                                                            
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(k).LCD, WEL_Para_Tbl(i, j).Wel_Para(k).LCD)
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(k).LCD, WEL_Para_Tbl(i, j).Wel_Para(k).LCD)
                                                            '数値初期表示
        Send_Text.Box_Type(k).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(k).INIT = ""
                                                            
                                                            '初期カーソル位置
        If Send_Text.Box_Type(k).Box_Type = "2" Then
            Send_Text.Box_Type(k).Start_Pos = Format(M_Keta - WEL_Para_Tbl(i, j).Wel_Para(k).Keta + 1, "00")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(k).Start_Pos = Format(M_Keta - WEL_Para_Tbl(i, j).Wel_Para(k).Keta, "00")
        Else
            Send_Text.Box_Type(k).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(k).Start_Pos = "01"
        End If
                                                            '入力桁数
        Send_Text.Box_Type(k).Max_Size = Format(WEL_Para_Tbl(i, j).Wel_Para(k).Keta, "00")
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(k).Max_Size = Format(WEL_Para_Tbl(i, j).Wel_Para(k).Keta, "00")
                                                                                
        Send_Text.Box_Type(k).MENU = ""                     'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(k).MENU = ""
                                                                                
    
    Next k
    
    '担当者照会の特殊機能
    If WEL_Para_Tbl(i, j).Action = TANTO_REF Then
    
        Call UniCode_Conv(K0_TANTO.TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
        sts = BTRV(BtOpGetEqual, TANTO_POS, TANTOREC, Len(TANTOREC), K0_TANTO, Len(K0_TANTO), 0)
        Select Case sts
            Case BtNoErr
            Case BtErrKeyNotFound
    
                Call UniCode_Conv(TANTOREC.TANTO_NAME, "")
            
            Case Else
                Call File_Error(sts, BtOpGetEqual, "担当者マスタ")
        End Select
    
'>>>>>>>    表示内容の変更　2017.09.23
    
'        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, StrConv(TANTOREC.TANTO_NAME, vbUnicode))
'        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, StrConv(TANTOREC.TANTO_NAME, vbUnicode))
'
'        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "端末ＩＤ：" & Format(ID_KANRI_TBL(ING_No).ID, "000"))
'        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "端末ＩＤ：" & Format(ID_KANRI_TBL(ING_No).ID, "000"))
    
    
        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, StrConv(TANTOREC.TANTO_CODE, vbUnicode) & " " & StrConv(TANTOREC.TANTO_NAME, vbUnicode))
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, StrConv(TANTOREC.TANTO_CODE, vbUnicode) & " " & StrConv(TANTOREC.TANTO_NAME, vbUnicode))
    
        For k = 0 To UBound(JGYOBU_T)
            If JGYOBU_T(k).CODE = ID_KANRI_TBL(ING_No).JGYOBU Then
                Exit For
            End If
        Next k
        If k > UBound(JGYOBU_T) Then
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).JGYOBU)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).JGYOBU)
        Else
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).JGYOBU & " " & JGYOBU_T(k).NAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).JGYOBU & " " & JGYOBU_T(k).NAME)
        End If
    
    
        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Format(ID_KANRI_TBL(ING_No).ID, "000"))
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Format(ID_KANRI_TBL(ING_No).ID, "000"))
    
    
        '作業ﾛｸﾞ出力    2017.09.23
        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                    
        Else
                    
            MENU_NO = ""
        End If
        If Trim(MENU_NO) = "" Then
        Else
        '作業ﾛｸﾞ出力
            
            If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                ID_KANRI_TBL(ING_No).NAIGAI, _
                                                MENU_NO, _
                                                (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)) Then
                Sagyo_Send_Proc = SYS_ERR
                Exit Function
            End If
        End If
        '作業ﾛｸﾞ出力    2017.09.23
    
    
    
'>>>>>>>    表示内容の変更　2017.09.23
            
    
    
    
    End If
    
    
    
'    ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = StrConv(MENUREC.CODE_TYPE, vbUnicode)
'    ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = StrConv(MENUREC.YOIN_CODE, vbUnicode)
    ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM = StrConv(YOINREC.SOKO_NO, vbUnicode)
    
    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信

    Sagyo_Send_Proc = False


End Function


' ------------------------------------------------------------------------
'       指定した精度の数値に四捨五入します。
'
' @Param    dValue      丸め対象の倍精度浮動小数点数。
' @Param    iDigits     戻り値の有効桁数の精度。
' @Return               iDigits に等しい精度の数値に四捨五入された数値。
'
'       2012.03.25  frm より　移管
' ------------------------------------------------------------------------
Public Function ToHalfAdjust(ByVal dValue As Currency, ByVal iDigits As Integer) As Currency
    Dim dCoef As Double

    dCoef = (10 ^ iDigits)

    If dValue > 0 Then
        ToHalfAdjust = Int(CDbl(dValue * dCoef + 0.5)) / dCoef
    Else
        ToHalfAdjust = Fix(CDbl(dValue * dCoef - 0.5)) / dCoef
    End If
End Function

' ------------------------------------------------------------------------
'       指定した精度の数値に切り上げします。
'
' @Param    dValue      丸め対象の倍精度浮動小数点数。
' @Param    iDigits     戻り値の有効桁数の精度。
' @Return               iDigits に等しい精度の数値に切り上げられた数値。
'
'       2012.03.25  frm より　移管
'
' ------------------------------------------------------------------------
Public Function ToRoundUp(ByVal dValue As Currency, ByVal iDigits As Integer) As Currency
    Dim dCoef As Double

    
        


    dCoef = (10 ^ iDigits)



    
    
    
    Select Case CDbl(dValue * dCoef) - Fix(dValue * dCoef)
        Case Is > 0
            ToRoundUp = (Int(dValue * dCoef) + 1) / dCoef
        Case Is < 0
            ToRoundUp = (Fix(dValue * dCoef) - 1) / dCoef
        Case Else
            ToRoundUp = dValue
    End Select


'    Select Case CDbl(dValue * dCoef) - Fix(dValue * dCoef)
'        Case Is > 0
'            ToRoundUp = (Int(dValue * dCoef + 0.9)) / dCoef
'        Case Is < 0
'            ToRoundUp = (Fix(dValue * dCoef - 0.9)) / dCoef
'        Case Else
'            ToRoundUp = dValue
'    End Select



End Function

' ------------------------------------------------------------------------
'       指定した精度の数値に切り捨てします。
'
' @Param    dValue      丸め対象の倍精度浮動小数点数。
' @Param    iDigits     戻り値の有効桁数の精度。
' @Return               iDigits に等しい精度の数値に切り捨てられた数値。
'
'
'       2012.03.25  frm より　移管
'
' ------------------------------------------------------------------------
Public Function ToRoundDown(ByVal dValue As Currency, ByVal iDigits As Integer) As Currency
    Dim dCoef As Double

    dCoef = (10 ^ iDigits)

    Select Case CDbl(dValue * dCoef) - Fix(dValue * dCoef)
        Case Is > 0
            ToRoundDown = Int(dValue * dCoef) / dCoef
        Case Is < 0
            ToRoundDown = Fix(dValue * dCoef) / dCoef
        Case Else
            ToRoundDown = dValue
    End Select
End Function

'Public Sub Moji_Cut_Proc(In_Word As String, Out_Word As String, Keta As Integer)
'-------------------------------------------------------
'
'   『指定文字数を切り出す』
'     2011.05.09
'
'       2012.03.25  frm より　移管--->Tool.basにあり
'
'-------------------------------------------------------
'Dim Work    As String
'Dim i       As Integer
'
'
'    For i = 1 To Len(In_Word)
'        Work = Left(In_Word, i)
'        Work = StrConv(Work, vbFromUnicode)
'
'        If LenB(Work) > Keta Then
'            Exit For
'        End If
'
'    Next i
'
'    Out_Word = Left(In_Word, i - 1)
'
'End Sub

Public Function Rireki_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『当日出庫推移表示処理』
'
'       2012.11.06  frm より　移管
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07

Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim DATA_CNT    As Integer

Dim MENU_NO     As String * 2   '2008.08.08

    Rireki_Proc = True

    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & B6_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & B6_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                    
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Rireki_Proc = False
                        Exit Function
                    
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                
                End Select
                                    
                                    
                                    
                                    
                                    '空読みして件数カウント
                
                
                Call UniCode_Conv(K1_IDO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K1_IDO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K1_IDO.HIN_GAI, Hinban)
                Call UniCode_Conv(K1_IDO.JITU_DT, Format(Now, "YYYYMMDD"))
                Call UniCode_Conv(K1_IDO.JITU_TM, "zzzzzz")
                
                DATA_CNT = 0
                
                com = BtOpGetLess
                
                
                Do
                    
                    sts = BTRV(com, IDO_POS, IDOREC, Len(IDOREC), K1_IDO, Len(K1_IDO), 1)
                    Select Case sts
                        Case BtNoErr
                            '事業部／内外／品番ブレーク？
                            If StrConv(IDOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                                StrConv(IDOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                                Trim(StrConv(IDOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                                Exit Do
                            End If
                        
                            '日付？
                            If StrConv(IDOREC.JITU_DT, vbUnicode) <> Format(Now, "YYYYMMDD") Then
                                Exit Do
                            End If
                        
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫移動歴", 0)
                            Exit Function
                    End Select
                    
                    If Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_ZAITEI_OUT Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_KEI Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_HYO Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_GAI Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID2 Then       'ACT_DENPYO_ID2追加 2015.02.21
                    
                    
                        DATA_CNT = DATA_CNT + 1
                    
                    End If
                    
                    com = BtOpGetPrev
                
                Loop
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
                SendFileRec.Title = "0"     'タイトル行
'                Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME & Format(DATA_CNT, "#0") & "件")
                Call UniCode_Conv(SendFileRec.LCD, Left(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, 5) & Format(DATA_CNT, "#0") & "件")
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                SendFileRec.Title = "0"     '品番
                Call UniCode_Conv(SendFileRec.LCD, Hinban)
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                    
                Call UniCode_Conv(K1_IDO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K1_IDO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K1_IDO.HIN_GAI, Hinban)
                Call UniCode_Conv(K1_IDO.JITU_DT, Format(Now, "YYYYMMDD"))
                Call UniCode_Conv(K1_IDO.JITU_TM, "zzzzzz")
                
                com = BtOpGetLess
                
                
                Do
                    
                    sts = BTRV(com, IDO_POS, IDOREC, Len(IDOREC), K1_IDO, Len(K1_IDO), 1)
                    Select Case sts
                        Case BtNoErr
                            '事業部／内外／品番ブレーク？
                            If StrConv(IDOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                                StrConv(IDOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                                Trim(StrConv(IDOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                                Exit Do
                            End If
                        
                            '日付？
                            If StrConv(IDOREC.JITU_DT, vbUnicode) <> Format(Now, "YYYYMMDD") Then
                                Exit Do
                            End If
                        
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫移動歴", 0)
                            Exit Function
                    End Select
                    
                    If Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_ZAITEI_OUT Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_KEI Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_HYO Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_GAI Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID2 Then       'ACT_DENPYO_ID2追加　2015.02.21
                    
                        '当日履歴出力
                        SendFileRec.Title = "1"
                        SUMI_QTY = CLng(StrConv(IDOREC.SUMI_JITU_QTY, vbUnicode))
                        MI_QTY = CLng(StrConv(IDOREC.MI_JITU_QTY, vbUnicode))
                        Call UniCode_Conv(SendFileRec.LCD, StrConv(IDOREC.RIRK_NAME, vbUnicode) & _
                                            Space(10 - Len(Format(SUMI_QTY + MI_QTY, "#0"))) & _
                                            Format(SUMI_QTY + MI_QTY, "#0"))
                        SendFileRec.CRLF = vbCrLf
                        Put #FileNo, , SendFileRec
                    End If
                    
                    com = BtOpGetPrev
                
                Loop
        
                Close #FileNo
        
        
        End Select
    Next i
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = B6_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.FileName = B6_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１～５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Rireki_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    Rireki_Proc = False
    

End Function
Public Function Rireki2_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『当日出庫推移表示2処理』
'   2009.01.09
'       2012.11.06  frm より　移管
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07

Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim DATA_CNT    As Integer

Dim MENU_NO     As String * 2   '2008.08.08

    Rireki2_Proc = True


                        
    If Trim(BD_SendFile) = "" Then
                        
        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "この機能は、", "使用できません", "", "")      '2017.09.22
        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "この機能は、", "使用できません", "", "")  '2017.09.22
        Sendbuf = Text_Create_Proc()
        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        Rireki2_Proc = False
        Exit Function

    End If




    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & BD_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & BD_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                    
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Rireki2_Proc = False
                        Exit Function
                    
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                
                End Select
                                    
                                    
                                    
                                    
                                    '空読みして件数カウント
                

'                Call UniCode_Conv(K1_IDO.JGYOBU, RET_JGYOBU)
'                Call UniCode_Conv(K1_IDO.NAIGAI, RET_NAIGAI)
'                Call UniCode_Conv(K1_IDO.HIN_GAI, Hinban)
'                Call UniCode_Conv(K1_IDO.JITU_DT, Format(Now, "YYYYMMDD"))
'                Call UniCode_Conv(K1_IDO.JITU_TM, "zzzzzz")
'
'                DATA_CNT = 0
'
'                com = BtOpGetLess
'
'
'                Do
'
'                    sts = BTRV(com, IDO_POS, IDOREC, Len(IDOREC), K1_IDO, Len(K1_IDO), 1)
'                    Select Case sts
'                        Case BtNoErr
'                            '事業部／内外／品番ブレーク？
'                            If StrConv(IDOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
'                                StrConv(IDOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
'                                Trim(StrConv(IDOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
'                                Exit Do
'                            End If
'
'                            '日付？
'                            If StrConv(IDOREC.JITU_DT, vbUnicode) <> Format(Now, "YYYYMMDD") Then
'                                Exit Do
'                            End If
'
'                        Case BtErrEOF
'                            Exit Do
'                        Case Else
'                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            Call File_Error(sts, com, "在庫移動歴", 0)
'                            Exit Function
'                    End Select
'
'                    If Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_ZAITEI_OUT Or _
'                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_KEI Or _
'                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_HYO Or _
'                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_GAI Or _
'                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID Then
'
'
'                        DATA_CNT = DATA_CNT + 1
'
'                    End If
'
'                    com = BtOpGetPrev
'
'                Loop
'
'
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0

                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
                SendFileRec.Title = "0"     'タイトル行
                'Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)        '2017.09.22
                Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)    '2017.09.22
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                SendFileRec.Title = "0"     '品番
                Call UniCode_Conv(SendFileRec.LCD, Hinban)
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                    
                Call UniCode_Conv(K1_IDO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K1_IDO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K1_IDO.HIN_GAI, Hinban)
                Call UniCode_Conv(K1_IDO.JITU_DT, Format(Now, "YYYYMMDD"))
                Call UniCode_Conv(K1_IDO.JITU_TM, "zzzzzz")
                
                com = BtOpGetLess
                
                
                Do
                    
                    sts = BTRV(com, IDO_POS, IDOREC, Len(IDOREC), K1_IDO, Len(K1_IDO), 1)
                    Select Case sts
                        Case BtNoErr
                            '事業部／内外／品番ブレーク？
                            If StrConv(IDOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                                StrConv(IDOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                                Trim(StrConv(IDOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                                Exit Do
                            End If
                        
                            '日付？
'                            If StrConv(IDOREC.JITU_DT, vbUnicode) <> Format(Now, "YYYYMMDD") Then
'                                Exit Do
'                            End If
                        
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫移動歴", 0)
                            Exit Function
                    End Select
                    
                    If Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_ZAITEI_OUT Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_ZAITEI_IN Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_KEI Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_HYO Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_SYUKA_GAI Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_DENPYO_ID2 Or _
                        Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_NYUKA Then    'ACT_DENPYO_ID2 追加 2015.02.21
                        '当日履歴出力
                        SendFileRec.Title = "1"
                        SUMI_QTY = CLng(StrConv(IDOREC.SUMI_JITU_QTY, vbUnicode))
                        MI_QTY = CLng(StrConv(IDOREC.MI_JITU_QTY, vbUnicode))
                        
                        If Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_ZAITEI_IN Or _
                            Left(StrConv(IDOREC.RIRK_ID, vbUnicode), 1) = ACT_NYUKA Then
                        Else
                            SUMI_QTY = SUMI_QTY * -1
                            MI_QTY = MI_QTY * -1
                        End If
                        
                        
                        Call UniCode_Conv(SendFileRec.LCD, StrConv(IDOREC.RIRK_NAME, vbUnicode) & _
                                            Space(10 - Len(Format(SUMI_QTY + MI_QTY, "#0"))) & _
                                            Format(SUMI_QTY + MI_QTY, "#0"))
                        SendFileRec.CRLF = vbCrLf
                        Put #FileNo, , SendFileRec
                    End If
                    
                    com = BtOpGetPrev
                
                Loop
        
                Close #FileNo
        
        
        End Select
    Next i
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = BD_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.FileName = BD_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１～５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Rireki2_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    Rireki2_Proc = False
    

End Function
Private Function OLD_SEK_PACKING_ALL_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス　邸別梱包処理』
'
'   2011.04.25
'               2011.07.20 品番毎の集約を廃止
'
'               全数検品対応    2012.03.21
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim k           As Integer      '2011.06.27
Dim l           As Integer      '2011.06.27




Dim Hinban      As String * 20

Dim ID_NO       As String * 13
Dim Found_Flg   As Integer
Dim JUC_SUU     As Long
Dim HINB_CD_CNT As Long



Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1
    

Dim MENU_NO     As String * 2

Dim IN_WORD     As String * 30
Dim OUT_WORD    As String * 16


Dim SAI_SU      As Double

Dim Cnt_F       As Boolean


    OLD_SEK_PACKING_ALL_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SEK_ID_NO      '指図ＩＤ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        '2013.01.19sts = Y_SYUKA_TEI_Check_Proc(ID_NO, Found_Flg)
                        Select Case sts
                            Case BtNoErr          '正常
                
                                '------------------ 梱包済みのチェック
                                If Not Found_Flg Then
                                    
                                    If ID_KANRI_TBL(ING_No).SEK_SAI_SU = 0 Then
                                        
                                        
                                        ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_NO
                                        
                                        '才数入力
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                        
                                        '-----------------------------------------------ヘッダー
                                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                                
                                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                                
                                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                                
                                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                                
                                        Send_Text.FileName = ""                                 '送信データファイル名
                                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                                
                                        Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                                        
                                        '-----------------------------------------------１行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(0).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(0).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(0).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                        
                                        '-----------------------------------------------２行目
                                        IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                                        Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                                                
                                                                                                'BOX属性
                                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(1).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(1).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(1).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                        
                                        '-----------------------------------------------３行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        
                                        '品番状態のカウント
                                        '2013.01.19Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                                        
                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(2).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(2).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                                
                                        Send_Text.Box_Type(2).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        '-----------------------------------------------４行目
                                                                                                'BOX属性
                                                
                                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(3).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(3).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                                        Send_Text.Box_Type(3).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                
                                        '-----------------------------------------------５行目
                                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(4).Start_Pos = "12"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                                '入力桁数
                                        Send_Text.Box_Type(4).Max_Size = "05"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                        Sendbuf = Text_Create_Proc()
                                    
                                        OLD_SEK_PACKING_ALL_Proc = False
                                        Exit Function
                                    
                                    Else
                                    
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "全数梱包済みです", "", "")     '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "全数梱包済みです", "", "") '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        OLD_SEK_PACKING_ALL_Proc = False
                                        Exit Function
                                
                                    End If
                                End If
                            Case BtErrEOF
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "注文ﾃﾞｰﾀなし", "", "")     '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "注文ﾃﾞｰﾀなし", "", "") '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                OLD_SEK_PACKING_ALL_Proc = False
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_NO
                        
'2012.11.15                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Trim(StrConv(Y_SYU_TEI_REC.KEN_HINBAN, vbUnicode))    '2012.10.24
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                                                                '2012.11.15
                        ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = Trim(StrConv(Y_SYU_TEI_REC.KEN_HINBAN, vbUnicode))            '2012.11.15
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>>>> 2017.09.22
                        'Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '>>>>>>>>>> 2017.09.22
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                        Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                        '品番状態のカウント
                        '2013.01.19Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                        
                        
                        
                        
                        
                        
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（品番）
            Cnt_F = False
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban, " 数", "*数"   '品番/数量
                        
                        If Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = " 数" Or _
                            Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = "*数" Then
                        
                            Cnt_F = True
                        End If
                        
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                OLD_SEK_PACKING_ALL_Proc = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "品番エラー", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "品番エラー", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            OLD_SEK_PACKING_ALL_Proc = False
                            Exit Function
                        End If
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) Then
                                If Not ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F Then
                                    ID_KANRI_TBL(ING_No).SEK_LINE = j
                                    Exit For
                                End If
                            End If
                        Next j
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
                    
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            OLD_SEK_PACKING_ALL_Proc = False
                            Exit Function
                        End If
                        
                        For k = 0 To UBound(ID_KANRI_TBL)
                            If k = ING_No Then
                            Else
                                If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = _
                                    ID_KANRI_TBL(k).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(k).Sagyo_Code.YOIN_CODE Then
                                                            
                                    If ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_KANRI_TBL(k).SEK_TEI_LABELID Then
                                        
                                        
                                        If ID_KANRI_TBL(k).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_KONPO_F Then
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")        '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")    '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            OLD_SEK_PACKING_ALL_Proc = False
                                            Exit Function
                                        End If
                                    End If
                                End If
                            End If
                        Next k
                        
                        
                        '仕掛中品番のﾁｪｯｸ   2012.10.24-->2012.11.15 KEN_HINBAN-->KEN_ING_HINBAN
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) Then
                            If Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) <> "" Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "他品番検品中！", ID_KANRI_TBL(ING_No).KEN_ING_HINBAN)       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "他品番検品中！", ID_KANRI_TBL(ING_No).KEN_ING_HINBAN)   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                OLD_SEK_PACKING_ALL_Proc = False
                                Exit Function
                            End If
                        End If
                        '仕掛中品番のﾁｪｯｸ   2012.10.24
                        
                        
                                                
                        '---------------------  品番仕掛中　チェック    2012.04.05
                        If Cnt_F Then
                            If RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) <> RTrim(Hinban) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                OLD_SEK_PACKING_ALL_Proc = False
                                Exit Function
                            End If
                        End If
                        '---------------------  品番仕掛中　チェック    2012.04.05
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 0 Then
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 0 Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 1
                            End If
                        
                            
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU / ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY), 0)) + _
                                                                                (ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU - _
                                                                                ((CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU / ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY)
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 1 Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU
                            Else
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY = CLng(ToRoundUp(CCur(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU Mod ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY), 0))
                            End If
                            
                            
                            
                            '2012.10.24
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT = 0 And _
                                IsNumeric(StrConv(Y_SYU_TEI_REC.J_HIN_CHK_CNT, vbUnicode)) Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = Val(StrConv(Y_SYU_TEI_REC.CNT_BARA_SU, vbUnicode))
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = Val(StrConv(Y_SYU_TEI_REC.CNT_HAKO_SU, vbUnicode))
                            
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT = Val(StrConv(Y_SYU_TEI_REC.J_HIN_CHK_CNT, vbUnicode))
                            
                                Cnt_F = True
                            Else
                            '2012.10.24
                            
                            
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = 0
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = 0
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT + 1
                            
                                If ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY Then
                                    ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = 1
                                Else
                                    ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY
                                End If
                            End If      '2012.10.24
                        
                        
                        
                        
                        End If
                        
                        If Cnt_F Then
                        
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT + 1
                        
                        
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + 1
                            Else
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY
                            End If
                        
                        
                        End If
                        
                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_Y_HIN_CHK_CNT Then
                            
'------------------------------------------ 全数検品終了　----------------------------------------------------------
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F = True
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                            
                            Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            '>>>>>>>    2017.09.22
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            '>>>>>>>    2017.09.22
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    
                            IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                            Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_DATA_CNT = 1 Then
    
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                                                                    
                            Else
                            
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                            
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            
                            '>>>>>>>>>>>>>>>    2012.06.21
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU > 1 Then

                                '2012.09.27
'                               If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then
                                If ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU > 1 Then
                                    Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE


                                '2012.09.27
                                Else
                                End If
                            End If
                            '>>>>>>>>>>>>>>>    2012.06.21
                            
                            Sendbuf = Text_Create_Proc()
                        
                            OLD_SEK_PACKING_ALL_Proc = False
                            
                            Exit Function
                        
                        
                        Else
                        
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.24
                            '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                Exit Function
                            End If
                                                            
                                                            
                                        
                            '------------------------------------   注文ﾃﾞｰﾀの処理
            
                            com = BtOpGetGreaterEqual
                            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
                            
                            Do
                                
'                                DoEvents
                                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                    DoEvents                                                    '2016.01.26
                                End If                                                          '2016.01.26
                            
                                Do
                                
                                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrEOF
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")        '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")    '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            OLD_SEK_PACKING_ALL_Proc = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                            
                                Loop
                            
                                
                                If sts = BtErrEOF Then
                                    Exit Do
                                End If
                                
                                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                                    Exit Do
                                End If

                        
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) Then
                                            
                                            Call UniCode_Conv(Y_SYU_TEI_REC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT, "0000000"))
                                            
                                            Call UniCode_Conv(Y_SYU_TEI_REC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU, "0000000"))
                                            Call UniCode_Conv(Y_SYU_TEI_REC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU, "0000000"))
                                            Exit For
                                    End If
                                Next j
                        
                        
                                Call UniCode_Conv(Y_SYU_TEI_REC.KEN_HINBAN, Hinban)
                
                                Do
'                                    DoEvents
                                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                        DoEvents                                                    '2016.01.26
                                    End If                                                          '2016.01.26
                                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")      '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")  '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            OLD_SEK_PACKING_ALL_Proc = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")        '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")    '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            OLD_SEK_PACKING_ALL_Proc = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                
                
                
                                com = BtOpGetNext
                
                            Loop
                                                'トランザクション終了
                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                            End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.24
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                            
                            Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            '>>>>>>>>   2017.09.22
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            '>>>>>>>>   2017.09.22
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    
                            IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                            Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_DATA_CNT = 1 Then
    
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                                                                    
                            Else
                            
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                            
                            
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            Sendbuf = Text_Create_Proc()
                        
                            OLD_SEK_PACKING_ALL_Proc = False
                            
                            Exit Function
                        
                        End If
                
                End Select
            
            Next i
        
        
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
    
    
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                            
                        
            '------------------------------------   注文ﾃﾞｰﾀの処理
            
            com = BtOpGetGreaterEqual
            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
            
            Do
                
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
            
                Do
                
                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrEOF
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            OLD_SEK_PACKING_ALL_Proc = False
                            GoTo Abort_Tran
                        Case Else
                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
            
                Loop
            
                
                If sts = BtErrEOF Then
                    Exit Do
                End If
                
                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                    Exit Do
                End If
                
'2012.10.24                If Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) And _
'2012.10.24                    StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode) = ID_KANRI_TBL(ING_No).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_SEQ_NO Then
'2012.10.24
'2012.10.24                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
'2012.10.24                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
'2012.10.24
'2012.10.24                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
'2012.10.24                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
'2012.10.24
'2012.10.24                    Do
'2012.10.24                        DoEvents
'2012.10.24                        sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
'2012.10.24                        Select Case sts
'2012.10.24                            Case BtNoErr
'2012.10.24                                Exit Do
'2012.10.24                            Case BtErrKeyNotFound
'2012.10.24                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
'2012.10.24                                Sendbuf = Text_Create_Proc()
'2012.10.24                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.24                                SEK_PACKING_ALL_Proc = False
'2012.10.24                                GoTo Abort_Tran
'2012.10.24                             Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.10.24                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
'2012.10.24                                Sendbuf = Text_Create_Proc()
'2012.10.24                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.24                                SEK_PACKING_ALL_Proc = False
'2012.10.24                                GoTo Abort_Tran
'2012.10.24                            Case Else
'2012.10.24                                Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
'2012.10.24                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.10.24                                Sendbuf = Text_Create_Proc()
'2012.10.24                                GoTo Abort_Tran
'2012.10.24                        End Select
'2012.10.24                    Loop
'2012.10.24
'2012.10.24                End If
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.24
                If Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) And _
                    StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode) = ID_KANRI_TBL(ING_No).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_SEQ_NO Then
                
                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                                
                
                End If
                
'2012.10.31                ID_KANRI_TBL(ING_No).KEN_HINBAN = ""
                Call UniCode_Conv(Y_SYU_TEI_REC.KEN_HINBAN, "")
                
                Do
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrKeyNotFound
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")      '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")  '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            OLD_SEK_PACKING_ALL_Proc = False
                            GoTo Abort_Tran
                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            OLD_SEK_PACKING_ALL_Proc = False
                            GoTo Abort_Tran
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.24
                
                
                com = BtOpGetNext
                
                
            Loop
                                            
'2012.11.15            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.31
            '------------------------------------   在庫移動履歴の処理
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                MENU_NO = ""
            End If
                                            
                                            
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        ID_KANRI_TBL(ING_No).SEK_SYU_JUN & " " & Trim(ID_KANRI_TBL(ING_No).SEK_TEI_NM), _
                                        , , , , MENU_NO, _
                                        , _
                                        "", _
                                        , , , , 1, , , , , , , ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    OLD_SEK_PACKING_ALL_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
            
            '------------------------------------   作業ログの処理
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                    OLD_SEK_PACKING_ALL_Proc = SYS_ERR
                    Exit Function
                End If
            End If
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
            '品番状態のカウント
            '2013.01.19Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
    
            If HINB_CD_CNT <> ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT Then
            '次　品番
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                
                ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = "" '2012.11.15
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                '>>>>>>>>>> 2017.09.22
'                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                '>>>>>>>>>> 2017.09.22
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                
                
                
                
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        
                                                                        
                IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                        
                                                                        
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                
                
                
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                
                '品番状態のカウント
                '2013.01.19Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                
                
                
                
                
                
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                Sendbuf = Text_Create_Proc()
            
            Else
            '梱包完了
            
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                '>>>>>>>>>  2017.09.22
'                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                '>>>>>>>>>  2017.09.22
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                
                '-----------------------------------------------３行目
                IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                        
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "検品完了" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "検品完了" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "→ENT")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "→ENT")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                Sendbuf = Text_Create_Proc()
            End If
    
    
        Case Step_Sagyo4_RES        '４回目の受信（Any Key）
            
            
            
            If ID_KANRI_TBL(ING_No).SEK_SAI_SU = 0 Then
                '才数入力
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                
                '-----------------------------------------------２行目
                IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                        
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                
                '品番状態のカウント
                '2013.01.19Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                        
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                        
                '-----------------------------------------------５行目
                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                '数値初期表示
                Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                        '入力桁数
                Send_Text.Box_Type(4).Max_Size = "05"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                Sendbuf = Text_Create_Proc()
            
            Else
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                    Case BtNoErr
                    '   -------------------------------- エラーメッセージ作成
                    Case Else
                    '重要な要因なので未登録はシステム停止とする
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                        Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                
                If Sagyo_Send_Proc() Then
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                End If
            
                Sendbuf = Text_Create_Proc()
    
            End If
    
    
        Case Step_Sagyo5_RES        '５回目の受信（才数）
    
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '才数
                    Case LCD_SAI_SU_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "") '2017.09.22
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            OLD_SEK_PACKING_ALL_Proc = False
                            Exit Function
                        
                        End If
                
                        SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                
                
                        If SAI_SU = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "") '2017.09.22
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            OLD_SEK_PACKING_ALL_Proc = False
                            Exit Function
                        
                        End If
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                        '------------------------------------   注文ﾃﾞｰﾀの処理
                        Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
                        com = BtOpGetGreaterEqual
            
                        Do
                    
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                
                            Do
                    
                                sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrEOF
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")    '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        OLD_SEK_PACKING_ALL_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                
                            Loop
            
                
                            If sts = BtErrEOF Then
                                Exit Do
                            End If
                    
                            If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                                Exit Do
                            End If
                        
                
                            Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, "0001")
                            Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(SAI_SU, "000.00"))
                        
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                        
                        
                
                            Do
'                                DoEvents
                                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                    DoEvents                                                    '2016.01.26
                                End If                                                          '2016.01.26
                                sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")      '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")  '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        OLD_SEK_PACKING_ALL_Proc = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")    '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        OLD_SEK_PACKING_ALL_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                
                
                            com = BtOpGetNext
                
                
                        Loop
                                'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
    
                        '次の作業要求
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                        End Select
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                    
                        Sendbuf = Text_Create_Proc()
                    
                End Select
            Next i
    End Select

    OLD_SEK_PACKING_ALL_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If









    OLD_SEK_PACKING_ALL_Proc = False

End Function

Private Function New_Inspe_Proc_SEK(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス検品処理（宅配伝票読み込み 大阪ＰＣ向け）』
'
'       2011.05.09
'2013.04.07 で検索要！！！
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer
Dim l               As Integer

Dim MENU_NO         As String * 2

Dim ID_NO           As String * 12
Dim SEK_ID_NO       As String

Dim CANCEL_F        As Boolean
Dim KENPIN_F        As Boolean
Dim SHOGO_F         As Boolean
Dim Y_Found_F       As Boolean
Dim T_Found_F       As Boolean

Dim Sumi_CNT        As Integer
Dim KUTI_SU         As Integer
Dim SAI_SU          As Double
Dim INPUT_SAI_SU    As Double



Dim OKURI_NO        As String
Dim OKURI_NO_F      As Boolean
Dim FUKUYAMA_CHK_F  As Boolean

Dim FileName        As String

Dim IN_WORD         As String * 30
Dim OUT_WORD        As String * 16

Dim wkTEI_LABELID() As String * 13
                        
Dim wkSai_Input     As Long

Dim wkSEK_PAGE_NO   As Integer
Dim From_Page_No    As Integer
Dim To_Page_No      As Integer
Dim wkKUTI_SU       As Integer

    New_Inspe_Proc_SEK = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                        
                                        
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        CANCEL_F = True
                        KENPIN_F = True
                        Y_Found_F = False
                        T_Found_F = False
                        
                        Erase ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL
                        
                        
                        ID_KANRI_TBL(ING_No).SEK_PAGE_NO = 0
                        j = -1
                            
                        
                        '梱包済み＆キャンセルのチェック
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_NO)
                                                
                                                
                        com = BtOpGetGreaterEqual
                        
                        Do
                        
                            sts = BTRV(com, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    If Trim(ID_NO) <> Left(StrConv(Y_SYUREC.ID_NO, vbUnicode), 7) Then
                                        Exit Do
                                    End If
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call File_Error(sts, com, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                        
                            
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))
                                            
                            sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                    Call File_Error(sts, com, "出荷予定(H)", 0)
                                    Call Err_Send_Proc("システム異常発生", "出荷ﾃﾞｰﾀｱﾝﾏｯﾁ", Trim(ID_NO), "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                
                                Case Else
                                    Call File_Error(sts, com, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                        
                            If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) <> "1" Then
                                CANCEL_F = False
                            End If
                        
                        
                            ID_KANRI_TBL(ING_No).KEN_OKURI_NO = Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode))               '送り状№
                            ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode))       '運送会社
                            ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode))            '送り先
                                                                                                                            '向け先
                            If Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode)) <> Trim(StrConv(Y_SYU_HREC.MUKE_NAME, vbUnicode)) Then
                                ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = Trim(StrConv(Y_SYU_HREC.MUKE_NAME, vbUnicode))
                            Else
                                ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = ""
                            End If
                            ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = Trim(StrConv(Y_SYU_HREC.SYUKA_YMD, vbUnicode))             '出荷日
                            ID_KANRI_TBL(ING_No).KEN_JYUSHO = Trim(StrConv(Y_SYU_HREC.JYUSHO, vbUnicode))                   '住所
                            ID_KANRI_TBL(ING_No).KEN_BIKOU = Trim(StrConv(Y_SYU_HREC.BIKOU, vbUnicode))                     '備考
                            
                            If Trim(StrConv(Y_SYUREC.KENPIN_TANTO_CODE, vbUnicode)) = "" Then
                                KENPIN_F = False
                            End If
                            
                            
                            If IsNumeric(StrConv(Y_SYU_HREC.OKURI_NO_SEQ_TO, vbUnicode)) Then
                                                                                                                            '荷札印刷開始ﾍﾟｰｼﾞ
                                If ID_KANRI_TBL(ING_No).SEK_PAGE_NO < CInt(StrConv(Y_SYU_HREC.OKURI_NO_SEQ_TO, vbUnicode)) Then
                                    ID_KANRI_TBL(ING_No).SEK_PAGE_NO = CInt(StrConv(Y_SYU_HREC.OKURI_NO_SEQ_TO, vbUnicode))
                                End If
                            End If
                            
                            
                            Y_Found_F = True
                            
                            Call UniCode_Conv(K2_Y_SYU_TEI.KEN_NO, StrConv(Y_SYU_HREC.SEK_KEN_NO, vbUnicode))
                            Call UniCode_Conv(K2_Y_SYU_TEI.HIN_NO, StrConv(Y_SYU_HREC.SEK_HIN_NO, vbUnicode))
                            
                            sts = BTRV(BtOpGetEqual, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K2_Y_SYU_TEI, Len(K2_Y_SYU_TEI), 2)
                            Select Case sts
                                Case BtNoErr
                                    '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                    'If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) = "" And Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = "" Then
                                    'Else
                                    '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                        T_Found_F = True
                                    
                                        If j = -1 Then
                                            j = j + 1
                                            ReDim Preserve ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(0 To j)
                                            
                                            
                                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) = "" And Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = " "
                                            Else
                                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                                Else
                                                    
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                                
                                                
                                                
                                                
                                                End If
                                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                            End If
                                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                        
                                                                                                            '出荷順
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN = Trim(StrConv(Y_SYU_TEI_REC.SYU_JUN, vbUnicode))
                                                                                                            '邸名
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_TEI_NM = Trim(StrConv(Y_SYU_TEI_REC.TEI_NM, vbUnicode))
                                                                                                            '口数
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KUTI_SU = Val(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode))
                                                                                                            '才数
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                            
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.KENPIN_TANTO, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = True
                                            Else
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = False
                                            End If
                                            
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = True
                                            Else
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = False
                                            End If
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = True
                                            Else
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = False
                                            End If
        
                                        Else
                                        
                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> "" Then
                                                    If Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) = Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) Then
                                                        Exit For
                                                    End If
                                                End If
                                            
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) = "" Then
                                            
                                                    If Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                                                        Exit For
                                                    End If
                                                End If
                                            Next j
                                        
                                        
                                            If j > UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) Then
                                        
                                                ReDim Preserve ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(0 To j)
                                                
                                                
                                                
                                                '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) = "" And Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                                Else
                                                '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                                
                                                
                                                
                                                
                                                    If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> "" Then
                                                        ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                                    Else
                                                        
                                                        ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                                    
                                                    
                                                    
                                                    End If
                                                '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                                End If
                                                '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                                                                                            '出荷順
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN = Trim(StrConv(Y_SYU_TEI_REC.SYU_JUN, vbUnicode))
                                                                                                                '邸名
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_TEI_NM = Trim(StrConv(Y_SYU_TEI_REC.TEI_NM, vbUnicode))
                                                                                                                '口数
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KUTI_SU = Val(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode))
                                                                                                                '才数
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.KENPIN_TANTO, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = True
                                                Else
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = False
                                                End If
                                                
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = True
                                                Else
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = False
                                                End If
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = True
                                                Else
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = False
                                                End If
                                            
                                            
                                                If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)) > 13 Then
                                                                                                                    '梱包ID毎の件数
                                                End If
                                            
                                            
                                            Else
                                            
                                            
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = False
                                                End If
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) = "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = False
                                                End If
                                            
                                            
                                            End If
                                        
                                        End If
                                    '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                    'End If
                                    '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 空白を含む  2013.02.20
                                Case BtErrKeyNotFound
                                Case Else
                                    Call File_Error(sts, com, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                            
                            
                        
                            com = BtOpGetNext
                                
                        Loop
                        
                        '出荷データ有無チェック
                        If Not Y_Found_F Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            New_Inspe_Proc_SEK = False
                            Exit Function
                        End If
                        'キャンセルチェック
                        If CANCEL_F Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "キャンセル伝票です。", "", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            New_Inspe_Proc_SEK = False
                            Exit Function
                        End If
                        '検品処理済みチェック
                        If KENPIN_F Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品処理済！", "", "")         '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "検品処理済！", "", "")     '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            New_Inspe_Proc_SEK = False
                            Exit Function
                        End If
                        
                        
                        
                        '梱包ＩＤ毎の件数を集計
 '                       For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
 '
 '                           If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)) > 13 Then
 '
 '                               Erase wkTEI_LABELID
 '                               Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)
 '
 '                               com = BtOpGetGreaterEqual
 '                               k = -1
 '                               Do
 '
 '                                   DoEvents
 '
 '                                   sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
 '                                   Select Case sts
 '                                       Case BtNoErr
 '                                           If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(StrConv(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO, vbUnicode)) Then
 '                                               Exit Do
 '                                           End If
 '                                       Case BtErrEOF
 '                                           Exit Do
 '                                       Case Else
 '                                           Call File_Error(sts, com, "邸別注文ﾃﾞｰﾀ", 0)
 '                                           Call Err_Send_Proc("システム異常発生", "", "", "", "")
 '                                           Sendbuf = Text_Create_Proc()
 '                                           Exit Function
 '                                   End Select
 '
 '                                   If k = -1 Then
 '                                        k = k + 1
 '                                       ReDim Preserve wkTEI_LABELID(0 To k)
 '                                       wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
 '                                   Else
 '                                       For k = 0 To UBound(wkTEI_LABELID)
 '
 '                                           If Trim(wkTEI_LABELID(k)) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
 '                                                Exit For
 '                                           End If
 '
 '                                       Next k
 '
 '
 '                                       If k > UBound(wkTEI_LABELID) Then
 '                                           ReDim Preserve wkTEI_LABELID(0 To k)
 '                                           wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
 '                                       End If
 '
 '                                   End If
 '
 '                                   com = BtOpGetNext
 '
 '                               Loop
 '
 '
 '
 '                               If k = -1 Then
 '                                   ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = 0
 '                               Else
 '                                   ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = UBound(wkTEI_LABELID) + 1
 '
 '                               End If
 '                           Else
 '                               ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = 0
 '                           End If
 '
 '                       Next j
                        
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        
                        
                        
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                        
                            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                            '-----------------------------------------------１行目
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            '>>>>>>>>   2017.09.22
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            '>>>>>>>>   2017.09.22
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
                
                
                
                        Else
                
                
                            '2013.04.07Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                        
                            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
                                                            'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            '>>>>>>>>>  2017.09.22
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            '>>>>>>>>>  2017.09.22
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    
                            
                            '-----------------------------------------------２行目
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                            'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
            
                            Sendbuf = Text_Create_Proc()
                        End If
                
                
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状№）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状№
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        
                        Else
                        
                            If Not IsNumeric(OKURI_NO) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状№エラー", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                New_Inspe_Proc_SEK = False
                                Exit Function
                            End If
                        
                        
                        
                            '2013.04.07If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            '2013.04.07End If
                            
                            If Not OKURI_NO_F Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状№エラー", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                New_Inspe_Proc_SEK = False
                                Exit Function
                                                
                            End If
                        
                            If FUKUYAMA_CHK_F Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                New_Inspe_Proc_SEK = False
                                Exit Function
                            
                            End If
                        
                        End If
                    
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                    
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID№
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO))
                        com = BtOpGetGreaterEqual
                        Do
                        
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                                                        
                            sts = BTRV(com, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                
                                    If Left(StrConv(Y_SYUREC.ID_NO, vbUnicode), 7) <> Trim(ID_KANRI_TBL(ING_No).ID_NO) Then
                                        Exit Do
                                    End If
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                            Do
                        
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")     '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "") '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        New_Inspe_Proc_SEK = False
                                        GoTo Abort_Tran
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")    '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        New_Inspe_Proc_SEK = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                            
                                            
                            If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) = "1" Then
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, "")
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "")
                            Else
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                '2013.04.07Call OKURI_NO_SET_PROC(OKURI_NO)
                            End If
        
                            Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                            Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                        
                            '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        New_Inspe_Proc_SEK = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                        New_Inspe_Proc_SEK = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                        
                            com = BtOpGetNext
                        
                        Loop
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        '2013.04.07Call SEK_Kenpin_Count_Proc(Sumi_CNT)
            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                    
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>>   2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '>>>>>>>>   2017.09.22
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                
                        
                        '-----------------------------------------------２行目
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性

                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（指示№）
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 3)
                    
                    Case LCD_SEK_ID_NO     '指示ID
                        SEK_ID_NO = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                        
                            If Trim(SEK_ID_NO) = Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) Then
                                Exit For
                            End If
                        
                        Next j
                        
                        '指示№ﾁｪｯｸ
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, SEK_ID_NO, "指示№エラー", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, SEK_ID_NO, "指示№エラー", "", "") '2017.09.22
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            New_Inspe_Proc_SEK = False
                            Exit Function
                        
                        End If
                        
                        If Len(Trim(SEK_ID_NO)) > 13 Then
                        '梱包IDでのﾁｪｯｸ
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, SEK_ID_NO)
                        Else
                        '邸別IDでのﾁｪｯｸ
                            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, SEK_ID_NO)
                        End If
                                                        
                        com = BtOpGetGreaterEqual
                        T_Found_F = False
                        
                        Do
                        
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                        
                            If Len(Trim(SEK_ID_NO)) > 13 Then
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                            Else
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                            End If
                            
                            Select Case sts
                                Case BtNoErr
                                        
                                    If Len(Trim(SEK_ID_NO)) > 13 Then
                                    '梱包IDでのﾁｪｯｸ
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(SEK_ID_NO) Then
                                            Exit Do
                                        End If
                                    Else
                                    '邸別IDでのﾁｪｯｸ
                                        If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(SEK_ID_NO) Then
                                            Exit Do
                                        End If
                                    End If
                                    
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                    New_Inspe_Proc_SEK = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
'                                   GoTo Abort_Tran                  2011.12.22
                                    Exit Function                   '2011.12.22
                            End Select
                        
                            '2011.05.27
                            If SEK_KEN_SHOGO_F Then
                                If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) = "" Then
                            
'2011.06.22                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未照合注文有り！！", "")
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未照合注文です！！", "")               '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未照合注文です！！", "")           '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    New_Inspe_Proc_SEK = False
                                    Exit Function
                                End If
                            End If
                        
                        
                            If SEK_KEN_KONPO_F Then
                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" And Trim(StrConv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, vbUnicode)) = "" Then
                            
'2011.06.22                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未梱包有り！", "")
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未梱包です！！", "")                   '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未梱包です！！", "")               '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    New_Inspe_Proc_SEK = False
                                    Exit Function
                                End If
                            End If
                        
                                                
                            If SEK_KEN_KENPIN_F Then
                        
                                If Trim(StrConv(Y_SYU_TEI_REC.KENPIN_TANTO, vbUnicode)) <> "" Then
                            
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "検品済み！！", "")                     '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "検品済み！！", "")                 '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    New_Inspe_Proc_SEK = False
                                    Exit Function
                                End If
                            
                            End If
                            '2011.05.27
                                                
                        
                            T_Found_F = True
                        
                        
                            com = BtOpGetNext
                        
                        
                        Loop
                        
                        If Not T_Found_F Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "邸別注文データなし！", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "邸別注文データなし！", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            New_Inspe_Proc_SEK = False
                            Exit Function
                        End If
                                    
                        
                        ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO = SEK_ID_NO
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                    
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>    2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '>>>>>>>    2017.09.22
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        
                        '-----------------------------------------------２行目
                        
                        '2013.04.07Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                        
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        '-----------------------------------------------３行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        
                        
                        IN_WORD = ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_TEI_NM
                        Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                        
                        
                        
                        If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
                            
                           '梱包ＩＤ毎の件数を集計
    
                            Erase wkTEI_LABELID
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)
    
                            com = BtOpGetGreaterEqual
                            k = -1
                            Do
    
'                                DoEvents
                                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                    DoEvents                                                    '2016.01.26
                                End If                                                          '2016.01.26
    
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                Select Case sts
                                    Case BtNoErr
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) Then
                                            Exit Do
                                        End If
                                    Case BtErrEOF
                                        Exit Do
                                    Case Else
                                        Call File_Error(sts, com, "邸別注文ﾃﾞｰﾀ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
    
                                If k = -1 Then
                                    k = k + 1
                                    ReDim Preserve wkTEI_LABELID(0 To k)
'''                                    wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                    wkTEI_LABELID(k) = Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7)
                                Else
                                    For k = 0 To UBound(wkTEI_LABELID)

'''                                           If Trim(wkTEI_LABELID(k)) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                                           If Left(wkTEI_LABELID(k), 7) = Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7) Then
                                                Exit For
                                           End If
    
                                    Next k
    
    
                                    If k > UBound(wkTEI_LABELID) Then
                                        ReDim Preserve wkTEI_LABELID(0 To k)
'''                                        wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                        wkTEI_LABELID(k) = Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7)
                                    End If
    
                                End If
    
                                com = BtOpGetNext
    
                            Loop
    
    
    
                            If k = -1 Then
                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = 0
                            Else
                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = UBound(wkTEI_LABELID) + 1

                            End If
                            
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Format(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT, "#0") & "件(" _
                                                                                & Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & _
                                                                                OUT_WORD & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Format(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT, "#0") & "件" _
                                                                                & Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & _
                                                                                OUT_WORD)
                        Else
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & OUT_WORD)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & OUT_WORD)
                        End If
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
            
            Next i
    
        Case Step_Sagyo4_RES        '４回目の受信（ANY KEY　受信）
            
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                                    
            '----------------------------------- 邸別注文データ処理 -----------
            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                If ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO = ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO Then
                    wkKUTI_SU = ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KUTI_SU
                    Exit For
                End If
            Next j
            
            
            
            If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
            '梱包IDでのﾁｪｯｸ
                Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
            Else
            '邸別IDでのﾁｪｯｸ
                Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
            End If
                                                        
            com = BtOpGetGreaterEqual
                        
            Do
            
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
            
                If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
                    sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                Else
                    sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                End If
                
                Select Case sts
                    Case BtNoErr
                            
                        If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
                        '梱包IDでのﾁｪｯｸ
                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
                                Exit Do
                            End If
                        Else
                        '邸別IDでのﾁｪｯｸ
                            If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
                                Exit Do
                            End If
                        End If
                        
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                        New_Inspe_Proc_SEK = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            '----------------------------------- 出荷予定(H)処理 -----------
                Call UniCode_Conv(K8_Y_SYU_H.SEK_KEN_NO, StrConv(Y_SYU_TEI_REC.KEN_NO, vbUnicode))
                Call UniCode_Conv(K8_Y_SYU_H.SEK_HIN_NO, StrConv(Y_SYU_TEI_REC.HIN_NO, vbUnicode))
                                            
                sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K8_Y_SYU_H, Len(K8_Y_SYU_H), 8)
                
                Select Case sts
                    Case BtNoErr
                    
                    Case BtErrKeyNotFound
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, "出荷予定(H)", "アンマッチ！")     '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, "出荷予定(H)", "アンマッチ！") '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        New_Inspe_Proc_SEK = False
                        Exit Function
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                        New_Inspe_Proc_SEK = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            '----------------------------------- 出荷予定処理 -----------
                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, StrConv(Y_SYU_HREC.ID_NO, vbUnicode))
                                            
                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                
                Select Case sts
                    Case BtNoErr
                    
                    Case BtErrKeyNotFound
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, "出荷予定", "アンマッチ！")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, "出荷予定", "アンマッチ！")    '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        New_Inspe_Proc_SEK = False
                        'Exit Function              2011.12.22
                        GoTo Abort_Tran         '   2011.12.22
                    Case Else
                        GoTo Abort_Tran
                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                        New_Inspe_Proc_SEK = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
                                            
            '----------------------------------- 出荷予定書き込み処理 -----------
                                        
                Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                
                Call UniCode_Conv(Y_SYUREC.UPD_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                                                
                Do
                    sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            New_Inspe_Proc_SEK = False
                            GoTo Abort_Tran
                    
                        Case Else
                            
                            Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                            New_Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                                            
                                            
            '----------------------------------- 出荷予定(H)書き込み処理 -----------
                                            
                Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                    
                
                 If com = BtOpGetGreaterEqual Then
                
                    wkSEK_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                    
                    
                    ID_KANRI_TBL(ING_No).SEK_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO + 1
                    From_Page_No = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                    
                    ID_KANRI_TBL(ING_No).SEK_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO + wkKUTI_SU - 1
                    To_Page_No = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                                            
                End If
                                            
                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ, Format(From_Page_No, "000"))
                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ_TO, Format(To_Page_No, "000"))
                                            
                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                                            
                                            
                                            
                Do
                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K8_Y_SYU_H, Len(K8_Y_SYU_H), 8)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            New_Inspe_Proc_SEK = False
                            GoTo Abort_Tran
                    
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                            New_Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                
            '----------------------------------- 邸別注文ﾃﾞｰﾀ(H)書き込み処理 -----------
                                            
                Call UniCode_Conv(Y_SYU_TEI_REC.KENPIN_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                Call UniCode_Conv(Y_SYU_TEI_REC.KENPIN_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                                            
                                            
                Do
                    
                    If Len(Trim(SEK_ID_NO)) > 13 Then
                    '梱包IDでのﾁｪｯｸ
                        sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU, Len(K3_Y_SYU), 3)
                    Else
                    '邸別IDでのﾁｪｯｸ
                        sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU, Len(K1_Y_SYU), 1)
                    End If
                    
                    
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文ﾃﾞｰﾀ使用中", "", "")      '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文ﾃﾞｰﾀ使用中", "", "")  '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            New_Inspe_Proc_SEK = False
                            GoTo Abort_Tran
                    
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "邸別注文ﾃﾞｰﾀ", 0)
                            New_Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                '------------------------------------   在庫移動履歴の処理
                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                    MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                            
                Else
                    MENU_NO = ""
                End If
                                            
                '履歴出力の為の読み込み
                Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                Call UniCode_Conv(K0_MTS.SS_CODE, "")
                sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                        Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                        Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                    Case Else
                        Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        'Exit Function              2011.12.22
                        GoTo Abort_Tran         '   2011.12.22
                                        
                End Select
                sts = IDOREKI_OUTPUT_PROC("", _
                                            "", _
                                            ID_KANRI_TBL(ING_No).JGYOBU, _
                                            ID_KANRI_TBL(ING_No).NAIGAI, _
                                            "", _
                                            "", _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            0, _
                                            0, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            FILE_RETRY, _
                                            CYU_KBN_SPO, _
                                            Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状№:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                            , , , , MENU_NO, _
                                            ID_KANRI_TBL(ING_No).MTS_CODE, _
                                            "", _
                                            ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, , , , 1)
                Select Case sts
                    Case False      '正常終了
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        New_Inspe_Proc_SEK = SYS_ERR
                        GoTo Abort_Tran
                End Select
                
                '運送会社
                ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
            
                
                com = BtOpGetNext
            
            Loop
            
            '作業ﾛｸﾞ出力
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     , , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).MTS_CODE) Then
                    New_Inspe_Proc_SEK = SYS_ERR
                    'Exit Function          2011.12.22
                   GoTo Abort_Tran      '   2011.12.22
                End If
            End If
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If

            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                If Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) = Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = True
                    Exit For
                End If
            Next j
            
            
                    
            '2013.04.07Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                    
                    
            ''' 荷札処置
            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
            
            
                If Sumi_CNT = UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1 Then
                '--------------------------------------------------------------------口数・才数へ
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    '-----------------------------------------------ヘッダー
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                    Send_Text.FileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                    '-----------------------------------------------１行目
                                                                            'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
                    '>>>>>>>>   2017.09.22
'                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                    
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    '>>>>>>>>   2017.09.22
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '--------------------------------------------------４行目
                    '2013.04.07Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                                                                'BOX属性
                                
                    Send_Text.Box_Type(3).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                    
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
        
                    '-----------------------------------------------５行目
                                                                        'BOX属性
                    If SAI_SU >= 999999 Or SAI_SU = 0 Then
                    
                    
                    
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                    
                    
                    Else
                    
                    
                    
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                    
'                        ID_KANRI_TBL(ING_No).SEK_SAI_SU = SAI_SU
'                        ID_KANRI_TBL(ING_No).SEK_KUTI_SU = KUTI_SU
                            
                    
                    End If
                            
                            
                    Sendbuf = Text_Create_Proc()
                Else
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    '-----------------------------------------------ヘッダー
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                    Send_Text.FileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                    
                    '-----------------------------------------------１行目
                                                    'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
                    '>>>>>>>>   2017.09.22
'                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    '>>>>>>>>   2017.09.22
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            
                    
                    '-----------------------------------------------２行目
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    '-----------------------------------------------３行目
                                                                                    'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '-----------------------------------------------４行目
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                            '表示内容
                                                                        '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "20"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                            
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                                                                            'BOX属性
    
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                     Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                    Sendbuf = Text_Create_Proc()
                End If
            
            Else
                
                '2013.04.07Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                
'''''''''''''''''''''''''   2011.06.29
                If wkSEK_PAGE_NO = 0 Then
                    wkSEK_PAGE_NO = SEK_LABEL_PAGE - 1
                End If
'''''''''''''''''''''''''   2011.06.29
                
'2013.04.07                If SEK_Label_File_Make_Proc(fileName, wkSEK_PAGE_NO, wkKUTI_SU, KUTI_SU) Then
'2013.04.07                    Inspe_Proc_SEK = SYS_ERR
'2013.04.07                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2013.04.07                    Sendbuf = Text_Create_Proc()
'2013.04.07                    'GoTo Abort_Tran        2011.12.22
'2013.04.07                    Exit Function       '   2011.12.22
'2013.04.07                End If
                If ID_KANRI_TBL(ING_No).SEK_PAGE_NO < SEK_LABEL_PAGE Then

                    If Sumi_CNT = UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1 Then
                    '--------------------------------------------------------------------口数・才数へ
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""

                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>> 2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '>>>>>>> 2017.09.22
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"

                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"

                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                    '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容

                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)

                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"

                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '--------------------------------------------------４行目
                        '2013.04.07Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                                                                    'BOX属性

                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""

                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        If ID_KANRI_TBL(ING_No).SEK_SYUGO_SAI_SU > 999 Or ID_KANRI_TBL(ING_No).SEK_SYUGO_SAI_SU = 0 Then



                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                            '数値初期表示
                            Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "12"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "05"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"


                        Else



                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                                                                            '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"



                        End If



                        Sendbuf = Text_Create_Proc()
                    Else

                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""

                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF

                        '-----------------------------------------------１行目
                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>>>> 2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '>>>>>>>>>> 2017.09.22
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"

                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""


                        '-----------------------------------------------２行目
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"

                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容

                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"

                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"

                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性

                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"

                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                    End If




                
                Else
            
                '印刷要求送信
                                            
                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                
                                                
                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                
                    ID_KANRI_TBL(ING_No).LABEL_ON = True
                
                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                    '-----------------------------------------------ヘッダー
                
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                    Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL
                
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                    Send_Text.FileName = FileName                           '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.FileName = FileName
                
                    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                    Sendbuf = Text_Create_Proc()
            
                End If
            
            End If
                    
        Case Step_PRINT_RES        '印刷終了
                    
            '2013.04.07Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                    
            If Sumi_CNT = UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1 Then
            '--------------------------------------------------------------------口数・才数へ
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
            
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                '>>>>>>>    2017.09.22
'                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                '>>>>>>>    2017.09.22
                                                                        
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                        "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                        "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                                                                        
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                        
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '--------------------------------------------------４行目
                '2013.04.07Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                                                            'BOX属性
                            
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    
                '-----------------------------------------------５行目
                                                                        'BOX属性
                If SAI_SU >= 999999 Or SAI_SU = 0 Then
                
                
                
                    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = "12"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "05"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                
                
                Else
                
                
                
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S & Format(SAI_SU, "#0.00"))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S & Format(SAI_SU, "#0.00"))
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                
'                    ID_KANRI_TBL(ING_No).SEK_SAI_SU = SAI_SU
'                    ID_KANRI_TBL(ING_No).SEK_KUTI_SU = KUTI_SU
                        
                        
                End If
                        
                        
                Sendbuf = Text_Create_Proc()
            Else
            
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
            
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                '>>>>>  2017.09.22
'                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                '>>>>>  2017.09.22
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
        
                
                '-----------------------------------------------２行目
                
                '2013.04.07Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                
                
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                                'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                                                                        
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                    '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性

                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()
            End If
    
        Case Step_Sagyo5_RES        '５回目の受信（ANY KEY　受信）
            
            '2013.04.07Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
            
            If SAI_SU >= 999999 Or SAI_SU = 0 Then
            
            
                For i = 0 To M_Gyo - 1
            
                
                
                    Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                        '才数
                        Case LCD_SAI_SU_S
                    
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")     '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "") '2017.09.22

                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                New_Inspe_Proc_SEK = False
                                Exit Function
                            
                            End If
                    
                            INPUT_SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                    
                    
                            If INPUT_SAI_SU = 0 Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "") '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                New_Inspe_Proc_SEK = False
                                Exit Function
                            
                            End If
            
            
'2011.05.26                            '----------------------------------- データ更新処理開始 -----------
'2011.05.26                                                            'トランザクション開始
'2011.05.26                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'2011.05.26                            If sts <> BtNoErr Then
'2011.05.26                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                Sendbuf = Text_Create_Proc()
'2011.05.26                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
'2011.05.26                                Exit Function
'2011.05.26                            End If
'2011.05.26                            '------------------------------------   注文ﾃﾞｰﾀの処理
'2011.05.26
'2011.05.26
'2011.05.26                            If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
'2011.05.26                            '梱包IDでのﾁｪｯｸ
'2011.05.26                                Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
'2011.05.26                            Else
'2011.05.26                            '邸別IDでのﾁｪｯｸ
'2011.05.26                                Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
'2011.05.26                            End If
'2011.05.26
'2011.05.26                            com = BtOpGetGreaterEqual
'2011.05.26
'2011.05.26                            Do
'2011.05.26
'2011.05.26                                DoEvents
'2011.05.26
'2011.05.26                                Do
'2011.05.26                                    If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
'2011.05.26                                        sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
'2011.05.26                                    Else
'2011.05.26                                        sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
'2011.05.26                                    End If
'2011.05.26
'2011.05.26                                    Select Case sts
'2011.05.26                                        Case BtNoErr
'2011.05.26                                            If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
'2011.05.26                                            '梱包IDでのﾁｪｯｸ
'2011.05.26                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
'2011.05.26                                                    sts = BtErrEOF
'2011.05.26                                                    Exit Do
'2011.05.26                                                End If
'2011.05.26                                            Else
'2011.05.26                                            '邸別IDでのﾁｪｯｸ
'2011.05.26                                                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
'2011.05.26                                                    sts = BtErrEOF
'2011.05.26                                                    Exit Do
'2011.05.26                                                End If
'2011.05.26                                            End If
'2011.05.26                                            Exit Do
'2011.05.26                                        Case BtErrEOF
'2011.05.26                                            Exit Do
'2011.05.26                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2011.05.26                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2011.05.26                                            Inspe_Proc_SEK = False
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                        Case Else
'2011.05.26                                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
'2011.05.26                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                    End Select
'2011.05.26
'2011.05.26                                Loop
'2011.05.26
'2011.05.26
'2011.05.26                                If sts = BtErrEOF Then
'2011.05.26                                    Exit Do
'2011.05.26                                End If
'2011.05.26
'2011.05.26                                Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, "0001")
'2011.05.26                                Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(INPUT_SAI_SU, "000.00"))
'2011.05.26
'2011.05.26
'2011.05.26                                Do
'2011.05.26                                    DoEvents
'2011.05.26                                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
'2011.05.26                                    Select Case sts
'2011.05.26                                        Case BtNoErr
'2011.05.26                                            Exit Do
'2011.05.26                                        Case BtErrKeyNotFound
'2011.05.26                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2011.05.26                                            Inspe_Proc_SEK = False
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2011.05.26                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2011.05.26                                            Inspe_Proc_SEK = False
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                        Case Else
'2011.05.26                                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
'2011.05.26                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                    End Select
'2011.05.26                                Loop
'2011.05.26
'2011.05.26
'2011.05.26                                com = BtOpGetNext
'2011.05.26
'2011.05.26
'2011.05.26                            Loop
'2011.05.26                                    'トランザクション終了
'2011.05.26                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'2011.05.26                            If sts <> BtNoErr Then
'2011.05.26                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                Sendbuf = Text_Create_Proc()
'2011.05.26                                Call File_Error(sts, BtOpEndTransaction, "", 0)
'2011.05.26                                GoTo Abort_Tran
'2011.05.26                            End If
'2011.05.26
                    End Select
                Next i
                '2013.04.07Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                wkSai_Input = 1
                SAI_SU = INPUT_SAI_SU
            Else
                wkSai_Input = 0
                '2013.04.07Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
            End If
            
            
            '----------------------------------- 出荷予定(H)処理 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            
            
            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & "00")
            
            com = BtOpGetGreaterEqual
            
            Do
                
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
                sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                
                Select Case sts
                    Case BtNoErr
                    
                        If Left(StrConv(Y_SYU_HREC.ID_NO, vbUnicode), 7) <> Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") Then
                            Exit Do
                        End If
                    
                    Case BtErrEOF
                        
                        Exit Do
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                        New_Inspe_Proc_SEK = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
                                            
                                            
            '----------------------------------- 出荷予定(H)書き込み処理 -----------
                
                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                            
                                            
''                If wkSai_Input = 1 Then
''                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ, "001")
''                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ_TO, Format(KUTI_SU, "000"))
''                End If
                                            
                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                                            
                                            
                Do
                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            New_Inspe_Proc_SEK = False
                            GoTo Abort_Tran
                    
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                            New_Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                
            
                
                com = BtOpGetNext
            
            Loop
            
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
    
    
    
    
    
    
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    
    
    
    
    
    
    
    
    
    
    End Select
                    
                    

    New_Inspe_Proc_SEK = False
    
    Exit Function

Abort_Tran:
    
   sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

    


End Function







Public Sub Re_Send_Proc(Sendbuf As String)
'-------------------------------------------------------
'
'   『エラー時の再送』
'
'-------------------------------------------------------
Dim i   As Integer
    
    
    
'    Select Case ID_KANRI_TBL(ING_No).Step
'        Case 2, 4, 6
'            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'    End Select
'-------------------------------------------------------
    Send_Text.sts = ID_KANRI_TBL(ING_No).Send_Text.sts                  'ステータス　OK
    
    Send_Text.Display_Flg = ID_KANRI_TBL(ING_No).Send_Text.Display_Flg  '表示画面フラグ メニュー画面
    
    Send_Text.End_Menu = ID_KANRI_TBL(ING_No).Send_Text.End_Menu        '最終メニューフラグ
    
    Send_Text.Menu_Suu = ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu        'メニュー項目数（05固定）
    
    Send_Text.FileName = ID_KANRI_TBL(ING_No).Send_Text.FileName        '送信データファイル名
    
    Send_Text.buzzer = ID_KANRI_TBL(ING_No).Send_Text.buzzer            'ブザー音　標準

    For i = 0 To M_Gyo - 1
                                                                        'BOX属性
        Send_Text.Box_Type(i).Box_Type = ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type
                                                                        '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                                                                        
                                                                    '初期表示内容（数値）
        Send_Text.Box_Type(i).INIT = ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT
                                                                        '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos
                                                                        '入力桁数
        Send_Text.Box_Type(i).Max_Size = ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size
                                                                        'メニュ―番号
        Send_Text.Box_Type(i).MENU = ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU

    Next
    
    Send_Text.CRLF = vbCrLf
    
    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信
    
    Sendbuf = Text_Create_Proc()


End Sub
Public Sub Send_Err_Proc(Sendbuf As String)
'-------------------------------------------------------
'
'   『送信エラー時の再送』
'
'-------------------------------------------------------
Dim i   As Integer
    
    
    
'    Select Case ID_KANRI_TBL(ING_No).Step
'        Case 2, 4, 6
'            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'    End Select
'-------------------------------------------------------
    Send_Text.sts = ID_KANRI_TBL(ING_No).Last_Send_Text.sts                  'ステータス　OK
    
    Send_Text.Display_Flg = ID_KANRI_TBL(ING_No).Last_Send_Text.Display_Flg  '表示画面フラグ メニュー画面
    
    Send_Text.End_Menu = ID_KANRI_TBL(ING_No).Last_Send_Text.End_Menu        '最終メニューフラグ
    
    Send_Text.Menu_Suu = ID_KANRI_TBL(ING_No).Last_Send_Text.Menu_Suu        'メニュー項目数（05固定）
    
    Send_Text.FileName = ID_KANRI_TBL(ING_No).Last_Send_Text.FileName        '送信データファイル名
    
    Send_Text.buzzer = ID_KANRI_TBL(ING_No).Last_Send_Text.buzzer            'ブザー音　標準

    For i = 0 To M_Gyo - 1
                                                                        'BOX属性
        Send_Text.Box_Type(i).Box_Type = ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).Box_Type
                                                                        '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, StrConv(ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).LCD, vbUnicode))
                                                                        
                                                                    '初期表示内容（数値）
        Send_Text.Box_Type(i).INIT = ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).INIT
                                                                        '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).Start_Pos
                                                                        '入力桁数
        Send_Text.Box_Type(i).Max_Size = ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).Max_Size
                                                                        'メニュ―番号
        Send_Text.Box_Type(i).MENU = ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).MENU

    Next
    
    Send_Text.CRLF = vbCrLf
    
    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信
    
    Sendbuf = Text_Create_Proc()


End Sub

Public Sub Start_Proc(Sendbuf As String)
'-------------------------------------------------------
'
'   『子機開始処理』
'
'-------------------------------------------------------
Dim i   As Integer
                                                '送信テキスト作成＆管理テーブルに転送
    ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ                      '担当者要求
    '---------------------------------------------------------------
    Send_Text.sts = Sts_OK                                          'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_DEF                             '表示画面フラグ 通常入力
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
    Send_Text.End_Menu = ""                                         '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = ""
    
    Send_Text.Menu_Suu = "05"                                       'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
    Send_Text.FileName = ""                                         '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
    Send_Text.buzzer = Buzzer_DEF                                   'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
    
    '---------------------------------------------------------------
    Send_Text.Box_Type(0).Box_Type = TYPE_REF                       'ボックス属性　表示ＢＯＸ
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
    
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, MAIN_TITLE)                '表示メッセージ
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, MAIN_TITLE)
                                                                    '初期表示内容（数値）
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
    
    Send_Text.Box_Type(0).Start_Pos = ""                            'カーソル位置
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
    
    Send_Text.Box_Type(0).Max_Size = "00"                           '最大桁数
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
    
    Send_Text.Box_Type(0).MENU = ""                                 'メニュー番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    '---------------------------------------------------------------
    Send_Text.Box_Type(1).Box_Type = TYPE_REF                       'ボックス属性　表示ＢＯＸ
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
    
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Format(ID_KANRI_TBL(ING_No).ID, "000"))      '表示メッセージ
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Format(ID_KANRI_TBL(ING_No).ID, "000"))
                                                                    '初期表示内容（数値）
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
    
    Send_Text.Box_Type(1).Start_Pos = ""                            'カーソル位置
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
    
    Send_Text.Box_Type(1).Max_Size = "00"                           '最大桁数
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
    
    Send_Text.Box_Type(1).MENU = ""                                 'メニュー番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    
    '---------------------------------------------------------------
    Send_Text.Box_Type(2).Box_Type = TYPE_REF                       'ボックス属性　表示ＢＯＸ
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
    
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "担当者入力")      '表示メッセージ
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "担当者入力")
                                                                    '初期表示内容（数値）
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
    
    Send_Text.Box_Type(2).Start_Pos = ""                            'カーソル位置
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
    
    Send_Text.Box_Type(2).Max_Size = "00"                           '最大桁数
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
    
    Send_Text.Box_Type(2).MENU = ""                                 'メニュー番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    '---------------------------------------------------------------
    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK                     'ボックス属性　表示ＢＯＸ
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
    
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")                '表示メッセージ
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                    '初期表示内容（数値）
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
    
    Send_Text.Box_Type(3).Start_Pos = "01"                          'カーソル位置
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
    
    Send_Text.Box_Type(3).Max_Size = "05"                           '最大桁数
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
    
    Send_Text.Box_Type(3).MENU = ""                                 'メニュー番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    '---------------------------------------------------------------
    Send_Text.Box_Type(4).Box_Type = TYPE_REF                       'ボックス属性　表示ＢＯＸ
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
    
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")                '表示メッセージ
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                    '初期表示内容（数値）
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
    
    Send_Text.Box_Type(4).Start_Pos = ""                            'カーソル位置
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
    
    Send_Text.Box_Type(4).Max_Size = "00"                           '最大桁数
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
    
    Send_Text.Box_Type(4).MENU = ""                                 'メニュー番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    '---------------------------------------------------------------
    
    
    Send_Text.CRLF = vbCrLf
    '------------------------------------------ 送信バッファーへ転送
    Sendbuf = Text_Create_Proc()

    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信

End Sub

Public Sub Wel_Clear_Text_Proc()
    Send_Text.Box_Type(4).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
     Send_Text.Box_Type(4).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                            
    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
'--

End Sub

Public Sub Wel_Hin_No_Req_Text_Proc(Sumi_CNT As Integer, Y_SYU_CNT As Integer)
    '-----------------------------------------------１行目
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    '>>>>>>>    2017.09.22
'    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    '>>>>>>>    2017.09.22
                                                            
                                                            
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(0).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                            
    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    '-----------------------------------------------２行目
                                                            
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                
                                                                
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(1).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                            
    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    '-----------------------------------------------３行目
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
                                                            
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                            
                                                            
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                            
    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    '-----------------------------------------------４行目
    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                            '表示内容
                                                        '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                            '入力桁数
    '2010.12.07
'    Send_Text.Box_Type(3).Max_Size = "13"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
    Send_Text.Box_Type(3).Max_Size = "20"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
    '2010.12.07
                                                            
    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    '-----------------------------------------------５行目
    Call Wel_Clear_Text_Proc

End Sub


Public Sub Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU As Integer, TOTAL_SAI_SU As Double)

Dim wkKUTI_SU As String
                                    
                                    
    wkKUTI_SU = Format(TOTAL_KUTI_SU, "#0")
                
                
    Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                    '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S)
                                                    '数値初期表示
    Send_Text.Box_Type(3).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                    '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = 13
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = 13
                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = "04"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "04"
    
    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
    '-----------------------------------------------５行目
                                                            
    wkKUTI_SU = Format(TOTAL_SAI_SU, "#0.00")
                                                            'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = 12
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = 12
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = "05"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                            
    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

End Sub

Public Sub Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU As Integer, TOTAL_SAI_SU As Double)
                                    
Dim wkKUTI_SU       As String
                                    
                                    
Dim wkTOTAL_SAI_SU  As Long
                                    
                                    
    wkKUTI_SU = Format(TOTAL_KUTI_SU, "#0")
                
                
    Send_Text.Box_Type(3).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                    '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & wkKUTI_SU)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & wkKUTI_SU)
                                                    '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                    '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
    
    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    
    '-----------------------------------------------５行目
                                                            
    wkTOTAL_SAI_SU = TOTAL_SAI_SU
    If TOTAL_SAI_SU < 1 Then
        wkTOTAL_SAI_SU = 1
    Else
        If TOTAL_SAI_SU > 1 Then
            wkTOTAL_SAI_SU = CLng(ToHalfAdjust(CCur(TOTAL_SAI_SU), 0))
        End If
    End If
                                                            
'    wkKUTI_SU = Format(TOTAL_SAI_SU, "#0.00")
    wkKUTI_SU = Format(wkTOTAL_SAI_SU, "#0")
                                                            'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S & wkKUTI_SU)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S & wkKUTI_SU)
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "00"
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = ""
                                                            
    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

End Sub

Public Sub Wel_DETAIL_0_Text_Proc()
                                                            'BOX属性
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    '>>>>>>>>   2017.09.22
'    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    '>>>>>>>>   2017.09.22
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(0).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                            
    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""

End Sub
Public Sub Wel_DETAIL_1_Text_Proc(ID_NO As String, Sumi_CNT As Integer, Y_SYU_CNT As Integer)
                                                                                'BOX属性
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(1).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                            
    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""

End Sub

Public Sub Wel_OKURI_SAKI_PROC()
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                            
    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""

End Sub


Public Sub Wel_Head_Print_Text_Proc(FileName As String)
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

    Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL

    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

    Send_Text.FileName = FileName                           '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = FileName

    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF

End Sub

Public Sub Wel_Head_Text_Proc()
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

    Send_Text.FileName = ""                                 '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""

    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
'--

End Sub

Public Sub Wel_HIN_NO_Req_Text_3_Proc()
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
                                                            
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                            
                                                            
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                            
    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""

End Sub



Public Sub Wel_HIN_NO_Req_Text_4_Proc()
                            
    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                            '表示内容
                                                        '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                            '入力桁数
    '2010.12.07
'    Send_Text.Box_Type(3).Max_Size = "13"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
    Send_Text.Box_Type(3).Max_Size = "20"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
    '2010.12.07
                                                            
    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

End Sub

Public Sub JGYOBU_MENU_SET()
'-------------------------------------------------------
'
'   『事業部選択用メニュー作成』
'
'-------------------------------------------------------
Dim i               As Integer



Dim wkJGYOBU_T()    As JGYOBU_TBL   '2013.06.06
Dim j               As Integer      '2013.06.06
Dim k               As Integer      '2013.06.06
Dim sts             As Integer      '2013.06.06


    
Dim Fsw             As Integer      '2018.09.26
    
    '---------------------------------------------- 2013.06.06
    
    Erase wkJGYOBU_T
    
    Fsw = False
    
    Call UniCode_Conv(K0_P_TMENU.TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
     
    sts = BTRV(BtOpGetEqual, P_TMENU_POS, P_TMENUREC, Len(P_TMENUREC), K0_P_TMENU, Len(K0_P_TMENU), 0)
    Select Case sts
        Case BtNoErr
            k = -1
            For i = 0 To UBound(JGYOBU_T)
                If Trim(JGYOBU_T(i).CODE) = "" Then
                    Exit For
                End If
                
                For j = 0 To 179
                    If Trim(StrConv(P_TMENUREC.MENU_T(j).JGYOBU, vbUnicode)) = "" Then
                        Exit For
                    End If
                
                    If Trim(StrConv(P_TMENUREC.MENU_T(j).JGYOBU, vbUnicode)) = JGYOBU_T(i).CODE Then
                        k = k + 1
                        ReDim Preserve wkJGYOBU_T(0 To k)
                        
                        Fsw = True      '2018.09.26
                        
                        wkJGYOBU_T(k).CODE = JGYOBU_T(i).CODE
                        wkJGYOBU_T(k).NAME = JGYOBU_T(i).NAME
                        wkJGYOBU_T(k).COLOR = JGYOBU_T(i).COLOR
                        Exit For
                    End If
                Next j
                
            Next i
        Case Else
            For i = 0 To UBound(JGYOBU_T)
                ReDim Preserve wkJGYOBU_T(0 To i)
                
                Fsw = True              '2018.09.26
                
                
                wkJGYOBU_T(i).CODE = JGYOBU_T(i).CODE
                wkJGYOBU_T(i).NAME = JGYOBU_T(i).NAME
                wkJGYOBU_T(i).COLOR = JGYOBU_T(i).COLOR
            Next i
    End Select
    '---------------------------------------------- 2013.06.06

    If Not Fsw Then '2018.09.26


        For i = 0 To UBound(JGYOBU_T)
            ReDim Preserve wkJGYOBU_T(0 To i)
            
            Fsw = True
            
            
            wkJGYOBU_T(i).CODE = JGYOBU_T(i).CODE
            wkJGYOBU_T(i).NAME = JGYOBU_T(i).NAME
            wkJGYOBU_T(i).COLOR = JGYOBU_T(i).COLOR

        Next i

    End If


    ID_KANRI_TBL(ING_No).Step = Step_JGYOBU_REQ                     '事業部要求
    '---------------------------------------------------------------
    Send_Text.sts = Sts_OK                                          'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_MENU                            '表示画面フラグ メニュー画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_MENU
    
    Send_Text.End_Menu = Menu_Only                                  '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = Format(UBound(JGYOBU_T) + 1, "00")         'メニュー項目数
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = Format(UBound(JGYOBU_T) + 1, "00")
    
    Send_Text.FileName = ""                                         '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
    Send_Text.buzzer = Buzzer_DEF                                   'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
    
    '---------------------------------------------------------------
    For i = 0 To M_Gyo - 1
        
        'If i > UBound(JGYOBU_T) Then       '2013.06.06
        If i > UBound(wkJGYOBU_T) Then      '2013.06.06
        
            Send_Text.Box_Type(i).Box_Type = ""                 'BOX属性
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
        
            Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")    '表示内容
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
            
            Send_Text.Box_Type(i).INIT = ""                     '数値初期値
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                                                
            Send_Text.Box_Type(i).Start_Pos = ""                '初期カーソル位置
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                                                
            Send_Text.Box_Type(i).Max_Size = "00"               '入力桁数
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(i).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
        
        Else
            
            Send_Text.Box_Type(i).Box_Type = TYPE_MENU          'BOX属性
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = TYPE_MENU
                                                                '表示内容
            'Call UniCode_Conv(Send_Text.Box_Type(i).LCD, JGYOBU_T(i).NAME)                         '2013.06.06
            'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, JGYOBU_T(i).NAME)    '2013.06.06
            Call UniCode_Conv(Send_Text.Box_Type(i).LCD, wkJGYOBU_T(i).NAME)                        '2013.06.06
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, wkJGYOBU_T(i).NAME)   '2013.06.06
                                                                                
            Send_Text.Box_Type(i).INIT = ""                     '数値初期値
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
            
            Send_Text.Box_Type(i).Start_Pos = ""                '初期カーソル位置
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                                                
            Send_Text.Box_Type(i).Max_Size = "00"               '入力桁数
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                                                
            'Send_Text.Box_Type(i).MENU = JGYOBU_T(i).CODE       'メニュ―番号                      '2013.06.06
            'ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = JGYOBU_T(i).CODE                     '2013.06.06
            Send_Text.Box_Type(i).MENU = wkJGYOBU_T(i).CODE                                         '2013.06.06
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = wkJGYOBU_T(i).CODE                    '2013.06.06
                                                                                
        
        End If
    
    Next i
    
    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信

End Sub

Public Sub NAIGAI_MENU_SET()
'-------------------------------------------------------
'
'   『内外選択用メニュー作成』
'
'-------------------------------------------------------
Dim i   As Integer

    ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ                     '内外要求
    '---------------------------------------------------------------
    Send_Text.sts = Sts_OK                                          'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_MENU                             '表示画面フラグ メニュー画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_MENU
    
    Send_Text.End_Menu = Menu_Only                                  '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = Format(UBound(NAIGAI) + 1, "00")         'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = Format(UBound(NAIGAI) + 1, "00")
    
    Send_Text.FileName = ""                                         '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
    Send_Text.buzzer = Buzzer_DEF                                   'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
    
    '---------------------------------------------------------------
    For i = 0 To M_Gyo - 1
        
        If i > UBound(NAIGAI) Then
        
            Send_Text.Box_Type(i).Box_Type = ""                 'BOX属性
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
        
            Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")    '表示内容
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
            
            Send_Text.Box_Type(i).INIT = ""                     '数値初期値
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                                                
            Send_Text.Box_Type(i).Start_Pos = ""                '初期カーソル位置
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                                                
            Send_Text.Box_Type(i).Max_Size = "00"               '入力桁数
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(i).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
        
        Else
            
            Send_Text.Box_Type(i).Box_Type = TYPE_MENU          'BOX属性
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = TYPE_MENU
                                                                '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(i).LCD, NAIGAI(i).NAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, NAIGAI(i).NAME)
                                                                                
            Send_Text.Box_Type(i).INIT = ""                     '数値初期値
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                                                
            Send_Text.Box_Type(i).Start_Pos = ""                '初期カーソル位置
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                                                
            Send_Text.Box_Type(i).Max_Size = "00"               '入力桁数
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(i).MENU = NAIGAI(i).CODE       'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = NAIGAI(i).CODE
                                                                                
        
        End If
    
    Next i
    
    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信

End Sub

Public Function AKI_LOC_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『空きロケーション検索』
'       2010.12.13
'
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer
Dim k           As Integer


Dim Tanaban     As String * 8


Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim AKI_Tanahyoji() _
                As AKI_Tanahyoji_tag

Dim Tana_Cnt    As Integer
Dim Tana_Use    As String * 3

Dim wkTANABAN   As String
Dim wkTana_Use  As String * 3


Dim MENU_NO     As String * 2   '2008.08.08


    AKI_LOC_Proc = True

    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & BG_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & BG_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Tanaban        '棚番
                Tanaban = Mid(ID_KANRI_TBL(ING_No).Recv_text(i), 2, 8)
                
                
                Call UniCode_Conv(K0_TANA.SOKO_NO, Mid(Tanaban, 1, 2))
                Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                Call UniCode_Conv(K0_TANA.Ren, "")
                Call UniCode_Conv(K0_TANA.Dan, "")
                
                
                sts = BTRV(BtOpGetGreater, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                Select Case sts
                    Case BtNoErr
                                            
                        If Mid(Tanaban, 1, 2) <> StrConv(TANAREC.SOKO_NO, vbUnicode) Or _
                            Mid(Tanaban, 3, 2) <> StrConv(TANAREC.Retu, vbUnicode) Then
                            '   -------------------------------- エラーメッセージ作成
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 4), "棚番エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 4), "棚番エラー", "", "")    '2017.09.22
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            AKI_LOC_Proc = False
                            Exit Function
                        End If
                    
                    
                    Case BtErrEOF
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 4), "棚番エラー", "", "")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 4), "棚番エラー", "", "")    '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        AKI_LOC_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                        Exit Function
                End Select
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                Erase AKI_Tanahyoji
                Tana_Cnt = -1
                
                
                
                Call UniCode_Conv(K0_TANA.SOKO_NO, Mid(Tanaban, 1, 2))
                Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                Call UniCode_Conv(K0_TANA.Ren, "")
                Call UniCode_Conv(K0_TANA.Dan, "")
                
                
                
                Do
                    
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                    
                    sts = BTRV(BtOpGetGreater, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                    Select Case sts
                        Case BtNoErr
                                                
                            If Mid(Tanaban, 1, 2) <> StrConv(TANAREC.SOKO_NO, vbUnicode) Or _
                                Mid(Tanaban, 3, 2) <> StrConv(TANAREC.Retu, vbUnicode) Then
                            
                                Exit Do
                            End If
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                            Exit Function
                    End Select
                
                
                    If Not IsNumeric(StrConv(TANAREC.Tana_Use, vbUnicode)) Then
                        If Trim(StrConv(TANAREC.Tana_Use, vbUnicode)) = "." Then
                            Tana_Use = Trim(StrConv(TANAREC.Tana_Use, vbUnicode))
                        Else
                            Tana_Use = "100"
                        End If
                    Else
                        Tana_Use = StrConv(TANAREC.Tana_Use, vbUnicode)
                    End If
                
                    If Val(Tana_Use) < 100 Then
                    
                        Tana_Cnt = Tana_Cnt + 1
                        ReDim Preserve AKI_Tanahyoji(Tana_Cnt)
                        
                        AKI_Tanahyoji(Tana_Cnt).Tanaban = StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                        AKI_Tanahyoji(Tana_Cnt).Tana_Use = Tana_Use
                    
                    End If
                
                Loop
        
                If Tana_Cnt < 1 Then
                Else
                    For j = 0 To UBound(AKI_Tanahyoji) - 1
                        
                        For k = j To UBound(AKI_Tanahyoji)
                                                
                            If AKI_Tanahyoji(j).Tana_Use > AKI_Tanahyoji(k).Tana_Use Then
                                wkTANABAN = AKI_Tanahyoji(k).Tanaban
                                wkTana_Use = AKI_Tanahyoji(k).Tana_Use
                                    
                                AKI_Tanahyoji(k).Tanaban = AKI_Tanahyoji(j).Tanaban
                                AKI_Tanahyoji(k).Tana_Use = AKI_Tanahyoji(j).Tana_Use
                                    
                                AKI_Tanahyoji(j).Tanaban = wkTANABAN
                                AKI_Tanahyoji(j).Tana_Use = wkTana_Use
                                    
                            
                            
                            End If
                        Next k
                    
                    Next j
                End If
        
        
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
        
                SendFileRec.Title = "0"     'タイトル行
                'Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)        '2017.09.22
                Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)    '2017.09.22
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                
                Call UniCode_Conv(SendFileRec.LCD, "棚番:" & Left(Tanaban, 4))
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
        
                        
        
        
        
                If Tana_Cnt > -1 Then
                                '集計テーブルよりデータ出力
                    For j = 0 To UBound(AKI_Tanahyoji)
                                
                        SendFileRec.Title = "1"
                        
                        
                        If Trim(AKI_Tanahyoji(j).Tana_Use) = "." Then
                            Call UniCode_Conv(SendFileRec.LCD, Left(Tanaban, 4) & AKI_Tanahyoji(j).Tanaban & " " & StrConv(" .%", vbWide))
                        Else
                            Call UniCode_Conv(SendFileRec.LCD, Left(Tanaban, 4) & AKI_Tanahyoji(j).Tanaban & " " & StrConv(Space(2 - Len(Format(AKI_Tanahyoji(j).Tana_Use, "0"))), vbWide) & StrConv(Format(AKI_Tanahyoji(j).Tana_Use, "0") & "%", vbWide))
                        End If
                                            
                        SendFileRec.CRLF = vbCrLf
                                            
                        Put #FileNo, , SendFileRec
                                            
                            
                    Next j
                End If
        
        
                Close #FileNo
        
        
        End Select
    Next i
    
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            ID_KANRI_TBL(ING_No).JGYOBU, _
                                            ID_KANRI_TBL(ING_No).NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            , , , Tanaban) Then
            AKI_LOC_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = BG_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.FileName = BG_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１～５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    AKI_LOC_Proc = False
    

End Function



Private Function ORDER_SYUKEI_PROC(ORDER_QTY As Long, UKEIRE_QTY As Long, MAEGARI_QTY As Long, JGYOBU As String, NAIGAI As String, HIN_GAI As String) As Integer
'-------------------------------------------------------
'
'   『注文数　集計』
'       2019.03.15
'
'
'-------------------------------------------------------
Dim sts     As Integer
Dim com     As Integer


    ORDER_SYUKEI_PROC = True

    
    ORDER_QTY = 0
    UKEIRE_QTY = 0
    

    Call UniCode_Conv(K8_P_SHORDER.JGYOBU, JGYOBU)
    Call UniCode_Conv(K8_P_SHORDER.NAIGAI, NAIGAI)
    Call UniCode_Conv(K8_P_SHORDER.HIN_GAI, HIN_GAI)
    Call UniCode_Conv(K8_P_SHORDER.KAN_F, "0")
    Call UniCode_Conv(K8_P_SHORDER.CANCEL_F, "0")
    Call UniCode_Conv(K8_P_SHORDER.Print_datetime, "")


    com = BtOpGetGreaterEqual

    Do
        sts = BTRV(com, P_SHORDER_POS, P_SHORDER_REC, Len(P_SHORDER_REC), K8_P_SHORDER, Len(K8_P_SHORDER), 8)
        Select Case sts
            Case BtNoErr
                If JGYOBU <> StrConv(P_SHORDER_REC.JGYOBU, vbUnicode) Or _
                    NAIGAI <> StrConv(P_SHORDER_REC.NAIGAI, vbUnicode) Or _
                    Trim(HIN_GAI) <> Trim(StrConv(P_SHORDER_REC.HIN_GAI, vbUnicode)) Then
                    Exit Do
                End If
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, com, "在庫データ", 0)
                Exit Function
        End Select



        If StrConv(P_SHORDER_REC.KAN_F, vbUnicode) <> "0" Then
            Exit Do
        End If

        If StrConv(P_SHORDER_REC.CANCEL_F, vbUnicode) <> "0" Then
            Exit Do
        End If


        
        ORDER_QTY = ORDER_QTY + Val(StrConv(P_SHORDER_REC.ORDER_QTY, vbUnicode))
        UKEIRE_QTY = UKEIRE_QTY + Val(StrConv(P_SHORDER_REC.UKEIRE_QTY, vbUnicode))



        com = BtOpGetNext
    
    Loop

'>>>>>>>>>>>>>>>>>>>>>>>>>  前借分を引く

    Call UniCode_Conv(K0_P_NYU.JGYOBU, "S")
    Call UniCode_Conv(K0_P_NYU.NAIGAI, "1")
    Call UniCode_Conv(K0_P_NYU.HIN_GAI, HIN_GAI)
    Call UniCode_Conv(K0_P_NYU.NYUKA_DT, "")

    MAEGARI_QTY = 0

    com = BtOpGetGreaterEqual

    Do
        sts = BTRV(com, P_NYU_POS, P_NYUREC, Len(P_NYUREC), K0_P_NYU, Len(K0_P_NYU), 0)
        Select Case sts
            Case BtNoErr
                If JGYOBU <> StrConv(P_NYUREC.JGYOBU, vbUnicode) Or _
                    NAIGAI <> StrConv(P_NYUREC.NAIGAI, vbUnicode) Or _
                    Trim(HIN_GAI) <> Trim(StrConv(P_NYUREC.HIN_GAI, vbUnicode)) Then
                    Exit Do
                End If
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, com, "前借データ", 0)
                Exit Function
        End Select




        
        MAEGARI_QTY = MAEGARI_QTY + Val(StrConv(P_NYUREC.NYUKA_QTY, vbUnicode))



        com = BtOpGetNext
    
    Loop




    ORDER_SYUKEI_PROC = False


End Function
