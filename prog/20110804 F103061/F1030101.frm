VERSION 5.00
Object = "{F9043C88-F6F2-101A-A3C9-08002B2F49FB}#1.2#0"; "COMDLG32.OCX"
Begin VB.Form F1030101 
   BackColor       =   &H00FFFFFF&
   Caption         =   "èoâ◊åüïiÉâÉxÉãî≠çs"
   ClientHeight    =   7080
   ClientLeft      =   2025
   ClientTop       =   2655
   ClientWidth     =   11295
   BeginProperty Font 
      Name            =   "ÇlÇr ÉSÉVÉbÉN"
      Size            =   12
      Charset         =   128
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   KeyPreview      =   -1  'True
   LinkTopic       =   "Form1"
   ScaleHeight     =   7080
   ScaleWidth      =   11295
   StartUpPosition =   2  'âÊñ ÇÃíÜâõ
   WhatsThisHelp   =   -1  'True
   Begin VB.Frame Frame2 
      Caption         =   "éûçèéwíËçƒàÛç¸"
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   20.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   2895
      Left            =   3465
      TabIndex        =   19
      Top             =   1320
      Width           =   4845
      Begin VB.ListBox List1 
         Height          =   1020
         Index           =   0
         Left            =   315
         TabIndex        =   21
         Top             =   960
         Width           =   3375
      End
      Begin VB.CommandButton Command1 
         Caption         =   "àÛÅ@ç¸"
         BeginProperty Font 
            Name            =   "ÇlÇr ÉSÉVÉbÉN"
            Size            =   21.75
            Charset         =   128
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   735
         Index           =   1
         Left            =   2310
         TabIndex        =   20
         Top             =   2040
         Width           =   2430
      End
   End
   Begin VB.Frame Frame1 
      Caption         =   "ì`ï[î‘çÜéwíË"
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   20.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   1935
      Left            =   3465
      TabIndex        =   16
      Top             =   4440
      Width           =   4845
      Begin VB.TextBox Text1 
         Height          =   375
         IMEMode         =   3  'µÃå≈íË
         Index           =   1
         Left            =   2730
         MaxLength       =   7
         TabIndex        =   2
         Top             =   480
         Width           =   960
      End
      Begin VB.TextBox Text1 
         Height          =   375
         IMEMode         =   3  'µÃå≈íË
         Index           =   0
         Left            =   1365
         MaxLength       =   7
         TabIndex        =   1
         Top             =   480
         Width           =   960
      End
      Begin VB.CommandButton Command2 
         Caption         =   "àÛÅ@ç¸"
         BeginProperty Font 
            Name            =   "ÇlÇr ÉSÉVÉbÉN"
            Size            =   21.75
            Charset         =   128
            Weight          =   400
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   615
         Left            =   2310
         TabIndex        =   3
         Top             =   1080
         Width           =   2430
      End
      Begin VB.Label Label1 
         Caption         =   "Å`"
         BeginProperty Font 
            Name            =   "ÇlÇr ÉSÉVÉbÉN"
            Size            =   12
            Charset         =   128
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   1
         Left            =   2415
         TabIndex        =   18
         Top             =   600
         Width           =   330
      End
      Begin VB.Label Label1 
         Caption         =   "ì`ï[î‘çÜ"
         BeginProperty Font 
            Name            =   "ÇlÇr ÉSÉVÉbÉN"
            Size            =   12
            Charset         =   128
            Weight          =   700
            Underline       =   0   'False
            Italic          =   0   'False
            Strikethrough   =   0   'False
         EndProperty
         Height          =   255
         Index           =   0
         Left            =   210
         TabIndex        =   17
         Top             =   600
         Width           =   1065
      End
   End
   Begin VB.CommandButton Command1 
      Caption         =   "êVãKï™"
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   21.75
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   735
      Index           =   0
      Left            =   3360
      TabIndex        =   0
      Top             =   240
      Width           =   5055
   End
   Begin MSComDlg.CommonDialog CommonDialog1 
      Left            =   720
      Top             =   3480
      _ExtentX        =   847
      _ExtentY        =   847
      _Version        =   393216
   End
   Begin VB.CommandButton Command 
      Caption         =   "èI  óπ"
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   11
      Left            =   10320
      TabIndex        =   15
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   10
      Left            =   9480
      TabIndex        =   14
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   9
      Left            =   8640
      TabIndex        =   13
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   8
      Left            =   7800
      TabIndex        =   12
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   7
      Left            =   6480
      TabIndex        =   11
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   6
      Left            =   5640
      TabIndex        =   10
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   5
      Left            =   4800
      TabIndex        =   9
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   4
      Left            =   3960
      TabIndex        =   8
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   3
      Left            =   2640
      TabIndex        =   7
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   2
      Left            =   1800
      TabIndex        =   6
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   1
      Left            =   960
      TabIndex        =   5
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
   Begin VB.CommandButton Command 
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "ÇlÇr ÉSÉVÉbÉN"
         Size            =   11.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Index           =   0
      Left            =   120
      TabIndex        =   4
      TabStop         =   0   'False
      Top             =   6600
      Width           =   855
   End
End
Attribute VB_Name = "F1030101"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit



Private Const ptxS_DEN_NO% = 0
Private Const ptxE_DEN_NO% = 1

Private Const Text_Max% = 1

Private Const plstPrint_Now% = 0


'Private Const LAST_UPDATE_DAY$ = "2013.01.23 08:30"
Private Const LAST_UPDATE_DAY$ = "[F103010] 2016.04.26 09:30"


Dim Pri_Name    As Printer

Private wY_SYU_H_POS    As POSBLK
Private wY_SYU_HREC     As Y_SYU_HREC_Tag
Private wK1_Y_SYU_H     As KEY1_Y_SYU_H
Private wK4_Y_SYU_H     As KEY4_Y_SYU_H

Private Function Print_Proc(Mode As Integer, DATA_CNT As Integer) As Integer
'----------------------------------------------------------------------------
'                   àÛç¸èàóù
'   mode    0:êVãKèàóù
'           1:çƒàÛç¸
'----------------------------------------------------------------------------

Dim lPrinterHandl   As Long         'Ãﬂÿ›¿ ›ƒﬁŸÇéÊìæ

Dim sts             As Integer
Dim com             As Integer
Dim wkcom           As Integer
Dim ans             As Integer

Dim sEditWK         As String       'ï“èW‹∞∏
Dim sJis            As String       'äøéöïœä∑ÇÃÿ¿∞›
Dim vjis            As String
    
Dim SEQ_NO          As Long
    
Dim DEN_SU          As String
    
Dim SKIP_Flg        As Boolean
    
Dim SV_ID_NO        As String * 7
    
Dim NON_PRINT_Flg   As Boolean
    
Dim PRINT_NOW       As String
    
    
    Print_Proc = True
    
    Call Input_Lock
    
        
    PRINT_NOW = Format(Now, "YYYYMMDDHHMMSS")
    
    
'   àÛç¸äJénèàóù
    PrinterDriver_Start "åüïiÉâÉxÉãî≠çs", lPrinterHandl

    SEQ_NO = 0
    SV_ID_NO = ""

    Select Case Mode
        Case 0
        '-------------------------------------  êVãKàÛç¸éwé¶
            Call UniCode_Conv(K1_Y_SYU_H.PRINT_NOW, "")
            Call UniCode_Conv(K1_Y_SYU_H.INS_NOW, "")
            Call UniCode_Conv(K1_Y_SYU_H.DATA_CNT, "")
        Case 1
        '-------------------------------------  çƒàÛç¸éwé¶
            Call UniCode_Conv(K0_Y_SYU_H.DEN_NO, Text1(ptxS_DEN_NO).Text)
            Call UniCode_Conv(K0_Y_SYU_H.SEQ_NO, "")
    End Select

    com = BtOpGetGreaterEqual

    Do
    
        DoEvents
        
        SKIP_Flg = False
        
        Select Case Mode
            Case 0
            '-------------------------------------  êVãKàÛç¸éwé¶
            
                sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K1_Y_SYU_H, Len(K1_Y_SYU_H), 1)
                Select Case sts
                    Case BtNoErr
                    
                        If Trim(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode)) <> "" Then
                            Exit Do
                        End If
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, BtOpGetEqual, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
                        Exit Function
                End Select
            
            
            Case 1
            '-------------------------------------  çƒàÛç¸éwé¶
        
                sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K0_Y_SYU_H, Len(K0_Y_SYU_H), 0)
                Select Case sts
                    Case BtNoErr
                    
                    
                        If Trim(StrConv(Y_SYU_HREC.DEN_NO, vbUnicode)) > Trim(Text1(ptxE_DEN_NO).Text) Then
                            Exit Do
                        End If
                                    
'                       2016.04.26 ñ≥èåèàÛç¸Ç∆Ç∑ÇÈ
'                        If Trim(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode)) = "" Then
'                            SKIP_Flg = True
'                        End If
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, BtOpGetEqual, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
                        Exit Function
                End Select
        
        
        End Select
        
        NON_PRINT_Flg = False
        If Trim(SV_ID_NO) = Left(Trim(StrConv(Y_SYU_HREC.ID_NO, vbUnicode)), 7) Then
            NON_PRINT_Flg = True
        End If
        SV_ID_NO = Left(Trim(StrConv(Y_SYU_HREC.ID_NO, vbUnicode)), 7)
        
        
        If Not SKIP_Flg Then
    
            If Not NON_PRINT_Flg Then
    
    
        '       STXéwíË
                sEditWK = Chr(&H2)
        '       √ﬁ∞¿ëóêMäJénéwíË
                sEditWK = sEditWK & Chr(&H1B) & "A"
    '2006.12.19
                sEditWK = sEditWK & Chr(&H1B) & "A3V+000H+220"
            
                'ì`ï[î‘çÜ
                sEditWK = sEditWK & Chr(&H1B) & "H0010" & Chr(&H1B) & "V0030" & Chr(&H1B) & "L0102" & Chr(&H1B) & "P00"
    '''            sEditWK = sEditWK & Chr(&H1B) & "X21," & Trim(StrConv(Y_SYU_HREC.DEN_NO, vbUnicode)) & StrConv(Y_SYU_HREC.SEQ_NO, vbUnicode)
                sEditWK = sEditWK & Chr(&H1B) & "X21," & Trim(StrConv(Y_SYU_HREC.DEN_NO, vbUnicode))
                'â^ëóâÔé–
                vjis = Kanji_Conv("H", Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)))
                sEditWK = sEditWK & Chr(&H1B) & "H0160" & Chr(&H1B) & "V0030" & Chr(&H1B) & "L0101" & Chr(&H1B) & "P00"
                sEditWK = sEditWK & Chr(&H1B) & "K2H" & vjis
                'òAî‘
                If Mode = 0 Then
                    SEQ_NO = SEQ_NO + 1
                    
                    sEditWK = sEditWK & Chr(&H1B) & "H0330" & Chr(&H1B) & "V0030" & Chr(&H1B) & "L0102" & Chr(&H1B) & "P00"
                    sEditWK = sEditWK & Chr(&H1B) & "X21," & Format(SEQ_NO, "#0")
                
                
                End If
                'ì`ï[î‘çÜ ﬁ∞∫∞ƒﬁ
                sEditWK = sEditWK & Chr(&H1B) & "H060" & Chr(&H1B) & "V0070" & Chr(&H1B) & "L0101"
    '''            sEditWK = sEditWK & Chr(&H1B) & "D102040" & "*" & Trim(StrConv(Y_SYU_HREC.DEN_NO, vbUnicode)) & StrConv(Y_SYU_HREC.SEQ_NO, vbUnicode) & "*"
                sEditWK = sEditWK & Chr(&H1B) & "D102040" & "*" & Left(StrConv(Y_SYU_HREC.ID_NO, vbUnicode), 7) & "*"
                
                'ìæà”êÊ∫∞ƒﬁ
    '''            sEditWK = sEditWK & Chr(&H1B) & "H0010" & Chr(&H1B) & "V0100" & Chr(&H1B) & "L0102" & Chr(&H1B) & "P00"
    '''            sEditWK = sEditWK & Chr(&H1B) & "X21," & Trim(StrConv(Y_SYU_HREC.MUKE_CODE, vbUnicode))
                'ìæà”êÊñº(ëóÇËêÊ)
                vjis = Kanji_Conv("H", StrConv(Trim(Left(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode), 15)), vbWide))
                sEditWK = sEditWK & Chr(&H1B) & "H0010" & Chr(&H1B) & "V0130" & Chr(&H1B) & "L0101" & Chr(&H1B) & "P00"
                sEditWK = sEditWK & Chr(&H1B) & "K2H" & vjis
    '''            'ì`ï[î‘çÜ ﬁ∞∫∞ƒﬁ
    '''            sEditWK = sEditWK & Chr(&H1B) & "H060" & Chr(&H1B) & "V0130" & Chr(&H1B) & "L0101"
    '''            sEditWK = sEditWK & Chr(&H1B) & "D102040" & "*" & Trim(StrConv(Y_SYU_HREC.MUKE_CODE, vbUnicode)) & "*"
            
                'ç≈ëÂì`ï[çsêîÇÃälìæ
                Call UniCode_Conv(wK4_Y_SYU_H.ID_NO, Left(Trim(StrConv(Y_SYU_HREC.DEN_NO, vbUnicode)), 7) & "99")
                sts = BTRV(BtOpGetLessEqual, wY_SYU_H_POS, wY_SYU_HREC, Len(wY_SYU_HREC), wK4_Y_SYU_H, Len(wK4_Y_SYU_H), 4)
                Select Case sts
                    Case BtNoErr
                    
                        If Left(Trim(StrConv(wY_SYU_HREC.ID_NO, vbUnicode)), 7) <> Left(Trim(StrConv(Y_SYU_HREC.ID_NO, vbUnicode)), 7) Then
                            DEN_SU = "01"
                        Else
                            DEN_SU = Right(Trim(StrConv(wY_SYU_HREC.ID_NO, vbUnicode)), 2)
                        End If
                    Case BtErrEOF
                        DEN_SU = "01"
                    Case Else
                        Call File_Error(sts, BtOpGetLessEqual, "èoâ◊ó\íË")
                        Exit Function
                End Select
                If Not IsNumeric(DEN_SU) Then
                    DEN_SU = "01"
                End If
                sEditWK = sEditWK & Chr(&H1B) & "H0290" & Chr(&H1B) & "V0170" & Chr(&H1B) & "L0102" & Chr(&H1B) & "P00"
                sEditWK = sEditWK & Chr(&H1B) & "X21," & Format(DEN_SU, "#0")
                vjis = Kanji_Conv("H", "ì_")
                sEditWK = sEditWK & Chr(&H1B) & "L0101" & Chr(&H1B) & "P00"
                sEditWK = sEditWK & Chr(&H1B) & "K2H" & vjis
                
                
            
            
    '''            If PRINT_CNT = DATA_CNT Then
    '''                sEditWK = sEditWK & Chr(&H1B) & "CT1"
    '''            Else
    '''                sEditWK = sEditWK & Chr(&H1B) & "CT0"
    '''            End If
                    
                    
                'éüÉåÉRÅ[ÉhÇÃämîF
                Call UniCode_Conv(wK1_Y_SYU_H.PRINT_NOW, StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode))
                Call UniCode_Conv(wK1_Y_SYU_H.INS_NOW, StrConv(Y_SYU_HREC.INS_NOW, vbUnicode))
                Call UniCode_Conv(wK1_Y_SYU_H.DATA_CNT, StrConv(Y_SYU_HREC.DATA_CNT, vbUnicode))
                                
                wkcom = BtOpGetGreater
                                
                Do
                
                    DoEvents
                
                    sts = BTRV(wkcom, wY_SYU_H_POS, wY_SYU_HREC, Len(wY_SYU_HREC), wK1_Y_SYU_H, Len(wK1_Y_SYU_H), 1)
                    Select Case sts
                        Case BtNoErr
                            If Mode = 1 Then
                                If Trim(StrConv(wY_SYU_HREC.DEN_NO, vbUnicode)) > Trim(Text1(ptxE_DEN_NO).Text) Then
                                    Call UniCode_Conv(wY_SYU_HREC.ID_NO, "")
                                    Exit Do
                                End If
                            End If
                                                
                            If Mode = 0 Then
                                If Trim(StrConv(wY_SYU_HREC.PRINT_NOW, vbUnicode)) <> "" Then
                                    Call UniCode_Conv(wY_SYU_HREC.ID_NO, "")
                                    Exit Do
                                End If
                            End If
                            
                            
                            If Left(StrConv(Y_SYU_HREC.ID_NO, vbUnicode), 7) <> Left(StrConv(wY_SYU_HREC.ID_NO, vbUnicode), 7) Then
                                Exit Do
                            End If
                        
                        Case BtErrEOF
                            Call UniCode_Conv(wY_SYU_HREC.ID_NO, "")
                            Exit Do
                        Case Else
                            Call File_Error(sts, BtOpGetEqual, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
                            Exit Function
                    End Select
                    
                    wkcom = BtOpGetNext
                    
                    
                Loop
                    
                    
                    
                If Trim(StrConv(wY_SYU_HREC.ID_NO, vbUnicode)) <> "" Then
                    sEditWK = sEditWK & Chr(&H1B) & "CT0"
                Else
                    sEditWK = sEditWK & Chr(&H1B) & "CT1"
                
                End If
            
            
        '       éwíËñáêî
                sEditWK = sEditWK & Chr(&H1B) & "Q1"
        
            
        '       √ﬁ∞¿ëóêMèIóπéwíË
                sEditWK = sEditWK & Chr(&H1B) & "Z"
        
        '       ETXéwíË
                sEditWK = sEditWK & Chr(&H3)
            
        '       √ﬁ∞¿ëóêM
                PrinterDriver_Write lPrinterHandl, sEditWK
            End If
        
            'àÛç¸çœçXêV
            If Trim(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode)) = "" Then
                
                Call UniCode_Conv(Y_SYU_HREC.PRINT_NOW, PRINT_NOW)
                
                Do
                    Select Case Mode
                        Case 0
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K1_Y_SYU_H, Len(K1_Y_SYU_H), 1)
                        Case 1
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K0_Y_SYU_H, Len(K0_Y_SYU_H), 0)
                    End Select
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                            Beep
                            ans = MsgBox("ëºí[ññÇ≈ÉfÅ[É^égópíÜÇ≈Ç∑ÅB<Y_SYUKA_H.DAT>", vbRetryCancel + vbQuestion, "ämîFì¸óÕ")
                            If ans = vbCancel Then
                                Exit Function
                            End If
                        Case Else
                            Call File_Error(sts, BtOpInsert, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)œΩ¿")
                            Exit Function
                    End Select
                Loop
            
                Call UniCode_Conv(K1_Y_SYU_H.PRINT_NOW, "")
                Call UniCode_Conv(K1_Y_SYU_H.INS_NOW, "")
                Call UniCode_Conv(K1_Y_SYU_H.DATA_CNT, "")
            
                com = BtOpGetGreater
            Else
                com = BtOpGetNext
            
            End If
        Else
            com = BtOpGetNext
        End If
        
    Loop




    'àÛç¸èIóπèàóù
    
    PrinterDriver_End lPrinterHandl








    Call Input_UnLock
    
    Print_Proc = False


End Function
Private Function Print_RE_Proc() As Integer
'----------------------------------------------------------------------------
'                   ç≈èIàÛç¸éwé¶ï™çƒàÛç¸èàóù
'----------------------------------------------------------------------------

Dim lPrinterHandl   As Long         'Ãﬂÿ›¿ ›ƒﬁŸÇéÊìæ

Dim sts             As Integer
Dim com             As Integer
Dim wkcom             As Integer
Dim ans             As Integer

Dim sEditWK         As String       'ï“èW‹∞∏
Dim sJis            As String       'äøéöïœä∑ÇÃÿ¿∞›
Dim vjis            As String
    
Dim SEQ_NO          As Long
    
Dim DEN_SU          As String
    
Dim SKIP_Flg        As Boolean
    
Dim SV_ID_NO        As String * 7
    
Dim NON_PRINT_Flg   As Boolean
    
Dim SV_PRINT_NOW    As String
    
    Print_RE_Proc = True
    
    Call Input_Lock
    
        
    
    
'   àÛç¸äJénèàóù
    PrinterDriver_Start "åüïiÉâÉxÉãî≠çs", lPrinterHandl

    SEQ_NO = 0
    SV_ID_NO = ""

    'ç≈èIàÛç¸ì˙éûÇÃälìæ
'''    sts = BTRV(BtOpGetLast, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K1_Y_SYU_H, Len(K1_Y_SYU_H), 1)
'''    Select Case sts
'''        Case BtNoErr
'''
'''            If Trim(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode)) = "" Then
'''                Print_RE_Proc = False
'''                Exit Function
'''            End If
'''
'''        Case BtErrEOF
'''            Print_RE_Proc = False
'''            Exit Function
'''        Case Else
'''            Call File_Error(sts, BtOpGetEqual, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
'''            Exit Function
'''    End Select
'''
'''    SV_PRINT_NOW = StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode)
    
    SV_PRINT_NOW = Format(List1(plstPrint_Now).List(List1(plstPrint_Now).ListIndex), "YYYYMMDDHHMMSS")
    
    
    Call UniCode_Conv(K1_Y_SYU_H.PRINT_NOW, SV_PRINT_NOW)
    Call UniCode_Conv(K1_Y_SYU_H.INS_NOW, "")
    Call UniCode_Conv(K1_Y_SYU_H.DATA_CNT, "")

    com = BtOpGetGreaterEqual

    Do
    
        DoEvents
        
        SKIP_Flg = False
        
            
        sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K1_Y_SYU_H, Len(K1_Y_SYU_H), 1)
        Select Case sts
            Case BtNoErr
            
                If Trim(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode)) <> SV_PRINT_NOW Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, BtOpGetEqual, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
                Exit Function
        End Select
        
        NON_PRINT_Flg = False
        If Trim(SV_ID_NO) = Left(Trim(StrConv(Y_SYU_HREC.ID_NO, vbUnicode)), 7) Then
            NON_PRINT_Flg = True
        End If
        SV_ID_NO = Left(Trim(StrConv(Y_SYU_HREC.ID_NO, vbUnicode)), 7)
        
        
        If Not SKIP_Flg Then
    
            If Not NON_PRINT_Flg Then
    
    
        '       STXéwíË
                sEditWK = Chr(&H2)
        '       √ﬁ∞¿ëóêMäJénéwíË
                sEditWK = sEditWK & Chr(&H1B) & "A"
    '2006.12.19
                sEditWK = sEditWK & Chr(&H1B) & "A3V+000H+220"
            
                'ì`ï[î‘çÜ
                sEditWK = sEditWK & Chr(&H1B) & "H0010" & Chr(&H1B) & "V0030" & Chr(&H1B) & "L0102" & Chr(&H1B) & "P00"
    '''            sEditWK = sEditWK & Chr(&H1B) & "X21," & Trim(StrConv(Y_SYU_HREC.DEN_NO, vbUnicode)) & StrConv(Y_SYU_HREC.SEQ_NO, vbUnicode)
                sEditWK = sEditWK & Chr(&H1B) & "X21," & Trim(StrConv(Y_SYU_HREC.DEN_NO, vbUnicode))
                'â^ëóâÔé–
                vjis = Kanji_Conv("H", Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)))
                sEditWK = sEditWK & Chr(&H1B) & "H0160" & Chr(&H1B) & "V0030" & Chr(&H1B) & "L0101" & Chr(&H1B) & "P00"
                sEditWK = sEditWK & Chr(&H1B) & "K2H" & vjis
                'òAî‘
                SEQ_NO = SEQ_NO + 1
                
                sEditWK = sEditWK & Chr(&H1B) & "H0330" & Chr(&H1B) & "V0030" & Chr(&H1B) & "L0102" & Chr(&H1B) & "P00"
                sEditWK = sEditWK & Chr(&H1B) & "X21," & Format(SEQ_NO, "#0")
                
                
                'ì`ï[î‘çÜ ﬁ∞∫∞ƒﬁ
                sEditWK = sEditWK & Chr(&H1B) & "H060" & Chr(&H1B) & "V0070" & Chr(&H1B) & "L0101"
    '''            sEditWK = sEditWK & Chr(&H1B) & "D102040" & "*" & Trim(StrConv(Y_SYU_HREC.DEN_NO, vbUnicode)) & StrConv(Y_SYU_HREC.SEQ_NO, vbUnicode) & "*"
                sEditWK = sEditWK & Chr(&H1B) & "D102040" & "*" & Left(StrConv(Y_SYU_HREC.ID_NO, vbUnicode), 7) & "*"
                
                'ìæà”êÊ∫∞ƒﬁ
    '''            sEditWK = sEditWK & Chr(&H1B) & "H0010" & Chr(&H1B) & "V0100" & Chr(&H1B) & "L0102" & Chr(&H1B) & "P00"
    '''            sEditWK = sEditWK & Chr(&H1B) & "X21," & Trim(StrConv(Y_SYU_HREC.MUKE_CODE, vbUnicode))
                'ìæà”êÊñº(ëóÇËêÊ)
                vjis = Kanji_Conv("H", StrConv(Trim(Left(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode), 15)), vbWide))
                sEditWK = sEditWK & Chr(&H1B) & "H0010" & Chr(&H1B) & "V0130" & Chr(&H1B) & "L0101" & Chr(&H1B) & "P00"
                sEditWK = sEditWK & Chr(&H1B) & "K2H" & vjis
    '''            'ì`ï[î‘çÜ ﬁ∞∫∞ƒﬁ
    '''            sEditWK = sEditWK & Chr(&H1B) & "H060" & Chr(&H1B) & "V0130" & Chr(&H1B) & "L0101"
    '''            sEditWK = sEditWK & Chr(&H1B) & "D102040" & "*" & Trim(StrConv(Y_SYU_HREC.MUKE_CODE, vbUnicode)) & "*"
            
                'ç≈ëÂì`ï[çsêîÇÃälìæ
                Call UniCode_Conv(wK4_Y_SYU_H.ID_NO, Left(Trim(StrConv(Y_SYU_HREC.DEN_NO, vbUnicode)), 7) & "99")
                sts = BTRV(BtOpGetLessEqual, wY_SYU_H_POS, wY_SYU_HREC, Len(wY_SYU_HREC), wK4_Y_SYU_H, Len(wK4_Y_SYU_H), 4)
                Select Case sts
                    Case BtNoErr
                    
                        If Left(Trim(StrConv(wY_SYU_HREC.ID_NO, vbUnicode)), 7) <> Left(Trim(StrConv(Y_SYU_HREC.ID_NO, vbUnicode)), 7) Then
                            DEN_SU = "01"
                        Else
                            DEN_SU = Right(Trim(StrConv(wY_SYU_HREC.ID_NO, vbUnicode)), 2)
                        End If
                    Case BtErrEOF
                        DEN_SU = "01"
                    Case Else
                        Call File_Error(sts, BtOpGetLessEqual, "èoâ◊ó\íË")
                        Exit Function
                End Select
                If Not IsNumeric(DEN_SU) Then
                    DEN_SU = "01"
                End If
                sEditWK = sEditWK & Chr(&H1B) & "H0290" & Chr(&H1B) & "V0170" & Chr(&H1B) & "L0102" & Chr(&H1B) & "P00"
                sEditWK = sEditWK & Chr(&H1B) & "X21," & Format(DEN_SU, "#0")
                vjis = Kanji_Conv("H", "ì_")
                sEditWK = sEditWK & Chr(&H1B) & "L0101" & Chr(&H1B) & "P00"
                sEditWK = sEditWK & Chr(&H1B) & "K2H" & vjis
                
                
            
            
    '''            If PRINT_CNT = DATA_CNT Then
    '''                sEditWK = sEditWK & Chr(&H1B) & "CT1"
    '''            Else
    '''                sEditWK = sEditWK & Chr(&H1B) & "CT0"
    '''            End If
                    
                    
                'éüÉåÉRÅ[ÉhÇÃämîF
                Call UniCode_Conv(wK1_Y_SYU_H.PRINT_NOW, StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode))
                Call UniCode_Conv(wK1_Y_SYU_H.INS_NOW, StrConv(Y_SYU_HREC.INS_NOW, vbUnicode))
                Call UniCode_Conv(wK1_Y_SYU_H.DATA_CNT, StrConv(Y_SYU_HREC.DATA_CNT, vbUnicode))
                                
                wkcom = BtOpGetGreater
                                
                Do
                
                    DoEvents
                
                    sts = BTRV(wkcom, wY_SYU_H_POS, wY_SYU_HREC, Len(wY_SYU_HREC), wK1_Y_SYU_H, Len(wK1_Y_SYU_H), 1)
                    Select Case sts
                        Case BtNoErr
                                            
                            If Trim(StrConv(wY_SYU_HREC.PRINT_NOW, vbUnicode)) <> SV_PRINT_NOW Then
                                Call UniCode_Conv(wY_SYU_HREC.ID_NO, "")
                                Exit Do
                            End If
                            
                            
                            If Left(StrConv(Y_SYU_HREC.ID_NO, vbUnicode), 7) <> Left(StrConv(wY_SYU_HREC.ID_NO, vbUnicode), 7) Then
                                Exit Do
                            End If
                        
                        Case BtErrEOF
                            Call UniCode_Conv(wY_SYU_HREC.ID_NO, "")
                            Exit Do
                        Case Else
                            Call File_Error(sts, BtOpGetEqual, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
                            Exit Function
                    End Select
                    
                    wkcom = BtOpGetNext
                    
                    
                Loop
                    
                    
                    
                If Trim(StrConv(wY_SYU_HREC.ID_NO, vbUnicode)) <> "" Then
                    sEditWK = sEditWK & Chr(&H1B) & "CT0"
                Else
                    sEditWK = sEditWK & Chr(&H1B) & "CT1"
                
                End If
            
            
        '       éwíËñáêî
                sEditWK = sEditWK & Chr(&H1B) & "Q1"
        
            
        '       √ﬁ∞¿ëóêMèIóπéwíË
                sEditWK = sEditWK & Chr(&H1B) & "Z"
        
        '       ETXéwíË
                sEditWK = sEditWK & Chr(&H3)
            
        '       √ﬁ∞¿ëóêM
                PrinterDriver_Write lPrinterHandl, sEditWK
            End If
        End If
            
        com = BtOpGetNext
        
            
    Loop




    'àÛç¸èIóπèàóù
    
    PrinterDriver_End lPrinterHandl








    Call Input_UnLock
    
    Print_RE_Proc = False


End Function

Private Sub Command_Click(Index As Integer)

Dim sts         As Integer
Dim i           As Integer
Dim Tana_Cnt    As Long
Dim Yn          As Integer
    
    
    
    Select Case Index
        
        
        
        
        Case 11                             'ÅuèIóπÅv
            Unload Me
        Case Else
            Beep
    End Select
    
    Exit Sub
    
    
    
End Sub


Private Sub Command1_Click(Index As Integer)
'----------------------------------------------------------------------------
'                   êVãKàÛç¸ÇÃéwé¶
'
'----------------------------------------------------------------------------



Dim DATA_CNT    As Integer
Dim Yn          As Integer


 '''           DATA_CNT = Print_Cnt_Proc(0)
 '''           If DATA_CNT < 0 Then
 '''               Unload Me
 '''           End If
        
 '''           Yn = MsgBox("åüïiÉâÉxÉãÇÕÅu" & StrConv(Format(DATA_CNT, "#,##0"), vbWide) & "Åvñáî≠çsÇ≥ÇÍÇ‹Ç∑ÅBãXÇµÇ¢Ç≈Ç∑Ç©ÅH", vbYesNo, "ämîFì¸óÕ")
        
            
    Select Case Index
        Case 0
            
            Yn = MsgBox("ÅuåüïiÉâÉxÉãÅvêVãKàÛç¸ÇçsÇ¢Ç‹Ç∑Ç©ÅH", vbYesNo, "ämîFì¸óÕ")
        
        
            If Yn = vbYes Then
                
                CommonDialog1.CancelError = True
                On Error GoTo ErrHandler
                
                CommonDialog1.ShowPrinter
        
        
                If Print_Proc(0, DATA_CNT) Then
                    Unload Me
                End If
        
        
        
            End If

        Case 1

            If List1(plstPrint_Now).ListIndex < 0 Then
                MsgBox "éwíËçsÇëIëÇµÇƒÇ≠ÇæÇ≥Ç¢"
                
                List1(plstPrint_Now).SetFocus
                List1(plstPrint_Now).ListIndex = 0
                
                Exit Sub
            End If
            
            
            
            'Yn = MsgBox("ÅuåüïiÉâÉxÉãÅvç≈èIàÛç¸éwé¶ï™çƒàÛç¸ÇçsÇ¢Ç‹Ç∑Ç©ÅH", vbYesNo, "ämîFì¸óÕ")
            Yn = MsgBox("ÅuåüïiÉâÉxÉãÅvéûçèéwíËï™Å@çƒàÛç¸ÇçsÇ¢Ç‹Ç∑Ç©ÅH", vbYesNo, "ämîFì¸óÕ")          '2012.12.27 èCê≥    M.T
        
            If Yn = vbYes Then
                
                CommonDialog1.CancelError = True
                On Error GoTo ErrHandler
                
                CommonDialog1.ShowPrinter
        
        
                If Print_RE_Proc() Then
                    Unload Me
                End If
        
            Else
            
        
            End If

    End Select

ErrHandler:

End Sub

Private Sub Command2_Click()
Dim DATA_CNT    As Integer
Dim Yn          As Integer


'''            DATA_CNT = Print_Cnt_Proc(1)
'''            If DATA_CNT < 0 Then
'''                Unload Me
'''            End If
        
'''            Yn = MsgBox("åüïiÉâÉxÉãÇÕÅu" & StrConv(Format(DATA_CNT, "#,##0"), vbWide) & "Åvñáî≠çsÇ≥ÇÍÇ‹Ç∑ÅBãXÇµÇ¢Ç≈Ç∑Ç©ÅH", vbYesNo, "ämîFì¸óÕ")
            
'<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<    2012.12.27  í«â¡    M.T
            If Trim(Text1(ptxS_DEN_NO)) = "" And Trim(Text1(ptxE_DEN_NO)) = "" Then
                MsgBox "äJénì`ï[î‘çÜÇÃéwíËÇ™ïsê≥Å@Å®Å@àÛç¸ïsî\!", vbExclamation
                Text1(ptxS_DEN_NO).SetFocus
                Call Text1_GotFocus(ptxS_DEN_NO)
                Exit Sub
            End If
            
            If Trim(Text1(ptxE_DEN_NO)) = "" Then
                Text1(ptxE_DEN_NO) = Text1(ptxS_DEN_NO)
            End If
            
            If Trim(Text1(ptxS_DEN_NO)) > Trim(Text1(ptxE_DEN_NO)) Then
                MsgBox "ì`ï[î‘çÜÇÃéwíËÇ™ïsê≥Å@Å®Å@àÛç¸ïsî\ÅI", vbExclamation
                Text1(ptxE_DEN_NO).SetFocus
                Call Text1_GotFocus(ptxE_DEN_NO)
                Exit Sub
            End If
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>     Ç±Ç±Ç‹Ç≈
            
            Yn = MsgBox("ÅuåüïiÉâÉxÉãÅvçƒàÛç¸ÇçsÇ¢Ç‹Ç∑Ç©ÅH", vbYesNo, "ämîFì¸óÕ")
        
            If Yn = vbYes Then
                
                CommonDialog1.CancelError = True
                On Error GoTo ErrHandler
                
                CommonDialog1.ShowPrinter
        
        
                If Print_Proc(1, DATA_CNT) Then
                    Unload Me
                End If
                
                
                Text1(ptxE_DEN_NO) = ""
            Else
            
                Text1(ptxS_DEN_NO).SetFocus                     '2012.12.27  í«â¡    M.T
                Call Text1_GotFocus(ptxS_DEN_NO)                '2012.12.27  í«â¡    M.T
            
            End If

ErrHandler:

End Sub

Private Sub Form_KeyDown(KeyCode As Integer, Shift As Integer)
'----------------------------------------------------------------------------
'                   ÇjÇÖÇô ÇcÇèÇóÇé ëOèàóù
'----------------------------------------------------------------------------
    Select Case KeyCode
        Case vbKeyF1 To vbKeyF12
            Command(KeyCode - vbKeyF1).Value = True
    End Select


End Sub

Private Sub Form_KeyPress(KeyAscii As Integer)
    If KeyAscii = vbKeyReturn Then
        KeyAscii = 0
    End If
End Sub

Private Sub Form_Load()
Dim i   As Integer
Dim c   As String * 128
Dim sts As Integer

    If App.PrevInstance Then
        Beep
        MsgBox "ìØàÍÉvÉçÉOÉâÉÄé¿çsíÜÇ≈Ç∑ÅB"
        End
    End If
    
    F1030101.Caption = F1030101.Caption & LAST_UPDATE_DAY           '2016.04.26
    

    Show
                                'ÉçÉOÉtÉ@ÉCÉãñºéÊÇËçûÇ›
    If GetIni("FILE", "LOGF", "SYS", c) Then
        Beep
        MsgBox "ÉVÉXÉeÉÄàŸèÌÇ™î≠ê∂ÇµÇ‹ÇµÇΩÅBèàóùÇíÜé~ÇµÇƒâ∫Ç≥Ç¢ÅB"
        End
    End If
    
    
                                'éñã∆ïîéÊÇËçûÇ›
    If JGYOB_TB_Set(1) Then
        Beep
        MsgBox "éñã∆ïîÇÃälìæÇ…é∏îsÇµÇ‹ÇµÇΩÅBèàóùÇíÜé~ÇµÇƒâ∫Ç≥Ç¢ÅB"
        End
    End If
    
                                
                                'èoâ◊ó\íËÇnÇoÇdÇm
    If Y_SYU_Open(BtOpenNomal) Then
        Beep
        MsgBox "ÉVÉXÉeÉÄàŸèÌÇ™î≠ê∂ÇµÇ‹ÇµÇΩÅBèàóùÇíÜé~ÇµÇƒâ∫Ç≥Ç¢ÅB"
        Unload Me
    End If
                                
                                'èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)ÇnÇoÇdÇm
    If Y_SYU_H_Open(BtOpenNomal) Then
        Beep
        MsgBox "ÉVÉXÉeÉÄàŸèÌÇ™î≠ê∂ÇµÇ‹ÇµÇΩÅBèàóùÇíÜé~ÇµÇƒâ∫Ç≥Ç¢ÅB"
        Unload Me
    End If
                                
                                'èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)ÇnÇoÇdÇm
    If wY_SYU_H_Open(BtOpenNomal) Then
        Beep
        MsgBox "ÉVÉXÉeÉÄàŸèÌÇ™î≠ê∂ÇµÇ‹ÇµÇΩÅBèàóùÇíÜé~ÇµÇƒâ∫Ç≥Ç¢ÅB"
        Unload Me
    End If
                                
                                
    For Each Pri_Name In Printers
        If Pri_Name.DeviceName = Printer.DeviceName Then
            Exit For
        End If
    Next
                                    
    'àÛç¸çœÇ›ÇéÊÇËçûÇﬁ
    If Print_Re_Set_Proc() Then
        Unload Me
    End If
                                
                                
    Command1(0).SetFocus
End Sub

Private Sub Form_Unload(CANCEL As Integer)

Dim sts         As Integer
Dim Wk_Printer  As Printer
                                            
    For Each Wk_Printer In Printers
        If RTrim(Wk_Printer.DeviceName) = RTrim(Pri_Name.DeviceName) Then
            SetWindowsDefaultPrinter Wk_Printer.DeviceName, Wk_Printer.DriverName, Wk_Printer.Port
            Exit For
        End If
    Next
                                            
                                            'èoâ◊ó\íËÇbÇkÇnÇrÇd
    sts = BTRV(BtOpClose, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
        End If
    End If
                                            'èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)ÇbÇkÇnÇrÇd
    sts = BTRV(BtOpClose, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K0_Y_SYU_H, Len(K0_Y_SYU_H), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
        End If
    End If
    
                                            'èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)ÇbÇkÇnÇrÇd
    sts = BTRV(BtOpClose, wY_SYU_H_POS, wY_SYU_HREC, Len(wY_SYU_HREC), wK4_Y_SYU_H, Len(wK4_Y_SYU_H), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
        End If
    End If
    
    
    sts = BTRV(BtOpReset, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K0_Y_SYU_H, Len(K0_Y_SYU_H), 0)
    If sts Then
        Call File_Error(sts, BtOpReset, "")
    End If

    Set F1030101 = Nothing


    End
End Sub
Private Function Print_Cnt_Proc(Mode As Integer) As Long
'----------------------------------------------------------------------------
'                   àÛç¸ñáêîÇÃÉJÉEÉìÉg
'   mode    0:êVãKï™àÛç¸
'           1:çƒàÛç¸
'
'----------------------------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim DATA_CNT    As Long


    Print_Cnt_Proc = True

    DATA_CNT = 0



    Select Case Mode
        Case 0
        '---------------------------------------------êVãKï™
            Call UniCode_Conv(K1_Y_SYU_H.PRINT_NOW, "")
            Call UniCode_Conv(K1_Y_SYU_H.INS_NOW, "")
            Call UniCode_Conv(K1_Y_SYU_H.DATA_CNT, "")


            com = BtOpGetGreaterEqual
        
        
            Do
            
                DoEvents
                
                sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K1_Y_SYU_H, Len(K1_Y_SYU_H), 1)
                Select Case sts
                    Case BtNoErr
                                            
                        If Trim(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode)) <> "" Then
                            Exit Do
                        End If
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, BtOpGetEqual, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
                        Exit Function
                End Select
            
                DATA_CNT = DATA_CNT + 1
            
                com = BtOpGetNext
            
            Loop



        Case 1
        '---------------------------------------------çƒàÛç¸
    
            Call UniCode_Conv(K0_Y_SYU_H.DEN_NO, Trim(Text1(ptxS_DEN_NO).Text))
            Call UniCode_Conv(K0_Y_SYU_H.SEQ_NO, "")


            com = BtOpGetGreaterEqual
        
        
            Do
            
                DoEvents
                
                sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K0_Y_SYU_H, Len(K0_Y_SYU_H), 0)
                Select Case sts
                    Case BtNoErr
                                            
                        If Trim(StrConv(Y_SYU_HREC.DEN_NO, vbUnicode)) > Trim(Text1(ptxE_DEN_NO).Text) Then
                            Exit Do
                        End If
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, BtOpGetEqual, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
                        Exit Function
                End Select
            
                DATA_CNT = DATA_CNT + 1
            
                com = BtOpGetNext
            
            Loop
    
    
    
    End Select











    Print_Cnt_Proc = DATA_CNT

End Function

Private Sub Input_Lock()
'----------------------------------------------------------------------------
'                   âÊñ çÄñ⁄ÉçÉbÉNÅiÉCÉxÉìÉgéÊìæïsâ¬Åj
'----------------------------------------------------------------------------

    F1030101.MousePointer = vbHourglass

    Call Ctrl_Lock(F1030101)


End Sub
Private Sub Input_UnLock()
'----------------------------------------------------------------------------
'                   âÊñ çÄñ⁄ÉçÉbÉNâèúÅiÉCÉxÉìÉgéÊìæâ¬Åj
'----------------------------------------------------------------------------

    Call Ctrl_UnLock(F1030101)


    F1030101.MousePointer = vbDefault

End Sub


Private Function isWindowsNT() As Boolean
  isWindowsNT = IIf(GetVersion() And &H80000000, False, True)
End Function
Private Sub SetWindowsDefaultPrinter(ByVal DeviceName As String, ByVal DriverName As String, ByVal Port As String)
  Dim param As String
  param = DeviceName & "," & DriverName & "," & Port
  WriteProfileString "windows", "device", param
  If isWindowsNT Then
    'Windows NT/2000
    SendMessage HWND_BROADCAST, WM_WININICHANGE, 0&, ByVal 0&
  Else
    'Windows 95/98/Me
    SendMessage HWND_BROADCAST, WM_WININICHANGE, 0&, ByVal "windows"
  End If
'  Printer.EndDoc
End Sub

Private Sub Text1_GotFocus(Index As Integer)
    
    If Text1(Index).TabStop = True Then
        Text1(Index) = Trim(Text1(Index).Text)
        Text1(Index).SelStart = 0
        Text1(Index).SelLength = Len(Text1(Index).Text)
    End If

End Sub

Private Sub Text1_KeyDown(Index As Integer, KeyCode As Integer, Shift As Integer)
    
Dim i       As Integer

Dim W_Str   As String                                               ' 2012.12.27  í«â¡    M.T

    If KeyCode <> vbKeyReturn Then
        Exit Sub
    End If

'<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<    2012.12.27  í«â¡    M.T
    Select Case Index
        Case ptxS_DEN_NO        'äJénì`ï[î‘çÜ
            If Not IsNumeric(Text1(Index)) Then
                MsgBox "êîílÉGÉâÅ[ÅI", vbExclamation
                Text1(Index).SetFocus
                Call Text1_GotFocus(Index)
                Exit Sub
            End If
            
            Call Numeric_Check(EDIT_ONLY, Text1(Index).MaxLength, 0, NEGA_DIS, ZSUP_DIS, COMA_DIS, Text1(Index), W_Str)
            Text1(Index) = W_Str
'2013.01.24            If Trim(Text1(ptxE_DEN_NO)) = "" Then
                Text1(ptxE_DEN_NO) = W_Str
'2013.01.24            End If
        Case ptxE_DEN_NO        'èIóπì`ï[î‘çÜ
            Call Numeric_Check(EDIT_ONLY, Text1(Index).MaxLength, 0, NEGA_DIS, ZSUP_DIS, COMA_DIS, Text1(Index), W_Str)
            Text1(Index) = W_Str
        
        Case Else
        
        
    End Select
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>     Ç±Ç±Ç‹Ç≈
    Call Tab_Ctrl(Shift)     'à⁄ìÆ


End Sub
Function Kanji_Conv(psPara As String, psSiftJis As String) As String
Rem ºÃƒJIS∫∞ƒﬁÇ©ÇÁJIS∫∞ƒﬁÇ÷ïœä∑
'   psPara      :   H=HEX   B=Binary
'   psSiftJis   :   ºÃƒJIS∫∞ƒﬁ

Dim i As Integer    'åÖêîÇÃÿ¿∞›∫∞ƒﬁ
Dim vConv           '‹∞∏ïœêî
Dim vHex            '4 ﬁ≤ƒÇÃºÃƒJIS∫∞ƒﬁÇ…ïœä∑ÇÃÿ¿∞›∫∞ƒﬁ
Dim vUpByte         'è„à 2 ﬁ≤ƒÇ1 ﬁ≤ƒÇ…ïœä∑ÇÃÿ¿∞›∫∞ƒﬁ
Dim vDownByte       'â∫à 2 ﬁ≤ƒÇ1 ﬁ≤ƒÇ…ïœä∑ÇÃÿ¿∞›∫∞ƒﬁ
    
    vConv = ""                                    '‹∞∏ïœêîÇÃèâä˙âª
    For i = 1 To Len(psSiftJis)                   'åÖêîï™åJÇËï‘Ç∑
        vHex = Hex(Asc(Mid$(psSiftJis, i, 1)))    'ÇS ﬁ≤ƒÇÃºÃƒJIS∫∞ƒﬁÇ…ïœä∑
        If vHex = "20" Then
           Exit For
        End If
        vUpByte = Val("&h" + Mid$(vHex, 1, 2))    'è„à ÇQ ﬁ≤ƒÇÇP ﬁ≤ƒÇ…ïœä∑
        vDownByte = Val("&h" + Mid$(vHex, 3, 2))  'â∫à ÇQ ﬁ≤ƒÇÇP ﬁ≤ƒÇ…ïœä∑
        If vUpByte >= &HE0 Then                   'è„à ÇP ﬁ≤ƒÇ™ÇdÇOhÇÃèÍçáÇÃèàóù
           vUpByte = vUpByte - &H40
        End If
        vUpByte = (vUpByte - &H81) * 2 + &H21
        If vDownByte > &H7F Then                  'â∫à ÇP ﬁ≤ƒÇ™ÇWÇOhà»è„ÇÃèàóù
           vDownByte = vDownByte - 1
        End If
        If vDownByte > &H9D Then                  'â∫à ÇP ﬁ≤ƒÇ™ÇXÇdhà»è„ÇÃèàóù
           vUpByte = vUpByte + 1
           vDownByte = vDownByte - (&H9E - &H21)
        Else
           vDownByte = vDownByte - (&H40 - &H21)  'â∫à ÇP ﬁ≤ƒÇ™ÇXÇcà»â∫ÇÃèàóù
        End If
        Select Case psPara
               Case "H"
                    vConv = vConv + Hex(vUpByte) + Hex(vDownByte)    '‹∞∏ïœêîÇ…ë´ÇµçûÇﬁ
               Case "B"
                    vConv = vConv + Chr$(vUpByte) + Chr$(vDownByte)  '‹∞∏ïœêîÇ…ë´ÇµçûÇﬁ
               Case Else
                    vConv = vConv + Hex(vUpByte) + Hex(vDownByte)    '‹∞∏ïœêîÇ…ë´ÇµçûÇﬁ
        End Select
    Next i
    Kanji_Conv = vConv

End Function

Function wY_SYU_H_Open(Mode As Integer) As Integer
'********************************************************************
'*
'*              èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)ÉfÅ[É^  ÇnÇoÇdÇm
'*
'*      à¯  êî:Open Mode(BtrieveéQè∆)
'*      ñﬂÇËíl:false ê≥èÌ
'*             true  àŸèÌ
'*
'********************************************************************
Dim sts         As Integer
Dim c           As String * 128
Dim FullPath    As String
    
    wY_SYU_H_Open = True
                                            'èoâ◊ó\íËÉfÅ[É^ÉtÉãÉpÉXéÊçûÇ›
    sts = GetIni("FILE", Y_SYU_H_ID, "SYS", c)
    If sts <> False Then
        Call LOG_OUT(LOG_F, "SYS.INI [Y_SYU_H]ì«Ç›çûÇ›ÉGÉâÅ[ ")
        Exit Function
    End If
    FullPath = RTrim(c)
    
    Do
        sts = BTRV(BtOpOpen, wY_SYU_H_POS, wY_SYU_HREC, Len(wY_SYU_HREC), ByVal FullPath, Len(FullPath), Mode)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrFILE_INUSE, BtErrINCOMPATIBLE_MODE_ERROR
                Sleep (500&)
            Case Else
                Call File_Error(sts, BtOpOpen, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)ÉfÅ[É^")
                Exit Function
        End Select
    Loop
    wY_SYU_H_Open = False
End Function


Private Function Print_Re_Set_Proc() As Integer
'----------------------------------------------------------------------------
'                   çƒàÛç¸ëIëópÇÃì˙ïtÉZÉbÉg
'----------------------------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim svPRINT_NOW     As String * 14


    Print_Re_Set_Proc = True

    
    Call UniCode_Conv(K1_Y_SYU_H.PRINT_NOW, "19900101000000")
    Call UniCode_Conv(K1_Y_SYU_H.INS_NOW, "")
    Call UniCode_Conv(K1_Y_SYU_H.DATA_CNT, "")
    
    com = BtOpGetGreater

    List1(plstPrint_Now).Clear

    svPRINT_NOW = ""
    
    Do
    
        DoEvents
        
        sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K1_Y_SYU_H, Len(K1_Y_SYU_H), 1)
        Select Case sts
            Case BtNoErr
                                    
            
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, BtOpGetEqual, "èoâ◊ó\íË(ŒΩƒ≤“∞ºﬁ)")
                Exit Function
        End Select
    
        If Trim(svPRINT_NOW) = "" Then
            svPRINT_NOW = StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode)
        
            Call UniCode_Conv(K1_Y_SYU_H.INS_NOW, "zzzzzzzzzzzzzz")
            Call UniCode_Conv(K1_Y_SYU_H.DATA_CNT, "zzzzz")
        
            
            List1(plstPrint_Now).AddItem Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 1, 4) & "/" & _
                                            Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 5, 2) & "/" & _
                                            Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 7, 2) & " " & _
                                            Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 9, 2) & ":" & _
                                            Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 11, 2) & ":" & _
                                            Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 13, 2)

        End If
    
        If svPRINT_NOW <> StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode) Then
        
            Call UniCode_Conv(K1_Y_SYU_H.INS_NOW, "zzzzzzzzzzzzzz")
            Call UniCode_Conv(K1_Y_SYU_H.DATA_CNT, "zzzzz")
        
            List1(plstPrint_Now).AddItem Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 1, 4) & "/" & _
                                            Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 5, 2) & "/" & _
                                            Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 7, 2) & " " & _
                                            Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 9, 2) & ":" & _
                                            Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 11, 2) & ":" & _
                                            Mid(StrConv(Y_SYU_HREC.PRINT_NOW, vbUnicode), 13, 2)
        
        End If
    
        com = BtOpGetGreater
    
    Loop

    If List1(plstPrint_Now).ListCount = 0 Then
        List1(plstPrint_Now).AddItem "çƒàÛç¸ëŒè€ñ≥Çµ"
        Frame2.Enabled = False
    End If


    Print_Re_Set_Proc = False

End Function
