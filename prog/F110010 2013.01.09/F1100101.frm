VERSION 5.00
Object = "{D4A17F03-6EDB-11D2-A6E0-0040262B3978}#2.2#0"; "CtrsWsk.ocx"
Begin VB.Form F1100101 
   Caption         =   "スキャナ制御"
   ClientHeight    =   4890
   ClientLeft      =   60
   ClientTop       =   345
   ClientWidth     =   6765
   BeginProperty Font 
      Name            =   "ＭＳ ゴシック"
      Size            =   12
      Charset         =   128
      Weight          =   400
      Underline       =   0   'False
      Italic          =   0   'False
      Strikethrough   =   0   'False
   EndProperty
   LinkTopic       =   "Form1"
   ScaleHeight     =   4890
   ScaleWidth      =   6765
   StartUpPosition =   2  '画面の中央
   Begin VB.TextBox Text2 
      BackColor       =   &H8000000F&
      Height          =   360
      Index           =   3
      Left            =   2280
      Locked          =   -1  'True
      TabIndex        =   17
      Top             =   3600
      Width           =   375
   End
   Begin VB.TextBox Text2 
      BackColor       =   &H8000000F&
      Height          =   360
      Index           =   2
      Left            =   1560
      Locked          =   -1  'True
      TabIndex        =   15
      Top             =   3600
      Width           =   375
   End
   Begin VB.CommandButton Command2 
      Caption         =   "設定"
      Height          =   375
      Left            =   2760
      TabIndex        =   13
      Top             =   4320
      Width           =   855
   End
   Begin VB.Timer Timer1 
      Enabled         =   0   'False
      Interval        =   30000
      Left            =   120
      Top             =   2760
   End
   Begin VB.TextBox Text2 
      Height          =   360
      Index           =   1
      Left            =   2280
      TabIndex        =   12
      Top             =   4320
      Width           =   375
   End
   Begin VB.TextBox Text2 
      Height          =   360
      Index           =   0
      Left            =   1560
      TabIndex        =   10
      Top             =   4320
      Width           =   375
   End
   Begin VB.TextBox errText 
      Alignment       =   2  '中央揃え
      BackColor       =   &H000000FF&
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   20.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   495
      Index           =   1
      Left            =   210
      TabIndex        =   7
      Text            =   "LOG.TXTを確認"
      Top             =   7080
      Visible         =   0   'False
      Width           =   6135
   End
   Begin VB.TextBox errText 
      Alignment       =   2  '中央揃え
      BackColor       =   &H000000FF&
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   20.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   495
      Index           =   0
      Left            =   210
      TabIndex        =   6
      Top             =   6480
      Visible         =   0   'False
      Width           =   6180
   End
   Begin VB.CommandButton Command1 
      Caption         =   "一時停止"
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   12
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   735
      Index           =   2
      Left            =   1620
      TabIndex        =   5
      Top             =   2520
      Width           =   3375
   End
   Begin VB.TextBox Text1 
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   8.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   360
      Index           =   1
      Left            =   165
      TabIndex        =   4
      Top             =   5340
      Width           =   10695
   End
   Begin VB.TextBox Text1 
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   8.25
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   360
      Index           =   0
      Left            =   165
      TabIndex        =   3
      Top             =   4920
      Width           =   10695
   End
   Begin VB.TextBox Text1 
      ForeColor       =   &H000000FF&
      Height          =   360
      Index           =   2
      Left            =   165
      TabIndex        =   2
      Top             =   5940
      Width           =   6255
   End
   Begin VB.CommandButton Command1 
      Caption         =   "業務終了"
      Enabled         =   0   'False
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   12
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   735
      Index           =   1
      Left            =   1605
      TabIndex        =   1
      Top             =   1620
      Visible         =   0   'False
      Width           =   3375
   End
   Begin VB.CommandButton Command1 
      Caption         =   "業務開始"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   12
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   735
      Index           =   0
      Left            =   1605
      TabIndex        =   0
      Top             =   660
      Width           =   3375
   End
   Begin VB.Label Label3 
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   9.75
         Charset         =   128
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H000000FF&
      Height          =   255
      Left            =   3720
      TabIndex        =   18
      Top             =   4440
      Width           =   2775
   End
   Begin VB.Label Label2 
      Caption         =   "："
      Height          =   255
      Index           =   3
      Left            =   2040
      TabIndex        =   16
      Top             =   3720
      Width           =   255
   End
   Begin VB.Label Label2 
      Caption         =   "開始時刻"
      Height          =   255
      Index           =   2
      Left            =   360
      TabIndex        =   14
      Top             =   3720
      Width           =   1095
   End
   Begin VB.Label Label2 
      Caption         =   "："
      Height          =   255
      Index           =   1
      Left            =   2040
      TabIndex        =   11
      Top             =   4440
      Width           =   255
   End
   Begin VB.Label Label2 
      Caption         =   "終了時刻"
      Height          =   255
      Index           =   0
      Left            =   360
      TabIndex        =   9
      Top             =   4440
      Width           =   1095
   End
   Begin VB.Label Label1 
      Alignment       =   2  '中央揃え
      BackColor       =   &H00C0FFC0&
      Caption         =   "株式会社ＳＤＣ　POS管理システム[停止中]"
      BeginProperty Font 
         Name            =   "ＭＳ ゴシック"
         Size            =   11.25
         Charset         =   128
         Weight          =   700
         Underline       =   0   'False
         Italic          =   -1  'True
         Strikethrough   =   0   'False
      EndProperty
      Height          =   315
      Left            =   0
      TabIndex        =   8
      Top             =   0
      Width           =   6540
   End
   Begin CTRSWSKLib.CtrsWsk CtrsWsk1 
      Left            =   270
      Top             =   1860
      _Version        =   131074
      _ExtentX        =   847
      _ExtentY        =   847
      _StockProps     =   0
   End
End
Attribute VB_Name = "F1100101"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Option Explicit



'***************************** ＦＩＬＥ　ＤＥＬＥＴＥ確認忘れるな！！

    


'''''''''''''''''''''''''''''''' Label_File_Make_ProcのﾁｪｯｸＯＫ？　***********************************************
'''''''''''''''''''''''''''''''' 20110.11.30のﾁｪｯｸＯＫ？　***********************************************

Private Const LAST_UPDATE_DAY$ = "([F110010] 2012.11.19 08:00)"



Private Sub Command1_Click(Index As Integer)
'-------------------------------------------------------
'
'   『業務開始指示』
'       １． ポートの獲得
'       ２． ポートの開放
'-------------------------------------------------------
    
Dim ans As Integer
    
    On Error GoTo Error
    
    Select Case Index
        
        Case 0                              '業務開始
            
            CtrsWsk1.Bind LocalPort, RemotePort
            F1100101.Caption = "スキャナ制御" & " " & LAST_UPDATE_DAY
    
    
            Label1.Caption = "株式会社ＳＤＣ　ＰＯＳシステム[実行中]"
    
    
            Command1(0).Enabled = False
            
            
            Command1(0).Caption = Format(Now, "YYYY/MM/DD HH:MM:SS")
            
            
            Command1(1).Enabled = True
            Command1(2).Enabled = True
    
        Case 1                              '業務終了
            
            
            ans = MsgBox("本日の業務終了しますか？", vbYesNo + vbDefaultButton2, "業務終了")
            If ans = vbNo Then
                Exit Sub
            End If
            
            CtrsWsk1.Unbind
            
            Normal_End = False              '正常終了
            
            Next_Step = 1                   '次処理起動する
            Unload Me
    
        Case 2
            CtrsWsk1.Unbind
            
            Normal_End = False              '正常終了
            Next_Step = 0                   '次処理起動しない
            Unload Me
    
    End Select
    
    Exit Sub

Error:
    MsgBox "Winsock Error= " & Err.Description    'ステータス行にエラーを表示します。
    
    Call LOG_OUT(LOG_F, "Winsock Error= " & Err.Description)
    
    Normal_End = True                       '異常終了
    Unload Me
    


End Sub


Private Sub Command2_Click()


Dim sts     As Integer
Dim yn      As Integer

    If Not IsNumeric(Text2(0).Text) Or Not IsNumeric(Text2(1).Text) Then
        Label3.Caption = "「終了時刻」入力エラー"
        Text2(0).SetFocus
        Exit Sub
    End If

    Text2(0).Text = Format(Val(Text2(0).Text), "00")
    If Val(Text2(0).Text) < 0 Or Val(Text2(0).Text) > 23 Then
        Label3.Caption = "「終了時刻」入力エラー"
        Text2(0).SetFocus
        Exit Sub
    End If
    Text2(1).Text = Format(Val(Text2(1).Text), "00")
    If Val(Text2(1).Text) < 0 Or Val(Text2(1).Text) > 59 Then
        Label3.Caption = "「終了時刻」入力エラー"
        Text2(1).SetFocus
        Exit Sub
    End If
    
    sts = WriteIni(App.EXEName, "ENDTIME", "SYS", Text2(0).Text & Text2(1).Text)
    If sts Then
        Label3.Caption = "「終了時刻」書き込みエラー SYS.INI"
    End If
End Sub

Private Sub CtrsWsk1_OnReceive(ByVal ID_NO As Integer, ByVal RecvText As String, ByVal Resp_Mode As Boolean)
'-------------------------------------------------------
'
'   『レコード受信時処理』
'
'-------------------------------------------------------

Dim nErrCode    As Integer
Dim strErrMsg   As String
Dim intLine     As Integer
Dim i           As Integer
Dim j           As Integer
Dim Chk_Time    As String * 8
Dim Sendbuf     As String

Dim Errbuf      As String

Dim sts         As Integer

Dim Start_Flg   As Integer


    Text1(0).Text = Format(ID_NO, "000") & ", Recv=" & RecvText
    
'    Call Log_Out(LOG_F, Format(ID_NO, "000") & ", Recv=" & RecvText)
        
    RecvText = Left(RecvText, Len(RecvText) - 2)
    
                                    'ＩＤ№で受信済みテキスト検索
    ING_No = -1
    
    Start_Flg = False
    
    For i = 0 To UBound(ID_KANRI_TBL)
        If ID_NO = ID_KANRI_TBL(i).ID Then
            ING_No = i
            Chk_Time = ID_KANRI_TBL(i).Time
            Exit For
        End If
    Next i
    
    
    
    
    
    If i > UBound(ID_KANRI_TBL) Then
                                                'ＩＤ№新規登録
        For i = 0 To UBound(ID_KANRI_TBL)
            If ID_KANRI_TBL(i).ID = 0 Then
                
                Start_Flg = True
                
                ID_KANRI_TBL(i).ID = ID_NO      'ID_No  保存
                
'                ID_KANRI_TBL(i).MENU_GRP = ""
                ID_KANRI_TBL(i).MENU_LV1 = ""
                ID_KANRI_TBL(i).MENU_LV2 = ""
''                ID_KANRI_TBL(i).MENU_LV3 = ""
                
                If UBound(JGYOBU_T) = 0 Then    '１事業部固定
                Else
                    ID_KANRI_TBL(i).JGYOBU = ""
                End If
                
                If UBound(NAIGAI) = 0 Then   '国内外固定
                Else
                    ID_KANRI_TBL(i).NAIGAI = ""
                End If
                
                ING_No = i
                Chk_Time = ""
                Exit For
            End If
        
        Next i
    End If
    
    
'Call Log_Out(LOG_F, Format(ID_NO, "000") & ",Yoin= " & ID_KANRI_TBL(i).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(i).Sagyo_Code.YOIN_CODE)
    
    
    If ING_No = -1 Then
        MsgBox "ＩＮＩファイルの子機数の設定を変更して下さい。", vbCritical
        Normal_End = True
        Unload Me
    End If
    
                                            '前回受信値を再受信した？
    If Left(Right(RecvText, 9), 8) = ID_KANRI_TBL(i).Time And _
         Right(RecvText, 1) = "1" Then
            Call Send_Err_Proc(Sendbuf)
    
            Call LOG_OUT(LOG_F, Format(ID_NO, "000") & ", Send=" & Sendbuf & "[再送信]")
    
    Else
                                            
        '>>>>>>>>>>>>>>>>>>>>>> 2013.01.04
        
        If Val(Left(Right(RecvText, 9), 8)) <> 0 Then
            If Left(Right(RecvText, 9), 8) < ID_KANRI_TBL(ING_No).Time Then
                                                    
                Call Err_Send_Proc("受信エラー", "再読込みして下さい", "", "", "")
                Sendbuf = Text_Create_Proc()
                GoTo SendResp_Proc
            End If
        End If
        '>>>>>>>>>>>>>>>>>>>>>> 2013.01.04
                                            
                                            
                                            
                                            
                                            '受信内容を保存
        ID_KANRI_TBL(ING_No).Recv_text(0) = Left(RecvText, 20)       '受信内容１行目
        ID_KANRI_TBL(ING_No).Recv_text(1) = Mid(RecvText, 21, 20)    '受信内容２行目
        ID_KANRI_TBL(ING_No).Recv_text(2) = Mid(RecvText, 41, 20)    '受信内容３行目
        ID_KANRI_TBL(ING_No).Recv_text(3) = Mid(RecvText, 61, 20)    '受信内容４行目
        ID_KANRI_TBL(ING_No).Recv_text(4) = Mid(RecvText, 81, 20)    '受信内容４行目
        ID_KANRI_TBL(ING_No).Time = Left(Right(RecvText, 9), 8)      '送信時刻
        
        
                                            
        If Start_Flg Then
            If Trim(ID_KANRI_TBL(ING_No).Recv_text(0)) <> Start_Para Then
                Call Err_Send_Proc("再起動してください。", "", "", "", "")
                Sendbuf = Text_Create_Proc()
            End If
        End If
                                            
        If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_SHOUHINKA Then
            
            If Trim(ID_KANRI_TBL(ING_No).Recv_text(0)) = Fin_Para Then
            
                If ID_KANRI_TBL(ING_No).Step >= Step_Sagyo2_REQ Then
                
                    ID_KANRI_TBL(ING_No).Recv_text(0) = "ENT"
                End If
            End If
        End If
                                      
                                      
                                      
        If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = Wel_COMPO_CHECK Then
            
            
            If ID_KANRI_TBL(ING_No).Step >= Step_Sagyo2_REQ Then
                
                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(ID_KANRI_TBL(ING_No).Input_Line + 2)), 2) = LCD_Hinban Then
                            
                
                
                
                    ID_KANRI_TBL(ING_No).Recv_text(0) = "ENT"
                End If
            End If
        End If
                                      
                                      
                                      
                                      
                                      
                                      '[START][CANCEL][FINISHI]受信は初期化する
        Select Case Trim(ID_KANRI_TBL(ING_No).Recv_text(0))
            Case Start_Para     '開始(子機電源ON)
                
                
                            '出荷予定／在庫の予約解除
                sts = Data_Clear_Proc(0, Sendbuf)
                Select Case sts
                    Case SYS_ERR
                        Normal_End = True
                End Select
                
                
                ID_KANRI_TBL(ING_No).Step = Step_Start
        
                ID_KANRI_TBL(ING_No).CTR_TYPE = Trim(ID_KANRI_TBL(ING_No).Recv_text(1))
                        
        
                Call Start_Proc(Sendbuf)
            
            
            Case Ent_Para       'ENT
                If Not Start_Flg Then
                    
                    If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN Or _
                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN_MTS Or _
                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN_DEN Or _
                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_SPECIAL_PROCESS Or _
                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_BINNO Or _
                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN_GAI Or _
                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_SHOUHINKA Then '2009.08.08
                        '検品時の確認
                        
                        
                        
    '                    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
    '                    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
    '                    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
    '                    Select Case sts
    '                        Case BtNoErr
    '                        '   -------------------------------- エラーメッセージ作成
    '                        Case Else
    '                       '重要な要因なので未登録はシステム停止とする
    '                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
    '                        Sendbuf = Text_Create_Proc()
    '                        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
    '                        Normal_End = True
    '                    End Select
    '
                        
                        
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1
                        
                        If Sagyo_Main_Proc(Sendbuf) Then
                            Normal_End = True
    '                        Unload Me
                        End If
                    Else
                        
                        '--------------------------------------------------- 大阪  部材対応　2012.03.06
                        If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = Wel_HIN_FURIKA_S Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = Wel_IDO_IN_OSAKA Then
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1
                            
                            If Sagyo_Main_Proc(Sendbuf) Then
                                Normal_End = True
                            End If
                        
                        Else
                        '--------------------------------------------------- 大阪  部材対応　2012.03.06
                            '参照画面の確認時のみ
                            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                            Select Case sts
                                Case BtNoErr
                                 '   -------------------------------- エラーメッセージ作成
                                Case Else
                               '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Normal_End = True
                            End Select
                            
                             
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Normal_End = True
                            End If
                            Sendbuf = Text_Create_Proc()
                        End If
                    End If
                Else
                    ID_KANRI_TBL(i).ID = 0
                End If
            Case Can_Para       'CANCEL
                If Not Start_Flg Then
                
                    If ID_KANRI_TBL(ING_No).Last_Send = 1 Then
                                
If 0 = 100 Then
    GoTo print_end
End If
                        '検品時はデータの開放を行う　2004.06.14 ↓
                        If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN_MTS Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_SPECIAL_PROCESS Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_BINNO Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN_GAI Then '2009.08.08


                                 
                            
                            
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    If Sagyo_Send_Proc() Then
                                        Sendbuf = Text_Create_Proc()
                                        Normal_End = True
                                    End If
                                    Sendbuf = Text_Create_Proc()
                                
                                Case SYS_ERR
                                    Normal_End = True
                            End Select
                        
                        Else
                        
'''                             大阪PC向けは、特定のｽﾃｯﾌﾟのみ解除する
                            If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN_DEN Then '2006.12.07
                                If (ID_KANRI_TBL(ING_No).Step <> Step_Sagyo2_RES And _
                                    ID_KANRI_TBL(ING_No).Step <> Step_Sagyo3_RES And _
                                    ID_KANRI_TBL(ING_No).Step <> Step_Sagyo5_RES) Then
                                
                                    sts = Data_Clear_Proc(0, Sendbuf)
                                    Select Case sts
                                        Case SYS_CANCEL
                                            If Sagyo_Send_Proc() Then
                                                Sendbuf = Text_Create_Proc()
                                                Normal_End = True
                                            End If
                                            Sendbuf = Text_Create_Proc()
                                        
                                        Case SYS_ERR
                                            Normal_End = True
                                    End Select
                                
                                End If
                            End If
                        End If
                                
                        '検品時はデータの開放を行う　2004.06.14 ↑
                                
                        
                        
                        'ﾃﾞｰﾀ解放処理を追加 2011.04.07
                        If (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_SYUKA_HYO Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_DENPYO_ID Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_SYUKA_HYO_OSAKA) Then
                            If (ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ) Then


                                sts = Data_Clear_Proc(0, Sendbuf)
                                Select Case sts
                                    Case SYS_CANCEL
                                        If Sagyo_Send_Proc() Then
                                            Sendbuf = Text_Create_Proc()
                                            Normal_End = True
                                        End If
                                        Sendbuf = Text_Create_Proc()

                                    Case SYS_ERR
                                        Normal_End = True
                                End Select

                            End If
                        End If
                        'ﾃﾞｰﾀ解放処理を追加 2011.04.07
                                
                                
                                '前回がエラー送信
                        Call Re_Send_Proc(Sendbuf)
                
                    Else
                                
                                
                                                        
                                
                                '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Normal_End = True
                                End If
                                Sendbuf = Text_Create_Proc()
                            
                            Case SYS_ERR
                                Normal_End = True
                        End Select
                
                
                
                        Call Cancel_Proc(Sendbuf)
                
                    End If
            
                Else
                    ID_KANRI_TBL(i).ID = 0
                End If
            
            Case Fin_Para       'FINISH
                    
                If Not Start_Flg Then
                
                
                
                    If ID_KANRI_TBL(ING_No).LABEL_ON Then
                        ID_KANRI_TBL(ING_No).LABEL_ON = False
                
                
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1
                    
                        If Sagyo_Main_Proc(Sendbuf) Then
                            Normal_End = True
                        End If
                
                    Else
                
                
                        '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                If Sagyo_Send_Proc() Then
                                    Normal_End = True
                                End If
                                Sendbuf = Text_Create_Proc()
                        
                            Case SYS_ERR
                                Normal_End = True
                        End Select
                    
                    
    '                    If Step_MENU1_REQ < ID_KANRI_TBL(ING_No).Step Then
                        If Step_TANTO_REQ <> ID_KANRI_TBL(ING_No).Step Then      '2005.01.07 if ～　else ～　end if
                        
                            ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                            ID_KANRI_TBL(ING_No).MENU_LV2 = ""
    '2006.01.30                        ID_KANRI_TBL(ING_No).MENU_LV3 = ""
                    
                            ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
                            ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
    '2006.01.03                        ID_KANRI_TBL(ING_No).PageNo_LV3 = 0
                    
                    
                    
                            ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ
                    
                            If Menu_Send_Proc(Sendbuf) Then
                                Normal_End = True
        '                Unload Me
                            End If
                    
                        Else                                                    '2005.01.07
    '                        ID_KANRI_TBL(ING_No).Step = Step_Start
                                                                                '2005.01.07
                            Call Start_Proc(Sendbuf)                            '2005.01.07
                                                                                '2005.01.07
                        End If                                                  '2005.01.07
                    End If
                Else
                    ID_KANRI_TBL(i).ID = 0
                End If
            
            
            '2008.08.08 MENU FIN
            Case MENU_FIN
            
                            
                If Not Start_Flg Then
                    If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                ID_KANRI_TBL(ING_No).NAIGAI, _
                                                ID_KANRI_TBL(ING_No).MENU_LV1, _
                                                "EN", , , , , , , , , FILE_RETRY) Then
                                    
                        Normal_End = True
                    
                    End If
                            
                    Text1(1).Text = Format(ID_KANRI_TBL(ING_No).ID, "000") & "=" & "EN"
                            
                            
'                    ST_LOG_OUT_F = True
                
                    If ID_KANRI_TBL(ING_No).Last_Send = 1 Then
                                
                                
                        '検品時はデータの開放を行う　2004.06.14 ↓
                        If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN_MTS Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_SPECIAL_PROCESS Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_BINNO Or _
                            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN_GAI Then '2009.08.08


                                 
                            
                            
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    If Sagyo_Send_Proc() Then
                                        Sendbuf = Text_Create_Proc()
                                        Normal_End = True
                                    End If
                                    Sendbuf = Text_Create_Proc()
                                
                                Case SYS_ERR
                                    Normal_End = True
                            End Select
                        
                        Else
                        
'''                             大阪PC向けは、特定のｽﾃｯﾌﾟのみ解除する
                            If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ACT_KENPIN_DEN Then '2006.12.07
                                If (ID_KANRI_TBL(ING_No).Step <> Step_Sagyo2_RES And _
                                    ID_KANRI_TBL(ING_No).Step <> Step_Sagyo3_RES And _
                                    ID_KANRI_TBL(ING_No).Step <> Step_Sagyo5_RES) Then
                                
                                    sts = Data_Clear_Proc(0, Sendbuf)
                                    Select Case sts
                                        Case SYS_CANCEL
                                            If Sagyo_Send_Proc() Then
                                                Sendbuf = Text_Create_Proc()
                                                Normal_End = True
                                            End If
                                            Sendbuf = Text_Create_Proc()
                                        
                                        Case SYS_ERR
                                            Normal_End = True
                                    End Select
                                
                                End If
                            End If
                        End If
                                
                        '検品時はデータの開放を行う　2004.06.14 ↑
                                
                                '前回がエラー送信
                        Call Re_Send_Proc(Sendbuf)
                
                    Else
                                '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Normal_End = True
                                End If
                                Sendbuf = Text_Create_Proc()
                            
                            Case SYS_ERR
                                Normal_End = True
                        End Select
                
                
                
                        Call Cancel_Proc(Sendbuf, 1, "EN")          '2008.09.01 ﾊﾟﾗﾒｰﾀ追加
                
                    End If
            
                Else
                    ID_KANRI_TBL(i).ID = 0
                End If
            
            
            
            '2008.08.08 MENU FIN
            
            
            
            
            
            Case P_END_Para     '印刷完了   2010.01.21
            
print_end:
            
                ID_KANRI_TBL(ING_No).LABEL_ON = False
        
        
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1
            
                If Sagyo_Main_Proc(Sendbuf) Then
                    Normal_End = True
                End If
            
            
            
            Case Else
                If Not Start_Flg Then
                                            '進捗チェック
                    Select Case ID_KANRI_TBL(ING_No).Step
            
            
                        Case Step_TANTO_REQ         '担当者要求に対するレス
                        
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_TANTO_RES
        
                            If Normal_Proc(Sendbuf) Then
                                Normal_End = True
    '                        Unload Me
                            End If
        
                        Case Step_JGYOBU_REQ        '事業部要求に対するレス
                
                            Select Case Trim(ID_KANRI_TBL(ING_No).Recv_text(0))
    '                        Case BEF_Page       '前頁
    '                        Case NEXT_Page      '次頁
                                Case Else            '事業部受信
                
                                    ID_KANRI_TBL(ING_No).Step = Step_JGYOBU_RES
              
                                    ID_KANRI_TBL(ING_No).JGYOBU = Trim(ID_KANRI_TBL(ING_No).Recv_text(0))
        
                                    If Normal_Proc(Sendbuf) Then
                                        Normal_End = True
    '                                Unload Me
                                    End If
                
                            End Select
                                    
                        Case Step_NAIGAI_REQ
                    
                            Select Case Trim(ID_KANRI_TBL(ING_No).Recv_text(0))
                                Case Else           'メニューパラメータ受信
                
                                    ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_RES
                                        
                                    ID_KANRI_TBL(ING_No).NAIGAI = Trim(ID_KANRI_TBL(i).Recv_text(0))
                                
        
                                    If Normal_Proc(Sendbuf) Then
                                        Normal_End = True
    '                                Unload Me
                                    End If
                
                            End Select
    
'2006.01.30                        Case Step_MENU1_REQ, Step_MENU2_REQ, Step_MENU3_REQ
                        Case Step_MENU1_REQ, Step_MENU2_REQ
                
                             Select Case Trim(ID_KANRI_TBL(ING_No).Recv_text(0))
                                Case BEF_Page       '前頁
                            
                                    
                                    Select Case ID_KANRI_TBL(ING_No).Step
                                        Case Step_MENU1_REQ
                                            ID_KANRI_TBL(ING_No).PageNo_LV1 = ID_KANRI_TBL(ING_No).PageNo_LV1 - 1
                                        Case Step_MENU2_REQ
                                            ID_KANRI_TBL(ING_No).PageNo_LV2 = ID_KANRI_TBL(ING_No).PageNo_LV2 - 1
'2006.01.30                                        Case Step_MENU3_REQ
'2006.01.30                                            ID_KANRI_TBL(ING_No).PageNo_LV3 = ID_KANRI_TBL(ING_No).PageNo_LV3 - 1
                                    End Select
                                    
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1
                                    
                                    If Menu_Recv_Proc(Sendbuf) Then
                                        Normal_End = True
    '                                Unload Me
                                    End If
                            
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            
                                Case NEXT_Page      '次頁
                                    
                                    
                                    Select Case ID_KANRI_TBL(ING_No).Step
                                        Case Step_MENU1_REQ
                                            ID_KANRI_TBL(ING_No).PageNo_LV1 = ID_KANRI_TBL(ING_No).PageNo_LV1 + 1
                                        Case Step_MENU2_REQ
                                            ID_KANRI_TBL(ING_No).PageNo_LV2 = ID_KANRI_TBL(ING_No).PageNo_LV2 + 1
'2006.01.30                                        Case Step_MENU3_REQ
'2006.01.30                                            ID_KANRI_TBL(ING_No).PageNo_LV3 = ID_KANRI_TBL(ING_No).PageNo_LV3 + 1
                                    End Select
                                    
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1
                                    If Menu_Recv_Proc(Sendbuf) Then
                                        Normal_End = True
    '                                Unload Me
                                    End If
                            
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                
                                Case Else           'メニューパラメータ受信
                
                                    Select Case ID_KANRI_TBL(ING_No).Step
                                        Case Step_MENU1_REQ
                                            ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
                                        Case Step_MENU2_REQ
'                                            ID_KANRI_TBL(ING_No).PageNo_LV3 = 0
'2006.01.30                                        Case Step_MENU3_REQ
'2006.01.30                                            ID_KANRI_TBL(ING_No).PageNo_LV3 = 0
                                    End Select
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1
                                
                                    Select Case ID_KANRI_TBL(ING_No).Step
                                        Case Step_MENU1_RES
                                            ID_KANRI_TBL(ING_No).MENU_LV1 = Trim(ID_KANRI_TBL(ING_No).Recv_text(0))
                                        
                                        
                                            '2008.08.08
                                            If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                                                        ID_KANRI_TBL(ING_No).MENU_LV1, _
                                                                        "ST", , , , , , , , , FILE_RETRY) Then
                            
                                                Normal_End = True
                                            End If
                                            
                                                                                
                                            Text1(1).Text = Format(ID_KANRI_TBL(ING_No).ID, "000") & "=" & "ST"
                                            
                                            
                                            '2008.08.08
                                        
                                        
                                        
                                        Case Step_MENU2_RES
                                            ID_KANRI_TBL(ING_No).MENU_LV2 = Trim(ID_KANRI_TBL(ING_No).Recv_text(0))
                                            ID_KANRI_TBL(ING_No).MTS_CODE = Mid(ID_KANRI_TBL(ING_No).Recv_text(0), 3, 8)
                                            ID_KANRI_TBL(ING_No).SS_CODE = Mid(ID_KANRI_TBL(ING_No).Recv_text(0), 11, 8)

'2006.01.30                                        Case Step_MENU3_RES
'2006.01.30                                            ID_KANRI_TBL(ING_No).MENU_LV3 = Trim(ID_KANRI_TBL(ING_No).Recv_text(0))
                                    
                                    
                                    
                                            '2008.08.08
'                                            If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
'                                                                        ID_KANRI_TBL(ING_No).JGYOBU, _
'                                                                        ID_KANRI_TBL(ING_No).NAIGAI, _
'                                                                        ID_KANRI_TBL(ING_No).MENU_LV1, _
'                                                                        "ST", , , , , , , , , FILE_RETRY) Then
'
'                                                Normal_End = True
'                                            End If
                                            '2008.08.08
                                    
                                    
                                    
                                    
                                    
                                    
                                    End Select
                
                                
                                    If Menu_Recv_Proc(Sendbuf) Then
                                        Normal_End = True
    '                                Unload Me
                                    End If
                
                            End Select
                        
                        Case Step_Sagyo1_REQ, Step_Sagyo2_REQ, Step_Sagyo3_REQ, Step_Sagyo4_REQ, Step_Sagyo5_REQ, Step_Sagyo6_REQ
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1
                        
                            If Sagyo_Main_Proc(Sendbuf) Then
                                Normal_End = True
    '                        Unload Me
                            End If
                        Case Else
                    End Select
                Else
                    ID_KANRI_TBL(i).ID = 0
                End If
    
        
        End Select
    
    End If
    
    
SendResp_Proc:              '2013.01.04


    If Resp_Mode Then
        On Error GoTo ShowError

        CtrsWsk1.SendResp Sendbuf

'        Text1(1).Text = Format(ID_NO, "000") & ", Send=" & SendBuf
        
'        Call Log_Out(LOG_F, Format(ID_NO, "000") & ", Send=" & Sendbuf)

        On Error GoTo 0
    
        ID_KANRI_TBL(ING_No).Last_Send_Text.sts = Send_Text.sts                     'ステータス
        ID_KANRI_TBL(ING_No).Last_Send_Text.Display_Flg = Send_Text.Display_Flg     '表示画面フラグ
        ID_KANRI_TBL(ING_No).Last_Send_Text.End_Menu = Send_Text.End_Menu           '最終メニューフラグ
        ID_KANRI_TBL(ING_No).Last_Send_Text.Menu_Suu = Send_Text.Menu_Suu           'メニュー個数
        ID_KANRI_TBL(ING_No).Last_Send_Text.fileName = Send_Text.fileName           'ファイル名
        ID_KANRI_TBL(ING_No).Last_Send_Text.Buzzer = Send_Text.Buzzer               'ブザー指定
        
        For j = 0 To M_Gyo - 1
                                                                                    'BOX属性
            ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(j).Box_Type = Send_Text.Box_Type(j).Box_Type
                                                                                    '表示内容
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(j).LCD, StrConv(Send_Text.Box_Type(j).LCD, vbUnicode))
                                                                                    '初期内容
            ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(j).INIT = Send_Text.Box_Type(j).INIT
                                                                                    '開始カーソル位置
            ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(j).Start_Pos = Send_Text.Box_Type(j).Start_Pos
                                                                                    '入力桁数（最大）
            ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(j).Max_Size = Send_Text.Box_Type(j).Max_Size
                                                                                    'メニュー内容
            ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(j).MENU = Send_Text.Box_Type(j).MENU
                    
        
        Next j
    
    
        If Normal_End Then
            
'            MsgBox "システム異常が発生しました！！処理をしてください。"
 
            
'            Unload Me
        End If
    End If

    Exit Sub

ShowError:
    nErrCode = Err.Number
    strErrMsg = Err.Description         'エラーメッセージ
    
    intLine = CtrsWsk1.ErrLineNo        '接続番号を取得します。
    If intLine > 0 Then
        strErrMsg = strErrMsg & Chr(&HD) & Chr(&HA) & "接続番号 = " & intLine
    End If

    Text1(2).Text = strErrMsg           'ステータス行にエラーを表示します。
    
'    Call Log_Out(LOG_F, Format(ID_NO, "000") & ", Send=" & Sendbuf)


End Sub

Private Sub Form_Activate()
    
    Command1(0).Value = True            '2012.11.06
    Timer1.Enabled = True               '2012.11.06

End Sub

Private Sub Form_Load()
    
Dim c           As String * 128
Dim Out_Data    As String

Dim Box_Type    As String * 1
Dim LCD         As String * 10
Dim Keta        As String * 2

Dim i           As Integer
Dim j           As Integer
Dim k           As Integer
    
Dim sts         As Integer
    
Dim wkSHIMUKE   As Variant
    
Dim wkUNSOU_KAISHA  As Variant      '運送会社読み替え　2006.12.22
    
Dim SHIMEBI     As String * 2       '2012.03.06
Dim wkYY        As Integer          '2012.03.06
Dim wkMM        As Integer          '2012.03.06
    
Dim wkTH        As String * 4       '2012.11.06
    
    
    
    
    Normal_End = False
    
    If App.PrevInstance Then
        Beep
        MsgBox "同一プログラム実行中です。"
        End
    End If
'---------------------------------------------- 'ログファイル名取り込み
    If GetIni("FILE", "LOGF", "SYS", c) Then
        Beep
        MsgBox "ログファイル名の獲得に失敗しました。処理を中止します。"
        End
    End If
    LOG_F = RTrim(c)

'---------------------------------------------- 'データ受信ポート番号取り込み
    If GetIni(App.EXEName, "LocalPort", "SYS", c) Then
        Beep
        MsgBox "データ受信ポート番号の獲得に失敗しました。処理を中止します。"
        End
    End If
    LocalPort = CLng(RTrim(c))

'---------------------------------------------- 'データ送信ポート番号取り込み
    If GetIni(App.EXEName, "RemotePort", "SYS", c) Then
        Beep
        MsgBox "データ送信ポート番号の獲得に失敗しました。処理を中止します。"
        End
    End If
    RemotePort = CLng(RTrim(c))
'---------------------------------------------- '事業部取り込み
    If JGYOB_TB_Set(1) Then
        Beep
        MsgBox "事業部の獲得に失敗しました。処理を中止します。"
        End
    End If
'---------------------------------------------- '国内外情報取り込み
    i = 0
    
    Do
        i = i + 1
        If GetIni(App.EXEName, "NAIGAI_CODE" & Format(i, "0"), "SYS", c) Then
            Exit Do
        End If
        ReDim Preserve NAIGAI(i - 1)
        NAIGAI(i - 1).CODE = Trim(c)
        If GetIni(App.EXEName, "NAIGAI_NAME" & Format(i, "0"), "SYS", c) Then
            MsgBox "国内外の獲得に失敗しました。処理を中止します。"
            End
        End If
        NAIGAI(i - 1).NAME = Trim(c)
    
    Loop
    
    If i = 1 Then
        Beep
        MsgBox "国内外情報の獲得に失敗しました。処理を中止します。"
        End
    End If
'---------------------------------------------- 仕向け先獲得
    Erase SHIMUKE_TBL

    i = 0
    Do
        
        i = i + 1
    
        If GetIni(App.EXEName, "SHIMUKE" & Format(i, "00"), "SYS", c) Then
            Exit Do
        End If
        ReDim Preserve SHIMUKE_TBL(i - 1)
        wkSHIMUKE = Split(c, ",", -1)
        If UBound(wkSHIMUKE) < 2 Then
            MsgBox "仕向け先情報の獲得に失敗しました。処理を中止します。"
        End If
    
        SHIMUKE_TBL(i - 1).JGYOBU = wkSHIMUKE(0)
        SHIMUKE_TBL(i - 1).NAIGAI = wkSHIMUKE(1)
        SHIMUKE_TBL(i - 1).SHIMUKE_CODE = wkSHIMUKE(2)
    Loop
'---------------------------------------------- 前借り入荷情報獲得
    If GetIni("YOIN", "YOIN_MAEGARI", "SYS", c) Then
        Call LOG_OUT(LOG_F, "[SYS.INI] [YOIN] [YOIN_MAEGARI] READ ERROR")
        MsgBox "システム予約済要因の獲得に失敗しました。処理を中止して下さい。"
        End
    End If
    YOIN_MAEGARI = Trim(c)
'---------------------------------------------- '国内外振替情報獲得
    If GetIni("YOIN", "YOIN_FURIKAE", "SYS", c) Then
    Else
        YOIN_FURIKAE = RTrim(c)
        '国内外振替設定時、以下の項目必須
        If GetIni("YOIN", "YOIN_FURIKAE_OUT", "SYS", c) Then
            Beep
            MsgBox "国内外振替情報[YOIN_FURIKAE_OUT]の獲得に失敗しました。処理を中止します。"
            End
        End If
    
        YOIN_FURIKAE_OUT = RTrim(c)
    
        If GetIni("YOIN", "YOIN_FURIKAE_IN", "SYS", c) Then
            Beep
            MsgBox "国内外振替情報[YOIN_FURIKAE_IN]の獲得に失敗しました。処理を中止します。"
            End
        End If
    
        YOIN_FURIKAE_IN = RTrim(c)
    
    End If
'---------------------------------------------- 棚照合情報獲得
    If GetIni("YOIN", "YOIN_WEL_TANASHOGO", "SYS", c) Then
        Call LOG_OUT(LOG_F, "[SYS.INI] [YOIN] [YOIN_WEL_TANASHOGO] READ ERROR")
        MsgBox "システム予約済要因の獲得に失敗しました。処理を中止して下さい。"
        End
    End If
    YOIN_TANASHOGO = Trim(c)

'---------------------------------------------- 棚品照合情報獲得
    If GetIni("YOIN", "YOIN_WEL_TANAHINSHOGO", "SYS", c) Then
        YOIN_TANAHINSHOGO = Wel_TANA_HIN_SHOGO
    Else
        YOIN_TANAHINSHOGO = Trim(c)
    End If



'---------------------------------------------- 品番照合情報獲得    2011.02.03
    If GetIni("YOIN", "YOIN_WEL_HIN_SHOGO", "SYS", c) Then
        YOIN_HIN_SHOGO = Wel_HIN_SHOGO
    Else
        YOIN_HIN_SHOGO = Trim(c)
    End If


'---------------------------------------------- 入荷倉庫    2007.06.07
    If GetIni("SYSTEM", "KASO_NYUKA", "SYS", c) Then
        Beep
        MsgBox "入荷用仮想倉庫番号の獲得に失敗しました。処理を中止します。"
        End
    Else
        NYUKA_SOKO_NO = Trim(c)
    End If
'---------------------------------------------- 大東倉庫№    2007.06.07
    If GetIni(App.EXEName, "SOKO_NO", "SYS", c) Then
        DAITO_SOKO_NO = "S1"
    Else
        DAITO_SOKO_NO = Trim(c)
    End If
'---------------------------------------------- 資材振替要因    2007.06.28
    If GetIni(App.EXEName, "FURIKAE", "SYS", c) Then
'        Beep
'        MsgBox "入荷用仮想倉庫番号の獲得に失敗しました。処理を中止します。"
'        End
    
        Wel_FURIKAE = ""
    
    Else
        Wel_FURIKAE = Trim(c)
    End If


'---------------------------------------------- 品番振替＋要因  2011.06.01
    If GetIni(App.EXEName, "HINBAN_FURIKAE_PLUS", "SYS", c) Then
    
        Wel_HIN_FURIKAE_PLUS = ""
    
    Else
        Wel_HIN_FURIKAE_PLUS = Trim(c)
    End If




    If Trim(Wel_HIN_FURIKAE_PLUS) <> "" Then
    
    
    '---------------------------------------------- 品番振替－要因  2011.06.01
        If GetIni(App.EXEName, "HINBAN_FURIKAE_MAINA", "SYS", c) Then
            Beep
            MsgBox "品番振替　振替－要因の獲得に失敗しました[F110010][HINBAN_FURIKAE_MAINA=]。処理を中止します。"
            End
        Else
            Wel_HIN_FURIKAE_MAINA = Trim(c)
        End If
    '---------------------------------------------- 品番振替－の移動歴出力時の要因
        If GetIni(App.EXEName, "BEF_HINBAN", "SYS", c) Then
            Beep
            MsgBox "品番振替　振替－の移動歴出力要因の獲得に失敗しました[F110010][BEF_HINBAN=]。処理を中止します。"
            End
        Else
            YOIN_BEF_HINBAN = Trim(c)
        End If
    '---------------------------------------------- 品番振替＋の移動歴出力時の要因
        If GetIni(App.EXEName, "AFT_HINBAN", "SYS", c) Then
            Beep
            MsgBox "品番振替　振替＋移動歴出力要因の獲得に失敗しました[F110010][AFT_HINBAN=]。処理を中止します。"
            End
        Else
            YOIN_AFT_HINBAN = Trim(c)
        End If

    End If
'---------------------------------------------- 品番振替要因    2011.06.01





'---------------------------------------------- 資材消費要因    2007.10.02
    If GetIni(App.EXEName, "S_SHOUHI", "SYS", c) Then
        Wel_S_SHOUHI = ""
    
    Else
        Wel_S_SHOUHI = Trim(c)
    End If


'---------------------------------------------- '子機台数取り込み
    If GetIni(App.EXEName, "KO_SU", "SYS", c) Then
        Beep
        MsgBox "子機台数の獲得に失敗しました。処理を中止します。"
        End
    End If
    ReDim ID_KANRI_TBL(0 To CInt(RTrim(c)) - 1)

    For i = 0 To UBound(ID_KANRI_TBL)
        ID_KANRI_TBL(i).ID = 0          'IDNoクリアー
        ID_KANRI_TBL(i).Step = 0        '進捗クリアー
    
    Next i
'---------------------------------------------- '送信用パラメータ取り込み
    For i = 0 To UBound(WEL_Para_Tbl, 1)
        For j = 0 To UBound(WEL_Para_Tbl, 2)
            WEL_Para_Tbl(i, j).Action = ""
        Next j
    Next i
    
    i = 0
    Do
        i = i + 1
        
        
        If GetIni("ACTION", "ACTION_CD" & Format(i, "00"), "SYS", c) Then
            Beep
            MsgBox "WELCAT送信用パラーメータ([ACTION] [ACTION_CD])の獲得に失敗しました。処理を中止します。"
            End
        End If
        If Trim(c) = "NON" Then
            Exit Do
        End If
    
    
        j = 0
    
        Do
            j = j + 1
            If GetIni("ACTION", "ACTION_WEL_PARA" & Format(i, "00") & Format(j, "00"), "SYS", c) Then
                Beep
                MsgBox "WELCAT送信用パラーメータ([ACTION] [ACTION_WEL_PARA])の獲得に失敗しました。処理を中止します。"
                End
            End If
            If Trim(c) = "NON" Then
                Exit Do
            End If
        
            Call Data_Select(Trim(c), 1, 14, Out_Data)
            
            WEL_Para_Tbl(i - 1, j - 1).Action = Trim(Out_Data)
        
            Call Data_Select(Trim(c), 2, 14, Out_Data)
            
            WEL_Para_Tbl(i - 1, j - 1).Wel_Para(0).Box_Type = Trim(Out_Data)
            WEL_Para_Tbl(i - 1, j - 1).Wel_Para(0).LCD = ""
        
        
            k = 2
            Do
                
                k = k + 1
                
                If k > 14 Then
                    Exit Do
                End If
                
                Call Data_Select(Trim(c), k, 14, Out_Data)
                Box_Type = Trim(Out_Data)
                
                k = k + 1
                Call Data_Select(Trim(c), k, 14, Out_Data)
                LCD = Trim(Out_Data)
            
                k = k + 1
                Call Data_Select(Trim(c), k, 14, Out_Data)
                Keta = Trim(Out_Data)
            
                Select Case k
                    Case 5
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(1).Box_Type = Box_Type
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(1).LCD = LCD
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(1).Keta = CInt(Keta)
                    Case 8
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(2).Box_Type = Box_Type
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(2).LCD = LCD
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(2).Keta = CInt(Keta)
                    Case 11
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(3).Box_Type = Box_Type
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(3).LCD = LCD
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(3).Keta = CInt(Keta)
                    Case 14
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(4).Box_Type = Box_Type
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(4).LCD = LCD
                        WEL_Para_Tbl(i - 1, j - 1).Wel_Para(4).Keta = CInt(Keta)
                
                End Select
            
            Loop
            
        
        Loop
    Loop
'---------------------------------------------- '対WELCAT　送受信ログファイル取り込み
    
    If GetIni(App.EXEName, "LOG_F", "SYS", c) Then
        CtrsWsk1.LogFile = ""
    Else
        CtrsWsk1.LogFile = Trim(c)
    End If
'---------------------------------------------- '対WELCAT　データ送信用フォルダ取り込み
    If GetIni(App.EXEName, "SendFolder", "SYS", c) Then
        Beep
        MsgBox "WELCAT送信用フォルダ([F110010] [SendFolder])の獲得に失敗しました。処理を中止します。"
        End
    Else
        CtrsWsk1.SendFolder = Trim(c)
    End If
'---------------------------------------------- '対WELCAT　棚番表示用データファイル名取り込み
    If GetIni(App.EXEName, "B1", "SYS", c) Then
        Beep
        MsgBox "WELCAT送信用ファイル([F110010] [B1])の獲得に失敗しました。処理を中止します。"
        End
    Else
        B1_SendFile = Trim(c)
    End If
'---------------------------------------------- '対WELCAT　出庫履歴用データファイル名取り込み
    If GetIni(App.EXEName, "B6", "SYS", c) Then
        Beep
        MsgBox "WELCAT送信用ファイル([F110010] [B6])の獲得に失敗しました。処理を中止します。"
        End
    Else
        B6_SendFile = Trim(c)
    End If
'---------------------------------------------- '対WELCAT　出荷推移用データファイル名取り込み
    If GetIni(App.EXEName, "B7", "SYS", c) Then
        Beep
        MsgBox "WELCAT送信用ファイル([F110010] [B7])の獲得に失敗しました。処理を中止します。"
        End
    Else
        B7_SendFile = Trim(c)
    End If
'---------------------------------------------- '対WELCAT　棚番表示(仮想優先)用データファイル名取り込み
    If GetIni(App.EXEName, "B9", "SYS", c) Then
        Beep
        MsgBox "WELCAT送信用ファイル([F110010] [B9])の獲得に失敗しました。処理を中止します。"
        End
    Else
        B9_SendFile = Trim(c)
    End If
'---------------------------------------------- '対WELCAT　構成表示用データファイル名取り込み
    If GetIni(App.EXEName, "BA", "SYS", c) Then
        Beep
        MsgBox "WELCAT送信用ファイル([F110010] [BA])の獲得に失敗しました。処理を中止します。"
        End
    Else
        BA_SendFile = Trim(c)
    End If
'---------------------------------------------- '対WELCAT　検品履歴データファイル名取り込み
    If GetIni(App.EXEName, "BB", "SYS", c) Then
        Beep
        MsgBox "WELCAT送信用ファイル([F110010] [BB])の獲得に失敗しました。処理を中止します。"
        End
    Else
        BB_SendFile = Trim(c)
    End If



'---------------------------------------------- '対WELCAT　当日出庫履歴データファイル名取り込み 2009.01.09
    If GetIni(App.EXEName, "BD", "SYS", c) Then
        BD_SendFile = ""
    Else
        BD_SendFile = Trim(c)
    End If


'---------------------------------------------- '対WELCAT　集約梱包残データファイル名取り込み 2010.02.15
    If GetIni(App.EXEName, "BF", "SYS", c) Then
        BF_SendFile = ""
    Else
        BF_SendFile = Trim(c)
    End If


'---------------------------------------------- '対WELCAT　空き棚検索データファイル名取り込み 2010.12.13
    If GetIni(App.EXEName, "BG", "SYS", c) Then
        BG_SendFile = ""
    Else
        BG_SendFile = Trim(c)
    End If


'---------------------------------------------- '対WELCAT　大阪検品データファイル名取り込み 2010.01.21
    If GetIni(App.EXEName, "F0", "SYS", c) Then
        F0_SendFile = ""
    Else
        F0_SendFile = Trim(c)
    End If



'---------------------------------------------- '対WELCAT　ﾗﾍﾞﾙ発行用データファイル名取り込み 2011.03.05
    If GetIni(App.EXEName, "EF", "SYS", c) Then
        EF_SendFile = ""
    Else
        EF_SendFile = Trim(c)
    End If


'---------------------------------------------- '出荷ログファイル名取り込み 2007.11.02
    If SYUKA_LOGF_GET_PROC() Then
        Beep
        MsgBox "出荷ログファイル名の獲得に失敗しました。処理を中止して下さい。"
        End
    End If

'---------------------------------------------- '共通メニュー情報取り込み
    If GetIni(App.EXEName, "ALL_MENU_GRP", "SYS", c) Then
        Beep
        MsgBox "共通メニュー情報の獲得に失敗しました。処理を中止します。"
        End
    End If


    ALL_MENU_GRP = Trim(c)

'---------------------------------------------- '検品チェック
    If GetIni(App.EXEName, "Inspection", "SYS", c) Then
        Inspection_Flg = 0
    Else
        If Not IsNumeric(Trim(c)) Then
            Inspection_Flg = 1
        Else
            Inspection_Flg = CInt(Trim(c))
        End If
    End If
'---------------------------------------------- '検品数表示 2007.05.15
    If GetIni(App.EXEName, "Inspection_QTY", "SYS", c) Then
        Inspection_QTY = 0
    Else
        If Not IsNumeric(Trim(c)) Then
            Inspection_QTY = 0
        Else
            Inspection_QTY = CInt(Trim(c))
        End If
    End If

'---------------------------------------------- '出庫数入力　必須有無 2007.08.02
    If GetIni(App.EXEName, "SYUKO_QTY", "SYS", c) Then
        SYUKO_QTY = 0
    Else
        If Not IsNumeric(Trim(c)) Then
            SYUKO_QTY = 0
        Else
            SYUKO_QTY = CInt(Trim(c))
        End If
    End If


'---------------------------------------------- '再検品チェック 2007.10.10
    If GetIni(App.EXEName, "Inspection_CHK", "SYS", c) Then
        Inspection_CHK = 0
    Else
        If Not IsNumeric(Trim(c)) Then
            Inspection_CHK = 0
        Else
            Inspection_CHK = CInt(Trim(c))
        End If
    End If

'---------------------------------------------- '在庫照合メモ項目
    If GetIni(App.EXEName, "B2_MEMO", "SYS", c) Then
        B2_MEMO = ""
    Else
        B2_MEMO = Trim(c)
    End If
'--
    If GetIni(App.EXEName, "B8_MEMO", "SYS", c) Then
        B8_MEMO = ""
    Else
        B8_MEMO = Trim(c)
    End If
'---------------------------------------------- 'ファイルリトライ回数取り込み
    If GetIni("SYSTEM", "RETRY", "SYS", c) Then
        FILE_RETRY = 1
    Else
        If Not IsNumeric(Trim(c)) Then
            FILE_RETRY = 1
        Else
            FILE_RETRY = CInt(Trim(c))
        End If
    End If


'---------------------------------------------- '大阪ＰＣ運送会社読み替え用 2006.12.22
'    If GetIni(App.EXEName, "UNSOU_KAISHA", "SYS", c) Then
'        UNSOU_KAISHA_CODE = ""
'        UNSOU_KAISHA_NAME = ""
'    Else
'        wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
'
'        If UBound(wkUNSOU_KAISHA) > 0 Then
'
'            UNSOU_KAISHA_CODE = wkUNSOU_KAISHA(0)
'            UNSOU_KAISHA_NAME = wkUNSOU_KAISHA(1)
'
'        Else
'            UNSOU_KAISHA_CODE = ""
'            UNSOU_KAISHA_NAME = ""
'        End If
'    End If
'
'
'---------------------------------------------- '大阪ＰＣ（新）運送会社読み替え用 2007.01.09
'
''久留米
'    KURUME_F = False
'    If GetIni(App.EXEName, "KURUME", "SYS", c) Then
'    Else
'        wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
'        For i = 0 To UBound(wkUNSOU_KAISHA)
'            ReDim Preserve KURUME(0 To i)
'            KURUME(i) = Trim(wkUNSOU_KAISHA(i))
'            KURUME_F = True
'
'        Next i
'    End If
'
''    If UBound(KURUME) > 0 Then
''        KURUME_F = True
''    End If
''福山
'    FUKUYAMA_F = False
'    If GetIni(App.EXEName, "FUKUYAMA", "SYS", c) Then
'    Else
'        wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
'        For i = 0 To UBound(wkUNSOU_KAISHA)
'            ReDim Preserve FUKUYAMA(0 To i)
'            FUKUYAMA(i) = Trim(wkUNSOU_KAISHA(i))
'            FUKUYAMA_F = True
'        Next i
'    End If
''    If UBound(FUKUYAMA) > 0 Then
''        FUKUYAMA_F = True
''    End If
''佐川
'    SAGAWA_F = False
'    If GetIni(App.EXEName, "SAGAWA", "SYS", c) Then
'    Else
'        wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
'        For i = 0 To UBound(wkUNSOU_KAISHA)
'            ReDim Preserve SAGAWA(0 To i)
'            SAGAWA(i) = Trim(wkUNSOU_KAISHA(i))
'            SAGAWA_F = True
'        Next i
'    End If
'
''    If UBound(SAGAWA) > 0 Then
''        SAGAWA_F = True
''    End If





'福山
    If GetIni("FUKUYAMA", "length", "UNSOU", c) Then
        FUKUYAMA_Name = ""
        FUKUYAMA_Length = 0
        ReDim Preserve FUKUYAMA_CODE(0 To 0)
        FUKUYAMA_CODE(0) = "*"
    Else
        FUKUYAMA_Length = Val(Trim(c))
        
        If GetIni("FUKUYAMA", "Name", "UNSOU", c) Then
            FUKUYAMA_Name = ""
        Else
            FUKUYAMA_Name = Trim(c)
        End If
        
        If GetIni("FUKUYAMA", "Code", "UNSOU", c) Then
            ReDim Preserve FUKUYAMA_CODE(0 To 0)
            FUKUYAMA_CODE(0) = "*"
        Else
            wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
        
            For i = 0 To UBound(wkUNSOU_KAISHA)
                ReDim Preserve FUKUYAMA_CODE(0 To i)
                FUKUYAMA_CODE(i) = wkUNSOU_KAISHA(i)
            Next i
        
        End If
    End If



'西武
    If GetIni("SEIBU", "length", "UNSOU", c) Then
        SEIBU_Name = ""
        SEIBU_Length = 0
        ReDim Preserve SEIBU_CODE(0 To 0)
        SEIBU_CODE(0) = "*"
    Else
        SEIBU_Length = Val(Trim(c))
        
        If GetIni("SEIBU", "Name", "UNSOU", c) Then
            SEIBU_Name = ""
        Else
            SEIBU_Name = Trim(c)
        End If
        
        If GetIni("SEIBU", "Code", "UNSOU", c) Then
            ReDim Preserve SEIBU_CODE(0 To 0)
            SEIBU_CODE(0) = "*"
        Else
            wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
        
            For i = 0 To UBound(wkUNSOU_KAISHA)
                ReDim Preserve SEIBU_CODE(0 To i)
                SEIBU_CODE(i) = wkUNSOU_KAISHA(i)
            Next i
        
        End If
    End If


'久留米
    If GetIni("KURUME", "length", "UNSOU", c) Then
        KURUME_Name = ""
        KURUME_Length = 0
        ReDim Preserve KURUME_CODE(0 To 0)
        KURUME_CODE(0) = "*"
    Else
        KURUME_Length = Val(Trim(c))
        
        If GetIni("KURUME", "Name", "UNSOU", c) Then
            KURUME_Name = ""
        Else
            KURUME_Name = Trim(c)
        End If
        
        If GetIni("KURUME", "Code", "UNSOU", c) Then
            ReDim Preserve KURUME_CODE(0 To 0)
            KURUME_CODE(0) = "*"
        Else
            wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
        
            For i = 0 To UBound(wkUNSOU_KAISHA)
                ReDim Preserve KURUME_CODE(0 To i)
                KURUME_CODE(i) = wkUNSOU_KAISHA(i)
            Next i
        
        End If
    End If


'佐川
    If GetIni("SAGAWA", "length", "UNSOU", c) Then
        SAGAWA_Name = ""
        SAGAWA_Length = 0
        ReDim Preserve SAGAWA_CODE(0 To 0)
        SAGAWA_CODE(0) = "*"
    Else
        SAGAWA_Length = Val(Trim(c))
        
        If GetIni("SAGAWA", "Name", "UNSOU", c) Then
            SAGAWA_Name = ""
        Else
            SAGAWA_Name = Trim(c)
        End If
        
        If GetIni("SAGAWA", "Code", "UNSOU", c) Then
            ReDim Preserve SEIBU_CODE(0 To 0)
            SAGAWA_CODE(0) = "*"
        Else
            wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
        
            For i = 0 To UBound(wkUNSOU_KAISHA)
                ReDim Preserve SAGAWA_CODE(0 To i)
                SAGAWA_CODE(i) = wkUNSOU_KAISHA(i)
            Next i
        
        End If
    End If

'ヤマト
    If GetIni("YAMATO", "length", "UNSOU", c) Then
        YAMATO_Name = ""
        YAMATO_Length = 0
        ReDim Preserve YAMATO_CODE(0 To 0)
        YAMATO_CODE(0) = "*"
    Else
        YAMATO_Length = Val(Trim(c))
        
        If GetIni("YAMATO", "Name", "UNSOU", c) Then
            YAMATO_Name = ""
        Else
            YAMATO_Name = Trim(c)
        End If
        
        If GetIni("YAMATO", "Code", "UNSOU", c) Then
            ReDim Preserve YAMATO_CODE(0 To 0)
            YAMATO_CODE(0) = "*"
        Else
            wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
        
            For i = 0 To UBound(wkUNSOU_KAISHA)
                ReDim Preserve YAMATO_CODE(0 To i)
                YAMATO_CODE(i) = wkUNSOU_KAISHA(i)
            Next i
        
        End If
    End If
'ﾊﾟﾅﾎｰﾑ 2011.06.06
    If GetIni("PANAHOME", "length", "UNSOU", c) Then
        PANA_Name = ""
        PANA_Length = 0
        ReDim Preserve PANA_CODE(0 To 0)
        PANA_CODE(0) = "*"
    Else
        PANA_Length = Val(Trim(c))
        
        If GetIni("PANAHOME", "Name", "UNSOU", c) Then
            PANA_Name = ""
        Else
            PANA_Name = Trim(c)
        End If
        
        If GetIni("PANAHOME", "Code", "UNSOU", c) Then
            ReDim Preserve PANA_CODE(0 To 0)
            PANA_CODE(0) = "*"
        Else
            wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
        
            For i = 0 To UBound(wkUNSOU_KAISHA)
                ReDim Preserve PANA_CODE(0 To i)
                PANA_CODE(i) = wkUNSOU_KAISHA(i)
            Next i
        
        End If
    End If
'積水 2011.06.06
    If GetIni("SEKISUI", "length", "UNSOU", c) Then
        SEKISUI_Name = ""
        SEKISUI_Length = 0
        ReDim Preserve SEKISUI_CODE(0 To 0)
        SEKISUI_CODE(0) = "*"
    Else
        SEKISUI_Length = Val(Trim(c))
        
        If GetIni("SEKISUI", "Name", "UNSOU", c) Then
            SEKISUI_Name = ""
        Else
            SEKISUI_Name = Trim(c)
        End If
        
        If GetIni("SEKISUI", "Code", "UNSOU", c) Then
            ReDim Preserve SEKISUI_CODE(0 To 0)
            SEKISUI_CODE(0) = "*"
        Else
            wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
        
            For i = 0 To UBound(wkUNSOU_KAISHA)
                ReDim Preserve SEKISUI_CODE(0 To i)
                SEKISUI_CODE(i) = wkUNSOU_KAISHA(i)
            Next i
        
        End If
    End If





'---------------------------------------------- 'チャーター便ｺｰﾄﾞ   2010.01.21
    If GetIni("CHARTER", "Code", "UNSOU", c) Then
        KEN_CHARTER_CD = "*"
    Else
        
        wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
    
        KEN_CHARTER_CD = wkUNSOU_KAISHA(0)
        
        If GetIni("CHARTER", "Name", "UNSOU", c) Then
            KEN_CHARTER_NM = ""
        Else
            KEN_CHARTER_NM = Trim(c)
        End If
    End If
'---------------------------------------------- '赤帽便ｺｰﾄﾞ   2010.01.21
    If GetIni("AKABOU", "Code", "UNSOU", c) Then
        KEN_AKABOU_CD = "*"
    Else
        wkUNSOU_KAISHA = Split(Trim(c), ",", -1)
    
        KEN_AKABOU_CD = wkUNSOU_KAISHA(0)
    
    
        If GetIni("AKABOU", "Name", "UNSOU", c) Then
            KEN_AKABOU_NM = ""
        Else
            KEN_AKABOU_NM = Trim(c)
        End If
    
    
    End If

'---------------------------------------------- 'ロジステックｺｰﾄﾞ   2010.01.21
    If GetIni(App.EXEName, "KEN_LOGISTIC", "SYS", c) Then
        KEN_LOGISTIC_CD = "*"
    Else
        KEN_LOGISTIC_CD = Trim(c)
    End If






'---------------------------------------------- '事業部読み替え有無 2008.07.24
    If GetIni(App.EXEName, "JGYOBU_YOMIKAE", "SYS", c) Then
        JGYOBU_YOMIKAE_F = False
    Else
        JGYOBU_YOMIKAE_F = True
    
        JGYOBU_YOMIKAE_T = Split(Trim(c), ",", -1)
    
    End If

'---------------------------------------------- '担当者照合 2008.08.08
    If GetIni(App.EXEName, "TANTO_REF", "SYS", c) Then
        TANTO_REF = ""
    Else
        TANTO_REF = Trim(c)
    End If
'---------------------------------------------- 'メニュー終了 2008.08.08
    If GetIni(App.EXEName, "MENU_FIN", "SYS", c) Then
        MENU_FIN = ""
    Else
        MENU_FIN = Trim(c)
    End If


'---------------------------------------------- 'ｷｬﾝｾﾙ時の動作 2008.09.01
    
    
    CANCEL_OPE = True
    If GetIni(App.EXEName, "CANCEL_OPE", "SYS", c) Then
    Else
        
        If Trim(c) = "1" Then
            CANCEL_OPE = False
        End If
    End If

'---------------------------------------------- '在庫精査の要因 2008.11.20
    ZAIKO_SEISA_PURA = "11"
    
    If GetIni(App.EXEName, "ZAIKO_SEISA_PURA", "SYS", c) Then
    Else
        ZAIKO_SEISA_PURA = Trim(c)
    End If


    ZAIKO_SEISA_MAINA = "21"
    
    If GetIni(App.EXEName, "ZAIKO_SEISA_MAINA", "SYS", c) Then
    Else
        ZAIKO_SEISA_MAINA = Trim(c)
    End If



'---------------------------------------------- '出荷検品時のBUZZER音 2009.07.27
    If GetIni(App.EXEName, "Inspe_BUZZER", "SYS", c) Then
    
        Wel_Inspe_BUZZER = Buzzer_DEF
    Else
        Wel_Inspe_BUZZER = Trim(c)
        
    End If


'---------------------------------------------- '出荷検品時のBUZZER音 2009.07.27
    If GetIni(App.EXEName, "SYUKA_BUZZER", "SYS", c) Then
    
        Wel_SYUKA_BUZZER = Buzzer_DEF
    Else
        Wel_SYUKA_BUZZER = Trim(c)
        
    End If


'---------------------------------------------- '口数入力可／不可 2010.02.17
    If GetIni(App.EXEName, "Inspection_Input", "SYS", c) Then
    
        Inspection_Input = False
    Else
        
        
        If Trim(c) = "1" Then
            Inspection_Input = True
        Else
            Inspection_Input = False
        End If
        
    End If


'---------------------------------------------- '廃棄用向け先 2010.02.22
    HAIKI_MTS_F = False
    If GetIni(App.EXEName, "HAIKI_MTS", "SYS", c) Then
    
    Else
        
        HAIKI_MTS = Split(Trim(c), ",", -1)
        HAIKI_MTS_F = True
        
    End If







'---------------------------------------------- '異常対処 2011.04.02
    If GetIni(App.EXEName, "RECOVER_F", "SYS", c) Then
        RECOVER_F = False
    Else
        If Trim(c) = "1" Then
            RECOVER_F = True
        Else
            RECOVER_F = False
        End If
    End If


'---------------------------------------------- '構成チェック用種別 2011.04.18
    If GetIni(App.EXEName, "kousei_check", "SYS", c) Then
        Kousei_check_F = False
    Else
    
        Kousei_check_Tb = Split(Trim(c), ",", -1)
        Kousei_check_F = True
    
    
    End If


'---------------------------------------------- '大阪　積水向け処理 2011.05.27
    
    '集合梱包済み
    If GetIni(App.EXEName, "SEK_KONPO_F", "SYS", c) Then
        SEK_KONPO_F = False
    Else
        If Trim(c) = "1" Then
            SEK_KONPO_F = True
        Else
            SEK_KONPO_F = False
        End If
    End If

    '照合済み
    If GetIni(App.EXEName, "SEK_KEN_SHOGO_F", "SYS", c) Then
        SEK_KEN_SHOGO_F = False
    Else
        If Trim(c) = "1" Then
            SEK_KEN_SHOGO_F = True
        Else
            SEK_KEN_SHOGO_F = False
        End If
    End If

    '梱包済み
    If GetIni(App.EXEName, "SEK_KEN_KONPO_F", "SYS", c) Then
        SEK_KEN_KONPO_F = False
    Else
        If Trim(c) = "1" Then
            SEK_KEN_KONPO_F = True
        Else
            SEK_KEN_KONPO_F = False
        End If
    End If


    '検品済み
    If GetIni(App.EXEName, "SEK_KEN_KENPIN_F", "SYS", c) Then
        SEK_KEN_KENPIN_F = True
    Else
        If Trim(c) = "1" Then
            SEK_KEN_KENPIN_F = False
        Else
            SEK_KEN_KENPIN_F = True
        End If
    End If


    '検品時ﾗﾍﾞﾙ開始ﾍﾟｰｼﾞ
    If GetIni(App.EXEName, "SEK_LABEL_PAGE", "SYS", c) Then
        SEK_LABEL_PAGE = 0
    Else
        If IsNumeric(Trim(c)) Then
            SEK_LABEL_PAGE = Val(Trim(c))
        Else
            SEK_LABEL_PAGE = 0
        End If
    End If


'---------------------------------------------- '大阪　積水向け処理 2011.05.27

'---------------------------------------------- '大阪　積水向け移動出庫要因 2011.06.15
    If GetIni(App.EXEName, "SEK_IDO_SYUKO", "SYS", c) Then
        WEL_SEK_IDO_SYUKO = "**"
    Else
        WEL_SEK_IDO_SYUKO = Trim(c)
    End If
'---------------------------------------------- '大阪　積水向け移動出庫要因 2011.06.15





'---------------------------------------------- '月平均／生産計画用 2011.07.05
    If GetIni("F120050", "TUKI1", "F120050", c) Then
        TUKI1 = 3
    Else
        If IsNumeric(Trim(c)) Then
            TUKI1 = Val(Trim(c))
        Else
            TUKI1 = 3
        End If
    End If

    If GetIni("F120050", "TUKI2", "F120050", c) Then
        TUKI2 = 3
    Else
        If IsNumeric(Trim(c)) Then
            TUKI2 = Val(Trim(c))
        Else
            TUKI2 = 3
        End If
    End If
'---------------------------------------------- '大阪PC 部材関係 2012.03.06
    If GetIni("F110010", "SHIMEBI", "SYS", c) Then
        SHIMEBI = "25"
    Else
        If IsNumeric(Trim(c)) Then
            SHIMEBI = Trim(c)
        Else
            SHIMEBI = "25"
        End If
    End If

    '開始日
    If Mid(Format(Date, "YYYYMMDD"), 7, 2) > SHIMEBI Then
        BUZAI_DATE_S = Mid(Format(Date, "YYYYMMDD"), 1, 6) & Format(Val(SHIMEBI) + 1, "00")
    Else
        wkYY = Val(Mid(Format(Date, "YYYYMMDD"), 1, 4))
        wkMM = Val(Mid(Format(Date, "YYYYMMDD"), 5, 2)) - 1
        If wkMM < 1 Then
            wkYY = Val(Mid(Format(Date, "YYYYMMDD"), 1, 4)) - 1
            wkMM = 12
        End If
        BUZAI_DATE_S = Format(wkYY, "0000") & Format(wkMM, "00") & Format(Val(SHIMEBI) + 1, "00")
    End If
    '終了日
    If Mid(Format(Date, "YYYYMMDD"), 7, 2) <= SHIMEBI Then
        BUZAI_DATE_E = Mid(Format(Date, "YYYYMMDD"), 1, 6) & SHIMEBI
    Else
        wkYY = Val(Mid(Format(Date, "YYYYMMDD"), 1, 4))
        wkMM = Val(Mid(Format(Date, "YYYYMMDD"), 5, 2)) + 1
        If wkMM > 12 Then
            wkYY = Val(Mid(Format(Date, "YYYYMMDD"), 1, 4)) + 1
            wkMM = 1
        End If
        BUZAI_DATE_E = Format(wkYY, "0000") & Format(wkMM, "00") & Format(Val(SHIMEBI) + 1, "00")
    End If
    '使用月
    USE_YM = Mid(BUZAI_DATE_E, 1, 6)


    '検収～棚入れの要因
    If GetIni("F110010", "IN_TANA_S_OSAKA", "SYS", c) Then
        c = "25"
        IN_TANA_S_OSAKA = Split(Trim(c), ",", -1)
    Else
        IN_TANA_S_OSAKA = Split(Trim(c), ",", -1)
    End If



    '出庫処理
    If GetIni("F110010", "IDO_OUT_OSAKA", "SYS", c) Then
        MsgBox "大阪ＰＣ　部材出庫処理の要因を登録してください SYS.INI [F110010] IDO_OUT_OSAKA="
        Unload Me
    Else
        Wel_IDO_OUT_OSAKA = Trim(c)
    End If


    '振替出庫／入庫
    If GetIni("F110010", "HIN_FURIKA_S", "SYS", c) Then
        MsgBox "大阪ＰＣ　部材振替出庫処理の要因を登録してください SYS.INI [F110010] HIN_FURIKA_S="
        Unload Me
    Else
        Wel_HIN_FURIKA_S = Trim(c)
    End If

    '振替出庫
    If GetIni("F110010", "BEF_HINBAN_S", "SYS", c) Then
        MsgBox "大阪ＰＣ　部材振替出庫処理の要因を登録してください SYS.INI [F110010] BEF_HINBAN_S="
        Unload Me
    Else
        YOIN_BEF_HINBAN_S = Trim(c)
    End If
    
    '振替入庫
    If GetIni("F110010", "AFT_HINBAN_S", "SYS", c) Then
        MsgBox "大阪ＰＣ　部材振替入庫処理の要因を登録してください SYS.INI [F110010] AFT_HINBAN_S="
        Unload Me
    Else
        YOIN_AFT_HINBAN_S = Trim(c)
    End If

    '振替出庫／入庫
    If GetIni("F110010", "IDO_IN_OSAKA", "SYS", c) Then
        MsgBox "大阪ＰＣ　部材振替入庫処理の要因処理の要因を登録してください SYS.INI [F110010] IDO_IN_OSAKA="
        Unload Me
    Else
        Wel_IDO_IN_OSAKA = Trim(c)
    End If


    '構成チェック       2012.03.16
    If GetIni("F110010", "COMPO_OSAKA_CHECK", "SYS", c) Then
        MsgBox "大阪ＰＣ　部材構成チェック処理の要因を登録してください SYS.INI [F110010] COMPO_OSAKA_CHECK="
        Unload Me
    Else
        Wel_COMPO_OSAKA_CHECK = Trim(c)
    End If


    '検品               2012.03.18
    If GetIni("F110010", "KENPIN_OSAKA", "SYS", c) Then
        MsgBox "大阪ＰＣ　検品処理の要因を登録してください SYS.INI [F110010] KENPIN_OSAKA="
        Unload Me
    Else
        Wel_KENPIN_OSAKA = Trim(c)
    End If
    '検品時引落倉庫     2012.03.18
    If GetIni("F110010", "KENPIN_SOKO", "SYS", c) Then
        MsgBox "大阪ＰＣ　検品処理時引落倉庫を登録してください SYS.INI [F110010] KENPIN_SOKO="
        Unload Me
    Else
        KENPIN_OSAKA_SOKO_No = Trim(c)
    End If
    
    '対WELCAT　ﾗﾍﾞﾙ発行用データファイル名取り込み
    If GetIni(App.EXEName, "88", "SYS", c) Then
        LABEL_88_SendFile = ""
    Else
        LABEL_88_SendFile = Trim(c)
    End If

'---------------------------------------------- '大阪PC 部材関係 2012.03.06


'---------------------------------------------- '開始／終了 2012.11.06
    If GetIni("F110010", "STARTTIME", "SYS", c) Then
        wkTH = ""
    Else
        wkTH = Trim(c)
        If Not IsNumeric(wkTH) Then
            wkTH = ""
        End If
    End If
    Text2(2) = Mid(wkTH, 1, 2)
    Text2(3) = Mid(wkTH, 3, 2)


    If GetIni("F110010", "ENDTIME", "SYS", c) Then
        wkTH = ""
    Else
        wkTH = Trim(c)
        If Not IsNumeric(wkTH) Then
            wkTH = ""
        End If
    End If
    Text2(0) = Mid(wkTH, 1, 2)
    Text2(1) = Mid(wkTH, 3, 2)




'---------------------------------------------- '開始／終了 2012.11.06


'---------------------------------------------- '受信タイムアウト   2014.01.04
    If GetIni("F110010", "WAIT_TIME", "SYS", c) Then
        WAIT_TIME = 300
    Else
        If Not IsNumeric(Trim(c)) Then
            WAIT_TIME = 300
        Else
            WAIT_TIME = Val(c)
        End If
    End If
'---------------------------------------------- '倉庫マスタＯＰＥＮ
    If SOKO_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If


'---------------------------------------------- '棚マスタＯＰＥＮ
    If TANA_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '品目マスタＯＰＥＮ
    If ITEM_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '品目マスタ(ワーク)ＯＰＥＮ
    If wITEM_Open(BtOpenNomal) Then
        Unload Me
    End If
'---------------------------------------------- '品目振替マスタＯＰＥＮ 2011.06.01
    If FURIKAE_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '担当者マスタＯＰＥＮ
    If TANTO_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '要因マスタＯＰＥＮ
    If YOIN_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '向け先管理マスタＯＰＥＮ
    If MTS_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- 'メニュー管理マスタＯＰＥＮ
    If P_MENU_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '構成マスタＯＰＥＮ
    If P_COMPO_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- 'コードマスタＯＰＥＮ
    If P_CODE_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '発番マスタＯＰＥＮ
    If HATUBAN_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '担当者別メニューＯＰＥＮ
    If P_TMENU_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '在庫データＯＰＥＮ
    If ZAIKO_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '在庫データ（移動処理用）ＯＰＥＮ
    If wZAIKO_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '在庫データ（商品／未商品切り替え用）ＯＰＥＮ
    If tmpZAIKO_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '前借データＯＰＥＮ
    If J_NYU_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '出荷予定データＯＰＥＮ
    If Y_SYU_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If


''    sts = BTRV(BtOpGetFirst, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K8_Y_SYU, Len(K8_Y_SYU), 8)
''    Select Case sts
''        Case BtNoErr
''        Case BtErrIvldKey
''
''            If Y_SYU_Create_Index() Then
''                Normal_End = True
''                Unload Me
''            End If
''
''        Case Else
''            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
''            Normal_End = True
''            Unload Me
''    End Select



'---------------------------------------------- '出荷予定データＯＰＥＮ
    If DEL_SYU_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '在庫移動歴データＯＰＥＮ
    If IDO_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '在庫集計データＯＰＥＮ
    If SUMZ_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '月平均出荷数ＯＰＥＮ
    If AVE_SYUKA_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '資材前借ﾃﾞｰﾀＯＰＥＮ
    If P_NYU_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '作業実績ﾛｸﾞＯＰＥＮ
    If P_SAGYO_LOG_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)ＯＰＥＮ 2006.12.07
    If Y_SYU_H_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '入荷予定(大阪PC向け)ＯＰＥＮ 2007.06.07
    If Y_NYU_O_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If

'---------------------------------------------- '管理マスタＯＰＥＮ 2007.06.28
    If P_KANRI_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '資材注文ﾃﾞｰﾀＯＰＥＮ 2007.06.28
    If P_SHORDER_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '受払先ﾏｽﾀＯＰＥＮ 2007.06.28
    If P_UKEHARAI_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If
'---------------------------------------------- '資材受入履歴ＯＰＥＮ 2007.06.28
    If P_SHUKEIRE_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If

'---------------------------------------------- '指図票データ（親）ＯＰＥＮ 2010.09.03
    If P_SSHIJI_O_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If


'---------------------------------------------- '指図票データ（子）ＯＰＥＮ 2011.03.02
    If P_SSHIJI_K_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If


'---------------------------------------------- '邸別注文データＯＰＥＮ 2011.04.25
    If Y_SYU_TEI_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If

'---------------------------------------------- '発注検討：親品番注文データＯＰＥＮ 2012.03.18
    If ODR_ORDER_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If

'---------------------------------------------- '商品化指図受入履歴データＯＰＥＮ 2012.03.18
    If P_SUKEIRE_Open(BtOpenNomal) Then
        Normal_End = True
        Unload Me
    End If


'---------------------------------------------- 'メニュー機能チェック（個別 or 共通）
'    Call UniCode_Conv(K0_TMENU.TANTO_CODE, ALL_TANTO_CODE)
'    sts = BTRV(BtOpGetEqual, TMENU_POS, TMENUREC, Len(TMENUREC), K0_TMENU, Len(K0_TMENU), 0)
'    Select Case sts
'        Case BtNoErr
'            Menu_Type = 1           '共通メニューで運用
'        Case BtErrKeyNotFound
            Menu_Type = 2           '担当者別メニューで運用
'        Case Else
'            Call File_Error(sts, BtOpGetEqual, "担当者別メニュー")
'            Unload Me
'    End Select
    
    
'    ST_LOG_OUT_F = True '2008.08.08

    
    F1100101.Caption = F1100101.Caption & " " & LAST_UPDATE_DAY
    
    F1100101.Height = 4050              '2012.10.02
    F1100101.Width = 6720               '2012.10.02
    
        
    
    
    Show

    If Data_Clear_Proc(1, "") Then
        MsgBox "データ初期設定が出来ませんでした。"
        Unload Me
    End If


    If tmpZaiko_Clear_Proc() Then
        MsgBox "データ初期設定が出来ませんでした。"
        Unload Me
    End If


    
'    Command1(0).Value = True                '2012.05.18

'    Timer1.Enabled = True                   '2012.05.18

End Sub

Private Sub Start_Proc(Sendbuf As String)
'-------------------------------------------------------
'
'   『子機開始処理』
'
'-------------------------------------------------------
Dim i   As Integer
                                                '送信テキスト作成＆管理テーブルに転送
    ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ                      '担当者要求
    '---------------------------------------------------------------
    Send_Text.sts = Sts_OK                                          'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_DEF                             '表示画面フラグ 通常入力
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
    Send_Text.End_Menu = ""                                         '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = ""
    
    Send_Text.Menu_Suu = "05"                                       'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
    Send_Text.fileName = ""                                         '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
    
    Send_Text.Buzzer = Buzzer_DEF                                   'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
    
    
    
    '---------------------------------------------------------------
    Send_Text.Box_Type(0).Box_Type = TYPE_REF                       'ボックス属性　表示ＢＯＸ
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
    
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "担当者入力")      '表示メッセージ
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "担当者入力")
                                                                    '初期表示内容（数値）
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
    
    
    Send_Text.Box_Type(0).Start_Pos = ""                            'カーソル位置
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
    
    Send_Text.Box_Type(0).Max_Size = "00"                           '最大桁数
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
    
    Send_Text.Box_Type(0).MENU = ""                                 'メニュー番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    '---------------------------------------------------------------
    Send_Text.Box_Type(1).Box_Type = TYPE_BCANK                     'ボックス属性　表示ＢＯＸ
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
    
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "")                '表示メッセージ
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "")
                                                                    '初期表示内容（数値）
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
    
    Send_Text.Box_Type(1).Start_Pos = "01"                          'カーソル位置
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
    
    Send_Text.Box_Type(1).Max_Size = "05"                           '最大桁数
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "05"
    
    Send_Text.Box_Type(1).MENU = ""                                 'メニュー番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    '---------------------------------------------------------------
    Send_Text.Box_Type(2).Box_Type = TYPE_REF                       'ボックス属性　表示ＢＯＸ
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
    
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "")                '表示メッセージ
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "")
                                                                    '初期表示内容（数値）
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
    
    Send_Text.Box_Type(2).Start_Pos = ""                            'カーソル位置
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
    
    Send_Text.Box_Type(2).Max_Size = "00"                           '最大桁数
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
    
    Send_Text.Box_Type(2).MENU = ""                                 'メニュー番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    '---------------------------------------------------------------
    Send_Text.Box_Type(3).Box_Type = TYPE_REF                       'ボックス属性　表示ＢＯＸ
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
    
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")                '表示メッセージ
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                    '初期表示内容（数値）
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
    
    Send_Text.Box_Type(3).Start_Pos = ""                            'カーソル位置
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
    
    Send_Text.Box_Type(3).Max_Size = "00"                           '最大桁数
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
    
    Send_Text.Box_Type(3).MENU = ""                                 'メニュー番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    '---------------------------------------------------------------
    Send_Text.Box_Type(4).Box_Type = TYPE_REF                       'ボックス属性　表示ＢＯＸ
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
    
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")                '表示メッセージ
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                    '初期表示内容（数値）
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
    
    Send_Text.Box_Type(4).Start_Pos = ""                            'カーソル位置
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
    
    Send_Text.Box_Type(4).Max_Size = "00"                           '最大桁数
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
    
    Send_Text.Box_Type(4).MENU = ""                                 'メニュー番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    '---------------------------------------------------------------
    Send_Text.CRLF = vbCrLf
    '------------------------------------------ 送信バッファーへ転送
    Sendbuf = Text_Create_Proc()

    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信

End Sub


Private Function Normal_Proc(Sendbuf As String) As Integer
'-------------------------------------------------------
'
'   『通常テキスト受信』
'
'-------------------------------------------------------
    Normal_Proc = True
    
    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Start                 '子機電源ON（ここには来ない）
        
        Case Step_TANTO_REQ             '担当者要求（ここには来ない）
        
        Case Step_TANTO_RES             '担当者回答
    
            MENU_UP_F = False   '2008.08.08
    
    
            If Tanto_Check_Proc(Sendbuf) Then
                Exit Function
            End If
    
        Case Step_JGYOBU_REQ            '事業部要求（ここには来ない）
                
        Case Step_JGYOBU_RES            '事業部回答
            
            MENU_UP_F = False   '2008.08.08
            
            If Menu_Send_Proc(Sendbuf) Then
                Exit Function
            End If
                
        Case Step_NAIGAI_REQ            '国内外要求（ここには来ない）
                
        Case Step_NAIGAI_RES            '国内外回答
            
            MENU_UP_F = False   '2008.08.08
            
            If Menu_Send_Proc(Sendbuf) Then
                Exit Function
            End If
                                        
            ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ      '2006.07.14
                                        'メニュー要求（ここには来ない）
'2006.01.30        Case Step_MENU1_REQ, Step_MENU2_REQ, Step_MENU3_REQ
        Case Step_MENU1_REQ, Step_MENU2_REQ
                                        'メニュー回答
'2006.01.30        Case Step_MENU1_RES, Step_MENU2_RES, Step_MENU3_RES
        Case Step_MENU1_RES, Step_MENU2_RES
    
            If Menu_Send_Proc(Sendbuf) Then
                Exit Function
            End If
    
    End Select
    
    Normal_Proc = False

End Function

Private Sub Form_Unload(Cancel As Integer)

Dim sts As Integer

'---------------------------------------------- '倉庫マスタＣＬＯＳＥ
    sts = BTRV(BtOpClose, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "倉庫マスタ")
        End If
    End If
'---------------------------------------------- '棚マスタＣＬＯＳＥ
    sts = BTRV(BtOpClose, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "棚マスタ")
        End If
    End If
'---------------------------------------------- '品目マスタＣＬＯＳＥ
    sts = BTRV(BtOpClose, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "品目マスタ")
        End If
    End If
'---------------------------------------------- '品目マスタ（ワーク）ＣＬＯＳＥ
    sts = BTRV(BtOpClose, wITEM_POS, wITEMREC, Len(wITEMREC), K0_wITEM, Len(K0_wITEM), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "品目マスタ")
        End If
    End If
'---------------------------------------------- '担当者マスタＣＬＯＳＥ
    sts = BTRV(BtOpClose, TANTO_POS, TANTOREC, Len(TANTOREC), K0_TANTO, Len(K0_TANTO), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "担当者マスタ")
        End If
    End If
'---------------------------------------------- '要因マスタＣＬＯＳＥ
    sts = BTRV(BtOpClose, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "要因マスタ")
        End If
    End If
'---------------------------------------------- '向け先管理マスタＣＬＯＳＥ
    sts = BTRV(BtOpClose, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "向け先管理マスタ")
        End If
    End If
'---------------------------------------------- '構成マスタＣＬＯＳＥ
    sts = BTRV(BtOpClose, P_COMPO_POS, P_COMPO_K_REC, Len(P_COMPO_K_REC), K0_P_COMPO, Len(K0_P_COMPO), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "構成マスタ")
        End If
    End If
'---------------------------------------------- 'コードマスタＣＬＯＳＥ
    sts = BTRV(BtOpClose, P_CODE_POS, P_CODEREC, Len(P_CODEREC), K0_P_CODE, Len(K0_P_CODE), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "コードマスタ")
        End If
    End If
'---------------------------------------------- 'メニュー管理マスタＣＬＯＳＥ
    sts = BTRV(BtOpClose, P_MENU_POS, P_MENUREC, Len(P_MENUREC), K0_P_MENU, Len(K0_P_MENU), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "メニュー管理マスタ")
        End If
    End If
'---------------------------------------------- '発番マスタＣＬＯＳＥ
    sts = BTRV(BtOpClose, HATUBAN_POS, HATUBANREC, Len(HATUBANREC), K0_HATUBAN, Len(K0_HATUBAN), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "発番マスタ")
        End If
    End If
'---------------------------------------------- '担当者別メニューＣＬＯＳＥ
    sts = BTRV(BtOpClose, P_TMENU_POS, P_TMENUREC, Len(P_TMENUREC), K0_P_TMENU, Len(K0_P_TMENU), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "担当者別メニュー")
        End If
    End If
'---------------------------------------------- '在庫データＣＬＯＳＥ
    sts = BTRV(BtOpClose, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K0_ZAIKO, Len(K0_ZAIKO), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "在庫データ")
        End If
    End If
'---------------------------------------------- '在庫データ（移動処理用）ＣＬＯＳＥ

    sts = BTRV(BtOpClose, wZAIKO_POS, wZAIKOREC, Len(wZAIKOREC), K0_wZAIKO, Len(K0_wZAIKO), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "在庫データ")
        End If
    End If
'---------------------------------------------- '前借データＣＬＯＳＥ
    sts = BTRV(BtOpClose, J_NYU_POS, J_NYUREC, Len(J_NYUREC), K0_J_NYU, Len(K0_J_NYU), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "前借データ")
        End If
    End If
'---------------------------------------------- '出荷予定データＣＬＯＳＥ
    
''    sts = BTRV(BtOpDropSupIndex, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K8_Y_SYU, Len(K8_Y_SYU), 8)
''    If sts Then
''        Call File_Error(sts, BtOpDropSupIndex, "出荷予定データ")
''    End If
    
    
    
    
    sts = BTRV(BtOpClose, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "出荷予定データ")
        End If
    End If
'---------------------------------------------- '出荷予定データＣＬＯＳＥ
    sts = BTRV(BtOpClose, DEL_SYU_POS, DEL_SYUREC, Len(DEL_SYUREC), K0_DEL_SYU, Len(K0_DEL_SYU), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "出荷予定データ")
        End If
    End If
'---------------------------------------------- '在庫移動歴データＣＬＯＳＥ
    sts = BTRV(BtOpClose, IDO_POS, IDOREC, Len(IDOREC), K0_IDO, Len(K0_IDO), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "在庫移動歴データ")
        End If
    End If
'---------------------------------------------- '在庫集計データＣＬＯＳＥ
    sts = BTRV(BtOpClose, SUMZ_POS, SUMZREC, Len(SUMZREC), K0_SUMZ, Len(K0_SUMZ), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "在庫集計データ")
        End If
    End If
'---------------------------------------------- '月平均出荷数ＣＬＯＳＥ
    sts = BTRV(BtOpClose, AVE_SYUKA_POS, AVE_SYUKAREC, Len(AVE_SYUKAREC), K0_AVE_SYUKA, Len(K0_AVE_SYUKA), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "月平均出荷数")
        End If
    End If
'---------------------------------------------- '資材前借ﾃﾞｰﾀＣＬＯＳＥ
    sts = BTRV(BtOpClose, P_NYU_POS, P_NYUREC, Len(P_NYUREC), K0_P_NYU, Len(K0_P_NYU), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "資材前借ﾃﾞｰﾀ")
        End If
    End If
'---------------------------------------------- '作業実績ﾛｸﾞＣＬＯＳＥ
    sts = BTRV(BtOpClose, P_SAGYO_LOG_POS, P_SAGYO_LOG_REC, Len(P_SAGYO_LOG_REC), K0_P_SAGYO_LOG, Len(K0_P_SAGYO_LOG), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "資材前借ﾃﾞｰﾀ")
        End If
    End If
'---------------------------------------------- '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)ＣＬＯＳＥ   2006.12.07
    sts = BTRV(BtOpClose, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K0_Y_SYU_H, Len(K0_Y_SYU_H), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)データ")
        End If
    End If
'---------------------------------------------- '入荷予定(大阪PC向け)ＣＬＯＳＥ   2007.06.07
    sts = BTRV(BtOpClose, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
    If sts Then
        If sts <> BtErrNoOpen Then
            Call File_Error(sts, BtOpClose, "入荷予定(大阪PC向け)データ")
        End If
    End If
'---------------------------------------------- 'ファイル環境リセット
    sts = BTRV(BtOpReset, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
    If sts Then
        Call File_Error(sts, BtOpReset, "")
    End If

'Call LOG_OUT(LOG_F, "END 1")

    If Next_Step = 1 Then
        sts = Shell("d:\newsdc\exe\F1100501.bat", vbNormalFocus)
        If sts = 0 Then
            MsgBox "[F110050]終了処理の起動に失敗しました。 "
            Call LOG_OUT(LOG_F, "[F110050]終了処理の起動に失敗しました。")
        End If
    End If


    Set F1100101 = Nothing

'Call LOG_OUT(LOG_F, "END 2")

    


    End
End Sub
Private Function Tanto_Check_Proc(Sendbuf As String) As Integer
'-------------------------------------------------------
'
'   『担当者コードのチェック』
'
'-------------------------------------------------------
Dim sts As Integer
Dim i   As Integer

    Tanto_Check_Proc = True

    For i = 0 To M_Gyo
        
        If ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = TYPE_REF Then
        Else
                                '担当者マスタ読み込み
            Call UniCode_Conv(K0_TANTO.TANTO_CODE, ID_KANRI_TBL(ING_No).Recv_text(i))
            sts = BTRV(BtOpGetEqual, TANTO_POS, TANTOREC, Len(TANTOREC), K0_TANTO, Len(K0_TANTO), 0)
            Select Case sts
                Case BtNoErr
                    ID_KANRI_TBL(ING_No).TANTO_CODE = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                    Exit For
                Case BtErrKeyNotFound
                    
                    '   -------------------------------- エラーメッセージ作成
                    Call Err_Send_Proc("担当者未登録", "", "", "", "")
                    
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
                    
                    Tanto_Check_Proc = False
                    Exit Function
                Case Else
                    Sendbuf = Text_Create_Proc()
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Call File_Error(sts, BtOpGetEqual, "担当者マスタ", 0)
                    Exit Function
            End Select
        
        End If
    
    Next i

    If i > M_Gyo Then                       '実際はありえない（担当者が未入力）
        ID_KANRI_TBL(ING_No).Step = Step_Start
        '   -------------------------------- エラーメッセージ作成
        Call Err_Send_Proc("担当者未登録", "", "", "", "")
                    
        Sendbuf = Text_Create_Proc()
        ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
                    
        Tanto_Check_Proc = False
        Exit Function
    End If

'----------------------------------------------- '専用メニュー獲得
    If Menu_Type = 1 Then
                        '共通メニュー
    Else
        Call UniCode_Conv(K0_P_TMENU.TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
        sts = BTRV(BtOpGetEqual, P_TMENU_POS, P_TMENUREC, Len(P_TMENUREC), K0_P_TMENU, Len(K0_P_TMENU), 0)
        Select Case sts
            Case BtNoErr
'                ID_KANRI_TBL(ING_No).MENU_GRP = StrConv(P_TMENUREC.TANTO_CODE, vbUnicode)
            Case BtErrKeyNotFound
                    
'                ID_KANRI_TBL(ING_No).MENU_GRP = ""
                '   -------------------------------- エラーメッセージ作成
                Call Err_Send_Proc("担当者メニュー", "未登録", "", "", "")
                    
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
            
                Tanto_Check_Proc = False
                Exit Function
            Case Else
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "担当者メニュー", 0)
                Exit Function
        End Select
            
    
    
    End If
'----------------------------------------------- 'メニュー情報＆作業情報の初期化
    
    If UBound(JGYOBU_T) = 0 Then
                                                '１事業部固定
        ID_KANRI_TBL(ING_No).JGYOBU = JGYOBU_T(0).CODE
    Else
        ID_KANRI_TBL(ING_No).JGYOBU = ""
    End If
    
    If UBound(NAIGAI) = 0 Then
                                                '国内外固定
        ID_KANRI_TBL(ING_No).NAIGAI = NAIGAI(0).CODE
    Else
        ID_KANRI_TBL(ING_No).NAIGAI = ""
    End If
    
    ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ
    ID_KANRI_TBL(ING_No).MENU_LV1 = ""
    ID_KANRI_TBL(ING_No).MENU_LV2 = ""
'    ID_KANRI_TBL(ING_No).MENU_LV3 = ""

    ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
    ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
'    ID_KANRI_TBL(ING_No).PageNo_LV3 = 0

    ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ""
    ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = ""
    ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM = ""

'---------------------------------------------- 'メニュー送信
    If Menu_Send_Proc(Sendbuf) Then
        Exit Function
    End If

    Tanto_Check_Proc = False

End Function
'2006.01.30Private Function Menu_Send_Proc(Optional Sendbuf As String) As Integer
'2006.01.30'-------------------------------------------------------
'2006.01.30'
'2006.01.30'   『メニューテキスト作成』
'2006.01.30'
'2006.01.30'-------------------------------------------------------
'2006.01.30Dim sts         As Integer
'2006.01.30Dim com         As Integer
'2006.01.30
'2006.01.30Dim i           As Integer
'2006.01.30Dim j           As Integer
'2006.01.30
'2006.01.30Dim Menu_Tbl()  As Menu_Tbl_tag
'2006.01.30Dim Menu_Cnt    As Integer
'2006.01.30Dim Max_Page    As Integer
'2006.01.30
'2006.01.30
'2006.01.30Dim PageNo      As Integer
'2006.01.30
'2006.01.30Dim Gyo_Suu     As Integer
'2006.01.30Dim Start_Gyo   As Integer
'2006.01.30Dim End_Gyo     As Integer
'2006.01.30
'2006.01.30
'2006.01.30Dim WK_LV1      As String * 3
'2006.01.30Dim WK_LV2      As String * 3
'2006.01.30Dim WK_LV3      As String * 3
'2006.01.30
'2006.01.30
'2006.01.30    Menu_Send_Proc = True
'2006.01.30'----------------------------------------------- '事業部選択あり
'2006.01.30    If ID_KANRI_TBL(ING_No).JGYOBU = " " Then
'2006.01.30        Call JGYOBU_MENU_SET
'2006.01.30
'2006.01.30        Sendbuf = Text_Create_Proc()
'2006.01.30
'2006.01.30
'2006.01.30        Menu_Send_Proc = False
'2006.01.30        Exit Function
'2006.01.30    End If
'2006.01.30'----------------------------------------------- '国内外選択あり
'2006.01.30    If ID_KANRI_TBL(ING_No).NAIGAI = " " Then
'2006.01.30
'2006.01.30        ID_KANRI_TBL(ING_No).MENU_GRP = ""
'2006.01.30        ID_KANRI_TBL(ING_No).MENU_LV1 = ""
'2006.01.30        ID_KANRI_TBL(ING_No).MENU_LV2 = ""
'2006.01.30        ID_KANRI_TBL(ING_No).MENU_LV3 = ""
'2006.01.30
'2006.01.30        ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
'2006.01.30        ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
'2006.01.30        ID_KANRI_TBL(ING_No).PageNo_LV3 = 0
'2006.01.30
'2006.01.30
'2006.01.30        Call NAIGAI_MENU_SET
'2006.01.30        Sendbuf = Text_Create_Proc
'2006.01.30        Menu_Send_Proc = False
'2006.01.30        Exit Function
'2006.01.30    End If
'2006.01.30'----------------------------------------------- 'メニュー管理の読み込み
'2006.01.30    If Len(Trim(ID_KANRI_TBL(ING_No).MENU_GRP)) = 0 Then
'2006.01.30                                    'ここで未確定なのは共通メニュー時だけ
'2006.01.30        Call UniCode_Conv(K1_MENU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'2006.01.30        Call UniCode_Conv(K1_MENU.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'2006.01.30        Call UniCode_Conv(K1_MENU.MENU_GRP_NO, ALL_MENU_GRP)
'2006.01.30
'2006.01.30        Call UniCode_Conv(K1_MENU.MENU_LV1, "")
'2006.01.30        Call UniCode_Conv(K1_MENU.MENU_LV2, "")
'2006.01.30        Call UniCode_Conv(K1_MENU.MENU_LV3, "")
'2006.01.30
'2006.01.30        ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
'2006.01.30        ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
'2006.01.30        ID_KANRI_TBL(ING_No).PageNo_LV3 = 0
'2006.01.30
'2006.01.30
'2006.01.30        sts = BTRV(BtOpGetGreaterEqual, MENU_POS, MENUREC, Len(MENUREC), K1_MENU, Len(K1_MENU), 1)
'2006.01.30        Select Case sts
'2006.01.30            Case BtNoErr
'2006.01.30            Case BtErrEOF
'2006.01.30
'2006.01.30            '   -------------------------------- エラーメッセージ作成
'2006.01.30                Call Err_Send_Proc("メニュー未登録", "", "", "", "")
'2006.01.30                Sendbuf = Text_Create_Proc()
'2006.01.30                If UBound(NAIGAI) = 0 Then
'2006.01.30                    ID_KANRI_TBL(ING_No).Step = Step_Start
'2006.01.30                Else
'2006.01.30                    ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
'2006.01.30                End If
'2006.01.30                Menu_Send_Proc = False
'2006.01.30                Exit Function
'2006.01.30            Case Else
'2006.01.30                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2006.01.30                Sendbuf = Text_Create_Proc()
'2006.01.30                Call File_Error(sts, BtOpGetEqual, "メニュー管理マスタ", 0)
'2006.01.30                Exit Function
'2006.01.30        End Select
'2006.01.30
'2006.01.30        ID_KANRI_TBL(ING_No).MENU_GRP = StrConv(MENUREC.MENU_GRP_NO, vbUnicode)
'2006.01.30
'2006.01.30        ID_KANRI_TBL(ING_No).MENU_LV1 = ""
'2006.01.30        ID_KANRI_TBL(ING_No).MENU_LV2 = ""
'2006.01.30        ID_KANRI_TBL(ING_No).MENU_LV3 = ""
'2006.01.30
'2006.01.30        ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
'2006.01.30        ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
'2006.01.30        ID_KANRI_TBL(ING_No).PageNo_LV3 = 0
'2006.01.30
'2006.01.30
'2006.01.30        ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ
'2006.01.30
'2006.01.30
'2006.01.30    End If
'2006.01.30    '   -------------------------------- メニュー管理マスタ読込み
'2006.01.30
'2006.01.30
'2006.01.30
'2006.01.30    Call UniCode_Conv(K0_MENU.MENU_GRP_NO, ID_KANRI_TBL(ING_No).MENU_GRP)
'2006.01.30    Call UniCode_Conv(K0_MENU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'2006.01.30    Call UniCode_Conv(K0_MENU.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'2006.01.30    Call UniCode_Conv(K0_MENU.MENU_LV1, ID_KANRI_TBL(ING_No).MENU_LV1)
'2006.01.30    Call UniCode_Conv(K0_MENU.MENU_LV2, ID_KANRI_TBL(ING_No).MENU_LV2)
'2006.01.30    Call UniCode_Conv(K0_MENU.MENU_LV3, ID_KANRI_TBL(ING_No).MENU_LV3)
'2006.01.30
'2006.01.30    Erase Menu_Tbl
'2006.01.30
'2006.01.30    com = BtOpGetGreater
'2006.01.30
'2006.01.30    Menu_Cnt = -1
'2006.01.30    Do
'2006.01.30        sts = BTRV(com, MENU_POS, MENUREC, Len(MENUREC), K0_MENU, Len(K0_MENU), 0)
'2006.01.30        Select Case sts
'2006.01.30            Case BtNoErr
'2006.01.30                If ID_KANRI_TBL(ING_No).MENU_GRP <> StrConv(MENUREC.MENU_GRP_NO, vbUnicode) Or _
'2006.01.30                    ID_KANRI_TBL(ING_No).JGYOBU <> StrConv(MENUREC.JGYOBU, vbUnicode) Or _
'2006.01.30                    ID_KANRI_TBL(ING_No).NAIGAI <> StrConv(MENUREC.NAIGAI, vbUnicode) Then
'2006.01.30                    Exit Do
'2006.01.30                End If
'2006.01.30
'2006.01.30                WK_LV1 = ID_KANRI_TBL(ING_No).MENU_LV1
'2006.01.30                WK_LV2 = ID_KANRI_TBL(ING_No).MENU_LV2
'2006.01.30                WK_LV3 = ID_KANRI_TBL(ING_No).MENU_LV3
'2006.01.30
'2006.01.30
'2006.01.30                If Len(Trim(ID_KANRI_TBL(ING_No).MENU_LV1)) = 0 Then
'2006.01.30                    WK_LV1 = StrConv(MENUREC.MENU_LV1, vbUnicode)
'2006.01.30                    WK_LV2 = ""
'2006.01.30                    WK_LV3 = ""
'2006.01.30
'2006.01.30
'2006.01.30'                    ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
'2006.01.30                    ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
'2006.01.30                    ID_KANRI_TBL(ING_No).PageNo_LV3 = 0
'2006.01.30
'2006.01.30
'2006.01.30                Else
'2006.01.30                    If Len(Trim(ID_KANRI_TBL(ING_No).MENU_LV2)) = 0 Then
'2006.01.30                        WK_LV2 = StrConv(MENUREC.MENU_LV2, vbUnicode)
'2006.01.30                        WK_LV3 = ""
'2006.01.30
'2006.01.30'                        ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
'2006.01.30                        ID_KANRI_TBL(ING_No).PageNo_LV3 = 0
'2006.01.30
'2006.01.30
'2006.01.30                    Else
'2006.01.30                        If Len(Trim(ID_KANRI_TBL(ING_No).MENU_LV3)) = 0 Then
'2006.01.30                            WK_LV3 = StrConv(MENUREC.MENU_LV3, vbUnicode)
'2006.01.30
'2006.01.30'                            ID_KANRI_TBL(ING_No).PageNo_LV3 = 0
'2006.01.30
'2006.01.30                        End If
'2006.01.30                    End If
'2006.01.30                End If
'2006.01.30
'2006.01.30
'2006.01.30
'2006.01.30            Case BtErrEOF
'2006.01.30                Exit Do
'2006.01.30            Case Else
'2006.01.30
'2006.01.30                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2006.01.30                Sendbuf = Text_Create_Proc()
'2006.01.30                Call File_Error(sts, com, "メニュー管理マスタ", 0)
'2006.01.30                Exit Function
'2006.01.30        End Select
'2006.01.30
'2006.01.30
'2006.01.30    '   -------------------------------- メニュー情報を保存
'2006.01.30        If WK_LV1 <> StrConv(MENUREC.MENU_LV1, vbUnicode) Or _
'2006.01.30            WK_LV2 <> StrConv(MENUREC.MENU_LV2, vbUnicode) Or _
'2006.01.30            WK_LV3 <> StrConv(MENUREC.MENU_LV3, vbUnicode) Then
'2006.01.30        Else
'2006.01.30
'2006.01.30
'2006.01.30            Menu_Cnt = Menu_Cnt + 1
'2006.01.30
'2006.01.30            ReDim Preserve Menu_Tbl(Menu_Cnt)
'2006.01.30
'2006.01.30            If Len(Trim(ID_KANRI_TBL(ING_No).MENU_LV1)) = 0 Then
'2006.01.30                Menu_Tbl(Menu_Cnt).CODE = StrConv(MENUREC.MENU_LV1, vbUnicode)
'2006.01.30            Else
'2006.01.30                If Len(Trim(ID_KANRI_TBL(ING_No).MENU_LV2)) = 0 Then
'2006.01.30                    Menu_Tbl(Menu_Cnt).CODE = StrConv(MENUREC.MENU_LV2, vbUnicode)
'2006.01.30                Else
'2006.01.30                    If Len(Trim(ID_KANRI_TBL(ING_No).MENU_LV3)) = 0 Then
'2006.01.30                        Menu_Tbl(Menu_Cnt).CODE = StrConv(MENUREC.MENU_LV3, vbUnicode)
'2006.01.30                    End If
'2006.01.30                End If
'2006.01.30            End If
'2006.01.30
'2006.01.30
'2006.01.30            Menu_Tbl(Menu_Cnt).Disp = StrConv(MENUREC.DISPLAY_ITEM, vbUnicode)
'2006.01.30        End If
'2006.01.30
'2006.01.30        com = BtOpGetNext
'2006.01.30
'2006.01.30    Loop
'2006.01.30
'2006.01.30    If Menu_Cnt = -1 Then
'2006.01.30            '   -------------------------------- エラーメッセージ作成
'2006.01.30        Call Err_Send_Proc("メニュー未登録", "", "", "", "")
'2006.01.30        Sendbuf = Text_Create_Proc()
'2006.01.30        If UBound(NAIGAI) = 0 Then
'2006.01.30            ID_KANRI_TBL(ING_No).Step = Step_Start
'2006.01.30        Else
'2006.01.30            ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
'2006.01.30        End If
'2006.01.30        Menu_Send_Proc = False
'2006.01.30        Exit Function
'2006.01.30    End If
'2006.01.30
'2006.01.30'----------------------------------------------- 'メニュー送信テキスト作成
'2006.01.30'''    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1   'メニュー送信
'2006.01.30    '---------------------------------------------------------------
'2006.01.30    Max_Page = Int(CDbl((Menu_Cnt + 1) / M_Gyo + 0.9))
'2006.01.30
'2006.01.30
'2006.01.30
'2006.01.30
'2006.01.30'    Start_Gyo = ID_KANRI_TBL(ING_No).PageNo * M_Gyo
'2006.01.30'    End_Gyo = (ID_KANRI_TBL(ING_No).PageNo * M_Gyo) + (M_Gyo - 1)
'2006.01.30
'2006.01.30
'2006.01.30    Select Case ID_KANRI_TBL(ING_No).Step
'2006.01.30        Case Step_MENU1_REQ, Step_MENU1_RES
'2006.01.30            PageNo = ID_KANRI_TBL(ING_No).PageNo_LV1
'2006.01.30        Case Step_MENU2_REQ, Step_MENU2_RES
'2006.01.30            PageNo = ID_KANRI_TBL(ING_No).PageNo_LV2
'2006.01.30        Case Step_MENU3_REQ, Step_MENU3_RES
'2006.01.30            PageNo = ID_KANRI_TBL(ING_No).PageNo_LV3
'2006.01.30    End Select
'2006.01.30
'2006.01.30
'2006.01.30    Start_Gyo = PageNo * M_Gyo
'2006.01.30    End_Gyo = (PageNo * M_Gyo) + (M_Gyo - 1)
'2006.01.30
'2006.01.30
'2006.01.30    Send_Text.sts = Sts_OK                                      'ステータス　OK
'2006.01.30    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
'2006.01.30
'2006.01.30    Send_Text.Display_Flg = Display_MENU                        '表示画面フラグ メニュー画面
'2006.01.30    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_MENU
'2006.01.30                                                                '最終メニューフラグ
'2006.01.30    If Max_Page = 1 Then
'2006.01.30        Send_Text.End_Menu = Menu_Only          '１画面のみ
'2006.01.30        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
'2006.01.30    Else
'2006.01.30        If (Max_Page - 1) = PageNo Then
'2006.01.30            Send_Text.End_Menu = Menu_End       '最終ページ
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_End
'2006.01.30        Else
'2006.01.30            If PageNo = 0 Then
'2006.01.30                Send_Text.End_Menu = Menu_Head  '先頭ページ
'2006.01.30                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Head
'2006.01.30            Else
'2006.01.30                Send_Text.End_Menu = Menu_Mid   '途中ページ
'2006.01.30                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Mid
'2006.01.30            End If
'2006.01.30        End If
'2006.01.30    End If
'2006.01.30
'2006.01.30
'2006.01.30
'2006.01.30
'2006.01.30    Send_Text.fileName = ""                                         '送信データファイル名
'2006.01.30    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
'2006.01.30
'2006.01.30    Send_Text.Buzzer = Buzzer_DEF                                   'ブザー音　標準
'2006.01.30    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
'2006.01.30    '---------------------------------------------------------------
'2006.01.30    Gyo_Suu = 0
'2006.01.30    j = -1
'2006.01.30    For i = Start_Gyo To End_Gyo
'2006.01.30        j = j + 1
'2006.01.30        If i > UBound(Menu_Tbl) Then
'2006.01.30
'2006.01.30            Send_Text.Box_Type(j).Box_Type = ""                 'BOX属性
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Box_Type = ""
'2006.01.30
'2006.01.30            Call UniCode_Conv(Send_Text.Box_Type(j).LCD, "")    '表示内容
'2006.01.30            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).LCD, "")
'2006.01.30
'2006.01.30            Send_Text.Box_Type(j).INIT = ""                     '数値初期値
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).INIT = ""
'2006.01.30
'2006.01.30            Send_Text.Box_Type(j).Start_Pos = ""                '初期カーソル位置
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Start_Pos = ""
'2006.01.30
'2006.01.30            Send_Text.Box_Type(j).Max_Size = "00"               '入力桁数
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Max_Size = "00"
'2006.01.30
'2006.01.30            Send_Text.Box_Type(j).MENU = ""                     'メニュ―番号
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).MENU = ""
'2006.01.30
'2006.01.30
'2006.01.30        Else
'2006.01.30            Gyo_Suu = Gyo_Suu + 1
'2006.01.30
'2006.01.30            Send_Text.Box_Type(j).Box_Type = TYPE_MENU          'BOX属性
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Box_Type = TYPE_MENU
'2006.01.30                                                                '表示内容
'2006.01.30            Call UniCode_Conv(Send_Text.Box_Type(j).LCD, Menu_Tbl(i).Disp)
'2006.01.30            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).LCD, Menu_Tbl(i).Disp)
'2006.01.30
'2006.01.30            Send_Text.Box_Type(j).INIT = ""                     '数値初期値
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).INIT = ""
'2006.01.30
'2006.01.30            Send_Text.Box_Type(j).Start_Pos = ""                '初期カーソル位置
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Start_Pos = ""
'2006.01.30
'2006.01.30            Send_Text.Box_Type(j).Max_Size = "00"               '入力桁数
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Max_Size = "00"
'2006.01.30
'2006.01.30            Send_Text.Box_Type(j).MENU = Menu_Tbl(i).CODE       'メニュ―番号
'2006.01.30            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).MENU = Menu_Tbl(i).CODE
'2006.01.30
'2006.01.30        End If
'2006.01.30
'2006.01.30    Next i
'2006.01.30
'2006.01.30    Send_Text.Menu_Suu = Format(Gyo_Suu, "00")      'メニュー項目数
'2006.01.30    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = Format(Gyo_Suu, "00")
'2006.01.30
'2006.01.30
'2006.01.30    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信
'2006.01.30
'2006.01.30    Sendbuf = Text_Create_Proc()
'2006.01.30
'2006.01.30
'2006.01.30
'2006.01.30    Menu_Send_Proc = False
'2006.01.30
'2006.01.30End Function

Private Function Menu_Send_Proc(Optional Sendbuf As String) As Integer

'-------------------------------------------------------
'
'   『メニューテキスト作成』
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim Menu_Tbl()  As Menu_Tbl_tag
Dim Menu_Cnt    As Integer
Dim Max_Page    As Integer


Dim PageNo      As Integer

Dim Gyo_Suu     As Integer
Dim Start_Gyo   As Integer
Dim End_Gyo     As Integer


Dim WK_LV1      As String * 3
Dim WK_LV2      As String * 3




    Menu_Send_Proc = True
'----------------------------------------------- '事業部選択あり
    If Trim(ID_KANRI_TBL(ING_No).JGYOBU) = "" Then
        Call JGYOBU_MENU_SET

        Sendbuf = Text_Create_Proc()


        Menu_Send_Proc = False
        Exit Function
    End If
'----------------------------------------------- '国内外選択あり
    If ID_KANRI_TBL(ING_No).NAIGAI = " " Then

        ID_KANRI_TBL(ING_No).MENU_LV1 = ""
        ID_KANRI_TBL(ING_No).MENU_LV2 = ""

        ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
        ID_KANRI_TBL(ING_No).PageNo_LV2 = 0


        Call NAIGAI_MENU_SET
        Sendbuf = Text_Create_Proc
        Menu_Send_Proc = False
        Exit Function
    Else
        '2010.03.30
        If Trim(ID_KANRI_TBL(ING_No).MENU_LV1) = "" Then
            If ID_KANRI_TBL(ING_No).Step < Step_MENU1_REQ Then
                ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ
            End If
'            ID_KANRI_TBL(ING_No).MENU_LV1 = ""
'            ID_KANRI_TBL(ING_No).MENU_LV2 = ""
        
'            ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
'            ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
        
'            ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = ""
'            ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = ""
'            ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM = ""
        End If
        '2010.03.30
    
    
    End If
    '   -------------------------------- レベル１　トップメニューの管理
    If Trim(ID_KANRI_TBL(ING_No).MENU_LV1) = "" Then
'        ST_LOG_OUT_F = True '2008.08.08
        
        
        MENU_UP_F = False   '2008.08.08
        
        'ﾒﾆｭｰｸﾞﾙｰﾌﾟ
        Call UniCode_Conv(K0_P_TMENU.TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
        Erase Menu_Tbl

        sts = BTRV(BtOpGetEqual, P_TMENU_POS, P_TMENUREC, Len(P_TMENUREC), K0_P_TMENU, Len(K0_P_TMENU), 0)
        Select Case sts
            
            Case BtNoErr
            Case BtErrKeyNotFound
            
                        
                Call Err_Send_Proc("メニュー未登録", "", "", "", "")
                Sendbuf = Text_Create_Proc()
'                If UBound(NAIGAI) = 0 Then
'                    ID_KANRI_TBL(ING_No).Step = Step_Start
'                Else
'                    ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
'                End If
                
                
                
                
                
                
                
                If UBound(NAIGAI) = 0 Then
                    
                    
                    
                    If UBound(JGYOBU_T) = 0 Then
                    
                    
                        ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ
                        ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                
    '                    Call Menu_Send_Proc(Sendbuf)
                
                
                    Else
                
                        '事業部要求でループする
                        ID_KANRI_TBL(ING_No).Step = Step_JGYOBU_REQ
                        ID_KANRI_TBL(ING_No).JGYOBU = ""
                        
                        ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                        ID_KANRI_TBL(ING_No).MENU_LV2 = ""
            
    '                    Call Menu_Send_Proc(Sendbuf)
                    End If
                
                Else
                    ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
                    ID_KANRI_TBL(ING_No).NAIGAI = ""
    '                Call Menu_Send_Proc(Sendbuf)
                End If
                
                Menu_Send_Proc = False
                
                Exit Function
            
            
            Case Else

                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, com, "担当者別ﾒﾆｭｰ", 0)
                Exit Function
        End Select


        Menu_Cnt = -1
        For i = 0 To 179     '29--->179 2006.10.11
            If Trim(StrConv(P_TMENUREC.MENU_T(i).MENU_NO, vbUnicode)) = "" Then
                Exit For
            End If
        
            If StrConv(P_TMENUREC.MENU_T(i).JGYOBU, vbUnicode) = ID_KANRI_TBL(ING_No).JGYOBU And _
                StrConv(P_TMENUREC.MENU_T(i).NAIGAI, vbUnicode) = ID_KANRI_TBL(ING_No).NAIGAI Then
        
                Menu_Cnt = Menu_Cnt + 1
                ReDim Preserve Menu_Tbl(Menu_Cnt)
            
                Menu_Tbl(Menu_Cnt).MENU_NO = StrConv(P_TMENUREC.MENU_T(i).MENU_NO, vbUnicode)
                
                Call UniCode_Conv(K0_P_MENU.JGYOBU, StrConv(P_TMENUREC.MENU_T(i).JGYOBU, vbUnicode))
                Call UniCode_Conv(K0_P_MENU.NAIGAI, StrConv(P_TMENUREC.MENU_T(i).NAIGAI, vbUnicode))
                Call UniCode_Conv(K0_P_MENU.MENU_NO, StrConv(P_TMENUREC.MENU_T(i).MENU_NO, vbUnicode))
                
                sts = BTRV(BtOpGetEqual, P_MENU_POS, P_MENUREC, Len(P_MENUREC), K0_P_MENU, Len(K0_P_MENU), 0)
                Select Case sts
                    
                    Case BtNoErr
                    Case BtErrKeyNotFound
                    
                                
                        Call Err_Send_Proc("メニュー異常", "", "", "", "")
'                        Sendbuf = Text_Create_Proc()
'                        If UBound(NAIGAI) = 0 Then
'                            ID_KANRI_TBL(ING_No).Step = Step_Start
'                        Else
'                            ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
'                        End If
'                        Menu_Send_Proc = False
'                        Exit Function
                    
                    
                        If UBound(NAIGAI) = 0 Then
                            
                            
                            
                            If UBound(JGYOBU_T) = 0 Then
                            
                            
                                ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ
                                ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                        
            '                    Call Menu_Send_Proc(Sendbuf)
                        
                        
                            Else
                        
                                '事業部要求でループする
                                ID_KANRI_TBL(ING_No).Step = Step_JGYOBU_REQ
                                ID_KANRI_TBL(ING_No).JGYOBU = ""
                                
                                ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                                ID_KANRI_TBL(ING_No).MENU_LV2 = ""
                    
            '                    Call Menu_Send_Proc(Sendbuf)
                            End If
                        
                        Else
                            ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
                            ID_KANRI_TBL(ING_No).NAIGAI = ""
            '                Call Menu_Send_Proc(Sendbuf)
                        End If
                        
                        Menu_Send_Proc = False
                        
                        Exit Function
                    
                    
                    
                    
                    Case Else
        
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, com, "メニュー管理マスタ", 0)
                        Exit Function
                End Select
                
                
                
                Menu_Tbl(Menu_Cnt).MENU_NO = StrConv(P_TMENUREC.MENU_T(i).MENU_NO, vbUnicode)
                Menu_Tbl(Menu_Cnt).Disp = StrConv(P_MENUREC.MENU_DSP, vbUnicode)
        
        
            End If
        
        Next i


        If Menu_Cnt = -1 Then
        '   -------------------------------- エラーメッセージ作成
            Call Err_Send_Proc("メニュー未登録", "", "", "", "")
            Sendbuf = Text_Create_Proc()
'            If UBound(NAIGAI) = 0 Then
'                ID_KANRI_TBL(ING_No).Step = Step_Start
'            Else
'                ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
'            End If
            
            
            
            
            
            If UBound(NAIGAI) = 0 Then
                
                
                
                If UBound(JGYOBU_T) = 0 Then
                
                
                    ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ
                    ID_KANRI_TBL(ING_No).MENU_LV1 = ""
            
'                    Call Menu_Send_Proc(Sendbuf)
            
            
                Else
            
                    '事業部要求でループする
                    ID_KANRI_TBL(ING_No).Step = Step_JGYOBU_REQ
                    ID_KANRI_TBL(ING_No).JGYOBU = ""
                    
                    ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                    ID_KANRI_TBL(ING_No).MENU_LV2 = ""
        
'                    Call Menu_Send_Proc(Sendbuf)
                End If
            
            Else
                ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
                ID_KANRI_TBL(ING_No).NAIGAI = ""
'                Call Menu_Send_Proc(Sendbuf)
            End If
            
'''''            Menu_Send_Proc = False
            
            Exit Function
            
            
            
            
            
            
            
            
            
            
            
            
            
            
        End If


        Max_Page = Int(CDbl((Menu_Cnt + 1) / M_Gyo + 0.9))
        PageNo = ID_KANRI_TBL(ING_No).PageNo_LV1

        Start_Gyo = PageNo * M_Gyo
        End_Gyo = (PageNo * M_Gyo) + (M_Gyo - 1)


        Send_Text.sts = Sts_OK                                      'ステータス　OK
        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

        Send_Text.Display_Flg = Display_MENU                        '表示画面フラグ メニュー画面
        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_MENU
        If Max_Page = 1 Then
            Send_Text.End_Menu = Menu_Only          '１画面のみ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        Else
            If (Max_Page - 1) = PageNo Then
                Send_Text.End_Menu = MENU_END       '最終ページ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = MENU_END
            Else
                If PageNo = 0 Then
                    Send_Text.End_Menu = Menu_Head  '先頭ページ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Head
                Else
                    Send_Text.End_Menu = Menu_Mid   '途中ページ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Mid
                End If
            End If
        End If
        Send_Text.fileName = ""                                         '送信データファイル名
        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        Send_Text.Buzzer = Buzzer_DEF                                   'ブザー音　標準
        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
'---------------------------------------------------------------
        Gyo_Suu = 0
        j = -1
        For i = Start_Gyo To End_Gyo
            j = j + 1
            If i > UBound(Menu_Tbl) Then
                Send_Text.Box_Type(j).Box_Type = ""                 'BOX属性
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Box_Type = ""
                Call UniCode_Conv(Send_Text.Box_Type(j).LCD, "")    '表示内容
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).LCD, "")
                Send_Text.Box_Type(j).INIT = ""                     '数値初期値
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).INIT = ""
                Send_Text.Box_Type(j).Start_Pos = ""                '初期カーソル位置
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Start_Pos = ""
                Send_Text.Box_Type(j).Max_Size = "00"               '入力桁数
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Max_Size = "00"
                Send_Text.Box_Type(j).MENU = ""                     'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).MENU = ""
            Else
                Gyo_Suu = Gyo_Suu + 1
                Send_Text.Box_Type(j).Box_Type = TYPE_MENU          'BOX属性
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Box_Type = TYPE_MENU
                Call UniCode_Conv(Send_Text.Box_Type(j).LCD, Menu_Tbl(i).Disp)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).LCD, Menu_Tbl(i).Disp)
                Send_Text.Box_Type(j).INIT = ""                     '数値初期値
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).INIT = ""
                Send_Text.Box_Type(j).Start_Pos = ""                '初期カーソル位置
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Start_Pos = ""
                Send_Text.Box_Type(j).Max_Size = "00"               '入力桁数
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Max_Size = "00"
                Send_Text.Box_Type(j).MENU = Menu_Tbl(i).MENU_NO
                
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).MENU = Menu_Tbl(i).MENU_NO
            End If
        Next i
        
        Send_Text.Menu_Suu = Format(Gyo_Suu, "00")      'メニュー項目数
        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = Format(Gyo_Suu, "00")
        ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信
        Sendbuf = Text_Create_Proc()
        
    Else
        '   -------------------------------- レベル２　作業メニューの管理
        If Trim(ID_KANRI_TBL(ING_No).MENU_LV2) = "" Then
            
            
'2008.08.12            If ST_LOG_OUT_F Then            '2008.08.08

'                ST_LOG_OUT_F = False        '2008.08.08

                
'                If Not MENU_UP_F Then       '2008.08.08
'
'                    If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
'                                                ID_KANRI_TBL(ING_No).JGYOBU, _
'                                                ID_KANRI_TBL(ING_No).NAIGAI, _
'                                                ID_KANRI_TBL(ING_No).MENU_LV1, _
'                                                "ST", , , , , , , , , FILE_RETRY) Then
'
'                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                        Sendbuf = Text_Create_Proc()
'                        Exit Function
'
'                    End If
'
'                End If


 '2008.08.12           End If
            
            
            
            
            
            
            
            
            
            'ﾒﾆｭｰｸﾞﾙｰﾌﾟ
            Call UniCode_Conv(K0_P_MENU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
            Call UniCode_Conv(K0_P_MENU.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
            Call UniCode_Conv(K0_P_MENU.MENU_NO, ID_KANRI_TBL(ING_No).MENU_LV1)
            
            
            Erase Menu_Tbl
    
            sts = BTRV(BtOpGetEqual, P_MENU_POS, P_MENUREC, Len(P_MENUREC), K0_P_MENU, Len(K0_P_MENU), 0)
            Select Case sts
                
                Case BtNoErr
                Case BtErrKeyNotFound
                
                            
                    Call Err_Send_Proc("メニュー未登録", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    If UBound(NAIGAI) = 0 Then
                        ID_KANRI_TBL(ING_No).Step = Step_Start
                    Else
                        ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
                    End If
                    Menu_Send_Proc = False
                    Exit Function
                
                
                Case Else
    
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, com, "担当者別ﾒﾆｭｰ", 0)
                    Exit Function
            End Select
    
    
            Menu_Cnt = -1
            For i = 0 To 19
                If Trim(StrConv(P_MENUREC.SAGYO(i).YOIN, vbUnicode)) = "" Then
                    Exit For
                End If
            
            
                Menu_Cnt = Menu_Cnt + 1
                ReDim Preserve Menu_Tbl(Menu_Cnt)
                
                    
                    
                Menu_Tbl(Menu_Cnt).MENU_NO = StrConv(P_MENUREC.SAGYO(i).YOIN, vbUnicode)
                Menu_Tbl(Menu_Cnt).PARAM = StrConv(P_MENUREC.SAGYO(i).PARAM, vbUnicode)
                Menu_Tbl(Menu_Cnt).Disp = StrConv(P_MENUREC.SAGYO(i).Disp, vbUnicode)
            
                Menu_Tbl(Menu_Cnt).LOG_OUT = StrConv(P_MENUREC.SAGYO(i).LOG_OUT, vbUnicode)
            
            Next i
    
    
            If Menu_Cnt = -1 Then
            '   -------------------------------- エラーメッセージ作成
                Call Err_Send_Proc("メニュー未登録", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                If UBound(NAIGAI) = 0 Then
                    ID_KANRI_TBL(ING_No).Step = Step_Start
                Else
                    ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
                End If
                Menu_Send_Proc = False
                Exit Function
            End If
    
    
            Max_Page = Int(CDbl((Menu_Cnt + 1) / M_Gyo + 0.9))
            PageNo = ID_KANRI_TBL(ING_No).PageNo_LV2
    
            Start_Gyo = PageNo * M_Gyo
            End_Gyo = (PageNo * M_Gyo) + (M_Gyo - 1)
    
    
            Send_Text.sts = Sts_OK                                      'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_MENU                        '表示画面フラグ メニュー画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_MENU
            If Max_Page = 1 Then
                Send_Text.End_Menu = Menu_Only          '１画面のみ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            Else
                If (Max_Page - 1) = PageNo Then
                    Send_Text.End_Menu = MENU_END       '最終ページ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = MENU_END
                Else
                    If PageNo = 0 Then
                        Send_Text.End_Menu = Menu_Head  '先頭ページ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Head
                    Else
                        Send_Text.End_Menu = Menu_Mid   '途中ページ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Mid
                    End If
                End If
            End If
            Send_Text.fileName = ""                                         '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
            Send_Text.Buzzer = Buzzer_DEF                                   'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
    '---------------------------------------------------------------
            Gyo_Suu = 0
            j = -1
            For i = Start_Gyo To End_Gyo
                j = j + 1
                If i > UBound(Menu_Tbl) Then
                    Send_Text.Box_Type(j).Box_Type = ""                 'BOX属性
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Box_Type = ""
                    Call UniCode_Conv(Send_Text.Box_Type(j).LCD, "")    '表示内容
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).LCD, "")
                    Send_Text.Box_Type(j).INIT = ""                     '数値初期値
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).INIT = ""
                    Send_Text.Box_Type(j).Start_Pos = ""                '初期カーソル位置
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Start_Pos = ""
                    Send_Text.Box_Type(j).Max_Size = "00"               '入力桁数
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Max_Size = "00"
                    Send_Text.Box_Type(j).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).MENU = ""
                Else
                    Gyo_Suu = Gyo_Suu + 1
                    Send_Text.Box_Type(j).Box_Type = TYPE_MENU          'BOX属性
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Box_Type = TYPE_MENU
                    Call UniCode_Conv(Send_Text.Box_Type(j).LCD, Menu_Tbl(i).Disp)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).LCD, Menu_Tbl(i).Disp)
                    Send_Text.Box_Type(j).INIT = ""                     '数値初期値
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).INIT = ""
                    Send_Text.Box_Type(j).Start_Pos = ""                '初期カーソル位置
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Start_Pos = ""
                    Send_Text.Box_Type(j).Max_Size = "00"               '入力桁数
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Max_Size = "00"
                                                                        
                                                                        'メニュ―番号 & ﾊﾟﾗﾒｰﾀ
                     Send_Text.Box_Type(j).MENU = Menu_Tbl(i).MENU_NO & Menu_Tbl(i).PARAM
                     ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).MENU = Menu_Tbl(i).MENU_NO & Menu_Tbl(i).PARAM
                
                
                End If
            Next i
            
            Send_Text.Menu_Suu = Format(Gyo_Suu, "00")      'メニュー項目数
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = Format(Gyo_Suu, "00")
            ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信
            Sendbuf = Text_Create_Proc()
            
        
        End If
    End If
    
    Menu_Send_Proc = False




End Function


Private Sub JGYOBU_MENU_SET()
'-------------------------------------------------------
'
'   『事業部選択用メニュー作成』
'
'-------------------------------------------------------
Dim i   As Integer

    ID_KANRI_TBL(ING_No).Step = Step_JGYOBU_REQ                     '事業部要求
    '---------------------------------------------------------------
    Send_Text.sts = Sts_OK                                          'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_MENU                            '表示画面フラグ メニュー画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_MENU
    
    Send_Text.End_Menu = Menu_Only                                  '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = Format(UBound(JGYOBU_T) + 1, "00")         'メニュー項目数
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = Format(UBound(JGYOBU_T) + 1, "00")
    
    Send_Text.fileName = ""                                         '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
    
    Send_Text.Buzzer = Buzzer_DEF                                   'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
    
    '---------------------------------------------------------------
    For i = 0 To M_Gyo - 1
        
        If i > UBound(JGYOBU_T) Then
        
            Send_Text.Box_Type(i).Box_Type = ""                 'BOX属性
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
        
            Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")    '表示内容
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
            
            Send_Text.Box_Type(i).INIT = ""                     '数値初期値
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                                                
            Send_Text.Box_Type(i).Start_Pos = ""                '初期カーソル位置
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                                                
            Send_Text.Box_Type(i).Max_Size = "00"               '入力桁数
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(i).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
        
        Else
            
            Send_Text.Box_Type(i).Box_Type = TYPE_MENU          'BOX属性
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = TYPE_MENU
                                                                '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(i).LCD, JGYOBU_T(i).NAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, JGYOBU_T(i).NAME)
                                                                                
            Send_Text.Box_Type(i).INIT = ""                     '数値初期値
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
            
            Send_Text.Box_Type(i).Start_Pos = ""                '初期カーソル位置
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                                                
            Send_Text.Box_Type(i).Max_Size = "00"               '入力桁数
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(i).MENU = JGYOBU_T(i).CODE       'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = JGYOBU_T(i).CODE
                                                                                
        
        End If
    
    Next i
    
    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信

End Sub

Private Sub NAIGAI_MENU_SET()
'-------------------------------------------------------
'
'   『内外選択用メニュー作成』
'
'-------------------------------------------------------
Dim i   As Integer

    ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ                     '内外要求
    '---------------------------------------------------------------
    Send_Text.sts = Sts_OK                                          'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_MENU                             '表示画面フラグ メニュー画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_MENU
    
    Send_Text.End_Menu = Menu_Only                                  '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = Format(UBound(NAIGAI) + 1, "00")         'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = Format(UBound(NAIGAI) + 1, "00")
    
    Send_Text.fileName = ""                                         '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
    
    Send_Text.Buzzer = Buzzer_DEF                                   'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
    
    '---------------------------------------------------------------
    For i = 0 To M_Gyo - 1
        
        If i > UBound(NAIGAI) Then
        
            Send_Text.Box_Type(i).Box_Type = ""                 'BOX属性
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
        
            Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")    '表示内容
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
            
            Send_Text.Box_Type(i).INIT = ""                     '数値初期値
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                                                
            Send_Text.Box_Type(i).Start_Pos = ""                '初期カーソル位置
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                                                
            Send_Text.Box_Type(i).Max_Size = "00"               '入力桁数
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(i).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
        
        Else
            
            Send_Text.Box_Type(i).Box_Type = TYPE_MENU          'BOX属性
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = TYPE_MENU
                                                                '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(i).LCD, NAIGAI(i).NAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, NAIGAI(i).NAME)
                                                                                
            Send_Text.Box_Type(i).INIT = ""                     '数値初期値
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                                                
            Send_Text.Box_Type(i).Start_Pos = ""                '初期カーソル位置
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                                                
            Send_Text.Box_Type(i).Max_Size = "00"               '入力桁数
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(i).MENU = NAIGAI(i).CODE       'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = NAIGAI(i).CODE
                                                                                
        
        End If
    
    Next i
    
    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信

End Sub

Private Sub Re_Send_Proc(Sendbuf As String)
'-------------------------------------------------------
'
'   『エラー時の再送』
'
'-------------------------------------------------------
Dim i   As Integer
    
    
    
'    Select Case ID_KANRI_TBL(ING_No).Step
'        Case 2, 4, 6
'            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'    End Select
'-------------------------------------------------------
    Send_Text.sts = ID_KANRI_TBL(ING_No).Send_Text.sts                  'ステータス　OK
    
    Send_Text.Display_Flg = ID_KANRI_TBL(ING_No).Send_Text.Display_Flg  '表示画面フラグ メニュー画面
    
    Send_Text.End_Menu = ID_KANRI_TBL(ING_No).Send_Text.End_Menu        '最終メニューフラグ
    
    Send_Text.Menu_Suu = ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu        'メニュー項目数（05固定）
    
    Send_Text.fileName = ID_KANRI_TBL(ING_No).Send_Text.fileName        '送信データファイル名
    
    Send_Text.Buzzer = ID_KANRI_TBL(ING_No).Send_Text.Buzzer            'ブザー音　標準

    For i = 0 To M_Gyo - 1
                                                                        'BOX属性
        Send_Text.Box_Type(i).Box_Type = ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type
                                                                        '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                                                                        
                                                                    '初期表示内容（数値）
        Send_Text.Box_Type(i).INIT = ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT
                                                                        '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos
                                                                        '入力桁数
        Send_Text.Box_Type(i).Max_Size = ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size
                                                                        'メニュ―番号
        Send_Text.Box_Type(i).MENU = ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU

    Next
    
    Send_Text.CRLF = vbCrLf
    
    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信
    
    Sendbuf = Text_Create_Proc()


End Sub
Private Sub Send_Err_Proc(Sendbuf As String)
'-------------------------------------------------------
'
'   『送信エラー時の再送』
'
'-------------------------------------------------------
Dim i   As Integer
    
    
    
'    Select Case ID_KANRI_TBL(ING_No).Step
'        Case 2, 4, 6
'            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'    End Select
'-------------------------------------------------------
    Send_Text.sts = ID_KANRI_TBL(ING_No).Last_Send_Text.sts                  'ステータス　OK
    
    Send_Text.Display_Flg = ID_KANRI_TBL(ING_No).Last_Send_Text.Display_Flg  '表示画面フラグ メニュー画面
    
    Send_Text.End_Menu = ID_KANRI_TBL(ING_No).Last_Send_Text.End_Menu        '最終メニューフラグ
    
    Send_Text.Menu_Suu = ID_KANRI_TBL(ING_No).Last_Send_Text.Menu_Suu        'メニュー項目数（05固定）
    
    Send_Text.fileName = ID_KANRI_TBL(ING_No).Last_Send_Text.fileName        '送信データファイル名
    
    Send_Text.Buzzer = ID_KANRI_TBL(ING_No).Last_Send_Text.Buzzer            'ブザー音　標準

    For i = 0 To M_Gyo - 1
                                                                        'BOX属性
        Send_Text.Box_Type(i).Box_Type = ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).Box_Type
                                                                        '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, StrConv(ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).LCD, vbUnicode))
                                                                        
                                                                    '初期表示内容（数値）
        Send_Text.Box_Type(i).INIT = ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).INIT
                                                                        '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).Start_Pos
                                                                        '入力桁数
        Send_Text.Box_Type(i).Max_Size = ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).Max_Size
                                                                        'メニュ―番号
        Send_Text.Box_Type(i).MENU = ID_KANRI_TBL(ING_No).Last_Send_Text.Box_Type(i).MENU

    Next
    
    Send_Text.CRLF = vbCrLf
    
    ID_KANRI_TBL(ING_No).Last_Send = 0  'ノーマルデータ送信
    
    Sendbuf = Text_Create_Proc()


End Sub

Private Function Menu_Recv_Proc(Sendbuf As String) As Integer
'-------------------------------------------------------
'
'   『２階層以上のメニュー送信』
'
'-------------------------------------------------------
Dim sts     As Integer
Dim i       As Integer

    
Dim MTS     As String * 8
Dim SS      As String * 8
    
    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_MENU1_RES
    '   -------------------------------- 次ﾚﾍﾞﾙへ
            If Trim(ID_KANRI_TBL(ING_No).Recv_text(0)) <> BEF_Page And Trim(ID_KANRI_TBL(ING_No).Recv_text(0)) <> NEXT_Page Then

                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1
            End If
            
            If Menu_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        Case Else
    
            If Trim(ID_KANRI_TBL(ING_No).Recv_text(0)) = BEF_Page Or Trim(ID_KANRI_TBL(ING_No).Recv_text(0)) = NEXT_Page Then
                If Menu_Send_Proc() Then
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                End If
            Else
    
    '   -------------------------------- メニュー管理マスタ読込み
                Call UniCode_Conv(K0_P_MENU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                Call UniCode_Conv(K0_P_MENU.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                Call UniCode_Conv(K0_P_MENU.MENU_NO, ID_KANRI_TBL(ING_No).MENU_LV1)
        
                sts = BTRV(BtOpGetEqual, P_MENU_POS, P_MENUREC, Len(P_MENUREC), K0_P_MENU, Len(K0_P_MENU), 0)
                Select Case sts
                    Case BtNoErr
    
                        For i = 0 To 19
                        
                            If Trim(StrConv(P_MENUREC.SAGYO(i).YOIN, vbUnicode)) = Trim(ID_KANRI_TBL(ING_No).MENU_LV2) And _
                                StrConv(P_MENUREC.SAGYO(i).PARAM, vbUnicode) = (ID_KANRI_TBL(ING_No).MTS_CODE & _
                                                                                        ID_KANRI_TBL(ING_No).SS_CODE) Then
                                
                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, Left(StrConv(P_MENUREC.SAGYO(i).YOIN, vbUnicode), 1))
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, Right(StrConv(P_MENUREC.SAGYO(i).YOIN, vbUnicode), 1))
                                
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                
                                    Case BtNoErr
                                        'ｽｷｬﾅ表示名称
                                        ID_KANRI_TBL(ING_No).YOIN_DNAME = StrConv(P_MENUREC.SAGYO(i).Disp, vbUnicode)
                                
                                
                                        '2010.09.15
                                        ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME = StrConv(P_MENUREC.SAGYO(i).Disp, vbUnicode)
                                
                                        
                                        ID_KANRI_TBL(ING_No).SAGYO_LOG = StrConv(P_MENUREC.SAGYO(i).LOG_OUT, vbUnicode)
                                                                    
                                        If StrConv(YOINREC.PARAM_F, vbUnicode) = "1" Then   '向け先なら（出荷）
                                            ID_KANRI_TBL(ING_No).CYU_KBN = StrConv(YOINREC.YOIN_CODE, vbUnicode)
'2006.01.30                                            ID_KANRI_TBL(ING_No).MTS_CODE = Left(StrConv(P_MENUREC.SAGYO(i).PARAM, vbUnicode), 8)
'2006.01.30                                            ID_KANRI_TBL(ING_No).SS_CODE = Right(StrConv(P_MENUREC.SAGYO(i).PARAM, vbUnicode), 8)
                                        End If
                                                                                            '検品（向け先指定）なら
                                        If StrConv(YOINREC.CODE_TYPE, vbUnicode) = ACT_KENPIN_MTS Then
                                            ID_KANRI_TBL(ING_No).CYU_KBN = StrConv(YOINREC.YOIN_CODE, vbUnicode)
                                        End If
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = StrConv(YOINREC.CODE_TYPE, vbUnicode)
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = StrConv(YOINREC.YOIN_CODE, vbUnicode)
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM = StrConv(YOINREC.SOKO_NO, vbUnicode)
                                
                                    Case BtErrKeyNotFound
    
                                        ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                                        ID_KANRI_TBL(ING_No).MENU_LV2 = ""
                                        '   -------------------------------- エラーメッセージ作成
                                        Call Err_Send_Proc("要因マスタ", "未登録", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
                                        Menu_Recv_Proc = False
                                        Exit Function
                                    Case Else
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "メニュー管理", 0)
                                        Exit Function
                                End Select
                                
                                Exit For
                            End If
                        
                        Next i
    
                        If i > 19 Then
                
    
                            ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                            ID_KANRI_TBL(ING_No).MENU_LV2 = ""
                            '   -------------------------------- エラーメッセージ作成
                            Call Err_Send_Proc("メニュー管理マスタ", "設定ミス", Trim(ID_KANRI_TBL(ING_No).MENU_LV1), "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
                            Menu_Recv_Proc = False
                            Exit Function
                        
                        End If
                
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
        
        
                    Case BtErrKeyNotFound
        
                        ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                        ID_KANRI_TBL(ING_No).MENU_LV2 = ""
                        '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc("メニュー管理マスタ", "未登録", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
                        Menu_Recv_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "メニュー管理", 0)
                        Exit Function
        
                End Select
            End If
        End Select
        Sendbuf = Text_Create_Proc()
    
    Menu_Recv_Proc = False

End Function
'2006.01.30Private Function Menu_Recv_Proc(Sendbuf As String) As Integer
'2006.01.30'-------------------------------------------------------
'2006.01.30'
'2006.01.30'   『２階層以上のメニュー送信』
'2006.01.30'
'2006.01.30'-------------------------------------------------------
'2006.01.30Dim sts As Integer
'2006.01.30
'2006.01.30    Menu_Recv_Proc = True
'2006.01.30                                        'メニュ管理マスタの読み込み
'2006.01.30    Call UniCode_Conv(K1_MENU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'2006.01.30    Call UniCode_Conv(K1_MENU.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'2006.01.30    Call UniCode_Conv(K1_MENU.MENU_GRP_NO, ID_KANRI_TBL(ING_No).MENU_GRP)
'2006.01.30
'2006.01.30    If ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ Then
'2006.01.30        Call UniCode_Conv(K1_MENU.MENU_LV1, "000")
'2006.01.30    Else
'2006.01.30        Call UniCode_Conv(K1_MENU.MENU_LV1, ID_KANRI_TBL(ING_No).MENU_LV1)
'2006.01.30    End If
'2006.01.30
'2006.01.30    Call UniCode_Conv(K1_MENU.MENU_LV2, ID_KANRI_TBL(ING_No).MENU_LV2)
'2006.01.30    Call UniCode_Conv(K1_MENU.MENU_LV3, ID_KANRI_TBL(ING_No).MENU_LV3)
'2006.01.30    sts = BTRV(BtOpGetEqual, MENU_POS, MENUREC, Len(MENUREC), K1_MENU, Len(K1_MENU), 1)
'2006.01.30    Select Case sts
'2006.01.30        Case BtNoErr
'2006.01.30        Case BtErrKeyNotFound
'2006.01.30
'2006.01.30            ID_KANRI_TBL(ING_No).MENU_GRP = ""
'2006.01.30
'2006.01.30            ID_KANRI_TBL(ING_No).MENU_LV1 = ""
'2006.01.30            ID_KANRI_TBL(ING_No).MENU_LV2 = ""
'2006.01.30            ID_KANRI_TBL(ING_No).MENU_LV3 = ""
'2006.01.30
'2006.01.30            '   -------------------------------- エラーメッセージ作成
'2006.01.30            Call Err_Send_Proc("メニュー管理", "未登録", "", "", "")
'2006.01.30
'2006.01.30            Sendbuf = Text_Create_Proc()
'2006.01.30            ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
'2006.01.30
'2006.01.30            Menu_Recv_Proc = False
'2006.01.30            Exit Function
'2006.01.30        Case Else
'2006.01.30            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2006.01.30            Sendbuf = Text_Create_Proc()
'2006.01.30            Call File_Error(sts, BtOpGetEqual, "メニュー管理", 0)
'2006.01.30            Exit Function
'2006.01.30    End Select
'2006.01.30
'2006.01.30    If Trim(ID_KANRI_TBL(ING_No).Recv_text(0)) <> BEF_Page And Trim(ID_KANRI_TBL(ING_No).Recv_text(0)) <> NEXT_Page And _
'2006.01.30     StrConv(MENUREC.MENU_KBN, vbUnicode) = "1" Then
'2006.01.30
'2006.01.30
'2006.01.30                                            '要因の読込み
'2006.01.30        Call UniCode_Conv(K0_YOIN.CODE_TYPE, StrConv(MENUREC.CODE_TYPE, vbUnicode))
'2006.01.30        Call UniCode_Conv(K0_YOIN.YOIN_CODE, StrConv(MENUREC.YOIN_CODE, vbUnicode))
'2006.01.30        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
'2006.01.30        Select Case sts
'2006.01.30            Case BtNoErr
'2006.01.30                ID_KANRI_TBL(ING_No).YOIN_DNAME = StrConv(YOINREC.YOIN_DNAME, vbUnicode)
'2006.01.30
'2006.01.30                If StrConv(YOINREC.PARAM_F, vbUnicode) = "1" Then   '向け先なら（出荷）
'2006.01.30                    ID_KANRI_TBL(ING_No).CYU_KBN = StrConv(MENUREC.YOIN_CODE, vbUnicode)
'2006.01.30                    ID_KANRI_TBL(ING_No).MTS_CODE = Left(StrConv(MENUREC.PARAM, vbUnicode), 8)
'2006.01.30                    ID_KANRI_TBL(ING_No).SS_CODE = Right(StrConv(MENUREC.PARAM, vbUnicode), 8)
'2006.01.30                End If
'2006.01.30                                                                    '検品（向け先指定）なら
'2006.01.30                If StrConv(YOINREC.CODE_TYPE, vbUnicode) = ACT_KENPIN_MTS Then
'2006.01.30                    ID_KANRI_TBL(ING_No).CYU_KBN = StrConv(MENUREC.YOIN_CODE, vbUnicode)
'2006.01.30                End If
'2006.01.30
'2006.01.30                ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = StrConv(YOINREC.CODE_TYPE, vbUnicode)
'2006.01.30                ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = StrConv(YOINREC.YOIN_CODE, vbUnicode)
'2006.01.30                ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM = StrConv(MENUREC.PARAM, vbUnicode)
'2006.01.30
'2006.01.30            Case BtErrKeyNotFound
'2006.01.30
'2006.01.30                ID_KANRI_TBL(ING_No).MENU_GRP = ""
'2006.01.30
'2006.01.30                ID_KANRI_TBL(ING_No).MENU_LV1 = ""
'2006.01.30                ID_KANRI_TBL(ING_No).MENU_LV2 = ""
'2006.01.30                ID_KANRI_TBL(ING_No).MENU_LV3 = ""
'2006.01.30
'2006.01.30                '   -------------------------------- エラーメッセージ作成
'2006.01.30                Call Err_Send_Proc("要因マスタ", "未登録", "", "", "")
'2006.01.30
'2006.01.30                Sendbuf = Text_Create_Proc()
'2006.01.30                ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
'2006.01.30
'2006.01.30                Menu_Recv_Proc = False
'2006.01.30                Exit Function
'2006.01.30            Case Else
'2006.01.30                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2006.01.30                Sendbuf = Text_Create_Proc()
'2006.01.30                Call File_Error(sts, BtOpGetEqual, "メニュー管理", 0)
'2006.01.30                Exit Function
'2006.01.30        End Select
'2006.01.30
'2006.01.30        If Sagyo_Send_Proc() Then
'2006.01.30            Sendbuf = Text_Create_Proc()
'2006.01.30            Exit Function
'2006.01.30        End If
'2006.01.30    Else
'2006.01.30
'2006.01.30        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step + 1
'2006.01.30
'2006.01.30        If Menu_Send_Proc() Then
'2006.01.30            Sendbuf = Text_Create_Proc()
'2006.01.30            Exit Function
'2006.01.30        End If
'2006.01.30    End If
'2006.01.30
'2006.01.30    Sendbuf = Text_Create_Proc()
'2006.01.30
'2006.01.30
'2006.01.30    Menu_Recv_Proc = False
'2006.01.30
'2006.01.30End Function





Private Function Sagyo_Main_Proc(Sendbuf As String) As Integer
'-------------------------------------------------------
'
'   『作業受信時のメイン処理』
'
'-------------------------------------------------------
Dim i           As Integer
Dim j           As Integer
Dim Found_Flg   As Boolean
    
    
    Sagyo_Main_Proc = True
    
    
    Found_Flg = False
    For i = 0 To UBound(WEL_Para_Tbl, 1)
        For j = 0 To UBound(WEL_Para_Tbl, 2)
                                        '最初は２桁で検索
            If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = _
                WEL_Para_Tbl(i, j).Action Then
                Found_Flg = True
                Exit For
            End If
        
        Next j
            
        If Found_Flg Then
            Exit For
        End If
    
    Next i
    
    If Not Found_Flg Then
        
        For i = 0 To UBound(WEL_Para_Tbl, 1)
            For j = 0 To UBound(WEL_Para_Tbl, 2)
                                        '最後は１桁で検索
               If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE = Left(WEL_Para_Tbl(i, j).Action, 1) Then
                    Found_Flg = True
                    Exit For
                End If
        
            Next j
            
            If Found_Flg Then
                Exit For
            End If
        
        
        Next i
            
    End If


    If Not Found_Flg Then
                        
                        'ありえない異常（該当作業パラメータなし）
'2006.01.30        ID_KANRI_TBL(ING_No).MENU_GRP = ""
                
        ID_KANRI_TBL(ING_No).MENU_LV1 = ""
        ID_KANRI_TBL(ING_No).MENU_LV2 = ""
'2006.01.30        ID_KANRI_TBL(ING_No).MENU_LV3 = ""
                
        '   -------------------------------- エラーメッセージ作成
        Call Err_Send_Proc("作業パラメータ（INI）", "未登録", "", "", "")
                    
        Sendbuf = Text_Create_Proc()
        ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
            
        Sagyo_Main_Proc = False
        Exit Function
    
    End If

    Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE
        Case ACT_ZAITEI_IN          '在訂＋
        
        
            If Zaitei_In_Proc(Sendbuf, i, j) Then
                Exit Function
            End If
        
        
        
        Case ACT_ZAITEI_OUT         '在訂－
            
            '2007.10.02
            If (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = _
                Wel_S_SHOUHI Then
                        
                '2007.10.02 資材消費専用
                If S_SHOUHI_Out_Proc(Sendbuf, i, j) Then
                    Exit Function
                End If
                        
                        
            Else
                If Zaitei_Out_Proc(Sendbuf, i, j) Then
                    Exit Function
                End If
            End If
        
        
        Case ACT_NYUKA              '入荷
    
        Case ACT_SYUKA_KEI          '出荷(出荷予定有り)→向け先宣言
        
            
            If MTS_Dec_Proc(Sendbuf, i, j) Then
                Exit Function
            End If
        
        
        
        Case ACT_SYUKA_HYO          '出荷(出庫表)
        
            If SYUKO_HYO_Dec_Proc(Sendbuf, i, j) Then
                Exit Function
            End If
        
        Case ACT_SYUKA_GAI          '出荷(出荷予定無し)
        
            If Out_Plan_Proc(Sendbuf, i, j) Then
                Exit Function
            End If
        
        
        
        Case ACT_IDO_IN             '移動入庫
        
'-----------------------------------------  2012.03.06
'            If Ido_In_Proc(Sendbuf, i, j) Then
'                Exit Function
'            End If
        
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
        
                Case Wel_IDO_IN_OSAKA          '2012.03.15
            
                    If Ido_In_OSAKA_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                Case Else
            
                    If Ido_In_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            End Select
        
        
        
        Case ACT_IDO_OUT            '移動出庫
        
            
            
'-----------------------------------------  2012.03.06
'            '2011.06.01
'            If (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE) = _
'                Wel_HIN_FURIKAE_MAINA Then
'                '2011.06.01
'                If Ido_Out_Hin_Furikae_Proc(Sendbuf, i, j) Then
'                    Exit Function
'                End If
'
'            Else
'                If Ido_Out_Proc(Sendbuf, i, j) Then
'                    Exit Function
'                End If
'
'            End If
        
        Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
            Case Wel_HIN_FURIKAE_MAINA
        
                If Ido_Out_Hin_Furikae_Proc(Sendbuf, i, j) Then
                    Exit Function
                End If
        
        
            Case Wel_IDO_OUT_OSAKA          '2012.03.10
            
                If Ido_Out_OSAKA_Proc(Sendbuf, i, j) Then
                    Exit Function
                End If
            
            
            Case Else
                If Ido_Out_Proc(Sendbuf, i, j) Then
                    Exit Function
                End If
        
        End Select
'-----------------------------------------  2012.03.06
        
        Case ACT_DENPYO_ID          '伝票ＩＤ
        
            If DEN_ID_Dec_Proc(Sendbuf, i, j) Then
                Exit Function
            End If
        
        Case ACT_KENPIN             '検品
        
            If Inspe_Proc(Sendbuf, i, j) Then
                Exit Function
            End If
        
        
        Case ACT_WEL_ETC            'WEL専用（照会）
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
            
                Case Wel_TANAOROSI      '「WEL 棚卸し」の要因
                
                    If Tanaorosi_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                
                Case Wel_TANAHYOJI      '「WEL 棚番表示」の要因
                
                    If Tanahyoji_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                
                
                Case Wel_HIN_SHOGO      '「WEL 品番別照合」の要因
                    
                    If Hin_Shogo_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                
                Case Wel_AVE_SYUKA      '「WEL 月平均出荷数」の要因
                
                    If Ave_Syuka_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                
                Case Wel_HOST_ZAIKO     '「WEL ホスト在庫照会」の要因
                    
                    If Host_Zaiko_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                            
                Case Wel_ST_TANABAN     '「WEL 標準棚番設定」の要因
                    
                    If St_Tanaban_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                            
            
                Case Wel_RIREKI         '「WEL 当日出庫履歴」の要因
                
                    If Rireki_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                
                Case Wel_SUII           '「WEL 出荷推移」の要因

                    If Suii_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If

                Case Wel_TANA_HIN_SHOGO '「WEL 棚番・品番別照合」の要因

                    If Tana_Hin_Shogo_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                Case Wel_TANAHYOJI_KASO '「WEL 棚番表示(仮想優先)」の要因
                
                    If Tanahyoji_Kaso_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                Case Wel_COMPO          '「WEL 構成表示」の要因 2006.10.15
                
                    If COMPO_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                Case Wel_KEN_RIREKI     '「WEL 検品実績」の要因 2006.10.15
                
                    If KEN_Rireki_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
                Case Wel_RIREKI2        '「WEL 当日出庫履歴」の要因 2009.01.09
                
                    If Rireki2_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
                Case Wel_AVE_SYUKA_ID   '「WEL 月平均　ＩＤ読み込み」の要因 2009.03.19
                
                    If Ave_Syuka_ID_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                Case Wel_KEN_ZAN_ID   '「WEL 集約梱包残」の要因 2010.02.15
            
            
                    If KEN_ZAN_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                                                '2010.12.13
                Case Wel_AKI_LOC                '「WEL 空きロケーションの検索」の要因
            
            
                        
                    If AKI_LOC_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                                                '2011.07.05
                Case Wel_S_AVE_SYUKA
            
                    If S_Ave_Syuka_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
            End Select
    
        Case ACT_KENPIN_MTS             '検品（ＭＴＳ読み込みあり）
        
            If Inspe_Proc_MTS(Sendbuf, i, j) Then
                Exit Function
            End If
    
    
        Case ACT_GOODS_ONFF             '商品／未商品切り替え
    
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
    
                Case Wel_GOODS_ONOFF_ONO        '「WEL 商品/未商品切り替え　小野」の要因
                
                    If GOODS_ONOFF_Ono_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                
                Case Wel_GOODS_ONOFF_SIGA       '「WEL 商品/未商品切り替え　滋賀」の要因
            
                    If GOODS_ONOFF_Siga_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            End Select
    
    
        Case ACT_SPECIAL_PROCESS    '特殊処理
        
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
    
                Case Wel_RETURNED_GOODS         '「良品返品」の要因
                
                    If RETURNED_GOODS_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                
                
                Case Wel_LOCATION_MOVE         '「棚移動」の要因
                
                    If Location_Move_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                
            
                Case Wel_RETURNED_GOODS_OSAKA   '「大阪ＰＣ　良品返品」の要因   2007.09.12
                
                    If RETURNED_GOODS_OSAKA_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                Case Wel_SYUKA_CENCEL           '「出荷ｷｬﾝｾﾙ」の要因    2007.11.02
            
                    If SYUKA_CANCEL_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                Case Wel_ZAIKO_SEISA            '「在庫精査」の要因    2008.11.20
            
                    If Zaiko_Seisa_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                Case Wel_SYUKO_CANCEL           '「出庫CANCEL」の要因    2008.12.05
            
                    If SYUKO_CANCEL_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                                                '「移管処理」の要因    2009.02.26
                Case Wel_IKAN_1, Wel_IKAN_2, Wel_IKAN_3
            
                    
                    Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
                        
                        Case Wel_IKAN_1
                    
                            If LSBU_IKAN_Proc(Sendbuf, i, j, 1) Then
                                Exit Function
                            End If
            
                        Case Wel_IKAN_2
                    
                            If LSBU_IKAN_Proc(Sendbuf, i, j, 2) Then
                                Exit Function
                            End If
            
                        Case Wel_IKAN_3
                    
                            If LSBU_IKAN_Proc(Sendbuf, i, j, 3) Then
                                Exit Function
                            End If
            
            
                    End Select
            
            
            
            
                                                '「移管削除処理」の要因    2009.03.09
                Case Wel_IKAN_DEL
            
                    
                
                    If LSBU_IKAN_DEL_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                                                '「移管表示処理」の要因    2009.03.09
                Case Wel_IKAN_DSP
            
                    
                
                    If LSBU_IKAN_DSP_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                                                '「棚番追加処理」の要因    2009.03.17
                Case Wel_TANA_INS
            
                    
                
                    If TANA_INS_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                                                '「出荷削除処理」の要因    2009.03.17
                Case Wel_SYUKA_DEL
            
                    
                
                    If SYUKA_DEL_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
            
                                                '「才数／口数処理」の要因    2010.03.09
                Case Wel_SAI_SU
            
                    
                
                    If SAI_SU_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
            
            
                                                '2010.12.13
                Case Wel_TANA_USE               '「WEL 棚使用状況」の要因
                                                
                                                
                                                
                    If TANA_USE_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                                                
                                                
                                                    
                                                
                                                '2011.03.05
                Case Wel_LABEL_PRINT            '「WEL ﾗﾍﾞﾙ発行」の要因
            
            
                    
                    
            
            
            
                    If LABEL_Print_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
                                                '2011.08.05
                Case Wel_JAN_SET                '「WEL 品番(JAN)登録」の要因
            
                    If JAN_SET_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
            
            End Select
        
        Case ACT_KENPIN_DEN             '検品（大阪ＰＣ向け）   2006.12.07
        
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
'                Case Wel_Inspe_DEN, Wel_Inspe_DEN2              '2009.06.03
                Case Wel_Inspe_DEN                              '2009.06.03
        
        
        
                    If Inspe_Proc_DEN(Sendbuf, i, j) Then
                        Exit Function
                    End If
        
        
                Case Wel_Inspe_E_BAG     '2010.01.21
                    
                    If Inspe_Proc_E_BAG(Sendbuf, i, j) Then
                        Exit Function
                    End If
        
                Case Wel_KYOSEI_END
    
                    If KYOSEI_END_PROC(Sendbuf, i, j) Then
                        Exit Function
                    End If
    
    
                Case Wel_LABEL_REPRINT  '2010.01.21
    
                    If LABEL_RePrint_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
                
                Case Wel_Inspe_LOGISTIC '2010.01.25
                    
                    If Inspe_Proc_LOGISTIC(Sendbuf, i, j) Then
                        Exit Function
                    End If
    
    
                Case Wel_SEK_PACKING    '2011.04.25
                    
                    If SEK_PACKING_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
    
    
    
                Case Wel_SEK_Inspe      '2011.05.09
            
                    If Inspe_Proc_SEK(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
                Case Wel_SEK_SYUGO_PACKING  '2011.05.12
                    
                    If SEK_SYUGO_PACKING_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                Case Wel_SEK_KYOSEI_END     '2011.06.28
            
                    If SEK_KYOSEI_END_PROC(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
            
            
'------------------------------------------------------------------ 全数検品対応    2012.03.21
                Case Wel_Inspe_DEN_ALL                  '「WEL 大阪検品」の要因
                    If Inspe_Proc_DEN_ALL(Sendbuf, i, j) Then
                        Exit Function
                    End If
                Case Wel_Inspe_LOGISTIC_ALL             '「WEL ﾛｼﾞｽﾃｯｸｽ」の要因
                    If Inspe_Proc_LOGISTIC_ALL(Sendbuf, i, j) Then
                        Exit Function
                    End If
                Case Wel_SEK_PACKING_ALL                '「WEL 積水邸別梱包処理」の要因
                    If SEK_PACKING_ALL_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
'------------------------------------------------------------------ 全数検品対応    2012.03.21
            
            
                Case Wel_Inspe_E_BAG_ALL                                            '2012.06.20
                    If Inspe_Proc_E_BAG_ALL(Sendbuf, i, j) Then                     '2012.06.20
                        Exit Function                                               '2012.06.20
                    End If                                                          '2012.06.20
            
            
            End Select
    
        Case ACT_SYUKA_HYO_OSAKA        '出庫表出庫（大阪ＰＣ向け）   2007.03.16
    
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
                Case Wel_SYUKO_HYO_OSAKA
        
                    If SYUKO_HYO_Dec_OSAKA_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
        
    
            End Select
    
    
    
    
        Case ACT_IN_KENPIN_OSAKA        '入庫検品（大阪ＰＣ向け）   2007.06.07
    
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
                Case Wel_IN_KENPIN_OSAKA
        
                    If NYUKO_KENPIN_OSAKA_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
        
    
                Case WEL_IN_TANA_S_OSAKA            '資材検収入庫 2012.03.01
    
                    If NYUKO_KENPIN_OSAKA_S_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
    
    
    
    
            End Select
    
        Case ACT_IN_TANA_OSAKA        '入庫検品（大阪ＰＣ向け）   2007.06.07
    
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
                Case Wel_IN_TANA_OSAKA
        
                    If NYUKO_TANA_OSAKA_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
        
    
            End Select
    
    
        Case ACT_FURIKAE                '資材振替処理   2007.06.28
    
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
                Case Wel_FURIKAE
        
                    If Furikae_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
        
        
        
                Case Wel_HIN_FURIKAE_PLUS   '品番振替処理   2011.06.01
        
                    If Hin_Furikae_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
        
        
                Case Wel_HIN_FURIKA_S    '部材センター振替出庫
                    
                    If Hin_Furikae_S_Proc(Sendbuf, i, j) Then
                        Exit Function
                    End If
    
    
            End Select
    
    
        Case ACT_BINNO                  '便№処理(移管用) 2009.03.11
    
            If LSBU_IKAN_BinNo_Proc(Sendbuf, i, j) Then
                Exit Function
            End If
    
    
        Case ACT_KENPIN_GAI             '海外向け検品   2009.08.07
        
            If Inspe_Proc_GAI(Sendbuf, i, j) Then
                Exit Function
            End If
    
    
'        Case ACT_SAI_SU                 '才数／口数   2010.01.21
'
'            If SAI_SU_Proc(Sendbuf, i, j) Then
'                Exit Function
'            End If
    
    
        
        Case ACT_SHOUHINKA              '商品化ﾁｪｯｸ     2010.09.03
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
                
                Case Wel_SHOUHINKA_CHECK
                
                    If SHOUHINKA_CHECK_PROC(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
            
                Case Wel_HINBAN_CHECK    '品番ﾁｪｯｸ   2010.09.10
                
                    If HINBAN_CHECK_PROC(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
                Case Wel_COMPO_CHECK    '構成ﾁｪｯｸ   2011.03.02
                
                    If COMPO_CHECK_PROC(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
                Case Wel_COMPO_OSAKA_CHECK  '大阪ＰＣ　部材ｾﾝﾀｰ構成ﾁｪｯｸ   2012.03.16
                
                    If COMPO_OSAKA_CHECK_PROC(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
                Case Wel_KENPIN_OSAKA       '大阪ＰＣ　検品   2012.03.16
                
                    If KENPIN_OSAKA_PROC(Sendbuf, i, j) Then
                        Exit Function
                    End If
            
            
            

            
            End Select


    End Select

    Sagyo_Main_Proc = False

End Function


Private Function Tanahyoji_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『棚番表示処理』
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07

Dim Tanaban     As String * 8
Dim ST_TANABAN  As String * 8


Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim Tanahyoji() As Tanahyoji_tag
Dim Tana_Cnt    As Integer


Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1

Dim MENU_NO     As String * 2   '2008.08.08


    Tanahyoji_Proc = True

    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = CtrsWsk1.SendFolder & "\" & B1_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = CtrsWsk1.SendFolder & B1_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    '品目マスタ読み込み（標準棚番ＧＥＴ）
'                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                        ST_TANABAN = (StrConv(ITEMREC.ST_SOKO, vbUnicode) & StrConv(ITEMREC.ST_RETU, vbUnicode) & StrConv(ITEMREC.ST_REN, vbUnicode) & StrConv(ITEMREC.ST_DAN, vbUnicode))
                    Case BtErrKeyNotFound
'                        '   -------------------------------- エラーメッセージ作成
'                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
'
'                        Sendbuf = Text_Create_Proc()
'                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                        Tanahyoji_Proc = False
'                        Exit Function
                        '未登録は出荷予定読み込み   2006.06.01
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                        Select Case sts
                            Case BtNoErr
                                Hinban = StrConv(Y_SYUREC.HIN_NO, vbUnicode)
                                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                                Select Case sts
                                    Case BtNoErr
                                        ST_TANABAN = (StrConv(ITEMREC.ST_SOKO, vbUnicode) & StrConv(ITEMREC.ST_RETU, vbUnicode) & StrConv(ITEMREC.ST_REN, vbUnicode) & StrConv(ITEMREC.ST_DAN, vbUnicode))
                            
                                    
                                    Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                                    
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Tanahyoji_Proc = False
                                        Exit Function
                                    
                                    Case Else
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, com, "在庫データ", 0)
                                        Exit Function
                            
                                End Select
                            
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Tanahyoji_Proc = False
                                Exit Function
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, com, "在庫データ", 0)
                                Exit Function
                        End Select
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                Erase Tanahyoji
                Tana_Cnt = -1
        
                If Len(Trim(ST_TANABAN)) = 0 Then
                                            '標準棚番設定なし
                
                    Tana_Cnt = Tana_Cnt + 1
                    ReDim Tanahyoji(Tana_Cnt)
                    Tanahyoji(Tana_Cnt).Tanaban = ST_TANABAN
                
                    Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                    Tanahyoji(Tana_Cnt).MI_QTY = 0
                Else
                    If Zaiko_Syukei_Proc(SUMI_QTY, _
                                            MI_QTY, _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            Hinban, _
                                            ST_TANABAN) Then

            
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    End If
                    Tana_Cnt = Tana_Cnt + 1
                    ReDim Tanahyoji(Tana_Cnt)
                    Tanahyoji(Tana_Cnt).Tanaban = ST_TANABAN
                    Tanahyoji(Tana_Cnt).SUMI_QTY = SUMI_QTY
                    Tanahyoji(Tana_Cnt).MI_QTY = MI_QTY
                    
                    
                    
                End If
                
                Call UniCode_Conv(K6_ZAIKO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K6_ZAIKO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K6_ZAIKO.HIN_GAI, Hinban)
                Call UniCode_Conv(K6_ZAIKO.NYUKA_DT, "")
                Call UniCode_Conv(K6_ZAIKO.SOKO_NO, "")
                Call UniCode_Conv(K6_ZAIKO.Retu, "")
                Call UniCode_Conv(K6_ZAIKO.Ren, "")
                Call UniCode_Conv(K6_ZAIKO.Dan, "")
                    
                com = BtOpGetGreater
        
                SUMI_QTY = 0
                MI_QTY = 0
    
    
                Do
                    sts = BTRV(com, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K6_ZAIKO, Len(K6_ZAIKO), 6)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫データ", 0)
                            Exit Function
                    End Select
                
                    If StrConv(ZAIKOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                        StrConv(ZAIKOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                        Trim(StrConv(ZAIKOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                        '事業部／国内外／品番ブレーク
                        Exit Do
                    End If
                    
                    If (StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)) _
                        = ST_TANABAN Then
                        '標準棚番は対象外
                    Else
                        If Tana_Cnt = (-1) Then
                            Tana_Cnt = Tana_Cnt + 1
                            ReDim Tanahyoji(Tana_Cnt)
                            Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                            If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                Tanahyoji(Tana_Cnt).MI_QTY = 0
                            Else
                                Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                            End If
                        
                        Else
                            For j = 0 To UBound(Tanahyoji)
                                If Tanahyoji(j).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode) Then
                                    Exit For
                                End If
                            Next j
                        
                            If j <= UBound(Tanahyoji) Then
                            
                                If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                    Tanahyoji(j).SUMI_QTY = Tanahyoji(j).SUMI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                Else
                                    Tanahyoji(j).MI_QTY = Tanahyoji(j).MI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                End If
                            
                            
                            Else
                            
                                Tana_Cnt = Tana_Cnt + 1
                            
                                ReDim Preserve Tanahyoji(Tana_Cnt)
                                Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                                If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    Tanahyoji(Tana_Cnt).MI_QTY = 0
                                Else
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                    Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                End If
                            
                            End If
                        
                        End If
                    
                    End If
                    
                    com = BtOpGetNext
                    
                Loop
        
        
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
        
                SendFileRec.Title = "0"     'タイトル行
                Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME & Format(Tana_Cnt + 1, "#0") & "件")
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
        
        
                If Tana_Cnt > -1 Then
                                '集計テーブルよりデータ出力
                    For j = 0 To UBound(Tanahyoji)
                                
                        SendFileRec.Title = "1"
'                        Call UniCode_Conv(SendFileRec.LCD, Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
'                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
'                        SendFileRec.CRLF = vbCrLf
                        
                        If j = 0 Then
                            Call UniCode_Conv(SendFileRec.LCD, "*" & Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
                        Else
                            Call UniCode_Conv(SendFileRec.LCD, " " & Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
                        End If
                        SendFileRec.CRLF = vbCrLf
                                            
                        Put #FileNo, , SendFileRec
                                            
                                            
                        Call UniCode_Conv(SendFileRec.LCD, "  商：" & Format(Tanahyoji(j).SUMI_QTY, "#0") & "  未：" & Format(Tanahyoji(j).MI_QTY, "#0"))
                        SendFileRec.CRLF = vbCrLf
                                            
                                            
                        
                        Put #FileNo, , SendFileRec
                            
                    Next j
                End If
        
        
                Close #FileNo
        
        
        End Select
    Next i
    
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Tanahyoji_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.fileName = B1_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.fileName = B1_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１～５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    Tanahyoji_Proc = False
    

End Function
Private Function Tanahyoji_Kaso_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『棚番表示(仮想優先)処理』
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07


Dim Tanaban     As String * 8
Dim ST_TANABAN  As String * 8


Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim Tanahyoji() As Tanahyoji_tag
Dim Tana_Cnt    As Integer


Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1


Dim MENU_NO     As String * 2   '2008.08.08


    Tanahyoji_Kaso_Proc = True

    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = CtrsWsk1.SendFolder & "\" & B9_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = CtrsWsk1.SendFolder & B9_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    '品目マスタ読み込み（標準棚番ＧＥＴ）
'                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                        ST_TANABAN = (StrConv(ITEMREC.ST_SOKO, vbUnicode) & StrConv(ITEMREC.ST_RETU, vbUnicode) & StrConv(ITEMREC.ST_REN, vbUnicode) & StrConv(ITEMREC.ST_DAN, vbUnicode))
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Tanahyoji_Kaso_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                Erase Tanahyoji
                Tana_Cnt = -1
        
                If Len(Trim(ST_TANABAN)) = 0 Then
                                            '標準棚番設定なし
                
                    Tana_Cnt = Tana_Cnt + 1
                    ReDim Tanahyoji(Tana_Cnt)
                    Tanahyoji(Tana_Cnt).Tanaban = ST_TANABAN
                
                    Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                    Tanahyoji(Tana_Cnt).MI_QTY = 0
                Else
                    If Zaiko_Syukei_Proc(SUMI_QTY, _
                                            MI_QTY, _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            Hinban, _
                                            ST_TANABAN) Then

            
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    End If
                    Tana_Cnt = Tana_Cnt + 1
                    ReDim Tanahyoji(Tana_Cnt)
                    Tanahyoji(Tana_Cnt).Tanaban = ST_TANABAN
                    Tanahyoji(Tana_Cnt).SUMI_QTY = SUMI_QTY
                    Tanahyoji(Tana_Cnt).MI_QTY = MI_QTY
                    
                    
                    
                End If
                
                Call UniCode_Conv(K6_ZAIKO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K6_ZAIKO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K6_ZAIKO.HIN_GAI, Hinban)
                Call UniCode_Conv(K6_ZAIKO.NYUKA_DT, "")
                Call UniCode_Conv(K6_ZAIKO.SOKO_NO, "")
                Call UniCode_Conv(K6_ZAIKO.Retu, "")
                Call UniCode_Conv(K6_ZAIKO.Ren, "")
                Call UniCode_Conv(K6_ZAIKO.Dan, "")
                    
                com = BtOpGetGreater
        
                SUMI_QTY = 0
                MI_QTY = 0
    
    
                Do
                    sts = BTRV(com, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K6_ZAIKO, Len(K6_ZAIKO), 6)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫データ", 0)
                            Exit Function
                    End Select
                
                    If StrConv(ZAIKOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                        StrConv(ZAIKOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                        Trim(StrConv(ZAIKOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                        '事業部／国内外／品番ブレーク
                        Exit Do
                    End If
                    
                    If (StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)) _
                        = ST_TANABAN Then
                        '標準棚番は対象外
                    Else
                        
                        '仮想倉庫を優先する
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, StrConv(ZAIKOREC.SOKO_NO, vbUnicode))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(SOKOREC.SOKO_BUN, BUN_JITU)
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫ﾏｽﾀ", 0)
                                Exit Function
                        End Select
                        
                        
                        
                        If StrConv(SOKOREC.SOKO_BUN, vbUnicode) = BUN_KASO Then
                        
                            If Tana_Cnt = (-1) Then
                                Tana_Cnt = Tana_Cnt + 1
                                ReDim Tanahyoji(Tana_Cnt)
                                Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                                If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    Tanahyoji(Tana_Cnt).MI_QTY = 0
                                Else
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                    Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                End If
                            
                            Else
                                For j = 0 To UBound(Tanahyoji)
                                    If Tanahyoji(j).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode) Then
                                        Exit For
                                    End If
                                Next j
                            
                                If j <= UBound(Tanahyoji) Then
                                
                                    If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                        Tanahyoji(j).SUMI_QTY = Tanahyoji(j).SUMI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    Else
                                        Tanahyoji(j).MI_QTY = Tanahyoji(j).MI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    End If
                                
                                
                                Else
                                
                                    Tana_Cnt = Tana_Cnt + 1
                                
                                    ReDim Preserve Tanahyoji(Tana_Cnt)
                                    Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                                    If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                        Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                        Tanahyoji(Tana_Cnt).MI_QTY = 0
                                    Else
                                        Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                        Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    End If
                                
                                End If
                            
                            End If
                        
                        End If
                    End If
                    
                    com = BtOpGetNext
                    
                Loop
        
        
                Call UniCode_Conv(K6_ZAIKO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K6_ZAIKO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K6_ZAIKO.HIN_GAI, Hinban)
                Call UniCode_Conv(K6_ZAIKO.NYUKA_DT, "")
                Call UniCode_Conv(K6_ZAIKO.SOKO_NO, "")
                Call UniCode_Conv(K6_ZAIKO.Retu, "")
                Call UniCode_Conv(K6_ZAIKO.Ren, "")
                Call UniCode_Conv(K6_ZAIKO.Dan, "")
                    
                com = BtOpGetGreater
        
                SUMI_QTY = 0
                MI_QTY = 0
    
    
                Do
                    sts = BTRV(com, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K6_ZAIKO, Len(K6_ZAIKO), 6)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫データ", 0)
                            Exit Function
                    End Select
                
                    If StrConv(ZAIKOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                        StrConv(ZAIKOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                        Trim(StrConv(ZAIKOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                        '事業部／国内外／品番ブレーク
                        Exit Do
                    End If
                    
                    If (StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)) _
                        = ST_TANABAN Then
                        '標準棚番は対象外
                    Else
                        
                        '仮想倉庫を優先する
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, StrConv(ZAIKOREC.SOKO_NO, vbUnicode))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(SOKOREC.SOKO_BUN, BUN_KASO)
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫ﾏｽﾀ", 0)
                                Exit Function
                        End Select
                        
                        
                        
                        If StrConv(SOKOREC.SOKO_BUN, vbUnicode) = BUN_JITU Then
                        
                            If Tana_Cnt = (-1) Then
                                Tana_Cnt = Tana_Cnt + 1
                                ReDim Tanahyoji(Tana_Cnt)
                                Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                                If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    Tanahyoji(Tana_Cnt).MI_QTY = 0
                                Else
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                    Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                End If
                            
                            Else
                                For j = 0 To UBound(Tanahyoji)
                                    If Tanahyoji(j).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode) Then
                                        Exit For
                                    End If
                                Next j
                            
                                If j <= UBound(Tanahyoji) Then
                                
                                    If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                        Tanahyoji(j).SUMI_QTY = Tanahyoji(j).SUMI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    Else
                                        Tanahyoji(j).MI_QTY = Tanahyoji(j).MI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    End If
                                
                                
                                Else
                                
                                    Tana_Cnt = Tana_Cnt + 1
                                
                                    ReDim Preserve Tanahyoji(Tana_Cnt)
                                    Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                                    If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                        Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                        Tanahyoji(Tana_Cnt).MI_QTY = 0
                                    Else
                                        Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                        Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    End If
                                
                                End If
                            
                            End If
                        
                        End If
                    End If
                    
                    com = BtOpGetNext
                    
                Loop
        
        
        
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
        
                SendFileRec.Title = "0"     'タイトル行
                Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME & Format(Tana_Cnt + 1, "#0") & "件")
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
        
        
                If Tana_Cnt > -1 Then
                                '集計テーブルよりデータ出力
                    For j = 0 To UBound(Tanahyoji)
                                
                        SendFileRec.Title = "1"
'                        Call UniCode_Conv(SendFileRec.LCD, Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
'                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
'                        SendFileRec.CRLF = vbCrLf
                        
                        If j = 0 Then
                            Call UniCode_Conv(SendFileRec.LCD, "*" & Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
                        Else
                            Call UniCode_Conv(SendFileRec.LCD, " " & Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
                        End If
                        SendFileRec.CRLF = vbCrLf
                                            
                        Put #FileNo, , SendFileRec
                                            
                                            
                        Call UniCode_Conv(SendFileRec.LCD, "  商：" & Format(Tanahyoji(j).SUMI_QTY, "#0") & "  未：" & Format(Tanahyoji(j).MI_QTY, "#0"))
                        SendFileRec.CRLF = vbCrLf
                                            
                                            
                        
                        Put #FileNo, , SendFileRec
                            
                    Next j
                End If
        
        
                Close #FileNo
        
        
        End Select
    Next i
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Tanahyoji_Kaso_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.fileName = B9_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.fileName = B9_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１～５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    Tanahyoji_Kaso_Proc = False
    

End Function
Private Function AKI_LOC_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『空きロケーション検索』
'       2010.12.13
'
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer
Dim k           As Integer


Dim Tanaban     As String * 8


Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim AKI_Tanahyoji() _
                As AKI_Tanahyoji_tag

Dim Tana_Cnt    As Integer
Dim Tana_Use    As String * 3

Dim wkTanaban   As String
Dim wkTana_Use  As String * 3


Dim MENU_NO     As String * 2   '2008.08.08


    AKI_LOC_Proc = True

    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = CtrsWsk1.SendFolder & "\" & BG_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = CtrsWsk1.SendFolder & BG_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Tanaban        '棚番
                Tanaban = Mid(ID_KANRI_TBL(ING_No).Recv_text(i), 2, 8)
                
                
                Call UniCode_Conv(K0_TANA.SOKO_NO, Mid(Tanaban, 1, 2))
                Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                Call UniCode_Conv(K0_TANA.Ren, "")
                Call UniCode_Conv(K0_TANA.Dan, "")
                
                
                sts = BTRV(BtOpGetGreater, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                Select Case sts
                    Case BtNoErr
                                            
                        If Mid(Tanaban, 1, 2) <> StrConv(TANAREC.SOKO_NO, vbUnicode) Or _
                            Mid(Tanaban, 3, 2) <> StrConv(TANAREC.Retu, vbUnicode) Then
                            '   -------------------------------- エラーメッセージ作成
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 4), "棚番エラー", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            AKI_LOC_Proc = False
                            Exit Function
                        End If
                    
                    
                    Case BtErrEOF
                        '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 4), "棚番エラー", "", "")
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        AKI_LOC_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                        Exit Function
                End Select
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                Erase AKI_Tanahyoji
                Tana_Cnt = -1
                
                
                
                Call UniCode_Conv(K0_TANA.SOKO_NO, Mid(Tanaban, 1, 2))
                Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                Call UniCode_Conv(K0_TANA.Ren, "")
                Call UniCode_Conv(K0_TANA.Dan, "")
                
                
                
                Do
                    
                    DoEvents
                    
                    sts = BTRV(BtOpGetGreater, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                    Select Case sts
                        Case BtNoErr
                                                
                            If Mid(Tanaban, 1, 2) <> StrConv(TANAREC.SOKO_NO, vbUnicode) Or _
                                Mid(Tanaban, 3, 2) <> StrConv(TANAREC.Retu, vbUnicode) Then
                            
                                Exit Do
                            End If
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                            Exit Function
                    End Select
                
                
                    If Not IsNumeric(StrConv(TANAREC.Tana_Use, vbUnicode)) Then
                        If Trim(StrConv(TANAREC.Tana_Use, vbUnicode)) = "." Then
                            Tana_Use = Trim(StrConv(TANAREC.Tana_Use, vbUnicode))
                        Else
                            Tana_Use = "100"
                        End If
                    Else
                        Tana_Use = StrConv(TANAREC.Tana_Use, vbUnicode)
                    End If
                
                    If Val(Tana_Use) < 100 Then
                    
                        Tana_Cnt = Tana_Cnt + 1
                        ReDim Preserve AKI_Tanahyoji(Tana_Cnt)
                        
                        AKI_Tanahyoji(Tana_Cnt).Tanaban = StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                        AKI_Tanahyoji(Tana_Cnt).Tana_Use = Tana_Use
                    
                    End If
                
                Loop
        
                If Tana_Cnt < 1 Then
                Else
                    For j = 0 To UBound(AKI_Tanahyoji) - 1
                        
                        For k = j To UBound(AKI_Tanahyoji)
                                                
                            If AKI_Tanahyoji(j).Tana_Use > AKI_Tanahyoji(k).Tana_Use Then
                                wkTanaban = AKI_Tanahyoji(k).Tanaban
                                wkTana_Use = AKI_Tanahyoji(k).Tana_Use
                                    
                                AKI_Tanahyoji(k).Tanaban = AKI_Tanahyoji(j).Tanaban
                                AKI_Tanahyoji(k).Tana_Use = AKI_Tanahyoji(j).Tana_Use
                                    
                                AKI_Tanahyoji(j).Tanaban = wkTanaban
                                AKI_Tanahyoji(j).Tana_Use = wkTana_Use
                                    
                            
                            
                            End If
                        Next k
                    
                    Next j
                End If
        
        
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
        
                SendFileRec.Title = "0"     'タイトル行
                Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                
                Call UniCode_Conv(SendFileRec.LCD, "棚番:" & Left(Tanaban, 4))
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
        
                        
        
        
        
                If Tana_Cnt > -1 Then
                                '集計テーブルよりデータ出力
                    For j = 0 To UBound(AKI_Tanahyoji)
                                
                        SendFileRec.Title = "1"
                        
                        
                        If Trim(AKI_Tanahyoji(j).Tana_Use) = "." Then
                            Call UniCode_Conv(SendFileRec.LCD, Left(Tanaban, 4) & AKI_Tanahyoji(j).Tanaban & " " & StrConv(" .%", vbWide))
                        Else
                            Call UniCode_Conv(SendFileRec.LCD, Left(Tanaban, 4) & AKI_Tanahyoji(j).Tanaban & " " & StrConv(Space(2 - Len(Format(AKI_Tanahyoji(j).Tana_Use, "0"))), vbWide) & StrConv(Format(AKI_Tanahyoji(j).Tana_Use, "0") & "%", vbWide))
                        End If
                                            
                        SendFileRec.CRLF = vbCrLf
                                            
                        Put #FileNo, , SendFileRec
                                            
                            
                    Next j
                End If
        
        
                Close #FileNo
        
        
        End Select
    Next i
    
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            ID_KANRI_TBL(ING_No).JGYOBU, _
                                            ID_KANRI_TBL(ING_No).NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            , , , Tanaban) Then
            AKI_LOC_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.fileName = BG_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.fileName = BG_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１～５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    AKI_LOC_Proc = False
    

End Function





Private Function SAI_SU_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『入り数／口数処理』
'
'-------------------------------------------------------
Dim sts         As Integer
Dim i           As Integer
Dim Hinban      As String
Dim SAI_SU      As String
Dim KUCHI_SU    As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2   '2008.08.08

Dim wkNum1      As Double
Dim wkNum2      As Double

Dim wkKUTI_SU   As String


    SAI_SU_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                SAI_SU_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            '   -------------------------------- 送信テキスト作成
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
            
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            
            
            
            If IsNumeric(StrConv(ITEMREC.SAI_SU, vbUnicode)) Then
                ID_KANRI_TBL(ING_No).SAI_SU = StrConv(ITEMREC.SAI_SU, vbUnicode)    '送信する才数
            Else
                ID_KANRI_TBL(ING_No).SAI_SU = "00.0"
            End If
            
            If IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                ID_KANRI_TBL(ING_No).KUTI_SU = ToRoundDown(CCur(StrConv(ITEMREC.KUTI_SU, vbUnicode)), 0) '送信する口
            Else
                ID_KANRI_TBL(ING_No).KUTI_SU = "0"
            End If
            
            
            If Trim(StrConv(ITEMREC.KONPOU_F, vbUnicode)) <> "1" Then
                ID_KANRI_TBL(ING_No).KUTI_SU = "0"
            End If
                        
            
            
            
            
            
            
            If IsNumeric(StrConv(ITEMREC.D_SIZE_W, vbUnicode)) Then
                ID_KANRI_TBL(ING_No).SIZE_W = StrConv(ITEMREC.D_SIZE_W, vbUnicode)    '送信する(W)
            Else
                ID_KANRI_TBL(ING_No).SIZE_W = "00000000"
            End If
            
            If IsNumeric(StrConv(ITEMREC.D_SIZE_D, vbUnicode)) Then
                ID_KANRI_TBL(ING_No).SIZE_D = StrConv(ITEMREC.D_SIZE_D, vbUnicode)    '送信する(D)
            Else
                ID_KANRI_TBL(ING_No).SIZE_D = "00000000"
            End If
            
            If IsNumeric(StrConv(ITEMREC.D_SIZE_H, vbUnicode)) Then
                ID_KANRI_TBL(ING_No).SIZE_H = StrConv(ITEMREC.D_SIZE_H, vbUnicode)    '送信する(H)
            Else
                ID_KANRI_TBL(ING_No).SIZE_H = "00000000"
            End If
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.fileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
    
            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_BCNUM
                                                            '表示内容
            
            
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, LCD_SIZE_W_S & Space(M_Keta - (Len(LCD_SIZE_W_S) * 2) - 8 + (8 - Len(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")))) & Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, LCD_SIZE_W_S & Space(M_Keta - (Len(LCD_SIZE_W_S) * 2) - 8 + (8 - Len(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")))) & Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, LCD_SIZE_W_S)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, LCD_SIZE_W_S)
                                                            
                                                            '数値初期表示
'            Send_Text.Box_Type(0).INIT = Space(10 - Len(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))) & Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = Space(10 - Len(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))) & Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")
            Send_Text.Box_Type(0).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))
                                                            
                                                            
                                                            
                                                            
                                                            '初期カーソル位置
'            Send_Text.Box_Type(0).Start_Pos = Format(10 - Len(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")), "00")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = Format(10 - Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"), "00")
'            Send_Text.Box_Type(0).Start_Pos = 10 + Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))) - 2
            Send_Text.Box_Type(0).Start_Pos = "07"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = "07"
                                                            
                                                            
                                                            
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "03"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "03"
                                                                                
                                                                                
                                                                                
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCNUM
                                                            '表示内容
            
            
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_SIZE_D_S)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_SIZE_D_S)
                                                            
                                                            
                                                            '数値初期表示
                                                            
                                                            
            Send_Text.Box_Type(1).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0"))
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0"))
                                                            
                                                            
                                                            
                                                            
                                                            '初期カーソル位置
'            Send_Text.Box_Type(1).Start_Pos = 10 + Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0"))) - 2
            Send_Text.Box_Type(1).Start_Pos = "07"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "07"
                                                            
                                                            
                                                            
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "03"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "03"
                                                                                
                                                                                
                                                                                
                                                                                
            Send_Text.Box_Type(1).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                            '表示内容
            
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_SIZE_H_S)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_SIZE_H_S)
                                                            
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_H), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_H), "#0"))
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_H), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_H), "#0"))
                                                            
                                                            
                                                            
                                                            
                                                            '初期カーソル位置
'            Send_Text.Box_Type(2).Start_Pos = 10 + Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0"))) - 2
            Send_Text.Box_Type(2).Start_Pos = "07"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "07"
                                                            
                                                            
                                                            
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "03"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "03"
                                                                                
                                                                                
                                                                                
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            
            
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
            
            
            
            wkNum1 = Val(ID_KANRI_TBL(ING_No).SIZE_W) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_D) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_H) / 1000
            wkNum1 = ToHalfAdjust(CCur(Val(ID_KANRI_TBL(ING_No).SIZE_W) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_D) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_H) / 1000), 4)
            
            
            
            
            If IsNumeric(StrConv(ITEMREC.SAI_SU, vbUnicode)) Then
                wkNum2 = CCur(StrConv(ITEMREC.SAI_SU, vbUnicode))
            Else
                wkNum2 = ToHalfAdjust(wkNum1 / 0.028, 1)
            End If
            
            ID_KANRI_TBL(ING_No).SAI_SU = Format(wkNum2, "00.0")
            
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SAI_SU_S1 & Format(wkNum2, "0.0") & "(" & Format(wkNum1, "0.000") & ")")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SAI_SU_S1 & Format(wkNum2, "0.0") & "(" & Format(wkNum1, "0.00") & ")")
                                                            
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = ""            '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            
            
            
            
            
            
            
            '-----------------------------------------------５行目
                                                                     
'口数４

                                                                     
                                                                     'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            
            
'            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_KUTI_SU_S1 & Space(M_Keta - (Len(LCD_KUTI_SU_S) * 2) - 4 + (4 - Len(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0")))) & Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0"))
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_KUTI_SU_S1 & Space(M_Keta - (Len(LCD_KUTI_SU_S) * 2) - 4 + (4 - Len(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0")))) & Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0"))
                                                            
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_KUTI_SU_S1)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_KUTI_SU_S1)
                                                            
                                                            
                                                            '数値初期表示
                                                            
                                                            
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0"))
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0"))
                                                            
                                                            
                                                            
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = "14"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "14"
                                                            
                                                            
                                                            
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "02"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "02"
                                                                                
                                                                                
                                                                                
                                                                                
            Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_SIZE_W_S          'W
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "サイズ(W)エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SAI_SU_Proc = False
                            Exit Function
                        End If
                
                        ID_KANRI_TBL(ING_No).SIZE_W = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
            
                    Case LCD_SIZE_D_S          'D
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "サイズ(D)エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SAI_SU_Proc = False
                            Exit Function
                        End If
                
                        ID_KANRI_TBL(ING_No).SIZE_D = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
            
            
                    Case LCD_SIZE_H_S          'H
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "サイズ(H)エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SAI_SU_Proc = False
                            Exit Function
                        End If
                
                        ID_KANRI_TBL(ING_No).SIZE_H = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
            
            
                    Case LCD_KUTI_SU_S1         '口数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SAI_SU_Proc = False
                            Exit Function
                        End If
                
                        If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) < 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SAI_SU_Proc = False
                            Exit Function
                        End If
                
                
                        ID_KANRI_TBL(ING_No).KUTI_SU = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
            
            
        
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                        '品目マスタ読込み
            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
            Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).Hinban)
            Do
                sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")

                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                        SAI_SU_Proc = False
                        GoTo Abort_Tran
                    Case BtErrKeyNotFound
                    '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品番未登録", "", "")

                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                        SAI_SU_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目マスタ", 0)
                        SAI_SU_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select

            Loop
                                        'W
            Call UniCode_Conv(ITEMREC.D_SIZE_W, Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "00000000"))
                                        'D
            Call UniCode_Conv(ITEMREC.D_SIZE_D, Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "00000000"))
                                        'D
            Call UniCode_Conv(ITEMREC.D_SIZE_H, Format(Val(ID_KANRI_TBL(ING_No).SIZE_H), "00000000"))
                                        '才数
            
            wkNum1 = Val(ID_KANRI_TBL(ING_No).SIZE_W) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_D) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_H) / 1000
            wkNum1 = ToHalfAdjust(CCur(Val(ID_KANRI_TBL(ING_No).SIZE_W) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_D) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_H) / 1000), 4)
            wkNum2 = ToHalfAdjust(wkNum1 / 0.028, 1)
            
            
            
            Call UniCode_Conv(ITEMREC.SAI_SU, Format(wkNum2, "000.00"))
                                        '口数
            
            
            
            If Val(ID_KANRI_TBL(ING_No).KUTI_SU) = 0 Then
                Call UniCode_Conv(ITEMREC.KONPOU_F, "0")
            Else
                Call UniCode_Conv(ITEMREC.KONPOU_F, "1")
                Call UniCode_Conv(ITEMREC.KUTI_SU, Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "00.0"))
            End If


        
            Call UniCode_Conv(ITEMREC.UPD_TANTO, App.EXEName)                                   '更新担当者ｺｰﾄﾞ
                                                                                                '更新日時
            Call UniCode_Conv(ITEMREC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))



'                                        '品目マスタ書き込み
            Do
                sts = BTRV(BtOpUpdate, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE

                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")

                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                        SAI_SU_Proc = False
                        GoTo Abort_Tran

                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpUpdate, "品目マスタ", 0)
                        SAI_SU_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
            Loop
        
        
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        '次の作業要求
            
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    SAI_SU_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If
    

End Function






Private Function Hin_Shogo_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『品番別在庫照合処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim Tanaban         As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MEMO            As String

Dim MENU_NO         As String

    Hin_Shogo_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then     '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Hin_Shogo_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 混載チェック
'                            If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
'                                If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
'                                    StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
'                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
'                                    SendBuf = Text_Create_Proc()
'                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                    Hin_Shogo_Proc = False
'                                    Exit Function
'                                End If
'                            End If
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Hin_Shogo_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
            
                            '------------------ 禁止棚のチェック
'                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
'
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(To_Tanaban, 2) & "-" & Mid(To_Tanaban, 3, 2) & "-" & Mid(To_Tanaban, 5, 2) & "-" & Right(To_Tanaban, 2), "棚使用不可", "", "")
'
'                                SendBuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                Ido_In_Proc = False
'                                Exit Function
'                            End If
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            Hin_Shogo_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Shogo_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            '   -------------------------------- 在庫数集計
            If Zaiko_Syukei_Proc(SUMI_QTY, _
                                    MI_QTY, _
                                    RET_JGYOBU, _
                                    RET_NAIGAI, Hinban) Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            '   -------------------------------- 送信テキスト作成
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = Tanaban          '棚番をセーブ
            
            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
            
            
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
                                                        
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.fileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
    
            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "13"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Shogo_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
            
            
                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Shogo_Proc = False
                            Exit Function
                        End If
                
                
                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            
                        Else
                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        
                        End If
        
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                        '品目マスタ読込み
            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).S_JGYOBU)
            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).S_NAIGAI)
            Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).Hinban)
            Do
                sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Hin_Shogo_Proc = False
                        GoTo Abort_Tran
                    Case BtErrKeyNotFound
                    '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品番未登録", "", "")
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Hin_Shogo_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目マスタ", 0)
                        Hin_Shogo_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
        
            Loop
                                        '最終照合日付
            Call UniCode_Conv(ITEMREC.LAST_CHK_DT, Format(Date, "yyyymmdd"))
                                        '最終照合在庫数
            Call UniCode_Conv(ITEMREC.LAST_CHK_QTY, Format(SUMI_QTY + MI_QTY, "00000000"))
                                        '品目マスタ書き込み
            Do
                sts = BTRV(BtOpUpdate, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
            
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Hin_Shogo_Proc = False
                        GoTo Abort_Tran
            
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpUpdate, "品目マスタ", 0)
                        Hin_Shogo_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
            Loop
        
            If (SUMI_QTY + MI_QTY) = (ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY) Then
                MEMO = B2_MEMO & StrConv(Format((SUMI_QTY + MI_QTY), "#0"), vbWide) & "[OK]"
            Else
                MEMO = B2_MEMO & StrConv(Format((ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY), "#0"), vbWide) & "[" & StrConv(Format(SUMI_QTY + MI_QTY, "#0"), vbWide) & "]"
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
                                
                                
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        MEMO, , , , , MENU_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Shogo_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        
    
    
                
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        '次の作業要求
            
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Hin_Shogo_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Private Function MTS_Dec_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『向け先宣言での出荷処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8

'2010.12.07
Dim Hinban          As String * 13
'Dim Hinban          As String * 20
'2010.12.07

Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    MTS_Dec_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    MTS_Dec_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    MTS_Dec_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                MTS_Dec_Proc = False
                                Exit Function
                            End If
                        End If
                            
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            MTS_Dec_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                MTS_Dec_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
            ID_NO = ""
            sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                    Hinban, _
                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                    ID_KANRI_TBL(ING_No).SS_CODE, _
                                    ID_KANRI_TBL(ING_No).CYU_KBN, _
                                    Y_SYU_CNT, _
                                    ID_NO, _
                                    SYUKA_QTY, _
                                    DEN_NO, _
                                    KAN_KBN)
            Select Case sts
                Case False          '正常
                    If Y_SYU_CNT = 0 Then   '対象データなし
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "出荷予定無し", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        MTS_Dec_Proc = False
                        Exit Function
                    End If
                
                Case True
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "出荷予定使用中", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    MTS_Dec_Proc = False
                    Exit Function
            End Select
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    MTS_Dec_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                MTS_Dec_Proc = False
                Exit Function
            End If
        
                
        
        
            ID_KANRI_TBL(ING_No).Tanaban = Tanaban          '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Y_SYU_CNT = Y_SYU_CNT      '該当伝票枚数
            ID_KANRI_TBL(ING_No).ID_NO = ID_NO              '伝票№
            ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO            '伝票№
            ID_KANRI_TBL(ING_No).YUKO_SUMI_QTY = SUMI_QTY   '使用可能な商品化済み在庫
            ID_KANRI_TBL(ING_No).YUKO_MI_QTY = MI_QTY       '使用可能な未商品在庫
        
        
            Select Case Y_SYU_CNT
                Case 1              '対象伝票が１枚
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                    ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                    '数量付きの送信メッセージを作成する
                    Send_Text.sts = Sts_OK                                      'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                    Send_Text.Display_Flg = Display_DEF                         '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                    Send_Text.End_Menu = Menu_Only                              '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                                   'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                    Send_Text.fileName = ""                                     '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
    
                    Send_Text.Buzzer = Buzzer_DEF                               'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                
                    '-----------------------------------------------１行目
                                                                                'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                                                '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                    Send_Text.Box_Type(0).MENU = ""                             'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                                'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "08"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "13"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '-----------------------------------------------４行目
                                                                            'BOX属性
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                            
                    If SYUKA_QTY > (SUMI_QTY + MI_QTY) Then
                        SYUKA_QTY = SUMI_QTY + MI_QTY           '在庫数が少ない時は在庫数を送信
                    End If
                                                                            
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                                                                            
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "05"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
                    Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                                                                            'BOX属性
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
                    Sendbuf = Text_Create_Proc()
                
                
                Case Else           '対象伝票が複数枚
            
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                    
                    '数量付きの送信メッセージを作成する
                    Send_Text.sts = Sts_OK                                      'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                    Send_Text.Display_Flg = Display_DEF                         '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                    Send_Text.End_Menu = Menu_Only                              '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                                   'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                    Send_Text.fileName = ""                                     '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
    
                    Send_Text.Buzzer = Buzzer_DEF                               'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                
                    '-----------------------------------------------１行目
                                                                                'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                                                '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                    Send_Text.Box_Type(0).MENU = ""                             'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                                'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "08"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                            '入力桁数
                    '2010.12.07
'                    Send_Text.Box_Type(2).Max_Size = "13"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                    Send_Text.Box_Type(2).Max_Size = "20"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                    '2010.12.07
                                                                                
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '-----------------------------------------------４行目
                                                                            'BOX属性
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_ID_No)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_ID_No)
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "08"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "08"
                                                                                
                    Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                                                                            'BOX属性
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
                    Sendbuf = Text_Create_Proc()
            
            End Select
        
        Case Step_Sagyo2_RES        '２回目の受信（出荷数／伝票ＩＤ）
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    Case LCD_Syuka      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                    
                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    
                                    '出庫処理
                        sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                    0, _
                                    0, _
                                    SYUKA_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).CYU_KBN, _
                                    ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).DEN_NO, _
                                    ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                MTS_Dec_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        '次の作業要求
                        
                        
                        '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                Call Err_Send_Proc("データ使用中", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                        
                        
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
            
                        Sendbuf = Text_Create_Proc()
            
            
            
                    Case LCD_ID_No      '伝票ＩＤ
                
'''                        If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'''                            ID_NO = Format(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "00000000")
'''                        Else
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
'''                        End If
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                "", _
                                                "", _
                                                "", _
                                                "", _
                                                "", _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    MTS_Dec_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "出荷予定使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                MTS_Dec_Proc = False
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                
                        '------------------ 確定した出荷予定の予定数を送信する
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                        '数量付きの送信メッセージを作成する
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                                    Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                                    Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
                                                                            '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                            '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "08"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                            'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                            '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                            '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "13"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                            'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                            
                        If SYUKA_QTY > (ID_KANRI_TBL(ING_No).YUKO_SUMI_QTY + ID_KANRI_TBL(ING_No).YUKO_MI_QTY) Then
                            SYUKA_QTY = ID_KANRI_TBL(ING_No).YUKO_SUMI_QTY + ID_KANRI_TBL(ING_No).YUKO_MI_QTY
                        End If
                                                                            
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                                                                            '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                                                                            '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                            '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                            'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（出荷数）
            For i = 0 To M_Gyo - 1
            
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    Case LCD_Syuka      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    '出庫処理
                        sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                    0, _
                                    0, _
                                    SYUKA_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).CYU_KBN, _
                                    ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).DEN_NO, _
                                    ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                MTS_Dec_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        '次の作業要求
                        
                        
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
            
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
    End Select

    MTS_Dec_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Private Function DEN_ID_Dec_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『伝票ＩＤでの出荷処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8


Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim KAN_KBN         As String * 1

Dim MENU_NO         As String * 2

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim wkTEXT          As String       '2007.07.21


Dim HAIKI_F         As Boolean      '2010.02.22
Dim j               As Integer      '2010.02.22


    DEN_ID_Dec_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            RET_JGYOBU = Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 1)
                            ID_NO = Right(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 12)
                        Else
                            RET_JGYOBU = ID_KANRI_TBL(ING_No).JGYOBU
'''                            If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'''                                ID_NO = Format(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "00000000")
'''                            Else
                                ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
'''                            End If
                        End If
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                RET_JGYOBU, _
                                                RET_NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    DEN_ID_Dec_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                DEN_ID_Dec_Proc = False
                                Exit Function
                        End Select
                
                
                        If KAN_KBN <> KAN_KBN_UN Then
                            
                            
'---------------------------    データ解放を追加    2011.07.29
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
'---------------------------    データ解放を追加    2011.07.29
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫処理済み", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
                                                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                           
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        '2009.07.29
                        If SYUKA_QTY > 1 Then
                        
                            Send_Text.Buzzer = Wel_SYUKA_BUZZER                 'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        Else
                            Send_Text.Buzzer = Buzzer_DEF                       'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        End If
                        
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "09"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
'2007.07.21                        Send_Text.Box_Type(3).Max_Size = "13"
'2007.07.21                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番／数量）
            For i = 0 To M_Gyo - 1
                
                
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case wkTEXT
                '2007.07.21 ↑
                                    
                    
                    
                    Case LCD_Tanaban    '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    DEN_ID_Dec_Proc = False
                                    Exit Function
                    
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
            
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    DEN_ID_Dec_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                DEN_ID_Dec_Proc = False
                                Exit Function
                            End If
                        End If
                            
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        
                        If ID_KANRI_TBL(ING_No).JGYOBU = ID_KANRI_TBL(ING_No).S_JGYOBU And _
                            ID_KANRI_TBL(ING_No).NAIGAI = ID_KANRI_TBL(ING_No).S_NAIGAI Then
                        
                            sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        
                        Else
                        
                            sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, ID_KANRI_TBL(ING_No).S_NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        
                        End If
                        
                        
                        
                        
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            DEN_ID_Dec_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                DEN_ID_Dec_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                    
                    
'2007.07.21                        If Hinban <> ID_KANRI_TBL(ING_No).Hinban Then
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                        
                        '   -------------------------------- エラーメッセージ作成
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            DEN_ID_Dec_Proc = False
                            Exit Function
                        
                        End If
                    
                    
                    Case LCD_Syuka      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
                        
                        
                        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                DEN_ID_Dec_Proc = False
                                Exit Function
                        End Select
                    
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
                        
                        
                        
                        If SYUKA_QTY > (SUMI_QTY + MI_QTY) Then
                            Call Err_Send_Proc("出荷数不足", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    '出庫処理
                        '2010.02.22　↓
                        HAIKI_F = False
                                    
                        If HAIKI_MTS_F Then
                                    
                            For j = 0 To UBound(HAIKI_MTS)
                            
                            
                                If Trim(ID_KANRI_TBL(ING_No).MTS_CODE) = HAIKI_MTS(j) Then
                                
                            
                                    HAIKI_F = True
                                    Exit For
                                
                                End If
                            
                            Next j
                                    
                        End If
                                    
                                    
                                    '出庫処理
                        
                        
                        If HAIKI_F Then
                        
                        
                            sts = Syuko_Update_HAIKI_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        Hinban, _
                                        "", _
                                        Tanaban, _
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                        0, _
                                        0, _
                                        SYUKA_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).CYU_KBN, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_NO, _
                                        ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        
                        Else
                        '2010.02.22 ↑
                        
                            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        Hinban, _
                                        "", _
                                        Tanaban, _
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                        0, _
                                        0, _
                                        SYUKA_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).CYU_KBN, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_NO, _
                                        ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        
                        
                        
                        End If
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                DEN_ID_Dec_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        
                                        
                        '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                Call Err_Send_Proc("データ使用中", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                        
                                        
                                        '次の作業要求
                                        
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
            
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
    End Select
    DEN_ID_Dec_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function
Private Function SYUKO_HYO_Dec_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『出庫表での出荷処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8
Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim wkTEXT          As String



Dim HAIKI_F         As Boolean      '2010.02.22
Dim j               As Integer      '2010.02.22



    SYUKO_HYO_Dec_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（出庫表№）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SYUKO_HYO_No   '出庫表№
    
                        
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫表使用不可", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                        
'''                        If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'''                            ID_NO = Format(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "000000000000")
'''                        Else
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
'''                        End If
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                "", _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_Proc = False
                                Exit Function
                        End Select
                
                        If KAN_KBN <> KAN_KBN_UN Then
                            
'---------------------------    データ解放を追加    2011.07.29
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
'---------------------------    データ解放を追加    2011.07.29
                            
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫処理済み", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        '2009.07.29
                        If SYUKA_QTY > 1 Then
                        
                            Send_Text.Buzzer = Wel_SYUKA_BUZZER                 'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        Else
                            Send_Text.Buzzer = Buzzer_DEF                       'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        End If
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "09"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
'2007.07.21                        Send_Text.Box_Type(3).Max_Size = "13"
'2007.07.21                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番／数量）
            For i = 0 To M_Gyo - 1
                
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                Select Case wkTEXT
                '2007.07.21 ↑
                
                
                    Case LCD_Tanaban    '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_Proc = False
                                    Exit Function
                    
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
            
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    SYUKO_HYO_Dec_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                SYUKO_HYO_Dec_Proc = False
                                Exit Function
                            End If
                        End If
                            
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            SYUKO_HYO_Dec_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                SYUKO_HYO_Dec_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                    
                    
'2007.07.21                        If Hinban <> ID_KANRI_TBL(ING_No).Hinban Then
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                        
                        '   -------------------------------- エラーメッセージ作成
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        
                        End If
                    
                    
                    Case LCD_Syuka      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_Proc = False
                                Exit Function
                        End Select
                    
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                        
                        
                        If SYUKA_QTY > (SUMI_QTY + MI_QTY) Then
                            Call Err_Send_Proc("出荷数不足", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                    
                                    
                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    
                        '2010.02.22　↓
                        HAIKI_F = False
                                    
                        If HAIKI_MTS_F Then
                                    
                            For j = 0 To UBound(HAIKI_MTS)
                            
                            
                                If Trim(ID_KANRI_TBL(ING_No).MTS_CODE) = HAIKI_MTS(j) Then
                                
                            
                                    HAIKI_F = True
                                    Exit For
                                
                                End If
                            
                            Next j
                                    
                        End If
                                    
                                    
                                    '出庫処理
                        
                        
                        If HAIKI_F Then
                        
                        
                            sts = Syuko_Update_HAIKI_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        Hinban, _
                                        "", _
                                        Tanaban, _
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                        0, _
                                        0, _
                                        SYUKA_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).CYU_KBN, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_NO, _
                                        ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        
                        Else
                        '2010.02.22 ↑
                        
                            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        Hinban, _
                                        "", _
                                        Tanaban, _
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                        0, _
                                        0, _
                                        SYUKA_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).CYU_KBN, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_NO, _
                                        ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        
                        
                        
                        End If
                        
                        
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        
                                        
                        '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                Call Err_Send_Proc("データ使用中", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                        
                                        '次の作業要求
                                        
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                           '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
            
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
    End Select
    SYUKO_HYO_Dec_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function

Private Function SYUKO_HYO_Dec_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   大阪PC向け『出庫表での出荷処理』    2007.03.16
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long

Dim MI_QTY          As Long

Dim i               As Integer

Dim Y_SYU_CNT       As Integer

Dim Y_SURYO         As Long
Dim J_SURYO         As Long

Dim ID_NO           As String * 12
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim BIN_NO          As String * 2   '2007.05.16

Dim DEN_NO          As String * 6   '2007.06.12
Dim Found_F         As Integer      '2007.06.12
Dim SEQ_NO          As String * 3   '2007.06.12
Dim QTY             As Long         '2007.06.12

Dim wkTEXT          As String

Dim Mod_Return      As Integer      '2010.12.09
Dim iNum            As Integer      '2010.12.09
'Dim wkIri_Su        As String * 8
'Dim j               As Integer


    SYUKO_HYO_Dec_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（出庫表№）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SYUKO_HYO_No   '出庫表№
    
                        
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) <> 12 Then
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫表№？？", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_OSAKA_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                ID_KANRI_TBL(ING_No).NAIGAI, _
                                                Hinban, _
                                                Y_SYU_CNT, _
                                                Y_SURYO, _
                                                J_SURYO, _
                                                ID_NO, _
                                                BIN_NO)         '2007.05.16
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_OSAKA_Proc = False
                                    Exit Function
                                End If
                
                                If Y_SURYO <= J_SURYO Then
                
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫処理済み", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_OSAKA_Proc = False
                                    Exit Function
                                            
                                End If
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_OSAKA_Proc = False
                                Exit Function
                        End Select
                
                
                        '2010.12.09
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(ITEMREC.GAISO_IRI_QTY, "")
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        
                        End Select
                        '2010.12.09
                                                    
                        
                        
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        
                        SYUKA_QTY = Y_SURYO - J_SURYO
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                        
                        
                        ID_KANRI_TBL(ING_No).BIN_NO = BIN_NO        '2007.05.16
                        
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN_SPO  '2007.05.16
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
'                                                                                'BOX属性
'                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(0).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(0).Start_Pos = ""
'
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(0).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
'                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
'                        '-----------------------------------------------２行目
'                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "出庫№:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "出庫№:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "09"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "09"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        '2010.12.07
'                        Send_Text.Box_Type(3).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                        Send_Text.Box_Type(2).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                        '2010.12.07
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OSAKA_Syuka & Space(M_Keta - (Len(LCD_OSAKA_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OSAKA_Syuka & Space(M_Keta - (Len(LCD_OSAKA_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                                                                            
                                                                                '数値初期表示
                        
                        If SYUKO_QTY = 1 Then   '2007.08.02
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                        Else
                            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                        End If
                                                                                                            
                                                                                
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                                '入力桁数
                         Send_Text.Box_Type(3).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""





                        '-----------------------------------------------４行目
                                                                                    'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
'                        Call UniCode_Conv(ITEMREC.GAISO_IRI_QTY, " 3 ")
'                        wkIri_Su = StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)
'                        For j = 1 To Len(wkIri_Su)
'                            If Mid(wkIri_Su, j, 1) < " " Then
'                                Mid(wkIri_Su, j, 1) = " "
'                            End If
'                        Next j
                        
                        '2010.12.09
                        If IsNumeric(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)) Then
                            If Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)) <> 0 Then
                                Mod_Return = SYUKA_QTY Mod Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                                iNum = CInt(ToRoundDown(CCur(SYUKA_QTY) / CCur(Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))), 0))
                        
                                
                                Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                        
                        
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                
                                If Mod_Return <> 0 Then
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱＋" & StrConv(Format(Mod_Return, "#0"), vbWide) & "余")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱＋" & StrConv(Format(Mod_Return, "#0"), vbWide) & "余")
                                Else
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱")
                                End If
                                
                                
''Call LOG_OUT(LOG_F, Hinban & " " & StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode) & " " & StrConv(Send_Text.Box_Type(4).LCD, vbUnicode))
                                
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                 Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            End If
                        
                                                    
                        End If







                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番／数量）
            For i = 0 To M_Gyo - 1
                

                '2010.12.07 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                Select Case wkTEXT


'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    
                '2010.12.07 ↑
                    
                    Case LCD_Tanaban    '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_OSAKA_Proc = False
                                    Exit Function
                    
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
            
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    SYUKO_HYO_Dec_OSAKA_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                SYUKO_HYO_Dec_OSAKA_Proc = False
                                Exit Function
                            End If
                        End If
                            
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            SYUKO_HYO_Dec_OSAKA_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                SYUKO_HYO_Dec_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                    
                    
                        If Hinban <> ID_KANRI_TBL(ING_No).Hinban Then
                        
                        '   -------------------------------- エラーメッセージ作成
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        
                        End If
                    
                    
                    
                        '伝票№未登録は出荷不可 2007.06.12
                        If Left(Tanaban, 2) = NYUKA_SOKO_NO Then
                            
                    
                    
                    
                    
                    
                            '------------------ 入荷データの確認
                            sts = Y_Nyuka_O_Chek_Proc(3, RET_JGYOBU, _
                                                        RET_NAIGAI, _
                                                        Hinban, _
                                                        DEN_NO, _
                                                        Found_F, _
                                                        SEQ_NO, _
                                                        QTY)
                    
                    
                    
                            Select Case sts
                                Case False          '正常
                                    If Found_F = 9 Then
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "該当品番使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SYUKO_HYO_Dec_OSAKA_Proc = False
                                        Exit Function
                                    End If
                    
                    
                                    If Found_F = 1 Then
                                        If Trim(DEN_NO) = "" Or DEN_NO = "000000" Then
                    
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "伝票番号未入力です。", "入庫作業を、", "完了させて下さい。")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SYUKO_HYO_Dec_OSAKA_Proc = False
                                            Exit Function
                                        End If
                                    End If
                    
                                Case True, SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                Case SYS_CANCEL
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "該当品番使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_OSAKA_Proc = False
                                    Exit Function
                            End Select
                    
                    
                    
                    
                        End If
                    Case LCD_OSAKA_Syuka      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_OSAKA_Proc = False
                                Exit Function
                        End Select
                    
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        
                        If SYUKA_QTY > (SUMI_QTY + MI_QTY) Then
                            Call Err_Send_Proc("出荷数不足", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                    
                                    
                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    
                                    
                                    
                                    '出庫処理
                        sts = Syuko_OSAKA_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                    Hinban, _
                                    "", _
                                    Tanaban, _
                                    ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                    0, _
                                    0, _
                                    SYUKA_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).CYU_KBN, _
                                    ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).DEN_NO, _
                                    ID_KANRI_TBL(ING_No).ID_NO, _
                                    MENU_NO, _
                                    ID_KANRI_TBL(ING_No).BIN_NO)
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_OSAKA_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        
                                        
                        '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                Call Err_Send_Proc("データ使用中", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                        
                                        '次の作業要求
                                        
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                           '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
            
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
    End Select
    SYUKO_HYO_Dec_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function


Private Function SHOUHINKA_CHECK_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『商品化ﾁｪｯｸ処理』
'       2010.09.03
'
'-------------------------------------------------------
Dim sts             As Integer



Dim SHIJI_No        As String * 8


Dim SHIJI_QTY       As String * 11

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim i               As Integer


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim MENU_NO         As String * 2



    SHOUHINKA_CHECK_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票№）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO      '指図票№
    
    
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        
                        Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
                        sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
                        Select Case sts
                            Case False          '正常
                                
                            
                            
                            Case BtErrKeyNotFound
                                    
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "指図票№:" & SHIJI_No, "該当データなし", "", "")
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "該当データなし", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SHOUHINKA_CHECK_PROC = False
                                Exit Function
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        
                        End Select
                
                        
                        
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "指図票№:" & SHIJI_No, "キャンセル済", "", "")
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SHOUHINKA_CHECK_PROC = False
                            Exit Function
                        End If
                                                
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "指図票№:" & SHIJI_No, "完了済", "", "")
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SHOUHINKA_CHECK_PROC = False
                            Exit Function
                        End If
                        
                        
                        
                        
                        SHIJI_QTY = Format(Val(StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode)) - Val(StrConv(P_SSHIJI_O_REC.UKEIRE_QTY, vbUnicode)), "00000000.00")
                        If Val(SHIJI_QTY) < 0 Then
                            SHIJI_QTY = "00000000.00"
                        End If
                        
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        ID_KANRI_TBL(ING_No).Hinban = StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)
                        ID_KANRI_TBL(ING_No).SHIJI_QTY = SHIJI_QTY
                        ID_KANRI_TBL(ING_No).LABEL_CNT = 0
                        ID_KANRI_TBL(ING_No).GENPIN_CNT = 0
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                                                                                
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                        '2010.12.07
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_L_HIN_CNT)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_L_HIN_CNT)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        '2010.12.07
'                        Send_Text.Box_Type(3).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                        '2010.12.07
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（ラベル品番）
            For i = 0 To M_Gyo - 1
            
                
'                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Select Case i
                
                    Case 0
                
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        If Trim(Hinban) = Ent_Para Then
                        
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            '2010.12.07
'                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                                                                                    
                            '2010.12.07
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            
                            '2010.12.07
'                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                                    Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & _
'                                                                                    Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                            
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                    Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & _
                                                                                    Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                            
                            '2010.12.07
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "01"                  '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                                                    '入力桁数
'2011.04.11                            Send_Text.Box_Type(4).Max_Size = "13"
'2011.04.11                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "13"
                                                                                    
                                                                                    
                            Send_Text.Box_Type(4).Max_Size = "20"                           '2011.04.11 13-->20
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"      '2011.04.11 13-->20
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                            Sendbuf = Text_Create_Proc()
                        
                            SHOUHINKA_CHECK_PROC = False
    
                            Exit Function
            
                        End If
                
                
                
                
                
                
                    '品番
                    Case 3
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                                    
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        
                        
                        
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                        
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DOUBLE                        'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            '2010.12.07
'                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                            '2010.12.07
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            '2010.12.07
'                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban & "    ｴﾗｰ")
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban & "    ｴﾗｰ")
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & " ｴﾗｰ")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & " ｴﾗｰ")
                            '2010.12.07
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
                            SHOUHINKA_CHECK_PROC = False
    
                            Exit Function
                        
                        
                        End If
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                                                                                
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                        '2010.12.07
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                        
                        ID_KANRI_TBL(ING_No).LABEL_CNT = ID_KANRI_TBL(ING_No).LABEL_CNT + 1
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban & _
'                                                                                Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & _
                                                                                Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        '2010.12.07
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        '2010.12.07
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                        '2010.12.07
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        
        Case Step_Sagyo3_RES        '３回目の受信（現品票品番）
            For i = 0 To M_Gyo - 1
            
                
'                Select Case Trim(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD)
                Select Case i
                
                                    
                    Case 0
                                    
                                    
                                    
                                    
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    
                        If Trim(Hinban) = Ent_Para Then
                        
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                            
                        
                        
                        
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                    
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                            'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "チェック完了")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "チェック完了")
                
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------４行目
                                                                                            'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                
                            Sendbuf = Text_Create_Proc()
                        
                            SHOUHINKA_CHECK_PROC = False
        
                            Exit Function

                        End If
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                    Case 4          '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        
                        
                        
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        
                        
                        
                        
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                        
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DOUBLE                        'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                        
                            '2010.12.07
'                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                                                                                    
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))                            '2010.12.08
                            '2010.12.07
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            '2010.12.07
'                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))

                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                            '2010.12.07


                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            '2010.12.07
'                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Hinban & "    ｴﾗｰ")
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Hinban & "    ｴﾗｰ")
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Left(Hinban, 16) & " ｴﾗｰ")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Left(Hinban, 16) & " ｴﾗｰ")
                            '2010.12.07
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "01"                  '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                                                    '入力桁数
''                            Send_Text.Box_Type(4).Max_Size = "13"
''                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "13"
                                                                                    
                            Send_Text.Box_Type(4).Max_Size = "20"                               '2011.04.11 13-->20
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"          '2011.04.11 13-->20
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
                            SHOUHINKA_CHECK_PROC = False
        
                            Exit Function
                                                    
                        
                        
                        
                        End If
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                        '2010.12.07
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                            Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                            Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))


                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                            Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                            Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        '2010.12.07


                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        ID_KANRI_TBL(ING_No).GENPIN_CNT = ID_KANRI_TBL(ING_No).GENPIN_CNT + 1
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))) & _
'                                                                                Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))) & _
'                                                                                Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))
                                                                                
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Left(Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Left(Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))
                        '2010.12.07
                                                                                
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                                                '入力桁数
                        '2010.12.07
'                        Send_Text.Box_Type(4).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(4).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"
                        '2010.12.07
                                                                                
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        
        
        
        
        
        Case Step_Sagyo4_RES        '５回目の受信（Any Key）
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            
            
            Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
            sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
            Select Case sts
                Case False          '正常
                    
                
                
                Case BtErrKeyNotFound
                        
'                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "指図票№:" & SHIJI_No, "該当データなし", "", "")
                    
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "該当データなし", "", "")
                    
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    GoTo Abort_Tran
                
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    GoTo Abort_Tran
            
            End Select
            
            Call UniCode_Conv(P_SSHIJI_O_REC.HIN_CHECK_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
            Call UniCode_Conv(P_SSHIJI_O_REC.HIN_CHECK_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
            Call UniCode_Conv(P_SSHIJI_O_REC.HIN_CHECK_LABEL_CNT, Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "000"))
            Call UniCode_Conv(P_SSHIJI_O_REC.HIN_CHECK_GENPIN_CNT, Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "000"))
            sts = BTRV(BtOpUpdate, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
            Select Case sts
                Case False          '正常
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    GoTo Abort_Tran
            End Select
            
            
            
            
            
            
            
            
            
            
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).Hinban, , CLng(ID_KANRI_TBL(ING_No).SHIJI_QTY), , , , , , , _
                                                     ID_KANRI_TBL(ING_No).SHIJI_No, Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "000"), Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "000")) Then
                    SHOUHINKA_CHECK_PROC = SYS_ERR
                    GoTo Abort_Tran
                End If
            End If
            '2004.07.16 ↑
                                        
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    SHOUHINKA_CHECK_PROC = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function

Private Function HINBAN_CHECK_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『品番ﾁｪｯｸ処理』
'       2010.09.10
'
'-------------------------------------------------------
Dim sts             As Integer



'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim i               As Integer


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim MENU_NO         As String * 2

Dim Out_Moji        As String           '2012.03.29


    HINBAN_CHECK_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
    
    
    
    
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                HINBAN_CHECK_PROC = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
    
    
                        
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        '2012.03.19
                        Call Moji_Cut_Proc(StrConv(ITEMREC.HIN_NAME, vbUnicode), Out_Moji, 20)
                        'ID_KANRI_TBL(ING_No).HIN_NAME = StrConv(ITEMREC.HIN_NAME, vbUnicode)
                        ID_KANRI_TBL(ING_No).HIN_NAME = Out_Moji
                        '2012.03.19
                        ID_KANRI_TBL(ING_No).LABEL_CNT = 1
                        ID_KANRI_TBL(ING_No).GENPIN_CNT = 0
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '2010.09.15
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '2010.09.15
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & _
'                                                                                Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                                                                                
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 16) & _
                                                                                Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        '2010.12.07
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        '2010.12.07
'                        Send_Text.Box_Type(3).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                        '2010.12.07
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（ラベル品番）
            For i = 0 To M_Gyo - 1
            
                
'                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Select Case i
                
                    Case 0
                
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        If Trim(Hinban) = Ent_Para Then
                        
                        
            '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                Exit Function
                            End If
                            
                            
                            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                        
                            Else
                                        
                                MENU_NO = ""
                            End If
                            
                            If Trim(MENU_NO) = "" Then
                            Else
                            '作業ﾛｸﾞ出力
                                
                                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                                    MENU_NO, _
                                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                                     ID_KANRI_TBL(ING_No).Hinban, , , , , , , , , _
                                                                     , Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "000")) Then
                                    HINBAN_CHECK_PROC = SYS_ERR
                                    GoTo Abort_Tran
                                End If
                            End If
                                        
                                                        'トランザクション終了
                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                            End If
                            '次の作業要求
                            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                            Select Case sts
                                Case BtNoErr
                                '   -------------------------------- エラーメッセージ作成
                                Case Else
                                '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                            End Select
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                            
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                        
                            Sendbuf = Text_Create_Proc()
                        
                        
                            HINBAN_CHECK_PROC = False
    
                            Exit Function
                        
                        End If

                
                
                    '品番
                    Case 3
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                                    
                        
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                        
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DOUBLE                        'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    
                                                                                    
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            '2010.12.07
'                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban & "    ｴﾗｰ")
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban & "    ｴﾗｰ")
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & " ｴﾗｰ")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & " ｴﾗｰ")
                            '2010.12.07
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
                            
                            HINBAN_CHECK_PROC = False
    
                            Exit Function
                        
                        
                        End If
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                        
                        ID_KANRI_TBL(ING_No).LABEL_CNT = ID_KANRI_TBL(ING_No).LABEL_CNT + 1
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban & _
'                                                                                Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                                                                                
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & _
                                                                                Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        '2010.12.07
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        '2010.12.08
'                        Send_Text.Box_Type(3).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                        '2010.12.08
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        
    End Select
            
    HINBAN_CHECK_PROC = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function

Private Function COMPO_CHECK_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『商品化構成ﾁｪｯｸ処理』
'       2011.03.02
'
'-------------------------------------------------------
Dim sts             As Integer



Dim SHIJI_No        As String * 8

Dim Hinban          As String * 20

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim MENU_NO         As String * 2

Dim KO_CNT          As Integer
Dim RD_CNT          As Integer



    COMPO_CHECK_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票№）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO      '指図票№
    
    
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        
                        
                        sts = COMPO_Check_Read_Proc(SHIJI_No, KO_CNT)
                        
                        
                        Select Case sts
                            Case False          '正常
                                
                            
                            
                            Case BtErrKeyNotFound
                                    
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "該当データなし", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                COMPO_CHECK_PROC = False
                                Exit Function
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        
                        End Select
                
                        
                        '子部品なし
                        If KO_CNT < 0 Then
                        
                        
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "子部品なし", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            COMPO_CHECK_PROC = False
                            Exit Function
                        
                        
                        
                        
                        End If
                        
                        
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            COMPO_CHECK_PROC = False
                            Exit Function
                        End If
                                                
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            COMPO_CHECK_PROC = False
                            Exit Function
                        End If
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        ID_KANRI_TBL(ING_No).Hinban = StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)
                        ID_KANRI_TBL(ING_No).Input_Line = 0
                                                
                        
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                        Call COMPO_Check_Cnt_Proc(KO_CNT, RD_CNT)
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SHIJI_No & "     " & Format(RD_CNT, "##0") & "/" & Format(KO_CNT, "#"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SHIJI_No & "     " & Format(RD_CNT, "##0") & "/" & Format(KO_CNT, "#"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Hinban)
                                                                                
                                                                                
                                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（ラベル品番）
            For i = 0 To M_Gyo - 1
            
                Select Case i
                
                                    
                    Case 0
                                    
                                    
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    
                        If Trim(Hinban) = Ent_Para Then
                        
                            '2011.06.14
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL)
                                If ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).RD_FLAG <> 1 Then
                                    Exit For
                                End If
                            Next k
                            
                            If k > UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL) Then
                            Else
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No, "ﾁｪｯｸ未完了", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                COMPO_CHECK_PROC = False
                                Exit Function
                            
                            End If
                            
                            
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                        
                        
                        
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                    
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                            'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "チェック完了")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "チェック完了")
                
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------４行目
                                                                                            'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                
                            Sendbuf = Text_Create_Proc()
                        
                            COMPO_CHECK_PROC = False
        
                            Exit Function
                            
                            
                            
                            '2011.06.14
                                                    
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                                    
                            Exit For
                        End If
                    Case 2, 3, 4        '品番
                        
                        
                        
                        For j = 2 To 4
                        
                            If j - 2 = ID_KANRI_TBL(ING_No).Input_Line Then
                        
                                                    
                        
                                Hinban = ID_KANRI_TBL(ING_No).Recv_text(j)
                    
                    
                                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                                Select Case sts
                                    Case BtNoErr
                            
                                    Case BtErrKeyNotFound
                                
                                    Case Else
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                        Exit Function
                        
                                End Select
                    
                    
                    
                    
                                For k = 0 To UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).KO_HIN_GAI) = Trim(Hinban) Then
                                        Exit For
                                    End If
                                
                                Next k
                    
                    
                                If k > UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL) Then
                                
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No, Hinban, "品番ｴﾗｰ", "")
                                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    COMPO_CHECK_PROC = False
                                    Exit Function
                                
                                
                                End If
                                                            
                                                            
                        
                                ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).RD_FLAG = 1
                            
                            
                                '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.20
                                If COMPO_Check_Update_Proc(KO_CNT, RD_CNT, Sendbuf) Then
                                    Exit Function
                                End If
                                '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.20
                            
                            
                            
                            
                            
                                Exit For
                           End If
                        
                        
                        
                        Next j
                        
                        ID_KANRI_TBL(ING_No).RD_HINBAN(ID_KANRI_TBL(ING_No).Input_Line) = Hinban
                        ID_KANRI_TBL(ING_No).Input_Line = ID_KANRI_TBL(ING_No).Input_Line + 1
                        
                        If ID_KANRI_TBL(ING_No).Input_Line > 2 Then
                            ID_KANRI_TBL(ING_No).Input_Line = 0
                        
                            ID_KANRI_TBL(ING_No).RD_HINBAN(0) = ""
                            ID_KANRI_TBL(ING_No).RD_HINBAN(1) = ""
                            ID_KANRI_TBL(ING_No).RD_HINBAN(2) = ""
                        
                        End If
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            
                            
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                        Call COMPO_Check_Cnt_Proc(KO_CNT, RD_CNT)
                                                                                
                                                                                
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SHIJI_No & "     " & Format(RD_CNT, "##0") & "/" & Format(KO_CNT, "#"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SHIJI_No & "     " & Format(RD_CNT, "##0") & "/" & Format(KO_CNT, "#"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                        For j = 0 To 2
                        
                            If j = ID_KANRI_TBL(ING_No).Input_Line Then
                                                                                    'BOX属性
                                Send_Text.Box_Type(j + 2).Box_Type = TYPE_BCANK
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(j + 2).LCD, LCD_Hinban)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).LCD, LCD_Hinban)
                        
                        
                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(j + 2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(j + 2).Start_Pos = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Start_Pos = "01"
                                                                                        '入力桁数
                                                                                        
                                Send_Text.Box_Type(j + 2).Max_Size = "20"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Max_Size = "20"
                                                                                        
                                                                                        
                                Send_Text.Box_Type(j + 2).MENU = ""                     'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).MENU = ""
                        
                        
                        
                        
                            Else
                                                                                    'BOX属性
                                Send_Text.Box_Type(j + 2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Box_Type = TYPE_REF
                                Call UniCode_Conv(Send_Text.Box_Type(j + 2).LCD, ID_KANRI_TBL(ING_No).RD_HINBAN(j))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).LCD, ID_KANRI_TBL(ING_No).RD_HINBAN(j))
                        
                        
                            
                            
                                                                                        '数値初期表示
                                Send_Text.Box_Type(j + 2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(j + 2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Start_Pos = ""
                                                                                        '入力桁数
                                                                                        
                                Send_Text.Box_Type(j + 2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Max_Size = "00"
                                                                                        
                                                                                        
                                Send_Text.Box_Type(j + 2).MENU = ""                       'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).MENU = ""
                            
                            
                            End If
                        
                        Next j
                                                                                    
                                                                                    
                                                                                    
                                                                                    
                                                                                    
                                                                                    
    
                        Sendbuf = Text_Create_Proc()
                                    
                        Exit For
                           
                End Select
            
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（ＥＮＴ）
        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).Hinban, , , , , , , , , _
                                                     ID_KANRI_TBL(ING_No).SHIJI_No) Then
                    COMPO_CHECK_PROC = SYS_ERR
                    Exit Function
                End If
            End If
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select

            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
        
        
    End Select
        

    COMPO_CHECK_PROC = False
    


End Function

Private Function Inspe_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8
Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1
Dim HIN_NO          As String * 13


Dim KAN_FLG         As String * 1

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1


Dim wkTEXT          As String           '2007.07.21

Dim MENU_NO         As String * 2

Dim wkNull_Check    As String       '2009.04.27

Dim Mod_Return      As Integer      '2010.12.09
Dim iNum            As Integer      '2010.12.09



    Inspe_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "検品作業不可", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc = False
                            Exit Function
                        End If
    
    
'''                        If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'''                            ID_NO = Format(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "00000000")
'''                        Else
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
'''                        End If
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_FIN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc = False
                                Exit Function
                        End Select
                
                        '------------------ 向け先のチェック
                        If ID_KANRI_TBL(ING_No).MTS_CODE <> MTS_CODE Or _
                            ID_KANRI_TBL(ING_No).SS_CODE <> SS_CODE Then
                            
                            
'---------------------------    データ解放を追加    2011.07.29
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
'---------------------------    データ解放を追加    2011.07.29
                            
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "向け先エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc = False
                            Exit Function
                        End If
                        '------------------ 注文区分のチェック
                        If ID_KANRI_TBL(ING_No).CYU_KBN <> CYU_KBN Then
                            
                            
                            
'---------------------------    データ解放を追加    2011.07.29
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
'---------------------------    データ解放を追加    2011.07.29
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "注文区分ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc = False
                            Exit Function
                        End If
                        '------------------ 出庫完了のチェック
                        If Inspection_Flg = 0 Then
                            If KAN_KBN <> KAN_KBN_FIN Then
                                
                                
                                
'---------------------------    データ解放を追加    2011.07.29
                                sts = Data_Clear_Proc(0, Sendbuf)
                                Select Case sts
                                    Case SYS_CANCEL
                                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    
                                    Case SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
'---------------------------    データ解放を追加    2011.07.29
                                
                                
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "作業未完了", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc = False
                                Exit Function
                            End If
                        End If
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Y_SYU_CNT = Y_SYU_CNT
                        ID_KANRI_TBL(ING_No).SYUKA_QTY = JITU_QTY
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
'2007.07.21                        Send_Text.Box_Type(2).Max_Size = "13"
'2007.07.21                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（品番）
            For i = 0 To M_Gyo - 1
            
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                Select Case wkTEXT
                '2007.07.21 ↑
                
                                    
                    Case LCD_Hinban     '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc = False
                                Exit Function
                    
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "品番エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc = False
                            Exit Function
                        End If
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        
                        '2009.07.29
                        If ID_KANRI_TBL(ING_No).SYUKA_QTY > 1 Then
                        
                            Send_Text.Buzzer = Wel_Inspe_BUZZER                 'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Wel_Inspe_BUZZER
                        
                        Else
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        End If
                        
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                
                        '2009.04.16
                        wkNull_Check = Replace(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode), Chr(0), " ")
                        If Trim(wkNull_Check) = "" Then
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""






                            '2010.12.09
                            If IsNumeric(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)) Then
                                If Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)) <> 0 Then
                                    Mod_Return = ID_KANRI_TBL(ING_No).SYUKA_QTY Mod Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                                    iNum = CInt(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).SYUKA_QTY) / CCur(Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))), 0))
                            
                                    
                                    Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                            
                            
                                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                            '表示内容
                                    
                                    If Mod_Return <> 0 Then
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱＋" & StrConv(Format(Mod_Return, "#0"), vbWide) & "余")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱＋" & StrConv(Format(Mod_Return, "#0"), vbWide) & "余")
                                    Else
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱")
                                    End If
                                    
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(4).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                            '入力桁数
                                     Send_Text.Box_Type(4).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                                End If
                            
                                                        
                            End If



                        Else
                                                                                    
                                                                                    
                            Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                                                                    
                                                                                    
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Trim(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode)))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Trim(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode)))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        End If


                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            '出荷予定の読み込み
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'ID№
    
            Do
            
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrKeyNotFound
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc = False
                        GoTo Abort_Tran
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
        
            Loop
    
    
            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
            Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                            
            '2006.07.20 検品担当者出力追加
            Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
            Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                            
                                            '出荷予定書込み
            Do
                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        Inspe_Proc = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop
                                        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                        
            '2004.07.16 ↓
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        "", , , , , MENU_NO, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE, _
                                        ID_KANRI_TBL(ING_No).SS_CODE, _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Inspe_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
            '2004.07.16 ↑
                                        
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    Inspe_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function









Private Function Inspe_Proc_MTS(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（ＭＴＳ読み込みあり）』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8
Dim Hinban          As String * 20          '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07


Dim KAN_FLG         As String * 1

Dim i               As Integer

Dim DEN_ID_LOOP     As Integer      '2006.06.01
Dim DEN_ID_JGYOBU   As String * 1   '2006.06.01


Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim wkTEXT          As String


Dim wkKENPIN_YMD    As String * 8   '検品日付   2007.10.10


Dim wkNull_Check    As String       '2009.04.27

Dim Mod_Return      As Integer      '2010.12.09
Dim iNum            As Integer      '2010.12.09


    Inspe_Proc_MTS = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（向け先）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_MTS    '向け先
                                
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) < 16 Then
                                    '向け先（得意先）のみで向け先マスタ読み込み
                            Call UniCode_Conv(K2_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).Recv_text(i))
                            sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K2_MTS, Len(K2_MTS), 2)
                            Select Case sts
                                Case BtNoErr
                                    If Len(Trim(StrConv(MTSREC.SS_CODE, vbUnicode))) <> 0 Then
                                    
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "出荷先エラー", "", "")
                    
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                        Inspe_Proc_MTS = False
                                        Exit Function
                                    
                                    End If
                                
                                Case BtErrKeyNotFound
                                
                                    Call UniCode_Conv(K3_MTS.SS_CODE, ID_KANRI_TBL(ING_No).Recv_text(i))
                                                        
                                    sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K3_MTS, Len(K3_MTS), 3)
                                    Select Case sts
                                        Case BtNoErr
                                        
                                        Case BtErrKeyNotFound
                                        
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "出荷先エラー", "", "")
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                            Inspe_Proc_MTS = False
                                            Exit Function
                                        
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "向け先管理マスタ", 0)
                                            Exit Function
                                    End Select
                        
                            End Select
                        
                            MTS_CODE = StrConv(MTSREC.MUKE_CODE, vbUnicode)
                            SS_CODE = StrConv(MTSREC.SS_CODE, vbUnicode)
                        
                        
                        Else
                            MTS_CODE = Left(ID_KANRI_TBL(ING_No).Recv_text(i), 8)
                            SS_CODE = Right(ID_KANRI_TBL(ING_No).Recv_text(i), 8)
                        
                                                '向け先マスタ読み込み
                            Call UniCode_Conv(K0_MTS.MUKE_CODE, MTS_CODE)
                            Call UniCode_Conv(K0_MTS.SS_CODE, SS_CODE)
                         
                            sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, MTS_CODE & SS_CODE, "出荷先エラー", "", "")
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Inspe_Proc_MTS = False
                                    Exit Function
                            
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "向け先管理マスタ", 0)
                                    Exit Function
                            End Select
                        
                        
                        End If
                         
                         
                         
                         
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, MTS_CODE & SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, MTS_CODE & SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "13"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        
        
        Case Step_Sagyo2_RES        '２回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                Select Case wkTEXT
                '2007.07.21 ↑
                
                
                    Case LCD_ID_No      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "検品作業不可", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_MTS = False
                            Exit Function
                        End If
    
    
    
'''                        If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'''                            ID_NO = Format(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "00000000")
'''                        Else
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
'''                        End If
'''                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
'''                        sts = Y_Syuka_Chek_Proc(KAN_KBN_FIN, _
'''                                                ID_KANRI_TBL(ING_No).JGYOBU, _
'''                                                NAIGAI, _
'''                                                Hinban, _
'''                                                MTS_CODE, _
'''                                                SS_CODE, _
'''                                                CYU_KBN, _
'''                                                Y_SYU_CNT, _
'''                                                ID_NO, _
'''                                                SYUKA_QTY, _
'''                                                DEN_NO, _
'''                                                KAN_KBN, _
'''                                                JITU_QTY)
'''
'''
                        
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        For DEN_ID_LOOP = 0 To UBound(JGYOBU_T) '2006.06.01
                        
                            '2007.10.10 引数　検品日付追加
                            sts = Y_Syuka_Chek_Proc(KAN_KBN_FIN, _
                                                    JGYOBU_T(DEN_ID_LOOP).CODE, _
                                                    NAIGAI, _
                                                    Hinban, _
                                                    MTS_CODE, _
                                                    SS_CODE, _
                                                    CYU_KBN, _
                                                    Y_SYU_CNT, _
                                                    ID_NO, _
                                                    SYUKA_QTY, _
                                                    DEN_NO, _
                                                    KAN_KBN, _
                                                    JITU_QTY, _
                                                    DEN_ID_JGYOBU, _
                                                    wkKENPIN_YMD)
                            If sts <> False Or Y_SYU_CNT <> 0 Then
                                Exit For
                            End If
                        
                        Next DEN_ID_LOOP
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_MTS = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_MTS = False
                                Exit Function
                        End Select
                        
                        
                        '------------------ 向け先のチェック
                        If ID_KANRI_TBL(ING_No).MTS_CODE <> MTS_CODE Or _
                            ID_KANRI_TBL(ING_No).SS_CODE <> SS_CODE Then
                            
                            
'---------------------------    データ解放を追加    2011.07.29
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
'---------------------------    データ解放を追加    2011.07.29
                            
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "向け先エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_MTS = False
                            Exit Function
                        End If
                        '------------------ 注文区分のチェック
                        If ID_KANRI_TBL(ING_No).CYU_KBN <> CYU_KBN Then
                            
'---------------------------    データ解放を追加    2011.07.29
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
'---------------------------    データ解放を追加    2011.07.29
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "注文区分ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_MTS = False
                            Exit Function
                        End If
                        '------------------ 出庫完了のチェック
                        If Inspection_Flg = 0 Then
                            If KAN_KBN <> KAN_KBN_FIN Then
                                
                                
'---------------------------    データ解放を追加    2011.07.29
                                sts = Data_Clear_Proc(0, Sendbuf)
                                Select Case sts
                                    Case SYS_CANCEL
                                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    
                                    Case SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
'---------------------------    データ解放を追加    2011.07.29
                                
                                
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "作業未完了", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_MTS = False
                                Exit Function
                            End If
                        End If
                        
                        '------------------ 再検品のチェック    2007.10.10
                        If Inspection_CHK = 1 Then
                            If Trim(wkKENPIN_YMD) <> "" Then
                                
                                
'---------------------------    データ解放を追加    2011.07.29
                                sts = Data_Clear_Proc(0, Sendbuf)
                                Select Case sts
                                    Case SYS_CANCEL
                                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    
                                    Case SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
'---------------------------    データ解放を追加    2011.07.29
                                
                                
                                
                                
                                
                                
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品済です", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_MTS = False
                                Exit Function
                            End If
                        End If
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Y_SYU_CNT = Y_SYU_CNT
                        ID_KANRI_TBL(ING_No).SYUKA_QTY = JITU_QTY
                        ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU = DEN_ID_JGYOBU      '2006.06.01
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
'2007.07.21                        Send_Text.Box_Type(3).Max_Size = "13"
'2007.07.21                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            For i = 0 To M_Gyo - 1
            
                
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                Select Case wkTEXT
                '2007.07.21 ↑
                    
                    Case LCD_Hinban     '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_MTS = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                            '------------------------- 2011.07.29   読み替えｺｰﾄﾞで再読み込み
                            
                            
''                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "品番エラー", "", "")
''                            Sendbuf = Text_Create_Proc()
''                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
''                            Inspe_Proc_MTS = False
''                            Exit Function
                            
                            Call UniCode_Conv(K5_ITEM.JGYOBU, RET_JGYOBU)
                            Call UniCode_Conv(K5_ITEM.NAIGAI, RET_NAIGAI)
                            Call UniCode_Conv(K5_ITEM.HIN_CHANGE, Hinban)
                            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K5_ITEM, Len(K5_ITEM), 5)
                            Select Case sts
                                Case BtNoErr
                                
                                    If Trim(StrConv(ITEMREC.HIN_GAI, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                                
                                
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "品番エラー", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_MTS = False
                                        Exit Function
                                        
                                    End If
                                    Hinban = Trim(StrConv(ITEMREC.HIN_GAI, vbUnicode))
                                Case BtErrKeyNotFound
                                
                                
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "品番エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_MTS = False
                                    Exit Function
                                
                                
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual, "品目ﾏｽﾀ", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                            '------------------------- 2011.07.29
                        End If
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        '2009.07.29
                        If ID_KANRI_TBL(ING_No).SYUKA_QTY > 1 Then
                        
                            Send_Text.Buzzer = Wel_Inspe_BUZZER                 'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Wel_Inspe_BUZZER
                        
                        Else
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        End If
                        
                        '-----------------------------------------------１行目
'                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(0).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(0).Start_Pos = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(0).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
'                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目


                        
                        
                        '2009.04.16
                        wkNull_Check = Replace(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode), Chr(0), " ")
                        If Trim(wkNull_Check) = "" Then
                                                                                    'BOX属性
                            
                            
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                                                        
                            '2010.12.09
                            If IsNumeric(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)) Then
                                If Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)) <> 0 Then
                                    Mod_Return = ID_KANRI_TBL(ING_No).SYUKA_QTY Mod Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                                    iNum = CInt(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).SYUKA_QTY) / CCur(Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))), 0))
                            
                                    
                                    Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                            
                            
                                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                            '表示内容
                                    
                                    If Mod_Return <> 0 Then
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱＋" & StrConv(Format(Mod_Return, "#0"), vbWide) & "余")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱＋" & StrConv(Format(Mod_Return, "#0"), vbWide) & "余")
                                    Else
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱")
                                    End If
                                    
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(4).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                            '入力桁数
                                     Send_Text.Box_Type(4).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                                End If
                            
                                                        
                            End If
                        Else
                                                                                    
                                                                                    
                            Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                                                                    
                                                                                    
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Trim(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode)))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Trim(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode)))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""



                            



                        End If



                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        Case Step_Sagyo4_RES        '４回目の受信（Any Key）
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            '出荷予定の読み込み
            '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU)     '事業部
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'ID№
    
            Do
            
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrKeyNotFound
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_MTS = False
                        GoTo Abort_Tran
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_MTS = False
                        GoTo Abort_Tran
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
        
            Loop
    
    
            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
            Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                            
            '2006.07.20 検品担当者出力追加
            Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
            Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                            
                                            
                                            '出荷予定書込み
            Do
                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_MTS = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        Inspe_Proc_MTS = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop
                                        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                        
                                        
                                        
            '2004.07.16 ↓
            
            '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
            
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        "", , , , , MENU_NO, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE, _
                                        ID_KANRI_TBL(ING_No).SS_CODE, _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Inspe_Proc_MTS = SYS_ERR
                    GoTo Abort_Tran
            End Select
            '2004.07.16 ↑
                                        
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                '検品確認終了時は、伝票ＩＤ要求に戻す為の特殊処理
                
                
                '-----------------------------------------------ヘッダー
                
                
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                
                
                
                '-----------------------------------------------１行目
                                                                'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "12"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()


'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
            
                Sendbuf = Text_Create_Proc()
    
    
    End Select

    Inspe_Proc_MTS = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Private Function Inspe_Proc_DEN_ALL(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（宅配伝票読み込み 大阪ＰＣ向け）』
'
'       2006.12.07
'
'全数検品対応    2012.03.21
'
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07


Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Long

Dim SAI_SU          As Double

Dim UNSOU_KAISHA    As String
 
Dim SYUKA_YMD       As String
Dim JYUSHO          As String
Dim BIKOU           As String

Dim SURYO           As String

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag

Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean

'2010.01.21
Dim KONPOU_ON           As Integer




Dim KONPOU_ON_SUMI      As Integer
Dim KONPOU_OFF          As Integer
Dim KONPOU_OFF_SUMI     As Integer



Dim PRINT_OFF           As Boolean
Dim Start_Page_No       As Long
Dim PRINT_TOTAL_SU      As Long
Dim PRINT_MAISU         As Long
Dim fileName            As String
Dim ID_SEQ              As Integer
Dim DISP_SAI_SU         As Double

Dim wkKUTI_SU           As String
Dim wkKONPO_F           As String * 1

Dim TOTAL_KUTI_SU       As Integer
Dim TOTAL_SAI_SU        As Double
Dim MUKE_NAME           As String
Dim OKURI_NO_MAX        As Integer
Dim KUTI_SU_INPUT_F     As Boolean

Dim KEN_TEL_NO          As String * 20


Dim OKURI_NO_F          As Boolean
'2010.01.21


Dim FUKUYAMA_CHK_F      As Boolean

Dim Cnt_F               As Boolean
Dim Print_bara_F        As Boolean
Dim Hin_Total           As Long             '2012.04.07

Dim KEN_HINBAN          As String * 20      '2012.10.02

    Inspe_Proc_DEN_ALL = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                        '2012.10.02　KEN_HINBAN追加
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, _
                                                SYUKA_YMD, _
                                                JYUSHO, _
                                                BIKOU, _
                                                Start_Page_No, _
                                                KUTI_SU, _
                                                MUKE_NAME, _
                                                OKURI_NO_MAX, , , _
                                                KEN_TEL_NO, _
                                                KEN_HINBAN)
                        
                        
                        '他端末で使用中 2011.04.07
                        If sts = SYS_CANCEL Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                        '他端末で使用中 2011.04.07
                                
                        
                        
                        
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                                                    
                            Next j
                                                     
                                                     
                            If CANCEL_F Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        End If
                        
                        
                        If Y_SYU_CNT = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                                                 
                        If Sumi_CNT = Y_SYU_CNT And Start_Page_No <> 0 Then
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品処理済！", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        
                        End If
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = Y_SYU_TBL(j).KONPOU_F        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_CND = Y_SYU_TBL(j).KONPOU_CND    '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).TOTAL_SU = Y_SYU_TBL(j).TOTAL_SU        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = Y_SYU_TBL(j).SAI_SU            '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = Y_SYU_TBL(j).KUTI_SU          '2010.01.21
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = Y_SYU_TBL(j).PRINT_SUMI    '2010.01.21
                        
                                                                                                        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ = Y_SYU_TBL(j).OKURI_NO_SEQ
                        
                        
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = Y_SYU_TBL(j).CNT_BARA_SU      '検品実績　バラ
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = Y_SYU_TBL(j).CNT_HAKO_SU      '検品実績　箱
                            
                
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = Y_SYU_TBL(j).Y_HIN_CHK_CNT  '品番読込み回数
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = Y_SYU_TBL(j).J_HIN_CHK_CNT  '品番読込み済み回数

                        
                        
                        
'2012.11.15                            ID_KANRI_TBL(ING_No).KEN_HINBAN = KEN_HINBAN
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                        
                        
                        
                        
                        
                        
                        
                        Next j
                        
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        '出荷日
                        ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = SYUKA_YMD
                        '住所
                        ID_KANRI_TBL(ING_No).KEN_JYUSHO = JYUSHO
                        
                        '備考
                        ID_KANRI_TBL(ING_No).KEN_BIKOU = BIKOU
                        '向け先
                        ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = MUKE_NAME
                        
                        '枝番
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO_MAX = OKURI_NO_MAX
                        '電話番号
                        ID_KANRI_TBL(ING_No).KEN_TEL_NO = KEN_TEL_NO
                        
                        
                        '検品ﾊﾟﾀｰﾝ  2012.03.31
                        ID_KANRI_TBL(ING_No).KEN_TYPE = ""
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                '2012.11.15
                        ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = KEN_HINBAN    '2012.11.15
                        
                        'ﾗﾍﾞﾙ開始ページ№
                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                        
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                        
                    
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        
                        
                        
                        End If
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                        
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                        If KONPOU_ON <> 0 Then
                            If KONPOU_ON = KONPOU_ON_SUMI Then
                                                    
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                                    
                            End If
                        End If
                        
                        
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                
                
                
                        Else
                
                
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                                                                                    'BOX属性
                                                                                    
                                                                                    
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
        
    ''' 品番単位での丸め処理
KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI          '2011.03.17
                            
                            
Select Case KONPOU_ON                           '2011.03.17
                    
''''''''''''Select Case (KONPOU_ON - KONPOU_ON_SUMI)     '2011.03.17
                            
                                Case 0
                                '集合梱包なし
                                
                                    
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                        If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                        
                                        
                                        
                                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                            
                                            '-----------------------------------------------ヘッダー
                                            Call Wel_Head_Text_Proc
                                            '-----------------------------------------------１行目
                                            Call Wel_DETAIL_0_Text_Proc
                                            '-----------------------------------------------２行目
                                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                            '-----------------------------------------------３行目
                                                                                                    'BOX属性
'2012.11.15                                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                                    '表示内容
'2012.11.15
'2012.11.15                                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                                    '数値初期表示
'2012.11.15                                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                                    '初期カーソル位置
'2012.11.15                                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                                    '入力桁数
'2012.11.15                                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        
                                        
                                        
                                            '2012.11.15
                                            Call Wel_OKURI_SAKI_PROC
                                        
                                            TOTAL_KUTI_SU = 1
                                            KUTI_SU_INPUT_F = True
                                            TOTAL_SAI_SU = 0#
                                                
                                                
                                                
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                            End If
                                                
                                                
                                    
                                            Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                            ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                            ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                            ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                                    
                                    
                                            Sendbuf = Text_Create_Proc()
                                        
                                            Inspe_Proc_DEN_ALL = False
                                            Exit Function
                                        
                                        
                                        End If
                                    End If
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    
                                    
                                    
                                    '-----------------------------------------------ボディ
                                    Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
            
                                    Sendbuf = Text_Create_Proc()
                                Case Else
                                '集合梱包あり
                                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                            
                                    '-----------------------------------------------２行目
                                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                    '-----------------------------------------------３行目
                                                                                            'BOX属性
'2012.11.15                                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                            '表示内容
'2012.11.15
'2012.11.15                                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                            '数値初期表示
'2012.11.15                                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                            '初期カーソル位置
'2012.11.15                                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                            '入力桁数
'2012.11.15                                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    
                                    '2012.11.15
                                    Call Wel_OKURI_SAKI_PROC
                                    '-----------------------------------------------４行目
                                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                            '表示内容
                                                                                        '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = "01"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                            '入力桁数
                                    Send_Text.Box_Type(3).Max_Size = "13"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------５行目
                                    Call Wel_Clear_Text_Proc
            
                                    Sendbuf = Text_Create_Proc()
                            
                            End Select
                        End If
                
                
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状№）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状№
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else
'2009.10.14                         If Len(OKURI_NO) < 11 Or Len(OKURI_NO) > 13 Then
'                            If Len(OKURI_NO) < 10 Or Len(OKURI_NO) > 13 Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                Inspe_Proc_DEN = False
'                                Exit Function
'                            End If
                        
                            If Not IsNumeric(OKURI_NO) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        
                        
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            
                            
                            
                            
                            If Not OKURI_NO_F Then
                            
                        
                        
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                                                
                            End If
                        
                        
                        
                            '2090.04.28
                            If FUKUYAMA_CHK_F Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            
                            End If
                            '2090.04.28
                        
                        
                        
                        
                        
                        
                        
                        End If
                    
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                                    
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                                
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_DEN_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
                                                                                'BOX属性
                                                                                
                                                                                
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI              '2011.03.17
        
    ''' 品番単位での丸め処理
Select Case KONPOU_ON                               '2011.03.17
'''''Select Case (KONPOU_ON - KONPOU_ON_SUMI)     '2011.03.17



                        
                            Case 0
                            '集合梱包なし
                            
                                
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                    
                                    
                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                        
                                        '-----------------------------------------------ヘッダー
                                        Call Wel_Head_Text_Proc
                                        '-----------------------------------------------１行目
                                        Call Wel_DETAIL_0_Text_Proc
                                        '-----------------------------------------------２行目
                                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                        '-----------------------------------------------３行目
                                                                                                'BOX属性
'2012.11.15                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                                '表示内容
'2012.11.15
'2012.11.15                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                                '数値初期表示
'2012.11.15                                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                                '初期カーソル位置
'2012.11.15                                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                                '入力桁数
'2012.11.15                                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    
                                        '2012.11.15
                                        Call Wel_OKURI_SAKI_PROC
                                    
                                    
                                    
                                        TOTAL_KUTI_SU = 1
                                        KUTI_SU_INPUT_F = True
                                        TOTAL_SAI_SU = 0#
                                            
                                            
                                            
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                        End If
                                            
                                            
                                
                                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                        ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                                
                                
                                        Sendbuf = Text_Create_Proc()
                                    
                                        Inspe_Proc_DEN_ALL = False
                                        Exit Function
                                    
                                    
                                    End If
                                End If
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                
                                
                                
                                '-----------------------------------------------ボディ
                                Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
        
                                Sendbuf = Text_Create_Proc()
                            Case Else
                            '集合梱包あり
                        
                        
                                '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント 2011.03.04
                                Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
'2012.11.15                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                        '表示内容
'2012.11.15
'2012.11.15                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                                Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                                Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                                Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '2012.11.15
                                Call Wel_OKURI_SAKI_PROC
                                '-----------------------------------------------４行目
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                        '表示内容
                                                                                    '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                        '入力桁数
                                '2010.12.07
'                                Send_Text.Box_Type(3).Max_Size = "13"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                Send_Text.Box_Type(3).Max_Size = "20"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                '2010.12.07
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                        
                        End Select
                    End Select
                Next i
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            Cnt_F = False
            For i = 0 To M_Gyo - 1
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban, "出荷"    '品番/出荷数（品番）
                        If Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = "出荷" Then
                            Cnt_F = True
                        Else
                            ID_KANRI_TBL(ING_No).LAST_START_PAGE = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1 '2012.04.01
                        End If
                        
                        
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                '集合梱包有り時の品番チェック
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                        
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND <> "1" Then
                        
                            If KONPOU_ON <> KONPOU_ON_SUMI Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
                            
                            
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    Exit Function
                            
                                End If
                            End If
                        
                        End If
                        'ｷｬﾝｾﾙのﾁｪｯｸ
                        CANCEL_F = True
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            End If
                        Next j
                        
                        If CANCEL_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "キャンセル品番です。", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        
                        
                        End If
                        
                        
                        
                                
                        '検品済みのﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "検品済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                
                        '未出庫のﾁｪｯｸ   2007.05.14
                        If Inspection_Flg = 0 Then
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KAN_KBN <> KAN_KBN_FIN Then
                                        Exit For
                                    End If
                                End If
                            Next k
                                            
                            If k <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        End If
                        '未出庫のﾁｪｯｸ   2007.05.14
                        
                        
                        '仕掛中品番のﾁｪｯｸ   2012.10.02-->2012.11.15 KEN_HINBAN-->KEN_ING_HINBAN
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) Then
                            If Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) <> "" Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "他品番検品中！", ID_KANRI_TBL(ING_No).KEN_ING_HINBAN)
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        End If
                        '仕掛中品番のﾁｪｯｸ   2012.10.02
                        
                        If Cnt_F Then
                        
                            If RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) <> RTrim(Hinban) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        End If
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                        
                        
                        
                        
                        Print_bara_F = False
                
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1
                            End If
                        
                                        
                            '2012.04.07
                            Hin_Total = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If ID_KANRI_TBL(ING_No).KEN_HINBAN = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then                '2012.09.05
                                        Hin_Total = Hin_Total + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If                                                                  '2012.09.05
                                End If
                            Next k
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)) + _
                            '                                                            (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO - _
                            '                                                            ((CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY)
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)) + _
                                                                                        (Hin_Total - _
                                                                                        ((CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY)
                            '2012.04.07
                            
                            
                            
                            Print_bara_F = False
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1 Then
                                'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO   2012.04.09
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = Hin_Total                                    '2012.04.09
                                Print_bara_F = True
                            Else
                                'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = CLng(ToRoundUp(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO Mod ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0))
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = CLng(ToRoundUp(CCur(Hin_Total Mod ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0))    '2012.04.09
                            End If
                            
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            '
                            'If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 1
                            'Else
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            'End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                        
                        
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                        
                        
                        End If
                        
                        
                        If Cnt_F Then
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                                Print_bara_F = True
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                        
                        
                        End If
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02
                        '----------------------------------- トランザクション開始 -----------
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If


                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
'2012.10.02                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
'2012.10.02
'2012.10.02                                '------------------------------------   出荷予定の処理
'2012.10.02                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
'2012.10.02
'2012.10.02
'2012.10.02                                Do
'2012.10.02
'2012.10.02                                    sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.01.02                                    Select Case sts
'2012.01.02                                        Case BtNoErr
'2012.01.02                                            Exit Do
'2012.01.02                                        Case BtErrKeyNotFound
'2012.01.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
'2012.01.02                                            Sendbuf = Text_Create_Proc()
'2012.01.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.01.02                                            Inspe_Proc_DEN_ALL = False
'2012.01.02                                            GoTo Abort_Tran
'2012.01.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.01.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.01.02                                            Sendbuf = Text_Create_Proc()
'2012.01.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.01.02                                            Inspe_Proc_DEN_ALL = False
'2012.01.02                                            GoTo Abort_Tran
'2012.01.02                                        Case Else
'2012.01.02                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
'2012.01.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.01.02                                            Sendbuf = Text_Create_Proc()
'2012.01.02                                            GoTo Abort_Tran
'2012.01.02                                    End Select
'2012.01.02
'2012.01.02                                Loop
'2012.01.02
'2012.01.02
'2012.01.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
'2012.01.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
'2012.01.02
'2012.01.02                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))
'2012.01.02
'2012.01.02                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
'2012.01.02                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
'2012.01.02
'2012.01.02
'2012.01.02
'2012.01.02                                Do
'2012.01.02
'2012.01.02                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.01.02                                    Select Case sts
'2012.01.02                                        Case BtNoErr
'2012.01.02                                            Exit Do
'2012.01.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.01.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.01.02                                            Sendbuf = Text_Create_Proc()
'2012.01.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.01.02                                            Inspe_Proc_DEN_ALL = False
'2012.01.02                                            GoTo Abort_Tran
'2012.01.02                                        Case Else
'2012.01.02                                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
'2012.01.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.01.02                                            Sendbuf = Text_Create_Proc()
'2012.01.02                                            GoTo Abort_Tran
'2012.01.02                                    End Select
'2012.01.02
'2012.01.02                                Loop
'2012.01.02
'2012.01.02
'2012.01.02
'2012.01.02                            End If
                            '------------------------------------   出荷予定の処理  2012.10.02
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
                
                
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
    

                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
    
                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))

                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
                            End If
                        
                            Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, ID_KANRI_TBL(ING_No).KEN_HINBAN)

                        
                            Do
                            
                                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                        
                        '------------------------------------   出荷予定の処理  2012.10.02
                        
                        Next k
                        
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            Exit Function
                        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 荷札発行処理    2012.03.30
                        PRINT_OFF = False
    
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
                            PRINT_OFF = True
                        Else
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
                            
''                                If KONPOU_ON = KONPOU_ON_SUMI Then
        
                                    PRINT_OFF = True

''                                End If
        
                            End If
                        End If
                        
                        If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                            ID_KANRI_TBL(ING_No).LABEL_ON = False
                        Else
                                    
                            PRINT_OFF = False
                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
                                If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                    
                                    For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                
                                        If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                            
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                                '枝番更新   2010.02.15
                                                Start_Page_No = 1
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01                                                End If
                                                
                                                PRINT_OFF = True
                                            End If
                                        
                                        
                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KONPOU_F <> "1" Then
                                                
                            
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                    End If
                                                
                                                
                                                
                                                End If
                                                                    
                                            End If
                                        
                                        
                                        
                                        
                                        
                                        End If
                                    Next k
                                End If
                            End If
                            
                            If Not PRINT_OFF Then
                            
                                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
                                '2010.06.16
                                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                '2010.06.16
                                Select Case sts
                                    Case BtNoErr
                                    
                                        If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                        
                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                        
                                        End If
                                    
                                    Case BtErrKeyNotFound
                                    
                                        Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                    
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                                
                                If Print_bara_F Then
                                    PRINT_MAISU = Val(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                Else
                                    PRINT_MAISU = Val(StrConv(ITEMREC.KUTI_SU, vbUnicode)) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                                End If
                                                        
                                Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
                                                        
                                PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                
                                If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
                                    PRINT_MAISU = PRINT_MAISU - 1
                                    If PRINT_MAISU < 1 Then
                                        
                                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                    
                                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                            
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                
                                                '枝番更新   2010.02.15
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                    End If
                                                
                                                
                                                '枝番更新   2010.02.15
                                
                                
                                
                                                End If
                                            
                                            
                                            
                                            
                                            
                                            
                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KONPOU_F <> "1" Then
                                                    
                                
'2012.04.01                                                        If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01                                                        End If
                                                        
                                                
                                                    
                                                    End If
                                                                        
                                                End If
                                            
                                            
                                            
                                            
                                            
                                            
                                            End If
                                        Next k
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                        PRINT_OFF = True
                                    Else
    '                                    PRINT_MAISU = PRINT_MAISU - 1
                                        Start_Page_No = Start_Page_No + 1
                                    End If
                                End If
                            End If
                            
                            If Not PRINT_OFF Then
                            
                                ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                
                                Y_SYU_CNT = 0
                                SYUKA_QTY = 0
                                For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                        
                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                        
                                            Y_SYU_CNT = Y_SYU_CNT + 1
                                            SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                        
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).PRINT_SUMI Then
                                                PRINT_OFF = True
                                            Else
                                        
'                                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).PRINT_SUMI = True
                                            
                                            End If
                                        
                                        End If
                                    End If
                                Next k
                            End If
                            
                            If Not PRINT_OFF Then
                                
                                ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01
                                
                                If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                End If
                                '枝番更新   2010.02.15
                                For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                                    If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                    
                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
'2012.04.01                                            If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                GoTo Abort_Tran
'2012.04.01                                           End If
                                        End If
                                    
                                    Else
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KONPOU_F <> "1" Then
                                            
                        
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU, "000")) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01                                                End If
                                            
                                            
                                            End If
                                                                
                                        End If
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    End If
                                Next k
                                '枝番更新   2010.02.15
                                
                                
                                
                                
                                
                                If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                Else
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                End If
                                
                                'データ送信
                                                            
                                ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                            
                                ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                            
                                ID_KANRI_TBL(ING_No).LABEL_ON = True
                            
                                '-----------------------------------------------ヘッダー
                        
                                Call Wel_Head_Print_Text_Proc(fileName)
                            
                                
                                
                                Sendbuf = Text_Create_Proc()
                                
                            
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            
                            End If
                        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 荷札発行処理    2012.03.30
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT Then
                
                
                
                
                
                
                
                
                
                
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                            
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            If Inspection_QTY = 1 Then
    
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            Else
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                            End If
                            
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                    
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If
                                End If
                            Next k
                                                                                    '表示内容
                            
                            If Y_SYU_CNT < 2 Then
    
'                                If Inspection_QTY = 1 Then
    
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
'                                End If
                                                                                    
                            Else
                            
'                                If Inspection_QTY = 1 Then
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                            End If
                                                                                    
                                                                                    '数値初期表示
                            If Inspection_QTY = 1 Then
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                            Else
                                Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                            End If
                                                                                    '初期カーソル位置
                            If Inspection_QTY = 1 Then
    
                                Send_Text.Box_Type(4).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                            Else
                                Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                            End If
                                                                                    
                                                                                    '入力桁数
                            If Inspection_QTY = 1 Then
                                Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                            Else
                                Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                            End If
                                                                                    
                                                                                    
                            '2009.04.15
                            If SYUKA_QTY > 1 Then
                                Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                            End If
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            Sendbuf = Text_Create_Proc()
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                
                
                        Else
                
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                            
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                            Else
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCANK                             '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK        '2007.04.21
'                            End If
                            
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then            '2012.09.05 j-->k
                                    
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If
                                End If
                            Next k
                                                                                    '表示内容
                            
                            If Y_SYU_CNT < 2 Then
    
 '                               If Inspection_QTY = 1 Then
    
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
 '                               Else
 '                                   Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
 '                                   Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
 '                               End If
                                                                                    
                            Else

'                                If Inspection_QTY = 1 Then
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                            End If
                                                                                    
                                                                                    '数値初期表示
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                            Else
                                Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
'                            End If
                                                                                    '初期カーソル位置
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Start_Pos = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                            Else
                                Send_Text.Box_Type(4).Start_Pos = "01"                                              '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"                         '2007.04.21
'                            End If
                                                                                    
                                                                                    '入力桁数
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).Max_Size = "00"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'                            Else
                                Send_Text.Box_Type(4).Max_Size = "20"                                               '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"                          '2007.04.21
'                            End If
                                                                                    
                                                                                    
                            '2009.04.15
                            If SYUKA_QTY > 1 Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then       '2012.04.09
                                Else
                                    Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                End If                  '2012.04.09
                            
                            Else                                            '2012.11.15
                                ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""    '2012.11.15
                            End If
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            Sendbuf = Text_Create_Proc()
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                
                
                End Select
            
            Next i
'''''''''''''''''''''''''''''''
    
    
        Case Step_Sagyo4_RES        '４回目の受信（検品数　受信）
            
            For i = 0 To M_Gyo - 1
                
                    
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 10))
                    
                    Case LCD_Syuka_Su1, LCD_Syuka_Su2, "出荷数："  '出荷数(検品数)
                        
                        SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        If Not IsNumeric(SURYO) Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        
                        End If
                
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                
                        If CLng(SURYO) <> SYUKA_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷数エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
            
            ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""        '2012.11.15
                        
            
            Y_SYU_CNT = 0
            SYUKA_QTY = 0
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                    
                        Y_SYU_CNT = Y_SYU_CNT + 1
                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                    End If
                End If
            Next j
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        '------------------------------------   出荷予定の処理
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID№
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                                 Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
        
                    '''他行の使用を継続するため
                    '''Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                    '''Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                        Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                    '出荷予定書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    
                                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                    Inspe_Proc_DEN_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                        
                        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID№
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                                            
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                        Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                                    
                                                    
                        Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
'2012.10.31                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Inspe_Proc_DEN_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                                            
                                            
                        '------------------------------------   在庫移動履歴の処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                            MENU_NO = ""
                        End If
                                            
                        '履歴出力の為の読み込み
                        Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                        Call UniCode_Conv(K0_MTS.SS_CODE, "")
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                                Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                            
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    CYU_KBN_SPO, _
                                                    Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状№:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                                    , , , , MENU_NO, _
                                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_DEN_ALL = SYS_ERR
                                GoTo Abort_Tran
                        End Select
                                            
                        '検品済！！
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = True
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
                                        
                    End If
                
                
                '--------------------   2012.10.02  ▽
                Else
                
                    Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID№
    
                    Do
                    
                        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                GoTo Abort_Tran
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                GoTo Abort_Tran
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                
                    Loop
                
                
                    Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
'''''''''''''''                    ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                                '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                    Do
                        sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                GoTo Abort_Tran
                        
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Inspe_Proc_DEN_ALL = SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                
                '--------------------   2012.10.02  △
                
                
                End If
            
            Next j
            
            
'2012.11.15            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.31
            
            '作業ﾛｸﾞ出力    2009.04.17
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO) Then
                    Inspe_Proc_DEN_ALL = SYS_ERR
                    Exit Function
                End If
            End If
            '作業ﾛｸﾞ出力    2009.04.17
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
                    
                    
                    
                    
                    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                    
            Select Case ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND
            
            
                Case "1"
                    '集合梱包なし
                
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ


''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
'''' 荷札処置
'                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
'                                ID_KANRI_TBL(ING_No).LABEL_ON = False
'                            Else
'
'                                PRINT_OFF = False
'
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
'                                    If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
'                                        PRINT_OFF = True
'                                    End If
'                                End If
'
'                                If Not PRINT_OFF Then
'
'                                    '2010.06.16
'                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'
'                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                    Select Case sts
'                                        Case BtNoErr
'
'                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            End If
'
'                                        Case BtErrKeyNotFound
'
'
'                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                        Case Else
'                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                            Sendbuf = Text_Create_Proc()
'                                            GoTo Abort_Tran
'                                    End Select
'
'
'                                    '2010.06.16
'
'                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
'                                    Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
'
'                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'                                    'Y_SYU_CNT = 0
'                                    SYUKA_QTY = 0
'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                'Y_SYU_CNT = Y_SYU_CNT + 1
'                                                SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'                                                    PRINT_OFF = True
'                                                Else
'
'                                                   ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
'
'                                                End If
'
'                                            End If
'                                        End If
'                                    Next j
'                                End If
'
'                                If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
'                                    PRINT_MAISU = PRINT_MAISU - 1
'                                    If PRINT_MAISU < 1 Then
'
'                                    '枝番更新   2010.02.15
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                        GoTo Abort_Tran
'
'                                                    End If
'
'
'                                                End If
'                                            Else
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                            GoTo Abort_Tran
'
'                                                        End If
'
'
'
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
'                                    '枝番更新   2010.02.15
'
'                                        PRINT_OFF = True
'
'                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
'
'
'                                    Else
''                                            PRINT_MAISU = PRINT_MAISU - 1
'                                        Start_Page_No = Start_Page_No + 1
'                                    End If
'                                End If
'
'                                If Not PRINT_OFF Then
'
'                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'                                    '2010.06.16
'                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                    '2010.06.16
'                                    Select Case sts
'                                        Case BtNoErr
'
'                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            End If
'
'                                        Case BtErrKeyNotFound
'
'
'                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                        Case Else
'                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                            Sendbuf = Text_Create_Proc()
'                                            GoTo Abort_Tran
'                                    End Select
'
'
''2010.02.21                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
''2010.02.21                                    Start_Page_No = Start_Page_No + 1
'
''2010.02.21                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'
'                                    If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
'                                    End If
'
'
'
'                                    '枝番更新   2010.02.15
'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And _
'                                                    (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'
'                                                        GoTo Abort_Tran
'                                                    End If
'
'
'                                                Else
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                        GoTo Abort_Tran
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Else
'                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                        GoTo Abort_Tran
'
'                                                    End If
'
'
'
'                                                End If
'
'
'
'                                            End If
'                                        End If
'                                    Next j
'                                    'データ送信
'
'                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'
'                                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
'
'                                    ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU - 1
'                                    '-----------------------------------------------ヘッダー
'
'                                    Call Wel_Head_Print_Text_Proc(fileName)
'
'                                    Sendbuf = Text_Create_Proc()
'
'
'                                    Inspe_Proc_DEN_ALL = False
'                                    Exit Function
'                                End If
'
'                            End If
'''' 荷札処置
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
'                            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 1
                    
                            ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""        '2012.11.15
                    
                    
                        Case True
                            '残なし　口数へ
                    
                    
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
'''' 荷札処置
'                                PRINT_OFF = False
'
'                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
'                                    PRINT_OFF = True
'                                Else
'                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
'
'                                        If KONPOU_ON = KONPOU_ON_SUMI Then
'
'                                            PRINT_OFF = True
'
'                                        End If
'
'                                    End If
'                                End If
'
'                                If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
'                                    ID_KANRI_TBL(ING_No).LABEL_ON = False
'                                Else
'
'            '                        Y_SYU_CNT = 0
'            '                        SYUKA_QTY = 0
'
'                                    PRINT_OFF = False
'
'                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
'                                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
'
'                                                        '枝番更新   2010.02.15
'                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'                                                    Start_Page_No = 1
'                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'
'
'
'                                                        '枝番更新   2010.02.15
'
'                                                        PRINT_OFF = True
'
'                                                    End If
'
'                                                Else
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                GoTo Abort_Tran
'
'                                                            End If
'
'
'                                                        End If
'
'                                                    End If
'                                                End If
'                                            Next j
'                                        End If
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                        Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'                                        '2010.06.16
'                                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                        Select Case sts
'                                            Case BtNoErr
'
'                                                If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'                                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                                End If
'
'                                            Case BtErrKeyNotFound
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            Case Else
'                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                                Sendbuf = Text_Create_Proc()
'                                                GoTo Abort_Tran
'                                        End Select
'
'                                        PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
'                                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
'
'                                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'                                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
'                                            PRINT_MAISU = PRINT_MAISU - 1
'
'
'
'                                            If PRINT_MAISU < 1 Then
'
'                                                        '枝番更新   2010.02.15
'                                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                GoTo Abort_Tran
'                                                            End If
'
'                                                        End If
'
'
'
'                                                    Else
'                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                    GoTo Abort_Tran
'                                                                End If
'
'
'
'                                                            End If
'
'                                                        End If
'
'
'
'                                                    End If
'                                                Next j
'                                                        '枝番更新   2010.02.15
'
'                                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
'
'                                                PRINT_OFF = True
'                                            Else
'            '                                    PRINT_MAISU = PRINT_MAISU - 1
'                                                Start_Page_No = Start_Page_No + 1
'                                            End If
'                                        End If
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'                                        Y_SYU_CNT = 0
'                                        SYUKA_QTY = 0
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                    Y_SYU_CNT = Y_SYU_CNT + 1
'                                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'                                                        PRINT_OFF = True
'                                                    Else
'
'                                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
'
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
'                                        End If
'
'
'
'
'
'                                                        '枝番更新   2010.02.15
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'                                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And Start_Page_No = 2 Then
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'                                                    Else
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'                                                    End If
'
'                                                End If
'
'
'
'                                            Else
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'
'                                                    End If
'
'                                                End If
'
'
'
'
'
'                                            End If
'                                        Next j
'                                                        '枝番更新   2010.02.15
'
'
'
'
'                                        If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
'                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
'                                        Else
'                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
'                                        End If
'
'
'                                        'データ送信
'
'                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 2
'
'                                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
'
'                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                        '-----------------------------------------------ヘッダー
'
'                                        Call Wel_Head_Print_Text_Proc(fileName)
'
'                                        Sendbuf = Text_Create_Proc()
'
'
'                                        Inspe_Proc_DEN_ALL = False
'                                        Exit Function
'
'                                    End If
'                                End If
'            ''' 荷札処置
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
'2012.11.15                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                        '表示内容
'2012.11.15
'2012.11.15                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                                Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                                Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                                Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '2012.11.15
                                Call Wel_OKURI_SAKI_PROC
                                '-----------aaa------------------------------------４行目
                                
'口数INPUT １
                                
                                wkKONPO_F = ""
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                    
                                        wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                        Exit For
                                    End If
                                Next j
                                
                                If wkKONPO_F = "1" Then
                                                        
                                    If Inspection_Input Then
                                        KUTI_SU_INPUT_F = False
                                    Else
                                        KUTI_SU_INPUT_F = True
                                    End If
                                
                                
                                    TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                    TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                            
                                Else
                                    TOTAL_KUTI_SU = 1
                                    KUTI_SU_INPUT_F = True
                                    TOTAL_SAI_SU = 0#
                                End If
                                            
                                            
                                            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                            
                                            
                                If KUTI_SU_INPUT_F Then
                                
                                    Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                                
                                Else
                                    Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                
                                    
                                    If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                    
                                    
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                                
        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.10
                                    '----------------------------------- データ更新処理開始 -----------
                                                                    'トランザクション開始
                                    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    If sts <> BtNoErr Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    End If
                                            
                                                                
                                    For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                            '単体梱包１口時
                                            If OKURI_NO_SEQ_Update_Proc(k, Format(1, "000"), Sendbuf, Format(TOTAL_KUTI_SU, "000")) Then
                                                GoTo Abort_Tran
                                            End If
                                            
                                        End If
                                    Next k
                                            
                                                        'トランザクション終了
                                    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    If sts <> BtNoErr Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpEndTransaction, "", 0)
                                        GoTo Abort_Tran
                                    End If
                                            
        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.10
                                
                                
                                
                                
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                                
'                                ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 2
                        
                        End Select
                        
                
                
                Case "2"
                    '集合梱包のみ
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                    
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
'                            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 3
                    
                    
                    
                        Case True
                            '残なし　口数へ
                    
                    
''' 荷札処置
                                PRINT_OFF = False
Debug.Print ID_KANRI_TBL(ING_No).KEN_TYPE
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
                                    PRINT_OFF = True
                                Else
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
                                    
                                        If KONPOU_ON = KONPOU_ON_SUMI Then
                
                                            PRINT_OFF = True
                
                                        End If
                
                                    End If
                                End If
                                
                                If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                    ID_KANRI_TBL(ING_No).LABEL_ON = False
                                Else
                                    
            '                        Y_SYU_CNT = 0
            '                        SYUKA_QTY = 0
                                    
                                    PRINT_OFF = False
                                    
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
                                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                            
                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                    
                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                    
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                                        Start_Page_No = 1
'2012.04.01                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01                                                        End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        PRINT_OFF = True
                                                    End If
                                                
                                                
                                                Else
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                        
                                    
'2012.04.01                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                                GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                            End If
                                                        
                                                        
                                                        
                                                        End If
                                                                            
                                                    End If
                                                
                                                
                                                
                                                
                                                
                                                End If
                                            Next j
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                        Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                        '2010.06.16
                                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                        '2010.06.16
                                        Select Case sts
                                            Case BtNoErr
                                            
                                                If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                                
                                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                                
                                                End If
                                            
                                            Case BtErrKeyNotFound
                                            
                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                            
                                            Case Else
                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                                Sendbuf = Text_Create_Proc()
                                                GoTo Abort_Tran
                                        End Select
                                        
                                        PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                                                
                                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
                                                                
                                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                        
                                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
                                            PRINT_MAISU = PRINT_MAISU - 1
                                            If PRINT_MAISU < 1 Then
                                                
                                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    
                                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                        
                                                        '枝番更新   2010.02.15
'2012.04.01                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                                GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                            End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                        
                                        
                                        
                                                        End If
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    Else
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                            
                                        
'2012.04.01                                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                                    GoTo Abort_Tran
'2012.04.01                                                                End If
                                                                
                                                        
                                                            
                                                            End If
                                                                                
                                                        End If
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    End If
                                                Next j
                                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                                PRINT_OFF = True
                                            Else
            '                                    PRINT_MAISU = PRINT_MAISU - 1
                                                Start_Page_No = Start_Page_No + 1
                                            End If
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                        
                                        Y_SYU_CNT = 0
                                        SYUKA_QTY = 0
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                        
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                
                                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                                
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                                        PRINT_OFF = True
                                                    Else
                                                
                                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                                                    
                                                    End If
                                                
                                                End If
                                            End If
                                        Next j
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                        
                                        ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01

                                        
                                        If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                        End If
                                        
                                        
                                        
                                        
                                        
                                        '枝番更新   2010.02.15
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                    
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                            
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01                                                    End If
                                                End If
                                            
                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                    
                                
'2012.04.01                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01                                                        End If
                                                    
                                                    
                                                    End If
                                                                        
                                                End If
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            End If
                                        Next j
                                        '枝番更新   2010.02.15
                                        
                                        
                                        
                                        
                                        
                                        If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                        Else
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                        End If
                                        
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                        GoTo Abort_Tran
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
                                        
                                        'データ送信
                                                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 2
                                                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                                    
                                        '-----------------------------------------------ヘッダー
                                
                                        Call Wel_Head_Print_Text_Proc(fileName)
                                    
                                        Sendbuf = Text_Create_Proc()
                                        
'                                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 4
                                    
                                        Inspe_Proc_DEN_ALL = False
                                        Exit Function
                                    
                                    End If
                                End If
            ''' 荷札処置
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
'2012.11.15                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                        '表示内容
'2012.11.15
'2012.11.15                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                                Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                                Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                                Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '2012.11.15
                                Call Wel_OKURI_SAKI_PROC
                                '-----------aaa------------------------------------４行目
                                
'口数INPUT ２
                                wkKONPO_F = ""
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                    
                                        wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                        Exit For
                                    End If
                                Next j
                                
                                If wkKONPO_F = "1" Then
                                                        
                                    If Inspection_Input Then
                                        KUTI_SU_INPUT_F = False
                                    Else
                                        KUTI_SU_INPUT_F = True
                                    End If
                                
                                
                                    TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                    TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                            
                                Else
                                    TOTAL_KUTI_SU = 1
                                    KUTI_SU_INPUT_F = True
                                    TOTAL_SAI_SU = 0#
                                End If
                                            
                                            
                                            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                            
                                            
                                If KUTI_SU_INPUT_F Then
                                
                                    Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                                
                                Else
                                    Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                
                                    If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                
                                
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                                
                                
                                
                                End If
                                
                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 5
            
                        End Select
                    
                Case "3"
                    '混在
            
                    
                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
            
            
                    Select Case (KONPOU_ON - KONPOU_ON_SUMI)
            
                        Case 0
                            '口数へ
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------aaa------------------------------------４行目
'口数input ３
                            wkKONPO_F = ""
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                
                                    wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                    Exit For
                                End If
                            Next j
                            
                            If wkKONPO_F = "1" Then
                                                    
                                If Inspection_Input Then
                                    KUTI_SU_INPUT_F = False
                                Else
                                    KUTI_SU_INPUT_F = True
                                End If
                            
                            
                                TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                        
                            Else
                                TOTAL_KUTI_SU = 1
                                KUTI_SU_INPUT_F = True
                                TOTAL_SAI_SU = 0#
                            End If
                                        
                                        
                                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                            End If
                                        
                                        
                            If KUTI_SU_INPUT_F Then
                            
                                Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                                
                                                        
                            Else
                                Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                            
                                
                                
                                
                                
                                If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                            
                            
                            
                            End If
                        
                        
                            Sendbuf = Text_Create_Proc()
                        
                        
'                            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 6
                        
                        
                        
                        Case Else
                            '品番へ
            
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                                        
                                                                                        '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                            
'                            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 7
                    
                    End Select
            
            End Select
                    
                    
                    
                    
        Case Step_Sagyo5_RES        '５回目の受信（口数）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Left(Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)), 6)
                    '口数
                    Case LCD_KUTI_SU_S
                
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU < 0 Then
                        
                
                
                
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            
                            End If
                    
                            KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If KUTI_SU < 1 Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        Else
                            KUTI_SU = ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU
                        End If
                    
                    
                    
                    '才数
                    Case LCD_SAI_SU_S
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU < 0 Then
                        
                        
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            
                            End If
                    
                            SAI_SU = CDbl(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If SAI_SU <= 0 Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        Else
                            SAI_SU = ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU
                        
                        
                            If SAI_SU < 1 Then
                                SAI_SU = 1
                            Else
                                If SAI_SU > 1 Then
                                    SAI_SU = CLng(ToHalfAdjust(CCur(SAI_SU), 0))
                                End If
                            End If
                        
                        End If
                    
                        '送り状最大印刷枚数獲得 2010.01.21
                            
                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                
                                    If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                
                                
                                Else
                                
                                    If Label_Print_Total_Su_Proc(0, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                End If
                            End If
                        Next j
                                        
                            
                            
                            
                        
                    
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                            Else
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU <= 1 Then
                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                    End If
                                
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                                
                                End If
                            End If
                        Next j
                        
                        
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        Inspe_Proc_DEN_ALL = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                
                                
                                
                                
                                
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                    'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                    If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                        If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                        End If
                                    Else
'''''''                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                        
                                        
                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                                                            
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                    
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN_SAV, Format(SAI_SU, "00.00"))
                                                    
                                                    
                                Else
                                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                        
                                        'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                        If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                            If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                            Else
                                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                            End If
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                                                                
                                        End If
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                
                                
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN_SAV, Format(SAI_SU, "00.00"))
                                
                                
                                
                                End If
                                                    
                                
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_DEN_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j

        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                   
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                
                                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                    'ID№
                                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
                
                                Do
                                
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                            
                                Loop
                                
                                
                                
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                                
                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_DEN_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                

''' 品番単位での丸め処理
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
''' 品番単位での丸め処理

                        If ID_KANRI_TBL(ING_No).KEN_TYPE = "1" Then
                            
                            
                            
                            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                            '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            End If
                                    
                                                        
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                    '集合梱包時
                                    If OKURI_NO_SEQ_Update_Proc(k, Format(1, "000"), Sendbuf, Format(KUTI_SU, "000")) Then
                                        GoTo Abort_Tran
                                    End If
                                    
                                End If
                            Next k
                                    
                                                'トランザクション終了
                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                            End If
                                    
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                            
                            ID_KANRI_TBL(ING_No).KEN_TYPE = ""

'2012.03.29

                            If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 0 Then
                                ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                            End If

    
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
                                If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                    PRINT_OFF = True
                                End If
                            End If



                            PRINT_MAISU = KUTI_SU


                            Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
    
                            PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU


                            If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
                                PRINT_MAISU = PRINT_MAISU - 1
                                If PRINT_MAISU < 1 Then

                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then


                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then


                                                        '枝番更新   2010.02.15
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01                                                End If


                                                        '枝番更新   2010.02.15

                                            End If
                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                    End If


                                                End If

                                            End If
                                        End If
                                    Next j



                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No




                                    PRINT_OFF = True
                                Else
'                                    PRINT_MAISU = PRINT_MAISU - 1
                                    Start_Page_No = Start_Page_No + 1

                                End If
                            End If

''' 荷札処置
                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                ID_KANRI_TBL(ING_No).LABEL_ON = False
                            Else

'2012.03.30
'                                Y_SYU_CNT = 0
'                                SYUKA_QTY = 0
'
'                                PRINT_OFF = False
'
'                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                            Y_SYU_CNT = Y_SYU_CNT + 1
'                                            SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'
'                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'
'                                                PRINT_OFF = True
'                                            Else
'
'                                            End If
'                                        End If
'                                    End If
'                                Next j
'
'                                If Not PRINT_OFF Then
                                ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01

                                If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                End If




                                '枝番更新   2010.02.15
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then

                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then


                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01
'2012.04.01
'2012.04.01                                                End If

                                            Else


                                                    '枝番更新   2010.02.15
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01
'2012.04.01
'2012.04.01                                                End If

                                            End If

                                                    '枝番更新   2010.02.15





                                        End If
                                    Else
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then


                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01                                                    End If
                                                Else

'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01                                                    End If



                                                End If
                                            End If
                                        End If
                                    End If
                                Next j
                                '枝番更新   2010.02.15
                                If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                Else
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                End If


                                ID_KANRI_TBL(ING_No).LABEL_STEP = 9

                                'データ送信

                                ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ

                                ID_KANRI_TBL(ING_No).LABEL_ON = True

                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Print_Text_Proc(fileName)
                                '-----------------------------------------------ボディ
                                Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)

                                Sendbuf = Text_Create_Proc()

                                Inspe_Proc_DEN_ALL = False
                                Exit Function

                            End If
                        End If
'                        End If
''' 荷札処置

                        KENPIN_END = True
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                            
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                    KENPIN_END = False
                                    Exit For
                                End If
                            End If
                        Next j

'                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15


                        Select Case KENPIN_END
                    
                            Case True
    
                            '次の作業要求

                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                                            
                                            
                                            
                                            
                                            
                    
                    
                            Case Else
                    
    ''''''''''''''''''''''''''''''''''''''''''''''
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                
                                '-----------------------------------------------３行目
                                Call Wel_HIN_NO_Req_Text_3_Proc
                                '-----------------------------------------------４行目
                                Call Wel_HIN_NO_Req_Text_4_Proc
                                
                                '-----------------------------------------------３行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                    
                        End Select
                    
                    End Select
                
            Next i
        

        Case Step_PRINT_RES        '印刷終了
    
    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    
    
            Select Case ID_KANRI_TBL(ING_No).LABEL_STEP
                Case 1      '品番へ
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------  2012.03.30
'
'                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
'
'                    '-----------------------------------------------ヘッダー 02.24
'                    Call Wel_Head_Text_Proc
'
'                    '-----------------------------------------------１行目
'                    Call Wel_DETAIL_0_Text_Proc
'                    '-----------------------------------------------２行目
'                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
'
'
'
'
'                    '-----------------------------------------------３行目
'                    Call Wel_HIN_NO_Req_Text_3_Proc
'                    '-----------------------------------------------４行目
'                    Call Wel_HIN_NO_Req_Text_4_Proc
'                    '-----------------------------------------------５行目
'                    Call Wel_Clear_Text_Proc
'
'                    Sendbuf = Text_Create_Proc()



                        
                        
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                        If RTrim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                            Exit For
                        End If
                    
                    Next j
                        
'                    Print_bara_F = False
'
'                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
'
'                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Cnt_Bara_Su < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
'                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Cnt_Bara_Su = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Cnt_Bara_Su + 1
'                        Print_bara_F = True
'                    Else
'                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Cnt_Hako_Su = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Cnt_Hako_Su + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
'                    End If
                    
                    
 



                   If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT Then
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                                                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                        End If
                                
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If ID_KANRI_TBL(ING_No).KEN_HINBAN = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO And _
                                Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                '単体梱包時
                                If OKURI_NO_SEQ_Update_Proc(k, Format(ID_KANRI_TBL(ING_No).LAST_START_PAGE, "000"), Sendbuf, Format(ID_KANRI_TBL(ING_No).LAST_END_PAGE, "000")) Then
                                    GoTo Abort_Tran
                                End If
                                
                            End If
                        Next k
                                
                                
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
'2012.11.15                                                                                'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        Else
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                        End If
                        
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                End If
                            End If
                        Next k
                                                                                    '表示内容
                            
                        If Y_SYU_CNT < 2 Then
    
'                                If Inspection_QTY = 1 Then
    
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
'                                End If
                                                                                    
                        Else
                            
'                                If Inspection_QTY = 1 Then
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                        End If
                                                                                    
                                                                                '数値初期表示
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                        Else
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                        End If
                                                                                '初期カーソル位置
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                        Else
                            Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                        End If
                                                                                
                                                                                '入力桁数
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Else
                            Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                        End If
                                                                                
                                                                                
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                        End If
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
'                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 8
                        
                        Sendbuf = Text_Create_Proc()
                        Inspe_Proc_DEN_ALL = False
                        Exit Function
                
                
                    Else
                
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            
                            
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                                
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
'2012.11.15                                                                                'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        
                        
                        '-----------------------------------------------５行目
                                                                                    'BOX属性
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                            Else
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCANK                             '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK        '2007.04.21
'                            End If
                            
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                End If
                            End If
                        Next k
                                                                                    '表示内容
                            
                        If Y_SYU_CNT < 2 Then
    
 '                               If Inspection_QTY = 1 Then
    
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
 '                               Else
 '                                   Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
 '                                   Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
 '                               End If
                                                                                    
                        Else

'                                If Inspection_QTY = 1 Then
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                        End If
                                                                                
                                                                                    '数値初期表示
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                            Else
                        Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
'                            End If
                                                                                    '初期カーソル位置
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Start_Pos = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                            Else
                        Send_Text.Box_Type(4).Start_Pos = "01"                                              '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"                         '2007.04.21
'                            End If
                                                                                    
                                                                                    '入力桁数
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).Max_Size = "00"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'                            Else
                        Send_Text.Box_Type(4).Max_Size = "20"                                               '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"                          '2007.04.21
'                            End If
                                                                                    
                                                                                    
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then     '2012.04.13
                            Else
                                Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                            End If                  '2012.04.13
                        End If
                                                                            
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                        Inspe_Proc_DEN_ALL = False
                        Exit Function
                    End If
                    
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------  2012.03.30
                
                Case 2      '口数へ
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    '-----------------------------------------------ヘッダー
                    Call Wel_Head_Text_Proc
                    
                    '-----------------------------------------------１行目
                    Call Wel_DETAIL_0_Text_Proc
                    '-----------------------------------------------２行目
                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                    
                    '-----------------------------------------------３行目
'2012.11.15                                                                            'BOX属性
'2012.11.15                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                            '表示内容
'2012.11.15
'2012.11.15                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                            '数値初期表示
'2012.11.15                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                            '初期カーソル位置
'2012.11.15                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                            '入力桁数
'2012.11.15                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '2012.11.15
                    Call Wel_OKURI_SAKI_PROC
                    
                    '-----------------------------------------------４行目
'口数　４
                    wkKONPO_F = ""
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                    
                        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                        
                            wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                            Exit For
                        End If
                    Next j
                    
                    If wkKONPO_F = "1" Then
                                            
                        If Inspection_Input Then
                            KUTI_SU_INPUT_F = False
                        Else
                            KUTI_SU_INPUT_F = True
                        End If
                    
                    
                        TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                        TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                
                    Else
                        TOTAL_KUTI_SU = 1
                        KUTI_SU_INPUT_F = True
                        TOTAL_SAI_SU = 0#
                    End If
                                
                                
                                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                    End If
                                
                                
                    If KUTI_SU_INPUT_F Then
                    
                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                        ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                    
                    Else
                        Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                    
                    
                    
                        If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                    
                    
                    
                    
                    
                    
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                    
                    
                    
                    End If
                    
                    Sendbuf = Text_Create_Proc()
                
                Case 9
        
                    Select Case (Y_SYU_CNT - Sumi_CNT)
                
                        Case 0
                
                            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                            Select Case sts
                                Case BtNoErr
                                '   -------------------------------- エラーメッセージ作成
                                Case Else
                                '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                            End Select
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                            
                            Sendbuf = Text_Create_Proc()
            
            
                        Case Else
                        
        ''''''''''''''''''''''''''''''''''''''''''''''
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                            Call Wel_HIN_NO_Req_Text_3_Proc
                            '-----------------------------------------------４行目
                            Call Wel_HIN_NO_Req_Text_4_Proc
                            '-----------------------------------------------５行目
                            Call Wel_Clear_Text_Proc
        
                            Sendbuf = Text_Create_Proc()
        
            
                End Select
            End Select
    
    End Select
                    
                    

    Inspe_Proc_DEN_ALL = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Private Function Inspe_Proc_DEN(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（宅配伝票読み込み 大阪ＰＣ向け）』
'
'       2006.12.07
'
'
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07


Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Long

Dim SAI_SU          As Double

Dim UNSOU_KAISHA    As String
 
Dim SYUKA_YMD       As String
Dim JYUSHO          As String
Dim BIKOU           As String

Dim SURYO           As String

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag

Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean

'2010.01.21
Dim KONPOU_ON           As Integer




Dim KONPOU_ON_SUMI      As Integer
Dim KONPOU_OFF          As Integer
Dim KONPOU_OFF_SUMI     As Integer



Dim PRINT_OFF           As Boolean
Dim Start_Page_No       As Long
Dim PRINT_TOTAL_SU      As Long
Dim PRINT_MAISU         As Long
Dim fileName            As String
Dim ID_SEQ              As Integer
Dim DISP_SAI_SU         As Double

Dim wkKUTI_SU           As String
Dim wkKONPO_F           As String * 1

Dim TOTAL_KUTI_SU       As Integer
Dim TOTAL_SAI_SU        As Double
Dim MUKE_NAME           As String
Dim OKURI_NO_MAX        As Integer
Dim KUTI_SU_INPUT_F     As Boolean

Dim KEN_TEL_NO          As String * 20


Dim OKURI_NO_F          As Boolean
'2010.01.21


Dim FUKUYAMA_CHK_F      As Boolean

    Inspe_Proc_DEN = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                                        
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, _
                                                SYUKA_YMD, _
                                                JYUSHO, _
                                                BIKOU, _
                                                Start_Page_No, _
                                                KUTI_SU, _
                                                MUKE_NAME, _
                                                OKURI_NO_MAX, , , _
                                                KEN_TEL_NO)
                        
                        
                        '他端末で使用中 2011.04.07
                        If sts = SYS_CANCEL Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN = False
                            Exit Function
                        End If
                        '他端末で使用中 2011.04.07
                                
                        
                        
                        
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                                                    
                            Next j
                                                     
                                                     
                            If CANCEL_F Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN = False
                                Exit Function
                            End If
                        End If
                        
                        
                        If Y_SYU_CNT = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN = False
                            Exit Function
                        End If
                                                 
                        If Sumi_CNT = Y_SYU_CNT And Start_Page_No <> 0 Then
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品処理済！", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN = False
                            Exit Function
                        
                        End If
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = Y_SYU_TBL(j).KONPOU_F        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_CND = Y_SYU_TBL(j).KONPOU_CND    '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).TOTAL_SU = Y_SYU_TBL(j).TOTAL_SU        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = Y_SYU_TBL(j).SAI_SU            '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = Y_SYU_TBL(j).KUTI_SU          '2010.01.21
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = Y_SYU_TBL(j).PRINT_SUMI    '2010.01.21
                        
                                                                                                        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ = Y_SYU_TBL(j).OKURI_NO_SEQ
                        
                        Next j
                        
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        '出荷日
                        ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = SYUKA_YMD
                        '住所
                        ID_KANRI_TBL(ING_No).KEN_JYUSHO = JYUSHO
                        
                        '備考
                        ID_KANRI_TBL(ING_No).KEN_BIKOU = BIKOU
                        '向け先
                        ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = MUKE_NAME
                        
                        '枝番
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO_MAX = OKURI_NO_MAX
                        '電話番号
                        ID_KANRI_TBL(ING_No).KEN_TEL_NO = KEN_TEL_NO
                        
                        
                        
                        'ﾗﾍﾞﾙ開始ページ№
                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                        
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                        
                    
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        
                        
                        
                        End If
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                        
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                        If KONPOU_ON <> 0 Then
                            If KONPOU_ON = KONPOU_ON_SUMI Then
                                                    
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                                    
                            End If
                        End If
                        
                        
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_SAKI)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_SAKI)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                
                
                
                        Else
                
                
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                                                                                    'BOX属性
                                                                                    
                                                                                    
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
        
    ''' 品番単位での丸め処理
KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI          '2011.03.17
                            
                            
Select Case KONPOU_ON                           '2011.03.17
                    
''''''''''''Select Case (KONPOU_ON - KONPOU_ON_SUMI)     '2011.03.17
                            
                                Case 0
                                '集合梱包なし
                                
                                    
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                        If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                        
                                        
                                        
                                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                            
                                            '-----------------------------------------------ヘッダー
                                            Call Wel_Head_Text_Proc
                                            '-----------------------------------------------１行目
                                            Call Wel_DETAIL_0_Text_Proc
                                            '-----------------------------------------------２行目
                                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                            '-----------------------------------------------３行目
                                                                                                    'BOX属性
                                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                                    '表示内容
                                                                                                    
                                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                                    
                                                                                                    '数値初期表示
                                            Send_Text.Box_Type(2).INIT = ""
                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                                    '初期カーソル位置
                                            Send_Text.Box_Type(2).Start_Pos = ""
                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                                    '入力桁数
                                            Send_Text.Box_Type(2).Max_Size = "00"
                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                    
                                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        
                                        
                                        
                                        
                                        
                                        
                                            TOTAL_KUTI_SU = 1
                                            KUTI_SU_INPUT_F = True
                                            TOTAL_SAI_SU = 0#
                                                
                                                
                                                
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                            End If
                                                
                                                
                                    
                                            Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                            ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                            ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                    
                                    
                                    
                                            Sendbuf = Text_Create_Proc()
                                        
                                            Inspe_Proc_DEN = False
                                            Exit Function
                                        
                                        
                                        End If
                                    End If
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    
                                    
                                    
                                    '-----------------------------------------------ボディ
                                    Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
            
                                    Sendbuf = Text_Create_Proc()
                                Case Else
                                '集合梱包あり
                                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                            
                                    '-----------------------------------------------２行目
                                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                    '-----------------------------------------------３行目
                                                                                            'BOX属性
                                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                            '表示内容
                                                                                            
                                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(2).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(2).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                            '入力桁数
                                    Send_Text.Box_Type(2).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    '-----------------------------------------------４行目
                                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                            '表示内容
                                                                                        '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = "01"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                            '入力桁数
                                    Send_Text.Box_Type(3).Max_Size = "13"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------５行目
                                    Call Wel_Clear_Text_Proc
            
                                    Sendbuf = Text_Create_Proc()
                            
                            End Select
                        End If
                
                
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状№）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状№
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else
'2009.10.14                         If Len(OKURI_NO) < 11 Or Len(OKURI_NO) > 13 Then
'                            If Len(OKURI_NO) < 10 Or Len(OKURI_NO) > 13 Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                Inspe_Proc_DEN = False
'                                Exit Function
'                            End If
                        
                            If Not IsNumeric(OKURI_NO) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN = False
                                Exit Function
                            End If
                        
                        
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            
                            
                            
                            
                            If Not OKURI_NO_F Then
                            
                        
                        
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN = False
                                Exit Function
                                                
                            End If
                        
                        
                        
                            '2090.04.28
                            If FUKUYAMA_CHK_F Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN = False
                                Exit Function
                            
                            End If
                            '2090.04.28
                        
                        
                        
                        
                        
                        
'                            Select Case Len(Trim(OKURI_NO))
'
'                                Case FUKUYAMA_Length
'                                Case SEIBU_Length
'                                Case KURUME_Length
'
'                                    For k = 0 To UBound(KURUME_CODE)
'
'                                        If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
'                                            Exit For
'                                        End If
'                                    Next k
'
'                                    If k > UBound(KURUME_CODE) Then
'
'
'                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                                        Sendbuf = Text_Create_Proc()
'                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                        Inspe_Proc_DEN = False
'                                        Exit Function
'
'                                    End If
'
'                                Case SAGAWA_Length, YAMATO_Length
'
'                                    For k = 0 To UBound(KURUME_CODE)
'
'                                        If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
'                                            Exit For
'                                        End If
'                                    Next k
'
'                                    If k > UBound(SAGAWA_CODE) Then
'
'                                        For k = 0 To UBound(YAMATO_CODE)
'
'                                            If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
'                                                Exit For
'                                            End If
'
'                                        Next k
'
'                                        If k > UBound(YAMATO_CODE) Then
'
'                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                                            Sendbuf = Text_Create_Proc()
'                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                            Inspe_Proc_DEN = False
'                                            Exit Function
'
'
'
'                                        End If
'
'                                    End If
'
'
'                            End Select
                        
                        End If
                    
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                            
                                '運送会社変換
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, 3) = UNSOU_KAISHA_CODE Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, UNSOU_KAISHA_NAME)
'                                End If
'                                '新運送会社変換 2007.01.09
'
'                                If KURUME_F Then        '久留米
'                                    For k = 1 To UBound(KURUME)
'
'                                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(KURUME(k))) = KURUME(k) Then
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME(0))
'                                            Exit For
'                                        End If
'                                    Next k
'                                End If
'
'                                If FUKUYAMA_F Then      '福山
'                                    For k = 1 To UBound(FUKUYAMA)
'
'                                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(FUKUYAMA(k))) = FUKUYAMA(k) Then
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA(0))
'                                            Exit For
'                                        End If
'                                    Next k
'                                End If
'
'                                If SAGAWA_F Then        '佐川
'                                    For k = 1 To UBound(SAGAWA)
'
'                                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(SAGAWA(k))) = SAGAWA(k) Then
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA(0))
'                                            Exit For
'                                        End If
'                                    Next k
'                                End If
                                                    
                                                    
                                                    
                                                    
                                                    




                                                    
                                                    
                                                    
                                                    
'                                Select Case Len(Trim(OKURI_NO))
'
'                                    Case FUKUYAMA_Length
'                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
'                                    Case SEIBU_Length
'                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
'
'                                    Case KURUME_Length
'
'                                        For k = 0 To UBound(KURUME_CODE)
'
'                                            If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
'                                                Exit For
'                                            End If
'                                        Next k
'
'                                        If k > UBound(KURUME_CODE) Then
'                                        Else
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
'                                        End If
'
'                                    Case SAGAWA_Length, YAMATO_Length
'
'                                        For k = 0 To UBound(KURUME_CODE)
'
'                                            If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
'                                                Exit For
'                                            End If
'                                        Next k
'
'                                        If k > UBound(SAGAWA_CODE) Then
'
'                                            For k = 0 To UBound(YAMATO_CODE)
'
'                                                If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
'                                                    Exit For
'                                                End If
'
'                                            Next k
'
'                                            If k > UBound(YAMATO_CODE) Then
'                                            Else
'
'                                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
'                                            End If
'
'                                        Else
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
'                                        End If
'
'
'                                End Select
                                                    
                                                    
                                                    
                                                    
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                                                    
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_DEN = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
                                                                                'BOX属性
                                                                                
                                                                                
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI              '2011.03.17
        
    ''' 品番単位での丸め処理
Select Case KONPOU_ON                               '2011.03.17
'''''Select Case (KONPOU_ON - KONPOU_ON_SUMI)     '2011.03.17



                        
                            Case 0
                            '集合梱包なし
                            
                                
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                    
                                    
                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                        
                                        '-----------------------------------------------ヘッダー
                                        Call Wel_Head_Text_Proc
                                        '-----------------------------------------------１行目
                                        Call Wel_DETAIL_0_Text_Proc
                                        '-----------------------------------------------２行目
                                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                        '-----------------------------------------------３行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                                '表示内容
                                                                                                
                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                                
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(2).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(2).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(2).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    
                                    
                                    
                                    
                                    
                                    
                                        TOTAL_KUTI_SU = 1
                                        KUTI_SU_INPUT_F = True
                                        TOTAL_SAI_SU = 0#
                                            
                                            
                                            
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                        End If
                                            
                                            
                                
                                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                
                                
                                
                                        Sendbuf = Text_Create_Proc()
                                    
                                        Inspe_Proc_DEN = False
                                        Exit Function
                                    
                                    
                                    End If
                                End If
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                
                                
                                
                                '-----------------------------------------------ボディ
                                Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
        
                                Sendbuf = Text_Create_Proc()
                            Case Else
                            '集合梱包あり
                        
                        
                                '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント 2011.03.04
                                Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------------------------------------------４行目
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                        '表示内容
                                                                                    '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                        '入力桁数
                                '2010.12.07
'                                Send_Text.Box_Type(3).Max_Size = "13"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                Send_Text.Box_Type(3).Max_Size = "20"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                '2010.12.07
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                        
                        End Select
                    End Select
                Next i
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            For i = 0 To M_Gyo - 1
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban     '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                '集合梱包有り時の品番チェック
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN = False
                            Exit Function
                        End If
                        
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND <> "1" Then
                        
                            If KONPOU_ON <> KONPOU_ON_SUMI Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
                            
                            
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN = False
                                    Exit Function
                            
                                End If
                            End If
                        
                        End If
                        'ｷｬﾝｾﾙのﾁｪｯｸ
                        CANCEL_F = True
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            End If
                        Next j
                        
                        If CANCEL_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "キャンセル品番です。", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN = False
                            Exit Function
                        
                        
                        End If
                        
                        
                        
                                
                        '検品済みのﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "検品済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN = False
                            Exit Function
                        End If
                
                        '未出庫のﾁｪｯｸ   2007.05.14
                        If Inspection_Flg = 0 Then
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN <> KAN_KBN_FIN Then
                                        Exit For
                                    End If
                                End If
                            Next j
                                            
                            If j <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN = False
                                Exit Function
                            End If
                        End If
                        '未出庫のﾁｪｯｸ   2007.05.14
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc

''' 品番単位での丸め処理
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        
                        
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        Else
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                        End If
                        
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                                                                                '表示内容
                        
                        If Y_SYU_CNT < 2 Then

                            If Inspection_QTY = 1 Then

                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
                            End If
                                                                                
                        Else
                        
                            If Inspection_QTY = 1 Then
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
                            End If
                        
                        End If
                                                                                
                                                                                '数値初期表示
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                        Else
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                        End If
                                                                                '初期カーソル位置
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                        Else
                            Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                        End If
                                                                                
                                                                                '入力桁数
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Else
                            Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                        End If
                                                                                
                                                                                
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                                                                
                        End If
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
            
            Next i
'''''''''''''''''''''''''''''''
    
    
        Case Step_Sagyo4_RES        '４回目の受信（検品数　受信）
            
            For i = 0 To M_Gyo - 1
                
'                Select Case RTrim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), _
'                                Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 10))
                    
                    Case LCD_Syuka_Su1, LCD_Syuka_Su2, "出荷数："  '出荷数(検品数)
                        
                        SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        If Not IsNumeric(SURYO) Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN = False
                            Exit Function
                        
                        End If
                
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                
                        If CLng(SURYO) <> SYUKA_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷数エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
            
            Y_SYU_CNT = 0
            SYUKA_QTY = 0
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                    
                        Y_SYU_CNT = Y_SYU_CNT + 1
                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                    End If
                End If
            Next j
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        '------------------------------------   出荷予定の処理
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID№
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN = False
                                    GoTo Abort_Tran
                                 Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
        
                    '''他行の使用を継続するため
                    '''Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                    '''Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                        Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                    '出荷予定書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    
                                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                    Inspe_Proc_DEN = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                        
                        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID№
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN = False
                                    GoTo Abort_Tran
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                                            
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                        Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        '運送会社変換
'                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, 3) = UNSOU_KAISHA_CODE Then
'                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, UNSOU_KAISHA_NAME)
'                        End If
'                        '新運送会社変換 2007.01.09
'
'                        If KURUME_F Then        '久留米
'                            For k = 1 To UBound(KURUME)
'
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(KURUME(k))) = KURUME(k) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME(0))
'                                    Exit For
'                                End If
'                            Next k
'                        End If
'
'                        If FUKUYAMA_F Then      '福山
'                            For k = 1 To UBound(FUKUYAMA)
'
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(FUKUYAMA(k))) = FUKUYAMA(k) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA(0))
'                                    Exit For
'                                End If
'                            Next k
'                        End If
'
'                        If SAGAWA_F Then        '佐川
'                            For k = 1 To UBound(SAGAWA)
'
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(SAGAWA(k))) = SAGAWA(k) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA(0))
'                                    Exit For
'                                End If
'                            Next k
'                        End If
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Inspe_Proc_DEN = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                                            
                                            
                        '------------------------------------   在庫移動履歴の処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                            MENU_NO = ""
                        End If
                                            
                        '履歴出力の為の読み込み
                        Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                        Call UniCode_Conv(K0_MTS.SS_CODE, "")
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                                Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                            
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    CYU_KBN_SPO, _
                                                    Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状№:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                                    , , , , MENU_NO, _
                                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_DEN = SYS_ERR
                                GoTo Abort_Tran
                        End Select
                                            
                        '検品済！！
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = True
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
                                        
                    End If
                End If
            
            Next j
            '作業ﾛｸﾞ出力    2009.04.17
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO) Then
                    Inspe_Proc_DEN = SYS_ERR
                    Exit Function
                End If
            End If
            '作業ﾛｸﾞ出力    2009.04.17
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
                    
                    
                    
                    
                    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                    
            Select Case ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND
            
            
                Case "1"
                    '集合梱包なし
                
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ
''' 荷札処置
                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
                                ID_KANRI_TBL(ING_No).LABEL_ON = False
                            Else
                            
                                PRINT_OFF = False
                                
                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
                                    If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                        PRINT_OFF = True
                                    End If
                                End If
                                
                                If Not PRINT_OFF Then
                                
                                    '2010.06.16
                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                            
                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    Select Case sts
                                        Case BtNoErr
                                        
                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                            
                                            
                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                            
                                            End If
                                        
                                        Case BtErrKeyNotFound
                                        
                                        
                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                        
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                
                                
                                    '2010.06.16
                                
                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                                            
                                    Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
                                                            
                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                
                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                    
                                    'Y_SYU_CNT = 0
                                    SYUKA_QTY = 0
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                    
                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                            
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                            
                                                'Y_SYU_CNT = Y_SYU_CNT + 1
                                                SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                            
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                                    PRINT_OFF = True
                                                Else
                                            
                                                   ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                                                
                                                End If
                                            
                                            End If
                                        End If
                                    Next j
                                End If
                                
                                If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
                                    PRINT_MAISU = PRINT_MAISU - 1
                                    If PRINT_MAISU < 1 Then
                                        
                                    '枝番更新   2010.02.15
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                    
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                            
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                        
                                                        GoTo Abort_Tran
                                                    
                                                    End If
                                                                                                    
                                                
                                                End If
                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                    
                                
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                            
                                                            GoTo Abort_Tran
                                                        
                                                        End If
                                                    
                                                    
                                                    
                                                    End If
                                                                        
                                                End If
                                            End If
                                        Next j
                                    '枝番更新   2010.02.15
                                        
                                        PRINT_OFF = True
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                    
                                    
                                    Else
'                                            PRINT_MAISU = PRINT_MAISU - 1
                                        Start_Page_No = Start_Page_No + 1
                                    End If
                                End If
                                
                                If Not PRINT_OFF Then
                                                            
                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                    '2010.06.16
                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    '2010.06.16
                                    Select Case sts
                                        Case BtNoErr
                                        
                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                            
                                            
                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                            
                                            End If
                                        
                                        Case BtErrKeyNotFound
                                        
                                        
                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                        
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                                            
                                                            
'2010.02.21                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                                            
'2010.02.21                                    Start_Page_No = Start_Page_No + 1
                                                            
'2010.02.21                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                                            
                                    ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01
                                                            
                                                            
                                    If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                    End If
                                
                                
                                
                                    '枝番更新   2010.02.15
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                
                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                        
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            
                                                If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And _
                                                    (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then

                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
                                                    
                                                        GoTo Abort_Tran
                                                    End If
                                            
                                            
                                                Else
                                            
                                            
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                    
                                                        GoTo Abort_Tran
                                                    End If
                                            
                                                End If
                                            End If
                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                
                            
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                        
                                                        GoTo Abort_Tran
                                                    
                                                    End If
                                                
                                                
                                                
                                                End If
                                                                    
                                                                    
                                                                    
                                            End If
                                        End If
                                    Next j
                                    '枝番更新   2010.02.15
                                
                                
                                
                                
'2010.02.21                                    If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
'                                    Else
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
'                                    End If
                                    
'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                    GoTo Abort_Tran
'                                                End If
'
'                                            End If
'                                        End If
'                                    Next j
                                    
                                    'データ送信
                                                                
                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                                
                                                                
                                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                                
                                    ID_KANRI_TBL(ING_No).LABEL_ON = True
                                
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU - 1
                                    '-----------------------------------------------ヘッダー
                                
                                    Call Wel_Head_Print_Text_Proc(fileName)
                                
                                    Sendbuf = Text_Create_Proc()
                                    
                                
                                    Inspe_Proc_DEN = False
                                    Exit Function
                                End If
                            
                            End If
''' 荷札処置
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
                    
                    
                    
                        Case True
                            '残なし　口数へ
                    
                    
''' 荷札処置
                                PRINT_OFF = False
            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
                                    PRINT_OFF = True
                                Else
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
                                    
                                        If KONPOU_ON = KONPOU_ON_SUMI Then
                
                                            PRINT_OFF = True
                
                                        End If
                
                                    End If
                                End If
                                
                                If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                    ID_KANRI_TBL(ING_No).LABEL_ON = False
                                Else
                                    
            '                        Y_SYU_CNT = 0
            '                        SYUKA_QTY = 0
                                    
                                    PRINT_OFF = False
                                    
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
                                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                            
                                                        '枝番更新   2010.02.15
                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                    Start_Page_No = 1
                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                    
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                        
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                                    
                                                        PRINT_OFF = True
                                        
                                                    End If
                                                
                                                Else
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                        
                                    
                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                
                                                                GoTo Abort_Tran
                                                            
                                                            End If
                                                    
                                                        
                                                        End If
                                                                            
                                                    End If
                                                End If
                                            Next j
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                        Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                        '2010.06.16
                                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                        Select Case sts
                                            Case BtNoErr
                                            
                                                If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                                
                                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                                
                                                End If
                                            
                                            Case BtErrKeyNotFound
                                            
                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                            
                                            Case Else
                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                                Sendbuf = Text_Create_Proc()
                                                GoTo Abort_Tran
                                        End Select
                                        
                                        PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                                                
                                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
                                                                
                                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                        
                                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
                                            PRINT_MAISU = PRINT_MAISU - 1
                                            
                                            
                                            
                                            If PRINT_MAISU < 1 Then
                                                
                                                        '枝番更新   2010.02.15
                                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    
                                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                            
                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                
                                                                GoTo Abort_Tran
                                                            End If
                                        
                                                        End If
                                                    
                                                    
                                                    
                                                    Else
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                            
                                        
                                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                    
                                                                    GoTo Abort_Tran
                                                                End If
                                                            
                                                            
                                                        
                                                            End If
                                                                                
                                                        End If
                                                    
                                                    
                                                    
                                                    End If
                                                Next j
                                                        '枝番更新   2010.02.15
                                                
                                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                                
                                                PRINT_OFF = True
                                            Else
            '                                    PRINT_MAISU = PRINT_MAISU - 1
                                                Start_Page_No = Start_Page_No + 1
                                            End If
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                        
                                        Y_SYU_CNT = 0
                                        SYUKA_QTY = 0
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                        
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                
                                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                                
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                                        PRINT_OFF = True
                                                    Else
                                                
                                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                                                    
                                                    End If
                                                
                                                End If
                                            End If
                                        Next j
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                        
                                        
                                        If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                        End If
                                        
                                        
                                        
                                        
                                        
                                                        '枝番更新   2010.02.15
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                    
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                            
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                                        
                                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And Start_Page_No = 2 Then
                                                    
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                    Else
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                    End If
                                                
                                                End If
                                            
                                            
                                            
                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                    
                                
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                    
                                                    End If
                                                                        
                                                End If
                
                                            
                                            
                                            
                                            
                                            End If
                                        Next j
                                                        '枝番更新   2010.02.15
                                        
                                        
                                        
                                        
                                        If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                        Else
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                        End If
                                        
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                        GoTo Abort_Tran
'                                                    End If
'                                                End If
'                                            End If
'                                        Next j
                                        
                                        'データ送信
                                                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 2
                                                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                                    
                                        '-----------------------------------------------ヘッダー
                                
                                        Call Wel_Head_Print_Text_Proc(fileName)
                                    
                                        Sendbuf = Text_Create_Proc()
                                        
                                    
                                        Inspe_Proc_DEN = False
                                        Exit Function
                                    
                                    End If
                                End If
            ''' 荷札処置
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------aaa------------------------------------４行目
                                
'口数INPUT １
                                
                                wkKONPO_F = ""
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                    
                                        wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                        Exit For
                                    End If
                                Next j
                                
                                If wkKONPO_F = "1" Then
                                                        
                                    If Inspection_Input Then
                                        KUTI_SU_INPUT_F = False
                                    Else
                                        KUTI_SU_INPUT_F = True
                                    End If
                                
                                
                                    TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                    TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                            
                                Else
                                    TOTAL_KUTI_SU = 1
                                    KUTI_SU_INPUT_F = True
                                    TOTAL_SAI_SU = 0#
                                End If
                                            
                                            
                                            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                            
                                            
                                If KUTI_SU_INPUT_F Then
                                
                                    Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                
                                
                                Else
                                    Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                
                                    
                                    If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                    
                                    
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                                
                                
                                
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                        
                        End Select
                        
                
                
                Case "2"
                    '集合梱包のみ
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                    
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
                    
                    
                    
                        Case True
                            '残なし　口数へ
                    
                    
''' 荷札処置
                                PRINT_OFF = False
            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
                                    PRINT_OFF = True
                                Else
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
                                    
                                        If KONPOU_ON = KONPOU_ON_SUMI Then
                
                                            PRINT_OFF = True
                
                                        End If
                
                                    End If
                                End If
                                
                                If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                    ID_KANRI_TBL(ING_No).LABEL_ON = False
                                Else
                                    
            '                        Y_SYU_CNT = 0
            '                        SYUKA_QTY = 0
                                    
                                    PRINT_OFF = False
                                    
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
                                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                            
                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                    
                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                    
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                                        Start_Page_No = 1
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        PRINT_OFF = True
                                                    End If
                                                
                                                
                                                Else
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                        
                                    
                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                
                                                                GoTo Abort_Tran
                                                            
                                                            End If
                                                        
                                                        
                                                        
                                                        End If
                                                                            
                                                    End If
                                                
                                                
                                                
                                                
                                                
                                                End If
                                            Next j
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                        Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                        '2010.06.16
                                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                        '2010.06.16
                                        Select Case sts
                                            Case BtNoErr
                                            
                                                If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                                
                                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                                
                                                End If
                                            
                                            Case BtErrKeyNotFound
                                            
                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                            
                                            Case Else
                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                                Sendbuf = Text_Create_Proc()
                                                GoTo Abort_Tran
                                        End Select
                                        
                                        PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                                                
                                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
                                                                
                                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                        
                                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
                                            PRINT_MAISU = PRINT_MAISU - 1
                                            If PRINT_MAISU < 1 Then
                                                
                                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    
                                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                        
                                                        '枝番更新   2010.02.15
                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                
                                                                GoTo Abort_Tran
                                                            
                                                            End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                        
                                        
                                        
                                                        End If
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    Else
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                            
                                        
                                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                    
                                                                    GoTo Abort_Tran
                                                                End If
                                                                
                                                        
                                                            
                                                            End If
                                                                                
                                                        End If
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    End If
                                                Next j
                                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                                PRINT_OFF = True
                                            Else
            '                                    PRINT_MAISU = PRINT_MAISU - 1
                                                Start_Page_No = Start_Page_No + 1
                                            End If
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                        
                                        Y_SYU_CNT = 0
                                        SYUKA_QTY = 0
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                        
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                
                                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                                
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                                        PRINT_OFF = True
                                                    Else
                                                
                                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                                                    
                                                    End If
                                                
                                                End If
                                            End If
                                        Next j
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                        
                                        If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                        End If
                                        
                                        
                                        
                                        
                                        
                                        '枝番更新   2010.02.15
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                    
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                            
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                        
                                                        GoTo Abort_Tran
                                                    End If
                                                End If
                                            
                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                    
                                
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                    
                                                    
                                                    End If
                                                                        
                                                End If
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            End If
                                        Next j
                                        '枝番更新   2010.02.15
                                        
                                        
                                        
                                        
                                        
                                        If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                        Else
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                        End If
                                        
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                        GoTo Abort_Tran
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
                                        
                                        'データ送信
                                                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 2
                                                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                                    
                                        '-----------------------------------------------ヘッダー
                                
                                        Call Wel_Head_Print_Text_Proc(fileName)
                                    
                                        Sendbuf = Text_Create_Proc()
                                        
                                    
                                        Inspe_Proc_DEN = False
                                        Exit Function
                                    
                                    End If
                                End If
            ''' 荷札処置
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------aaa------------------------------------４行目
                                
'口数INPUT ２
                                wkKONPO_F = ""
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                    
                                        wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                        Exit For
                                    End If
                                Next j
                                
                                If wkKONPO_F = "1" Then
                                                        
                                    If Inspection_Input Then
                                        KUTI_SU_INPUT_F = False
                                    Else
                                        KUTI_SU_INPUT_F = True
                                    End If
                                
                                
                                    TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                    TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                            
                                Else
                                    TOTAL_KUTI_SU = 1
                                    KUTI_SU_INPUT_F = True
                                    TOTAL_SAI_SU = 0#
                                End If
                                            
                                            
                                            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                            
                                            
                                If KUTI_SU_INPUT_F Then
                                
                                    Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                
                                
                                Else
                                    Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                
                                    If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                
                                
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                                
                                
                                
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                        
                        End Select
                    
                Case "3"
                    '混在
            
                    
                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
            
            
                    Select Case (KONPOU_ON - KONPOU_ON_SUMI)
            
                        Case 0
                            '口数へ
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------aaa------------------------------------４行目
'口数input ３
                            wkKONPO_F = ""
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                
                                    wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                    Exit For
                                End If
                            Next j
                            
                            If wkKONPO_F = "1" Then
                                                    
                                If Inspection_Input Then
                                    KUTI_SU_INPUT_F = False
                                Else
                                    KUTI_SU_INPUT_F = True
                                End If
                            
                            
                                TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                        
                            Else
                                TOTAL_KUTI_SU = 1
                                KUTI_SU_INPUT_F = True
                                TOTAL_SAI_SU = 0#
                            End If
                                        
                                        
                                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                            End If
                                        
                                        
                            If KUTI_SU_INPUT_F Then
                            
                                Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                            
                            
                            Else
                                Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                            
                                
                                
                                
                                
                                If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                            
                            
                            
                            End If
                        
                        
                            Sendbuf = Text_Create_Proc()
                        
                        
                        
                        
                        
                        Case Else
                            '品番へ
            
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                                        
                                                                                        '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    End Select
            
            End Select
                    
                    
                    
                    
        Case Step_Sagyo5_RES        '５回目の受信（口数）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Left(Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)), 6)
                    '口数
                    Case LCD_KUTI_SU_S
                
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU < 0 Then
                        
                
                
                
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN = False
                                Exit Function
                            
                            End If
                    
                            KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If KUTI_SU < 1 Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN = False
                                Exit Function
                            End If
                        Else
                            KUTI_SU = ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU
                        End If
                    
                    
                    
                    '才数
                    Case LCD_SAI_SU_S
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU < 0 Then
                        
                        
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN = False
                                Exit Function
                            
                            End If
                    
                            SAI_SU = CDbl(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If SAI_SU <= 0 Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN = False
                                Exit Function
                            End If
                        Else
                            SAI_SU = ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU
                        
                        
                            If SAI_SU < 1 Then
                                SAI_SU = 1
                            Else
                                If SAI_SU > 1 Then
                                    SAI_SU = CLng(ToHalfAdjust(CCur(SAI_SU), 0))
                                End If
                            End If
                        
                        End If
                    
                        '送り状最大印刷枚数獲得 2010.01.21
                            
                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                
                                    If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                
                                
                                Else
                                
                                    If Label_Print_Total_Su_Proc(0, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                End If
                            End If
                        Next j
                                        
                            
                            
                            
                        
'                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
'
'                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            Exit Function
'                        End If
                    
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                            Else
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU <= 1 Then
                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                    End If
                                
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                                
                                End If
                            End If
                        Next j
                        
                        
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        Inspe_Proc_DEN = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                
                                
                                
                                
                                
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                    'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                    If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                        If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                        End If
                                    Else
'''''''                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                        
                                        
                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                                                            
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                    
                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN_SAV, Format(SAI_SU, "00.00"))
                                                    
                                                    
                                Else
                                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                        
                                        'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                        If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                            If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                            Else
                                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                            End If
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                                                                
                                        End If
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                
                                
                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN_SAV, Format(SAI_SU, "00.00"))
                                
                                
                                
                                End If
                                                    
                                
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_DEN = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                

'                        Call Syuka_KUTI_SU_Count_Proc(TOTAL_KUTI_SU)

        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                   
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                
                                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                    'ID№
                                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
                
                                Do
                                
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                            
                                Loop
                                
                                
                                
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                                
                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_DEN = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                

''' 品番単位での丸め処理
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
''' 品番単位での丸め処理

                            
'                        PRINT_OFF = False
'
'                        If KONPOU_OFF = KONPOU_OFF_SUMI Then
'
'                            PRINT_OFF = True
'
'                        End If

                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 0 Then
                            ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                        End If


                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
                            If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                PRINT_OFF = True
                            End If
                        End If



                        PRINT_MAISU = KUTI_SU
                                                
                                                
                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1

                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU


                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
                            PRINT_MAISU = PRINT_MAISU - 1
                            If PRINT_MAISU < 1 Then
                                
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    
                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        
                                                        '枝番更新   2010.02.15
                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                
                                                GoTo Abort_Tran
                                            End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                        
                                        End If
                                    Else
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                            
                        
                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                    
                                                    
                                                    GoTo Abort_Tran
                                                
                                                End If
                                            
                                            
                                            End If
                                                                
                                        End If
                                    End If
                                Next j
                                
                                
                                
                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                
                                
                                
                                
                                PRINT_OFF = True
                            Else
'                                PRINT_MAISU = PRINT_MAISU - 1
                                Start_Page_No = Start_Page_No + 1
                            
                            End If
                        End If

''' 荷札処置
                        If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                            ID_KANRI_TBL(ING_No).LABEL_ON = False
                        Else
                                
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            
                            PRINT_OFF = False
                            
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                    
                                    
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                        
                                            PRINT_OFF = True
                                        Else
                                    
                                        End If
                                    End If
                                End If
                            Next j
                                
                            If Not PRINT_OFF Then
                                
                                If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                End If
                            
                            
                            
                            
                                '枝番更新   2010.02.15
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
                                                    
                                                    GoTo Abort_Tran
                                                
                                                
                                                End If
                        
                                            Else
                        
                        
                                                        '枝番更新   2010.02.15
                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                    
                                                    GoTo Abort_Tran
                                                
                                                
                                                End If
                                                        
                                            End If
                                                        
                                                        '枝番更新   2010.02.15
                        
                        
                        
                        
                        
                                        End If
                                    Else
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                            
                        
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU - 1, "000")) Then
                                                        
                                                        GoTo Abort_Tran
                                                    End If
                                                Else
                                                
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                        
                                                        GoTo Abort_Tran
                                                    End If
                                                
                                                                        
                                                
                                                End If
                                            End If
                                        End If
                                    End If
                                Next j
                                '枝番更新   2010.02.15
                            
                            
                            
'                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU
                                
                                If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                Else
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                End If
                                
'                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'
'                                            If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                GoTo Abort_Tran
'                                            End If
'
'                                        End If
'                                    End If
'                                Next j
                            
                                ID_KANRI_TBL(ING_No).LABEL_STEP = 9
                                
                                'データ送信
                                                            
                                ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                            
                                ID_KANRI_TBL(ING_No).LABEL_ON = True
                            
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Print_Text_Proc(fileName)
                                '-----------------------------------------------ボディ
                                Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
                            
                                Sendbuf = Text_Create_Proc()
                            
                                Inspe_Proc_DEN = False
                                Exit Function
                            
                            End If

''' 荷札処置
                        End If

                        KENPIN_END = True
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                            
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                    KENPIN_END = False
                                    Exit For
                                End If
                            End If
                        Next j



                        Select Case KENPIN_END
                    
                            Case True
    
                            '次の作業要求

                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                                            
                                            
                                            
                                            
                                            
                    
                    
                            Case Else
                    
    ''''''''''''''''''''''''''''''''''''''''''''''
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                
                                '-----------------------------------------------３行目
                                Call Wel_HIN_NO_Req_Text_3_Proc
                                '-----------------------------------------------４行目
                                Call Wel_HIN_NO_Req_Text_4_Proc
                                
                                '-----------------------------------------------３行目
'                                                                                        'BOX属性
'                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                                                                                        '表示内容
'
'                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'
'
'                                                                                        '数値初期表示
'                                Send_Text.Box_Type(2).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'                                                                                        '初期カーソル位置
'                                Send_Text.Box_Type(2).Start_Pos = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'                                                                                        '入力桁数
'                                Send_Text.Box_Type(2).Max_Size = "00"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'
'                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
'                                '-----------------------------------------------４行目
'                                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                                                                                        '表示内容
'                                                                                    '表示内容
'                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                                                                                        '数値初期表示
'                                Send_Text.Box_Type(3).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
'                                                                                        '初期カーソル位置
'                                Send_Text.Box_Type(3).Start_Pos = "01"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
'                                                                                        '入力桁数
'                                Send_Text.Box_Type(3).Max_Size = "13"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
'
'                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                    
                        End Select
                    
                    End Select
                
            Next i
        

        Case Step_PRINT_RES        '印刷終了
    
    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    
            '-----------------------------------------------ヘッダー
            Call Wel_Head_Text_Proc
    
            Select Case ID_KANRI_TBL(ING_No).LABEL_STEP
                Case 1      '品番へ
                                                                            
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                                                            
                    '-----------------------------------------------ヘッダー 02.24
                    Call Wel_Head_Text_Proc
                                                                            
                    '-----------------------------------------------１行目
                    Call Wel_DETAIL_0_Text_Proc
                    '-----------------------------------------------２行目
                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                    
                    
                    
                    
                    '-----------------------------------------------３行目
                    Call Wel_HIN_NO_Req_Text_3_Proc
                    '-----------------------------------------------４行目
                    Call Wel_HIN_NO_Req_Text_4_Proc
                    
                    
                    '-----------------------------------------------３行目
                                                                            'BOX属性
'                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                                                                            '表示内容
'
'                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'
'
'                                                                            '数値初期表示
'                    Send_Text.Box_Type(2).INIT = ""
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'                                                                            '初期カーソル位置
'                    Send_Text.Box_Type(2).Start_Pos = ""
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'                                                                            '入力桁数
'                    Send_Text.Box_Type(2).Max_Size = "00"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'
'                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
'                    '-----------------------------------------------４行目
'                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                                                                            '表示内容
'                                                                        '表示内容
'                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                                                                            '数値初期表示
'                    Send_Text.Box_Type(3).INIT = ""
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
'                                                                            '初期カーソル位置
'                    Send_Text.Box_Type(3).Start_Pos = "01"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
'                                                                            '入力桁数
'                    Send_Text.Box_Type(3).Max_Size = "13"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
'
'                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                    Call Wel_Clear_Text_Proc

                    Sendbuf = Text_Create_Proc()
                
                Case 2      '口数へ
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    '-----------------------------------------------ヘッダー
                    Call Wel_Head_Text_Proc
                    
                    '-----------------------------------------------１行目
                    Call Wel_DETAIL_0_Text_Proc
                    '-----------------------------------------------２行目
                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                    
                    '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    
                    
                    '-----------------------------------------------４行目
'口数　４
                    wkKONPO_F = ""
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                    
                        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                        
                            wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                            Exit For
                        End If
                    Next j
                    
                    If wkKONPO_F = "1" Then
                                            
                        If Inspection_Input Then
                            KUTI_SU_INPUT_F = False
                        Else
                            KUTI_SU_INPUT_F = True
                        End If
                    
                    
                        TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                        TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                
                    Else
                        TOTAL_KUTI_SU = 1
                        KUTI_SU_INPUT_F = True
                        TOTAL_SAI_SU = 0#
                    End If
                                
                                
                                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                    End If
                                
                                
                    If KUTI_SU_INPUT_F Then
                    
                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                    
                    
                    Else
                        Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                    
                    
                    
                        If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                    
                    
                    
                    
                    
                    
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                    
                    
                    
                    End If
                    
                    Sendbuf = Text_Create_Proc()
                
                Case 9
        
                    Select Case (Y_SYU_CNT - Sumi_CNT)
                
                        Case 0
                
                            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                            Select Case sts
                                Case BtNoErr
                                '   -------------------------------- エラーメッセージ作成
                                Case Else
                                '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                            End Select
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                            
                            Sendbuf = Text_Create_Proc()
            
            
                        Case Else
                        
        ''''''''''''''''''''''''''''''''''''''''''''''
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                            Call Wel_HIN_NO_Req_Text_3_Proc
                            '-----------------------------------------------４行目
                            Call Wel_HIN_NO_Req_Text_4_Proc
                            '-----------------------------------------------５行目
                            Call Wel_Clear_Text_Proc
        
                            Sendbuf = Text_Create_Proc()
        
            
                End Select
            End Select
    
    End Select
                    
                    

    Inspe_Proc_DEN = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function



Private Function Inspe_Proc_LOGISTIC_ALL(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（宅配伝票読み込み 大阪ＰＣ向け）』
'       'ロジステックス対応
'       2010.02.25
'
'       全数検品対応    2012.03.21
'
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07


Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Long

Dim SAI_SU          As Double

Dim UNSOU_KAISHA    As String
 
Dim SYUKA_YMD       As String
Dim JYUSHO          As String
Dim BIKOU           As String

Dim SURYO           As String

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag

Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean

'2010.01.21
Dim KONPOU_ON           As Integer


Dim KONPOU_ON_SUMI      As Integer
Dim KONPOU_OFF          As Integer
Dim KONPOU_OFF_SUMI     As Integer
Dim PRINT_OFF           As Boolean
Dim Start_Page_No       As Long
Dim PRINT_TOTAL_SU      As Long
Dim PRINT_MAISU         As Long
Dim fileName            As String
Dim ID_SEQ              As Integer
Dim DISP_SAI_SU         As Double

Dim wkKUTI_SU           As String
Dim wkKONPO_F           As String * 1

Dim TOTAL_KUTI_SU       As Integer
Dim TOTAL_SAI_SU        As Double
Dim MUKE_NAME           As String
Dim OKURI_NO_MAX        As Integer
Dim KUTI_SU_INPUT_F     As Boolean

Dim KEN_TEL_NO          As String * 20

Dim LOGIXTICS_F         As Boolean

Dim OKURI_NO_F          As Boolean
'2010.01.21
Dim FUKUYAMA_CHK_F      As Boolean

Dim Cnt_F               As Boolean  '2012.03.31
Dim Print_bara_F        As Boolean  '2012.03.31

Dim Hin_Total           As Long     '2012.04.07

Dim KEN_HINBAN          As String * 20      '2012.10.02

    Inspe_Proc_LOGISTIC_ALL = True

    LOGIXTICS_F = True
    
    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                                        
                        '2012.10.02　KEN_HINBAN追加
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, _
                                                SYUKA_YMD, _
                                                JYUSHO, _
                                                BIKOU, _
                                                Start_Page_No, _
                                                KUTI_SU, _
                                                MUKE_NAME, _
                                                OKURI_NO_MAX, , , _
                                                KEN_TEL_NO, _
                                                KEN_HINBAN)
                        
                        '他端末で使用中 2011.04.07
                        If sts = SYS_CANCEL Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                        '他端末で使用中 2011.04.07
                        
                        
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            Next j
                                                     
                            If CANCEL_F Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        End If
                        
                        
                        If Y_SYU_CNT = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                                                 
                        If Sumi_CNT = Y_SYU_CNT And Start_Page_No <> 0 Then
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品処理済！", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        
                        End If
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = Y_SYU_TBL(j).KONPOU_F        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_CND = Y_SYU_TBL(j).KONPOU_CND    '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).TOTAL_SU = Y_SYU_TBL(j).TOTAL_SU        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = Y_SYU_TBL(j).SAI_SU            '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = Y_SYU_TBL(j).KUTI_SU          '2010.01.21
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = Y_SYU_TBL(j).PRINT_SUMI    '2010.01.21
                        
                                                                                                        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ = Y_SYU_TBL(j).OKURI_NO_SEQ
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = Y_SYU_TBL(j).CNT_BARA_SU      '検品実績　バラ
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = Y_SYU_TBL(j).CNT_HAKO_SU      '検品実績　箱
                            
                
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = Y_SYU_TBL(j).Y_HIN_CHK_CNT  '品番読込み回数
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = Y_SYU_TBL(j).J_HIN_CHK_CNT  '品番読込み済み回数

'2012.11.15                            ID_KANRI_TBL(ING_No).KEN_HINBAN = KEN_HINBAN
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                        
                        Next j
                        
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        '出荷日
                        ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = SYUKA_YMD
                        '住所
                        ID_KANRI_TBL(ING_No).KEN_JYUSHO = JYUSHO
                        
                        '備考
                        ID_KANRI_TBL(ING_No).KEN_BIKOU = BIKOU
                        '向け先
                        ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = MUKE_NAME
                        
                        '枝番
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO_MAX = OKURI_NO_MAX
                        '電話番号
                        ID_KANRI_TBL(ING_No).KEN_TEL_NO = KEN_TEL_NO
                        
                         '検品ﾊﾟﾀｰﾝ  2012.03.31
                        ID_KANRI_TBL(ING_No).KEN_TYPE = ""
            
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                '2012.11.15
                        ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = KEN_HINBAN    '2012.11.15
                        
                        'ﾗﾍﾞﾙ開始ページ№
                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                        
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                        
                    
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        
                        
                        
                        End If
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                        
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                        If KONPOU_ON <> 0 Then
                            If KONPOU_ON = KONPOU_ON_SUMI Then
                                                    
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                                    
                            End If
                        End If
                                   
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                
                
                
                        Else
                
                
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                                                                                    'BOX属性
                                                                                    
                                                                                    
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                            
                            KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI   '2011.03.17
        
    ''' 品番単位での丸め処理
                            Select Case KONPOU_ON    '2011.03.17
                            
                            
''''''''''2011.03.17Select Case (KONPOU_ON - KONPOU_ON_SUMI)
                                Case 0
                                '集合梱包なし
                                
                                    
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                        If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                            '-----------------------------------------------ヘッダー
                                            Call Wel_Head_Text_Proc
                                            '-----------------------------------------------１行目
                                            Call Wel_DETAIL_0_Text_Proc
                                            '-----------------------------------------------２行目
                                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                            '-----------------------------------------------３行目
'2012.11.15                                                                                                    'BOX属性
'2012.11.15                                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                                    '表示内容
'2012.11.15
'2012.11.15                                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                                    '数値初期表示
'2012.11.15                                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                                    '初期カーソル位置
'2012.11.15                                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                                    '入力桁数
'2012.11.15                                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        
                                            '2012.11.15
                                            Call Wel_OKURI_SAKI_PROC
                                        
                                        
                                            TOTAL_KUTI_SU = 1
                                            KUTI_SU_INPUT_F = True
                                            TOTAL_SAI_SU = 0#
                                                
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                            End If
                                    
                                            Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                            ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                            ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                            ID_KANRI_TBL(ING_No).KEN_TYPE = "1"         '2012.03.31
                                    
                                            Sendbuf = Text_Create_Proc()
                                        
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            Exit Function
                                        End If
                                    End If
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    
                                    
                                    
                                    '-----------------------------------------------ボディ
                                    Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
            
                                    Sendbuf = Text_Create_Proc()
                                Case Else
                                '集合梱包あり
                            
                                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                                    '-----------------------------------------------２行目
                                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                    '-----------------------------------------------３行目
'2012.11.15                                                                                            'BOX属性
'2012.11.15                                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                            '表示内容
'2012.11.15
'2012.11.15                                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                            '数値初期表示
'2012.11.15                                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                            '初期カーソル位置
'2012.11.15                                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                            '入力桁数
'2012.11.15                                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    '2012.11.15
                                    Call Wel_OKURI_SAKI_PROC
                                    '-----------------------------------------------４行目
                                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                            '表示内容
                                                                                        '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = "01"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                            '入力桁数
                                    '2010.12.07
'                                    Send_Text.Box_Type(3).Max_Size = "13"
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                    Send_Text.Box_Type(3).Max_Size = "13"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                    '2010.12.07
                                                                                            
                                                                                            
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------５行目
                                    Call Wel_Clear_Text_Proc
            
                                    Sendbuf = Text_Create_Proc()
                            
                            End Select
                        End If
                        
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状№）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状№
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else
                        
                            If Not IsNumeric(OKURI_NO) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            If Not OKURI_NO_F Then
                        
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                                                
                            End If
                        
                        
                            '2090.04.28
                            If FUKUYAMA_CHK_F Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            
                            End If
                            '2090.04.28
                        
                        End If
                    
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "ロジスティクス")
                                            
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                                            
'                                End If
                                
                                
                                
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
                                                                                'BOX属性
                                                                                
                                                                                
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI '2011.03.17
    
                        ''' 品番単位での丸め処理
                        Select Case KONPOU_ON  '2011.03.17
'''''''''''''''''Select Case (KONPOU_ON - KONPOU_ON_SUMI)    '2011.03.17
                            Case 0
                            '集合梱包なし
                            
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                
                                If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                        
                                        
                                        
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                            
                                            '-----------------------------------------------ヘッダー
                                        Call Wel_Head_Text_Proc
                                            '-----------------------------------------------１行目
                                        Call Wel_DETAIL_0_Text_Proc
                                            '-----------------------------------------------２行目
                                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                        '-----------------------------------------------３行目
'2012.11.15                                                                                                    'BOX属性
'2012.11.15                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                                    '表示内容
'2012.11.15
'2012.11.15                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                                    '数値初期表示
'2012.11.15                                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                                    '初期カーソル位置
'2012.11.15                                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                                    '入力桁数
'2012.11.15                                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        '2012.11.15
                                        Call Wel_OKURI_SAKI_PROC
                                        
                                        TOTAL_KUTI_SU = 1
                                        KUTI_SU_INPUT_F = True
                                        TOTAL_SAI_SU = 0#
                                                
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                        End If
                                    
                                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                        ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
    
                                    
                                    
                                        Sendbuf = Text_Create_Proc()
                                        
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        Exit Function
                                        
                                        
                                    End If
                                End If
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                            '-----------------------------------------------ボディ
                                Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
            
                                Sendbuf = Text_Create_Proc()
                            Case Else
                            '集合梱包あり
                        
                                '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                                Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                                    '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                    '-----------------------------------------------３行目
'2012.11.15                                                                                        'BOX属性
'2012.11.15                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                        '表示内容
'2012.11.15
'2012.11.15                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                                Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                                Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                                Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '2012.11.15
                                Call Wel_OKURI_SAKI_PROC
                                '-----------------------------------------------４行目
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                        '表示内容
                                                                                    '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                        '入力桁数
                                '2010.12.07
'                               Send_Text.Box_Type(3).Max_Size = "13"
'                               ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                Send_Text.Box_Type(3).Max_Size = "20"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                '2010.12.07
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                        
                            End Select
                        End Select
                    Next i
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            For i = 0 To M_Gyo - 1
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban, "出荷"   '品番/出荷数（品番）
                        If Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = "出荷" Then
                            Cnt_F = True
                        Else
                            ID_KANRI_TBL(ING_No).LAST_START_PAGE = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1 '2012.04.01
                        End If
                        
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                '集合梱包有り時の品番チェック
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                        
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND <> "1" Then
                        
                            If KONPOU_ON <> KONPOU_ON_SUMI Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
                            
                            
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    Exit Function
                            
                                End If
                            End If
                        
                        End If
                        'ｷｬﾝｾﾙのﾁｪｯｸ
                        CANCEL_F = True
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            End If
                        Next j
                        
                        If CANCEL_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "キャンセル品番です。", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        
                        
                        End If
                        
                        
                        
                                
                        '検品済みのﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "検品済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                
                        '未出庫のﾁｪｯｸ   2007.05.14
                        If Inspection_Flg = 0 Then
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KAN_KBN <> KAN_KBN_FIN Then
                                        Exit For
                                    End If
                                End If
                            Next k
                                            
                            If k <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        End If
                        '未出庫のﾁｪｯｸ   2007.05.14
                        
                        '仕掛中品番のﾁｪｯｸ   2012.10.02-->2012.11.15 KEN_HINBAN-->KEN_ING_HINBAN
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) Then
                            If Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) <> "" Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "他品番検品中！", ID_KANRI_TBL(ING_No).KEN_ING_HINBAN)
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        End If
                        '仕掛中品番のﾁｪｯｸ   2012.10.02
                        
                        
                        If Cnt_F Then
                        
                            If RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) <> RTrim(Hinban) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        End If
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                
                        Print_bara_F = False
                
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1
                            End If
                        
                            
                            '2012.04.07
                            Hin_Total = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If ID_KANRI_TBL(ING_No).KEN_HINBAN = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then                '2012.09.05
                                    
                                        Hin_Total = Hin_Total + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If                                                                  '2012.09.05
                                End If
                            Next k
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)) + _
                            '                                                            (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO - _
                            '                                                            ((CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY)
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)) + _
                                                                                        (Hin_Total - _
                                                                                        ((CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY)
                            '2012.04.07
                            
                            
                            Print_bara_F = False
                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1 Then
                                'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO   2012.04.09
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = Hin_Total                                    '2012.04.09
                                Print_bara_F = True
                            Else
                                'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = CLng(ToRoundUp(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO Mod ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0))
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = CLng(ToRoundUp(CCur(Hin_Total Mod ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0))    '2012.04.09
                            End If
                            
                            
                            
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            '
                            'If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 1
                            'Else
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            'End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                            
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                        
                        End If
                        
                        If Cnt_F Then
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                                Print_bara_F = True
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                        
                        
                        End If

'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02
                        '----------------------------------- トランザクション開始 -----------
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If


                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
'2012.10.02                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
'2012.10.02
'2012.10.02                                '------------------------------------   出荷予定の処理
'2012.10.02                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
'2012.10.02
'2012.10.02
'2012.10.02                                Do
'2012.10.02
'2012.10.02                                    sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.10.02                                    Select Case sts
'2012.10.02                                        Case BtNoErr
'2012.10.02                                            Exit Do
'2012.10.02                                        Case BtErrKeyNotFound
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_LOGISTIC_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_LOGISTIC_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                        Case Else
'2012.10.02                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
'2012.10.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                    End Select
'2012.10.02
'2012.10.02                                Loop
'2012.10.02
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
'2012.10.02
'2012.10.02
'2012.10.02
'2012.10.02                                Do
'2012.10.02
'2012.10.02                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.10.02                                    Select Case sts
'2012.10.02                                        Case BtNoErr
'2012.10.02                                            Exit Do
'2012.10.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_LOGISTIC_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                        Case Else
'2012.10.02                                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
'2012.10.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                    End Select
'2012.10.02
'2012.10.02                                Loop
'2012.10.02
'2012.10.02
'2012.10.02
'2012.10.02                            End If
                            '------------------------------------   出荷予定の処理  2012.10.02
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
                
                
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
    

                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
    
                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))

                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
                            End If
                        
                            Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, ID_KANRI_TBL(ING_No).KEN_HINBAN)

                        
                            Do
                            
                                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                        
                        '------------------------------------   出荷予定の処理  2012.10.02
                        Next k
                        
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            Exit Function
                        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 荷札発行処理    2012.03.30
                        PRINT_OFF = False
    
    
                            
    
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
                            PRINT_OFF = True
                        Else
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
                            
''                                If KONPOU_ON = KONPOU_ON_SUMI Then
        
                                    PRINT_OFF = True

''                                End If
        
                            End If
                        End If

'                        PRINT_OFF = False

                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                            Not LOGIXTICS_F Then
                            If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                PRINT_OFF = True
                            End If
                        End If


                        '2012.09.05
                        If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
                                PRINT_OFF = True
                        End If
                        '2012.09.05


                        If Not PRINT_OFF Then


                            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                            Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
                            '2010.06.16
                            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            Select Case sts
                                Case BtNoErr
                                    If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then

                                        Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                    End If

                                Case BtErrKeyNotFound

                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                Case Else
                                    Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select


                            If Print_bara_F Then
                                PRINT_MAISU = Val(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                            Else
                                PRINT_MAISU = Val(StrConv(ITEMREC.KUTI_SU, vbUnicode)) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If



                            Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
    
                            PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
    
                            ID_KANRI_TBL(ING_No).LABEL_STEP = 1

                            'Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then

                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then

                                        'Y_SYU_CNT = Y_SYU_CNT + 1
                                       SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO

                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).PRINT_SUMI Then
                                            PRINT_OFF = True
                                        Else

'2012.03.                                           ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).PRINT_SUMI = True

                                        End If

                                    End If
                                End If
                            Next k
                        End If

                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                               Not LOGIXTICS_F) Then
                            PRINT_MAISU = PRINT_MAISU - 1
                            If PRINT_MAISU < 1 Then

                            '枝番更新   2010.02.15
                                For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                    If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then

                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then

'2012.04.01                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                GoTo Abort_Tran
'2012.04.01
'2012.04.01                                            End If


                                        End If
                                    Else
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KONPOU_F <> "1" Then


'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                End If



                                            End If

                                        End If
                                    End If
                                Next k
                                '枝番更新   2010.02.15

                                PRINT_OFF = True

                                ID_KANRI_TBL(ING_No).LABEL_ON = True

                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No

                            Else
'                                            PRINT_MAISU = PRINT_MAISU - 1
                                Start_Page_No = Start_Page_No + 1
                            End If
                        End If

                        If Not PRINT_OFF Then

                            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                            Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)

                            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            Select Case sts
                                Case BtNoErr

                                    If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then


                                        Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                    End If

                                Case BtErrKeyNotFound


                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                Case Else
                                    Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select


'2010.02.21                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))

'2010.02.21                                    Start_Page_No = Start_Page_No + 1

'2010.02.21                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                            ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01

                            If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                            End If



                            '枝番更新   2010.02.15
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then

                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then

                                        If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And _
                                            (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                              Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                               Not LOGIXTICS_F) Then

'2012.04.01                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'2012.04.01
'2012.04.01                                                GoTo Abort_Tran
'2012.04.01                                            End If


                                        Else


'2012.04.01                                            If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                GoTo Abort_Tran
'2012.04.01                                            End If

                                        End If
                                    End If
                                Else
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KONPOU_F <> "1" Then

'2012.04.01                                            If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                GoTo Abort_Tran
'2012.04.01
'2012.04.01                                            End If



                                        End If



                                    End If
                                End If
                            Next k
                                    '枝番更新   2010.02.15




'2010.02.21                                    If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
'                                    Else
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
'                                    End If

'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                    GoTo Abort_Tran
'                                                End If
'
'                                            End If
'                                        End If
'                                    Next j

                                    'データ送信

                            ID_KANRI_TBL(ING_No).LABEL_STEP = 1


                            ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ

                            ID_KANRI_TBL(ING_No).LABEL_ON = True

                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU - 1
                            '-----------------------------------------------ヘッダー

                            Call Wel_Head_Print_Text_Proc(fileName)

                            Sendbuf = Text_Create_Proc()


                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If

''' 荷札処置
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 荷札発行処理    2012.03.30
                
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT Then


                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True

                
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc

    ''' 品番単位での丸め処理
                        
                             '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                                                                                'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"

                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                            If Inspection_QTY = 1 Then

                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            Else
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                            End If
                            
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                                    If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                
                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                
                                                Y_SYU_CNT = Y_SYU_CNT + 1
                                                SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                        End If
                                    End If
                            Next k
                                                                                '表示内容
                        
                        If Y_SYU_CNT < 2 Then

'                            If Inspection_QTY = 1 Then

                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
'                            Else
'                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
'                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
'                            End If
                                                                                
                        Else
                        
'                            If Inspection_QTY = 1 Then
                                
                                
                                'Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")                          '2012.04.10
                                'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")     '2012.04.10
                                                                                                                                                                    '2012.04.10
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                                                                                                                                                    '2012.04.10
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                            Else
'                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                            End If
                        
                        End If
                                                                                
                                                                                '数値初期表示
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                        Else
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                        End If
                                                                                '初期カーソル位置
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                        Else
                            Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                        End If
                                                                                
                                                                                '入力桁数
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Else
                            Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                        End If
                                                                                
                                                                                
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                        Else                                            '2012.11.15
                            ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""    '2012.11.15
                        End If
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                
                        Inspe_Proc_LOGISTIC_ALL = False
                        Exit Function
                
                
                Else
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                            
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                                                                                    'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                   '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                    'BOX属性
'                       If Inspection_QTY = 1 Then
'
'                           Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                               ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                       Else
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCANK                             '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK        '2007.04.21
'                       End If
                            
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then                '2012.09.05 j-->k
                                    
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                End If
                            End If
                        Next k
                                                                                    '表示内容
                            
                        If Y_SYU_CNT < 2 Then
    
 '                          If Inspection_QTY = 1 Then
    
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
 '                              Else
 '                                      Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
 '                                  Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
 '                              End If
                                                                                        
                        Else

'                                If Inspection_QTY = 1 Then
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                            End If
                                                                                    
                                                                                    '数値初期表示
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                            Else
                                Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
'                            End If
                                                                                    '初期カーソル位置
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Start_Pos = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                            Else
                                Send_Text.Box_Type(4).Start_Pos = "01"                                              '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"                         '2007.04.21
'                            End If
                                                                                    
                                                                                    '入力桁数
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).Max_Size = "00"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'                            Else
                                Send_Text.Box_Type(4).Max_Size = "20"                                               '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"                          '2007.04.21
'                            End If
                                                                                    
                                                                                    
                            '2009.04.15
                            If SYUKA_QTY > 1 Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then        '2012.04.09
                                Else
                                    Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                End If                  '2012.04.09
                            End If
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            Sendbuf = Text_Create_Proc()
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                End Select
            
            Next i
'''''''''''''''''''''''''''''''
    
    
        Case Step_Sagyo4_RES        '４回目の受信（検品数　受信）
            
            For i = 0 To M_Gyo - 1
                
'                Select Case RTrim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), _
'                                Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 10))
                    
                    Case LCD_Syuka_Su1, LCD_Syuka_Su2, "出荷数："  '出荷数(検品数)
                        
                        SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        If Not IsNumeric(SURYO) Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        
                        End If
                
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                
                        If CLng(SURYO) <> SYUKA_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷数エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
            
            ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""        '2012.11.15
            
            
            Y_SYU_CNT = 0
            SYUKA_QTY = 0
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                    
                        Y_SYU_CNT = Y_SYU_CNT + 1
                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                    End If
                End If
            Next j
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        '------------------------------------   出荷予定の処理
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID№
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                                 Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
        
                    '''他行の使用を継続するため
                    '''Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                    '''Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                        Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                    '出荷予定書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    
                                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                    Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                        
                        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID№
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                                            
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                        Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
'2012.10.31                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                                            
                                            
                        '------------------------------------   在庫移動履歴の処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                            MENU_NO = ""
                        End If
                                            
                        '履歴出力の為の読み込み
                        Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                        Call UniCode_Conv(K0_MTS.SS_CODE, "")
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                                Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                            
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    CYU_KBN_SPO, _
                                                    Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状№:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                                    , , , , MENU_NO, _
                                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                GoTo Abort_Tran
                        End Select
                                            
                        '検品済！！
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = True
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
                                        
                    End If
                '--------------------   2012.10.02  ▽
                Else
                
                    Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID№
    
                    Do
                    
                        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                GoTo Abort_Tran
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                GoTo Abort_Tran
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                
                    Loop
                
                
                    Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
'''''''''''''''                    ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                                '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                    Do
                        sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                GoTo Abort_Tran
                        
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                
                '--------------------   2012.10.02  △
                End If
            
            Next j
'2012.11.15            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.31
            '作業ﾛｸﾞ出力    2009.04.17
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO) Then
                    Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                    Exit Function
                End If
            End If
            '作業ﾛｸﾞ出力    2009.04.17
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
                    
                    
                    
                    
                    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                    
            Select Case ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND
            
            
                Case "1"
                    '集合梱包なし
                
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
'''' 荷札処置
'                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
'                                ID_KANRI_TBL(ING_No).LABEL_ON = False
'                            Else
'
'                                PRINT_OFF = False
'
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
'                                    Not LOGIXTICS_F Then
'                                    If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
'                                        PRINT_OFF = True
'                                    End If
'                                End If
'
'                                If Not PRINT_OFF Then
'
'
'                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'                                    '2010.06.16
'                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                    Select Case sts
'                                        Case BtNoErr
'
'                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            End If
'
'                                        Case BtErrKeyNotFound
'
'                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                        Case Else
'                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                            Sendbuf = Text_Create_Proc()
'                                            GoTo Abort_Tran
'                                    End Select
'
'
'
'
'
'
'
'                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
'                                    Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
'
'                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'                                    'Y_SYU_CNT = 0
'                                    SYUKA_QTY = 0
'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                'Y_SYU_CNT = Y_SYU_CNT + 1
'                                                SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'                                                    PRINT_OFF = True
'                                                Else
'
'                                                   ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
'
'                                                End If
'
'                                            End If
'                                        End If
'                                    Next j
'                                End If
'
'                                If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
'                                                       Not LOGIXTICS_F) Then
'                                    PRINT_MAISU = PRINT_MAISU - 1
'                                    If PRINT_MAISU < 1 Then
'
'                                    '枝番更新   2010.02.15
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                        GoTo Abort_Tran
'
'                                                    End If
'
'
'                                                End If
'                                            Else
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                            GoTo Abort_Tran
'
'                                                        End If
'
'
'
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
'                                    '枝番更新   2010.02.15
'
'                                        PRINT_OFF = True
'
'                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
'
'
'                                    Else
''                                            PRINT_MAISU = PRINT_MAISU - 1
'                                        Start_Page_No = Start_Page_No + 1
'                                    End If
'                                End If
'
'                                If Not PRINT_OFF Then
'
'                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'
'                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                    Select Case sts
'                                        Case BtNoErr
'
'                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            End If
'
'                                        Case BtErrKeyNotFound
'
'
'                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                        Case Else
'                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                            Sendbuf = Text_Create_Proc()
'                                            GoTo Abort_Tran
'                                    End Select
'
'
''2010.02.21                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
''2010.02.21                                    Start_Page_No = Start_Page_No + 1
'
''2010.02.21                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'
'                                    If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
'                                    End If
'
'
'
'                                    '枝番更新   2010.02.15
'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And _
'                                                    (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                      Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
'                                                       Not LOGIXTICS_F) Then
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'
'                                                        GoTo Abort_Tran
'                                                    End If
'
'
'                                                Else
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                        GoTo Abort_Tran
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Else
'                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                        GoTo Abort_Tran
'
'                                                    End If
'
'
'
'                                                End If
'
'
'
'                                            End If
'                                        End If
'                                    Next j
'                                    '枝番更新   2010.02.15
'
'
'
'
''2010.02.21                                    If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
''                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
''                                    Else
''                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
''                                    End If
'
''                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
''
''                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
''
''                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
''
''                                                If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
''                                                    GoTo Abort_Tran
''                                                End If
''
''                                            End If
''                                        End If
''                                    Next j
'
'                                    'データ送信
'
'                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'
'                                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
'
'                                    ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU - 1
'                                    '-----------------------------------------------ヘッダー
'
'                                    Call Wel_Head_Print_Text_Proc(fileName)
'
'                                    Sendbuf = Text_Create_Proc()
'
'
'                                    Inspe_Proc_LOGISTIC_ALL = False
'                                    Exit Function
'                                End If
'
'                            End If
''' 荷札処置
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            
                            
                            '-----------------------------------------------３行目
                            Call Wel_HIN_NO_Req_Text_3_Proc
                            '-----------------------------------------------４行目
                            Call Wel_HIN_NO_Req_Text_4_Proc
                            
                            
                            
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
                    
                    
                    
                        Case True
                            '残なし　口数へ
                    
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
''' 荷札処置
'                                PRINT_OFF = False
'
'                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
'                                    PRINT_OFF = True
'                                Else
'                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
'
'                                        If KONPOU_ON = KONPOU_ON_SUMI Then
'
'                                            PRINT_OFF = True
'
'                                        End If
'
'                                    End If
'                                End If
'
'                                If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
'                                    ID_KANRI_TBL(ING_No).LABEL_ON = False
'                                Else
'
'            '                        Y_SYU_CNT = 0
'            '                        SYUKA_QTY = 0
'
'                                    PRINT_OFF = False
'
'                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
'                                        Not LOGIXTICS_F Then
'                                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
'
'                                                        '枝番更新   2010.02.15
'                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'                                                    Start_Page_No = 1
'                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'
'
'
'                                                        '枝番更新   2010.02.15
'
'                                                        PRINT_OFF = True
'
'                                                    End If
'
'                                                Else
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                GoTo Abort_Tran
'
'                                                            End If
'
'
'                                                        End If
'
'                                                    End If
'                                                End If
'                                            Next j
'                                        End If
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                        Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'
'                                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                        Select Case sts
'                                            Case BtNoErr
'
'                                                If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'                                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                                End If
'
'                                            Case BtErrKeyNotFound
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            Case Else
'                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                                Sendbuf = Text_Create_Proc()
'                                                GoTo Abort_Tran
'                                        End Select
'
'                                        PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
'                                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
'
'                                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'                                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
'                                                               Not LOGIXTICS_F) Then
'                                            PRINT_MAISU = PRINT_MAISU - 1
'
'
'
'                                            If PRINT_MAISU < 1 Then
'
'                                                        '枝番更新   2010.02.15
'                                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                GoTo Abort_Tran
'                                                            End If
'
'                                                        End If
'
'
'
'                                                    Else
'                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'
'                                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                    GoTo Abort_Tran
'                                                                End If
'
'
'
'                                                            End If
'
'                                                        End If
'
'
'
'                                                    End If
'                                                Next j
'                                                        '枝番更新   2010.02.15
'
'                                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
'
'                                                PRINT_OFF = True
'                                            Else
'            '                                    PRINT_MAISU = PRINT_MAISU - 1
'                                                Start_Page_No = Start_Page_No + 1
'                                            End If
'                                        End If
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'                                        Y_SYU_CNT = 0
'                                        SYUKA_QTY = 0
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                    Y_SYU_CNT = Y_SYU_CNT + 1
'                                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'                                                        PRINT_OFF = True
'                                                    Else
'
'                                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
'
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
'                                        End If
'
'
'
'
'
'                                                        '枝番更新   2010.02.15
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'                                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And Start_Page_No = 2 Then
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'                                                    Else
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'                                                    End If
'
'                                                End If
'
'
'
'                                            Else
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'
'                                                    End If
'
'                                                End If
'
'
'
'
'
'                                            End If
'                                        Next j
'                                                        '枝番更新   2010.02.15
'
'
'
'
'                                        If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
'                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
'                                        Else
'                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
'                                        End If
'
''                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
''
''                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
''
''                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
''
''
''
''                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
''                                                        GoTo Abort_Tran
''                                                    End If
''                                                End If
''                                            End If
''                                        Next j
'
'                                        'データ送信
'
'                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 2
'
'                                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
'
'                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                        '-----------------------------------------------ヘッダー
'
'                                        Call Wel_Head_Print_Text_Proc(fileName)
'
'                                        Sendbuf = Text_Create_Proc()
'
'
'                                        Inspe_Proc_LOGISTIC_ALL = False
'                                        Exit Function
'
'                                    End If
'                                End If
            ''' 荷札処置
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
'2012.11.15                                                                                        'BOX属性
'2012.11.15                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                        '表示内容
'2012.11.15
'2012.11.15                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                                Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                                Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                                Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '2012.11.15
                                Call Wel_OKURI_SAKI_PROC
                                '-----------aaa------------------------------------４行目
                                
'口数INPUT １
                                
                                wkKONPO_F = ""
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                    
                                        wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                        Exit For
                                    End If
                                Next j
                                
                                If wkKONPO_F = "1" Then
                                                        
                                    If Inspection_Input Then
                                        KUTI_SU_INPUT_F = False
                                    Else
                                        KUTI_SU_INPUT_F = True
                                    End If
                                
                                
                                    TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                    TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                            
                                Else
                                    TOTAL_KUTI_SU = 1
                                    KUTI_SU_INPUT_F = True
                                    TOTAL_SAI_SU = 0#
                                End If
                                            
                                            
                                            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                            
                                            
                                If KUTI_SU_INPUT_F Then
                                
                                    Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                
                                
                                Else
                                    Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                
                                    
                                    
                                    If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                    
                                    
                                    
                                    
                                    
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                                
        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.10
                                    '----------------------------------- データ更新処理開始 -----------
                                                                    'トランザクション開始
                                    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    If sts <> BtNoErr Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    End If
                                            
                                                                
                                    For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                            '単体梱包１口時
                                            If OKURI_NO_SEQ_Update_Proc(k, Format(1, "000"), Sendbuf, Format(TOTAL_KUTI_SU, "000")) Then
                                                GoTo Abort_Tran
                                            End If
                                            
                                        End If
                                    Next k
                                            
                                                        'トランザクション終了
                                    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    If sts <> BtNoErr Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpEndTransaction, "", 0)
                                        GoTo Abort_Tran
                                    End If
                                            
        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.10
                                
                                
                                
                                
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                        
                        End Select
                        
                
                
                Case "2"
                    '集合梱包のみ
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
                    
                    
                    
                        Case True
                            '残なし　口数へ
''' 荷札処置
                            PRINT_OFF = False

                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then '                                    PRINT_OFF = True
                            Else
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then

                                    If KONPOU_ON = KONPOU_ON_SUMI Then

                                        PRINT_OFF = True

                                    End If

                                End If
                            End If

                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                ID_KANRI_TBL(ING_No).LABEL_ON = False
                            Else

            '                        Y_SYU_CNT = 0
            '                        SYUKA_QTY = 0
'
                                PRINT_OFF = False

                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                    Not LOGIXTICS_F Then
                                    If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then

                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then

                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then






                                                    '枝番更新   2010.02.15
                                                    Start_Page_No = 1
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01                                                    End If
                                                    '枝番更新   2010.02.15
                                                    PRINT_OFF = True
                                                End If


                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                     If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
    
    
'2012.04.01                                                         If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                             GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                         End If
    
    
    
                                                     End If
    
                                                 End If





                                            End If
                                        Next j
                                    End If
                                End If

                                If Not PRINT_OFF Then

                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)

                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    Select Case sts
                                        Case BtNoErr

                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then

                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                            End If

                                        Case BtErrKeyNotFound

                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select

                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))

                                    Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1

                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU

                                    If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                                            Not LOGIXTICS_F) Then
                                        PRINT_MAISU = PRINT_MAISU - 1
                                        If PRINT_MAISU < 1 Then

                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then

                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then

                                                    '枝番更新   2010.02.15
'2012.04.01                                                       If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                        End If


                                                        '枝番更新   2010.02.15



                                                    End If






                                                Else
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
    
    
'2012.04.01                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                                GoTo Abort_Tran
'2012.04.01                                                            End If
    
    
    
                                                        End If
                                                    End If
                                                End If
                                            Next j
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                            PRINT_OFF = True
                                        Else
            '                                    PRINT_MAISU = PRINT_MAISU - 1
                                            Start_Page_No = Start_Page_No + 1
                                        End If
                                    End If
                                End If

                                If Not PRINT_OFF Then

                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1

                                    Y_SYU_CNT = 0
                                    SYUKA_QTY = 0
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then

                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then

                                                Y_SYU_CNT = Y_SYU_CNT + 1
                                                SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO

                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                                    PRINT_OFF = True
                                                Else

                                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True

                                                End If

                                            End If
                                        End If
                                    Next j
                                End If

                                If Not PRINT_OFF Then
                                    ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01

                                    If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                    End If
                                    '枝番更新   2010.02.15
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then

                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01                                                End If
                                            End If

                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then


'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01                                                    End If


                                                End If

                                            End If







                                        End If
                                    Next j
                                    '枝番更新   2010.02.15





                                    If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                    Else
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                    End If


                                    'データ送信

                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 2

                                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ

                                    ID_KANRI_TBL(ING_No).LABEL_ON = True

                                    '-----------------------------------------------ヘッダー

                                    Call Wel_Head_Print_Text_Proc(fileName)

                                    Sendbuf = Text_Create_Proc()


                                    Inspe_Proc_LOGISTIC_ALL = False
                                    Exit Function

                                End If
                            End If
            ''' 荷札処置
                                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------aaa------------------------------------４行目
'口数INPUT ２
                            wkKONPO_F = ""
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                
                                    wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                    Exit For
                                End If
                            Next j
                            
                            If wkKONPO_F = "1" Then
                                                    
                                If Inspection_Input Then
                                    KUTI_SU_INPUT_F = False
                                Else
                                    KUTI_SU_INPUT_F = True
                                End If
                            
                            
                                TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                        
                            Else
                                TOTAL_KUTI_SU = 1
                                KUTI_SU_INPUT_F = True
                                TOTAL_SAI_SU = 0#
                            End If
                                            
                                            
                                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                            End If
                                        
                                        
                            If KUTI_SU_INPUT_F Then
                            
                                Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                            
                                ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                            
                            Else
                                Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                            
                                If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                            
                            
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                            
                            
                            
                            End If
                                
                            Sendbuf = Text_Create_Proc()
                    
                    End Select
                    
                Case "3"
                    '混在
            
                    
                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
            
            
                    Select Case (KONPOU_ON - KONPOU_ON_SUMI)
            
                        Case 0
                            '口数へ
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------aaa------------------------------------４行目
'口数input ３
                            wkKONPO_F = ""
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                
                                    wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                    Exit For
                                End If
                            Next j
                            
                            If wkKONPO_F = "1" Then
                                                    
                                If Inspection_Input Then
                                    KUTI_SU_INPUT_F = False
                                Else
                                    KUTI_SU_INPUT_F = True
                                End If
                            
                            
                                TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                        
                            Else
                                TOTAL_KUTI_SU = 1
                                KUTI_SU_INPUT_F = True
                                TOTAL_SAI_SU = 0#
                            End If
                                        
                                        
                                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                            End If
                                        
                                        
                            If KUTI_SU_INPUT_F Then
                            
                                Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_TYPE = "1"

                            
                            Else
                                Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                            
                                
                                If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                            
                            
                            
                            End If
                        
                        
                            Sendbuf = Text_Create_Proc()
                        
                        
                        
                        
                        
                        Case Else
                            '品番へ
            
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    End Select
            
            End Select
                    
                    
                    
                    
        Case Step_Sagyo5_RES        '５回目の受信（口数）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Left(Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)), 6)
                    '口数
                    Case LCD_KUTI_SU_S
                
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU < 0 Then
                        
                
                
                
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            
                            End If
                    
                            KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If KUTI_SU < 1 Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        Else
                            KUTI_SU = ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU
                        End If
                    
                    
                    
                    '才数
                    Case LCD_SAI_SU_S
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU < 0 Then
                        
                        
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            
                            End If
                    
                            SAI_SU = CDbl(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If SAI_SU <= 0 Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        Else
                            SAI_SU = ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU
                        
                            If SAI_SU < 1 Then
                                SAI_SU = 1
                            Else
                                If SAI_SU > 1 Then
                                    SAI_SU = CLng(ToHalfAdjust(CCur(SAI_SU), 0))
                                End If
                            End If
                        
                        
                        End If
                    
                        '送り状最大印刷枚数獲得 2010.01.21
                            
                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                
                                    If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                
                                
                                Else
                                
                                    If Label_Print_Total_Su_Proc(0, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                End If
                            End If
                        Next j
                                        
                            
                            
                            
                        
'                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
'
'                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            Exit Function
'                        End If
                    
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                            Else
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU <= 1 Then
                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                    End If
                                
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                                
                                End If
                            End If
                        Next j
                        
                        
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                
                                
                                
                                
                                
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                    'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                    If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                        If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                        End If
                                    Else
'''''''                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                        
                                        
                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                                                            
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                    
                                Else
                                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                        
                                        'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                        If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                            If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                            Else
                                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                            End If
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                                                                
                                        End If
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                
                                End If
                                                    
                                
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j

        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                   
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                
                                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                    'ID№
                                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
                
                                Do
                                
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                            
                                Loop
                                
                                
                                
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                                
                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                

''' 品番単位での丸め処理
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
''' 品番単位での丸め処理

                            
'                        PRINT_OFF = False
'
'                        If KONPOU_OFF = KONPOU_OFF_SUMI Then
'
'                            PRINT_OFF = True
'
'                        End If
                        If ID_KANRI_TBL(ING_No).KEN_TYPE = "1" Then
                            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                            '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            End If
                                    
                                                        
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                    '集合梱包時
                                    If OKURI_NO_SEQ_Update_Proc(k, Format(1, "000"), Sendbuf, Format(KUTI_SU, "000")) Then
                                        GoTo Abort_Tran
                                    End If
                                    
                                End If
                            Next k
                                    
                                                'トランザクション終了
                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                            End If
                                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            ID_KANRI_TBL(ING_No).KEN_TYPE = ""

                            If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 0 Then
                                ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                            End If
    
    
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                Not LOGIXTICS_F Then
                                If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                    PRINT_OFF = True
                                End If
                            End If


    
                            PRINT_MAISU = KUTI_SU
                                                
                                                
                            Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1

                            PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU


                            If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                                        Not LOGIXTICS_F) Then
                                PRINT_MAISU = PRINT_MAISU - 1
                                If PRINT_MAISU < 1 Then
                                
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        
                                                        '枝番更新   2010.02.15
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01                                                End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                        
                                            End If
                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                            
                        
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                    End If
                                            
                                                
                                                End If
                                                                
                                            End If
                                        End If
                                    Next j
                                
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                
                                    PRINT_OFF = True
                                Else
'                                PRINT_MAISU = PRINT_MAISU - 1
                                    Start_Page_No = Start_Page_No + 1
                            
                                End If
                            End If

''' 荷札処置
                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                ID_KANRI_TBL(ING_No).LABEL_ON = False
                            Else
                                
'2012.03.30                     Y_SYU_CNT = 0
'                               SYUKA_QTY = 0
'
'                               PRINT_OFF = False
'
'                               For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                   If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                       If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                           Y_SYU_CNT = Y_SYU_CNT + 1
'                                           SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'
'                                           If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'
'                                               PRINT_OFF = True
'                                           Else
'
'                                           End If
'                                       End If
'                                   End If
'2012.03.30                     Next j
                                
                                If Not PRINT_OFF Then
                                    ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01

                                    If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                    End If
                            
                            
                            
                            
                                    '枝番更新   2010.02.15
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                
                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                        
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            
                            
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01
'2012.04.01                                                    End If
                            
                                                Else
                            
                            
                                                            '枝番更新   2010.02.15
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01
'2012.04.01                                                    End If
                                                            
                                                End If
                                                            
                                                            '枝番更新   2010.02.15
                                            End If
                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
'2012.04.01                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01                                                        End If
                                                    Else
                                                    
'2012.04.01                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01                                                        End If
                                                    
                                                                            
                                                    
                                                    End If
                                                End If
                                            End If
                                        End If
                                    Next j
                                    '枝番更新   2010.02.15
                            
                            
                                
    '                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU
                                    
                                    If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                    Else
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                    End If
                                    
                                
                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 9
                                    
                                    'データ送信
                                                                
                                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                                
                                    ID_KANRI_TBL(ING_No).LABEL_ON = True
                                
                                    '-----------------------------------------------ヘッダー
                                    Call Wel_Head_Print_Text_Proc(fileName)
                                    '-----------------------------------------------ボディ
                                    Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
                                
                                    Sendbuf = Text_Create_Proc()
                                
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    Exit Function
                            
                                End If

''' 荷札処置
                            End If
                        End If
                    

                        KENPIN_END = True
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                            
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                    KENPIN_END = False
                                    Exit For
                                End If
                            End If
                        Next j
                    
                    

                        Select Case KENPIN_END
                            
                            Case True
        
                                '次の作業要求
    
                                    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                    Select Case sts
                                        Case BtNoErr
                                        '   -------------------------------- エラーメッセージ作成
                                        Case Else
                                        '重要な要因なので未登録はシステム停止とする
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                        Exit Function
                                    End Select
                                    
                                    
                                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                    If Sagyo_Send_Proc() Then
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                    
                                    Sendbuf = Text_Create_Proc()
                                            
                                            
                                            
                                            
                                            
                    
                    
                            Case Else
                    
    ''''''''''''''''''''''''''''''''''''''''''''''
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                
                                 '-----------------------------------------------３行目
                                Call Wel_HIN_NO_Req_Text_3_Proc
                                '-----------------------------------------------４行目
                                Call Wel_HIN_NO_Req_Text_4_Proc
                               
                                '-----------------------------------------------５行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                    
                        End Select
                    
                    End Select
                
            Next i
        

        Case Step_PRINT_RES        '印刷終了
    
    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    
            '-----------------------------------------------ヘッダー
            Call Wel_Head_Text_Proc
    
            Select Case ID_KANRI_TBL(ING_No).LABEL_STEP
                Case 1      '品番へ
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------  2012.03.30
'
'                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
'
'                    '-----------------------------------------------ヘッダー 02.24
'                    Call Wel_Head_Text_Proc
'
'                    '-----------------------------------------------１行目
'                    Call Wel_DETAIL_0_Text_Proc
'                    '-----------------------------------------------２行目
'                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
'                    '-----------------------------------------------３行目
'                                                                            'BOX属性
'                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                                                                            '表示内容
'
'                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'
'
'                                                                            '数値初期表示
'                    Send_Text.Box_Type(2).INIT = ""
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'                                                                            '初期カーソル位置
'                    Send_Text.Box_Type(2).Start_Pos = ""
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'                                                                            '入力桁数
'                    Send_Text.Box_Type(2).Max_Size = "00"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'
'                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
'                    '-----------------------------------------------４行目
'                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                                                                            '表示内容
'                                                                        '表示内容
'                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                                                                            '数値初期表示
'                    Send_Text.Box_Type(3).INIT = ""
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
'                                                                            '初期カーソル位置
'                    Send_Text.Box_Type(3).Start_Pos = "01"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
'                                                                            '入力桁数
'                    '2010.12.07
''                    Send_Text.Box_Type(3).Max_Size = "13"
''                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
'                    Send_Text.Box_Type(3).Max_Size = "20"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
'                    '2010.12.07
'
'                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
'                    '-----------------------------------------------５行目
'                    Call Wel_Clear_Text_Proc
'
'                    Sendbuf = Text_Create_Proc()
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                        If RTrim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                            Exit For
                        End If
                    
                    Next j
                    
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT Then
            
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                                                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                        End If
                                
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If ID_KANRI_TBL(ING_No).KEN_HINBAN = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO And _
                                Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                '単体梱包時
                                If OKURI_NO_SEQ_Update_Proc(k, Format(ID_KANRI_TBL(ING_No).LAST_START_PAGE, "000"), Sendbuf, Format(ID_KANRI_TBL(ING_No).LAST_END_PAGE, "000")) Then
                                    GoTo Abort_Tran
                                End If
                                
                            End If
                        Next k
                                
                                
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
            
            
            
            
            
            
            
            
            
            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                        
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
'2012.11.15                                                                                'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        Else
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                        End If
                        
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                End If
                            End If
                        Next k
                                                                                    '表示内容
                            
                        If Y_SYU_CNT < 2 Then
    
'                                If Inspection_QTY = 1 Then
    
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
'                                End If
                                                                                    
                        Else
                            
'                                If Inspection_QTY = 1 Then
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                        End If
                                                                                    
                                                                                '数値初期表示
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                        Else
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                        End If
                                                                                '初期カーソル位置
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                        Else
                            Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                        End If
                                                                                
                                                                                '入力桁数
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Else
                            Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                        End If
                                                                                
                                                                                
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                        End If
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                        Inspe_Proc_LOGISTIC_ALL = False
                        Exit Function
                
                
                    Else
                
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            
                            
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                                
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
'2012.11.15                                                                                'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        
                        
                        '-----------------------------------------------５行目
                                                                                    'BOX属性
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                            Else
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCANK                             '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK        '2007.04.21
'                            End If
                            
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                End If
                            End If
                        Next k
                                                                                    '表示内容
                            
                        If Y_SYU_CNT < 2 Then
    
 '                               If Inspection_QTY = 1 Then
    
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
 '                               Else
 '                                   Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
 '                                   Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
 '                               End If
                                                                                    
                        Else

'                                If Inspection_QTY = 1 Then
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                        End If
                                                                                
                                                                                    '数値初期表示
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                            Else
                        Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
'                            End If
                                                                                    '初期カーソル位置
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Start_Pos = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                            Else
                        Send_Text.Box_Type(4).Start_Pos = "01"                                              '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"                         '2007.04.21
'                            End If
                                                                                    
                                                                                    '入力桁数
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).Max_Size = "00"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'                            Else
                        Send_Text.Box_Type(4).Max_Size = "20"                                               '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"                          '2007.04.21
'                            End If
                                                                                    
                                                                                    
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then   '2012.04.13
                            Else
                                Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                            End If                  '2012.04.13
                        End If
                                                                            
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                        Inspe_Proc_LOGISTIC_ALL = False
                        Exit Function
                    End If
                    
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------  2012.03.30

                
                Case 2      '口数へ
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    '-----------------------------------------------ヘッダー
                    Call Wel_Head_Text_Proc
                    
                    '-----------------------------------------------１行目
                    Call Wel_DETAIL_0_Text_Proc
                    '-----------------------------------------------２行目
                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                    
                    '-----------------------------------------------３行目
'2012.11.15                                                                            'BOX属性
'2012.11.15                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                            '表示内容
'2012.11.15
'2012.11.15                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                            '数値初期表示
'2012.11.15                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                            '初期カーソル位置
'2012.11.15                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                            '入力桁数
'2012.11.15                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '2012.11.15
                    Call Wel_OKURI_SAKI_PROC
                    
                    
                    '-----------------------------------------------４行目
'口数　４
                    wkKONPO_F = ""
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                    
                        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                        
                            wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                            Exit For
                        End If
                    Next j
                    
                    If wkKONPO_F = "1" Then
                                            
                        If Inspection_Input Then
                            KUTI_SU_INPUT_F = False
                        Else
                            KUTI_SU_INPUT_F = True
                        End If
                    
                    
                        TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                        TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                
                    Else
                        TOTAL_KUTI_SU = 1
                        KUTI_SU_INPUT_F = True
                        TOTAL_SAI_SU = 0#
                    End If
                                
                                
                                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                    End If
                                
                                
                    If KUTI_SU_INPUT_F Then
                    
                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                        ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                    
                    
                    Else
                        Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                    
                        
                        If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                    
                    
                    
                    End If
                    
                    Sendbuf = Text_Create_Proc()
                
                Case 9
        
                    Select Case (Y_SYU_CNT - Sumi_CNT)
                
                        Case 0
                
                            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                            Select Case sts
                                Case BtNoErr
                                '   -------------------------------- エラーメッセージ作成
                                Case Else
                                '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                            End Select
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                            
                            Sendbuf = Text_Create_Proc()
            
            
                        Case Else
                        
        ''''''''''''''''''''''''''''''''''''''''''''''
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                            Call Wel_HIN_NO_Req_Text_3_Proc
                            '-----------------------------------------------４行目
                            Call Wel_HIN_NO_Req_Text_4_Proc
                            '-----------------------------------------------５行目
                            Call Wel_Clear_Text_Proc
        
                            Sendbuf = Text_Create_Proc()
        
            
                End Select
            End Select
    
    End Select
                    
                    

    Inspe_Proc_LOGISTIC_ALL = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Private Function Inspe_Proc_LOGISTIC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（宅配伝票読み込み 大阪ＰＣ向け）』
'       'ロジステックス対応
'       2010.02.25
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07


Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Long

Dim SAI_SU          As Double

Dim UNSOU_KAISHA    As String
 
Dim SYUKA_YMD       As String
Dim JYUSHO          As String
Dim BIKOU           As String

Dim SURYO           As String

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag

Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean

'2010.01.21
Dim KONPOU_ON           As Integer


Dim KONPOU_ON_SUMI      As Integer
Dim KONPOU_OFF          As Integer
Dim KONPOU_OFF_SUMI     As Integer
Dim PRINT_OFF           As Boolean
Dim Start_Page_No       As Long
Dim PRINT_TOTAL_SU      As Long
Dim PRINT_MAISU         As Long
Dim fileName            As String
Dim ID_SEQ              As Integer
Dim DISP_SAI_SU         As Double

Dim wkKUTI_SU           As String
Dim wkKONPO_F           As String * 1

Dim TOTAL_KUTI_SU       As Integer
Dim TOTAL_SAI_SU        As Double
Dim MUKE_NAME           As String
Dim OKURI_NO_MAX        As Integer
Dim KUTI_SU_INPUT_F     As Boolean

Dim KEN_TEL_NO          As String * 20

Dim LOGIXTICS_F         As Boolean

Dim OKURI_NO_F          As Boolean
'2010.01.21
Dim FUKUYAMA_CHK_F      As Boolean

    Inspe_Proc_LOGISTIC = True

    LOGIXTICS_F = True
    
    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                                        
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, _
                                                SYUKA_YMD, _
                                                JYUSHO, _
                                                BIKOU, _
                                                Start_Page_No, _
                                                KUTI_SU, _
                                                MUKE_NAME, _
                                                OKURI_NO_MAX, , , _
                                                KEN_TEL_NO)
                        
                        '他端末で使用中 2011.04.07
                        If sts = SYS_CANCEL Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC = False
                            Exit Function
                        End If
                        '他端末で使用中 2011.04.07
                        
                        
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            Next j
                                                     
                            If CANCEL_F Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                            End If
                        End If
                        
                        
                        If Y_SYU_CNT = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC = False
                            Exit Function
                        End If
                                                 
                        If Sumi_CNT = Y_SYU_CNT And Start_Page_No <> 0 Then
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品処理済！", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC = False
                            Exit Function
                        
                        End If
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = Y_SYU_TBL(j).KONPOU_F        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_CND = Y_SYU_TBL(j).KONPOU_CND    '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).TOTAL_SU = Y_SYU_TBL(j).TOTAL_SU        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = Y_SYU_TBL(j).SAI_SU            '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = Y_SYU_TBL(j).KUTI_SU          '2010.01.21
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = Y_SYU_TBL(j).PRINT_SUMI    '2010.01.21
                        
                                                                                                        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ = Y_SYU_TBL(j).OKURI_NO_SEQ
                        
                        Next j
                        
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        '出荷日
                        ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = SYUKA_YMD
                        '住所
                        ID_KANRI_TBL(ING_No).KEN_JYUSHO = JYUSHO
                        
                        '備考
                        ID_KANRI_TBL(ING_No).KEN_BIKOU = BIKOU
                        '向け先
                        ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = MUKE_NAME
                        
                        '枝番
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO_MAX = OKURI_NO_MAX
                        '電話番号
                        ID_KANRI_TBL(ING_No).KEN_TEL_NO = KEN_TEL_NO
                        
                        
                        
                        'ﾗﾍﾞﾙ開始ページ№
                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                        
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                        
                    
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        
                        
                        
                        End If
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                        
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                        If KONPOU_ON <> 0 Then
                            If KONPOU_ON = KONPOU_ON_SUMI Then
                                                    
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                                    
                            End If
                        End If
                        
                        
                        
                        
                        
                        
                        
                        
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_SAKI)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_SAKI)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                
                
                
                        Else
                
                
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                                                                                    'BOX属性
                                                                                    
                                                                                    
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                            
KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI   '2011.03.17
        
    ''' 品番単位での丸め処理
Select Case KONPOU_ON    '2011.03.17
                            
                            
''''''''''2011.03.17Select Case (KONPOU_ON - KONPOU_ON_SUMI)
                                Case 0
                                '集合梱包なし
                                
                                    
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                        If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                        
                                        
                                        
                                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                            
                                            '-----------------------------------------------ヘッダー
                                            Call Wel_Head_Text_Proc
                                            '-----------------------------------------------１行目
                                            Call Wel_DETAIL_0_Text_Proc
                                            '-----------------------------------------------２行目
                                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                            '-----------------------------------------------３行目
                                                                                                    'BOX属性
                                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                                    '表示内容
                                                                                                    
                                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                                    
                                                                                                    '数値初期表示
                                            Send_Text.Box_Type(2).INIT = ""
                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                                    '初期カーソル位置
                                            Send_Text.Box_Type(2).Start_Pos = ""
                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                                    '入力桁数
                                            Send_Text.Box_Type(2).Max_Size = "00"
                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                    
                                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        
                                        
                                        
                                        
                                        
                                        
                                            TOTAL_KUTI_SU = 1
                                            KUTI_SU_INPUT_F = True
                                            TOTAL_SAI_SU = 0#
                                                
                                                
                                                
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                            End If
                                                
                                                
                                    
                                            Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                            ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                            ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                    
                                    
                                    
                                            Sendbuf = Text_Create_Proc()
                                        
                                            Inspe_Proc_LOGISTIC = False
                                            Exit Function
                                        
                                        
                                        End If
                                    End If
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    
                                    
                                    
                                    '-----------------------------------------------ボディ
                                    Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
            
                                    Sendbuf = Text_Create_Proc()
                                Case Else
                                '集合梱包あり
                            
                                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                                    '-----------------------------------------------２行目
                                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                    '-----------------------------------------------３行目
                                                                                            'BOX属性
                                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                            '表示内容
                                                                                            
                                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(2).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(2).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                            '入力桁数
                                    Send_Text.Box_Type(2).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    '-----------------------------------------------４行目
                                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                            '表示内容
                                                                                        '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = "01"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                            '入力桁数
                                    '2010.12.07
'                                    Send_Text.Box_Type(3).Max_Size = "13"
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                    Send_Text.Box_Type(3).Max_Size = "13"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                    '2010.12.07
                                                                                            
                                                                                            
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------５行目
                                    Call Wel_Clear_Text_Proc
            
                                    Sendbuf = Text_Create_Proc()
                            
                            End Select
                        End If
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
'                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
'
'                        '-----------------------------------------------ヘッダー
'                        Call Wel_Head_Text_Proc
'                        '-----------------------------------------------１行目
'                        Call Wel_DETAIL_0_Text_Proc
'                        '-----------------------------------------------２行目
'                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, SUMI_CNT, Y_SYU_CNT)
'                        '-----------------------------------------------３行目
'                                                                                'BOX属性
'                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(2).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(2).Start_Pos = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(2).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'
'                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
'                        '-----------------------------------------------４行目
'                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                                                                                '表示内容
'                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
'                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
'                        Else
'                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
'                        End If
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(3).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(3).Start_Pos = "01"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
'                                                                                '入力桁数
'                        Send_Text.Box_Type(3).Max_Size = "20"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
'
'                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
'                        '-----------------------------------------------５行目
'                                                                                'BOX属性'
'
'                        Call Wel_Clear_Text_Proc
'
'                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状№）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状№
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else
'2009.10.14                         If Len(OKURI_NO) < 11 Or Len(OKURI_NO) > 13 Then
'                            If Len(OKURI_NO) < 10 Or Len(OKURI_NO) > 13 Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                Inspe_Proc_LOGISTIC = False
'                                Exit Function
'                            End If
                        
                            If Not IsNumeric(OKURI_NO) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                            End If
                        
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            
                            
                            
                            
                            If Not OKURI_NO_F Then
                            
                        
                        
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                                                
                            End If
                        
                        
                            '2090.04.28
                            If FUKUYAMA_CHK_F Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                            
                            End If
                            '2090.04.28
                        
                        
                        
'                            Select Case Len(Trim(OKURI_NO))
'
'                                Case FUKUYAMA_Length
'                                Case SEIBU_Length
'                                Case KURUME_Length
'
'                                    For k = 0 To UBound(KURUME_CODE)
'
'                                        If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
'                                            Exit For
'                                        End If
'                                    Next k
'
'                                    If k > UBound(KURUME_CODE) Then
'
'
'                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                                        Sendbuf = Text_Create_Proc()
'                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                        Inspe_Proc_LOGISTIC = False
'                                        Exit Function
'
'                                    End If
'
'                                Case SAGAWA_Length, YAMATO_Length
'
'                                    For k = 0 To UBound(KURUME_CODE)
'
'                                        If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
'                                            Exit For
'                                        End If
'                                    Next k
'
'                                    If k > UBound(SAGAWA_CODE) Then
'
'                                        For k = 0 To UBound(YAMATO_CODE)
'
'                                            If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
'                                                Exit For
'                                            End If
'
'                                        Next k
'
'                                        If k > UBound(YAMATO_CODE) Then
'
'                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                                            Sendbuf = Text_Create_Proc()
'                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                            Inspe_Proc_LOGISTIC = False
'                                            Exit Function
'
'
'
'                                        End If
'
'                                    End If
'
'
'                            End Select
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        End If
                    
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "ロジスティクス")
                                            
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                                            
                                            
'                                '運送会社変換
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, 3) = UNSOU_KAISHA_CODE Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, UNSOU_KAISHA_NAME)
'                                End If
'                                '新運送会社変換 2007.01.09
'
'                                If KURUME_F Then        '久留米
'                                    For k = 1 To UBound(KURUME)
'
'                                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(KURUME(k))) = KURUME(k) Then
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME(0))
'                                            Exit For
'                                        End If
'                                    Next k
'                                End If
'
'                                If FUKUYAMA_F Then      '福山
'                                    For k = 1 To UBound(FUKUYAMA)
'
'                                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(FUKUYAMA(k))) = FUKUYAMA(k) Then
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA(0))
'                                            Exit For
'                                        End If
'                                    Next k
'                                End If
'
'                                If SAGAWA_F Then        '佐川
'                                    For k = 1 To UBound(SAGAWA)
'
'                                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(SAGAWA(k))) = SAGAWA(k) Then
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA(0))
'                                            Exit For
'                                        End If
'                                    Next k
'                                End If
'
'                                '物流 2010.02.19
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_CHARTER_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "物流")
'                                End If
'
'                                '赤帽 2010.02.19
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_AKABOU_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "赤帽")
'                                End If
'
'                                'ロジステック 2010.02.19
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "ロジステック")
'                                End If
                                
                                
                                
                                
                                
'                                Select Case Len(Trim(OKURI_NO))
'
'                                    Case FUKUYAMA_Length
'                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
'                                    Case SEIBU_Length
'                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
'
'                                    Case KURUME_Length
'
'                                        For k = 0 To UBound(KURUME_CODE)
'
'                                            If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
'                                                Exit For
'                                            End If
'                                        Next k
'
'                                        If k > UBound(KURUME_CODE) Then
'                                        Else
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
'                                        End If
'
'                                    Case SAGAWA_Length, YAMATO_Length
'
'                                        For k = 0 To UBound(KURUME_CODE)
'
'                                            If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
'                                                Exit For
'                                            End If
'                                        Next k
'
'                                        If k > UBound(SAGAWA_CODE) Then
'
'                                            For k = 0 To UBound(YAMATO_CODE)
'
'                                                If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
'                                                    Exit For
'                                                End If
'
'                                            Next k
'
'                                            If k > UBound(YAMATO_CODE) Then
'                                            Else
'
'                                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
'                                            End If
'
'                                        Else
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
'                                        End If
'
'
'                                End Select
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
'                                '物流 2010.02.19
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_CHARTER_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "物流")
'                                End If
'
'                                '赤帽 2010.02.19
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_AKABOU_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "赤帽")
'                                End If
                                
                                
                                
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_LOGISTIC = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
                                                                                'BOX属性
                                                                                
                                                                                
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI '2011.03.17
    
''' 品番単位での丸め処理
Select Case KONPOU_ON  '2011.03.17
'''''''''''''''''Select Case (KONPOU_ON - KONPOU_ON_SUMI)    '2011.03.17
                            Case 0
                            '集合梱包なし
                            
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                
                                If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                    
                                    
                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                        
                                        '-----------------------------------------------ヘッダー
                                        Call Wel_Head_Text_Proc
                                        '-----------------------------------------------１行目
                                        Call Wel_DETAIL_0_Text_Proc
                                        '-----------------------------------------------２行目
                                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                        '-----------------------------------------------３行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                                '表示内容
                                                                                                
                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                                
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(2).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(2).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(2).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    
                                    
                                    
                                    
                                    
                                    
                                        TOTAL_KUTI_SU = 1
                                        KUTI_SU_INPUT_F = True
                                        TOTAL_SAI_SU = 0#
                                            
                                            
                                            
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                        End If
                                            
                                            
                                
                                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                
                                
                                
                                        Sendbuf = Text_Create_Proc()
                                    
                                        Inspe_Proc_LOGISTIC = False
                                        Exit Function
                                    
                                    
                                    End If
                                End If
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                            
                            
                            
                            
                                '-----------------------------------------------ボディ
                                Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
        
                                Sendbuf = Text_Create_Proc()
                            Case Else
                            '集合梱包あり
                        
                                '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                                Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------------------------------------------４行目
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                        '表示内容
                                                                                    '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                        '入力桁数
                                '2010.12.07
'                                Send_Text.Box_Type(3).Max_Size = "13"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                Send_Text.Box_Type(3).Max_Size = "20"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                '2010.12.07
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                        
                        End Select
                    End Select
                Next i
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            For i = 0 To M_Gyo - 1
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban     '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                '集合梱包有り時の品番チェック
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC = False
                            Exit Function
                        End If
                        
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND <> "1" Then
                        
                            If KONPOU_ON <> KONPOU_ON_SUMI Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
                            
                            
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC = False
                                    Exit Function
                            
                                End If
                            End If
                        
                        End If
                        'ｷｬﾝｾﾙのﾁｪｯｸ
                        CANCEL_F = True
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            End If
                        Next j
                        
                        If CANCEL_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "キャンセル品番です。", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC = False
                            Exit Function
                        
                        
                        End If
                        
                        
                        
                                
                        '検品済みのﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "検品済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC = False
                            Exit Function
                        End If
                
                        '未出庫のﾁｪｯｸ   2007.05.14
                        If Inspection_Flg = 0 Then
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN <> KAN_KBN_FIN Then
                                        Exit For
                                    End If
                                End If
                            Next j
                                            
                            If j <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                            End If
                        End If
                        '未出庫のﾁｪｯｸ   2007.05.14
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc

''' 品番単位での丸め処理
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        
                        
                        
                        
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容


                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)


                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"

                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"

                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

                        
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        Else
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                        End If
                        
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                                                                                '表示内容
                        
                        If Y_SYU_CNT < 2 Then

                            If Inspection_QTY = 1 Then

                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
                            End If
                                                                                
                        Else
                        
                            If Inspection_QTY = 1 Then
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
                            End If
                        
                        End If
                                                                                
                                                                                '数値初期表示
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                        Else
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                        End If
                                                                                '初期カーソル位置
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                        Else
                            Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                        End If
                                                                                
                                                                                '入力桁数
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Else
                            Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                        End If
                                                                                
                                                                                
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                                                                
                        End If
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
            
            Next i
'''''''''''''''''''''''''''''''
    
    
        Case Step_Sagyo4_RES        '４回目の受信（検品数　受信）
            
            For i = 0 To M_Gyo - 1
                
'                Select Case RTrim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), _
'                                Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 10))
                    
                    Case LCD_Syuka_Su1, LCD_Syuka_Su2, "出荷数："  '出荷数(検品数)
                        
                        SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        If Not IsNumeric(SURYO) Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC = False
                            Exit Function
                        
                        End If
                
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                
                        If CLng(SURYO) <> SYUKA_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷数エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
            
            Y_SYU_CNT = 0
            SYUKA_QTY = 0
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                    
                        Y_SYU_CNT = Y_SYU_CNT + 1
                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                    End If
                End If
            Next j
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        '------------------------------------   出荷予定の処理
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID№
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC = False
                                    GoTo Abort_Tran
                                 Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
        
                    '''他行の使用を継続するため
                    '''Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                    '''Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                        Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                    '出荷予定書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    
                                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                    Inspe_Proc_LOGISTIC = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                        
                        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID№
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC = False
                                    GoTo Abort_Tran
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                                            
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                        Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
'                        '運送会社変換
'                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, 3) = UNSOU_KAISHA_CODE Then
'                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, UNSOU_KAISHA_NAME)
'                        End If
'                        '新運送会社変換 2007.01.09
'
'                        If KURUME_F Then        '久留米
'                            For k = 1 To UBound(KURUME)
'
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(KURUME(k))) = KURUME(k) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME(0))
'                                    Exit For
'                                End If
'                            Next k
'                        End If
'
'                        If FUKUYAMA_F Then      '福山
'                            For k = 1 To UBound(FUKUYAMA)
'
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(FUKUYAMA(k))) = FUKUYAMA(k) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA(0))
'                                    Exit For
'                                End If
'                            Next k
'                        End If
'
'                        If SAGAWA_F Then        '佐川
'                            For k = 1 To UBound(SAGAWA)
'
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(SAGAWA(k))) = SAGAWA(k) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA(0))
'                                    Exit For
'                                End If
'                            Next k
'                        End If
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Inspe_Proc_LOGISTIC = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                                            
                                            
                        '------------------------------------   在庫移動履歴の処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                            MENU_NO = ""
                        End If
                                            
                        '履歴出力の為の読み込み
                        Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                        Call UniCode_Conv(K0_MTS.SS_CODE, "")
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                                Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                            
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    CYU_KBN_SPO, _
                                                    Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状№:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                                    , , , , MENU_NO, _
                                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_LOGISTIC = SYS_ERR
                                GoTo Abort_Tran
                        End Select
                                            
                        '検品済！！
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = True
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
                                        
                    End If
                End If
            
            Next j
            '作業ﾛｸﾞ出力    2009.04.17
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO) Then
                    Inspe_Proc_LOGISTIC = SYS_ERR
                    Exit Function
                End If
            End If
            '作業ﾛｸﾞ出力    2009.04.17
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
                    
                    
                    
                    
                    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                    
            Select Case ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND
            
            
                Case "1"
                    '集合梱包なし
                
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ
''' 荷札処置
                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
                                ID_KANRI_TBL(ING_No).LABEL_ON = False
                            Else
                            
                                PRINT_OFF = False
                                
                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                    Not LOGIXTICS_F Then
                                    If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                        PRINT_OFF = True
                                    End If
                                End If
                                
                                If Not PRINT_OFF Then
                                
                                
                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                    '2010.06.16
                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    Select Case sts
                                        Case BtNoErr
                                        
                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                            
                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                            
                                            End If
                                        
                                        Case BtErrKeyNotFound
                                        
                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                        
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                
                                
                                
                                
                                
                                
                                
                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                                            
                                    Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
                                                            
                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                
                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                    
                                    'Y_SYU_CNT = 0
                                    SYUKA_QTY = 0
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                    
                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                            
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                            
                                                'Y_SYU_CNT = Y_SYU_CNT + 1
                                                SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                            
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                                    PRINT_OFF = True
                                                Else
                                            
                                                   ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                                                
                                                End If
                                            
                                            End If
                                        End If
                                    Next j
                                End If
                                
                                If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                                       Not LOGIXTICS_F) Then
                                    PRINT_MAISU = PRINT_MAISU - 1
                                    If PRINT_MAISU < 1 Then
                                        
                                    '枝番更新   2010.02.15
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                    
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                            
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                        
                                                        GoTo Abort_Tran
                                                    
                                                    End If
                                                                                                    
                                                
                                                End If
                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                    
                                
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                            
                                                            GoTo Abort_Tran
                                                        
                                                        End If
                                                    
                                                    
                                                    
                                                    End If
                                                                        
                                                End If
                                            End If
                                        Next j
                                    '枝番更新   2010.02.15
                                        
                                        PRINT_OFF = True
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                    
                                    
                                    Else
'                                            PRINT_MAISU = PRINT_MAISU - 1
                                        Start_Page_No = Start_Page_No + 1
                                    End If
                                End If
                                
                                If Not PRINT_OFF Then
                                                            
                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                            
                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    Select Case sts
                                        Case BtNoErr
                                        
                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                            
                                            
                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                            
                                            End If
                                        
                                        Case BtErrKeyNotFound
                                        
                                        
                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                        
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                                            
                                                            
'2010.02.21                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                                            
'2010.02.21                                    Start_Page_No = Start_Page_No + 1
                                                            
'2010.02.21                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                                            
                                                            
                                    If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                    End If
                                
                                
                                
                                    '枝番更新   2010.02.15
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                
                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                        
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            
                                                If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And _
                                                    (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                                       Not LOGIXTICS_F) Then

                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
                                                    
                                                        GoTo Abort_Tran
                                                    End If
                                            
                                            
                                                Else
                                            
                                            
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                    
                                                        GoTo Abort_Tran
                                                    End If
                                            
                                                End If
                                            End If
                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                
                            
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                        
                                                        GoTo Abort_Tran
                                                    
                                                    End If
                                                
                                                
                                                
                                                End If
                                                                    
                                                                    
                                                                    
                                            End If
                                        End If
                                    Next j
                                    '枝番更新   2010.02.15
                                
                                
                                
                                
'2010.02.21                                    If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
'                                    Else
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
'                                    End If
                                    
'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                    GoTo Abort_Tran
'                                                End If
'
'                                            End If
'                                        End If
'                                    Next j
                                    
                                    'データ送信
                                                                
                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                                
                                                                
                                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                                
                                    ID_KANRI_TBL(ING_No).LABEL_ON = True
                                
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU - 1
                                    '-----------------------------------------------ヘッダー
                                
                                    Call Wel_Head_Print_Text_Proc(fileName)
                                
                                    Sendbuf = Text_Create_Proc()
                                    
                                
                                    Inspe_Proc_LOGISTIC = False
                                    Exit Function
                                End If
                            
                            End If
''' 荷札処置
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            
                            
                            '-----------------------------------------------３行目
                            Call Wel_HIN_NO_Req_Text_3_Proc
                            '-----------------------------------------------４行目
                            Call Wel_HIN_NO_Req_Text_4_Proc
                            
                            
                            
'                            '-----------------------------------------------３行目
'                                                                                    'BOX属性
'                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                                                                                    '表示内容
'
'                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'                                                                                    '数値初期表示
'                            Send_Text.Box_Type(2).INIT = ""
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'                                                                                    '初期カーソル位置
'                            Send_Text.Box_Type(2).Start_Pos = ""
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'                                                                                    '入力桁数
'                            Send_Text.Box_Type(2).Max_Size = "00"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'
'                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
'                            '-----------------------------------------------４行目
'                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                                                                                    '表示内容
'                                                                                '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                                                                                    '数値初期表示
'                            Send_Text.Box_Type(3).INIT = ""
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
'                                                                                    '初期カーソル位置
'                            Send_Text.Box_Type(3).Start_Pos = "01"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
'                                                                                    '入力桁数
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
'
'                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
                    
                    
                    
                        Case True
                            '残なし　口数へ
                    
                    
''' 荷札処置
                                PRINT_OFF = False
            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
                                    PRINT_OFF = True
                                Else
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
                                    
                                        If KONPOU_ON = KONPOU_ON_SUMI Then
                
                                            PRINT_OFF = True
                
                                        End If
                
                                    End If
                                End If
                                
                                If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                    ID_KANRI_TBL(ING_No).LABEL_ON = False
                                Else
                                    
            '                        Y_SYU_CNT = 0
            '                        SYUKA_QTY = 0
                                    
                                    PRINT_OFF = False
                                    
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                        Not LOGIXTICS_F Then
                                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                            
                                                        '枝番更新   2010.02.15
                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                    Start_Page_No = 1
                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                    
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                        
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                                    
                                                        PRINT_OFF = True
                                        
                                                    End If
                                                
                                                Else
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                        
                                    
                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                
                                                                GoTo Abort_Tran
                                                            
                                                            End If
                                                    
                                                        
                                                        End If
                                                                            
                                                    End If
                                                End If
                                            Next j
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                        Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                
                                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                        Select Case sts
                                            Case BtNoErr
                                            
                                                If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                                
                                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                                
                                                End If
                                            
                                            Case BtErrKeyNotFound
                                            
                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                            
                                            Case Else
                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                                Sendbuf = Text_Create_Proc()
                                                GoTo Abort_Tran
                                        End Select
                                        
                                        PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                                                
                                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
                                                                
                                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                        
                                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                                               Not LOGIXTICS_F) Then
                                            PRINT_MAISU = PRINT_MAISU - 1
                                            
                                            
                                            
                                            If PRINT_MAISU < 1 Then
                                                
                                                        '枝番更新   2010.02.15
                                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    
                                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                            
                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                
                                                                GoTo Abort_Tran
                                                            End If
                                        
                                                        End If
                                                    
                                                    
                                                    
                                                    Else
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                            
                                        
                                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                    
                                                                    GoTo Abort_Tran
                                                                End If
                                                            
                                                            
                                                        
                                                            End If
                                                                                
                                                        End If
                                                    
                                                    
                                                    
                                                    End If
                                                Next j
                                                        '枝番更新   2010.02.15
                                                
                                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                                
                                                PRINT_OFF = True
                                            Else
            '                                    PRINT_MAISU = PRINT_MAISU - 1
                                                Start_Page_No = Start_Page_No + 1
                                            End If
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                        
                                        Y_SYU_CNT = 0
                                        SYUKA_QTY = 0
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                        
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                
                                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                                
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                                        PRINT_OFF = True
                                                    Else
                                                
                                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                                                    
                                                    End If
                                                
                                                End If
                                            End If
                                        Next j
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                        
                                        If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                        End If
                                        
                                        
                                        
                                        
                                        
                                                        '枝番更新   2010.02.15
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                    
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                            
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                                        
                                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And Start_Page_No = 2 Then
                                                    
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                    Else
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                    End If
                                                
                                                End If
                                            
                                            
                                            
                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                    
                                
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                    
                                                    End If
                                                                        
                                                End If
                
                                            
                                            
                                            
                                            
                                            End If
                                        Next j
                                                        '枝番更新   2010.02.15
                                        
                                        
                                        
                                        
                                        If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                        Else
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                        End If
                                        
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                        GoTo Abort_Tran
'                                                    End If
'                                                End If
'                                            End If
'                                        Next j
                                        
                                        'データ送信
                                                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 2
                                                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                                    
                                        '-----------------------------------------------ヘッダー
                                
                                        Call Wel_Head_Print_Text_Proc(fileName)
                                    
                                        Sendbuf = Text_Create_Proc()
                                        
                                    
                                        Inspe_Proc_LOGISTIC = False
                                        Exit Function
                                    
                                    End If
                                End If
            ''' 荷札処置
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------aaa------------------------------------４行目
                                
'口数INPUT １
                                
                                wkKONPO_F = ""
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                    
                                        wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                        Exit For
                                    End If
                                Next j
                                
                                If wkKONPO_F = "1" Then
                                                        
                                    If Inspection_Input Then
                                        KUTI_SU_INPUT_F = False
                                    Else
                                        KUTI_SU_INPUT_F = True
                                    End If
                                
                                
                                    TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                    TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                            
                                Else
                                    TOTAL_KUTI_SU = 1
                                    KUTI_SU_INPUT_F = True
                                    TOTAL_SAI_SU = 0#
                                End If
                                            
                                            
                                            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                            
                                            
                                If KUTI_SU_INPUT_F Then
                                
                                    Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                
                                
                                Else
                                    Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                
                                    
                                    
                                    If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                    
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                                
                                
                                
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                        
                        End Select
                        
                
                
                Case "2"
                    '集合梱包のみ
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
                    
                    
                    
                        Case True
                            '残なし　口数へ
                    
                    
''' 荷札処置
                                PRINT_OFF = False
            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
                                    PRINT_OFF = True
                                Else
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
                                    
                                        If KONPOU_ON = KONPOU_ON_SUMI Then
                
                                            PRINT_OFF = True
                
                                        End If
                
                                    End If
                                End If
                                
                                If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                    ID_KANRI_TBL(ING_No).LABEL_ON = False
                                Else
                                    
            '                        Y_SYU_CNT = 0
            '                        SYUKA_QTY = 0
                                    
                                    PRINT_OFF = False
                                    
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                        Not LOGIXTICS_F Then
                                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                            
                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                    
                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                    
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                                        Start_Page_No = 1
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        PRINT_OFF = True
                                                    End If
                                                
                                                
                                                Else
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                        
                                    
                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                
                                                                GoTo Abort_Tran
                                                            
                                                            End If
                                                        
                                                        
                                                        
                                                        End If
                                                                            
                                                    End If
                                                
                                                
                                                
                                                
                                                
                                                End If
                                            Next j
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                        Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                
                                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                        Select Case sts
                                            Case BtNoErr
                                            
                                                If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                                
                                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                                
                                                End If
                                            
                                            Case BtErrKeyNotFound
                                            
                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                            
                                            Case Else
                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                                Sendbuf = Text_Create_Proc()
                                                GoTo Abort_Tran
                                        End Select
                                        
                                        PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                                                
                                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
                                                                
                                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                        
                                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                                                Not LOGIXTICS_F) Then
                                            PRINT_MAISU = PRINT_MAISU - 1
                                            If PRINT_MAISU < 1 Then
                                                
                                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    
                                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                        
                                                        '枝番更新   2010.02.15
                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                
                                                                GoTo Abort_Tran
                                                            
                                                            End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                        
                                        
                                        
                                                        End If
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    Else
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                            
                                        
                                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                                    
                                                                    GoTo Abort_Tran
                                                                End If
                                                                
                                                        
                                                            
                                                            End If
                                                                                
                                                        End If
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    End If
                                                Next j
                                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                                PRINT_OFF = True
                                            Else
            '                                    PRINT_MAISU = PRINT_MAISU - 1
                                                Start_Page_No = Start_Page_No + 1
                                            End If
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                        
                                        Y_SYU_CNT = 0
                                        SYUKA_QTY = 0
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                        
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                
                                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                                
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                                        PRINT_OFF = True
                                                    Else
                                                
                                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                                                    
                                                    End If
                                                
                                                End If
                                            End If
                                        Next j
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                        
                                        If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                        End If
                                        
                                        
                                        
                                        
                                        
                                        '枝番更新   2010.02.15
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                    
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                            
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                        
                                                        GoTo Abort_Tran
                                                    End If
                                                End If
                                            
                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                    
                                
                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                            
                                                            GoTo Abort_Tran
                                                        End If
                                                    
                                                    
                                                    End If
                                                                        
                                                End If
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            End If
                                        Next j
                                        '枝番更新   2010.02.15
                                        
                                        
                                        
                                        
                                        
                                        If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                        Else
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                        End If
                                        
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                        GoTo Abort_Tran
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
                                        
                                        'データ送信
                                                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 2
                                                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                                    
                                        '-----------------------------------------------ヘッダー
                                
                                        Call Wel_Head_Print_Text_Proc(fileName)
                                    
                                        Sendbuf = Text_Create_Proc()
                                        
                                    
                                        Inspe_Proc_LOGISTIC = False
                                        Exit Function
                                    
                                    End If
                                End If
            ''' 荷札処置
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------aaa------------------------------------４行目
                                
'口数INPUT ２
                                wkKONPO_F = ""
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                    
                                        wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                        Exit For
                                    End If
                                Next j
                                
                                If wkKONPO_F = "1" Then
                                                        
                                    If Inspection_Input Then
                                        KUTI_SU_INPUT_F = False
                                    Else
                                        KUTI_SU_INPUT_F = True
                                    End If
                                
                                
                                    TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                    TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                            
                                Else
                                    TOTAL_KUTI_SU = 1
                                    KUTI_SU_INPUT_F = True
                                    TOTAL_SAI_SU = 0#
                                End If
                                            
                                            
                                            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                            
                                            
                                If KUTI_SU_INPUT_F Then
                                
                                    Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                
                                
                                Else
                                    Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                
                                    If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                                
                                
                                
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                        
                        End Select
                    
                Case "3"
                    '混在
            
                    
                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
            
            
                    Select Case (KONPOU_ON - KONPOU_ON_SUMI)
            
                        Case 0
                            '口数へ
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------aaa------------------------------------４行目
'口数input ３
                            wkKONPO_F = ""
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                
                                    wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                    Exit For
                                End If
                            Next j
                            
                            If wkKONPO_F = "1" Then
                                                    
                                If Inspection_Input Then
                                    KUTI_SU_INPUT_F = False
                                Else
                                    KUTI_SU_INPUT_F = True
                                End If
                            
                            
                                TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                        
                            Else
                                TOTAL_KUTI_SU = 1
                                KUTI_SU_INPUT_F = True
                                TOTAL_SAI_SU = 0#
                            End If
                                        
                                        
                                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                            End If
                                        
                                        
                            If KUTI_SU_INPUT_F Then
                            
                                Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                            
                            
                            Else
                                Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                            
                                
                                If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                            
                            
                            
                            End If
                        
                        
                            Sendbuf = Text_Create_Proc()
                        
                        
                        
                        
                        
                        Case Else
                            '品番へ
            
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    End Select
            
            End Select
                    
                    
                    
                    
        Case Step_Sagyo5_RES        '５回目の受信（口数）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Left(Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)), 6)
                    '口数
                    Case LCD_KUTI_SU_S
                
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU < 0 Then
                        
                
                
                
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                            
                            End If
                    
                            KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If KUTI_SU < 1 Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                            End If
                        Else
                            KUTI_SU = ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU
                        End If
                    
                    
                    
                    '才数
                    Case LCD_SAI_SU_S
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU < 0 Then
                        
                        
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                            
                            End If
                    
                            SAI_SU = CDbl(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If SAI_SU <= 0 Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                            End If
                        Else
                            SAI_SU = ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU
                        
                            If SAI_SU < 1 Then
                                SAI_SU = 1
                            Else
                                If SAI_SU > 1 Then
                                    SAI_SU = CLng(ToHalfAdjust(CCur(SAI_SU), 0))
                                End If
                            End If
                        
                        
                        End If
                    
                        '送り状最大印刷枚数獲得 2010.01.21
                            
                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                
                                    If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                
                                
                                Else
                                
                                    If Label_Print_Total_Su_Proc(0, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                End If
                            End If
                        Next j
                                        
                            
                            
                            
                        
'                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
'
'                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            Exit Function
'                        End If
                    
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                            Else
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU <= 1 Then
                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                    End If
                                
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                                
                                End If
                            End If
                        Next j
                        
                        
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        Inspe_Proc_LOGISTIC = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                
                                
                                
                                
                                
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                    'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                    If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                        If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                        End If
                                    Else
'''''''                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                        
                                        
                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                                                            
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                    
                                Else
                                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                        
                                        'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                        If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                            If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                            Else
                                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                            End If
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                                                                
                                        End If
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                
                                End If
                                                    
                                
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_LOGISTIC = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                

'                        Call Syuka_KUTI_SU_Count_Proc(TOTAL_KUTI_SU)

        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                   
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                
                                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                    'ID№
                                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
                
                                Do
                                
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                            
                                Loop
                                
                                
                                
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                                
                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_LOGISTIC = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                

''' 品番単位での丸め処理
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
''' 品番単位での丸め処理

                            
'                        PRINT_OFF = False
'
'                        If KONPOU_OFF = KONPOU_OFF_SUMI Then
'
'                            PRINT_OFF = True
'
'                        End If

                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 0 Then
                            ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                        End If


                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                            Not LOGIXTICS_F Then
                            If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                PRINT_OFF = True
                            End If
                        End If



                        PRINT_MAISU = KUTI_SU
                                                
                                                
                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1

                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU


                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                                    Not LOGIXTICS_F) Then
                            PRINT_MAISU = PRINT_MAISU - 1
                            If PRINT_MAISU < 1 Then
                                
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    
                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        
                                                        '枝番更新   2010.02.15
                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                
                                                GoTo Abort_Tran
                                            End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                        
                                        End If
                                    Else
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                            
                        
                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
                                                    
                                                    
                                                    GoTo Abort_Tran
                                                
                                                End If
                                            
                                            
                                            End If
                                                                
                                        End If
                                    End If
                                Next j
                                
                                
                                
                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                
                                
                                
                                
                                PRINT_OFF = True
                            Else
'                                PRINT_MAISU = PRINT_MAISU - 1
                                Start_Page_No = Start_Page_No + 1
                            
                            End If
                        End If

''' 荷札処置
                        If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                            ID_KANRI_TBL(ING_No).LABEL_ON = False
                        Else
                                
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            
                            PRINT_OFF = False
                            
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                    
                                    
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                        
                                            PRINT_OFF = True
                                        Else
                                    
                                        End If
                                    End If
                                End If
                            Next j
                                
                            If Not PRINT_OFF Then
                                
                                If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                End If
                            
                            
                            
                            
                                '枝番更新   2010.02.15
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
                                                    
                                                    GoTo Abort_Tran
                                                
                                                
                                                End If
                        
                                            Else
                        
                        
                                                        '枝番更新   2010.02.15
                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                    
                                                    GoTo Abort_Tran
                                                
                                                
                                                End If
                                                        
                                            End If
                                                        
                                                        '枝番更新   2010.02.15
                        
                        
                        
                        
                        
                                        End If
                                    Else
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                            
                        
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU - 1, "000")) Then
                                                        
                                                        GoTo Abort_Tran
                                                    End If
                                                Else
                                                
                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
                                                        
                                                        GoTo Abort_Tran
                                                    End If
                                                
                                                                        
                                                
                                                End If
                                            End If
                                        End If
                                    End If
                                Next j
                                '枝番更新   2010.02.15
                            
                            
                            
'                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU
                                
                                If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                Else
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                End If
                                
'                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'
'                                            If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                GoTo Abort_Tran
'                                            End If
'
'                                        End If
'                                    End If
'                                Next j
                            
                                ID_KANRI_TBL(ING_No).LABEL_STEP = 9
                                
                                'データ送信
                                                            
                                ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                            
                                ID_KANRI_TBL(ING_No).LABEL_ON = True
                            
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Print_Text_Proc(fileName)
                                '-----------------------------------------------ボディ
                                Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
                            
                                Sendbuf = Text_Create_Proc()
                            
                                Inspe_Proc_LOGISTIC = False
                                Exit Function
                            
                            End If

''' 荷札処置
                        End If

                        KENPIN_END = True
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                            
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                    KENPIN_END = False
                                    Exit For
                                End If
                            End If
                        Next j



                        Select Case KENPIN_END
                    
                            Case True
    
                            '次の作業要求

                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                                            
                                            
                                            
                                            
                                            
                    
                    
                            Case Else
                    
    ''''''''''''''''''''''''''''''''''''''''''''''
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                
                                 '-----------------------------------------------３行目
                                Call Wel_HIN_NO_Req_Text_3_Proc
                                '-----------------------------------------------４行目
                                Call Wel_HIN_NO_Req_Text_4_Proc
                               
'                                '-----------------------------------------------３行目
'                                                                                        'BOX属性
'                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                                                                                        '表示内容
'
'                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'
'
'                                                                                        '数値初期表示
'                                Send_Text.Box_Type(2).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'
'　                                                                                      '初期カーソル位置
'                                Send_Text.Box_Type(2).Start_Pos = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'                                                                                        '入力桁数
'                                Send_Text.Box_Type(2).Max_Size = "00"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'
'                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
'                                '-----------------------------------------------４行目
'                                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                                                                                        '表示内容
'                                                                                    '表示内容
'                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                                                                                        '数値初期表示
'                                Send_Text.Box_Type(3).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
'                                                                                        '初期カーソル位置
'                                Send_Text.Box_Type(3).Start_Pos = "01"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
'                                                                                        '入力桁数
'                                Send_Text.Box_Type(3).Max_Size = "13"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
'
'                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                    
                        End Select
                    
                    End Select
                
            Next i
        

        Case Step_PRINT_RES        '印刷終了
    
    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    
            '-----------------------------------------------ヘッダー
            Call Wel_Head_Text_Proc
    
            Select Case ID_KANRI_TBL(ING_No).LABEL_STEP
                Case 1      '品番へ
                                                                            
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                                                            
                    '-----------------------------------------------ヘッダー 02.24
                    Call Wel_Head_Text_Proc
                                                                            
                    '-----------------------------------------------１行目
                    Call Wel_DETAIL_0_Text_Proc
                    '-----------------------------------------------２行目
                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                    '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                            
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '-----------------------------------------------４行目
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                            '表示内容
                                                                        '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                            '入力桁数
                    '2010.12.07
'                    Send_Text.Box_Type(3).Max_Size = "13"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                    Send_Text.Box_Type(3).Max_Size = "20"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                    '2010.12.07
                                                                            
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                    Call Wel_Clear_Text_Proc

                    Sendbuf = Text_Create_Proc()
                
                Case 2      '口数へ
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    '-----------------------------------------------ヘッダー
                    Call Wel_Head_Text_Proc
                    
                    '-----------------------------------------------１行目
                    Call Wel_DETAIL_0_Text_Proc
                    '-----------------------------------------------２行目
                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                    
                    '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    
                    
                    '-----------------------------------------------４行目
'口数　４
                    wkKONPO_F = ""
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                    
                        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                        
                            wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                            Exit For
                        End If
                    Next j
                    
                    If wkKONPO_F = "1" Then
                                            
                        If Inspection_Input Then
                            KUTI_SU_INPUT_F = False
                        Else
                            KUTI_SU_INPUT_F = True
                        End If
                    
                    
                        TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                        TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                
                    Else
                        TOTAL_KUTI_SU = 1
                        KUTI_SU_INPUT_F = True
                        TOTAL_SAI_SU = 0#
                    End If
                                
                                
                                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                    End If
                                
                                
                    If KUTI_SU_INPUT_F Then
                    
                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                    
                    
                    Else
                        Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                    
                        
                        If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                    
                    
                    
                    End If
                    
                    Sendbuf = Text_Create_Proc()
                
                Case 9
        
                    Select Case (Y_SYU_CNT - Sumi_CNT)
                
                        Case 0
                
                            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                            Select Case sts
                                Case BtNoErr
                                '   -------------------------------- エラーメッセージ作成
                                Case Else
                                '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                            End Select
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                            
                            Sendbuf = Text_Create_Proc()
            
            
                        Case Else
                        
        ''''''''''''''''''''''''''''''''''''''''''''''
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                            Call Wel_HIN_NO_Req_Text_3_Proc
                            '-----------------------------------------------４行目
                            Call Wel_HIN_NO_Req_Text_4_Proc
                            '-----------------------------------------------５行目
                            Call Wel_Clear_Text_Proc
        
                            Sendbuf = Text_Create_Proc()
        
            
                End Select
            End Select
    
    End Select
                    
                    

    Inspe_Proc_LOGISTIC = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
















Private Function Inspe_Proc_E_BAG(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（宅配伝票読み込み 大阪ＰＣ向け）ｲｰﾊﾞｯｸ対応』
'
'       2010.01.21
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Integer
Dim UNSOU_KAISHA    As String
Dim SURYO           As String


Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag


Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2


Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean


Dim OKURI_NO_F      As Boolean

Dim FUKUYAMA_CHK_F  As Boolean

    Inspe_Proc_E_BAG = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                                        
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F)
                        
                        
                        
                        
                        '他端末で使用中 2011.04.07
                        If sts = SYS_CANCEL Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG = False
                            Exit Function
                        End If
                        '他端末で使用中 2011.04.07
                        
                        
                        
                        
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            Next j
                                                     
                                                     
                            If CANCEL_F Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG = False
                                Exit Function
                            End If
                        End If
                        
                        
                        
                        If Y_SYU_CNT = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG = False
                            Exit Function
                        End If
                                                 
                                                 
                                                 
                                                 
                                                 
                                                 
                        If Sumi_CNT = Y_SYU_CNT Then
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品処理済！", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG = False
                            Exit Function
                        
                        End If
                                                 
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                        
                        Next j
                        
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_SAKI)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_SAKI)
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                                            
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                        Else
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                        End If
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
    
    
    
                End Select
            Next i
        
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状№）
                
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状№
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                    
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else
                        
'2009.10.14                         If Len(OKURI_NO) < 11 Or Len(OKURI_NO) > 13 Then
'                        If Len(OKURI_NO) < 10 Or Len(OKURI_NO) > 13 Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                            Inspe_Proc_E_BAG = False
'                            Exit Function
'                        End If
                    
                            If Not IsNumeric(OKURI_NO) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG = False
                                Exit Function
                            End If
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            
                            
                            
                            
                            If Not OKURI_NO_F Then
                            
                        
                        
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG = False
                                Exit Function
                                                
                            End If
                        
                        
                            '2090.04.28
                            If FUKUYAMA_CHK_F Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG = False
                                Exit Function
                            
                            End If
                            '2090.04.28
                        
                        
                        
    '                        Select Case Len(Trim(OKURI_NO))
    '
    '                            Case FUKUYAMA_Length
    '                            Case SEIBU_Length
    '                            Case KURUME_Length
    '
    '                                For k = 0 To UBound(KURUME_CODE)
    '
    '                                    If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
    '                                        Exit For
    '                                    End If
    '                                Next k
    '
    '                                If k > UBound(KURUME_CODE) Then
    '
    '
    '                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
    '
    '                                    Sendbuf = Text_Create_Proc()
    '                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
    '                                    Inspe_Proc_E_BAG = False
    '                                    Exit Function
    '
    '                                End If
    '
    '                            Case SAGAWA_Length, YAMATO_Length
    '
    '                                For k = 0 To UBound(KURUME_CODE)
    '
    '                                    If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
    '                                        Exit For
    '                                    End If
    '                                Next k
    '
    '                                If k > UBound(SAGAWA_CODE) Then
    '
    '                                    For k = 0 To UBound(YAMATO_CODE)
    '
    '                                        If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
    '                                            Exit For
    '                                        End If
    '
    '                                    Next k
    '
    '                                    If k > UBound(YAMATO_CODE) Then
    '
    '                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
    '
    '                                        Sendbuf = Text_Create_Proc()
    '                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
    '                                        Inspe_Proc_E_BAG = False
    '                                        Exit Function
    '
    '
    '
    '                                    End If
    '
    '                                End If
    '
    '
    '                        End Select
                        End If
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                                            
'                                '運送会社変換
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, 3) = UNSOU_KAISHA_CODE Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, UNSOU_KAISHA_NAME)
'                                End If
'                                '新運送会社変換 2007.01.09
'
'                                If KURUME_F Then        '久留米
'                                    For k = 1 To UBound(KURUME)
'
'                                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(KURUME(k))) = KURUME(k) Then
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME(0))
'                                            Exit For
'                                        End If
'                                    Next k
'                                End If
'
'                                If FUKUYAMA_F Then      '福山
'                                    For k = 1 To UBound(FUKUYAMA)
'
'                                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(FUKUYAMA(k))) = FUKUYAMA(k) Then
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA(0))
'                                            Exit For
'                                        End If
'                                    Next k
'                                End If
'
'                                If SAGAWA_F Then        '佐川
'                                    For k = 1 To UBound(SAGAWA)
'
'                                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(SAGAWA(k))) = SAGAWA(k) Then
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA(0))
'                                            Exit For
'                                        End If
'                                    Next k
'                                End If
                                                    
                                                    
                                                    
'                                Select Case Len(Trim(OKURI_NO))
'
'                                    Case FUKUYAMA_Length
'                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
'                                    Case SEIBU_Length
'                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
'
'                                    Case KURUME_Length
'
'                                        For k = 0 To UBound(KURUME_CODE)
'
'                                            If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
'                                                Exit For
'                                            End If
'                                        Next k
'
'                                        If k > UBound(KURUME_CODE) Then
'                                        Else
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
'                                        End If
'
'                                    Case SAGAWA_Length, YAMATO_Length
'
'                                        For k = 0 To UBound(KURUME_CODE)
'
'                                            If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
'                                                Exit For
'                                            End If
'                                        Next k
'
'                                        If k > UBound(SAGAWA_CODE) Then
'
'                                            For k = 0 To UBound(YAMATO_CODE)
'
'                                                If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
'                                                    Exit For
'                                                End If
'
'                                            Next k
'
'                                            If k > UBound(YAMATO_CODE) Then
'                                            Else
'
'                                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
'                                            End If
'
'                                        Else
'                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
'                                        End If
'
'
'                                End Select
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                '物流 2010.02.19
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_CHARTER_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "物流")
'                                End If
'
'                                '赤帽 2010.02.19
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_AKABOU_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "赤帽")
'                                End If
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_E_BAG = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                
                                                                                
                        Sumi_CNT = 0
                        Y_SYU_CNT = 0
                                                                                

''' 品番単位での丸め処理
                        FAST_F = True
                                                                                                    
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            Else
                                If FAST_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                        Sumi_CNT = Sumi_CNT + 1
                                    End If
                                    FAST_F = False
                                
                                Else
                                    For k = 0 To j - 1
                                        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                                Exit For
                                            End If
                                        End If
                                    Next k
                            
                                    If k > j - 1 Then
                            
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                            Sumi_CNT = Sumi_CNT + 1
                                        End If
                                    End If
                                End If
                            End If
                        Next j
''' 品番単位での丸め処理
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
'                        Send_Text.Box_Type(3).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                
                
                
                
                
                End Select
                
                
                
            Next i
        
        
        
        
        
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            For i = 0 To M_Gyo - 1
            
                
                '2010.12.07
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                '2010.12.07
                    
                    Case LCD_Hinban     '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG = False
                            Exit Function
                        End If
                        
                        
                        'ｷｬﾝｾﾙのﾁｪｯｸ
                        CANCEL_F = True
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            End If
                        Next j
                        
                        If CANCEL_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "キャンセル品番です。", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG = False
                            Exit Function
                        
                        
                        End If
                        
                        
                        
                                
                        '検品済みのﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "検品済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG = False
                            Exit Function
                        End If
                
                        '未出庫のﾁｪｯｸ   2007.05.14
                        If Inspection_Flg = 0 Then
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN <> KAN_KBN_FIN Then
                                        Exit For
                                    End If
                                End If
                            Next j
                                            
                            If j <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG = False
                                Exit Function
                            End If
                        End If
                        '未出庫のﾁｪｯｸ   2007.05.14
                
                
                
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                
                                                                                
                        Sumi_CNT = 0
                        Y_SYU_CNT = 0
                                                                                

''' 品番単位での丸め処理
                        FAST_F = True
                                                                                                    
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            Else
                                If FAST_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                        Sumi_CNT = Sumi_CNT + 1
                                    End If
                                    FAST_F = False
                                
                                Else
                                    For k = 0 To j - 1
                                        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                                Exit For
                                            End If
                                        End If
                                    Next k
                            
                                    If k > j - 1 Then
                            
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                            Sumi_CNT = Sumi_CNT + 1
                                        End If
                                    End If
                                End If
                            End If
                        Next j
''' 品番単位での丸め処理


                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        
                        
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        Else
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                        End If
                        
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                                                                                
                                                                                
                                                                                '表示内容
                        
                        If Y_SYU_CNT < 2 Then
                        

                            If Inspection_QTY = 1 Then

                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
                            End If
                                                                                
                                                                                
                        Else
                        
                            If Inspection_QTY = 1 Then
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
                            End If
                        
                        End If
                                                                                
                                                                                '数値初期表示
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                        Else
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                        End If
                                                                                
                                                                                
                                                                                '初期カーソル位置
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                        Else
                            Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                        End If
                                                                                
                                                                                '入力桁数
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Else
                            Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                        End If
                                                                                
                                                                                
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                                                                
                        End If
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        
                        
                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        
                
        Case Step_Sagyo4_RES        '４回目の受信（検品数　受信）
            
            
            
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case RTrim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), _
                                Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    Case LCD_Syuka_Su1, LCD_Syuka_Su2   '出荷数(検品数)
                        SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        If Not IsNumeric(SURYO) Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG = False
                            Exit Function
                        
                        End If
                
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                
                
                
                        If CLng(SURYO) <> SYUKA_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷数エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
            
            
            
            
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        
                        
                        
                        '------------------------------------   出荷予定の処理
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID№
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG = False
                                    GoTo Abort_Tran
                                 Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
        
                    '''他行の使用を継続するため
                    '''Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                    '''Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                    
                    
                    
                                
                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                        Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                
                                                
                                                    '出荷予定書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                    Inspe_Proc_E_BAG = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                        
                        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID№
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG = False
                                    GoTo Abort_Tran
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                                            
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                        Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
'                        '運送会社変換
'                        If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, 3) = UNSOU_KAISHA_CODE Then
'                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, UNSOU_KAISHA_NAME)
'                        End If
'                        '新運送会社変換 2007.01.09
'
'                        If KURUME_F Then        '久留米
'                            For k = 1 To UBound(KURUME)
'
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(KURUME(k))) = KURUME(k) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME(0))
'                                    Exit For
'                                End If
'                            Next k
'                        End If
'
'                        If FUKUYAMA_F Then      '福山
'                            For k = 1 To UBound(FUKUYAMA)
'
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(FUKUYAMA(k))) = FUKUYAMA(k) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA(0))
'                                    Exit For
'                                End If
'                            Next k
'                        End If
'
'                        If SAGAWA_F Then        '佐川
'                            For k = 1 To UBound(SAGAWA)
'
'                                If Left(ID_KANRI_TBL(ING_No).KEN_OKURI_NO, Len(SAGAWA(k))) = SAGAWA(k) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA(0))
'                                    Exit For
'                                End If
'                            Next k
'                        End If
                                            
                                            
                                            
                                            
                                            
                        Select Case Len(Trim(OKURI_NO))
                        
                            Case FUKUYAMA_Length
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
                            Case SEIBU_Length
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
                        
                            Case KURUME_Length
                        
                                For k = 0 To UBound(KURUME_CODE)
                                
                                    If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
                                        Exit For
                                    End If
                                Next k
                        
                                If k > UBound(KURUME_CODE) Then
                                Else
                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
                                End If
                        
                            Case SAGAWA_Length, YAMATO_Length
                        
                                For k = 0 To UBound(KURUME_CODE)
                                
                                    If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
                                        Exit For
                                    End If
                                Next k
                        
                                If k > UBound(SAGAWA_CODE) Then
                                
                                    For k = 0 To UBound(YAMATO_CODE)
                                    
                                        If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
                                            Exit For
                                        End If
                                    
                                    Next k
                                 
                                    If k > UBound(YAMATO_CODE) Then
                                    Else
                                
                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
                                    End If
                                
                                Else
                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
                                End If
                        
                        
                        End Select
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                        '物流 2010.02.19
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_CHARTER_CD) Then
                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "物流")
                        End If
                        
                        '赤帽 2010.02.19
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_AKABOU_CD) Then
                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "赤帽")
                        End If
                                                                    
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Inspe_Proc_E_BAG = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                                            
                                            
                        '------------------------------------   在庫移動履歴の処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                            MENU_NO = ""
                        End If
                                            
                        '履歴出力の為の読み込み
                        Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                        Call UniCode_Conv(K0_MTS.SS_CODE, "")
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                                Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                            
                                            
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    CYU_KBN_SPO, _
                                                    Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状№:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                                    , , , , MENU_NO, _
                                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_E_BAG = SYS_ERR
                                GoTo Abort_Tran
                        End Select
                                            
                        '検品済！！
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = True
                                            
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
                                        
                    End If
                End If
            
            Next j
                                
                                
                                
                                
                                
            '作業ﾛｸﾞ出力    2009.04.17
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO) Then
                    Inspe_Proc_E_BAG = SYS_ERR
                    Exit Function
                End If
            End If
            '作業ﾛｸﾞ出力    2009.04.17
                                
                                
                                
                                
                                
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
        
                    
            KENPIN_END = True
            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                
                                                
                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                        KENPIN_END = False
                        Exit For
                    End If
                End If
            Next j
        
            Sumi_CNT = 0
            Y_SYU_CNT = 0
                                                                                
''' 品番単位での丸め処理
            FAST_F = True
                                                                                        
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
            
            
                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                Else
                    If FAST_F Then
                    
                        Y_SYU_CNT = Y_SYU_CNT + 1
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            Sumi_CNT = Sumi_CNT + 1
                        End If
                        FAST_F = False
                    
                    Else
                        For k = 0 To j - 1
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                    Exit For
                                End If
                            End If
                        Next k
                
                        If k > j - 1 Then
                
                            Y_SYU_CNT = Y_SYU_CNT + 1
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                Sumi_CNT = Sumi_CNT + 1
                            End If
                        End If
                    End If
                End If
            Next j
''' 品番単位での丸め処理
                                                                                
                                                                                
                                                                                
        
        
        
            Select Case KENPIN_END
                Case False
                    '検品残あり、品番へ
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    '-----------------------------------------------ヘッダー
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                    Send_Text.fileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
            
                    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                    
                    '-----------------------------------------------１行目
                                                                            'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                            'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            
                                                                            

                                                                            
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                            
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '-----------------------------------------------４行目
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                            '入力桁数
                    '2010.12.07
'                    Send_Text.Box_Type(3).Max_Size = "13"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                    Send_Text.Box_Type(3).Max_Size = "20"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                    '2010.12.07
                                                                            
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                                                                            'BOX属性
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                     Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                    Sendbuf = Text_Create_Proc()
                Case True
                    '検品完了、口数へ
            
            
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    
                    
                    '-----------------------------------------------ヘッダー
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                    Send_Text.fileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
            
                    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                    
                    '-----------------------------------------------１行目
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                            'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            
                                                                            
                                                                            
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    
                    
                    
                    '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    
                    
                    '-----------------------------------------------４行目
                                                                            'BOX属性
                    Send_Text.Box_Type(3).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    
                    
                    '-----------------------------------------------５行目
                    KUTI_SU = 1
                                
                    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_KUTI_SU)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_KUTI_SU)
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = Space(9) & "1"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(9) & "1"
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = "07"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "07"
                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "04"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "04"
                    
                    
                    
                    Sendbuf = Text_Create_Proc()
            
            
            
            
            
            
            
            End Select
            
                
                
                
                
        Case Step_Sagyo5_RES        '５回目の受信（口数）
                
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    
                    '口数
                    Case LCD_KUTI_SU
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG = False
                            Exit Function
                        
                        End If
                
                        KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If KUTI_SU < 1 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG = False
                            Exit Function
                        End If
                
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        Inspe_Proc_E_BAG = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                            
                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                            
                                                            
                                                            
                                                            
                                                            
                                Call UniCode_Conv(Y_SYU_HREC.JURYO, "0002.0")
                                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, "01.00")
                                                            
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_E_BAG = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                
                                        '次の作業要求
            
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
                
                
                
                
                
            Next i
                
                
                
                
    
    
    End Select

    Inspe_Proc_E_BAG = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Private Function Inspe_Proc_E_BAG_ALL(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（宅配伝票読み込み 大阪ＰＣ向け）ｲｰﾊﾞｯｸ対応』
'
'       2010.01.21
'       2012.06.20      全数検品対応
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Integer
Dim UNSOU_KAISHA    As String
Dim SURYO           As String


Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag


Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1

Dim KONPOU_ON       As Integer
Dim KONPOU_ON_SUMI  As Integer
Dim KONPOU_OFF      As Integer
Dim KONPOU_OFF_SUMI As Integer




Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2


Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean


Dim OKURI_NO_F      As Boolean

Dim FUKUYAMA_CHK_F  As Boolean

    
Dim Cnt_F               As Boolean  '2012.06.20
Dim Print_bara_F        As Boolean  '2012.06.20

Dim Hin_Total           As Long     '2012.06.20
    
Dim KEN_HINBAN          As String * 20      '2012.10.02
    
    
    Inspe_Proc_E_BAG_ALL = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                        '2012.10.02　KEN_HINBAN追加
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, , , , , , , , , , , _
                                                KEN_HINBAN)
                        
                        
                        
                        
                        '他端末で使用中 2011.04.07
                        If sts = SYS_CANCEL Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                        '他端末で使用中 2011.04.07
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            Next j
                                                     
                                                     
                            If CANCEL_F Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            End If
                        End If
                        
                        
                        
                        If Y_SYU_CNT = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                        
                        If Sumi_CNT = Y_SYU_CNT Then
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "検品処理済！", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        
                        End If
                                                 
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = Y_SYU_TBL(j).CNT_BARA_SU      '検品実績　バラ
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = Y_SYU_TBL(j).CNT_HAKO_SU      '検品実績　箱
                            
                
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = Y_SYU_TBL(j).Y_HIN_CHK_CNT  '品番読込み回数
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = Y_SYU_TBL(j).J_HIN_CHK_CNT  '品番読込み済み回数

'2012.11.15                            ID_KANRI_TBL(ING_No).KEN_HINBAN = KEN_HINBAN
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                        
                        Next j
                        
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                '2012.11.15
                        ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = KEN_HINBAN    '2012.11.15
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                         '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                                            
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                        Else
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                        End If
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
    
    
    
                End Select
            Next i
        
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状№）
                
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状№
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                    
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else
                        
                    
                            If Not IsNumeric(OKURI_NO) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            End If
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            
                            
                            
                            
                            If Not OKURI_NO_F Then
                            
                        
                        
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                                                
                            End If
                        
                        
                            '2090.04.28
                            If FUKUYAMA_CHK_F Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            
                            End If
                            '2090.04.28
                        
                        
                        
                        End If
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                                            
                                '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_E_BAG_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                
                                                                                
                        Sumi_CNT = 0
                        Y_SYU_CNT = 0
                                                                                

                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                '表示内容
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
'                        Send_Text.Box_Type(3).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                
                
                
                
                
                End Select
                
                
                
            Next i
        
        
        
        
        
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            For i = 0 To M_Gyo - 1
            
                
                '2010.12.07
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                '2010.12.07
                    
                    Case LCD_Hinban, "出荷"   '品番/出荷数（品番）
                        If Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = "出荷" Then
                            Cnt_F = True
                        Else
                            ID_KANRI_TBL(ING_No).LAST_START_PAGE = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1 '2012.04.01
                        End If
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                        
                        
                        'ｷｬﾝｾﾙのﾁｪｯｸ
                        CANCEL_F = True
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            End If
                        Next j
                        
                        If CANCEL_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "キャンセル品番です。", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        
                        
                        End If
                        
                        
                        
                                
                        '検品済みのﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "検品済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                
                        '未出庫のﾁｪｯｸ   2007.05.14
                        If Inspection_Flg = 0 Then
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KAN_KBN <> KAN_KBN_FIN Then
                                        Exit For
                                    End If
                                End If
                            Next k
                            '2012.09.24 j-->k
                            If k <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            End If
                        End If
                        '未出庫のﾁｪｯｸ   2007.05.14
                
                
                        '仕掛中品番のﾁｪｯｸ   2012.10.02-->2012.11.15 KEN_HINBAN-->KEN_ING_HINBAN
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) Then
                            If Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) <> "" Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "他品番検品中！", ID_KANRI_TBL(ING_No).KEN_ING_HINBAN)
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            End If
                        End If
                        '仕掛中品番のﾁｪｯｸ   2012.10.02
                
                
                
                        If Cnt_F Then
                        
                            If RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) <> RTrim(Hinban) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            End If
                        End If
                
                
                
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                
                
                
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.06.20  全数検品対応
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1
                            End If
                            Hin_Total = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If ID_KANRI_TBL(ING_No).KEN_HINBAN = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then                '2012.09.05
                                    
                                        Hin_Total = Hin_Total + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If                                                                  '2012.09.05
                                End If
                            Next k
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)) + _
                                                                                        (Hin_Total - _
                                                                                        ((CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY)
                            
                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1 Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = Hin_Total
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = CLng(ToRoundUp(CCur(Hin_Total Mod ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0))    '2012.04.09
                            End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            '
                            'If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 1
                            'Else
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            'End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                        
                        
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                        
                        End If
                        
                        If Cnt_F Then
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                                Print_bara_F = True
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                        
                        
                        End If


'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02
                        '----------------------------------- トランザクション開始 -----------
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If


                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
'2012.10.02                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
'2012.10.02
'2012.10.02                                '------------------------------------   出荷予定の処理
'2012.10.02                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
'2012.10.02
'2012.10.02
'2012.10.02                                Do
'2012.10.02
'2012.10.02                                    sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.10.02                                    Select Case sts
'2012.10.02                                        Case BtNoErr
'2012.10.02                                            Exit Do
'2012.10.02                                        Case BtErrKeyNotFound
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_E_BAG_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_E_BAG_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                        Case Else
'2012.10.02                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
'2012.10.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                    End Select
'2012.10.02
'2012.10.02                                Loop
'2012.10.02
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
'2012.10.02
'2012.10.02
'2012.10.02
'2012.10.02                                Do
'2012.10.02
'2012.10.02                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.10.02                                    Select Case sts
'2012.10.02                                        Case BtNoErr
'2012.10.02                                            Exit Do
'2012.10.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_E_BAG_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                        Case Else
'2012.10.02                                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
'2012.10.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                    End Select
'2012.10.02
'2012.10.02                                Loop
'2012.10.02
'2012.10.02                            End If
'2012.10.02
'2012.10.02
                            '------------------------------------   出荷予定の処理  2012.10.02
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
                
                
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
    

                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
    
                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))

                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
                            End If
                        
                            Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, ID_KANRI_TBL(ING_No).KEN_HINBAN)

                        
                            Do
                            
                                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                        
                        '------------------------------------   出荷予定の処理  2012.10.02
                        Next k
                        
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            Exit Function
                        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02

'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.06.20  全数検品対応
                
                
                
                
                
                
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT Then
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    
                                                                                    
                        
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    
    
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                    "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                    "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            
                            
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            If Inspection_QTY = 1 Then
    
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            Else
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                            End If
                            
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)                       '2012.09.05 J-->k
                            
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                    
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If
                                End If
                            Next k
                                                                                    
                                                                                    
                                                                                    '表示内容
                            
                            If Y_SYU_CNT < 2 Then
    
                                '                               2012.09.05　DEL　▽
                                'If Inspection_QTY = 1 Then
                                '    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                                '    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                                'Else
                                '    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
                                '    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
                                'End If
                                '                               2012.09.05　DEL　△
                                
                                
                                '                               2012.09.05　INS　▽
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                '                               2012.09.05　INS　△
                                                   
                                                                                    
                            Else
                            
                                '                               2012.09.05　DEL　▽
'                                If Inspection_QTY = 1 Then
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                                '                               2012.09.05　DEL　△
                                
                                
                                '                               2012.09.05　INS　▽
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                '                               2012.09.05　INS　△
                            
                            End If
                                                                                    
                                                                                    '数値初期表示
                            If Inspection_QTY = 1 Then
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                            Else
                                Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                            End If
                                                                                    
                                                                                    
                                                                                    '初期カーソル位置
                            If Inspection_QTY = 1 Then
    
                                Send_Text.Box_Type(4).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                            Else
                                Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                            End If
                                                                                    
                                                                                    '入力桁数
                            If Inspection_QTY = 1 Then
                                Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                            Else
                                Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                            End If
                                                                                    
                                                                                    
                            '2009.04.15
                            If SYUKA_QTY > 1 Then
                                Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                            Else                                            '2012.11.15
                                ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""    '2012.11.15
                                                                                    
                            End If
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            
                            
                            Sendbuf = Text_Create_Proc()
                
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        Else
                
                
    '------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                
                                
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
        
        ''' 品番単位での丸め処理
                                
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
        ''' 品番単位での丸め処理
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                        'BOX属性

'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            
                            '-----------------------------------------------４行目
                                                                                        'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                       '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                        '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                        
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK                             '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK        '2007.04.21
                            
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                        
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then        '2012.09.05 j-->k
                                        
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                            SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If
                                End If
                            Next k
                                                                                    '表示内容
                            
                            If Y_SYU_CNT < 2 Then
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                                                                        
                            Else

                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                            End If
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                            Send_Text.Box_Type(4).Start_Pos = "01"                                              '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"                         '2007.04.21
                            Send_Text.Box_Type(4).Max_Size = "20"                                               '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"                          '2007.04.21
                            '2009.04.15
                            If SYUKA_QTY > 1 Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then        '2012.04.09
                                Else
                                    Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                End If                  '2012.04.09
                            End If
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            Sendbuf = Text_Create_Proc()
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
        
                
        Case Step_Sagyo4_RES        '４回目の受信（検品数　受信）
            
            
            
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case RTrim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), _
                                Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    Case LCD_Syuka_Su1, LCD_Syuka_Su2   '出荷数(検品数)
                        SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        If Not IsNumeric(SURYO) Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        
                        End If
                
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                
                
                
                        If CLng(SURYO) <> SYUKA_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷数エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
            
            
            
            ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""        '2012.11.15

            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        
                        
                        
                        '------------------------------------   出荷予定の処理
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID№
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                                 Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                        Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                
                                                
                                                    '出荷予定書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                    Inspe_Proc_E_BAG_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                        
                        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID№
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                                            
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                        Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                            
                                            
                                            
                                            
                                            
                        Select Case Len(Trim(OKURI_NO))
                        
                            Case FUKUYAMA_Length
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
                            Case SEIBU_Length
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
                        
                            Case KURUME_Length
                        
                                For k = 0 To UBound(KURUME_CODE)
                                
                                    If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
                                        Exit For
                                    End If
                                Next k
                        
                                If k > UBound(KURUME_CODE) Then
                                Else
                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
                                End If
                        
                            Case SAGAWA_Length, YAMATO_Length
                        
                                For k = 0 To UBound(KURUME_CODE)
                                
                                    If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
                                        Exit For
                                    End If
                                Next k
                        
                                If k > UBound(SAGAWA_CODE) Then
                                
                                    For k = 0 To UBound(YAMATO_CODE)
                                    
                                        If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
                                            Exit For
                                        End If
                                    
                                    Next k
                                 
                                    If k > UBound(YAMATO_CODE) Then
                                    Else
                                
                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
                                    End If
                                
                                Else
                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
                                End If
                        
                        
                        End Select
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                        '物流 2010.02.19
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_CHARTER_CD) Then
                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "物流")
                        End If
                        
                        '赤帽 2010.02.19
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_AKABOU_CD) Then
                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "赤帽")
                        End If
                                                                    
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
'2012.10.31                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Inspe_Proc_E_BAG_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                                            
                                            
                        '------------------------------------   在庫移動履歴の処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                            MENU_NO = ""
                        End If
                                            
                        '履歴出力の為の読み込み
                        Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                        Call UniCode_Conv(K0_MTS.SS_CODE, "")
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                                Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                            
                                            
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    CYU_KBN_SPO, _
                                                    Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状№:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                                    , , , , MENU_NO, _
                                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_E_BAG_ALL = SYS_ERR
                                GoTo Abort_Tran
                        End Select
                                            
                        '検品済！！
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = True
                                            
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
                                        
                    End If
                
                
                '--------------------   2012.10.02  ▽
                Else
                
                    Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID№
    
                    Do
                    
                        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                GoTo Abort_Tran
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                GoTo Abort_Tran
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                
                    Loop
                
                
                    Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
''''''''''''                    ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                                '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                    Do
                        sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                GoTo Abort_Tran
                        
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Inspe_Proc_E_BAG_ALL = SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                
                '--------------------   2012.10.02  △
                
                
                End If
            
            Next j
                                
                                
'2012.11.15            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.31
                                
                                
                                
            '作業ﾛｸﾞ出力    2009.04.17
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO) Then
                    Inspe_Proc_E_BAG_ALL = SYS_ERR
                    Exit Function
                End If
            End If
            '作業ﾛｸﾞ出力    2009.04.17
                                
                                
                                
                                
                                
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
        
                    
            KENPIN_END = True
            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                
                                                
                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                        KENPIN_END = False
                        Exit For
                    End If
                End If
            Next j
        ''' 品番単位での丸め処理
                                
                '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
        ''' 品番単位での丸め処理
            Select Case KENPIN_END
                Case False
                    '検品残あり、品番へ
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    '-----------------------------------------------ヘッダー
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                    Send_Text.fileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
            
                    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                    
                    '-----------------------------------------------１行目
                                                                            'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                            'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            
                                                                            

                                                                            
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    '-----------------------------------------------３行目
                                                                            'BOX属性
'2012.11.15                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                            '表示内容
'2012.11.15                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                            '数値初期表示
'2012.11.15                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                            '初期カーソル位置
'2012.11.15                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                            '入力桁数
'2012.11.15                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '2012.11.15
                    Call Wel_OKURI_SAKI_PROC

                    '-----------------------------------------------４行目
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                            '入力桁数
                    '2010.12.07
'                    Send_Text.Box_Type(3).Max_Size = "13"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                    Send_Text.Box_Type(3).Max_Size = "20"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                    '2010.12.07
                                                                            
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                                                                            'BOX属性
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                     Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                    Sendbuf = Text_Create_Proc()
                Case True
                    '検品完了、口数へ
            
            
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    
                    
                    '-----------------------------------------------ヘッダー
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                    Send_Text.fileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
            
                    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                    
                    '-----------------------------------------------１行目
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                            'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            
                                                                            
                                                                            
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    
                    
                    
                    '-----------------------------------------------３行目
                                                                            'BOX属性
'2012.11.15                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                            '表示内容
'2012.11.15
'2012.11.15                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                            '数値初期表示
'2012.11.15                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                            '初期カーソル位置
'2012.11.15                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                            '入力桁数
'2012.11.15                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    
                    '2012.11.15
                    Call Wel_OKURI_SAKI_PROC
                    
                    '-----------------------------------------------４行目
                                                                            'BOX属性
                    Send_Text.Box_Type(3).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    
                    
                    '-----------------------------------------------５行目
                    KUTI_SU = 1
                                
                    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_KUTI_SU)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_KUTI_SU)
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = Space(9) & "1"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(9) & "1"
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = "07"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "07"
                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "04"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "04"
                    
                    
                    
                    Sendbuf = Text_Create_Proc()
            
            
            
            
            
            
            
            End Select
            
                
                
                
                
        Case Step_Sagyo5_RES        '５回目の受信（口数）
                
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    
                    '口数
                    Case LCD_KUTI_SU
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        
                        End If
                
                        KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If KUTI_SU < 1 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        Inspe_Proc_E_BAG_ALL = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                            
                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                            
                                                            
                                                            
                                                            
                                                            
                                Call UniCode_Conv(Y_SYU_HREC.JURYO, "0002.0")
                                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, "01.00")
                                                            
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_E_BAG_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                
                                        '次の作業要求
            
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
                
                
                
                
                
            Next i
                
                
                
                
    
    
    End Select

    Inspe_Proc_E_BAG_ALL = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function



Private Function LABEL_RePrint_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『荷札ラベル　再発行』
'
'       2010.01.21
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Long

Dim SAI_SU          As Double

Dim UNSOU_KAISHA    As String
 
Dim SYUKA_YMD       As String
Dim JYUSHO          As String
Dim BIKOU           As String

Dim SURYO           As String

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag

Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean

'2010.01.21
Dim KONPOU_ON           As Integer
Dim KONPOU_ON_SUMI      As Integer
Dim KONPOU_OFF          As Integer
Dim KONPOU_OFF_SUMI     As Integer
Dim PRINT_OFF           As Boolean
Dim Start_Page_No       As Long
Dim PRINT_TOTAL_SU      As Long
Dim PRINT_MAISU         As Long
Dim fileName            As String
Dim ID_SEQ              As Integer
Dim DISP_SAI_SU         As Double

Dim wkKUTI_SU           As String
Dim wkKONPO_F           As String * 1

Dim TOTAL_KUTI_SU       As Integer
Dim TOTAL_SAI_SU        As Double
Dim MUKE_NAME           As String
Dim OKURI_NO_MAX        As Integer
Dim KUTI_SU_INPUT_F     As Boolean


Dim S_PAGE              As Integer
Dim E_PAGE              As Integer

Dim Label_RePrint_Kuti_Su _
                        As Integer
Dim Label_RePrint_Sai_Su _
                        As Double



'2010.01.21

    LABEL_RePrint_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                                        
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, _
                                                SYUKA_YMD, _
                                                JYUSHO, _
                                                BIKOU, _
                                                Start_Page_No, _
                                                KUTI_SU, _
                                                MUKE_NAME, _
                                                OKURI_NO_MAX, _
                                                Label_RePrint_Kuti_Su, _
                                                Label_RePrint_Sai_Su)
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            Next j
                                                     
                            If CANCEL_F Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                LABEL_RePrint_Proc = False
                                Exit Function
                            End If
                        End If
                        
                        
                        If Y_SYU_CNT = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        End If
                                                 
'2012.03.06                        If Sumi_CNT <> Y_SYU_CNT Then
'2012.03.06
'2012.03.06                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品未処理！", "", "")
'2012.03.06                            Sendbuf = Text_Create_Proc()
'2012.03.06                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.03.06                            LABEL_RePrint_Proc = False
'2012.03.06                            Exit Function
'2012.03.06
'2012.03.06                        End If
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = Y_SYU_TBL(j).KONPOU_F        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_CND = Y_SYU_TBL(j).KONPOU_CND    '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).TOTAL_SU = Y_SYU_TBL(j).TOTAL_SU        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = Y_SYU_TBL(j).SAI_SU            '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = Y_SYU_TBL(j).KUTI_SU          '2010.01.21
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = Y_SYU_TBL(j).PRINT_SUMI    '2010.01.21
                        
                                                                                                        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ = Y_SYU_TBL(j).OKURI_NO_SEQ
                        
                        Next j
                        
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        '出荷日
                        ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = SYUKA_YMD
                        '住所
                        ID_KANRI_TBL(ING_No).KEN_JYUSHO = JYUSHO
                        
                        '備考
                        ID_KANRI_TBL(ING_No).KEN_BIKOU = BIKOU
                        '向け先
                        ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = MUKE_NAME
                        
                        '枝番
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO_MAX = OKURI_NO_MAX
                        
                        ID_KANRI_TBL(ING_No).Label_RePrint_Kuti_Su = Label_RePrint_Kuti_Su
                        ID_KANRI_TBL(ING_No).Label_RePrint_Sai_Su = Label_RePrint_Sai_Su
                        
                        
                        
                        'ﾗﾍﾞﾙ開始ページ№
                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                        
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                        
                    
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        
                        
                        
                        End If
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                        
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                                
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                                                    '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        If Inspection_Input Then
                            KUTI_SU_INPUT_F = False
                        Else
                            KUTI_SU_INPUT_F = True
                        End If
                        
                        TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).Label_RePrint_Kuti_Su
                        TOTAL_SAI_SU = ID_KANRI_TBL(ING_No).Label_RePrint_Sai_Su
                                            
                        If KUTI_SU_INPUT_F Then
                        
                            '-----------------------------------------------２行目
                        
                            wkKUTI_SU = Format(TOTAL_KUTI_SU, "#0")
                                        
                                        
                            Send_Text.Box_Type(1).Box_Type = TYPE_BCNUM
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCNUM
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_KUTI_SU_S)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_KUTI_SU_S)
                                                                            '数値初期表示
                            Send_Text.Box_Type(1).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = 13
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = 13
                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "04"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "04"
                            
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    
                            wkKUTI_SU = Format(TOTAL_SAI_SU, "#0.00")
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_SAI_SU_S)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_SAI_SU_S)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = 12
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = 12
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "05"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "05"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                
                        Else
                            '-----------------------------------------------２行目
                            wkKUTI_SU = Format(TOTAL_KUTI_SU, "#0")
                                        
                                        
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_KUTI_SU_S & wkKUTI_SU)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_KUTI_SU_S & wkKUTI_SU)
                                                                            '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "00"
                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = ""
                            
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    
                            wkKUTI_SU = Format(TOTAL_SAI_SU, "#0.00")
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_SAI_SU_S & wkKUTI_SU)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_SAI_SU_S & wkKUTI_SU)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "00"
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = ""
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        End If
                            
                            
                            
                        '-----------------------------------------------４行目
                                                                                
                        wkKUTI_SU = "1"
                                    
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_S_PAGE_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_S_PAGE_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = 13
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = 13
                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "03"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "03"
                        
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                            
                        '-----------------------------------------------５行目
                                                                                
                        wkKUTI_SU = Format(TOTAL_KUTI_SU, "#0")
                                    
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_E_PAGE_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_E_PAGE_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = 13
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = 13
                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "03"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "03"
                        
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            
                            
                        Sendbuf = Text_Create_Proc()
                        
                    End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（開始／終了）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Left(Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)), 6)
                    '開始
                    Case LCD_S_PAGE_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "開始エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        
                        End If
                    
                        S_PAGE = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If S_PAGE < 1 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "開始エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        End If
                    
                    
                    
                    '終了
                    Case LCD_E_PAGE_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "終了エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        
                        End If
                    
                        E_PAGE = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If E_PAGE < 1 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "終了エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        End If

                        If S_PAGE > E_PAGE Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "開始＞終了", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        End If


'2012.03.06                        If E_PAGE > ID_KANRI_TBL(ING_No).Label_RePrint_Kuti_Su Then
'2012.03.06                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "終了＞口", "", "")
'2012.03.06
'2012.03.06                            Sendbuf = Text_Create_Proc()
'2012.03.06                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.03.06                            LABEL_RePrint_Proc = False
'2012.03.06                            Exit Function
'2012.03.06                        End If




                        PRINT_MAISU = E_PAGE - S_PAGE + 1
                                                
                        Start_Page_No = S_PAGE
                                                            
                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).Label_RePrint_Kuti_Su
                                                            
                                                            
                        If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                        End If
                                
                                
                                    
                        'データ送信
                                                    
                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                    
                                                    
                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                    
                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                    
                        '-----------------------------------------------ヘッダー
                    
                        Call Wel_Head_Print_Text_Proc(fileName)
                    
                        Sendbuf = Text_Create_Proc()
                        
                    




                                            
                                            
                                            
                                                        
                End Select
            Next i

        Case Step_PRINT_RES        '印刷終了
    
    
        '次の作業要求

            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
        
            
    
    End Select
                    
                    

    LABEL_RePrint_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function


Private Function Inspe_Proc_GAI(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（海外向け）』
'
'   2009.08.07
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8
Dim Hinban          As String * 20          '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07



Dim KAN_FLG         As String * 1

Dim i               As Integer

Dim DEN_ID_LOOP     As Integer      '2006.06.01
Dim DEN_ID_JGYOBU   As String * 1   '2006.06.01


Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim wkTEXT          As String


Dim wkKENPIN_YMD    As String * 8   '検品日付   2007.10.10


Dim wkNull_Check    As String       '2009.04.27

Dim LK_MUKE_CODE    As String * 8

    Inspe_Proc_GAI = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（向け先）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_MTS    '向け先
                                
                                
                                
                        Call UniCode_Conv(K2_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).Recv_text(i))
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K2_MTS, Len(K2_MTS), 2)
                        Select Case sts
                            Case BtNoErr
                                If Len(Trim(StrConv(MTSREC.SS_CODE, vbUnicode))) <> 0 Then
                                
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "出荷先エラー", "", "")
                
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Inspe_Proc_GAI = False
                                    Exit Function
                                
                                End If
                            
                            Case BtErrKeyNotFound
                            
                                Call UniCode_Conv(K3_MTS.SS_CODE, ID_KANRI_TBL(ING_No).Recv_text(i))
                                                    
                                sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K3_MTS, Len(K3_MTS), 3)
                                Select Case sts
                                    Case BtNoErr
                                    
                                    Case BtErrKeyNotFound
                                    
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "出荷先エラー", "", "")
                
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                        Inspe_Proc_GAI = False
                                        Exit Function
                                    
                                    Case Else
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "向け先管理マスタ", 0)
                                        Exit Function
                                End Select
                    
                        End Select
                         
                        MTS_CODE = (ID_KANRI_TBL(ING_No).Recv_text(i))
                        SS_CODE = ""
                         
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = ""
                        
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN_BOU
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, MTS_CODE & SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, MTS_CODE & SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "13"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        
        
        Case Step_Sagyo2_RES        '２回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
                Select Case wkTEXT
                
                
                    Case LCD_ID_No      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "検品作業不可", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_GAI = False
                            Exit Function
                        End If
    
    
    
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        For DEN_ID_LOOP = 0 To UBound(JGYOBU_T) '2006.06.01
                        
                            sts = Y_Syuka_Chek_Proc(KAN_KBN_FIN, _
                                                    JGYOBU_T(DEN_ID_LOOP).CODE, _
                                                    NAIGAI, _
                                                    Hinban, _
                                                    MTS_CODE, _
                                                    SS_CODE, _
                                                    CYU_KBN, _
                                                    Y_SYU_CNT, _
                                                    ID_NO, _
                                                    SYUKA_QTY, _
                                                    DEN_NO, _
                                                    KAN_KBN, _
                                                    JITU_QTY, _
                                                    DEN_ID_JGYOBU, _
                                                    wkKENPIN_YMD, , _
                                                    LK_MUKE_CODE)
                            If sts <> False Or Y_SYU_CNT <> 0 Then
                                Exit For
                            End If
                        
                        Next DEN_ID_LOOP
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_GAI = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_GAI = False
                                Exit Function
                        End Select
                        
                        
                        '------------------ 向け先のチェック
                        If ID_KANRI_TBL(ING_No).MTS_CODE <> LK_MUKE_CODE Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "向け先エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_GAI = False
                            Exit Function
                        End If
                        '------------------ 注文区分のチェック
                        If ID_KANRI_TBL(ING_No).CYU_KBN <> CYU_KBN Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "注文区分ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_GAI = False
                            Exit Function
                        End If
                        '------------------ 出庫完了のチェック
                        If Inspection_Flg = 0 Then
                            If KAN_KBN <> KAN_KBN_FIN Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "作業未完了", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_GAI = False
                                Exit Function
                            End If
                        End If
                        
                        '------------------ 再検品のチェック    2007.10.10
                        If Inspection_CHK = 1 Then
                            If Trim(wkKENPIN_YMD) <> "" Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品済です", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_GAI = False
                                Exit Function
                            End If
                        End If
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).MTS_CODE = LK_MUKE_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = ""
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Y_SYU_CNT = Y_SYU_CNT
                        ID_KANRI_TBL(ING_No).SYUKA_QTY = JITU_QTY
                        ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU = DEN_ID_JGYOBU      '2006.06.01
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
'2007.07.21                        Send_Text.Box_Type(3).Max_Size = "13"
'2007.07.21                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            For i = 0 To M_Gyo - 1
            
                
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                Select Case wkTEXT
                '2007.07.21 ↑
                    
                    Case LCD_Hinban     '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_GAI = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "品番エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_GAI = False
                            Exit Function
                        End If
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        '2009.07.29
                        If ID_KANRI_TBL(ING_No).SYUKA_QTY > 1 Then
                        
                            Send_Text.Buzzer = Wel_Inspe_BUZZER                 'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Wel_Inspe_BUZZER
                        
                        Else
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        End If
                        
                        '-----------------------------------------------１行目
'                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(0).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(0).Start_Pos = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(0).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
'                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目


                        
                        
                        '2009.04.16
                        wkNull_Check = Replace(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode), Chr(0), " ")
                        If Trim(wkNull_Check) = "" Then
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Else
                                                                                    
                                                                                    
                            Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                                                                    
                                                                                    
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Trim(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode)))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Trim(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode)))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        End If



                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        Case Step_Sagyo4_RES        '４回目の受信（Any Key）
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            '出荷予定の読み込み
            '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU)     '事業部
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'ID№
    
            Do
            
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrKeyNotFound
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_GAI = False
                        GoTo Abort_Tran
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_GAI = False
                        GoTo Abort_Tran
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
        
            Loop
    
    
            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
            Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                            
            '2006.07.20 検品担当者出力追加
            Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
            Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                            
                                            
                                            '出荷予定書込み
            Do
                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_GAI = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        Inspe_Proc_GAI = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop
                                        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                        
                                        
                                        
            '2004.07.16 ↓
            
            '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
            
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        "", , , , , MENU_NO, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE, _
                                        ID_KANRI_TBL(ING_No).SS_CODE, _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Inspe_Proc_GAI = SYS_ERR
                    GoTo Abort_Tran
            End Select
            '2004.07.16 ↑
                                        
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                '検品確認終了時は、伝票ＩＤ要求に戻す為の特殊処理
                
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "12"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()


'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
            
                Sendbuf = Text_Create_Proc()
    
    
    End Select

    Inspe_Proc_GAI = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function





Private Function KYOSEI_END_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品強制完了（宅配伝票読み込み 大阪ＰＣ向け）』
'
'       2006.12.21
'-------------------------------------------------------
Dim sts             As Integer


'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07


Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Integer

Dim SAI_SU          As Double
Dim JYURYO          As Integer


Dim UNSOU_KAISHA    As String

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag


Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2


Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String
Dim KENPIN_END_MARK As String * 1


Dim CANCEL_F        As Boolean

Dim Found_F         As Boolean


Dim OKURI_NO_F      As Boolean

Dim FUKUYAMA_CHK_F  As Boolean


    KYOSEI_END_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                                        
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, , , , , , , , KUTI_SU, SAI_SU)
                        
                        
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.10.04  削除
'                        '他端末で使用中 2011.04.07
'                        If sts = SYS_CANCEL Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                            KYOSEI_END_PROC = False
'                            Exit Function
'                        End If
'                        '他端末で使用中 2011.04.07
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.10.04  削除
                        
                        
                        
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        If Found_F Then
                            CANCEL_F = True
                                                     
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            Next j
                                                     
                                                     
                            If CANCEL_F Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KYOSEI_END_PROC = False
                                Exit Function
                            End If
                        End If
                        
                        
                        
                        If Y_SYU_CNT = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        End If
                
                        
                        If Y_SYU_CNT = Sumi_CNT Then

                            If Trim(OKURI_NO) = "" Then

                                KENPIN_END_MARK = ""
                            Else
                                KENPIN_END_MARK = "*"


                            End If
                        Else
                            KENPIN_END_MARK = ""

                        End If
                        
                        
                        
                        '検品を強制で完了する
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                         
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                                
                                
                                
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                                
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                        Next j
                            
                            
                            
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                            
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                            
                        ID_KANRI_TBL(ING_No).SAI_SU = SAI_SU
                        ID_KANRI_TBL(ING_No).KUTI_SU = KUTI_SU
                            
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                                
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                
                        '-----------------------------------------------１行目
'                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(0).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(0).Start_Pos = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(0).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
'                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, LCD_ID_No & ":" & Trim(KENPIN_END_MARK) & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, LCD_ID_No & ":" & Trim(KENPIN_END_MARK) & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                
                                
                                
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                
                                
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                        If Not IsNumeric(OKURI_NO) Then
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(UNSOU_KAISHA) & LCD_OKURI_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(UNSOU_KAISHA) & LCD_OKURI_NO)
                        Else
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_NO)
                        End If
                            
                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                                
                                
                        '-----------------------------------------------５行目
                        
                        If KUTI_SU = 0 Then
                            KUTI_SU = 1
                        End If
                                    
                                    
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU)
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(Trim(Format(KUTI_SU, "#0")))) & Trim(Format(KUTI_SU, "#0"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Trim(Format(KUTI_SU, "#0")))) & Trim(Format(KUTI_SU, "#0"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "07"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "07"
                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "04"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "04"
                        
                        
                        
                        '-----------------------------------------------５行目
                                    
                                    
                        If SAI_SU = 0 Then
                        Else
                            If SAI_SU < 1 Then
                                SAI_SU = 1
                            Else
                                If SAI_SU > 1 Then
                                    SAI_SU = CLng(ToHalfAdjust(CCur(SAI_SU), 0))
                                End If
                            End If
                        End If
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(SAI_SU, "#0")))) & Trim(Format(SAI_SU, "#0"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(SAI_SU, "#0")))) & Trim(Format(SAI_SU, "#0"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "07"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "07"
                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "04"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "04"
                        
                        
                        Sendbuf = Text_Create_Proc()
                            
                        KYOSEI_END_PROC = False
                        Exit Function
                            
                End Select
            Next i
        
                
        Case Step_Sagyo2_RES        '２回目の受信（送り状№,口数）
                
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状№
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                    
                        If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) = "" Then
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                            
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else



'2009.10.14                        If Len(OKURI_NO) < 11 Or Len(OKURI_NO) > 13 Then
'                            If Len(OKURI_NO) < 10 Or Len(OKURI_NO) > 13 Then
'
'
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                KYOSEI_END_PROC = False
'                                Exit Function
'
'                            End If
                    
                            If Not IsNumeric(OKURI_NO) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KYOSEI_END_PROC = False
                                Exit Function
                            End If
                    
                    
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            
                            
                            
                            
                            If Not OKURI_NO_F Then
                            
                        
                        
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KYOSEI_END_PROC = False
                                Exit Function
                                                
                            End If
                    
                    
                    
                            '2090.04.28
                            If FUKUYAMA_CHK_F Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KYOSEI_END_PROC = False
                                Exit Function
                            
                            End If
                            '2090.04.28
                    
                    
                    
'                            Select Case Len(Trim(OKURI_NO))
'
'                                Case FUKUYAMA_Length
'                                Case SEIBU_Length
'                                Case KURUME_Length
'
'                                    For k = 0 To UBound(KURUME_CODE)
'
'                                        If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
'                                            Exit For
'                                        End If
'                                    Next k
'
'                                    If k > UBound(KURUME_CODE) Then
'
'
'                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                                        Sendbuf = Text_Create_Proc()
'                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                        KYOSEI_END_PROC = False
'                                        Exit Function
'
'                                    End If
'
'                                Case SAGAWA_Length, YAMATO_Length
'
'                                    For k = 0 To UBound(KURUME_CODE)
'
'                                        If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
'                                            Exit For
'                                        End If
'                                    Next k
'
'                                    If k > UBound(SAGAWA_CODE) Then
'
'                                        For k = 0 To UBound(YAMATO_CODE)
'
'                                            If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
'                                                Exit For
'                                            End If
'
'                                        Next k
'
'                                        If k > UBound(YAMATO_CODE) Then
'
'                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
'
'                                            Sendbuf = Text_Create_Proc()
'                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                            KYOSEI_END_PROC = False
'                                            Exit Function
'
'
'
'                                        End If
'
'                                    End If
'
'
'                            End Select
                    
                    
                    
                                                
                    
                    
                    
                            ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                    
                    
                    
                        End If
                    
                    
                    '口数
                    Case LCD_KUTI_SU
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                
                        KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If KUTI_SU < 1 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        End If
                
                
                
                    '才数
                    Case LCD_SAI_SU
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                
                        SAI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
'                        If SAI_SU < 1 Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
'
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                            KYOSEI_END_PROC = False
'                            Exit Function
'                        End If
                
                
                        
                        If KUTI_SU = 0 And SAI_SU = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                        
                
                        If KUTI_SU = 0 And SAI_SU <> 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                
                
                        JYURYO = 0
                
                        If KUTI_SU = 1 And SAI_SU = 0 Then
                            JYURYO = 2
                        End If
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID№
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
Debug.Print Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        KYOSEI_END_PROC = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        KYOSEI_END_PROC = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                        
                            
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            
                                Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                            
                                Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                            
                            End If
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        KYOSEI_END_PROC = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        KYOSEI_END_PROC = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
'                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                'ID_NO
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                            
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                    Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                                
                                    Call UniCode_Conv(Y_SYU_HREC.JURYO, Format(JYURYO, "0000.0"))
                   
                                                
                                                
                                    If Trim(StrConv(Y_SYU_HREC.KENPIN_NOW, vbUnicode)) = "" Then
                                    
                                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                                    
                                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                    
                                        Call UniCode_Conv(Y_SYU_HREC.KYOSEI_END, "1")
                                    
                                    End If
                                                
    '                                '運送会社変換
    '                                If Left(OKURI_NO, 3) = UNSOU_KAISHA_CODE Then
    '                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, UNSOU_KAISHA_NAME)
    '                                End If
    '
    '
    '                                '新運送会社変換 2007.01.09
    '
    '                                If KURUME_F Then        '久留米
    '                                    For k = 1 To UBound(KURUME)
    '
    '                                        If Left(OKURI_NO, Len(KURUME(k))) = KURUME(k) Then
    '                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME(0))
    '                                            Exit For
    '                                        End If
    '                                    Next k
    '                                End If
    '
    '                                If FUKUYAMA_F Then      '福山
    '                                    For k = 1 To UBound(FUKUYAMA)
    '
    '                                        If Left(OKURI_NO, Len(FUKUYAMA(k))) = FUKUYAMA(k) Then
    '                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA(0))
    '                                            Exit For
    '                                        End If
    '                                    Next k
    '                                End If
    '
    '                                If SAGAWA_F Then        '佐川
    '                                    For k = 1 To UBound(SAGAWA)
    '
    '                                        If Left(OKURI_NO, Len(SAGAWA(k))) = SAGAWA(k) Then
    '                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA(0))
    '                                            Exit For
    '                                        End If
    '                                    Next k
    '                                End If
                                                        
                                                        
                                                        
                                                        
    '                                Select Case Len(Trim(OKURI_NO))
    '
    '                                    Case FUKUYAMA_Length
    '                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
    '                                    Case SEIBU_Length
    '                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
    '
    '                                    Case KURUME_Length
    '
    '                                        For k = 0 To UBound(KURUME_CODE)
    '
    '                                            If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
    '                                                Exit For
    '                                            End If
    '                                        Next k
    '
    '                                        If k > UBound(KURUME_CODE) Then
    '                                        Else
    '                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
    '                                        End If
    '
    '                                    Case SAGAWA_Length, YAMATO_Length
    '
    '                                        For k = 0 To UBound(KURUME_CODE)
    '
    '                                            If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
    '                                                Exit For
    '                                            End If
    '                                        Next k
    '
    '                                        If k > UBound(SAGAWA_CODE) Then
    '
    '                                            For k = 0 To UBound(YAMATO_CODE)
    '
    '                                                If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
    '                                                    Exit For
    '                                                End If
    '
    '                                            Next k
    '
    '                                            If k > UBound(YAMATO_CODE) Then
    '                                            Else
    '
    '                                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
    '                                            End If
    '
    '                                        Else
    '                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
    '                                        End If
    '
    '
    '                                End Select
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                    '物流 2010.02.19
    '                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_CHARTER_CD) Then
    '                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "物流")
    '                                End If
    '
    '                                '赤帽 2010.02.19
    '                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_AKABOU_CD) Then
    '                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "赤帽")
    '                                End If
    '
    
    
    
                                    Call OKURI_NO_SET_PROC(OKURI_NO)
    
    
    
    '                                'ロジステック 2010.02.19
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "ロジステック")
                                    End If
                                Else
                                                    
                                                    
                                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, "")
                                    Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, "")
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU, "")
                                                
                                    Call UniCode_Conv(Y_SYU_HREC.JURYO, "")
                                                    
                                                    
                                End If
                                                    
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            KYOSEI_END_PROC = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
'                            End If
                                        
                                        
                                        
                            '------------------------------------   在庫移動履歴の処理      2010.10.28
'                            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
'                                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
'
'                            Else
'                                MENU_NO = ""
'                            End If
'
'                            '履歴出力の為の読み込み
'                            Call UniCode_Conv(K0_MTS.MUKE_CODE, StrConv(Y_SYUREC.MUKE_CODE, vbUnicode))
'                            Call UniCode_Conv(K0_MTS.SS_CODE, "")
'                            sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
'                            Select Case sts
'                                Case BtNoErr
'                                Case BtErrKeyNotFound
'                                    Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
'                                    Call UniCode_Conv(MTSREC.MUKE_NAME, "")
'                                Case Else
'                                    Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
'                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                    Sendbuf = Text_Create_Proc()
'                                    Exit Function
'                            End Select
'
'                            sts = IDOREKI_OUTPUT_PROC("", _
'                                                        "", _
'                                                        ID_KANRI_TBL(ING_No).JGYOBU, _
'                                                        ID_KANRI_TBL(ING_No).NAIGAI, _
'                                                        StrConv(Y_SYUREC.HIN_NO, vbUnicode), _
'                                                        "", _
'                                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
'                                                        0, _
'                                                        0, _
'                                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
'                                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                                        FILE_RETRY, _
'                                                        CYU_KBN_SPO, _
'                                                        Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状№:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
'                                                        , , , , MENU_NO, _
'                                                        StrConv(Y_SYUREC.MUKE_CODE, vbUnicode), _
'                                                        "", _
'                                                        ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
'                            Select Case sts
'                                Case False      '正常終了
'                                Case Else
'                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                    Sendbuf = Text_Create_Proc()
'                                    KYOSEI_END_PROC = SYS_ERR
'                                    GoTo Abort_Tran
'                            End Select
'
'
'
'
                        Next j
'
'
'
'                    '作業ﾛｸﾞ出力    2010.10.28
'                    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
'                        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
'
'                    Else
'
'                        MENU_NO = ""
'                    End If
'                    If Trim(MENU_NO) = "" Then
'                    Else
'                    '作業ﾛｸﾞ出力
'
'                        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
'                                                            ID_KANRI_TBL(ING_No).JGYOBU, _
'                                                            ID_KANRI_TBL(ING_No).NAIGAI, _
'                                                            MENU_NO, _
'                                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
'                                                             , , , , , _
'                                                             ID_KANRI_TBL(ING_No).ID_NO) Then
'                            KYOSEI_END_PROC = SYS_ERR
'                            Exit Function
'                        End If
'                    End If
                    '作業ﾛｸﾞ出力    2010.10.28
                                            
                                            
                                            
                                            
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                
                                        '次の作業要求
            
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
                
                
                
                
                
            Next i
                
                
                
                
    
    
    End Select

    KYOSEI_END_PROC = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function

Private Function Y_Syuka_H_Chek_Proc(JGYOBU As String, _
                                        MTS_CODE As String, _
                                        Y_SYU_CNT As Integer, _
                                        Sumi_CNT As Integer, _
                                        ID_NO As String, _
                                        SYUKA_QTY As Long, _
                                        DEN_NO As String, _
                                        Y_SYU_TBL() As KEN_DEN_TBL_Tag, _
                                        OKURI_NO As String, _
                                        UNSOU_KAISHA As String, _
                                        OKURI_SAKI As String, _
                                        Found_F As Boolean, _
                                        Optional SYUKA_YMD As String, _
                                        Optional JYUSHO As String, _
                                        Optional BIKOU As String, _
                                        Optional Start_Page_No As Long, _
                                        Optional KUTI_SU As Long, _
                                        Optional MUKE_NAME As String, _
                                        Optional OKURI_NO_MAX As Integer, _
                                        Optional Label_RePrint_Kuti_Su As Integer, _
                                        Optional Label_RePrint_Sai_Su As Double, _
                                        Optional KEN_TEL_NO As String, _
                                        Optional KEN_HINBAN As String) As Integer
'-------------------------------------------------------
'
'   『出荷予定の使用予約』
'   大阪ＰＣ用  2006.12.07
'   KEN_HINBAN追加  2012.10.02
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer


Dim ans         As Integer

Dim RETRY_CNT   As Integer

Dim i           As Integer
Dim j           As Integer

Dim FAST_F      As Boolean


Dim KONPOU_ON   As Boolean
Dim KONPOU_OFF  As Boolean
Dim wkTOTAL     As Long
Dim wkKUTI_SU   As Long


Dim GET_F       As Boolean


Dim CANCEL_F    As Boolean

    Y_Syuka_H_Chek_Proc = True
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Y_Syuka_H_Chek_Proc = SYS_ERR
        Exit Function
    End If



    Y_SYU_CNT = 0
    Sumi_CNT = 0
    OKURI_NO = ""
        
    Start_Page_No = 0
        
    Found_F = False
        
    '伝票ＩＤ指定での処理
    Call UniCode_Conv(K0_Y_SYU.JGYOBU, JGYOBU)
    Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_NO)
    
    RETRY_CNT = 0
    '出荷予定
    
    i = -1
    
    com = BtOpGetGreaterEqual
    
    Do
        DoEvents
        sts = BTRV(com + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
        Select Case sts
            Case BtNoErr
                
''''2010.09.29                If Trim(Left(StrConv(Y_SYUREC.ID_NO, vbUnicode), 7)) <> Trim(ID_NO) Then
                If StrConv(Y_SYUREC.ID_NO, vbUnicode) <> StrConv(Y_SYUREC.KEY_ID_NO, vbUnicode) Then

                    Call UniCode_Conv(Y_SYUREC.ID_NO, StrConv(Y_SYUREC.KEY_ID_NO, vbUnicode))

                End If
''''2010.09.29
Debug.Print StrConv(Y_SYUREC.KEY_ID_NO, vbUnicode)
Debug.Print StrConv(Y_SYUREC.ID_NO, vbUnicode)
                If Trim(Left(StrConv(Y_SYUREC.KEY_ID_NO, vbUnicode), 7)) <> Trim(ID_NO) Then
                    
                    
                    
                    
                    
                    sts = BTRV(BtOpUnlock, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                    If sts <> BtNoErr Then
                        Call File_Error(sts, BtOpUnlock, "出荷予定", 0)
                        Y_Syuka_H_Chek_Proc = SYS_ERR
                        GoTo Abort_Tran
                    End If
                        
                        
                    sts = BtErrEOF
                
                    Exit Do
                End If
            Case BtErrEOF
                Exit Do
            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                    Y_Syuka_H_Chek_Proc = SYS_CANCEL
                    GoTo Abort_Tran
                End If
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                Y_Syuka_H_Chek_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
        
                                                
        If sts = BtErrEOF Then
            Exit Do
        End If
                                                
        If Len(Trim(StrConv(Y_SYUREC.WEL_ID, vbUnicode))) = 0 And _
            Len(Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode))) = 0 Then
        Else
            If StrConv(Y_SYUREC.WEL_ID, vbUnicode) <> Format(ID_KANRI_TBL(ING_No).ID, "000") Or _
                Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode)) <> StrConv(App.EXEName, vbUpperCase) Then
                                '他で使用中
                Y_Syuka_H_Chek_Proc = SYS_CANCEL
                GoTo Abort_Tran
            End If
        End If
            
        
        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))
    
    
        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
        Select Case sts
            Case BtNoErr
                
            Case BtErrKeyNotFound
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                Y_Syuka_H_Chek_Proc = SYS_CANCEL
                GoTo Abort_Tran
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                Y_Syuka_H_Chek_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
            
        Found_F = True
            
            
        If Trim(StrConv(Y_SYUREC.KENPIN_YMD, vbUnicode)) = "" Then
        Else
            
'''            If Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)) <> "" Then
'''
'''                OKURI_NO = StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)
'''            End If
            
'''            UNSOU_KAISHA = Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode))
            
'''            OKURI_SAKI = Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode))
        
        End If
            
        
        OKURI_NO_MAX = 0
            
        i = i + 1
        
        
        GET_F = False
        
        If Not GET_F Then
            MTS_CODE = StrConv(Y_SYUREC.MUKE_CODE, vbUnicode)
        
        
        
        
            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))
        
        
            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
            Select Case sts
                Case BtNoErr
                    
                    
                    
                    If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) = "1" Then
                    Else
                    
                    
                        OKURI_SAKI = Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode))
                    
                        UNSOU_KAISHA = Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode))
                    
                        OKURI_NO = Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode))
                    
                    
                        SYUKA_YMD = Trim(StrConv(Y_SYU_HREC.SYUKA_YMD, vbUnicode))      '2010.01.21
                    
                        JYUSHO = Trim(StrConv(Y_SYU_HREC.JYUSHO, vbUnicode))            '2010.01.21
                        
                        BIKOU = Trim(StrConv(Y_SYU_HREC.BIKOU, vbUnicode))              '2010.01.21
                    
                        KEN_TEL_NO = Trim(StrConv(Y_SYU_HREC.TEL_NO, vbUnicode))        '2010.01.21
                    
                                                                                        '2010.01.21
                        If Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode)) <> Trim(StrConv(Y_SYU_HREC.MUKE_NAME, vbUnicode)) Then
                            MUKE_NAME = Trim(StrConv(Y_SYU_HREC.MUKE_NAME, vbUnicode))
                        Else
                            MUKE_NAME = ""
                        End If
                    
                        If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU, vbUnicode)) Then             '2010.01.21
                            Label_RePrint_Kuti_Su = CInt(StrConv(Y_SYU_HREC.KUTI_SU, vbUnicode))
                        Else
                            Label_RePrint_Kuti_Su = 0
                        End If
                    
                        If IsNumeric(StrConv(Y_SYU_HREC.SAI_SU, vbUnicode)) Then             '2010.01.21
                            Label_RePrint_Sai_Su = CDbl(StrConv(Y_SYU_HREC.SAI_SU, vbUnicode))
                        Else
                            Label_RePrint_Sai_Su = 0
                        End If
                        
                        
                        KEN_HINBAN = StrConv(Y_SYU_HREC.KEN_HINBAN, vbUnicode)              '2012.10.02
                        
                        
                        
                        GET_F = True
                
                    End If
                Case BtErrKeyNotFound
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                    Y_Syuka_H_Chek_Proc = SYS_CANCEL
                    GoTo Abort_Tran
                Case Else
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                    Y_Syuka_H_Chek_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        
        
        
        
        
        
        
        
        
        
        End If
        
        
        ReDim Preserve Y_SYU_TBL(i)
'        Y_SYU_TBL(i).SEQ_NO = Right(Trim(StrConv(Y_SYUREC.ID_NO, vbUnicode)), 2)
        '2007.07.17
        Y_SYU_TBL(i).SEQ_NO = Mid(StrConv(Y_SYUREC.ID_NO, vbUnicode), 8, 3)
        
        
        Y_SYU_TBL(i).HIN_NO = StrConv(Y_SYUREC.HIN_NO, vbUnicode)
        Y_SYU_TBL(i).SURYO = CLng(StrConv(Y_SYUREC.SURYO, vbUnicode))
        
        
                
        If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) = "1" Then
            Y_SYU_TBL(i).CANCEL_F = True
        Else
            Y_SYU_TBL(i).CANCEL_F = False
        End If
        
        
        If Trim(StrConv(Y_SYUREC.KENPIN_YMD, vbUnicode)) = "" Then
            Y_SYU_TBL(i).SUMI = False
        Else
            Y_SYU_TBL(i).SUMI = True
        End If
        
        '出庫情報を獲得 2007.05.14
        Y_SYU_TBL(i).KAN_KBN = StrConv(Y_SYUREC.KAN_KBN, vbUnicode)
            
            
'        Y_SYU_TBL(i).KONPOU_F = StrConv(Y_SYU_HREC.KONPOU_F, vbUnicode)
            
        '梱包区分を獲得 2010.01.21
        Call UniCode_Conv(K0_ITEM.JGYOBU, StrConv(Y_SYUREC.JGYOBU, vbUnicode))
        Call UniCode_Conv(K0_ITEM.NAIGAI, StrConv(Y_SYUREC.NAIGAI, vbUnicode))
        Call UniCode_Conv(K0_ITEM.HIN_GAI, StrConv(Y_SYUREC.HIN_NO, vbUnicode))
                    
        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        Select Case sts
            Case BtNoErr
                
                'Y_SYU_TBL(i).KONPOU_F = StrConv(ITEMREC.KONPOU_F, vbUnicode)
                
                                
            
            
            
            
            
            Case BtErrKeyNotFound
                Y_SYU_TBL(i).KONPOU_F = ""
            
                If Y_SYU_TBL(i).SAI_SU = 0 Then
                    Y_SYU_TBL(i).SAI_SU = 0
                End If
                
                If Y_SYU_TBL(i).KUTI_SU = 0 Then
                    Y_SYU_TBL(i).KUTI_SU = 1
                End If
                Call UniCode_Conv(ITEMREC.SAI_SU, "00.00")
            
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目ﾏｽﾀ", 0)
                Y_Syuka_H_Chek_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
            
        Y_SYU_TBL(i).KONPOU_F = StrConv(ITEMREC.KONPOU_F, vbUnicode)
            
            
        If Y_SYU_TBL(i).KONPOU_F = "1" Then
            
            If Y_SYU_TBL(i).SAI_SU = 0 Then
                If IsNumeric(StrConv(ITEMREC.SAI_SU, vbUnicode)) Then
                    
                    
                    Y_SYU_TBL(i).SAI_SU = CDbl(StrConv(ITEMREC.SAI_SU, vbUnicode))
                Else
                    Call UniCode_Conv(ITEMREC.SAI_SU, "00.00")
                    Y_SYU_TBL(i).SAI_SU = 0
                End If
            End If
                            
                        
            If Y_SYU_TBL(i).KUTI_SU = 0 Then
                If IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                    Y_SYU_TBL(i).KUTI_SU = CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                Else
                    Y_SYU_TBL(i).KUTI_SU = 1
                End If
            End If
        End If
            
            
        If Y_SYU_TBL(i).SUMI Then
            If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                Y_SYU_TBL(i).KUTI_SU = CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode))
            End If
            
            If IsNumeric(StrConv(Y_SYU_HREC.SAI_SU_TAN, vbUnicode)) Then
                Y_SYU_TBL(i).SAI_SU = CInt(StrConv(Y_SYU_HREC.SAI_SU_TAN, vbUnicode))
            End If
        
        
        
        
        
 '2010.02.16
            If IsNumeric(StrConv(Y_SYU_HREC.OKURI_NO_SEQ, vbUnicode)) Then
                Y_SYU_TBL(i).OKURI_NO_SEQ = CInt(StrConv(Y_SYU_HREC.OKURI_NO_SEQ, vbUnicode))
                If Y_SYU_TBL(i).OKURI_NO_SEQ > OKURI_NO_MAX Then
                    OKURI_NO_MAX = Y_SYU_TBL(i).OKURI_NO_SEQ
                End If
            
            Else
                Y_SYU_TBL(i).OKURI_NO_SEQ = 0
            End If
 '2010.02.16
        
        
        
        Else
        
            If Y_SYU_TBL(i).KONPOU_F = "1" Then
        
                Y_SYU_TBL(i).KUTI_SU = Y_SYU_TBL(i).KUTI_SU * Y_SYU_TBL(i).SURYO
'                Y_SYU_TBL(i).SAI_SU = Y_SYU_TBL(i).KUTI_SU * CDbl(StrConv(ITEMREC.SAI_SU, vbUnicode))
                Y_SYU_TBL(i).SAI_SU = Y_SYU_TBL(i).SURYO * CDbl(StrConv(ITEMREC.SAI_SU, vbUnicode))
                
            End If
        
 '2010.02.16
            Y_SYU_TBL(i).OKURI_NO_SEQ = 0
 '2010.02.16
        
        End If
            
            
            
                    
        '印刷済をリセット   2010.01.21
'        Y_SYU_TBL(i).PRINT_SUMI = False
'        Y_SYU_TBL(i).OKURI_NO_SEQ = 0
'
'        If IsNumeric(StrConv(Y_SYU_HREC.OKURI_NO_SEQ, vbUnicode)) Then
'            Y_SYU_TBL(i).PRINT_SUMI = True
'            Y_SYU_TBL(i).OKURI_NO_SEQ = CInt(StrConv(Y_SYU_HREC.OKURI_NO_SEQ, vbUnicode))
'
'
'            If Start_Page_No < Y_SYU_TBL(i).OKURI_NO_SEQ Then
'                Start_Page_No = Y_SYU_TBL(i).OKURI_NO_SEQ
'            End If
'
            If Y_SYU_TBL(i).KONPOU_F <> "1" Then
                If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU, vbUnicode)) Then
                    KUTI_SU = CInt(StrConv(Y_SYU_HREC.KUTI_SU, vbUnicode))
                
                    Y_SYU_TBL(i).KUTI_SU = CInt(StrConv(Y_SYU_HREC.KUTI_SU, vbUnicode))
                End If
            End If
'        End If
                    
                    
                    
                    
                    
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
        Y_SYU_TBL(i).CNT_BARA_SU = Val(StrConv(Y_SYU_HREC.CNT_BARA_SU, vbUnicode))       '検品実績　バラ
        Y_SYU_TBL(i).CNT_HAKO_SU = Val(StrConv(Y_SYU_HREC.CNT_HAKO_SU, vbUnicode))       '検品実績　箱
    
        Y_SYU_TBL(i).GAISO_IRI_QTY = Val(StrConv(Y_SYU_HREC.GAISO_IRI_QTY, vbUnicode))   '外装入り数
    
        Y_SYU_TBL(i).Y_HIN_CHK_CNT = Val(StrConv(Y_SYU_HREC.Y_HIN_CHK_CNT, vbUnicode))   '品番読込み回数
    
        Y_SYU_TBL(i).J_HIN_CHK_CNT = Val(StrConv(Y_SYU_HREC.J_HIN_CHK_CNT, vbUnicode))   '品番読込み済み回数
    
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                    
                    
                    
                    
                    
                    
            
            
            
            
            
        Call UniCode_Conv(Y_SYUREC.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
        Call UniCode_Conv(Y_SYUREC.PRG_ID, StrConv(App.EXEName, vbUpperCase))
                                            
        RETRY_CNT = 0
                                            
                                            '出荷予定書込み
        Do
            DoEvents
            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Y_Syuka_H_Chek_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                
                Case Else
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    Y_Syuka_H_Chek_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        Loop
                                

        com = BtOpGetNext
    Loop
                                
''' 品番単位での丸め処理
    
    If Found_F Then
    
        FAST_F = True
                                                                                    
        For i = 0 To UBound(Y_SYU_TBL)
        
        
            If Y_SYU_TBL(i).CANCEL_F Then
            Else
                If FAST_F Then
                
                    Y_SYU_CNT = Y_SYU_CNT + 1
                    If Y_SYU_TBL(i).SUMI Then
                        Sumi_CNT = Sumi_CNT + 1
                    End If
                    FAST_F = False
                
                Else
                    For j = 0 To i - 1
                        If Trim(Y_SYU_TBL(i).HIN_NO) = Trim(Y_SYU_TBL(j).HIN_NO) Then
                            If Not Y_SYU_TBL(j).CANCEL_F Then
                                Exit For
                            End If
                        End If
                    Next j
            
                    If j > i - 1 Then
            
                        Y_SYU_CNT = Y_SYU_CNT + 1
                        If Y_SYU_TBL(i).SUMI Then
                            Sumi_CNT = Sumi_CNT + 1
                        End If
                    End If
                End If
            End If
        Next i
    End If
''' 品番単位での丸め処理
                                
                                
''' 梱包状態の確認
                                
                                
                                
                                
    KONPOU_ON = False
    KONPOU_OFF = False
    wkTOTAL = 0
                                
                                
    If Found_F Then
        For i = 0 To UBound(Y_SYU_TBL)
        
            
            
            If Y_SYU_TBL(i).CANCEL_F Then
            Else
                If Y_SYU_TBL(i).KONPOU_F = "1" Then
                    
                    KONPOU_OFF = True
                Else
                    KONPOU_ON = True
                End If
            End If
        
            wkTOTAL = Y_SYU_TBL(i).SURYO
        
        Next i
    End If
                                
    If Found_F Then
        For i = 0 To UBound(Y_SYU_TBL)
            If KONPOU_ON And KONPOU_OFF Then
                Y_SYU_TBL(i).KONPOU_CND = "3"
            Else
                If KONPOU_ON Then
                    Y_SYU_TBL(i).KONPOU_CND = "2"
                Else
                    Y_SYU_TBL(i).KONPOU_CND = "1"
                End If
            End If
        
        
            Y_SYU_TBL(i).TOTAL_SU = wkTOTAL
        
        Next i





    

''' 梱包状態の確認
        Start_Page_No = 0
        
        wkKUTI_SU = 0
        
        For i = 0 To UBound(Y_SYU_TBL)
        
            If Y_SYU_TBL(i).KONPOU_F <> "1" Then
                
                If Not Y_SYU_TBL(i).CANCEL_F Then           '2012.04.25
                    Start_Page_No = Y_SYU_TBL(i).KUTI_SU
                End If                                      '2012.04.25
            End If
        
        Next i
                                    
        For i = 0 To UBound(Y_SYU_TBL)
        
            If Y_SYU_TBL(i).KONPOU_F = "1" Then
                
                If Y_SYU_TBL(i).SUMI Then
                    If Not Y_SYU_TBL(i).CANCEL_F Then           '2012.04.25
                       Start_Page_No = Start_Page_No + Y_SYU_TBL(i).SURYO * Y_SYU_TBL(i).KUTI_SU
                    End If                                      '2012.04.25
                End If
            End If
        
        Next i
                                
                                
                                
        '2012.10.02
        For i = 0 To UBound(Y_SYU_TBL)
        
            If Y_SYU_TBL(i).CANCEL_F <> "1" Then
                If Y_SYU_TBL(i).KONPOU_F = "1" Then
                    If Trim(Y_SYU_TBL(i).HIN_NO) = Trim(KEN_HINBAN) Then
                        Start_Page_No = Start_Page_No + Y_SYU_TBL(i).J_HIN_CHK_CNT
                    End If
                End If
            End If
        Next i
        '2012.10.02
                                
                                
'        For i = 0 To UBound(Y_SYU_TBL)
'
'            If Y_SYU_TBL(i).KONPOU_F = "1" Then
'
'                Y_SYU_TBL(i).SAI_SU = Y_SYU_TBL(i).SURYO * Y_SYU_TBL(i).KUTI_SU
'            End If
'
'        Next i
                                
                                
                                        
                                
                                
    End If
                                
                                
                                
'>>>>>>>>>>>>   2012.12.28
        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
        If Not Found_F Then
            
            Y_Syuka_H_Chek_Proc = False
            GoTo Abort_Tran
        End If
                                         
                
        CANCEL_F = True
            
        For j = 0 To UBound(Y_SYU_TBL)
        
            If Not Y_SYU_TBL(j).CANCEL_F Then
                CANCEL_F = False
                Exit For
            End If
                                
        Next j
                                 
                                 
        If CANCEL_F Then
            Y_Syuka_H_Chek_Proc = False
            GoTo Abort_Tran
        End If
        
        
        If Y_SYU_CNT = 0 Then
            Y_Syuka_H_Chek_Proc = False
            GoTo Abort_Tran
        End If
                                 
        If Sumi_CNT = Y_SYU_CNT And Start_Page_No <> 0 Then
            Y_Syuka_H_Chek_Proc = False
            GoTo Abort_Tran
        
        End If
'>>>>>>>>>>>>   2012.12.28

                                
                                
Debug.Print Label_RePrint_Sai_Su
                                
    Y_Syuka_H_Chek_Proc = False

End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        Y_Syuka_H_Chek_Proc = SYS_ERR
        GoTo Abort_Tran
    End If
    
    
    Exit Function


Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function
Private Function Y_Syuka_OSAKA_Chek_Proc(JGYOBU As String, _
                                        NAIGAI As String, _
                                        HIN_NO As String, _
                                        Y_SYU_CNT As Integer, _
                                        Y_SURYO As Long, _
                                        J_SURYO As Long, _
                                        ID_NO As String, _
                                        BIN_NO As String) As Integer
'-------------------------------------------------------
'
'   『出庫表出庫時、出荷予定の使用予約』
'   大阪ＰＣ用  2007.03.16
'               2007.05.16 便(BIN_NO)追加
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer


Dim ans         As Integer

Dim RETRY_CNT   As Integer

Dim i           As Integer
Dim j           As Integer

Dim FAST_F      As Boolean



    Y_Syuka_OSAKA_Chek_Proc = True
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Y_Syuka_OSAKA_Chek_Proc = SYS_ERR
        Exit Function
    End If



    Y_SYU_CNT = 0
    
    J_SURYO = 0
    Y_SURYO = 0
    HIN_NO = ""
        
    BIN_NO = ""         '2007.05.16
    
    RETRY_CNT = 0
    '出荷予定
    i = -1
    
    com = BtOpGetGreaterEqual
    '伝票ＩＤ指定での処理
    Call UniCode_Conv(K6_Y_SYU_H.SYU_NO, ID_NO)
    
    Do
        DoEvents
        sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K6_Y_SYU_H, Len(K6_Y_SYU_H), 6)
        Select Case sts
            Case BtNoErr
                
                If Trim(StrConv(Y_SYU_HREC.SYU_NO, vbUnicode)) <> Trim(ID_NO) Then
                    sts = BtErrEOF
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, com, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                Y_Syuka_OSAKA_Chek_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
        
                                                
        If sts = BtErrEOF Then
            Exit Do
        End If
                                                
        If Trim(BIN_NO) = "" Then
            BIN_NO = StrConv(Y_SYU_HREC.INS_BIN, vbUnicode)
        End If
                                                
                                                
                                                
        Call UniCode_Conv(K0_Y_SYU.JGYOBU, StrConv(Y_SYU_HREC.JGYOBU, vbUnicode))
        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, StrConv(Y_SYU_HREC.ID_NO, vbUnicode))
        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
        Select Case sts
            Case BtNoErr
                
            Case BtErrKeyNotFound
                Exit Do
            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                    Y_Syuka_OSAKA_Chek_Proc = SYS_CANCEL
                    GoTo Abort_Tran
                End If
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                Y_Syuka_OSAKA_Chek_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
        
                                                
                                                
        If Trim(StrConv(Y_SYUREC.WEL_ID, vbUnicode)) = "" And _
            Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode)) = "" Then
        Else
            If StrConv(Y_SYUREC.WEL_ID, vbUnicode) <> Format(ID_KANRI_TBL(ING_No).ID, "000") Or _
                Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode)) <> StrConv(App.EXEName, vbUpperCase) Then
                                '他で使用中
                Y_Syuka_OSAKA_Chek_Proc = SYS_CANCEL
                GoTo Abort_Tran
            End If
        End If
            
                    
            
        Call UniCode_Conv(Y_SYUREC.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
        Call UniCode_Conv(Y_SYUREC.PRG_ID, StrConv(App.EXEName, vbUpperCase))
                                            
        RETRY_CNT = 0
                                            
                                            '出荷予定書込み
        Do
            DoEvents
            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Y_Syuka_OSAKA_Chek_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                
                Case Else
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    Y_Syuka_OSAKA_Chek_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        Loop
                                
        
        If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) = "1" Then
        Else
        
            Y_SYU_CNT = Y_SYU_CNT + 1
            
            Y_SURYO = Y_SURYO + CLng(StrConv(Y_SYUREC.SURYO, vbUnicode))
            J_SURYO = J_SURYO + CLng(StrConv(Y_SYUREC.JITU_SURYO, vbUnicode))
        End If
        
        If Trim(HIN_NO) = "" Then
            HIN_NO = StrConv(Y_SYUREC.HIN_NO, vbUnicode)
        End If
        
        
        
        
        
        
        com = BtOpGetNext
    Loop
                                
                                
                                
    '2011.04.07
    If Y_SURYO <= J_SURYO Then
        Y_Syuka_OSAKA_Chek_Proc = False
        GoTo Abort_Tran
    End If
    '2011.04.07
                                
                                
                                
    Y_Syuka_OSAKA_Chek_Proc = False

End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        Y_Syuka_OSAKA_Chek_Proc = SYS_ERR
        GoTo Abort_Tran
    End If
    
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function
Private Sub COMPO_Check_Cnt_Proc(KO_CNT As Integer, RD_CNT As Integer)
'-------------------------------------------------------
'
'   『指図票データの構成部品数』
'
'       2011.03.02
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim ans         As Integer

Dim i           As Integer

    
    KO_CNT = UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL) + 1
    RD_CNT = 0
    
    For i = 0 To UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL)
    
        If ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(i).RD_FLAG Then
        
        
            RD_CNT = RD_CNT + 1
        
        End If
    
    Next i
            


End Sub



Private Function COMPO_Check_Update_Proc(KO_CNT As Integer, RD_CNT As Integer, Sendbuf As String) As Integer
'-------------------------------------------------------
'
'   『指図票データの構成部品数更新』
'
'       2012.04.20
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim ans         As Integer

Dim i           As Integer

Dim DateTime    As String * 12

    
    COMPO_Check_Update_Proc = True
    
    KO_CNT = UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL) + 1
    RD_CNT = 0
    
    For i = 0 To UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL)
    
        If ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(i).RD_FLAG Then
        
        
            RD_CNT = RD_CNT + 1
        
        End If
    
    Next i
            


    '----------------------------------- データ更新処理開始 -----------
                                    'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Exit Function
    End If

    
    Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
    Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")

    DateTime = Format(Now, "YYYYMMDDHHSSMM")
    
    com = BtOpGetGreaterEqual


    Do
        DoEvents
    
        sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
        Select Case sts
            Case BtNoErr
                            
                If StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) <> ID_KANRI_TBL(ING_No).SHIJI_No Then
                    Exit Do
                End If
                
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, com, "指図票ﾃﾞｰﾀ(子)", 0)
                COMPO_Check_Update_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
        
        '担当者
        Call UniCode_Conv(P_SSHIJI_K_REC.COMPO_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
        '日時
        Call UniCode_Conv(P_SSHIJI_K_REC.COMPO_YMDHS, DateTime)
        'ﾁｪｯｸ済み数
        Call UniCode_Conv(P_SSHIJI_K_REC.COMPO_Sumi_Cnt, Format(RD_CNT, "00"))
        '構成数
        Call UniCode_Conv(P_SSHIJI_K_REC.COMPO_ALL_Cnt, Format(KO_CNT, "00"))
        
        sts = BTRV(BtOpUpdate, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
        Select Case sts
            Case BtNoErr
            Case Else
                Call File_Error(sts, BtOpUpdate, "指図票ﾃﾞｰﾀ(子)", 0)
                COMPO_Check_Update_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
    
        com = BtOpGetNext
    
    Loop
                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        GoTo Abort_Tran
    End If


    COMPO_Check_Update_Proc = False
    
    Exit Function
Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function





Private Function COMPO_Check_Read_Proc(SHIJI_No As String, KO_CNT As Integer) As Integer
'-------------------------------------------------------
'
'   『指図票データの構成部品数』
'
'       2011.03.02
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer


Dim i           As Integer

            
            
Dim Check_f     As Boolean  '2011.04.18
Dim j           As Integer  '2011.04.18
            
            
            
    COMPO_Check_Read_Proc = True



    
        
    
    
    
    Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
    
    
    sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            COMPO_Check_Read_Proc = BtErrKeyNotFound
            Exit Function
        Case Else
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
            COMPO_Check_Read_Proc = SYS_ERR
            Exit Function
    End Select
    
    
    Erase ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL
    KO_CNT = -1
    
    
    Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, SHIJI_No)
    Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
    Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")
    
    com = BtOpGetGreater
            
            
    Do
    
    
        DoEvents
    
        sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
        Select Case sts
            Case BtNoErr
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "指図票ﾃﾞｰﾀ(子)", 0)
                COMPO_Check_Read_Proc = SYS_ERR
                Exit Function
        End Select
    
    
    
        If StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) <> SHIJI_No Then
            Exit Do
        End If
    
    
        If StrConv(P_SSHIJI_K_REC.DATA_KBN, vbUnicode) = "3" Then
    
    
''''''''''''    2011.04.18
            Check_f = False
            If Kousei_check_F Then
                If Kousei_check_Tb(0) = "*" Then
                    Check_f = True
                Else
                
                
                    For j = 0 To UBound(Kousei_check_Tb)
                        If Kousei_check_Tb(j) = Trim(StrConv(P_SSHIJI_K_REC.KO_SYUBETSU, vbUnicode)) Then
                            Check_f = True
                            Exit For
                        End If
                    
                    Next j
                
                
                End If
            End If
            If Check_f Then
''''''''''''    2011.04.18
    
                If KO_CNT = -1 Then
                    KO_CNT = KO_CNT + 1
            
                    ReDim Preserve ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(0 To KO_CNT)
                        
                    ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).KO_JGYOBU = StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode)
                    ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).KO_NAIGAI = StrConv(P_SSHIJI_K_REC.KO_NAIGAI, vbUnicode)
                    ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).KO_HIN_GAI = StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)
            
            
            
                Else
            
            
                    For i = 0 To UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL)
                    
                        If Trim(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(i).KO_HIN_GAI) = Trim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)) Then
                            Exit For
                        End If
                    
                    Next i
            
                    If i > UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL) Then
        
                        KO_CNT = KO_CNT + 1
                
                        ReDim Preserve ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(0 To KO_CNT)
                            
                        ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).KO_JGYOBU = StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode)
                        ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).KO_NAIGAI = StrConv(P_SSHIJI_K_REC.KO_NAIGAI, vbUnicode)
                        ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).KO_HIN_GAI = StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)
            
                    End If
            
            
                End If

''''''''''''    2011.04.18
            End If
''''''''''''    2011.04.18
        
        
        End If
    Loop
    
    COMPO_Check_Read_Proc = False

End Function








Private Function Cancel_Proc(Sendbuf As String, Optional Mode As Integer = 0, Optional Para As String = "  ") As Integer
'-------------------------------------------------------
'
'   『キャンセル処理（前画面検索）』
'
'-------------------------------------------------------
    
    Cancel_Proc = True
        
    
    Select Case ID_KANRI_TBL(ING_No).Step
    
        Case Step_Start         '子機電源ＯＮ
        Case Step_TANTO_REQ     '担当者要求
            
            Call Re_Send_Proc(Sendbuf)
                        
        Case Step_JGYOBU_REQ    '事業部要求

'            ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
'            ID_KANRI_TBL(ING_No).JGYOBU = ""
'            Call Start_Proc(Sendbuf)

            '事業部要求でループする
            ID_KANRI_TBL(ING_No).Step = Step_JGYOBU_REQ
            ID_KANRI_TBL(ING_No).JGYOBU = ""
            
            
            If UBound(NAIGAI) = 0 Then
            Else
                ID_KANRI_TBL(ING_No).NAIGAI = ""
            End If
            
'            ID_KANRI_TBL(ING_No).MENU_GRP = ""
            ID_KANRI_TBL(ING_No).MENU_LV1 = ""
            ID_KANRI_TBL(ING_No).MENU_LV2 = ""
'            ID_KANRI_TBL(ING_No).MENU_LV3 = ""
            
            
            
            '2010.04.23
            ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
            ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
            '2010.04.23
            
            

            Call Menu_Send_Proc(Sendbuf)


        Case Step_NAIGAI_REQ    '国内外要求
            
            
            If UBound(JGYOBU_T) = 0 Then
            
                        
                ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
                ID_KANRI_TBL(ING_No).NAIGAI = ""
                Call Menu_Send_Proc(Sendbuf)
            
            Else
            
                ID_KANRI_TBL(ING_No).Step = Step_JGYOBU_REQ
                ID_KANRI_TBL(ING_No).JGYOBU = ""
                ID_KANRI_TBL(ING_No).NAIGAI = ""
            
'               ID_KANRI_TBL(ING_No).MENU_GRP = ""
                ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                ID_KANRI_TBL(ING_No).MENU_LV2 = ""
'               ID_KANRI_TBL(ING_No).MENU_LV3 = ""
            
            
                '2010.04.23
                ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
                ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
                '2010.04.23
            
            
            
                Call Menu_Send_Proc(Sendbuf)
            End If

        Case Step_MENU1_REQ     'メニュー１要求
        
            
            If Mode = 0 Then            '2008.08.08
'                ST_LOG_OUT_F = False    '2008.08.08
            End If                      '2008.08.08
            
            If UBound(NAIGAI) = 0 Then
                
                
                
                If UBound(JGYOBU_T) = 0 Then
                
                
                
                '国内外の切り分けなし
    '                ID_KANRI_TBL(ING_No).Step = Step_TANTO_REQ
    '                ID_KANRI_TBL(ING_No).JGYOBU = ""
    '                Call Start_Proc(Sendbuf)
                
                    ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ
                    ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                    
                    '2010.04.23
                    ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
                    '2010.04.23
            
                
                    Call Menu_Send_Proc(Sendbuf)
            
            
                Else
            
                    '事業部要求でループする
                    ID_KANRI_TBL(ING_No).Step = Step_JGYOBU_REQ
                    ID_KANRI_TBL(ING_No).JGYOBU = ""
        '            ID_KANRI_TBL(ING_No).NAIGAI = ""
                    
        '            ID_KANRI_TBL(ING_No).MENU_GRP = ""
                    ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                    ID_KANRI_TBL(ING_No).MENU_LV2 = ""
        '            ID_KANRI_TBL(ING_No).MENU_LV3 = ""
                    
                    
                    '2010.04.23
                    ID_KANRI_TBL(ING_No).PageNo_LV1 = 0
                    ID_KANRI_TBL(ING_No).PageNo_LV2 = 0
                    '2010.04.23
                    
                    
        
                    Call Menu_Send_Proc(Sendbuf)
                End If
            
            Else
                ID_KANRI_TBL(ING_No).Step = Step_NAIGAI_REQ
                ID_KANRI_TBL(ING_No).NAIGAI = ""
                Call Menu_Send_Proc(Sendbuf)
            End If
        
        
        
        Case Step_MENU2_REQ     'メニュー２要求
        
            
            If Not CANCEL_OPE Then      '2008.09.01
                
                If Para <> "EN" Then
                
                
                
                    '前回がエラー送信
                    Call Re_Send_Proc(Sendbuf)
                    
                    
                    
                    Cancel_Proc = False
                    Exit Function
            
                End If
            End If
            
            
            
            
            
            ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ
            ID_KANRI_TBL(ING_No).MENU_LV1 = ""
        
            If Mode = 0 Then            '2008.08.08
'                ST_LOG_OUT_F = False    '2008.08.08
            End If                      '2008.08.08
        
        
            Call Menu_Send_Proc(Sendbuf)
        
        
'2006.01.30        Case Step_MENU3_REQ     'メニュー３要求
'2006.01.30
'2006.01.30            ID_KANRI_TBL(ING_No).Step = Step_MENU2_REQ
'2006.01.30            ID_KANRI_TBL(ING_No).MENU_LV2 = ""
'2006.01.30
'2006.01.30            Call Menu_Send_Proc(Sendbuf)

        Case Step_Sagyo1_REQ    '作業１要求
'2006.01.30            If Len(Trim(ID_KANRI_TBL(ING_No).MENU_LV3)) <> 0 Then
'2006.01.30                ID_KANRI_TBL(ING_No).Step = Step_MENU3_REQ
'2006.01.30                ID_KANRI_TBL(ING_No).MENU_LV3 = ""
'2006.01.30                Call Menu_Send_Proc(Sendbuf)
'2006.01.30            Else
                
                
            If Mode = 0 Then            '2008.08.08
'                ST_LOG_OUT_F = False    '2008.08.08
            End If                      '2008.08.08
                
                If Len(Trim(ID_KANRI_TBL(ING_No).MENU_LV2)) <> 0 Then
                    MENU_UP_F = True   '2008.08.08
                    ID_KANRI_TBL(ING_No).Step = Step_MENU2_REQ
                    ID_KANRI_TBL(ING_No).MENU_LV2 = ""
                    Call Menu_Send_Proc(Sendbuf)
                Else
                    MENU_UP_F = True   '2008.08.08
                    ID_KANRI_TBL(ING_No).Step = Step_MENU1_REQ
                    ID_KANRI_TBL(ING_No).MENU_LV1 = ""
                    Call Menu_Send_Proc(Sendbuf)
                End If
'2006.01.30            End If
                                                    
                                                    
                                                    
                                                    '作業２／作業３／作業４／作業５要求
        Case Step_Sagyo2_REQ, Step_Sagyo3_REQ, Step_Sagyo4_REQ, Step_Sagyo5_REQ, Step_PRINT_REQ
        
        
        
            Select Case ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE
        
                Case Wel_SHOUHINKA_CHECK
        
        
                    Select Case ID_KANRI_TBL(ING_No).Step
                    
                        Case Step_Sagyo2_REQ
                    
                    
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                            
                            Sendbuf = Text_Create_Proc()
                    
                    
                        Case Step_Sagyo3_REQ
                    
                    
                    
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            
                            
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                    Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & _
                                                                                    Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "13"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            If ID_KANRI_TBL(ING_No).GENPIN_CNT = 0 Then
                            
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))) & _
                                                                                        Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & _
                                                                                        Space(7 - Len(Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                            Sendbuf = Text_Create_Proc()
                    
                    
                                            
                    
                    
                        Case Step_Sagyo4_REQ
                    
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).SHIJI_QTY, "#0"))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            If ID_KANRI_TBL(ING_No).GENPIN_CNT = 0 Then
                            
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_G_HIN_CNT)
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))) & _
                                                                                        Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))) & _
                                                                                        Format(ID_KANRI_TBL(ING_No).GENPIN_CNT, "#0"))
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "13"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "13"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                            Sendbuf = Text_Create_Proc()
                    
                    
                    End Select
        
                Case Else
        
            
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                    If Sagyo_Send_Proc() Then
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    End If
                    
                    Sendbuf = Text_Create_Proc()
                
                    If Mode = 0 Then            '2008.08.08
        '                ST_LOG_OUT_F = False    '2008.08.08
                    End If                      '2008.08.08
    
            End Select
    
    End Select
    
    Cancel_Proc = False


End Function

Private Function tmpZaiko_Clear_Proc() As Integer
'-------------------------------------------------------
'
'   『在庫データ（一時データ）の消去』
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim RETRY_CNT   As Integer
    
    
    tmpZaiko_Clear_Proc = True
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, tmpZAIKO_POS, tmpZAIKOREC, Len(tmpZAIKOREC), K0_tmpZAIKO, Len(K0_tmpZAIKO), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "")
        tmpZaiko_Clear_Proc = SYS_ERR
        Exit Function
    End If
    
    com = BtOpGetFirst

    Do
        DoEvents
        RETRY_CNT = 0
        Do
            sts = BTRV(com + BtSNoWait, tmpZAIKO_POS, tmpZAIKOREC, Len(tmpZAIKOREC), K0_tmpZAIKO, Len(K0_tmpZAIKO), 0)
            Select Case sts
                                
                Case BtNoErr
                    
                    Exit Do
                
                Case BtErrEOF
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "在庫データ（一時データ）")
                        tmpZaiko_Clear_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                        
                    DoEvents
                
                Case Else
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "在庫データ（一時データ）")
                    tmpZaiko_Clear_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        Loop
    
        If sts = BtErrEOF Then
            Exit Do
        End If
    
        
        RETRY_CNT = 0
        
        Do
        
            sts = BTRV(BtOpDelete, tmpZAIKO_POS, tmpZAIKOREC, Len(tmpZAIKOREC), K0_tmpZAIKO, Len(K0_tmpZAIKO), 0)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "在庫データ（一時データ）")
                        tmpZaiko_Clear_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                        
                    DoEvents
                
                Case Else
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "在庫データ（一時データ）")
                    tmpZaiko_Clear_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        
        Loop
    
        com = BtOpGetNext
    
    Loop

End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpEndTransaction, "")
        tmpZaiko_Clear_Proc = SYS_ERR
        GoTo Abort_Tran
    End If
    
    tmpZaiko_Clear_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpAbortTransaction, "")
    End If


End Function











Private Function COMPO_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『構成表示処理』    2006.10.10
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim i           As Integer
Dim j           As Integer

Dim In_cnt      As Integer

    
    COMPO_Proc = True

    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = CtrsWsk1.SendFolder & "\" & BA_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = CtrsWsk1.SendFolder & BA_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If


    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    
                                    
                '最初に出荷予定で
                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Hinban)
                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Hinban = StrConv(Y_SYUREC.HIN_NO, vbUnicode)
                    Case BtErrKeyNotFound
                    Case Else
                        '重要な要因なので未登録はシステム停止とする
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "出荷予定ﾃﾞｰﾀ", 0)
                        Exit Function
                End Select
                                    
                                    
                                    
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                    
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        COMPO_Proc = False
                        Exit Function
                    
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                
                End Select
                
                For j = 0 To UBound(SHIMUKE_TBL)
                    If ID_KANRI_TBL(ING_No).JGYOBU = SHIMUKE_TBL(j).JGYOBU And _
                        ID_KANRI_TBL(ING_No).NAIGAI = SHIMUKE_TBL(j).NAIGAI Then
                        Exit For
                    End If
                Next j
                If j > UBound(SHIMUKE_TBL) Then
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "仕向け先設定エラー", "", "")
                
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    COMPO_Proc = False
                    Exit Function
                End If
                
                
                '-件数獲得
                
                Call UniCode_Conv(K0_P_COMPO.SHIMUKE_CODE, SHIMUKE_TBL(j).SHIMUKE_CODE)
                Call UniCode_Conv(K0_P_COMPO.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                Call UniCode_Conv(K0_P_COMPO.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                Call UniCode_Conv(K0_P_COMPO.HIN_GAI, Hinban)
                Call UniCode_Conv(K0_P_COMPO.DATA_KBN, P_DOUKON)
                Call UniCode_Conv(K0_P_COMPO.SEQNO, "")
                
                com = BtOpGetGreater
                In_cnt = 0
                            
                Do
                    
                    sts = BTRV(com, P_COMPO_POS, P_COMPO_K_REC, Len(P_COMPO_K_REC), K0_P_COMPO, Len(K0_P_COMPO), 0)
                    Select Case sts
                        Case BtNoErr
                            '仕向け先／事業部／内外／品番ブレーク？
                            If StrConv(P_COMPO_K_REC.SHIMUKE_CODE, vbUnicode) <> SHIMUKE_TBL(j).SHIMUKE_CODE Or _
                                StrConv(P_COMPO_K_REC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                StrConv(P_COMPO_K_REC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Or _
                                Trim(StrConv(P_COMPO_K_REC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Or _
                                StrConv(P_COMPO_K_REC.DATA_KBN, vbUnicode) <> P_DOUKON Then
                                
                                Exit Do
                            
                            End If
                        
                        Case BtErrEOF
                            
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "構成マスタ", 0)
                            Exit Function
                    End Select
                    
                    
                                
                    In_cnt = In_cnt + 1
                    
                    com = BtOpGetNext
                Loop
                
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
                SendFileRec.Title = "0"     'タイトル行
                Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                SendFileRec.Title = "0"     '品番
                Call UniCode_Conv(SendFileRec.LCD, Hinban & Format(In_cnt, "#0") & "件")
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                            
                Call UniCode_Conv(K0_P_COMPO.SHIMUKE_CODE, SHIMUKE_TBL(j).SHIMUKE_CODE)
                Call UniCode_Conv(K0_P_COMPO.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                Call UniCode_Conv(K0_P_COMPO.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                Call UniCode_Conv(K0_P_COMPO.HIN_GAI, Hinban)
                Call UniCode_Conv(K0_P_COMPO.DATA_KBN, P_DOUKON)
                Call UniCode_Conv(K0_P_COMPO.SEQNO, "")
                
                com = BtOpGetGreater
                
                Do
                    
                    sts = BTRV(com, P_COMPO_POS, P_COMPO_K_REC, Len(P_COMPO_K_REC), K0_P_COMPO, Len(K0_P_COMPO), 0)
                    Select Case sts
                        Case BtNoErr
                            '仕向け先／事業部／内外／品番ブレーク？
                            If StrConv(P_COMPO_K_REC.SHIMUKE_CODE, vbUnicode) <> SHIMUKE_TBL(j).SHIMUKE_CODE Or _
                                StrConv(P_COMPO_K_REC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                StrConv(P_COMPO_K_REC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Or _
                                Trim(StrConv(P_COMPO_K_REC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Or _
                                StrConv(P_COMPO_K_REC.DATA_KBN, vbUnicode) <> P_DOUKON Then
                                
                                Exit Do
                            
                            End If
                        
                        Case BtErrEOF
                            
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "構成マスタ", 0)
                            Exit Function
                    End Select
                    
                    
                                
                    SendFileRec.Title = "1"
                            
                            
                    'コードマスタ読み込み
                    Call UniCode_Conv(K0_P_CODE.DATA_KBN, P_KBN06_CD)
                    Call UniCode_Conv(K0_P_CODE.C_Code, StrConv(P_COMPO_K_REC.KO_SYUBETSU, vbUnicode))

                    sts = BTRV(BtOpGetEqual, P_CODE_POS, P_CODEREC, Len(P_CODEREC), K0_P_CODE, Len(K0_P_CODE), 0)
                    Select Case sts
                        Case BtNoErr
                        
                        Case BtErrKeyNotFound
                            
                            Call UniCode_Conv(P_CODEREC.C_RNAME, "")
                        
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "コードマスタ ", 0)
                            Exit Function
                    End Select
                            
                    Call UniCode_Conv(SendFileRec.LCD, Left(StrConv(P_CODEREC.C_RNAME, vbUnicode), 2) & _
                                        ":" & _
                                        Left(StrConv(P_COMPO_K_REC.KO_HIN_GAI, vbUnicode), 13) & _
                                        Format(CLng(StrConv(P_COMPO_K_REC.KO_QTY, vbUnicode)), "#0"))
                    SendFileRec.CRLF = vbCrLf
                    Put #FileNo, , SendFileRec
                        
                    
                    com = BtOpGetNext
                Loop
        
                Close #FileNo
        
        
        End Select
    Next i
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.fileName = BA_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.fileName = BA_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１～５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    COMPO_Proc = False
    

End Function


Private Function KEN_Rireki_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品履歴表示処理』
'
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer
Dim l               As Integer

Dim ID_NO           As String
Dim MTS_CODE        As String
Dim DEN_NO          As String
Dim OKURI_NO        As String
Dim UNSOU_KAISHA    As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim FileNo          As Integer

Dim FullPath        As String

Dim SendFileRec     As SendFileRec_Tag

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim DATA_CNT        As Integer
Dim SYUKA_QTY       As Long

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag
Dim wY_SYU_TBL()    As KEN_DEN_TBL_Tag

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean
    
Dim Found_F         As Boolean
    
    
    KEN_Rireki_Proc = True

    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = CtrsWsk1.SendFolder & "\" & BB_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = CtrsWsk1.SendFolder & BB_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            
            Case LCD_ID_No          '伝票ＩＤ
                '親伝をＫＥＥＰ
                ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                 
                Erase Y_SYU_TBL
                                
                sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        MTS_CODE, _
                                        Y_SYU_CNT, _
                                        Sumi_CNT, _
                                        ID_NO, _
                                        SYUKA_QTY, _
                                        DEN_NO, _
                                        Y_SYU_TBL(), _
                                        OKURI_NO, _
                                        UNSOU_KAISHA, _
                                        OKURI_SAKI, _
                                        Found_F)
                
                
                
                sts = Data_Clear_Proc(0, Sendbuf)
                Select Case sts
                    Case SYS_ERR
                        Exit Function
                End Select
                
                
                'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                
                If Found_F Then
                    CANCEL_F = True
                                             
                    For j = 0 To UBound(Y_SYU_TBL)
                    
                        If Not Y_SYU_TBL(j).CANCEL_F Then
                            CANCEL_F = False
                            Exit For
                        End If
                    
                    Next j
                                             
                                             
                    If CANCEL_F Then
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KEN_Rireki_Proc = False
                        Exit Function
                    End If
                End If
                
                If Y_SYU_CNT = 0 Then
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    KEN_Rireki_Proc = False
                    Exit Function
                End If
                
                
                If Y_SYU_CNT = Sumi_CNT Then
                    
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "未検品残なし！", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    KEN_Rireki_Proc = False
                    Exit Function
                
                
                End If
                
                Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                Erase wY_SYU_TBL
                                
                                
                For j = 0 To UBound(Y_SYU_TBL)
                
                    If Y_SYU_TBL(j).SUMI Then
                    Else
                    
                        ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                    
                    End If
                Next j
                
                k = 0
                
                Sumi_CNT = 0
                Y_SYU_CNT = 0
                
                For j = 0 To UBound(Y_SYU_TBL)
                    If k = 0 Then
                        If Y_SYU_TBL(j).CANCEL_F Then
                        Else
                    
                            ReDim Preserve wY_SYU_TBL(k)
                            wY_SYU_TBL(k).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            wY_SYU_TBL(k).SUMI = Y_SYU_TBL(j).SUMI
                            wY_SYU_TBL(k).SURYO = Y_SYU_TBL(j).SURYO
                            
                            Y_SYU_CNT = Y_SYU_CNT + 1
                            If Y_SYU_TBL(j).SUMI Then
                                Sumi_CNT = Sumi_CNT + 1
                            End If
                            
                            
                            k = k + 1
                    
                                                
                        End If
                    Else
                        For l = 0 To UBound(wY_SYU_TBL)
                        
                            If Y_SYU_TBL(j).HIN_NO = wY_SYU_TBL(l).HIN_NO Then
                                
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                
                                    wY_SYU_TBL(l).SURYO = wY_SYU_TBL(l).SURYO + Y_SYU_TBL(j).SURYO
                                    
                                    Exit For
                                End If
                            End If
                        Next l
                    
                        If l > UBound(wY_SYU_TBL) Then
                            
                            If Not Y_SYU_TBL(j).CANCEL_F Then
                                ReDim Preserve wY_SYU_TBL(k)
                                wY_SYU_TBL(k).HIN_NO = Y_SYU_TBL(j).HIN_NO
                                wY_SYU_TBL(k).SUMI = Y_SYU_TBL(j).SUMI
                                wY_SYU_TBL(k).SURYO = Y_SYU_TBL(j).SURYO
                                
                                Y_SYU_CNT = Y_SYU_CNT + 1
                                If Y_SYU_TBL(j).SUMI Then
                                    Sumi_CNT = Sumi_CNT + 1
                                End If
                                
                                k = k + 1
                            End If
                        End If
                    End If
                Next j
                
                
                
                
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
                SendFileRec.Title = "0"     'タイトル行
                Call UniCode_Conv(SendFileRec.LCD, Trim(ID_NO) & "(" & _
                                                    Format(Sumi_CNT, "#0") & "/" & _
                                                    Format(Y_SYU_CNT, "#0") & ")")
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                                    
                For j = 0 To UBound(wY_SYU_TBL)
                    
                    If wY_SYU_TBL(j).SUMI Then
                    Else
                        SendFileRec.Title = "1"
                    
                        
                        Call UniCode_Conv(SendFileRec.LCD, Left(wY_SYU_TBL(j).HIN_NO, 16) & ":" & _
                                                    Format(wY_SYU_TBL(j).SURYO, "#0"))
                        SendFileRec.CRLF = vbCrLf
                                                
                        Put #FileNo, , SendFileRec
                    End If
                Next j
                    
                Close #FileNo
        End Select
    Next i
                    
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.fileName = BB_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.fileName = BB_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１～５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    KEN_Rireki_Proc = False
    

End Function






Private Function KEN_ZAN_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『集約検品残表示処理』
'   2010.02.15
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer
Dim l               As Integer

Dim ID_NO           As String
Dim MTS_CODE        As String
Dim DEN_NO          As String
Dim OKURI_NO        As String
Dim UNSOU_KAISHA    As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim FileNo          As Integer

Dim FullPath        As String

Dim SendFileRec     As SendFileRec_Tag

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim DATA_CNT        As Integer
Dim SYUKA_QTY       As Long

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag
Dim wY_SYU_TBL()    As KEN_DEN_TBL_Tag

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean
    
Dim Found_F         As Boolean
    
    
    KEN_ZAN_Proc = True

    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = CtrsWsk1.SendFolder & "\" & BF_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = CtrsWsk1.SendFolder & BF_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            
            Case LCD_ID_No          '伝票ＩＤ
                '親伝をＫＥＥＰ
                ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                 
                Erase Y_SYU_TBL
                                
                sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        MTS_CODE, _
                                        Y_SYU_CNT, _
                                        Sumi_CNT, _
                                        ID_NO, _
                                        SYUKA_QTY, _
                                        DEN_NO, _
                                        Y_SYU_TBL(), _
                                        OKURI_NO, _
                                        UNSOU_KAISHA, _
                                        OKURI_SAKI, _
                                        Found_F)
                
                
                
                sts = Data_Clear_Proc(0, Sendbuf)
                Select Case sts
                    Case SYS_ERR
                        Exit Function
                End Select
                
                
                'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                
                If Found_F Then
                    CANCEL_F = True
                                             
                    For j = 0 To UBound(Y_SYU_TBL)
                    
                        If Not Y_SYU_TBL(j).CANCEL_F Then
                            CANCEL_F = False
                            Exit For
                        End If
                    
                    Next j
                                             
                                             
                    If CANCEL_F Then
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KEN_ZAN_Proc = False
                        Exit Function
                    End If
                End If
                
                If Y_SYU_CNT = 0 Then
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    KEN_ZAN_Proc = False
                    Exit Function
                End If
                
                
                If Y_SYU_CNT = Sumi_CNT Then
                    
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "未検品残なし！", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    KEN_ZAN_Proc = False
                    Exit Function
                
                
                End If
                
                Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                Erase wY_SYU_TBL
                                
                                
                For j = 0 To UBound(Y_SYU_TBL)
                
                    If Y_SYU_TBL(j).SUMI Then
                    Else
                    
                        
                        
                        If Y_SYU_TBL(j).KONPOU_F = "1" Then
                        Else
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = Y_SYU_TBL(j).KONPOU_F
                        End If
                    End If
                Next j
                
                k = 0
                
                Sumi_CNT = 0
                Y_SYU_CNT = 0
                
                For j = 0 To UBound(Y_SYU_TBL)
                    If k = 0 Then
                        If Y_SYU_TBL(j).CANCEL_F Then
                        Else
                    
                            If Y_SYU_TBL(j).KONPOU_F = "1" Then
                            Else
                    
                    
                                ReDim Preserve wY_SYU_TBL(k)
                                wY_SYU_TBL(k).HIN_NO = Y_SYU_TBL(j).HIN_NO
                                wY_SYU_TBL(k).SUMI = Y_SYU_TBL(j).SUMI
                                wY_SYU_TBL(k).SURYO = Y_SYU_TBL(j).SURYO
                                
                                Y_SYU_CNT = Y_SYU_CNT + 1
                                If Y_SYU_TBL(j).SUMI Then
                                    Sumi_CNT = Sumi_CNT + 1
                                End If
                                
                                
                                k = k + 1
                            End If
                                                
                        End If
                    Else
                        For l = 0 To UBound(wY_SYU_TBL)
                        
                            If Y_SYU_TBL(j).HIN_NO = wY_SYU_TBL(l).HIN_NO Then
                                
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    If Y_SYU_TBL(j).KONPOU_F = "1" Then
                                    Else
                                
                                        wY_SYU_TBL(l).SURYO = wY_SYU_TBL(l).SURYO + Y_SYU_TBL(j).SURYO
                                    
                                        Exit For
                                    End If
                                End If
                            End If
                        Next l
                    
                        If l > UBound(wY_SYU_TBL) Then
                            
                            
                            If Not Y_SYU_TBL(j).CANCEL_F Then
                                
                                If Y_SYU_TBL(j).KONPOU_F = "1" Then
                                Else
                                    
                                    ReDim Preserve wY_SYU_TBL(k)
                                    wY_SYU_TBL(k).HIN_NO = Y_SYU_TBL(j).HIN_NO
                                    wY_SYU_TBL(k).SUMI = Y_SYU_TBL(j).SUMI
                                    wY_SYU_TBL(k).SURYO = Y_SYU_TBL(j).SURYO
                                    
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    If Y_SYU_TBL(j).SUMI Then
                                        Sumi_CNT = Sumi_CNT + 1
                                    End If
                                    
                                    k = k + 1
                                End If
                            End If
                        End If
                    End If
                Next j
                
                
                
                
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
                SendFileRec.Title = "0"     'タイトル行
                Call UniCode_Conv(SendFileRec.LCD, Trim(ID_NO) & "(" & _
                                                    Format(Sumi_CNT, "#0") & "/" & _
                                                    Format(Y_SYU_CNT, "#0") & ")")
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                                    
                For j = 0 To UBound(wY_SYU_TBL)
                    
                    If wY_SYU_TBL(j).SUMI Then
                    Else
                        SendFileRec.Title = "1"
                    
                        Call UniCode_Conv(SendFileRec.LCD, Left(wY_SYU_TBL(j).HIN_NO, 13) & ":" & _
                                                    Format(wY_SYU_TBL(j).SURYO, "#0"))
                        SendFileRec.CRLF = vbCrLf
                                                
                        Put #FileNo, , SendFileRec
                    End If
                Next j
                    
                Close #FileNo
        End Select
    Next i
                    
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.fileName = BF_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.fileName = BF_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１～５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    KEN_ZAN_Proc = False
    

End Function




Private Function NYUKO_KENPIN_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『入荷検品処理（大阪PC向け）』
'       2007.06.07
'
'-------------------------------------------------------
Dim i           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07


Dim Tanaban     As String * 8
Dim DEN_NO      As String * 6
Dim SEQ_NO      As String * 3

Dim sts         As Integer

Dim QTY         As Long
Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1

Dim MENU_NO     As String * 2


Dim Found_F     As Integer

Dim GYO_INS     As String * 1

    NYUKO_KENPIN_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        '------------------ 品目マスタ読込み
                        
                                                
                                                
                        '2010.10.01
'                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, 1)
                        
                        
                        Select Case sts
                            Case BtNoErr
                                RET_JGYOBU = ID_KANRI_TBL(ING_No).JGYOBU
                                RET_NAIGAI = ID_KANRI_TBL(ING_No).NAIGAI
                            
                            
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                NYUKO_KENPIN_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                
                        '------------------ 入荷データの確認
                        sts = Y_Nyuka_O_Chek_Proc(1, RET_JGYOBU, _
                                                    RET_NAIGAI, _
                                                    Hinban, _
                                                    DEN_NO, _
                                                    Found_F, _
                                                    SEQ_NO, _
                                                    QTY)
                
                
                
                        Select Case sts
                            Case False          '正常
                                If Found_F = 9 Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "該当品番使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    NYUKO_KENPIN_OSAKA_Proc = False
                                    Exit Function
                                End If
                
                            Case True, SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "該当品番使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                NYUKO_KENPIN_OSAKA_Proc = False
                                Exit Function
                        End Select
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI
                
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).SEQ_NO = SEQ_NO

                        ID_KANRI_TBL(ING_No).GYO_INS = "0"

                        ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = StrConv(ITEMREC.GOODS_KBN, vbUnicode)
                        '入荷予定の情報により処理を振り分ける
                        Select Case Found_F
                            Case 0
                                '-----------------  データ無し
                            
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.fileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                        
                                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                
                                '-----------------------------------------------１行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
                                                                                        
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                                                                        
                                                                                        
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "該当なし(0:OK 1:CAN)")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "該当なし(0:OK 1:CAN)")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------------------------------------------４行目
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "品目追加？")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "品目追加？")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = "11"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "11"
                                                                                        '入力桁数
                                Send_Text.Box_Type(3).Max_Size = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "01"
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                 Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                            Case 1
                                '-----------------  未処理データ
                            
                            
                            
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.fileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                        
                                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                
                                '-----------------------------------------------１行目
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                                        
                                Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Suryo)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Suryo)
                                                                                    
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""                                                                                        '初期カーソル位置
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = Format(M_Keta - 4, "00")
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "05"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "05"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                                                                        
                                                                                        
                                '-----------------------------------------------４行目
                                                                                        
                                If DEN_NO = "000000" Then
                                                                                            'BOX属性
                                    Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                            '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_DEN_No)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_DEN_No)
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 5, "00")
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 5, "00")
                                                                                            '入力桁数
                                    Send_Text.Box_Type(3).Max_Size = "06"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "06"
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                Else
                                
                                                                                            'BOX属性
                                    Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                            '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_DEN_No & DEN_NO)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_DEN_No & DEN_NO)
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                            '入力桁数
                                    Send_Text.Box_Type(3).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                
                                End If
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                 Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                            
                            Case 2
                                '-----------------  処理済データ
                        
                            
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.fileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                        
                                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                
                                '-----------------------------------------------１行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
                                                                                        
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                                                                        
                                                                                        
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "処理済 (0:OK 1:CAN)")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "処理済 (0:OK 1:CAN)")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------------------------------------------４行目
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "品目追加？")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "品目追加？")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = "11"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "11"
                                                                                        '入力桁数
                                Send_Text.Box_Type(3).Max_Size = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "01"
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                 Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                        
                        
                        End Select
                
                
                
                End Select
            Next i
    
        Case Step_Sagyo2_RES        '処理継続の有無
    
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    Case LCD_HIN_ANS        '継続有無
                        GYO_INS = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                                    
                        If GYO_INS <> "0" And GYO_INS <> "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, GYO_INS, "(0 OR 1)", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            NYUKO_KENPIN_OSAKA_Proc = False
                            Exit Function

                        End If

                        ID_KANRI_TBL(ING_No).GYO_INS = "1"
                        ID_KANRI_TBL(ING_No).DEN_NO = "000000"

                        '入荷予定の情報により処理を振り分ける
                        Select Case GYO_INS
                            Case "0"
                            
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.fileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                        
                                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                
                                '-----------------------------------------------１行目
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                                        
                                Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Suryo)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Suryo)
                                                                                    
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""                                                                                        '初期カーソル位置
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = Format(M_Keta - 4, "00")
                                                                                        '入力桁数
                                 Send_Text.Box_Type(2).Max_Size = "05"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "05"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                                                                        
                                                                                        
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_DEN_No)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_DEN_No)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 5, "00")
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 5, "00")
                                                                                        '入力桁数
                                Send_Text.Box_Type(3).Max_Size = "06"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "06"
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                 Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                            
                            Case "1"        'キャンセル
                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
            
        
                                Sendbuf = Text_Create_Proc()
                        
                        
                        End Select
                
                
                
                End Select
            Next i
    
    
    
        Case Step_Sagyo3_RES        '数量／伝票№
    
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    Case LCD_Suryo      '数量
                        
                                    
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            NYUKO_KENPIN_OSAKA_Proc = False
                            Exit Function

                        End If

                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))


                    Case LCD_DEN_No     '伝票№
                        
                                    
                        If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            If CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 0 Then
                            Else
                                ID_KANRI_TBL(ING_No).DEN_NO = Format(CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))), "000000")
                            End If
                        End If

                
                
                
                End Select
            Next i
    
            '----------------------------------- データ更新処理開始 -----------
                                                'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                                
                                                
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                                
                                                
            If ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = GOODS_ON Then
                MI_QTY = QTY
                SUMI_QTY = 0
            Else
                SUMI_QTY = QTY
                MI_QTY = 0
            End If
                                                
                                                '入庫更新
            sts = Nyuko_OSAKA_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    Format(Now, "YYYYMMDD"), _
                                    (NYUKA_SOKO_NO & "01" & "01" & "01"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    ID_KANRI_TBL(ING_No).GYO_INS, _
                                    ID_KANRI_TBL(ING_No).DEN_NO, _
                                    ID_KANRI_TBL(ING_No).SEQ_NO, _
                                    FILE_RETRY, , MENU_NO)
            Select Case sts
                Case False
                Case True           '入庫時は発生しない
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                    NYUKO_KENPIN_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Sendbuf = Text_Create_Proc()
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    NYUKO_KENPIN_OSAKA_Proc = SYS_ERR    'システム異常発生
                    
                    GoTo Abort_Tran
            End Select
        
End_Tran:
                                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                                '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
                    
            Sendbuf = Text_Create_Proc()
    
    
    End Select
    
    
    NYUKO_KENPIN_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Private Function NYUKO_TANA_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『実棚入庫処理（大阪PC向け）』
'       2007.06.07
'       2007.11.02 標準棚番表示追加
'-------------------------------------------------------
Dim i               As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8
Dim DEN_NO          As String * 6
Dim SEQ_NO          As String * 3

Dim sts         As Integer

Dim QTY         As Long
Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1

Dim MENU_NO     As String * 2

Dim Found_F     As Integer

Dim ST_TANABAN      As String * 11  '2007.11.02


Dim RETRY_CNT   As Integer
Dim RETRY_SU    As Integer

    NYUKO_TANA_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        '------------------ 品目マスタ読込み
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                NYUKO_TANA_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                        '2007.11.02 ↓
                        If Trim(StrConv(ITEMREC.ST_SOKO, vbUnicode)) = "" Then
                            ST_TANABAN = ""
                        Else
                            ST_TANABAN = StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & _
                                            StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & _
                                            StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & _
                                            StrConv(ITEMREC.ST_DAN, vbUnicode)
                        End If
                        '2007.11.02 ↑
                    
                    
                
                        '------------------ 入荷データの確認
                        sts = Y_Nyuka_O_Chek_Proc(2, RET_JGYOBU, _
                                                    RET_NAIGAI, _
                                                    Hinban, _
                                                    DEN_NO, _
                                                    Found_F, _
                                                    SEQ_NO, _
                                                    QTY)
                        Select Case sts
                            Case False          '正常
                                Select Case Found_F
                                    Case 9
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "該当品番使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        NYUKO_TANA_OSAKA_Proc = False
                                        Exit Function
                                    Case 0
                                                                    
'---------------------------------------------- '異常対処 2011.04.02
                                        If RECOVER_F Then
                                            sts = BTRV(BtOpGetLast, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                                            Select Case sts
                                                Case BtNoErr
                                                    SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                                                Case BtErrEOF
                                                    SEQ_NO = "000"
                                                Case Else
                                                    Call File_Error(sts, BtOpGetEqual, "入荷予定ﾃﾞｰﾀ")
                                                    NYUKO_TANA_OSAKA_Proc = False
                                                    Exit Function
                                            End Select
        
                                            SEQ_NO = Format(CInt(SEQ_NO) + 1, "000")
                
                                            Call UniCode_Conv(Y_NYU_O_REC.JGYOBU, RET_JGYOBU)
                                            Call UniCode_Conv(Y_NYU_O_REC.SOKO_NO, DAITO_SOKO_NO)
                                            Call UniCode_Conv(Y_NYU_O_REC.SEQ_NO, SEQ_NO)
                                            Call UniCode_Conv(Y_NYU_O_REC.NYUKO_YMD, Format(Now, "YYYYMMDD"))
                                            Call UniCode_Conv(Y_NYU_O_REC.DEN_NO, "000000")
        
                                            Call UniCode_Conv(Y_NYU_O_REC.MAKER_CODE, StrConv(ITEMREC.MAKER_CODE, vbUnicode))
                                            Call UniCode_Conv(Y_NYU_O_REC.NAIGAI, RET_NAIGAI)
        
                                            Call UniCode_Conv(Y_NYU_O_REC.HIN_NO, Hinban)
        
                                            Call UniCode_Conv(Y_NYU_O_REC.Y_SURYO, "00000000")
        
                                            Call UniCode_Conv(Y_NYU_O_REC.ORDER_NO, "")
        
                                            Call UniCode_Conv(Y_NYU_O_REC.FILLER, "")
    
                                            Call UniCode_Conv(Y_NYU_O_REC.DEN_NO, "")
                                            Call UniCode_Conv(Y_NYU_O_REC.J_SURYO, "00000000")
    
                                            Call UniCode_Conv(Y_NYU_O_REC.TANTO_CODE, "RECOV")
        
                                            Call UniCode_Conv(Y_NYU_O_REC.KENPIN_F, "1")
        
                                            Call UniCode_Conv(Y_NYU_O_REC.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
                                            Call UniCode_Conv(Y_NYU_O_REC.PRG_ID, StrConv(App.EXEName, vbUpperCase))
        
            
                                            RETRY_SU = 5
                                            RETRY_CNT = 0
                                            Do
                                                sts = BTRV(BtOpInsert, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                                                Select Case sts
                                                    Case BtNoErr
                                                        Exit Do
                                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                                                                'リトライ回数チェック
                                                        If RETRY_SU <> 0 Then
                                                            
                                                            RETRY_CNT = RETRY_CNT + 1
                                                            If RETRY_CNT > RETRY_SU Then
                                                                                '回数オーバー
                                                                Call File_Error(sts, BtOpInsert, "入荷予定", 0)
                                                                NYUKO_TANA_OSAKA_Proc = False
                                                                Exit Function
                                                            End If
                                                        
                                                        End If
                                                        
                                                        DoEvents
                                                    Case Else
                                                        Call File_Error(sts, BtOpInsert, "入荷予定")
                                                        NYUKO_TANA_OSAKA_Proc = False
                                                        Exit Function
                                                End Select
                                            Loop
                                        
                                        
                                            DEN_NO = "000000"
'---------------------------------------------- '異常対処 2011.04.02
                                        
                                        Else
                                        
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "該当品番なし", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            NYUKO_TANA_OSAKA_Proc = False
                                            Exit Function
                                
                                        End If
                                
                                
                                End Select
                
                            Case True, SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "該当品番使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                NYUKO_TANA_OSAKA_Proc = False
                                Exit Function
                        End Select
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI
                
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).SEQ_NO = SEQ_NO

                        ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = StrConv(ITEMREC.GOODS_KBN, vbUnicode)
                        
                        
                        If ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = GOODS_ON Then
                            ID_KANRI_TBL(ING_No).Send_MI_QTY = QTY
                            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = 0
                        Else
                            ID_KANRI_TBL(ING_No).Send_MI_QTY = 0
                            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = QTY
                        End If
                        
                        
                        
                        
                        'FROM 入荷倉庫の在庫をKEEP
                        FROM_Tanaban = NYUKA_SOKO_NO & "01" & "01" & "01"
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                NYUKO_TANA_OSAKA_Proc = False
                                Exit Function
                        End Select
                    
            
'---------------------------------------------- '異常対処 2011.04.02
                        If RECOVER_F Then
                            QTY = SUMI_QTY + MI_QTY
                        End If
                        If ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = GOODS_ON Then
                            ID_KANRI_TBL(ING_No).Send_MI_QTY = QTY
                            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = 0
                        Else
                            ID_KANRI_TBL(ING_No).Send_MI_QTY = 0
                            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = QTY
                        End If
'---------------------------------------------- '異常対処 2011.04.02
            
            
                        If (SUMI_QTY + MI_QTY) < QTY Then
                            Call Err_Send_Proc("有効在庫数不足", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        
                            
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
'2007.11.02                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
'2007.11.02                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban & " " & ST_TANABAN)                        '2007.11.02
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban & " " & ST_TANABAN)   '2007.11.02
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
'2007.11.02                        Send_Text.Box_Type(2).Max_Size = "09"
'2007.11.02                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                        Send_Text.Box_Type(2).Max_Size = "16"                       '入力桁数変更　2007.11.02
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "16"  '入力桁数変更　2007.11.02
                                                                                
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(QTY, "#0")))) & Format(QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(QTY, "#0")))) & Format(QTY, "#0"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(QTY, "#0"))) & Format(QTY, "#0")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(QTY, "#0"))) & Format(QTY, "#0")
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                        If DEN_NO = "000000" Then
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_DEN_No)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_DEN_No)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 5, "00")
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 5, "00")
                                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "06"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "06"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        Else
                        
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_DEN_No & DEN_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_DEN_No & DEN_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        End If
                    

                        Sendbuf = Text_Create_Proc()
                        
                
                
                
                End Select
            Next i
    
    
    
    
        Case Step_Sagyo2_RES        '棚番／数量／伝票№
    
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    Case LCD_Tanaban    '棚番
                    
                        TO_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(TO_Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(TO_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2), "倉庫エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    NYUKO_TANA_OSAKA_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 混載チェック
                            If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                                If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                    StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    NYUKO_TANA_OSAKA_Proc = False
                                    Exit Function
                                End If
                            End If
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(TO_Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(TO_Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(TO_Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(TO_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    NYUKO_TANA_OSAKA_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                NYUKO_TANA_OSAKA_Proc = False
                                Exit Function
                            End If
            
                        End If
                   
                        ID_KANRI_TBL(ING_No).Tanaban = TO_Tanaban       '棚番をセーブ
                    
                    
                    Case LCD_Suryo      '数量
                        
                                    
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function

                        End If

                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))

                        If QTY > (ID_KANRI_TBL(ING_No).Send_MI_QTY + ID_KANRI_TBL(ING_No).Send_SUMI_QTY) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function
                        End If


                    Case LCD_DEN_No     '伝票№
                        
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "伝票№入力ミス", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function
                        End If
                        If CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "伝票№入力ミス", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function
                        End If
                                                                
                                    
                        ID_KANRI_TBL(ING_No).DEN_NO = Format(CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))), "000000")

                
                
                
                End Select
            Next i
    
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
            If ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = GOODS_ON Then
                MI_QTY = QTY
                SUMI_QTY = 0
            Else
                MI_QTY = 0
                SUMI_QTY = QTY
            End If
            sts = IDO_OSAKA_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    (NYUKA_SOKO_NO & "01" & "01" & "01"), _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    ID_KANRI_TBL(ING_No).DEN_NO, _
                                    ID_KANRI_TBL(ING_No).SEQ_NO, _
                                    FILE_RETRY, , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    NYUKO_TANA_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    NYUKO_TANA_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    NYUKO_TANA_OSAKA_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
    
    
'---------------------------------------------- '異常対処 2011.04.02
            If RECOVER_F Then
            
                Call UniCode_Conv(K0_Y_NYU_O.SEQ_NO, ID_KANRI_TBL(ING_No).SEQ_NO)
            
            
                RETRY_SU = 5
                RETRY_CNT = 0
                Do
                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                                    'リトライ回数チェック
                            If RETRY_SU <> 0 Then
                                
                                RETRY_CNT = RETRY_CNT + 1
                                If RETRY_CNT > RETRY_SU Then
                                                    '回数オーバー
                                    Call File_Error(sts, BtOpGetEqual, "入荷予定", 0)
                                    NYUKO_TANA_OSAKA_Proc = False
                                    Exit Function
                                End If
                            
                            End If
                            
                            DoEvents
                        Case Else
                            Call File_Error(sts, BtOpGetEqual, "入荷予定")
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function
                    End Select
                Loop
            
            
            
                Call UniCode_Conv(Y_NYU_O_REC.Y_SURYO, Format(QTY, "00000000"))
                Call UniCode_Conv(Y_NYU_O_REC.J_SURYO, Format(QTY, "00000000"))
            
            
            
                RETRY_SU = 5
                RETRY_CNT = 0
                Do
                    sts = BTRV(BtOpUpdate, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                                    'リトライ回数チェック
                            If RETRY_SU <> 0 Then
                                
                                RETRY_CNT = RETRY_CNT + 1
                                If RETRY_CNT > RETRY_SU Then
                                                    '回数オーバー
                                    Call File_Error(sts, BtOpGetEqual, "入荷予定", 0)
                                    NYUKO_TANA_OSAKA_Proc = False
                                    Exit Function
                                End If
                            
                            End If
                            
                            DoEvents
                        Case Else
                            Call File_Error(sts, BtOpGetEqual, "入荷予定")
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function
                    End Select
                Loop
            
            
            
            End If
'---------------------------------------------- '異常対処 2011.04.02
    
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    
    End Select
    
    
    NYUKO_TANA_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Private Function Y_Nyuka_O_Chek_Proc(Mode As Integer, _
                                        JGYOBU As String, _
                                        NAIGAI As String, _
                                        HIN_NO As String, _
                                        DEN_NO As String, _
                                        Found_F As Integer, _
                                        SEQ_NO As String, _
                                        SURYO As Long) As Integer
'-------------------------------------------------------
'
'   『入荷予定の使用予約』
'   大阪ＰＣ用  2007.06.07
'
'   mode   :1   入荷検品処理用
'   mode   :2   入庫処理用
'   mode   :3   出荷処理用
'
'
'   FOUND_F:0　データなし
'          :1  データあり（未処理）
'          :2  データあり（処理済）
'          :9  データ他で使用中
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer


Dim ans         As Integer

Dim RETRY_CNT   As Integer

Dim i           As Integer
Dim j           As Integer




    Y_Nyuka_O_Chek_Proc = True
    
    Select Case Mode
        
        Case 1
            '------------------------------------------------------ 入荷検品
            Found_F = 0
                
                
                
            SEQ_NO = ""
            
            com = BtOpGetFirst
            Do
                DoEvents
                sts = BTRV(com, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, com, "入荷予定", 0)
                        Y_Nyuka_O_Chek_Proc = SYS_ERR
                        Exit Function
                End Select
            
            
            
                If JGYOBU = StrConv(Y_NYU_O_REC.JGYOBU, vbUnicode) And _
                    NAIGAI = StrConv(Y_NYU_O_REC.NAIGAI, vbUnicode) And _
                    Trim(HIN_NO) = Trim(StrConv(Y_NYU_O_REC.HIN_NO, vbUnicode)) Then
        
        
                    If Trim(StrConv(Y_NYU_O_REC.WEL_ID, vbUnicode)) <> "" Then
                        Found_F = 9
                        Exit Do
                    Else
        
                        If CLng(StrConv(Y_NYU_O_REC.J_SURYO, vbUnicode)) = 0 Then
                        
                            DEN_NO = StrConv(Y_NYU_O_REC.DEN_NO, vbUnicode)
                            SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                            Found_F = 1
                        
                            Exit Do
                        End If
                    End If
            
                End If
                com = BtOpGetNext
            
            Loop
            
            
            If Found_F = 0 Then
                com = BtOpGetFirst
                Do
                    DoEvents
                    sts = BTRV(com, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call File_Error(sts, com, "入荷予定", 0)
                            Y_Nyuka_O_Chek_Proc = SYS_ERR
                            Exit Function
                    End Select
                
                
                
                    If JGYOBU = StrConv(Y_NYU_O_REC.JGYOBU, vbUnicode) And _
                        NAIGAI = StrConv(Y_NYU_O_REC.NAIGAI, vbUnicode) And _
                        Trim(HIN_NO) = Trim(StrConv(Y_NYU_O_REC.HIN_NO, vbUnicode)) Then
                        
                        DEN_NO = "000000"
                        SEQ_NO = "000"
                        Found_F = 2
                    
                        Exit Do
                
                    End If
                
                    com = BtOpGetNext
                Loop
            End If
            
            
            
            If Found_F = 1 Then
            
            
                Call UniCode_Conv(K0_Y_NYU_O.SEQ_NO, SEQ_NO)
                Do
                    DoEvents
                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrKeyNotFound
                            DEN_NO = StrConv(Y_NYU_O_REC.DEN_NO, vbUnicode)
                            SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                            Found_F = 9
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            RETRY_CNT = RETRY_CNT + 1
                            If RETRY_CNT > FILE_RETRY Then
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "入荷予定", 0)
                                Y_Nyuka_O_Chek_Proc = SYS_CANCEL
                                Exit Function
                            End If
                        Case Else
                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                            Y_Nyuka_O_Chek_Proc = SYS_ERR
                            Exit Function
                    End Select
                    
                                                            
                Loop
                        
                
                If sts <> BtErrKeyNotFound Then
                
                    Call UniCode_Conv(Y_NYU_O_REC.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
                    Call UniCode_Conv(Y_NYU_O_REC.PRG_ID, StrConv(App.EXEName, vbUpperCase))
                                                            
                    RETRY_CNT = 0
                                                            
                                                            '入荷予定書込み
                    Do
                        DoEvents
                        sts = BTRV(BtOpUpdate, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                RETRY_CNT = RETRY_CNT + 1
                                If RETRY_CNT > FILE_RETRY Then
                                    Call File_Error(sts, BtOpUpdate, "入荷予定", 0)
                                    Y_Nyuka_O_Chek_Proc = SYS_CANCEL
                                    Exit Function
                                End If
                            
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "入荷予定", 0)
                                Y_Nyuka_O_Chek_Proc = SYS_ERR
                                Exit Function
                        End Select
                    Loop
                
                End If
            
            End If
    
        Case 2
    
            '------------------------------------------------------ 入荷検品
            Found_F = 0
                
            SEQ_NO = ""
            
            com = BtOpGetFirst
            Do
                DoEvents
                sts = BTRV(com, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, com, "入荷予定", 0)
                        Y_Nyuka_O_Chek_Proc = SYS_ERR
                        Exit Function
                End Select
            
            
            
                If StrConv(Y_NYU_O_REC.KENPIN_F, vbUnicode) <> "1" Then
                Else
                    '検品済のみ対象とする
                    If JGYOBU = StrConv(Y_NYU_O_REC.JGYOBU, vbUnicode) And _
                        NAIGAI = StrConv(Y_NYU_O_REC.NAIGAI, vbUnicode) And _
                        Trim(HIN_NO) = Trim(StrConv(Y_NYU_O_REC.HIN_NO, vbUnicode)) Then
        
        
                        If Trim(StrConv(Y_NYU_O_REC.WEL_ID, vbUnicode)) <> "" Then
                            Found_F = 9
                            Exit Do
                        Else
        
                            
                            DEN_NO = StrConv(Y_NYU_O_REC.DEN_NO, vbUnicode)
                            SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                            SURYO = CLng(StrConv(Y_NYU_O_REC.J_SURYO, vbUnicode))
                            Found_F = 1
                        
                            Exit Do
                        End If
            
                    End If
                End If
                com = BtOpGetNext
            
            Loop
    
            If Found_F = 1 Then
            
            
                Call UniCode_Conv(K0_Y_NYU_O.SEQ_NO, SEQ_NO)
                Do
                    DoEvents
                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrKeyNotFound
                            DEN_NO = StrConv(Y_NYU_O_REC.DEN_NO, vbUnicode)
                            SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                            Found_F = 9
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            RETRY_CNT = RETRY_CNT + 1
                            If RETRY_CNT > FILE_RETRY Then
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "入荷予定", 0)
                                Y_Nyuka_O_Chek_Proc = SYS_CANCEL
                                Exit Function
                            End If
                        Case Else
                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                            Y_Nyuka_O_Chek_Proc = SYS_ERR
                            Exit Function
                    End Select
                    
                                                            
                Loop
    
    
            End If
    
    
        Case 3
    
            '------------------------------------------------------ 出荷時ﾁｪｯｸ
            Found_F = 0
                
            SEQ_NO = ""
            
            com = BtOpGetFirst
            Do
                DoEvents
                sts = BTRV(com, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, com, "入荷予定", 0)
                        Y_Nyuka_O_Chek_Proc = SYS_ERR
                        Exit Function
                End Select
            
            
                '伝票番号入力済のみ対象とする
                If JGYOBU = StrConv(Y_NYU_O_REC.JGYOBU, vbUnicode) And _
                    NAIGAI = StrConv(Y_NYU_O_REC.NAIGAI, vbUnicode) And _
                    Trim(HIN_NO) = Trim(StrConv(Y_NYU_O_REC.HIN_NO, vbUnicode)) Then
                        
                    DEN_NO = StrConv(Y_NYU_O_REC.DEN_NO, vbUnicode)
                    SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                    SURYO = CLng(StrConv(Y_NYU_O_REC.J_SURYO, vbUnicode))
        
                    Found_F = 1
        
                    If Trim(DEN_NO) = "" Or DEN_NO = "000000" Then
                        Exit Do
                    End If
            
                End If
                com = BtOpGetNext
            
            Loop
    
    
    
    End Select
    
    
    
    Y_Nyuka_O_Chek_Proc = False
    

End Function

Private Function Furikae_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『資材振替　指定時のチェック＆更新処理』    2007.06.28
'
'-------------------------------------------------------
Dim i           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07
Dim Tanaban     As String * 8
Dim sts         As Integer

Dim QTY         As Long
Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1

Dim MENU_NO     As String * 2

Dim WK_CODE     As String * 5
Dim WK_TANKA    As String * 11

Dim SYUSHI      As String * 3

    Furikae_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Tanaban        '棚番
                Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                
                If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                Else
                '------------------ 倉庫マスタ読込み
                    Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                    sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                            Furikae_Proc = False
                            Exit Function
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                            Exit Function
                    End Select
                    '------------------ 混載チェック
                    If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                        If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                            StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Furikae_Proc = False
                            Exit Function
                        End If
                    End If
                    '------------------ 棚マスタ読込み
                    Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                    Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                    Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                    Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Furikae_Proc = False
                            Exit Function
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                            Exit Function
                    End Select
            
                    '------------------ 禁止棚のチェック
                    If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")
                
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                        Furikae_Proc = False
                        Exit Function
                    End If
            
            
                End If
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                '------------------ 品目マスタ読込み
'                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                        If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                            Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                    Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Furikae_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                        End If
                    
                        If RET_JGYOBU <> SHIZAI Or RET_NAIGAI <> NAIGAI_NAI Then
                        '   -------------------------------- エラーメッセージ作成
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "資材品番のみ有効", "", "")
            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Furikae_Proc = False
                            Exit Function
                        End If
                    
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Furikae_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
            
            Case LCD_Suryo          '数量
                If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Furikae_Proc = False
                    Exit Function
                End If
                
                QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                If QTY = 0 Then
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Furikae_Proc = False
                    Exit Function
                End If
            
            
            Case LCD_SYUSHI         '収支
                
                SYUSHI = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                
                If SYUSHI = Trim(StrConv(ITEMREC.G_SYUSHI, vbUnicode)) Then
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, SYUSHI, "同一収支です", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Furikae_Proc = False
                    Exit Function
                End If
                
                '------------------ コードマスタ読込み
                Call UniCode_Conv(K0_P_CODE.DATA_KBN, P_KBN03_CD)
                Call UniCode_Conv(K0_P_CODE.C_Code, SYUSHI)
                sts = BTRV(BtOpGetEqual, P_CODE_POS, P_CODEREC, Len(P_CODEREC), K0_P_CODE, Len(K0_P_CODE), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                    '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, SYUSHI, "収支エラー", "", "")
        
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
    
                        Furikae_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                        Exit Function
                End Select
        
        End Select
    Next i
    '----------------------------------- データ更新処理開始 -----------
                                        
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Exit Function
    End If
                                        
                                        
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
                                        
                                        
                                        '出庫更新
    sts = Syuko_Update_Proc(RET_JGYOBU, _
                            RET_NAIGAI, _
                            Hinban, _
                            "", _
                            Tanaban, _
                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                            0, _
                            QTY, _
                            0, _
                            Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                            ID_KANRI_TBL(ING_No).TANTO_CODE, _
                            FILE_RETRY, , , , , , , MENU_NO)
    Select Case sts
        Case False
        
        Case True       '在庫不足時に発生
            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "在庫数不足", "")
            Sendbuf = Text_Create_Proc()
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
            Furikae_Proc = False
            GoTo Abort_Tran
        Case SYS_CANCEL
            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
            Sendbuf = Text_Create_Proc()
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
            Furikae_Proc = False
            GoTo Abort_Tran
        Case SYS_ERR
            Sendbuf = Text_Create_Proc()
            Call Err_Send_Proc("システム異常発生", "", "", "", "")
            Furikae_Proc = SYS_ERR      'システム異常発生
            
            GoTo Abort_Tran
    End Select

    '-----------------  入庫情報出力
    sts = S_NYUKO_Update_Proc(Hinban, QTY, SYUSHI)
    Select Case sts
        Case False
        Case True           '入庫時は発生しない
        Case SYS_CANCEL
            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
            Sendbuf = Text_Create_Proc()
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
            Furikae_Proc = False
            GoTo Abort_Tran
        Case SYS_ERR
            Call Err_Send_Proc("システム異常発生", "", "", "", "")
            Sendbuf = Text_Create_Proc()
            Furikae_Proc = SYS_ERR    'システム異常発生
            
            GoTo Abort_Tran
    End Select







End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        GoTo Abort_Tran
    End If
                                        '次の作業要求
    
    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
    Select Case sts
        Case BtNoErr
        '   -------------------------------- エラーメッセージ作成
        Case Else
        '重要な要因なので未登録はシステム停止とする
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
        Exit Function
    End Select
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
    If Sagyo_Send_Proc() Then
        Sendbuf = Text_Create_Proc()
        Exit Function
    End If
            
    Sendbuf = Text_Create_Proc()
    
    
    
    Furikae_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Private Function S_NYUKO_Update_Proc(Hinban As String, QTY As Long, SYUSHI As String) As Integer
'----------------------------------------------------------------------------
'                  資材注文ﾃﾞｰﾀ更新 2007.06.28
'----------------------------------------------------------------------------
Dim sts         As Integer
Dim ans         As Integer
Dim com         As Integer

Dim SEQNO       As Integer

Dim RETRY_CNT   As Integer


    S_NYUKO_Update_Proc = True
                                        
                                        
    '---------------------------------------------------    '資材注文データ更新 (振替元)
                                        '管理ファイルより資材注文番号の獲得
    Call UniCode_Conv(K0_P_KANRI.REC_NO, P_ST_KANRI_No)
        
    RETRY_CNT = 0
        
    Do
        sts = BTRV(BtOpGetEqual + BtSNoWait, P_KANRI_POS, P_KANRIREC, Len(P_KANRIREC), K0_P_KANRI, Len(K0_P_KANRI), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrKeyNotFound
            
                If P_KANRI_MAKE_Proc() Then
                    S_NYUKO_Update_Proc = SYS_ERR
                    Exit Function
                End If
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE         'これは無い
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
            
        End Select
        
        
    Loop
    
    '注文書№＋１

    If CLng(StrConv(P_KANRIREC.ORDER_NO, vbUnicode)) = 99999 Then
        Call UniCode_Conv(P_KANRIREC.ORDER_NO, "00001")
    Else
        Call UniCode_Conv(P_KANRIREC.ORDER_NO, Format(CLng(StrConv(P_KANRIREC.ORDER_NO, vbUnicode)) + 1, "00000"))
    End If


    RETRY_CNT = 0
    Do
        
        DoEvents
        
        sts = BTRV(BtOpUpdate, P_KANRI_POS, P_KANRIREC, Len(P_KANRIREC), K0_P_KANRI, Len(K0_P_KANRI), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpUpdate, "管理マスタ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
    Loop
                                                                            
                                                                            
    '品目ﾏｽﾀ読込み
    Call UniCode_Conv(K0_ITEM.JGYOBU, SHIZAI)
    Call UniCode_Conv(K0_ITEM.NAIGAI, NAIGAI_NAI)
    Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
    sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_CANCEL
            Exit Function
        Case Else
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_ERR
            Exit Function
    End Select
                                                                            
                                                                            '注文№
    Call UniCode_Conv(P_SHORDER_REC.ORDER_NO, StrConv(P_KANRIREC.ORDER_NO, vbUnicode))
    Call UniCode_Conv(P_SHORDER_REC.ORDER_DT, Format(Now, "YYYYMMDD"))      '注文日
    Call UniCode_Conv(P_SHORDER_REC.Print_datetime, "")                     '発行日時
    Call UniCode_Conv(P_SHORDER_REC.TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)   '担当者
    Call UniCode_Conv(P_SHORDER_REC.JGYOBU, SHIZAI)                         '事業部（＝資材）
    Call UniCode_Conv(P_SHORDER_REC.NAIGAI, NAIGAI_NAI)                     '国内外
    Call UniCode_Conv(P_SHORDER_REC.HIN_GAI, Hinban)         '品番
                                                                            '注文先ｺｰﾄﾞ
    Call UniCode_Conv(P_SHORDER_REC.ORDER_CODE, StrConv(ITEMREC.G_SHIIRE_TBL(0).CODE, vbUnicode))
    Call UniCode_Conv(P_SHORDER_REC.DELI_CODE, "")                          '納入先ｺｰﾄﾞ
                                                                            '注文数
    Call UniCode_Conv(P_SHORDER_REC.ORDER_QTY, Format(QTY * -1, _
                                                                "00000000.00"))
        
    Call UniCode_Conv(P_SHORDER_REC.Y_NOUKI_DT, Format(Now, "YYYYMMDD"))    '予定納期
        
    If IsNumeric(StrConv(ITEMREC.G_ST_SHITAN, vbUnicode)) Then              '単価
        Call UniCode_Conv(P_SHORDER_REC.TANKA, Format(CDbl(StrConv(ITEMREC.G_ST_SHITAN, vbUnicode)), _
                                                            "00000000.00"))
    Else
        Call UniCode_Conv(P_SHORDER_REC.TANKA, "00000000.00")
    End If
    Call UniCode_Conv(P_SHORDER_REC.LOT, "00000001")                        'LOT
    
    Call UniCode_Conv(P_SHORDER_REC.KAN_F, P_KAN_ON)                        '完了ﾌﾗｸﾞ（即完了）
    Call UniCode_Conv(P_SHORDER_REC.KAN_DT, Format(Now, "YYYYMMDD"))        '完了日
    Call UniCode_Conv(P_SHORDER_REC.BUNNOU_CNT, "01")                       '受入回数
    Call UniCode_Conv(P_SHORDER_REC.UKEIRE_QTY, Format(QTY * -1, "00000000.00"))
    
    Call UniCode_Conv(P_SHORDER_REC.CANCEL_F, P_CANCEL_OFF)                 'ｷｬﾝｾﾙﾌﾗｸﾞ
    Call UniCode_Conv(P_SHORDER_REC.CANCEL_DATETIME, "")                    'ｷｬﾝｾﾙ日時
    
    Call UniCode_Conv(P_SHORDER_REC.PRINT_F, P_PRINT_ON)                    '印刷ﾌﾗｸﾞ(印刷済とする)
    
    Call UniCode_Conv(P_SHORDER_REC.WS_NO, Format(ID_KANRI_TBL(ING_No).ID, "000"))        '入力端末
                                                                            '仕入区分
    Call UniCode_Conv(P_SHORDER_REC.G_SHIIRE_KBN, StrConv(ITEMREC.G_SHIIRE_KBN, vbUnicode))
        
    '収支単位
    Call UniCode_Conv(P_SHORDER_REC.G_SYUSHI, StrConv(ITEMREC.G_SYUSHI, vbUnicode))
        
        
    '受払先ﾏｽﾀ読込み
    Call UniCode_Conv(K0_P_UKEHARAI.UKEHARAI_CODE, StrConv(ITEMREC.G_SHIIRE_TBL(0).CODE, vbUnicode))
    sts = BTRV(BtOpGetEqual, P_UKEHARAI_POS, P_UKEHARAIREC, Len(P_UKEHARAIREC), K0_P_UKEHARAI, Len(K0_P_UKEHARAI), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "受払先ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_CANCEL
            Exit Function
        Case Else
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "受払先ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_ERR
            Exit Function
    End Select
    
                                                                                '取引先区分
    Call UniCode_Conv(P_SHORDER_REC.TORI_KBN, StrConv(P_UKEHARAIREC.TORI_KBN, vbUnicode))
        
        
    Call UniCode_Conv(P_SHORDER_REC.FILLER, "")

    RETRY_CNT = 0

    Do
        
        DoEvents
        
        sts = BTRV(BtOpInsert, P_SHORDER_POS, P_SHORDER_REC, Len(P_SHORDER_REC), K0_P_SHORDER, Len(K0_P_SHORDER), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpInsert, "資材注文ﾃﾞｰﾀ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpInsert, "資材注文ﾃﾞｰﾀ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
    
    Loop
    
    
    
    
    SEQNO = 0
    
    
    
    '資材受入履歴ﾃﾞｰﾀ処理
    Call UniCode_Conv(K0_P_SHUKEIRE.ORDER_NO, StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode))
    Call UniCode_Conv(K0_P_SHUKEIRE.SEQNO, "")
    
    com = BtOpGetGreater
    
    Do
    
        sts = BTRV(com, P_SHUKEIRE_POS, P_SHUKEIRE_REC, Len(P_SHUKEIRE_REC), K0_P_SHUKEIRE, Len(K0_P_SHUKEIRE), 0)
            
        Select Case sts
            Case BtNoErr
            
                If StrConv(P_SHUKEIRE_REC.ORDER_NO, vbUnicode) <> StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode) Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            
            Case Else
                Call File_Error(sts, com, "資材受入履歴", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
                
        End Select
        
        
        
        SEQNO = SEQNO + 1
        
        
        com = BtOpGetNext
        
    Loop
        
                                                                                '注文№
    Call UniCode_Conv(P_SHUKEIRE_REC.ORDER_NO, StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode))                                                                                         '受入日
                                                                                '注文先
    Call UniCode_Conv(P_SHUKEIRE_REC.ORDER_CODE, StrConv(P_SHORDER_REC.ORDER_CODE, vbUnicode))
                                                                                '受入日
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_DT, Format(Now, "YYYYMMDD"))
                                                                                '受入数量
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_QTY, Format(QTY * -1, "00000000.00"))
                                                                                '受入単価
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_TANKA, StrConv(P_SHORDER_REC.TANKA, vbUnicode))
                                                                                '受入金額
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_KINGAKU, Format(QTY * -1 * _
                                                        CDbl(StrConv(P_SHORDER_REC.TANKA, vbUnicode)), "00000000"))
    Call UniCode_Conv(P_SHUKEIRE_REC.LAST_F, P_UKEIRE_END)
                                                                                '計上年月
    Call UniCode_Conv(P_SHUKEIRE_REC.KEIJYO_YM, Left(Format(Now, "YYYYMMDD"), 6))
        
    Call UniCode_Conv(P_SHUKEIRE_REC.FILLER, "")
                                                        '更新日時
    Call UniCode_Conv(P_SHUKEIRE_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))
    
    
    RETRY_CNT = 0
    Do
            
        SEQNO = SEQNO + 1
                                                '追番
        Call UniCode_Conv(P_SHUKEIRE_REC.SEQNO, Format(SEQNO, "000"))
            
        DoEvents
            
        sts = BTRV(BtOpInsert, P_SHUKEIRE_POS, P_SHUKEIRE_REC, Len(P_SHUKEIRE_REC), K0_P_SHUKEIRE, Len(K0_P_SHUKEIRE), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrDuplicates
            
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpInsert, "資材受入履歴", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpInsert, "資材受入履歴", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
        
    Loop



    '---------------------------------------------------    '資材注文データ更新 (振替先)
                                        '管理ファイルより資材注文番号の獲得
    Call UniCode_Conv(K0_P_KANRI.REC_NO, P_ST_KANRI_No)
        
    RETRY_CNT = 0
        
    Do
        sts = BTRV(BtOpGetEqual + BtSNoWait, P_KANRI_POS, P_KANRIREC, Len(P_KANRIREC), K0_P_KANRI, Len(K0_P_KANRI), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrKeyNotFound
            
                If P_KANRI_MAKE_Proc() Then
                    S_NYUKO_Update_Proc = SYS_ERR
                    Exit Function
                End If
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE         'これは無い
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
            
        End Select
        
        
    Loop
    
    '注文書№＋１

    If CLng(StrConv(P_KANRIREC.ORDER_NO, vbUnicode)) = 99999 Then
        Call UniCode_Conv(P_KANRIREC.ORDER_NO, "00001")
    Else
        Call UniCode_Conv(P_KANRIREC.ORDER_NO, Format(CLng(StrConv(P_KANRIREC.ORDER_NO, vbUnicode)) + 1, "00000"))
    End If


    RETRY_CNT = 0
    Do
        
        DoEvents
        
        sts = BTRV(BtOpUpdate, P_KANRI_POS, P_KANRIREC, Len(P_KANRIREC), K0_P_KANRI, Len(K0_P_KANRI), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpUpdate, "管理マスタ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
    Loop
                                                                            
                                                                            
    '品目ﾏｽﾀ読込み
    Call UniCode_Conv(K0_ITEM.JGYOBU, SHIZAI)
    Call UniCode_Conv(K0_ITEM.NAIGAI, NAIGAI_NAI)
    Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
    sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_CANCEL
            Exit Function
        Case Else
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_ERR
            Exit Function
    End Select
                                                                            
                                                                            '注文№
    Call UniCode_Conv(P_SHORDER_REC.ORDER_NO, StrConv(P_KANRIREC.ORDER_NO, vbUnicode))
    Call UniCode_Conv(P_SHORDER_REC.ORDER_DT, Format(Now, "YYYYMMDD"))      '注文日
    Call UniCode_Conv(P_SHORDER_REC.Print_datetime, "")                     '発行日時
    Call UniCode_Conv(P_SHORDER_REC.TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)   '担当者
    Call UniCode_Conv(P_SHORDER_REC.JGYOBU, SHIZAI)                         '事業部（＝資材）
    Call UniCode_Conv(P_SHORDER_REC.NAIGAI, NAIGAI_NAI)                     '国内外
    Call UniCode_Conv(P_SHORDER_REC.HIN_GAI, Hinban)         '品番
                                                                            '注文先ｺｰﾄﾞ
    Call UniCode_Conv(P_SHORDER_REC.ORDER_CODE, StrConv(ITEMREC.G_SHIIRE_TBL(0).CODE, vbUnicode))
    Call UniCode_Conv(P_SHORDER_REC.DELI_CODE, "")                          '納入先ｺｰﾄﾞ
                                                                            '注文数
    Call UniCode_Conv(P_SHORDER_REC.ORDER_QTY, Format(QTY, "00000000.00"))
        
    Call UniCode_Conv(P_SHORDER_REC.Y_NOUKI_DT, Format(Now, "YYYYMMDD"))    '予定納期
        
    If IsNumeric(StrConv(ITEMREC.G_ST_SHITAN, vbUnicode)) Then              '単価
        Call UniCode_Conv(P_SHORDER_REC.TANKA, Format(CDbl(StrConv(ITEMREC.G_ST_SHITAN, vbUnicode)), _
                                                            "00000000.00"))
    Else
        Call UniCode_Conv(P_SHORDER_REC.TANKA, "00000000.00")
    End If
    Call UniCode_Conv(P_SHORDER_REC.LOT, "00000001")                        'LOT
    
    Call UniCode_Conv(P_SHORDER_REC.KAN_F, P_KAN_ON)                        '完了ﾌﾗｸﾞ（即完了）
    Call UniCode_Conv(P_SHORDER_REC.KAN_DT, Format(Now, "YYYYMMDD"))        '完了日
    Call UniCode_Conv(P_SHORDER_REC.BUNNOU_CNT, "01")                       '受入回数
    Call UniCode_Conv(P_SHORDER_REC.UKEIRE_QTY, Format(QTY, "00000000.00"))
    
    Call UniCode_Conv(P_SHORDER_REC.CANCEL_F, P_CANCEL_OFF)                 'ｷｬﾝｾﾙﾌﾗｸﾞ
    Call UniCode_Conv(P_SHORDER_REC.CANCEL_DATETIME, "")                    'ｷｬﾝｾﾙ日時
    
    Call UniCode_Conv(P_SHORDER_REC.PRINT_F, P_PRINT_ON)                    '印刷ﾌﾗｸﾞ(印刷済とする)
    
    Call UniCode_Conv(P_SHORDER_REC.WS_NO, Format(ID_KANRI_TBL(ING_No).ID, "000"))        '入力端末
                                                                            '仕入区分
    Call UniCode_Conv(P_SHORDER_REC.G_SHIIRE_KBN, StrConv(ITEMREC.G_SHIIRE_KBN, vbUnicode))
        
    '収支単位
    Call UniCode_Conv(P_SHORDER_REC.G_SYUSHI, SYUSHI)
        
        
    '受払先ﾏｽﾀ読込み
    Call UniCode_Conv(K0_P_UKEHARAI.UKEHARAI_CODE, StrConv(ITEMREC.G_SHIIRE_TBL(0).CODE, vbUnicode))
    sts = BTRV(BtOpGetEqual, P_UKEHARAI_POS, P_UKEHARAIREC, Len(P_UKEHARAIREC), K0_P_UKEHARAI, Len(K0_P_UKEHARAI), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "受払先ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_CANCEL
            Exit Function
        Case Else
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "受払先ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_ERR
            Exit Function
    End Select
    
                                                                                '取引先区分
    Call UniCode_Conv(P_SHORDER_REC.TORI_KBN, StrConv(P_UKEHARAIREC.TORI_KBN, vbUnicode))
        
        
    Call UniCode_Conv(P_SHORDER_REC.FILLER, "")

    RETRY_CNT = 0

    Do
        
        DoEvents
        
        sts = BTRV(BtOpInsert, P_SHORDER_POS, P_SHORDER_REC, Len(P_SHORDER_REC), K0_P_SHORDER, Len(K0_P_SHORDER), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpInsert, "資材注文ﾃﾞｰﾀ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpInsert, "資材注文ﾃﾞｰﾀ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
    
    Loop
    
    
    
    
    SEQNO = 0
    
    
    
    '資材受入履歴ﾃﾞｰﾀ処理
    Call UniCode_Conv(K0_P_SHUKEIRE.ORDER_NO, StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode))
    Call UniCode_Conv(K0_P_SHUKEIRE.SEQNO, "")
    
    com = BtOpGetGreater
    
    Do
    
        sts = BTRV(com, P_SHUKEIRE_POS, P_SHUKEIRE_REC, Len(P_SHUKEIRE_REC), K0_P_SHUKEIRE, Len(K0_P_SHUKEIRE), 0)
            
        Select Case sts
            Case BtNoErr
            
                If StrConv(P_SHUKEIRE_REC.ORDER_NO, vbUnicode) <> StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode) Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            
            Case Else
                Call File_Error(sts, com, "資材受入履歴", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
                
        End Select
        
        
        
        SEQNO = SEQNO + 1
        
        
        com = BtOpGetNext
        
    Loop
        
                                                                                '注文№
    Call UniCode_Conv(P_SHUKEIRE_REC.ORDER_NO, StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode))                                                                                         '受入日
                                                                                '注文先
    Call UniCode_Conv(P_SHUKEIRE_REC.ORDER_CODE, StrConv(P_SHORDER_REC.ORDER_CODE, vbUnicode))
                                                                                '受入日
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_DT, Format(Now, "YYYYMMDD"))
                                                                                '受入数量
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_QTY, Format(QTY, "00000000.00"))
                                                                                '受入単価
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_TANKA, StrConv(P_SHORDER_REC.TANKA, vbUnicode))
                                                                                '受入金額
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_KINGAKU, Format(QTY * _
                                                        CDbl(StrConv(P_SHORDER_REC.TANKA, vbUnicode)), "00000000"))
    Call UniCode_Conv(P_SHUKEIRE_REC.LAST_F, P_UKEIRE_END)
                                                                                '計上年月
    Call UniCode_Conv(P_SHUKEIRE_REC.KEIJYO_YM, Left(Format(Now, "YYYYMMDD"), 6))
        
    Call UniCode_Conv(P_SHUKEIRE_REC.FILLER, "")
                                                        '更新日時
    Call UniCode_Conv(P_SHUKEIRE_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))
    
    
    RETRY_CNT = 0
    Do
            
        SEQNO = SEQNO + 1
                                                '追番
        Call UniCode_Conv(P_SHUKEIRE_REC.SEQNO, Format(SEQNO, "000"))
            
        DoEvents
            
        sts = BTRV(BtOpInsert, P_SHUKEIRE_POS, P_SHUKEIRE_REC, Len(P_SHUKEIRE_REC), K0_P_SHUKEIRE, Len(K0_P_SHUKEIRE), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrDuplicates
            
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpInsert, "資材受入履歴", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpInsert, "資材受入履歴", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
        
    Loop


    
    S_NYUKO_Update_Proc = False
    
End Function

Private Function SYUKA_CANCEL_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『出荷予定キャンセル処理』
'   2007.11.02
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8


Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim JITU_QTY        As Long

Dim SYUKO_QTY       As Long
Dim KENPIN_YMD      As String * 8


Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim KAN_KBN         As String * 1

Dim MENU_NO         As String * 2

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim CAN_ANS         As String * 1

Dim RETRY_CNT       As Integer

    SYUKA_CANCEL_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            RET_JGYOBU = Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 1)
                            ID_NO = Right(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 12)
                        Else
                            RET_JGYOBU = ID_KANRI_TBL(ING_No).JGYOBU
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                RET_JGYOBU, _
                                                RET_NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY, _
                                                , _
                                                KENPIN_YMD, _
                                                SYUKO_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKA_CANCEL_Proc = False
                                    Exit Function
                                End If
                
                
                
                
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKA_CANCEL_Proc = False
                                Exit Function
                        End Select
                
                
                        If KAN_KBN <> KAN_KBN_UN Then
                            
                            
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                            
                            
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫処理済み", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKA_CANCEL_Proc = False
                            Exit Function
                        End If
                                                        
                                                        
                                                        
                        If SYUKO_QTY <> 0 Or Trim(KENPIN_YMD) <> "" Then
                            
                            
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                            
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫実績有り", "キャンセル不可", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKA_CANCEL_Proc = False
                            Exit Function
                        End If
                                                        
                                                        
                                                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                           
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_CAN_ANS)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_CAN_ANS)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "20"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（はい／いいえ）
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                    
                    Case LCD_CAN_ANS    '（はい／いいえ）
                        CAN_ANS = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        Select Case CAN_ANS
                        
                        
                        
                            Case "1"        'はい　データ更新
                        
                        
                        
                                '----------------------------------- データ更新処理開始 -----------
                                                                    'トランザクション開始
                                sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    Exit Function
                                End If
                                            
            
            
            
            
                                                        '出荷予定読込み
                                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).S_JGYOBU)   '事業部
                                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'IDNo

                                RETRY_CNT = 0
                                Do
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            
                                            SYUKA_CANCEL_Proc = False
                                            GoTo Abort_Tran
                                                
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'リトライ回数チェック
                                            If FILE_RETRY <> 0 Then
    
                                                RETRY_CNT = RETRY_CNT + 1
                                                If RETRY_CNT > FILE_RETRY Then
                                                            '回数オーバー
                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                                                    Sendbuf = Text_Create_Proc()
                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                                    
                                                    SYUKA_CANCEL_Proc = False
                                                    GoTo Abort_Tran
    
                                                End If
    
                                            End If
    
                                            DoEvents
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                            SYUKA_CANCEL_Proc = SYS_ERR
                                            GoTo Abort_Tran
                                    End Select
                                Loop
            
                                                        '出荷予定削除
                                Do
                                
                                
                                    sts = BTRV(BtOpDelete, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            
                                            SYUKA_CANCEL_Proc = False
                                            GoTo Abort_Tran
                                                
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'リトライ回数チェック
                                            If FILE_RETRY <> 0 Then
    
                                                RETRY_CNT = RETRY_CNT + 1
                                                If RETRY_CNT > FILE_RETRY Then
                                                            '回数オーバー
                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                                                    Sendbuf = Text_Create_Proc()
                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                                    
                                                    SYUKA_CANCEL_Proc = False
                                                    GoTo Abort_Tran
    
                                                End If
    
                                            End If
    
                                            DoEvents
                                        Case Else
                                            Call File_Error(sts, BtOpDelete, "出荷予定", 0)
                                            SYUKA_CANCEL_Proc = SYS_ERR
                                            GoTo Abort_Tran
                                    End Select
                                
                                
                                Loop
            
            
                                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                    If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                                                ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                                ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                                ID_KANRI_TBL(ING_No).MENU_LV1, _
                                                                ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                                                ID_KANRI_TBL(ING_No).Hinban, _
                                                                0, 0, , , _
                                                                ID_KANRI_TBL(ING_No).ID_NO, _
                                                                ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                                ID_KANRI_TBL(ING_No).SS_CODE) Then
        

                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpEndTransaction, "", 0)
                                        GoTo Abort_Tran
                                    End If
                                End If
                                                
                                If SYUKA_LOG_ON Then
                                    Call SYUKA_LOG_OUT_PROC("DEL", "AFT")
                                End If
                                                
                                                
                                                'トランザクション終了
                                sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpEndTransaction, "", 0)
                                    GoTo Abort_Tran
                                End If
                                        
                                        
                                        
                                        
                                        
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.fileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                        
                                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                
                                
                                '-----------------------------------------------１行目
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "キャンセルしました")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "キャンセルしました")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                        '入力桁数
                                                                                        
                                                                                        
                                Send_Text.Box_Type(3).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                        
                                                                                        
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                            Case "9"        'いいえ　処理なし
                                        
                                            
                                sts = Data_Clear_Proc(0, Sendbuf)
                                Select Case sts
                                    Case SYS_CANCEL
                                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    
                                    Case SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
                                        
                                        
                                                '次の作業要求
                                                
                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                    
                                Sendbuf = Text_Create_Proc()
                        Case Else
                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, CAN_ANS, "(1 OR 9)", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKA_CANCEL_Proc = False
                                Exit Function
                
                
                    End Select
                End Select
            Next i
        
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                '検品確認終了時は、伝票ＩＤ要求に戻す為の特殊処理
                
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "12"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()


'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
            
                Sendbuf = Text_Create_Proc()
    
    
    End Select
    SYUKA_CANCEL_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function



Private Function SYUKO_CANCEL_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『出庫キャンセル処理』
'   2008.12.05
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8


Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim JITU_QTY        As Long

Dim SYUKO_QTY       As Long
Dim KENPIN_YMD      As String * 8


Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim KAN_KBN         As String * 1

Dim MENU_NO         As String * 2

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim CAN_ANS         As String * 1

Dim RETRY_CNT       As Integer

    SYUKO_CANCEL_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            RET_JGYOBU = Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 1)
                            ID_NO = Right(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 12)
                        Else
                            RET_JGYOBU = ID_KANRI_TBL(ING_No).JGYOBU
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                RET_JGYOBU, _
                                                RET_NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY, _
                                                , _
                                                KENPIN_YMD, _
                                                SYUKO_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_CANCEL_Proc = False
                                    Exit Function
                                End If
                
                
                
                
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_CANCEL_Proc = False
                                Exit Function
                        End Select
                
                                                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                           
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_CAN_ANS)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_CAN_ANS)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "20"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（はい／いいえ）
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                    
                    Case LCD_CAN_ANS    '（はい／いいえ）
                        CAN_ANS = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        Select Case CAN_ANS
                        
                        
                        
                            Case "1"        'はい　データ更新
                        
                        
                        
                                '----------------------------------- データ更新処理開始 -----------
                                                                    'トランザクション開始
                                sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    Exit Function
                                End If
                                            
            
            
            
            
                                                        '出荷予定読込み
                                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).S_JGYOBU)   '事業部
                                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'IDNo

                                RETRY_CNT = 0
                                Do
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            
                                            SYUKO_CANCEL_Proc = False
                                            GoTo Abort_Tran
                                                
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'リトライ回数チェック
                                            If FILE_RETRY <> 0 Then
    
                                                RETRY_CNT = RETRY_CNT + 1
                                                If RETRY_CNT > FILE_RETRY Then
                                                            '回数オーバー
                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                                                    Sendbuf = Text_Create_Proc()
                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                                    
                                                    SYUKO_CANCEL_Proc = False
                                                    GoTo Abort_Tran
    
                                                End If
    
                                            End If
    
                                            DoEvents
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                            SYUKO_CANCEL_Proc = SYS_ERR
                                            GoTo Abort_Tran
                                    End Select
                                Loop
            
                                                        '出荷予定クリアー更新
                                
                                '完了区分
                                Call UniCode_Conv(Y_SYUREC.KAN_KBN, KAN_KBN_UN)
                                '完了日付
                                Call UniCode_Conv(Y_SYUREC.KAN_YMD, "")
                                '検品日付
                                Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, "")
                                '実績数量
                                Call UniCode_Conv(Y_SYUREC.JITU_SURYO, "0000000")
                                '検品担当者
                                Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, "")
                                '検品時刻
                                Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, "")
    
                                '画面検品ﾌﾗｸﾞ
                                Call UniCode_Conv(Y_SYUREC.G_KENPIN_F, "")
                                '検品時数量
                                Call UniCode_Conv(Y_SYUREC.KENPIN_SURYO, "0000000")
    
    
                                
                                Do
                                
                                
                                    sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            
                                            SYUKO_CANCEL_Proc = False
                                            GoTo Abort_Tran
                                                
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'リトライ回数チェック
                                            If FILE_RETRY <> 0 Then
    
                                                RETRY_CNT = RETRY_CNT + 1
                                                If RETRY_CNT > FILE_RETRY Then
                                                            '回数オーバー
                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                                                    Sendbuf = Text_Create_Proc()
                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                                    
                                                    SYUKO_CANCEL_Proc = False
                                                    GoTo Abort_Tran
    
                                                End If
    
                                            End If
    
                                            DoEvents
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                            SYUKO_CANCEL_Proc = SYS_ERR
                                            GoTo Abort_Tran
                                    End Select
                                
                                
                                Loop
            
            
                                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                    If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                                                ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                                ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                                ID_KANRI_TBL(ING_No).MENU_LV1, _
                                                                ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                                                ID_KANRI_TBL(ING_No).Hinban, _
                                                                0, 0, , , _
                                                                ID_KANRI_TBL(ING_No).ID_NO, _
                                                                ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                                ID_KANRI_TBL(ING_No).SS_CODE) Then
        

                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpEndTransaction, "", 0)
                                        GoTo Abort_Tran
                                    End If
                                End If
                                                
'                                If SYUKA_LOG_ON Then
'                                    Call SYUKA_LOG_OUT_PROC("DEL", "AFT")
'                                End If
                                                
                                                
                                                'トランザクション終了
                                sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpEndTransaction, "", 0)
                                    GoTo Abort_Tran
                                End If
                                        
                                        
                                        
                                        
                                        
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.fileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                        
                                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                
                                
                                '-----------------------------------------------１行目
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "キャンセルしました")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "キャンセルしました")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                        '入力桁数
                                                                                        
                                                                                        
                                Send_Text.Box_Type(3).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                        
                                                                                        
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                            Case "9"        'いいえ　処理なし
                                        
                                            
                                sts = Data_Clear_Proc(0, Sendbuf)
                                Select Case sts
                                    Case SYS_CANCEL
                                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    
                                    Case SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
                                        
                                        
                                                '次の作業要求
                                                
                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                    
                                Sendbuf = Text_Create_Proc()
                        Case Else
                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, CAN_ANS, "(1 OR 9)", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_CANCEL_Proc = False
                                Exit Function
                
                
                    End Select
                End Select
            Next i
        
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                '検品確認終了時は、伝票ＩＤ要求に戻す為の特殊処理
                
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "12"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()


'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
            
                Sendbuf = Text_Create_Proc()
    
    
    End Select
    SYUKO_CANCEL_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Private Function SYUKA_DEL_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『出荷削除処理』
'       2009.03.17
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 11
Dim Hinban          As String * 20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1


Dim i               As Integer

Dim MENU_NO         As String * 2



    SYUKA_DEL_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷処理不可", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKA_DEL_Proc = False
                            Exit Function
                        End If
    
    
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKA_DEL_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                SYUKA_DEL_Proc = False
                                Exit Function
                        End Select
                
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SYUKA_QTY = SYUKA_QTY
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(1).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = ""  '2007.07.21
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, MTS_CODE & SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, MTS_CODE & SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(2).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = ""  '2007.07.21
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""



                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo & ":" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo & ":" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "20"
                                                                                
                        Send_Text.Box_Type(4).Max_Size = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""


                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
            
            
            
            
        Case Step_Sagyo2_RES        '2回目の受信（Any Key）
            
            
            
            
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            '出荷予定の読み込み
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'ID№
    
            Do
            
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrKeyNotFound
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        SYUKA_DEL_Proc = False
                        GoTo Abort_Tran
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        SYUKA_DEL_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
        
            Loop


                                            
                                            
                                            '出荷予定書込み
            Do
                sts = BTRV(BtOpInsert, DEL_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_DEL_SYU, Len(K0_DEL_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        SYUKA_DEL_Proc = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        SYUKA_DEL_Proc = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop
                                        
                                            '出荷予定書込み
            Do
                sts = BTRV(BtOpDelete, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        SYUKA_DEL_Proc = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        SYUKA_DEL_Proc = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop
                                        
                                        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                        
            '2004.07.16 ↓
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        "", , , , , MENU_NO, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE, ID_KANRI_TBL(ING_No).SS_CODE, _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    SYUKA_DEL_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
            '2004.07.16 ↑
                                        
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    SYUKA_DEL_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function




Private Function Label_File_Make_Proc(fileName As String, Print_Su As Long, Start_Page_No As Long, PRINT_TOTAL_SU As Long) As Integer
'-------------------------------------------------------
'
'   『荷札用データファイル作成』
'       2010.01.28
'-------------------------------------------------------
Dim sts         As Integer


Dim FileNo      As Long

Dim FullPath    As String


Dim LCnt        As Integer

Dim OKURI_NO    As Integer


Dim Work        As String * 20


    
Dim c           As String * 128     '2010.06.08
Dim DEF_FLG     As Boolean          '2010.06.08

    
    
'''''Exit Function
    
    Label_File_Make_Proc = True








    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = CtrsWsk1.SendFolder & "\" & F0_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    Else
        FullPath = CtrsWsk1.SendFolder & F0_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    End If


    If GetIni("LABEL", "LABEL_DEF", "F110010LABEL", c) Then   '2010.06.08
        DEF_FLG = False
    Else
        DEF_FLG = True
    End If


    On Error Resume Next
    Kill (FullPath)             '送信用ファイル削除
    On Error GoTo 0
        
    FileNo = FreeFile           '送信用ファイルＯＰＥＮ
    Open FullPath For Output As #FileNo

    Print #FileNo, "#"
    Print #FileNo, "JOB"
    
    
    If DEF_FLG Then                                     '2010.06.08
        Print #FileNo, Trim(c)
    Else
        Print #FileNo, "DEF MK=1,DK=8,MD=3,PW=384,PH=344,XO=8,UM=24,BM=0,AF=1"
    End If





'    Print #FileNo, "DEF MK=1,DK=8,MD=1,PW=384,PH=344,XO=8,UM=8"
    Print #FileNo, "START"
    OKURI_NO = Len(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) + 1
    '送り状№(BC)
    If Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_CHARTER_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_AKABOU_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_LOGISTIC_CD) Then
        Print #FileNo, ""
    Else
        
        
'        Print #FileNo, "BCD TP=6,X=0,Y=22,RA=1,HT=40,HR=0,MG=0,NS=" & Format(OKURI_NO, "#0") & ",NE=2,NZ=0"
        Print #FileNo, "BCD TP=6,X=0,Y=0,RA=1,HT=80,HR=1,MG=0,NS=" & Format(OKURI_NO, "#0") & ",NE=2,NZ=0"
        Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) & Format(Start_Page_No, "00")
    End If
    
    Print #FileNo, "#FONT TP=3,CS=0"
    
    '送り状№
    If Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_CHARTER_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_AKABOU_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_LOGISTIC_CD) Then
        Print #FileNo, ""
    Else
        Print #FileNo, "#TEXT X=33,Y=60,L=1,NS=12,NS=" & Format(OKURI_NO, "#0") & ",NE=2,NZ=0"
        Print #FileNo, "#" & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) & Format(Start_Page_No, "00")
    End If
    
    
    '印刷枚数
    Print #FileNo, "FONT TP=7,CS=0,LG=72,WD=36,LS=0"
    Print #FileNo, "TEXT X=214,Y=245,L=1,NS=1,NE=3,NZ=1"
    Print #FileNo, Format(Start_Page_No, "000") & "/" & Format(PRINT_TOTAL_SU, "#")
    
    
    
         
         
    '着店
'    Print #FileNo, "FONT TP=7,CS=0,LG=36,WD=18,LS=0"
'    Print #FileNo, "TEXT X=574,Y=65,L=1"
'
'    Print #FileNo, "着店:000"
         
    
    
    
'    Print #FileNo, "TEXT X=0,Y=65,L=7"
    
    Print #FileNo, "FONT TP=7,CS=0,LG=36,WD=18,LS=0"
    Print #FileNo, "TEXT X=0,Y=65,L=7"
'    Print #FileNo, "TEXT X=0,Y=0,L=1,NS=1,NE=3,NZ=1"
    
    
    'TEL
'    If Len(Trim(ID_KANRI_TBL(ING_No).KEN_TEL_NO)) < 1 Then
'        Print #FileNo, ""
'    Else
'        If IsNumeric(Mid(Trim(ID_KANRI_TBL(ING_No).KEN_TEL_NO), 1, 1)) Then
'            Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_TEL_NO)
'        Else
'            Print #FileNo, ""
'        End If
'    End If
     Print #FileNo, ""
    
    
    
'    Print #FileNo, "00-0000-0000"
    
    
    
    '住所1
    Print #FileNo, Trim(Mid(ID_KANRI_TBL(ING_No).KEN_JYUSHO, 1, 20))
    
    '住所2
    Print #FileNo, Trim(Mid(ID_KANRI_TBL(ING_No).KEN_JYUSHO, 21, 20))
    
    '送り先
    Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
    
    '備考
'    Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_BIKOU)
'    Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_MUKE_NAME)
    Print #FileNo, ""
    
    '日付
    Print #FileNo, Mid(ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD, 1, 4) & _
                                               "年" & Mid(ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD, 5, 2) & _
                                               "月" & Mid(ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD, 7, 2) & "日"
    


    
    '送り元
    Print #FileNo, "ＳＤＣ内　部材流通Ｃ"
    
    
    
    Print #FileNo, "QTY P=" & Format(Print_Su, "#")
    Print #FileNo, "END"


    
    Print #FileNo, "JOBE"
    
    fileName = F0_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
'    fileName = "label001" & ".txt"
'    fileName = "label091" & ".txt"










    Close #FileNo


'''''''''''''''''''''''''''''''''''''''


'
'    On Error Resume Next
'    Kill (FullPath)             '送信用ファイル削除
'    On Error GoTo 0
'
'    FileNo = FreeFile           '送信用ファイルＯＰＥＮ
'    Open FullPath For Output As #FileNo
'
'    Print #FileNo, "JOB"
'
'    Print #FileNo, "JOBE"
'
'
'    Close #FileNo
'''''''''''''''''''''''''''''''''''''''

    Label_File_Make_Proc = False


End Function




Private Function Label_Print_File_Make_Proc(fileName As String, Hinban As String, IRI_QTY As Long) As Integer
'-------------------------------------------------------
'
'   『品番ﾗﾍﾞﾙ用データファイル作成』
'       2011.03.05
'
'-------------------------------------------------------
Dim sts         As Integer


Dim FileNo      As Long

Dim FullPath    As String

Dim wkHinban    As String * 14
Dim wklen       As Long
Dim wkmod       As Long

    
    
    Label_Print_File_Make_Proc = True
'-------------------------  2012.03.19
'    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
'        FullPath = CtrsWsk1.SendFolder & "\" & EF_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
'    Else
'        FullPath = CtrsWsk1.SendFolder & EF_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
'    End If
    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = CtrsWsk1.SendFolder & "\" & fileName & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    Else
        FullPath = CtrsWsk1.SendFolder & fileName & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    End If
'-------------------------  2012.03.19




    On Error Resume Next
    Kill (FullPath)             '送信用ファイル削除
    On Error GoTo 0
        
    FileNo = FreeFile           '送信用ファイルＯＰＥＮ
    Open FullPath For Output As #FileNo







    Print #FileNo, "#"
    Print #FileNo, "JOB"
    
    
    Print #FileNo, "DEF MK=1,DK=8,MD=3,PW=384,PH=344,XO=8,UM=24,BM=0,AF=1"





    Print #FileNo, "START"
    
    Print #FileNo, "FONT TP=7,CS=0,LG=80,WD=45,LS=0"
    Print #FileNo, "TEXT X=15,Y=30,L=1"
    
    
    
    
    wkHinban = Trim(Hinban)
    If Len(Trim(wkHinban)) < 14 Then
        wklen = 14 - Len(Trim(wkHinban))
        
        
        wklen = ToRoundDown(CCur(wklen / 2), 0)
        If wklen < 1 Then
        Else
            wkHinban = Space(wklen) & Trim(wkHinban)
        End If
    End If
    
'    Print #FileNo, Left(Trim(Hinban), 14)
    Print #FileNo, wkHinban

    
    Print #FileNo, "BCD TP=7,X=40,Y=120,DR=0,NW=1,RA=,HT=100,HR=0,MG=0,NS=0,NE=0,NZ=0"
    Print #FileNo, Left(Hinban, 14)
    
    
    If IRI_QTY = 0 Then
    Else
        Print #FileNo, "FONT TP=7,CS=0,LG=60,WD=45,LS=0"
        Print #FileNo, "TEXT X=150,Y=230,L=1"
        Print #FileNo, Format(IRI_QTY, "0") & "個"
    End If
    
    
    Print #FileNo, "QTY P=1"
    Print #FileNo, "END"


    
    Print #FileNo, "JOBE"
    

    Close #FileNo

    fileName = EF_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"


    Label_Print_File_Make_Proc = False


End Function



Private Sub Syuka_Kenpin_Count_Proc(Sumi_CNT As Integer, _
                                    Y_SYU_CNT As Integer, _
                                    KONPOU_ON As Integer, _
                                    KONPOU_OFF As Integer, _
                                    KONPOU_ON_SUMI As Integer, _
                                    KONPOU_OFF_SUMI As Integer)
'-------------------------------------------------------
'
'   『検品関係実数のカウント』
'       2010.01.21
'-------------------------------------------------------
                        
Dim FAST_F  As Boolean
                        
Dim i       As Integer
Dim j       As Integer
                                                
Dim k       As Integer
                        
                        
                        
    Sumi_CNT = 0
    Y_SYU_CNT = 0
                                                            
                                                            
                                                            
    KONPOU_ON = 0
    KONPOU_OFF = 0
                                                            
                                                            
                                                            

    KONPOU_OFF_SUMI = 0
    KONPOU_ON_SUMI = 0

''' 品番単位での丸め処理
    FAST_F = True
                                                                                
    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
    
    
        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
        Else
            If FAST_F Then
            
                Y_SYU_CNT = Y_SYU_CNT + 1
                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                    Sumi_CNT = Sumi_CNT + 1
                End If
                
                
                
                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
                    KONPOU_OFF = KONPOU_OFF + 1
                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                        KONPOU_OFF_SUMI = KONPOU_OFF_SUMI + 1
                    End If
                
                
                Else
                    KONPOU_ON = KONPOU_ON + 1
                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                        KONPOU_ON_SUMI = KONPOU_ON_SUMI + 1
                    End If
                
                
                
                End If
                
                
                FAST_F = False
            
                                            
            
            
            
            Else
                For k = 0 To j - 1
                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                            Exit For
                        End If
                    End If
                Next k
        
                If k > j - 1 Then
        
                    Y_SYU_CNT = Y_SYU_CNT + 1
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                        Sumi_CNT = Sumi_CNT + 1
                    End If
                
                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
                        KONPOU_OFF = KONPOU_OFF + 1
                    
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            KONPOU_OFF_SUMI = KONPOU_OFF_SUMI + 1
                        End If
                    
                    
                    Else
                        KONPOU_ON = KONPOU_ON + 1
                    
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            KONPOU_ON_SUMI = KONPOU_ON_SUMI + 1
                        End If
                    
                    
                    
                    End If
                
                
                
                
                End If
            End If
        End If
    Next j

End Sub

Private Sub Syuka_KUTI_SU_Count_Proc(TOTAL_KUTI_SU As Integer)
'-------------------------------------------------------
'
'   『口数合計のカウント』
'       2010.01.21
'-------------------------------------------------------
                        
Dim FAST_F  As Boolean
                        
Dim i       As Integer
Dim j       As Integer
                                                
Dim k       As Integer
                        
                        
    TOTAL_KUTI_SU = 0
''' 品番単位での丸め処理
    FAST_F = True
                                                                                
    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
    
    
        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
        
        
            If FAST_F Then
            
                TOTAL_KUTI_SU = TOTAL_KUTI_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU
                    
                FAST_F = False
            
            Else
                For k = 0 To j - 1
                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                            Exit For
                        End If
                    End If
                Next k
        
                If k > j - 1 Then
        
                    TOTAL_KUTI_SU = TOTAL_KUTI_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU
                
                End If
            End If
        End If
    Next j

End Sub




Private Function Syuka_END_Count_Proc() As Double
'-------------------------------------------------------
'
'   『才数合計のカウント』
'       2010.01.21
'-------------------------------------------------------
                        
Dim FAST_F  As Boolean
                        
Dim i       As Integer
Dim j       As Integer
                                                
Dim k       As Integer
                        
                        
    Syuka_END_Count_Proc = 0
''' 品番単位での丸め処理
    FAST_F = True
                                                                                
    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
    
    
    
        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
    
            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
            
                Syuka_END_Count_Proc = Syuka_END_Count_Proc + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU
            End If
        End If
    Next j


    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
    
    
    
        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
    
            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
            
                Syuka_END_Count_Proc = Syuka_END_Count_Proc + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU
            
                Exit For
            End If
        End If
    Next j


End Function



Private Function Label_Print_Total_Su_Proc(KUTI_SU As Long, PRINT_TOTAL_SU As Long) As Integer
'-------------------------------------------------------
'
'   『検品処理時のラベル印刷枚数獲得』
'       2010.01.21
'-------------------------------------------------------
Dim sts     As Integer

Dim FAST_F  As Boolean
                        
Dim i       As Integer
Dim j       As Integer
                                                
Dim k       As Integer


    Label_Print_Total_Su_Proc = True
    
    
    
    
    
    PRINT_TOTAL_SU = KUTI_SU
    
    FAST_F = True
                                                                                
    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
    
    
        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
        Else
            If FAST_F Then
            
                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO)
                
                
                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        
                        If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                        End If
                        
                        
                    
                    
                    Case BtErrKeyNotFound
                    
                        Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                    
                    
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Exit Function
                End Select
                
                
                If StrConv(ITEMREC.KONPOU_F, vbUnicode) = "1" Then
                
                
                    PRINT_TOTAL_SU = PRINT_TOTAL_SU + (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO * CLng(StrConv(ITEMREC.KUTI_SU, vbUnicode)))
                
                
                End If
                
                FAST_F = False
            
                                            
            
            
            
            Else
'                For k = 0 To j - 1
'                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
'                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
'                            Exit For
'                        End If
'                    End If
'                Next k
        
'                If k > j - 1 Then
        
                
                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO)
                    
                    
                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                    Select Case sts
                        Case BtNoErr
                            
                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                            End If
                            
                            
                        
                        
                        Case BtErrKeyNotFound
                        
                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                        
                        
                        Case Else
                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                            Exit Function
                    End Select
                    
                    
                    If StrConv(ITEMREC.KONPOU_F, vbUnicode) = "1" Then
                    
                    
                        PRINT_TOTAL_SU = PRINT_TOTAL_SU + (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO * CLng(StrConv(ITEMREC.KUTI_SU, vbUnicode)))
                    
                    
                    End If
                
                
                
'                End If
            End If
        End If
    Next j
    
    
    
    
    
    
    
    
    
    
    Label_Print_Total_Su_Proc = False
        

End Function

Private Function OKURI_NO_SEQ_Update_Proc(j As Integer, OKURI_NO_SEQ As String, Sendbuf As String, _
                                            Optional OKURI_NO_SEQ_TO As String = "   ") As Integer
'-------------------------------------------------------
'
'   『検品処理時の出荷予定　送り状№枝番更新』
'       2010.01.21
'-------------------------------------------------------
    
Dim sts As Integer
    
    OKURI_NO_SEQ_Update_Proc = True
    
    
    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ <> 0 Then
        OKURI_NO_SEQ_Update_Proc = False
        Exit Function
    End If
    
                                            
    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ = CInt(OKURI_NO_SEQ)
    
    If Trim(OKURI_NO_SEQ_TO) = "" Then
        OKURI_NO_SEQ_TO = OKURI_NO_SEQ
    End If
    
    '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理

    Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID№

    Do

        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrKeyNotFound
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                OKURI_NO_SEQ_Update_Proc = False
                Exit Function
            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                OKURI_NO_SEQ_Update_Proc = False
                Exit Function
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Exit Function
        End Select

    Loop
    
        
    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ, OKURI_NO_SEQ)
    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ_TO, OKURI_NO_SEQ_TO)
            '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
    Do
        sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                OKURI_NO_SEQ_Update_Proc = False
                Exit Function
        
            Case Else
                Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                OKURI_NO_SEQ_Update_Proc = SYS_ERR
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                
                Exit Function
        End Select
    Loop

    OKURI_NO_SEQ_Update_Proc = False


End Function


Private Sub Wel_Head_Text_Proc()
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

    Send_Text.fileName = ""                                 '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""

    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
'--

End Sub




Private Sub Wel_Head_Print_Text_Proc(fileName As String)
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

    Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL

    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

    Send_Text.fileName = fileName                           '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.fileName = fileName

    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF

End Sub

Private Sub Wel_DETAIL_0_Text_Proc()
                                                            'BOX属性
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(0).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                            
    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""

End Sub
Private Sub Wel_DETAIL_1_Text_Proc(ID_NO As String, Sumi_CNT As Integer, Y_SYU_CNT As Integer)
                                                                                'BOX属性
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(1).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                            
    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""

End Sub



Private Sub Wel_Clear_Text_Proc()
    Send_Text.Box_Type(4).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
     Send_Text.Box_Type(4).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                            
    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
'--

End Sub


Private Sub Wel_Hin_No_Req_Text_Proc(Sumi_CNT As Integer, Y_SYU_CNT As Integer)
    '-----------------------------------------------１行目
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(0).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                            
    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    '-----------------------------------------------２行目
                                                            
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                
                                                                
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(1).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                            
    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    '-----------------------------------------------３行目
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
                                                            
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                            
                                                            
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                            
    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    '-----------------------------------------------４行目
    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                            '表示内容
                                                        '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                            '入力桁数
    '2010.12.07
'    Send_Text.Box_Type(3).Max_Size = "13"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
    Send_Text.Box_Type(3).Max_Size = "20"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
    '2010.12.07
                                                            
    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    '-----------------------------------------------５行目
    Call Wel_Clear_Text_Proc

End Sub

Private Sub Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU As Integer, TOTAL_SAI_SU As Double)

Dim wkKUTI_SU As String
                                    
                                    
    wkKUTI_SU = Format(TOTAL_KUTI_SU, "#0")
                
                
    Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                    '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S)
                                                    '数値初期表示
    Send_Text.Box_Type(3).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                    '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = 13
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = 13
                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = "04"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "04"
    
    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
    '-----------------------------------------------５行目
                                                            
    wkKUTI_SU = Format(TOTAL_SAI_SU, "#0.00")
                                                            'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = 12
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = 12
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = "05"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                            
    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

End Sub

Private Sub Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU As Integer, TOTAL_SAI_SU As Double)
                                    
Dim wkKUTI_SU       As String
                                    
                                    
Dim wkTOTAL_SAI_SU  As Long
                                    
                                    
    wkKUTI_SU = Format(TOTAL_KUTI_SU, "#0")
                
                
    Send_Text.Box_Type(3).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                    '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & wkKUTI_SU)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & wkKUTI_SU)
                                                    '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                    '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
    
    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    
    '-----------------------------------------------５行目
                                                            
    wkTOTAL_SAI_SU = TOTAL_SAI_SU
    If TOTAL_SAI_SU < 1 Then
        wkTOTAL_SAI_SU = 1
    Else
        If TOTAL_SAI_SU > 1 Then
            wkTOTAL_SAI_SU = CLng(ToHalfAdjust(CCur(TOTAL_SAI_SU), 0))
        End If
    End If
                                                            
'    wkKUTI_SU = Format(TOTAL_SAI_SU, "#0.00")
    wkKUTI_SU = Format(wkTOTAL_SAI_SU, "#0")
                                                            'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S & wkKUTI_SU)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S & wkKUTI_SU)
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "00"
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = ""
                                                            
    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

End Sub

Private Function KutiSai_Update_Proc(KUTI_SU As Integer, SAI_SU As Double) As Integer
                        
                        
Dim sts         As Integer

Dim j           As Integer

Dim wkSAI_SU    As Integer
                        
    KutiSai_Update_Proc = True
    '----------------------------------- データ更新処理開始 -----------
                                    'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Exit Function
    End If
                                            
    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
        '------------------------------------   出荷予定の処理
        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                            'ID№
        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
    
        
        sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
        Select Case sts
            Case BtNoErr
            
            Case BtErrKeyNotFound
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                KutiSai_Update_Proc = False
                GoTo Abort_Tran
             Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                KutiSai_Update_Proc = False
                GoTo Abort_Tran
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                GoTo Abort_Tran
        End Select

        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
        'ID_NO
        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番

            Do
    
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrKeyNotFound
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        GoTo Abort_Tran
                End Select

            Loop
                                            
                                
            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
            
                If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                    If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                    Else
                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                    End If
                Else
                    
                    
                    Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                                        
                End If
                Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                
            Else
                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                    
                    'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                    If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                        If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                        Else
                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                        End If
                    Else
                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                                            
                    End If
                End If
                Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                            
            End If
                                                    
                                
                                '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
            Do
                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                        GoTo Abort_Tran
                End Select
            Loop
        End If
                    

    Next j

        
     For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

     '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理

         'ID_NO
         If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
             
             Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                 'ID№
             Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)

             Do
             
                 sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                 Select Case sts
                     Case BtNoErr
                         Exit Do
                     Case BtErrKeyNotFound
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                      Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                     Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        GoTo Abort_Tran
                 End Select
         
             Loop
             
             
             
             Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番

             Do
     
                 sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                 Select Case sts
                     Case BtNoErr
                         Exit Do
                     Case BtErrKeyNotFound
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                     Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                        GoTo Abort_Tran
                 End Select
 
             Loop
                             
                             
            If SAI_SU < 1 Then
                wkSAI_SU = 1
            Else
                If SAI_SU > 1 Then
                    wkSAI_SU = CLng(ToHalfAdjust(CCur(SAI_SU), 0))
                End If
            End If
                             
                             
                             
             Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
             Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(wkSAI_SU, "00.00"))
                                 
                                 '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
             Do
                 sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                 Select Case sts
                     Case BtNoErr
                         Exit Do
                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                     Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                        GoTo Abort_Tran
                 End Select
             Loop
         End If
                     

     Next j
             
                         'トランザクション終了
     sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
     If sts <> BtNoErr Then
         Call File_Error(sts, BtOpEndTransaction, "", 0)
         GoTo Abort_Tran
     End If

    KutiSai_Update_Proc = False

    Exit Function





Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If







End Function

Private Sub Wel_HIN_NO_Req_Text_3_Proc()
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
                                                            
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                            
                                                            
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                            
    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""

End Sub



Private Sub Wel_HIN_NO_Req_Text_4_Proc()
                            
    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                            '表示内容
                                                        '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                            '入力桁数
    '2010.12.07
'    Send_Text.Box_Type(3).Max_Size = "13"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
    Send_Text.Box_Type(3).Max_Size = "20"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
    '2010.12.07
                                                            
    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

End Sub


Private Function OKURI_NO_CHECK_PROC(OKURI_NO As String, OKURI_NO_F As Boolean, FUKUYAMA_CHK_F As Boolean) As Integer
    
Dim k   As Integer
    
    OKURI_NO_F = False
    FUKUYAMA_CHK_F = False
    
    
    If Len(Trim(OKURI_NO)) = FUKUYAMA_Length Then
        
        If FUKUYAMA_CODE(0) = "*" Then
            OKURI_NO_F = True
    
    
        Else
            For k = 0 To UBound(FUKUYAMA_CODE)
            
                If Mid(OKURI_NO, 1, Len(FUKUYAMA_CODE(k))) = FUKUYAMA_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k

    
        End If
    
    
    
        '2010.04.28 福山チェック追加
        If Not IsNumeric(Left(OKURI_NO, FUKUYAMA_Length - 1)) Then
            FUKUYAMA_CHK_F = True
        Else
            If Left(OKURI_NO, FUKUYAMA_Length - 1) - (ToRoundDown(CCur(Left(OKURI_NO, FUKUYAMA_Length - 1) / 7), 0) * 7) <> Val(Right(OKURI_NO, 1)) Then
                FUKUYAMA_CHK_F = True
            End If
        End If
        '2010.04.28
    
    
    
    
    End If

    If Len(Trim(OKURI_NO)) = SEIBU_Length Then
        If SEIBU_CODE(0) = "*" Then
            OKURI_NO_F = True
    
    
        Else
            For k = 0 To UBound(SEIBU_CODE)
            
                If Mid(OKURI_NO, 1, Len(SEIBU_CODE(k))) = SEIBU_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k

    
        End If
    End If

    If Len(Trim(OKURI_NO)) = KURUME_Length Then
    
        If KURUME_CODE(0) = "*" Then
            OKURI_NO_F = True
        Else
            For k = 0 To UBound(KURUME_CODE)
            
                If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k
        End If
    
    End If

    If Len(Trim(OKURI_NO)) = SAGAWA_Length Then
    
        If SAGAWA_CODE(0) = "*" Then
            OKURI_NO_F = True
        Else
            For k = 0 To UBound(SAGAWA_CODE)
            
                If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k
        End If
    
    End If
    
    If Len(Trim(OKURI_NO)) = YAMATO_Length Then
    
        If YAMATO_CODE(0) = "*" Then
            OKURI_NO_F = True
        Else
            For k = 0 To UBound(YAMATO_CODE)
            
                If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k
        End If
    
    End If




    'ﾊﾟﾅﾎｰﾑ 2011.06.06
    If Len(Trim(OKURI_NO)) = PANA_Length Then
    
        If PANA_CODE(0) = "*" Then
            OKURI_NO_F = True
        Else
            For k = 0 To UBound(PANA_CODE)
            
                If Mid(OKURI_NO, 1, Len(PANA_CODE(k))) = PANA_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k
        End If
    
    End If
    '積水 2011.06.06
    If Len(Trim(OKURI_NO)) = SEKISUI_Length Then
    
        If SEKISUI_CODE(0) = "*" Then
            OKURI_NO_F = True
        Else
            For k = 0 To UBound(SEKISUI_CODE)
            
                If Mid(OKURI_NO, 1, Len(SEKISUI_CODE(k))) = SEKISUI_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k
        End If
    
    End If


End Function

Public Sub OKURI_NO_SET_PROC(OKURI_NO As String)
    
Dim k   As Integer
    
    If Len(Trim(OKURI_NO)) = FUKUYAMA_Length Then
        
        If FUKUYAMA_CODE(0) = "*" Then
            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
    
    
        Else
            For k = 0 To UBound(FUKUYAMA_CODE)
            
                If Mid(OKURI_NO, 1, Len(FUKUYAMA_CODE(k))) = FUKUYAMA_CODE(k) Then
                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
                End If
            Next k

    
        End If
    End If

    If Len(Trim(OKURI_NO)) = SEIBU_Length Then
        If SEIBU_CODE(0) = "*" Then
            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
    
    
        Else
            For k = 0 To UBound(SEIBU_CODE)
            
                If Mid(OKURI_NO, 1, Len(SEIBU_CODE(k))) = SEIBU_CODE(k) Then
                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
                End If
            Next k

    
        End If
    End If

    If Len(Trim(OKURI_NO)) = KURUME_Length Then
    
        If KURUME_CODE(0) = "*" Then
            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
        Else
            For k = 0 To UBound(KURUME_CODE)
            
                If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
                End If
            Next k
        End If
    
    End If

    If Len(Trim(OKURI_NO)) = SAGAWA_Length Then
    
        If SAGAWA_CODE(0) = "*" Then
            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
        Else
            For k = 0 To UBound(SAGAWA_CODE)
            
                If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
                End If
            Next k
        End If
    
    End If
    
    If Len(Trim(OKURI_NO)) = YAMATO_Length Then
    
        If YAMATO_CODE(0) = "*" Then
            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
        Else
            For k = 0 To UBound(YAMATO_CODE)
            
                If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
                End If
            Next k
        End If
    
    End If
    
    
    
    
    
    'ﾊﾟﾅﾎｰﾑ 2011.06.06
    If Len(Trim(OKURI_NO)) = PANA_Length Then
    
        If PANA_CODE(0) = "*" Then
            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, PANA_Name)
        Else
            For k = 0 To UBound(PANA_CODE)
            
                If Mid(OKURI_NO, 1, Len(PANA_CODE(k))) = PANA_CODE(k) Then
                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, PANA_Name)
                End If
            Next k
        End If
    
    End If
    
    '積水 2011.06.06
    If Len(Trim(OKURI_NO)) = SEKISUI_Length Then
    
        If SEKISUI_CODE(0) = "*" Then
            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEKISUI_Name)
        Else
            For k = 0 To UBound(SEKISUI_CODE)
            
                If Mid(OKURI_NO, 1, Len(PANA_CODE(k))) = SEKISUI_CODE(k) Then
                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEKISUI_Name)
                End If
            Next k
        End If
    
    End If
    
    
    
    
    
    '物流 2010.02.19
    If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "物流")
        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KEN_CHARTER_NM)
    End If
    
    '赤帽 2010.02.19
    If Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "赤帽")
        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KEN_AKABOU_NM)
    End If
    
    'ロジステック 2010.02.19
    If Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "ロジステック")
    End If

End Sub










Private Function LABEL_Print_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『ラベル発行処理』
'
'   2011.03.05
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim Hinban      As String * 20


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim DATA_CNT    As Integer

Dim MENU_NO     As String * 2   '2008.08.08

Dim fileName    As String

Dim IRI_QTY     As Long

    LABEL_Print_Proc = True


    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）



            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                            
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                LABEL_Print_Proc = False
                                Exit Function
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        
                        End Select
                                            
                                            
                
                        Call UniCode_Conv(K8_Y_SYU.JGYOBU, StrConv(ITEMREC.JGYOBU, vbUnicode))
                        Call UniCode_Conv(K8_Y_SYU.NAIGAI, StrConv(ITEMREC.NAIGAI, vbUnicode))
                        Call UniCode_Conv(K8_Y_SYU.KEY_HIN_NO, StrConv(ITEMREC.HIN_GAI, vbUnicode))
                        Call UniCode_Conv(K8_Y_SYU.KAN_YMD, "99999999")
                        Call UniCode_Conv(K8_Y_SYU.KAN_HMS, "999999")
                
                
                        IRI_QTY = 0
                
                
                        com = BtOpGetLessEqual
                
                        Do
                            
                            
                            DoEvents
                            
                            
                            sts = BTRV(com, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K8_Y_SYU, Len(K8_Y_SYU), 8)
                            Select Case sts
                                Case BtNoErr
                                    
                                                    
                                    If StrConv(Y_SYUREC.JGYOBU, vbUnicode) <> StrConv(ITEMREC.JGYOBU, vbUnicode) Or _
                                       StrConv(Y_SYUREC.NAIGAI, vbUnicode) <> StrConv(ITEMREC.NAIGAI, vbUnicode) Or _
                                        StrConv(Y_SYUREC.HIN_NO, vbUnicode) <> StrConv(ITEMREC.HIN_GAI, vbUnicode) Then
                                    
                                    
                                        Exit Do
                                    
                                    
                                    End If
        
                                    
                                    If StrConv(Y_SYUREC.KAN_KBN, vbUnicode) = KAN_KBN_FIN Then
                                    
                                        IRI_QTY = Val(StrConv(Y_SYUREC.SURYO, vbUnicode))
                                    
                                    
                                        Exit Do
                                    
                                    End If
                                    
                                    
                        
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "出荷予定", 0)
                                    Exit Function
                            End Select
                        
                        
                            com = BtOpGetPrev
                        
                        Loop
        
                        fileName = EF_SendFile
        
                        If Label_Print_File_Make_Proc(fileName, Hinban, IRI_QTY) Then
                        End If
                                
                                
                                    
                        'データ送信
                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                    
                                                    
                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                    
                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                    
                        '-----------------------------------------------ヘッダー
                    
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                        Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL
                    
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                        Send_Text.fileName = fileName                           '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = fileName
                    
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                    
                        Sendbuf = Text_Create_Proc()
                        Exit For
                    
                    
                End Select
            Next i
        Case Step_PRINT_RES         '２回目の受信（印刷終了）
    
                '作業ﾛｸﾞ出力    2008.08.08
                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                    MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                            
                Else
                            
                    MENU_NO = ""
                End If
                If Trim(MENU_NO) = "" Then
                Else
                '作業ﾛｸﾞ出力
                    
                    If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                        RET_JGYOBU, _
                                                        RET_NAIGAI, _
                                                        MENU_NO, _
                                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                        Hinban) Then
                        LABEL_Print_Proc = SYS_ERR
                        Exit Function
                    End If
                End If
        
        
                                                    '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                    Case BtNoErr
                    '   -------------------------------- エラーメッセージ作成
                    Case Else
                    '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                If Sagyo_Send_Proc() Then
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                End If
                        
                Sendbuf = Text_Create_Proc()
            
            
            
            
    End Select

    
    
    
    
    LABEL_Print_Proc = False
    

End Function



Private Function SEK_PACKING_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス　邸別梱包処理』
'
'   2011.04.25
'               2011.07.20 品番毎の集約を廃止
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim k           As Integer      '2011.06.27
Dim l           As Integer      '2011.06.27




Dim Hinban      As String * 20

Dim ID_NO       As String * 13
Dim Found_Flg   As Integer
Dim JUC_SUU     As Long
Dim HINB_CD_CNT As Long



Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1
    

Dim MENU_NO     As String * 2

Dim In_Word     As String * 30
Dim Out_Word    As String * 16


Dim SAI_SU      As Double

    SEK_PACKING_Proc = True





    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SEK_ID_NO      '指図ＩＤ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        sts = Y_SYUKA_TEI_Check_Proc(ID_NO, Found_Flg)
                        Select Case sts
                            Case BtNoErr          '正常
                
                                '------------------ 梱包済みのチェック
                                If Not Found_Flg Then
                                    
                                    
                                    
                                    
                                    
                                    If ID_KANRI_TBL(ING_No).SEK_SAI_SU = 0 Then
                                        
                                        
                                        ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_NO
                                        
                                        '才数入力
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                        
                                        '-----------------------------------------------ヘッダー
                                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                                
                                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                                
                                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                                
                                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                                
                                        Send_Text.fileName = ""                                 '送信データファイル名
                                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                                
                                        Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                        
                                        '-----------------------------------------------１行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(0).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(0).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(0).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                        
                                        '-----------------------------------------------２行目
                                        In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                                        Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                                                
                                                                                                'BOX属性
                                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(1).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(1).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(1).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        
                                        '-----------------------------------------------３行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        
                                        '品番状態のカウント
                                        Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                                        
                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(2).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(2).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                                
                                        Send_Text.Box_Type(2).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        '-----------------------------------------------４行目
                                                                                                'BOX属性
                                                
                                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(3).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(3).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                                        Send_Text.Box_Type(3).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                
                                        '-----------------------------------------------５行目
                                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(4).Start_Pos = "12"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                                '入力桁数
                                        Send_Text.Box_Type(4).Max_Size = "05"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                        Sendbuf = Text_Create_Proc()
                                    
                                        SEK_PACKING_Proc = False
                                        Exit Function
                                    
                                    Else
                                    
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "全数梱包済みです", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_Proc = False
                                        Exit Function
                                
                                    End If
                                End If
                            Case BtErrEOF
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "注文ﾃﾞｰﾀなし", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_Proc = False
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_NO
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                        Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                        '品番状態のカウント
                        Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                        
                        
                        
                        
                        
                        
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（品番）
        
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban     '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_Proc = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        
                        
                        
                        
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) Then
                                Exit For
                            End If
                        Next j
                        
                        
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_Proc = False
                            Exit Function
                        End If
                        
                        'Pipeセットのﾁｪｯｸ   2011.07.20
'                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                            SEK_PACKING_Proc = False
'                            Exit Function
'                        End If
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) And Not ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F Then
                                ID_KANRI_TBL(ING_No).SEK_LINE = j
                                Exit For
                            End If
                        Next j
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
                    
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_Proc = False
                            Exit Function
                        End If
                        'Pipeセットのﾁｪｯｸ   2011.07.20
                        '------------------------------------------------------------   2011.06.27
                        For k = 0 To UBound(ID_KANRI_TBL)
                            If k = ING_No Then
                            Else
                                If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = _
                                    ID_KANRI_TBL(k).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(k).Sagyo_Code.YOIN_CODE Then
                                                            
                                    If ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_KANRI_TBL(k).SEK_TEI_LABELID Then
                                        
                                        'Pipeセットのﾁｪｯｸ   2011.07.20
'                                        For l = 0 To UBound(ID_KANRI_TBL(k).SEK_TBL)
'
'                                            If Trim(Hinban) = Trim(ID_KANRI_TBL(k).SEK_TBL(l).SEK_HINB_CD) Then
'
'
'                                                If ID_KANRI_TBL(k).SEK_TBL(l).SEK_KONPO_F Then
'                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
'                                                    Sendbuf = Text_Create_Proc()
'                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                                    SEK_PACKING_Proc = False
'                                                    Exit Function
'                                                End If
'
'                                            End If
'                                        Next l
                                        
                                        If ID_KANRI_TBL(k).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_KONPO_F Then
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_PACKING_Proc = False
                                            Exit Function
                                        End If
                                        'Pipeセットのﾁｪｯｸ   2011.07.20
                                    End If
                                End If
                            End If
                        Next k
                        '------------------------------------------------------------   2011.06.27
''                        If Inspection_Flg = 0 Then
''                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
''                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
''                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN <> KAN_KBN_FIN Then
''                                        Exit For
''                                    End If
''                                End If
''                            Next j
''
''                            If j <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
''                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")
''                                Sendbuf = Text_Create_Proc()
''                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
''                                SEK_PACKING_Proc = False
''                                Exit Function
''                            End If
''                        End If
                        
                        ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F = True
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        
                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU = 1 Then
                            Send_Text.Buzzer = Buzzer_DEF                       'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        Else
                            Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                        End If
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        '-----------------------------------------------３行目
                                                                                
                        In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                        Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                                
                                                                                
                                                                                
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_DATA_CNT = 1 Then

                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                                                                
                        Else
                        
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                        
                        
                        End If
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        
                
                End Select
            
            Next i
        
        
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
    
    
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                            
                        
            '------------------------------------   注文ﾃﾞｰﾀの処理
            
            com = BtOpGetGreaterEqual
            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
            
            Do
                
                DoEvents
            
                Do
                
                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrEOF
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_Proc = False
                            GoTo Abort_Tran
                        Case Else
                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
            
                Loop
            
                
                If sts = BtErrEOF Then
                    Exit Do
                End If
                
                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                    Exit Do
                End If
                '2011.07.20 IF条件追加
                If Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) And _
                    StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode) = ID_KANRI_TBL(ING_No).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_SEQ_NO Then
                
                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                    Do
                        DoEvents
                        sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_Proc = False
                                GoTo Abort_Tran
                             Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_Proc = False
                                GoTo Abort_Tran
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                
                End If
                
                com = BtOpGetNext
                
                
            Loop
                                            
            '------------------------------------   在庫移動履歴の処理
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                MENU_NO = ""
            End If
                                            
                                            
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        ID_KANRI_TBL(ING_No).SEK_SYU_JUN & " " & Trim(ID_KANRI_TBL(ING_No).SEK_TEI_NM), _
                                        , , , , MENU_NO, _
                                        , _
                                        "", _
                                        , , , , 1, , , , , , , ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    SEK_PACKING_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
            
            '------------------------------------   作業ログの処理
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                    SEK_PACKING_Proc = SYS_ERR
                    Exit Function
                End If
            End If
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
            '品番状態のカウント
            Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
    
            If HINB_CD_CNT <> ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT Then
            '次　品番
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                
                
                
                
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        
                                                                        
                In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                        
                                                                        
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                
                
                
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                
                '品番状態のカウント
                Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                
                
                
                
                
                
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                Sendbuf = Text_Create_Proc()
            
            Else
            '梱包完了
            
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                
                '-----------------------------------------------３行目
                In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                        
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "検品完了" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "検品完了" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "→ENT")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "→ENT")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                Sendbuf = Text_Create_Proc()
            End If
    
    
        Case Step_Sagyo4_RES        '４回目の受信（Any Key）
            
            
            
            If ID_KANRI_TBL(ING_No).SEK_SAI_SU = 0 Then
                '才数入力
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                
                '-----------------------------------------------２行目
                In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                        
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                
                '品番状態のカウント
                Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                        
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                        
                '-----------------------------------------------５行目
                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                '数値初期表示
                Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                        '入力桁数
                Send_Text.Box_Type(4).Max_Size = "05"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                Sendbuf = Text_Create_Proc()
            
            Else
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                    Case BtNoErr
                    '   -------------------------------- エラーメッセージ作成
                    Case Else
                    '重要な要因なので未登録はシステム停止とする
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                        Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                
                If Sagyo_Send_Proc() Then
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                End If
            
                Sendbuf = Text_Create_Proc()
    
            End If
    
    
        Case Step_Sagyo5_RES        '５回目の受信（才数）
    
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '才数
                    Case LCD_SAI_SU_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_Proc = False
                            Exit Function
                        
                        End If
                
                        SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                
                
                        If SAI_SU = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_Proc = False
                            Exit Function
                        
                        End If
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                        '------------------------------------   注文ﾃﾞｰﾀの処理
                        Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
                        com = BtOpGetGreaterEqual
            
                        Do
                    
                            DoEvents
                
                            Do
                    
                                sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrEOF
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                
                            Loop
            
                
                            If sts = BtErrEOF Then
                                Exit Do
                            End If
                    
                            If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                                Exit Do
                            End If
                        
                
                            Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, "0001")
                            Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(SAI_SU, "000.00"))
                        
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                        
                        
                
                            Do
                                DoEvents
                                sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_Proc = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                
                
                            com = BtOpGetNext
                
                
                        Loop
                                'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
    
                        '次の作業要求
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                        End Select
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                    
                        Sendbuf = Text_Create_Proc()
                    
                End Select
            Next i
    End Select

    SEK_PACKING_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If









    SEK_PACKING_Proc = False

End Function
Private Function SEK_PACKING_ALL_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス　邸別梱包処理』
'
'   2011.04.25
'               2011.07.20 品番毎の集約を廃止
'
'               全数検品対応    2012.03.21
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim k           As Integer      '2011.06.27
Dim l           As Integer      '2011.06.27




Dim Hinban      As String * 20

Dim ID_NO       As String * 13
Dim Found_Flg   As Integer
Dim JUC_SUU     As Long
Dim HINB_CD_CNT As Long



Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1
    

Dim MENU_NO     As String * 2

Dim In_Word     As String * 30
Dim Out_Word    As String * 16


Dim SAI_SU      As Double

Dim Cnt_F       As Boolean


    SEK_PACKING_ALL_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SEK_ID_NO      '指図ＩＤ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        sts = Y_SYUKA_TEI_Check_Proc(ID_NO, Found_Flg)
                        Select Case sts
                            Case BtNoErr          '正常
                
                                '------------------ 梱包済みのチェック
                                If Not Found_Flg Then
                                    
                                    If ID_KANRI_TBL(ING_No).SEK_SAI_SU = 0 Then
                                        
                                        
                                        ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_NO
                                        
                                        '才数入力
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                        
                                        '-----------------------------------------------ヘッダー
                                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                                
                                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                                
                                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                                
                                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                                
                                        Send_Text.fileName = ""                                 '送信データファイル名
                                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                                
                                        Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                                        
                                        '-----------------------------------------------１行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(0).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(0).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(0).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                        
                                        '-----------------------------------------------２行目
                                        In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                                        Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                                                
                                                                                                'BOX属性
                                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(1).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(1).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(1).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                        
                                        '-----------------------------------------------３行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        
                                        '品番状態のカウント
                                        Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                                        
                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(2).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(2).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                                
                                        Send_Text.Box_Type(2).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        '-----------------------------------------------４行目
                                                                                                'BOX属性
                                                
                                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(3).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(3).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                                        Send_Text.Box_Type(3).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                
                                        '-----------------------------------------------５行目
                                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(4).Start_Pos = "12"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                                '入力桁数
                                        Send_Text.Box_Type(4).Max_Size = "05"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                        Sendbuf = Text_Create_Proc()
                                    
                                        SEK_PACKING_ALL_Proc = False
                                        Exit Function
                                    
                                    Else
                                    
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "全数梱包済みです", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_ALL_Proc = False
                                        Exit Function
                                
                                    End If
                                End If
                            Case BtErrEOF
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "注文ﾃﾞｰﾀなし", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_ALL_Proc = False
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_NO
                        
'2012.11.15                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Trim(StrConv(Y_SYU_TEI_REC.KEN_HINBAN, vbUnicode))    '2012.10.24
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                                                                '2012.11.15
                        ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = Trim(StrConv(Y_SYU_TEI_REC.KEN_HINBAN, vbUnicode))            '2012.11.15
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                        Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                        '品番状態のカウント
                        Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                        
                        
                        
                        
                        
                        
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（品番）
            Cnt_F = False
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban, " 数", "*数"   '品番/数量
                        
                        If Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = " 数" Or _
                            Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = "*数" Then
                        
                            Cnt_F = True
                        End If
                        
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_ALL_Proc = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            Exit Function
                        End If
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) Then
                                If Not ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F Then
                                    ID_KANRI_TBL(ING_No).SEK_LINE = j
                                    Exit For
                                End If
                            End If
                        Next j
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
                    
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            Exit Function
                        End If
                        
                        For k = 0 To UBound(ID_KANRI_TBL)
                            If k = ING_No Then
                            Else
                                If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = _
                                    ID_KANRI_TBL(k).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(k).Sagyo_Code.YOIN_CODE Then
                                                            
                                    If ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_KANRI_TBL(k).SEK_TEI_LABELID Then
                                        
                                        
                                        If ID_KANRI_TBL(k).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_KONPO_F Then
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_PACKING_ALL_Proc = False
                                            Exit Function
                                        End If
                                    End If
                                End If
                            End If
                        Next k
                        
                        
                        '仕掛中品番のﾁｪｯｸ   2012.10.24-->2012.11.15 KEN_HINBAN-->KEN_ING_HINBAN
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) Then
                            If Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) <> "" Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "他品番検品中！", ID_KANRI_TBL(ING_No).KEN_ING_HINBAN)
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_ALL_Proc = False
                                Exit Function
                            End If
                        End If
                        '仕掛中品番のﾁｪｯｸ   2012.10.24
                        
                        
                                                
                        '---------------------  品番仕掛中　チェック    2012.04.05
                        If Cnt_F Then
                            If RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) <> RTrim(Hinban) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_ALL_Proc = False
                                Exit Function
                            End If
                        End If
                        '---------------------  品番仕掛中　チェック    2012.04.05
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 0 Then
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 0 Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 1
                            End If
                        
                            
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU / ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY), 0)) + _
                                                                                (ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU - _
                                                                                ((CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU / ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY)
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 1 Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU
                            Else
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY = CLng(ToRoundUp(CCur(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU Mod ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY), 0))
                            End If
                            
                            
                            
                            '2012.10.24
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT = 0 And _
                                IsNumeric(StrConv(Y_SYU_TEI_REC.J_HIN_CHK_CNT, vbUnicode)) Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = Val(StrConv(Y_SYU_TEI_REC.CNT_BARA_SU, vbUnicode))
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = Val(StrConv(Y_SYU_TEI_REC.CNT_HAKO_SU, vbUnicode))
                            
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT = Val(StrConv(Y_SYU_TEI_REC.J_HIN_CHK_CNT, vbUnicode))
                            
                                Cnt_F = True
                            Else
                            '2012.10.24
                            
                            
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = 0
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = 0
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT + 1
                            
                                If ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY Then
                                    ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = 1
                                Else
                                    ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY
                                End If
                            End If      '2012.10.24
                        
                        
                        
                        
                        End If
                        
                        If Cnt_F Then
                        
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT + 1
                        
                        
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + 1
                            Else
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY
                            End If
                        
                        
                        End If
                        
                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_Y_HIN_CHK_CNT Then
                            
'------------------------------------------ 全数検品終了　----------------------------------------------------------
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F = True
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                            
                            Send_Text.Buzzer = Buzzer_DEF                       'ブザー音　標準
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    
                            In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                            Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_DATA_CNT = 1 Then
    
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                                                                    
                            Else
                            
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                            
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            
                            '>>>>>>>>>>>>>>>    2012.06.21
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU > 1 Then

                                '2012.09.27
'                               If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then
                                If ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU > 1 Then
                                    Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE


                                '2012.09.27
                                Else
                                End If
                            End If
                            '>>>>>>>>>>>>>>>    2012.06.21
                            
                            Sendbuf = Text_Create_Proc()
                        
                            SEK_PACKING_ALL_Proc = False
                            
                            Exit Function
                        
                        
                        Else
                        
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.24
                            '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                Exit Function
                            End If
                                                            
                                                            
                                        
                            '------------------------------------   注文ﾃﾞｰﾀの処理
            
                            com = BtOpGetGreaterEqual
                            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
                            
                            Do
                                
                                DoEvents
                            
                                Do
                                
                                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrEOF
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_PACKING_ALL_Proc = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                            
                                Loop
                            
                                
                                If sts = BtErrEOF Then
                                    Exit Do
                                End If
                                
                                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                                    Exit Do
                                End If

                        
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) Then
                                            
                                            Call UniCode_Conv(Y_SYU_TEI_REC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT, "0000000"))
                                            
                                            Call UniCode_Conv(Y_SYU_TEI_REC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU, "0000000"))
                                            Call UniCode_Conv(Y_SYU_TEI_REC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU, "0000000"))
                                            Exit For
                                    End If
                                Next j
                        
                        
                                Call UniCode_Conv(Y_SYU_TEI_REC.KEN_HINBAN, Hinban)
                
                                Do
                                    DoEvents
                                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_PACKING_ALL_Proc = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_PACKING_ALL_Proc = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                
                
                
                                com = BtOpGetNext
                
                            Loop
                                                'トランザクション終了
                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                            End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.24
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                            
                            Send_Text.Buzzer = Buzzer_DEF                       'ブザー音　標準
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    
                            In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                            Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_DATA_CNT = 1 Then
    
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                                                                    
                            Else
                            
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                            
                            
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            Sendbuf = Text_Create_Proc()
                        
                            SEK_PACKING_ALL_Proc = False
                            
                            Exit Function
                        
                        End If
                
                End Select
            
            Next i
        
        
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
    
    
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                            
                        
            '------------------------------------   注文ﾃﾞｰﾀの処理
            
            com = BtOpGetGreaterEqual
            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
            
            Do
                
                DoEvents
            
                Do
                
                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrEOF
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            GoTo Abort_Tran
                        Case Else
                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
            
                Loop
            
                
                If sts = BtErrEOF Then
                    Exit Do
                End If
                
                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                    Exit Do
                End If
                
'2012.10.24                If Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) And _
'2012.10.24                    StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode) = ID_KANRI_TBL(ING_No).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_SEQ_NO Then
'2012.10.24
'2012.10.24                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
'2012.10.24                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
'2012.10.24
'2012.10.24                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
'2012.10.24                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
'2012.10.24
'2012.10.24                    Do
'2012.10.24                        DoEvents
'2012.10.24                        sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
'2012.10.24                        Select Case sts
'2012.10.24                            Case BtNoErr
'2012.10.24                                Exit Do
'2012.10.24                            Case BtErrKeyNotFound
'2012.10.24                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
'2012.10.24                                Sendbuf = Text_Create_Proc()
'2012.10.24                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.24                                SEK_PACKING_ALL_Proc = False
'2012.10.24                                GoTo Abort_Tran
'2012.10.24                             Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.10.24                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
'2012.10.24                                Sendbuf = Text_Create_Proc()
'2012.10.24                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.24                                SEK_PACKING_ALL_Proc = False
'2012.10.24                                GoTo Abort_Tran
'2012.10.24                            Case Else
'2012.10.24                                Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
'2012.10.24                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.10.24                                Sendbuf = Text_Create_Proc()
'2012.10.24                                GoTo Abort_Tran
'2012.10.24                        End Select
'2012.10.24                    Loop
'2012.10.24
'2012.10.24                End If
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.24
                If Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) And _
                    StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode) = ID_KANRI_TBL(ING_No).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_SEQ_NO Then
                
                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                                
                
                End If
                
'2012.10.31                ID_KANRI_TBL(ING_No).KEN_HINBAN = ""
                Call UniCode_Conv(Y_SYU_TEI_REC.KEN_HINBAN, "")
                
                Do
                    DoEvents
                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrKeyNotFound
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            GoTo Abort_Tran
                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            GoTo Abort_Tran
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.24
                
                
                com = BtOpGetNext
                
                
            Loop
                                            
'2012.11.15            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.31
            '------------------------------------   在庫移動履歴の処理
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                MENU_NO = ""
            End If
                                            
                                            
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        ID_KANRI_TBL(ING_No).SEK_SYU_JUN & " " & Trim(ID_KANRI_TBL(ING_No).SEK_TEI_NM), _
                                        , , , , MENU_NO, _
                                        , _
                                        "", _
                                        , , , , 1, , , , , , , ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    SEK_PACKING_ALL_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
            
            '------------------------------------   作業ログの処理
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                    SEK_PACKING_ALL_Proc = SYS_ERR
                    Exit Function
                End If
            End If
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
            '品番状態のカウント
            Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
    
            If HINB_CD_CNT <> ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT Then
            '次　品番
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                
                ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = "" '2012.11.15
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                
                
                
                
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        
                                                                        
                In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                        
                                                                        
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                
                
                
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                
                '品番状態のカウント
                Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                
                
                
                
                
                
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                Sendbuf = Text_Create_Proc()
            
            Else
            '梱包完了
            
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                
                '-----------------------------------------------３行目
                In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                        
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "検品完了" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "検品完了" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "→ENT")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "→ENT")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                Sendbuf = Text_Create_Proc()
            End If
    
    
        Case Step_Sagyo4_RES        '４回目の受信（Any Key）
            
            
            
            If ID_KANRI_TBL(ING_No).SEK_SAI_SU = 0 Then
                '才数入力
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                
                '-----------------------------------------------２行目
                In_Word = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                        
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & Out_Word)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                
                '品番状態のカウント
                Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                        
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                        
                '-----------------------------------------------５行目
                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                '数値初期表示
                Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                        '入力桁数
                Send_Text.Box_Type(4).Max_Size = "05"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                Sendbuf = Text_Create_Proc()
            
            Else
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                    Case BtNoErr
                    '   -------------------------------- エラーメッセージ作成
                    Case Else
                    '重要な要因なので未登録はシステム停止とする
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                        Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                
                If Sagyo_Send_Proc() Then
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                End If
            
                Sendbuf = Text_Create_Proc()
    
            End If
    
    
        Case Step_Sagyo5_RES        '５回目の受信（才数）
    
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '才数
                    Case LCD_SAI_SU_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            Exit Function
                        
                        End If
                
                        SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                
                
                        If SAI_SU = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            Exit Function
                        
                        End If
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                        '------------------------------------   注文ﾃﾞｰﾀの処理
                        Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
                        com = BtOpGetGreaterEqual
            
                        Do
                    
                            DoEvents
                
                            Do
                    
                                sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrEOF
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_ALL_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                
                            Loop
            
                
                            If sts = BtErrEOF Then
                                Exit Do
                            End If
                    
                            If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                                Exit Do
                            End If
                        
                
                            Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, "0001")
                            Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(SAI_SU, "000.00"))
                        
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                        
                        
                
                            Do
                                DoEvents
                                sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_ALL_Proc = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_ALL_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                
                
                            com = BtOpGetNext
                
                
                        Loop
                                'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
    
                        '次の作業要求
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                        End Select
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                    
                        Sendbuf = Text_Create_Proc()
                    
                End Select
            Next i
    End Select

    SEK_PACKING_ALL_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If









    SEK_PACKING_ALL_Proc = False

End Function

Private Function Y_SYUKA_TEI_Check_Proc(ID_NO As String, Found_Flg As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス出荷梱包　注文データのチェック』
'               2011.04.25
'               2011.07.20 品番毎の集約を廃止
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim Fsw         As Integer


    Y_SYUKA_TEI_Check_Proc = True
    
    
    Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_NO)
    com = BtOpGetGreaterEqual
    
    
    Found_Flg = False
    Fsw = True
    
    Erase ID_KANRI_TBL(ING_No).SEK_TBL
    ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT = 0
    
    
    Do
    
        DoEvents
    
        sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
        Y_SYUKA_TEI_Check_Proc = sts
        Select Case sts
            Case BtNoErr
                If Trim(ID_NO) <> Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            Case Else
                Y_SYUKA_TEI_Check_Proc = SYS_ERR
                Exit Function
        End Select
    
    
        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
            Found_Flg = True
        End If
        
        If Fsw Then

            ID_KANRI_TBL(ING_No).SEK_SYU_JUN = StrConv(Y_SYU_TEI_REC.SYU_JUN, vbUnicode)
            ID_KANRI_TBL(ING_No).SEK_TEI_NM = StrConv(Y_SYU_TEI_REC.TEI_NM, vbUnicode)

            ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT = ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT + 1
            ID_KANRI_TBL(ING_No).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))


            ReDim Preserve ID_KANRI_TBL(ING_No).SEK_TBL(0 To 0)
            ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_HINB_CD = StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)
'------------------------------------------------------------------ 全数検品対応    2012.03.21
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_GAISO_IRI_QTY = 0
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_Y_HIN_CHK_CNT = 0
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_J_HIN_CHK_CNT = 0
'------------------------------------------------------------------ 全数検品対応    2012.03.21
            ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_JUC_SUU = Val(StrConv(Y_SYU_TEI_REC.JUC_SUU, vbUnicode))
            ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_DATA_CNT = 1

            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
                ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_KONPO_F = False
                Found_Flg = True
            Else
                ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_KONPO_F = True
            End If

            '2011.07.20
            ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_SEQ_NO = StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode)
            '2011.07.20


            Fsw = False
        Else
'-------------------------------    2011.07.20
            
'            For i = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
'
'                If Trim(ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_HINB_CD) = Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) Then
'                   Exit For
'                End If
'
'            Next i
'
'            If i > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
'                ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT = ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT + 1
'
'                ReDim Preserve ID_KANRI_TBL(ING_No).SEK_TBL(0 To i)
'                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_HINB_CD = StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)
'                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_JUC_SUU = Val(StrConv(Y_SYU_TEI_REC.JUC_SUU, vbUnicode))
'                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
'                    ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_KONPO_F = False
'                    Found_Flg = True
'                Else
'                    ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_KONPO_F = True
'                End If
'                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_DATA_CNT = 1
'
'            Else
'                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_JUC_SUU = ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_JUC_SUU + _
'                                                                Val(StrConv(Y_SYU_TEI_REC.JUC_SUU, vbUnicode))
'                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_DATA_CNT = ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_DATA_CNT + 1
'
'            End If
            i = i + 1
            ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT = ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT + 1

            ReDim Preserve ID_KANRI_TBL(ING_No).SEK_TBL(0 To i)
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_HINB_CD = StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_JUC_SUU = Val(StrConv(Y_SYU_TEI_REC.JUC_SUU, vbUnicode))
            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_KONPO_F = False
                Found_Flg = True
            Else
                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_KONPO_F = True
            End If
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_DATA_CNT = 1
            
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_SEQ_NO = StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode)
'-------------------------------    2011.07.20
                
        End If
        
        com = BtOpGetNext
    
    Loop
    
    If Not Fsw Then
        Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, Left(ID_NO, 8) & "zz")
        sts = BTRV(BtOpGetLessEqual, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
    
        Select Case sts
            Case BtNoErr
                If Left(ID_NO, 8) <> Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 8) Then
                    Y_SYUKA_TEI_Check_Proc = BtErrEOF
                Else
                    ID_KANRI_TBL(ING_No).SEK_HAKO_SU = Val(StrConv(Y_SYU_TEI_REC.HAKO_NO, vbUnicode))
                End If
                Y_SYUKA_TEI_Check_Proc = BtNoErr
            Case BtErrEOF
                Y_SYUKA_TEI_Check_Proc = BtErrEOF
            Case Else
                Y_SYUKA_TEI_Check_Proc = SYS_ERR
                Exit Function
        End Select
    
    Else
        Y_SYUKA_TEI_Check_Proc = BtErrEOF
    End If


End Function

Private Sub SEK_HINB_CD_CNT_Proc(HINB_CD_CNT As Long)

'-------------------------------------------------------
'
'   『積水ハウス出荷梱包　品番状態のカウント』
'               2011.04.25
'
'-------------------------------------------------------
Dim i   As Integer

Dim k   As Integer
Dim l   As Integer

    HINB_CD_CNT = 0
    For i = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
    
        If ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_KONPO_F Then
            HINB_CD_CNT = HINB_CD_CNT + 1
        End If
    
    Next i
    '------------------------------------------------------------   2011.06.27
    For k = 0 To UBound(ID_KANRI_TBL)
        If k = ING_No Then
        Else
            If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = _
                ID_KANRI_TBL(k).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(k).Sagyo_Code.YOIN_CODE Then
                
                
                If ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_KANRI_TBL(k).SEK_TEI_LABELID Then
                    For l = 0 To UBound(ID_KANRI_TBL(k).SEK_TBL)
                        
                        
                        If l <= UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
                            If ID_KANRI_TBL(ING_No).SEK_TBL(l).SEK_KONPO_F Then
                            Else
                                If ID_KANRI_TBL(k).SEK_TBL(l).SEK_KONPO_F Then
                                    HINB_CD_CNT = HINB_CD_CNT + 1
                                End If
                            End If
                        Else
                            If ID_KANRI_TBL(k).SEK_TBL(l).SEK_KONPO_F Then
                                HINB_CD_CNT = HINB_CD_CNT + 1
                            End If
                        End If
                    
                    Next l
                End If
            End If
        End If
    Next k
    '------------------------------------------------------------   2011.06.27



End Sub


Private Function Inspe_Proc_SEK(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス検品処理（宅配伝票読み込み 大阪ＰＣ向け）』
'
'       2011.05.09
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer
Dim l               As Integer

Dim MENU_NO         As String * 2

Dim ID_NO           As String * 12
Dim SEK_ID_NO       As String

Dim CANCEL_F        As Boolean
Dim KENPIN_F        As Boolean
Dim SHOGO_F         As Boolean
Dim Y_Found_F       As Boolean
Dim T_Found_F       As Boolean

Dim Sumi_CNT        As Integer
Dim KUTI_SU         As Integer
Dim SAI_SU          As Double
Dim INPUT_SAI_SU    As Double



Dim OKURI_NO        As String
Dim OKURI_NO_F      As Boolean
Dim FUKUYAMA_CHK_F  As Boolean

Dim fileName        As String

Dim In_Word         As String * 30
Dim Out_Word        As String * 16

Dim wkTEI_LABELID() As String * 13
                        
Dim wkSai_Input     As Long

Dim wkSEK_PAGE_NO   As Integer
Dim From_Page_No    As Integer
Dim To_Page_No      As Integer
Dim wkKUTI_SU       As Integer

Dim SKIP_F          As Boolean          '2012.12.27

    Inspe_Proc_SEK = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                        
                                        
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        CANCEL_F = True
                        KENPIN_F = True
                        Y_Found_F = False
                        T_Found_F = False
                        
                        Erase ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL
                        
                        
                        ID_KANRI_TBL(ING_No).SEK_PAGE_NO = 0
                        j = -1
                            
                        
                        '梱包済み＆キャンセルのチェック
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_NO)
                                                
                                                
                        com = BtOpGetGreaterEqual
                        
                        Do
                        
                            sts = BTRV(com, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    If Trim(ID_NO) <> Left(StrConv(Y_SYUREC.ID_NO, vbUnicode), 7) Then
                                        Exit Do
                                    End If
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call File_Error(sts, com, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                        
                            
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))
                                            
                            sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                    Call File_Error(sts, com, "出荷予定(H)", 0)
                                    Call Err_Send_Proc("システム異常発生", "出荷ﾃﾞｰﾀｱﾝﾏｯﾁ", Trim(ID_NO), "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                
                                Case Else
                                    Call File_Error(sts, com, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                        
                            If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) <> "1" Then
                                CANCEL_F = False
                            End If
                        
                        
                            ID_KANRI_TBL(ING_No).KEN_OKURI_NO = Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode))               '送り状№
                            ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode))       '運送会社
                            ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode))            '送り先
                                                                                                                            '向け先
                            If Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode)) <> Trim(StrConv(Y_SYU_HREC.MUKE_NAME, vbUnicode)) Then
                                ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = Trim(StrConv(Y_SYU_HREC.MUKE_NAME, vbUnicode))
                            Else
                                ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = ""
                            End If
                            ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = Trim(StrConv(Y_SYU_HREC.SYUKA_YMD, vbUnicode))             '出荷日
                            ID_KANRI_TBL(ING_No).KEN_JYUSHO = Trim(StrConv(Y_SYU_HREC.JYUSHO, vbUnicode))                   '住所
                            ID_KANRI_TBL(ING_No).KEN_BIKOU = Trim(StrConv(Y_SYU_HREC.BIKOU, vbUnicode))                     '備考
                            
                            If Trim(StrConv(Y_SYUREC.KENPIN_TANTO_CODE, vbUnicode)) = "" Then
                                KENPIN_F = False
                            End If
                            
                            
                            If IsNumeric(StrConv(Y_SYU_HREC.OKURI_NO_SEQ_TO, vbUnicode)) Then
                                                                                                                            '荷札印刷開始ﾍﾟｰｼﾞ
                                If ID_KANRI_TBL(ING_No).SEK_PAGE_NO < CInt(StrConv(Y_SYU_HREC.OKURI_NO_SEQ_TO, vbUnicode)) Then
                                    ID_KANRI_TBL(ING_No).SEK_PAGE_NO = CInt(StrConv(Y_SYU_HREC.OKURI_NO_SEQ_TO, vbUnicode))
                                End If
                            End If
                            
                            
                            Y_Found_F = True
                            
                            Call UniCode_Conv(K2_Y_SYU_TEI.KEN_NO, StrConv(Y_SYU_HREC.SEK_KEN_NO, vbUnicode))
                            Call UniCode_Conv(K2_Y_SYU_TEI.HIN_NO, StrConv(Y_SYU_HREC.SEK_HIN_NO, vbUnicode))
                            
                            sts = BTRV(BtOpGetEqual, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K2_Y_SYU_TEI, Len(K2_Y_SYU_TEI), 2)
                            Select Case sts
                                Case BtNoErr
                                    
                                    If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) = "" And Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = "" Then
                                    Else
                                        T_Found_F = True
                                    
                                        If j = -1 Then
                                            j = j + 1
                                            ReDim Preserve ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(0 To j)
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                            Else
                                                
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                            
                                            
                                            
                                            
                                            End If
                                        
                                                                                                            '出荷順
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN = Trim(StrConv(Y_SYU_TEI_REC.SYU_JUN, vbUnicode))
                                                                                                            '邸名
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_TEI_NM = Trim(StrConv(Y_SYU_TEI_REC.TEI_NM, vbUnicode))
                                                                                                            '口数
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KUTI_SU = Val(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode))
                                                                                                            '才数
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                            
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.KENPIN_TANTO, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = True
                                            Else
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = False
                                            End If
                                            
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = True
                                            Else
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = False
                                            End If
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = True
                                            Else
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = False
                                            End If
        
                                        Else
                                        
                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> "" Then
                                                    If Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) = Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) Then
                                                        Exit For
                                                    End If
                                                End If
                                            
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) = "" Then
                                            
                                                    If Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                                                        Exit For
                                                    End If
                                                End If
                                            Next j
                                        
                                        
                                            If j > UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) Then
                                        
                                                ReDim Preserve ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(0 To j)
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                                Else
                                                    
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                                
                                                
                                                
                                                End If
                                                                                                            '出荷順
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN = Trim(StrConv(Y_SYU_TEI_REC.SYU_JUN, vbUnicode))
                                                                                                                '邸名
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_TEI_NM = Trim(StrConv(Y_SYU_TEI_REC.TEI_NM, vbUnicode))
                                                                                                                '口数
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KUTI_SU = Val(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode))
                                                                                                                '才数
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.KENPIN_TANTO, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = True
                                                Else
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = False
                                                End If
                                                
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = True
                                                Else
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = False
                                                End If
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = True
                                                Else
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = False
                                                End If
                                            
                                            
                                                If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)) > 13 Then
                                                                                                                    '梱包ID毎の件数
                                                End If
                                            
                                            
                                            Else
                                            
                                            
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = False
                                                End If
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) = "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = False
                                                End If
                                            
                                            
                                            End If
                                        
                                        End If
                                    End If
                                Case BtErrKeyNotFound
                                Case Else
                                    Call File_Error(sts, com, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                            
                            
                        
                            com = BtOpGetNext
                                
                        Loop
                        
                        '出荷データ有無チェック
                        If Not Y_Found_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        End If
                        'キャンセルチェック
                        If CANCEL_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        End If
                        '検品処理済みチェック
                        If KENPIN_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品処理済！", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        End If
                        
                        
                        
                        '梱包ＩＤ毎の件数を集計
 '                       For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
 '
 '                           If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)) > 13 Then
 '
 '                               Erase wkTEI_LABELID
 '                               Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)
 '
 '                               com = BtOpGetGreaterEqual
 '                               k = -1
 '                               Do
 '
 '                                   DoEvents
 '
 '                                   sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
 '                                   Select Case sts
 '                                       Case BtNoErr
 '                                           If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(StrConv(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO, vbUnicode)) Then
 '                                               Exit Do
 '                                           End If
 '                                       Case BtErrEOF
 '                                           Exit Do
 '                                       Case Else
 '                                           Call File_Error(sts, com, "邸別注文ﾃﾞｰﾀ", 0)
 '                                           Call Err_Send_Proc("システム異常発生", "", "", "", "")
 '                                           Sendbuf = Text_Create_Proc()
 '                                           Exit Function
 '                                   End Select
 '
 '                                   If k = -1 Then
 '                                        k = k + 1
 '                                       ReDim Preserve wkTEI_LABELID(0 To k)
 '                                       wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
 '                                   Else
 '                                       For k = 0 To UBound(wkTEI_LABELID)
 '
 '                                           If Trim(wkTEI_LABELID(k)) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
 '                                                Exit For
 '                                           End If
 '
 '                                       Next k
 '
 '
 '                                       If k > UBound(wkTEI_LABELID) Then
 '                                           ReDim Preserve wkTEI_LABELID(0 To k)
 '                                           wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
 '                                       End If
 '
 '                                   End If
 '
 '                                   com = BtOpGetNext
 '
 '                               Loop
 '
 '
 '
 '                               If k = -1 Then
 '                                   ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = 0
 '                               Else
 '                                   ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = UBound(wkTEI_LABELID) + 1
 '
 '                               End If
 '                           Else
 '                               ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = 0
 '                           End If
 '
 '                       Next j
                        
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        
                        
                        
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                        
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            '-----------------------------------------------１行目
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
                
                
                
                        Else
                
                
                            Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                        
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
                                                            'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    
                            
                            '-----------------------------------------------２行目
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                            'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
            
                            Sendbuf = Text_Create_Proc()
                        End If
                
                
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状№）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状№
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        
                        Else
                        
                            If Not IsNumeric(OKURI_NO) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                Exit Function
                            End If
                        
                        
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            If Not OKURI_NO_F Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状№エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                Exit Function
                                                
                            End If
                        
                            If FUKUYAMA_CHK_F Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                Exit Function
                            
                            End If
                        
                        End If
                    
                        '送り状№
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                    
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID№
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO))
                        com = BtOpGetGreaterEqual
                        Do
                        
                            DoEvents
                                                        
                            sts = BTRV(com, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                
                                    If Left(StrConv(Y_SYUREC.ID_NO, vbUnicode), 7) <> Trim(ID_KANRI_TBL(ING_No).ID_NO) Then
                                        Exit Do
                                    End If
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                            Do
                        
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_SEK = False
                                        GoTo Abort_Tran
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_SEK = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                            
                                            
                            If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) = "1" Then
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, "")
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "")
                            Else
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                            End If
                                                        
                            '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_SEK = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                        Inspe_Proc_SEK = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                        
                            com = BtOpGetNext
                        
                        Loop
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        Call SEK_Kenpin_Count_Proc(Sumi_CNT)
            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                
                        
                        '-----------------------------------------------２行目
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性

                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（指示№）
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 3)
                    
                    Case LCD_SEK_ID_NO     '指示ID
                        SEK_ID_NO = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                        
                            If Trim(SEK_ID_NO) = Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) Then
                                Exit For
                            End If
                        
                        Next j
                        
                        '指示№ﾁｪｯｸ
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, SEK_ID_NO, "指示№エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        
                        End If
                        
                        If Len(Trim(SEK_ID_NO)) > 13 Then
                        '梱包IDでのﾁｪｯｸ
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, SEK_ID_NO)
                        Else
                        '邸別IDでのﾁｪｯｸ
                            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, SEK_ID_NO)
                        End If
                                                        
                        com = BtOpGetGreaterEqual
                        T_Found_F = False
                        
                        Do
                        
                            DoEvents
                        
                            If Len(Trim(SEK_ID_NO)) > 13 Then
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                            Else
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                            End If
                            
                            Select Case sts
                                Case BtNoErr
                                        
                                    If Len(Trim(SEK_ID_NO)) > 13 Then
                                    '梱包IDでのﾁｪｯｸ
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(SEK_ID_NO) Then
                                            Exit Do
                                        End If
                                    Else
                                    '邸別IDでのﾁｪｯｸ
                                        If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(SEK_ID_NO) Then
                                            Exit Do
                                        End If
                                    End If
                                    
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                    Inspe_Proc_SEK = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
'                                   GoTo Abort_Tran                  2011.12.22
                                    Exit Function                   '2011.12.22
                            End Select
                        
                            '2011.05.27
                            If SEK_KEN_SHOGO_F Then
                                If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) = "" Then
                            
'2011.06.22                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未照合注文有り！！", "")
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未照合注文です！！", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_SEK = False
                                    Exit Function
                                End If
                            End If
                        
                        
                            If SEK_KEN_KONPO_F Then
                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" And Trim(StrConv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, vbUnicode)) = "" Then
                            
'2011.06.22                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未梱包有り！", "")
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未梱包です！！", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_SEK = False
                                    Exit Function
                                End If
                            End If
                        
                                                
                            If SEK_KEN_KENPIN_F Then
                        
                                If Trim(StrConv(Y_SYU_TEI_REC.KENPIN_TANTO, vbUnicode)) <> "" Then
                            
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "検品済み！！", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_SEK = False
                                    Exit Function
                                End If
                            
                            End If
                            '2011.05.27
                                                
                        
                            T_Found_F = True
                        
                        
                            com = BtOpGetNext
                        
                        
                        Loop
                        
                        If Not T_Found_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "邸別注文データなし！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        End If
                                    
                        
                        ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO = SEK_ID_NO
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        
                        '-----------------------------------------------２行目
                        
                        Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                        
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        '-----------------------------------------------３行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        
                        
                        In_Word = ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_TEI_NM
                        Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                        
                        
                        
                        If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
                            
                           '梱包ＩＤ毎の件数を集計
    
                            Erase wkTEI_LABELID
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)
    
                            com = BtOpGetGreaterEqual
                            k = -1
                            Do
    
                                DoEvents
    
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                Select Case sts
                                    Case BtNoErr
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) Then
                                            Exit Do
                                        End If
                                    Case BtErrEOF
                                        Exit Do
                                    Case Else
                                        Call File_Error(sts, com, "邸別注文ﾃﾞｰﾀ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
    
    
                                '2012.12.27
'                                Call UniCode_Conv(K8_Y_SYU_H.SEK_HIN_NO, StrConv(Y_SYU_TEI_REC.HIN_NO, vbUnicode))
'                                Call UniCode_Conv(K8_Y_SYU_H.SEK_KEN_NO, StrConv(Y_SYU_TEI_REC.KEN_NO, vbUnicode))
'                                SKIP_F = False
'                                sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K8_Y_SYU_H, Len(K8_Y_SYU_H), 8)
'                                Select Case sts
'                                    Case BtNoErr
'
'                                        If Left(ID_KANRI_TBL(ING_No).ID_NO, 7) <> Left(StrConv(Y_SYU_HREC.ID_NO, vbUnicode), 7) Then
'                                            SKIP_F = True
'                                        End If
'
'                                    Case BtErrKeyNotFound
'                                        SKIP_F = True
'                                    Case Else
'                                        Call File_Error(sts, BtOpGetEqual, "出荷予定(H)", 0)
'                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                        Sendbuf = Text_Create_Proc()
'                                        Exit Function
'                                End Select
    
                                    
'                                If SKIP_F Then
                                '2012.12.27
    
    
                                    If k = -1 Then
                                        k = k + 1
                                        ReDim Preserve wkTEI_LABELID(0 To k)
    '''                                    wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                        wkTEI_LABELID(k) = Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7)
                                    Else
                                        For k = 0 To UBound(wkTEI_LABELID)
    
    '''                                           If Trim(wkTEI_LABELID(k)) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                                               If Left(wkTEI_LABELID(k), 7) = Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7) Then
                                                    Exit For
                                               End If
        
                                        Next k
        
        
                                        If k > UBound(wkTEI_LABELID) Then
                                            ReDim Preserve wkTEI_LABELID(0 To k)
    '''                                        wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                            wkTEI_LABELID(k) = Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7)
                                        End If
        
                                    End If
    
'                                End If          '2012.12.27
    
                                com = BtOpGetNext
    
                            Loop
    
    
    
                            If k = -1 Then
                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = 0
                            Else
                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = UBound(wkTEI_LABELID) + 1

                            End If
                            
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Format(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT, "#0") & "件(" _
                                                                                & Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & _
                                                                                Out_Word & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Format(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT, "#0") & "件" _
                                                                                & Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & _
                                                                                Out_Word)
                        Else
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & Out_Word)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & Out_Word)
                        End If
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
            
            Next i
    
        Case Step_Sagyo4_RES        '４回目の受信（ANY KEY　受信）
            
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                                    
            '----------------------------------- 邸別注文データ処理 -----------
            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                If ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO = ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO Then
                    wkKUTI_SU = ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KUTI_SU
                    Exit For
                End If
            Next j
            
            
            
            If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
            '梱包IDでのﾁｪｯｸ
                Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
            Else
            '邸別IDでのﾁｪｯｸ
                Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
            End If
                                                        
            com = BtOpGetGreaterEqual
                        
            Do
            
                DoEvents
            
                If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
                    sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                Else
                    sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                End If
                
                Select Case sts
                    Case BtNoErr
                            
                        If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
                        '梱包IDでのﾁｪｯｸ
                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
                                Exit Do
                            End If
                        Else
                        '邸別IDでのﾁｪｯｸ
                            If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
                                Exit Do
                            End If
                        End If
                        
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                        Inspe_Proc_SEK = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            '----------------------------------- 出荷予定(H)処理 -----------
                
                
                '2012.12.27
                Call UniCode_Conv(K8_Y_SYU_H.SEK_HIN_NO, StrConv(Y_SYU_TEI_REC.HIN_NO, vbUnicode))
                Call UniCode_Conv(K8_Y_SYU_H.SEK_KEN_NO, StrConv(Y_SYU_TEI_REC.KEN_NO, vbUnicode))
                SKIP_F = False
                sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K8_Y_SYU_H, Len(K8_Y_SYU_H), 8)
                Select Case sts
                    Case BtNoErr
                    
                        If Left(ID_KANRI_TBL(ING_No).ID_NO, 7) <> Left(StrConv(Y_SYU_HREC.ID_NO, vbUnicode), 7) Then
                            SKIP_F = True
                        End If
                        
                    Case BtErrKeyNotFound
                        SKIP_F = True
                    Case Else
                        Call File_Error(sts, BtOpGetEqual, "出荷予定(H)", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                End Select

                    
                If SKIP_F Then
                '2012.12.27
                
                
                    Call UniCode_Conv(K8_Y_SYU_H.SEK_KEN_NO, StrConv(Y_SYU_TEI_REC.KEN_NO, vbUnicode))
                    Call UniCode_Conv(K8_Y_SYU_H.SEK_HIN_NO, StrConv(Y_SYU_TEI_REC.HIN_NO, vbUnicode))
                                                
                    sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K8_Y_SYU_H, Len(K8_Y_SYU_H), 8)
                    
                    Select Case sts
                        Case BtNoErr
                        
                        Case BtErrKeyNotFound
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, "出荷予定(H)", "アンマッチ！")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                            Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
            '----------------------------------- 出荷予定処理 -----------
                    Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                    Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, StrConv(Y_SYU_HREC.ID_NO, vbUnicode))
                                                
                    sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                    
                    Select Case sts
                        Case BtNoErr
                        
                        Case BtErrKeyNotFound
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, "出荷予定", "アンマッチ！")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            'Exit Function              2011.12.22
                            GoTo Abort_Tran         '   2011.12.22
                        Case Else
                            GoTo Abort_Tran
                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                            Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                                                
            '----------------------------------- 出荷予定書き込み処理 -----------
                                        
                    Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                        
                    Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                    Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                    
                                                    
                                                    
                    Call UniCode_Conv(Y_SYUREC.UPD_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                                                    
                    Do
                        sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                GoTo Abort_Tran
                        
                            Case Else
                                
                                Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                Inspe_Proc_SEK = SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                                            
                                            
            '----------------------------------- 出荷予定(H)書き込み処理 -----------
                                            
                    Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                    Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                        
                    
                     If com = BtOpGetGreaterEqual Then
                    
                        wkSEK_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                        
                        
                        ID_KANRI_TBL(ING_No).SEK_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO + 1
                        From_Page_No = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                        
                        ID_KANRI_TBL(ING_No).SEK_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO + wkKUTI_SU - 1
                        To_Page_No = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                                                
                    End If
                                                
                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ, Format(From_Page_No, "000"))
                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ_TO, Format(To_Page_No, "000"))
                                                
                    Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                    Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                                                
                                                
                                                
                    Do
                        sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K8_Y_SYU_H, Len(K8_Y_SYU_H), 8)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                GoTo Abort_Tran
                        
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                                Inspe_Proc_SEK = SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                
            '----------------------------------- 邸別注文ﾃﾞｰﾀ(H)書き込み処理 -----------
                                            
                    Call UniCode_Conv(Y_SYU_TEI_REC.KENPIN_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                    Call UniCode_Conv(Y_SYU_TEI_REC.KENPIN_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                                
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                                                
                                                
                    Do
                        
                        If Len(Trim(SEK_ID_NO)) > 13 Then
                        '梱包IDでのﾁｪｯｸ
                            sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU, Len(K3_Y_SYU), 3)
                        Else
                        '邸別IDでのﾁｪｯｸ
                            sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU, Len(K1_Y_SYU), 1)
                        End If
                        
                        
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文ﾃﾞｰﾀ使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                GoTo Abort_Tran
                        
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "邸別注文ﾃﾞｰﾀ", 0)
                                Inspe_Proc_SEK = SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                '------------------------------------   在庫移動履歴の処理
                    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                
                    Else
                        MENU_NO = ""
                    End If
                                                
                    '履歴出力の為の読み込み
                    Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                    Call UniCode_Conv(K0_MTS.SS_CODE, "")
                    sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                            Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                            Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                        Case Else
                            Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            'Exit Function              2011.12.22
                            GoTo Abort_Tran         '   2011.12.22
                                            
                    End Select
                    sts = IDOREKI_OUTPUT_PROC("", _
                                                "", _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                ID_KANRI_TBL(ING_No).NAIGAI, _
                                                "", _
                                                "", _
                                                (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                0, _
                                                0, _
                                                (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                FILE_RETRY, _
                                                CYU_KBN_SPO, _
                                                Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状№:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                                , , , , MENU_NO, _
                                                ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                "", _
                                                ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, , , , 1)
                    Select Case sts
                        Case False      '正常終了
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Inspe_Proc_SEK = SYS_ERR
                            GoTo Abort_Tran
                    End Select
                
                    '運送会社
                    ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
                
                End If                  '2012.12.27
                
                com = BtOpGetNext
            
            Loop
            
            '作業ﾛｸﾞ出力
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     , , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).MTS_CODE) Then
                    Inspe_Proc_SEK = SYS_ERR
                    'Exit Function          2011.12.22
                   GoTo Abort_Tran      '   2011.12.22
                End If
            End If
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If

            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                If Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) = Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = True
                    Exit For
                End If
            Next j
            
            
                    
            Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                    
                    
            ''' 荷札処置
            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
            
            
                If Sumi_CNT = UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1 Then
                '--------------------------------------------------------------------口数・才数へ
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    '-----------------------------------------------ヘッダー
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                    Send_Text.fileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                    '-----------------------------------------------１行目
                                                                            'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '--------------------------------------------------４行目
                    Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                                                                'BOX属性
                                
                    Send_Text.Box_Type(3).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                    
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
        
                    '-----------------------------------------------５行目
                                                                        'BOX属性
                    If SAI_SU >= 999999 Or SAI_SU = 0 Then
                    
                    
                    
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                    
                    
                    Else
                    
                    
                    
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                    
'                        ID_KANRI_TBL(ING_No).SEK_SAI_SU = SAI_SU
'                        ID_KANRI_TBL(ING_No).SEK_KUTI_SU = KUTI_SU
                            
                    
                    End If
                            
                            
                    Sendbuf = Text_Create_Proc()
                Else
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    '-----------------------------------------------ヘッダー
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                    Send_Text.fileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                    
                    '-----------------------------------------------１行目
                                                    'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            
                    
                    '-----------------------------------------------２行目
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    '-----------------------------------------------３行目
                                                                                    'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '-----------------------------------------------４行目
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                            '表示内容
                                                                        '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "20"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                            
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                                                                            'BOX属性
    
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                     Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                    Sendbuf = Text_Create_Proc()
                End If
            
            Else
                
                Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                
'''''''''''''''''''''''''   2011.06.29
                If wkSEK_PAGE_NO = 0 Then
                    wkSEK_PAGE_NO = SEK_LABEL_PAGE - 1
                End If
'''''''''''''''''''''''''   2011.06.29
                
                If SEK_Label_File_Make_Proc(fileName, wkSEK_PAGE_NO, wkKUTI_SU, KUTI_SU) Then
                    Inspe_Proc_SEK = SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    'GoTo Abort_Tran        2011.12.22
                    Exit Function       '   2011.12.22
                End If
                If ID_KANRI_TBL(ING_No).SEK_PAGE_NO < SEK_LABEL_PAGE Then

                    If Sumi_CNT = UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1 Then
                    '--------------------------------------------------------------------口数・才数へ
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""

                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"

                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"

                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                    '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容

                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)

                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"

                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '--------------------------------------------------４行目
                        Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                                                                    'BOX属性

                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""

                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        If ID_KANRI_TBL(ING_No).SEK_SYUGO_SAI_SU > 999 Or ID_KANRI_TBL(ING_No).SEK_SYUGO_SAI_SU = 0 Then



                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                            '数値初期表示
                            Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "12"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "05"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"


                        Else



                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                                                                            '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"



                        End If



                        Sendbuf = Text_Create_Proc()
                    Else

                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""

                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF

                        '-----------------------------------------------１行目
                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"

                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""


                        '-----------------------------------------------２行目
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"

                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容

                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"

                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"

                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性

                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"

                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                    End If




                
                Else
            
                '印刷要求送信
                                            
                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                
                                                
                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                
                    ID_KANRI_TBL(ING_No).LABEL_ON = True
                
                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                    '-----------------------------------------------ヘッダー
                
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                    Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL
                
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                    Send_Text.fileName = fileName                           '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.fileName = fileName
                
                    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                    Sendbuf = Text_Create_Proc()
            
                End If
            
            End If
                    
        Case Step_PRINT_RES        '印刷終了
                    
            Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                    
            If Sumi_CNT = UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1 Then
            '--------------------------------------------------------------------口数・才数へ
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
            
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                        "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                        "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                                                                        
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                        
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '--------------------------------------------------４行目
                Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                                                            'BOX属性
                            
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    
                '-----------------------------------------------５行目
                                                                        'BOX属性
                If SAI_SU >= 999999 Or SAI_SU = 0 Then
                
                
                
                    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = "12"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "05"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                
                
                Else
                
                
                
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S & Format(SAI_SU, "#0.00"))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S & Format(SAI_SU, "#0.00"))
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                
'                    ID_KANRI_TBL(ING_No).SEK_SAI_SU = SAI_SU
'                    ID_KANRI_TBL(ING_No).SEK_KUTI_SU = KUTI_SU
                        
                        
                End If
                        
                        
                Sendbuf = Text_Create_Proc()
            Else
            
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
            
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
        
                
                '-----------------------------------------------２行目
                
                Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                
                
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                                'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                                                                        
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                    '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性

                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()
            End If
    
        Case Step_Sagyo5_RES        '５回目の受信（ANY KEY　受信）
            
            Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
            
            If SAI_SU >= 999999 Or SAI_SU = 0 Then
            
            
                For i = 0 To M_Gyo - 1
            
                
                
                    Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                        '才数
                        Case LCD_SAI_SU_S
                    
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                Exit Function
                            
                            End If
                    
                            INPUT_SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                    
                    
                            If INPUT_SAI_SU = 0 Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                Exit Function
                            
                            End If
            
            
'2011.05.26                            '----------------------------------- データ更新処理開始 -----------
'2011.05.26                                                            'トランザクション開始
'2011.05.26                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'2011.05.26                            If sts <> BtNoErr Then
'2011.05.26                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                Sendbuf = Text_Create_Proc()
'2011.05.26                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
'2011.05.26                                Exit Function
'2011.05.26                            End If
'2011.05.26                            '------------------------------------   注文ﾃﾞｰﾀの処理
'2011.05.26
'2011.05.26
'2011.05.26                            If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
'2011.05.26                            '梱包IDでのﾁｪｯｸ
'2011.05.26                                Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
'2011.05.26                            Else
'2011.05.26                            '邸別IDでのﾁｪｯｸ
'2011.05.26                                Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
'2011.05.26                            End If
'2011.05.26
'2011.05.26                            com = BtOpGetGreaterEqual
'2011.05.26
'2011.05.26                            Do
'2011.05.26
'2011.05.26                                DoEvents
'2011.05.26
'2011.05.26                                Do
'2011.05.26                                    If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
'2011.05.26                                        sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
'2011.05.26                                    Else
'2011.05.26                                        sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
'2011.05.26                                    End If
'2011.05.26
'2011.05.26                                    Select Case sts
'2011.05.26                                        Case BtNoErr
'2011.05.26                                            If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
'2011.05.26                                            '梱包IDでのﾁｪｯｸ
'2011.05.26                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
'2011.05.26                                                    sts = BtErrEOF
'2011.05.26                                                    Exit Do
'2011.05.26                                                End If
'2011.05.26                                            Else
'2011.05.26                                            '邸別IDでのﾁｪｯｸ
'2011.05.26                                                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
'2011.05.26                                                    sts = BtErrEOF
'2011.05.26                                                    Exit Do
'2011.05.26                                                End If
'2011.05.26                                            End If
'2011.05.26                                            Exit Do
'2011.05.26                                        Case BtErrEOF
'2011.05.26                                            Exit Do
'2011.05.26                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2011.05.26                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2011.05.26                                            Inspe_Proc_SEK = False
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                        Case Else
'2011.05.26                                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
'2011.05.26                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                    End Select
'2011.05.26
'2011.05.26                                Loop
'2011.05.26
'2011.05.26
'2011.05.26                                If sts = BtErrEOF Then
'2011.05.26                                    Exit Do
'2011.05.26                                End If
'2011.05.26
'2011.05.26                                Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, "0001")
'2011.05.26                                Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(INPUT_SAI_SU, "000.00"))
'2011.05.26
'2011.05.26
'2011.05.26                                Do
'2011.05.26                                    DoEvents
'2011.05.26                                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
'2011.05.26                                    Select Case sts
'2011.05.26                                        Case BtNoErr
'2011.05.26                                            Exit Do
'2011.05.26                                        Case BtErrKeyNotFound
'2011.05.26                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2011.05.26                                            Inspe_Proc_SEK = False
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2011.05.26                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2011.05.26                                            Inspe_Proc_SEK = False
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                        Case Else
'2011.05.26                                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
'2011.05.26                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                    End Select
'2011.05.26                                Loop
'2011.05.26
'2011.05.26
'2011.05.26                                com = BtOpGetNext
'2011.05.26
'2011.05.26
'2011.05.26                            Loop
'2011.05.26                                    'トランザクション終了
'2011.05.26                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'2011.05.26                            If sts <> BtNoErr Then
'2011.05.26                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                Sendbuf = Text_Create_Proc()
'2011.05.26                                Call File_Error(sts, BtOpEndTransaction, "", 0)
'2011.05.26                                GoTo Abort_Tran
'2011.05.26                            End If
'2011.05.26
                    End Select
                Next i
                Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                wkSai_Input = 1
                SAI_SU = INPUT_SAI_SU
            Else
                wkSai_Input = 0
                Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
            End If
            
            
            '----------------------------------- 出荷予定(H)処理 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            
            
            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & "00")
            
            com = BtOpGetGreaterEqual
            
            Do
                
                DoEvents
                sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                
                Select Case sts
                    Case BtNoErr
                    
                        If Left(StrConv(Y_SYU_HREC.ID_NO, vbUnicode), 7) <> Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") Then
                            Exit Do
                        End If
                    
                    Case BtErrEOF
                        
                        Exit Do
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                        Inspe_Proc_SEK = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
                                            
                                            
            '----------------------------------- 出荷予定(H)書き込み処理 -----------
                
                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                            
                                            
''                If wkSai_Input = 1 Then
''                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ, "001")
''                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ_TO, Format(KUTI_SU, "000"))
''                End If
                                            
                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                                            
                                            
                Do
                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            GoTo Abort_Tran
                    
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                            Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                
            
                
                com = BtOpGetNext
            
            Loop
            
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
    
    
    
    
    
    
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    
    
    
    
    
    
    
    
    
    
    End Select
                    
                    

    Inspe_Proc_SEK = False
    
    Exit Function

Abort_Tran:
    
   sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

    


End Function




Private Sub SEK_Kenpin_Count_Proc(Sumi_CNT As Integer)
'-------------------------------------------------------
'
'   『積水ハウス向け出荷予定 検品済みのカウント』
'   大阪ＰＣ用  2011.05.09
'-------------------------------------------------------
Dim i   As Integer

    Sumi_CNT = 0

    For i = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)

        If ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(i).SEK_KENPIN_F Then
            Sumi_CNT = Sumi_CNT + 1
        End If

    Next i

End Sub
Private Function SEK_SYUGO_PACKING_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス　邸別集合梱包処理』
'
'   2011.05.12
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer
Dim j               As Integer


Dim KONPO_ID        As String * 20

Dim ID_NO           As String * 13
Dim Found_Flg       As Integer
Dim SYUGO_SUMI_CNT  As Long

Dim In_Word         As String * 50
Dim Out_Word        As String * 20


Dim SAI_SU          As Double

Dim MENU_NO         As String * 2


    SEK_SYUGO_PACKING_Proc = True





    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SEK_SYUGO_ID_NO      '指図ＩＤ
                        KONPO_ID = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        sts = Y_SYUKA_TEI_SYUGO_Check_Proc(KONPO_ID, Found_Flg)
                        Select Case sts
                            Case BtNoErr          '正常
                
                                '------------------ 梱包済みのチェック
                                If Not Found_Flg Then
                                    
                                    If ID_KANRI_TBL(ING_No).SEK_SYUGO_SAI_SU >= 999999 Then
                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                                        ID_KANRI_TBL(ING_No).SEK_KONPO_ID = KONPO_ID
                            
                            
                                        '-----------------------------------------------ヘッダー
                                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                                
                                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                                
                                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                                
                                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                                
                                        Send_Text.fileName = ""                                 '送信データファイル名
                                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                                
                                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                        
                                        '-----------------------------------------------１行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).SEK_KONPO_ID)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).SEK_KONPO_ID)
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(0).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(0).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(0).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                        '-----------------------------------------------２行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        In_Word = Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME)
                                        Call Moji_Cut_Proc(In_Word, Out_Word, 20)
                                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(Out_Word))
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(Out_Word))
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(1).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(1).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(1).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                        
                                        
                                        '-----------------------------------------------３行目
                                                                                                
                                        '集合梱包状態のカウント
                                        Call SEK_SYUGO_CNT_Proc(SYUGO_SUMI_CNT)
                                                                                                
                                                                                                
                                                                                                'BOX属性
                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 1, 4) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 5, 2) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 7, 2) & _
                                                                                    " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) + 1, "#0") & ")")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 1, 4) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 5, 2) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 7, 2) & _
                                                                                    " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) + 1, "#0") & ")")
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(2).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(2).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(2).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        
                                        '-----------------------------------------------４行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(3).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(3).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                                        Send_Text.Box_Type(3).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                
                                        '-----------------------------------------------５行目
                                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(4).Start_Pos = "12"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                                '入力桁数
                                        Send_Text.Box_Type(4).Max_Size = "05"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                        
                            
                                        Sendbuf = Text_Create_Proc()
                                    
                                        SEK_SYUGO_PACKING_Proc = False
                                        Exit Function
                                    
                                    Else
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, KONPO_ID, "全数梱包済みです", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_SYUGO_PACKING_Proc = False
                                        Exit Function
                                    End If
                                End If
                            Case BtErrEOF
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, KONPO_ID, "注文ﾃﾞｰﾀなし", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_SYUGO_PACKING_Proc = False
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).SEK_KONPO_ID = KONPO_ID
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SEK_KONPO_ID)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SEK_KONPO_ID)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        
                        In_Word = Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME)
                        Call Moji_Cut_Proc(In_Word, Out_Word, 20)
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(Out_Word))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(Out_Word))
                        
                        
'                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                        '-----------------------------------------------４行目
                                                                                
                        '集合梱包状態のカウント
                        Call SEK_SYUGO_CNT_Proc(SYUGO_SUMI_CNT)
                                                                                
                                                                                
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 1, 4) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 5, 2) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 7, 2) & _
                                                                    " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) + 1, "#0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 1, 4) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 5, 2) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 7, 2) & _
                                                                    " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) + 1, "#0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "01"                  '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（指示№）
        
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 3)
                    
                    Case LCD_SEK_ID_NO     '指示№
                        ID_NO = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL)
                            If Trim(ID_NO) = Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(j).SEK_TEI_LABELID) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_KONPO_ID, ID_NO, "指示№エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_SYUGO_PACKING_Proc = False
                            Exit Function
                        End If
                        
                
                        If ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(j).SEK_SYUGO_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_KONPO_ID, ID_NO, "梱包済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_SYUGO_PACKING_Proc = False
                            Exit Function
                        End If
                
                        '2011.05.27
                        If SEK_KONPO_F Then
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL)
                                If Trim(ID_NO) = Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(j).SEK_TEI_LABELID) Then
                                    If Not ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(j).SEK_KONPO_F Then
                                        Exit For
                                    End If
                                End If
                            Next j

                            If j <= UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) Then
'2011.06.22                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_KONPO_ID, ID_NO, "未梱包分有り！！", "")
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_KONPO_ID, ID_NO, "未梱包です！！", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_SYUGO_PACKING_Proc = False
                                Exit Function
                            End If
                        End If
                        '2011.05.27
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL)
                            If Trim(ID_NO) = Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(j).SEK_TEI_LABELID) Then
                                Exit For
                            End If
                        Next j
                        
                        ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(j).SEK_SYUGO_F = True
                        ID_KANRI_TBL(ING_No).SEK_KEN_TEI_LABELID = ID_NO
    
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                        '------------------------------------   注文ﾃﾞｰﾀの処理
                        
                        com = BtOpGetGreaterEqual
                        Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_KEN_TEI_LABELID)
            
                        Do
                            
                            DoEvents
                        
                            Do
                            
                                sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrEOF
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_SYUGO_PACKING_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                    
                            If sts = BtErrEOF Then
                                Exit Do
                            End If
            
                            If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_TEI_LABELID) Then
                                Exit Do
                            End If
                        
                
                            Call UniCode_Conv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
                            Call UniCode_Conv(Y_SYU_TEI_REC.SYUGO_KONPO_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                
                
                            Do
                                DoEvents
                                sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_SYUGO_PACKING_Proc = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_SYUGO_PACKING_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                
                
                            com = BtOpGetNext
                
                
                        Loop
                                            
                        '------------------------------------   在庫移動履歴の処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                            MENU_NO = ""
                        End If
                                                        
                                                        
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    "", _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    , _
                                                    ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME, _
                                                    , , , , MENU_NO, _
                                                    , _
                                                    "", _
                                                    , , , , 1, , , , , , , ID_KANRI_TBL(ING_No).SEK_KEN_TEI_LABELID)
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                SEK_SYUGO_PACKING_Proc = SYS_ERR
                                GoTo Abort_Tran
                        End Select
            
                        '------------------------------------   作業ログの処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                        If Trim(MENU_NO) = "" Then
                        Else
                        '作業ﾛｸﾞ出力
                            
                            If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                                ID_KANRI_TBL(ING_No).NAIGAI, _
                                                                MENU_NO, _
                                                                (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                                 , , , , , _
                                                                 ID_KANRI_TBL(ING_No).SEK_KEN_TEI_LABELID) Then
                                SEK_SYUGO_PACKING_Proc = SYS_ERR
                                Exit Function
                            End If
                        End If
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                    
                        '集合梱包状態のカウント
                        Call SEK_SYUGO_CNT_Proc(SYUGO_SUMI_CNT)
        
                        If SYUGO_SUMI_CNT <> UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) + 1 Then
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SEK_KONPO_ID)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SEK_KONPO_ID)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            
                            In_Word = Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME)
                            Call Moji_Cut_Proc(In_Word, Out_Word, 20)
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(Out_Word))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(Out_Word))
                            
                            
                            
'                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME))
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            
                            
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 1, 4) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 5, 2) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 7, 2) & _
                                                                        " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) + 1, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 1, 4) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 5, 2) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 7, 2) & _
                                                                        " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) + 1, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                            
                            
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_ID_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_ID_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "01"                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
            
                        Else
                        '梱包完了
            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
'                                                                                    'BOX属性
'                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                                                                                    '数値初期表示
'                            Send_Text.Box_Type(0).INIT = ""
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
'                                                                                    '初期カーソル位置
'                            Send_Text.Box_Type(0).Start_Pos = ""
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                                                    '入力桁数
'                            Send_Text.Box_Type(0).Max_Size = "00"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
'                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).SEK_KONPO_ID)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).SEK_KONPO_ID)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            
                            In_Word = Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME)
                            Call Moji_Cut_Proc(In_Word, Out_Word, 20)
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(Out_Word))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(Out_Word))
                            
                            
 '                           Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME))
 '                           Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            
                            '-----------------------------------------------３行目
                                                                                    
                            '集合梱包状態のカウント
                            Call SEK_SYUGO_CNT_Proc(SYUGO_SUMI_CNT)
                                                                                    
                                                                                    
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 1, 4) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 5, 2) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 7, 2) & _
                                                                        " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) + 1, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 1, 4) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 5, 2) & "/" & Mid(ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD, 7, 2) & _
                                                                        " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) + 1, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            
                            
                            
                            
                            
                            
                            
                            
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                                    
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                            '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                    
                            '-----------------------------------------------５行目
                                    
                            If ID_KANRI_TBL(ING_No).SEK_SYUGO_SAI_SU >= 999999 Then
                            
                            
                            
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                                '数値初期表示
                                Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                                                                                '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = "12"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                        '入力桁数
                                Send_Text.Box_Type(4).Max_Size = "05"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                            
                            
                            Else
                            
                            
                            
                                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                                '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                                Send_Text.Box_Type(3).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                            
                            End If
                            
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
'                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "→ENT")
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "→ENT")
'                                                                                    '数値初期表示
'                            Send_Text.Box_Type(4).INIT = ""
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                                                                                    '初期カーソル位置
'                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                                                                                    '入力桁数
'                             Send_Text.Box_Type(4).Max_Size = "00"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'
'                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                
                            Sendbuf = Text_Create_Proc()
                        End If
                End Select
            Next i
                    
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
            
            
            
            If ID_KANRI_TBL(ING_No).SEK_SYUGO_SAI_SU >= 999999 Then
            
            
                For i = 0 To M_Gyo - 1
            
                
                
                    Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                        '才数
                        Case LCD_SAI_SU_S
                    
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_SYUGO_PACKING_Proc = False
                                Exit Function
                            
                            End If
                    
                            SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                    
                    
                            If SAI_SU = 0 Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_SYUGO_PACKING_Proc = False
                                Exit Function
                            
                            End If
            
            
            
            
                            '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                Exit Function
                            End If
                            '------------------------------------   注文ﾃﾞｰﾀの処理
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KONPO_ID)
                            com = BtOpGetGreaterEqual
            
                            Do
                        
                                DoEvents
                    
                                Do
                        
                                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrEOF
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_SYUGO_PACKING_Proc = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                        
                            
                                If sts = BtErrEOF Then
                                    Exit Do
                                End If
                    
                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KONPO_ID) Then
                                    Exit Do
                                End If
                        
                
                                Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, "0001")
                                Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(SAI_SU, "000.00"))
                        
                                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                                
                                Do
                                    DoEvents
                                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_SYUGO_PACKING_Proc = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_SYUGO_PACKING_Proc = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                
                
                                com = BtOpGetNext
                            
                    
                            Loop
                                    'トランザクション終了
                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                            End If
            
                    End Select
                Next i
            End If
            
            
            
            
            
            
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    SEK_SYUGO_PACKING_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

    SEK_SYUGO_PACKING_Proc = False

End Function


Private Function Y_SYUKA_TEI_SYUGO_Check_Proc(ID_NO As String, Found_Flg As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス出荷集合梱包　注文データのチェック』
'               2011.05.12
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer



    Y_SYUKA_TEI_SYUGO_Check_Proc = True
    
    
    Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_NO)
    com = BtOpGetGreaterEqual
    
    
    Found_Flg = False
    
    i = -1
    Erase ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL
    
    
    Do
    
        DoEvents
    
        sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
        Y_SYUKA_TEI_SYUGO_Check_Proc = sts
        Select Case sts
            Case BtNoErr
                If Trim(ID_NO) <> Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            Case Else
                Y_SYUKA_TEI_SYUGO_Check_Proc = SYS_ERR
                Exit Function
        End Select
    
    
        If Trim(StrConv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, vbUnicode)) = "" Then
            Found_Flg = True
        End If
        
        If i = -1 Then
            
            
            ID_KANRI_TBL(ING_No).SEK_SYUGO_SYU_YMD = StrConv(Y_SYU_TEI_REC.SYU_YMD, vbUnicode)
            ID_KANRI_TBL(ING_No).SEK_SYUGO_L_TOK_NAME = StrConv(Y_SYU_TEI_REC.L_TOK_NAME, vbUnicode)
            ID_KANRI_TBL(ING_No).SEK_SYUGO_SAI_SU = StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)
            
            i = i + 1
                
            ReDim Preserve ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(0 To i)
            ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_TEI_LABELID = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
            
            
            If Trim(StrConv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, vbUnicode)) = "" Then
                ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_SYUGO_F = False
                Found_Flg = True
            Else
                ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_SYUGO_F = True
            End If
            
            
            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
                ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_KONPO_F = False
                Found_Flg = True
            Else
                ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_KONPO_F = True
            End If
            
            
            
            
        Else
            
            For i = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL)
                
                If Trim(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_TEI_LABELID) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                    Exit For
                End If
            
            Next i
            
            
            If i > UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL) Then
            
                ReDim Preserve ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(0 To i)
                ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_TEI_LABELID = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                
                
                If Trim(StrConv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, vbUnicode)) = "" Then
                    ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_SYUGO_F = False
                    Found_Flg = True
                Else
                    ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_SYUGO_F = True
                End If
                
                
                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
                    ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_KONPO_F = False
                    Found_Flg = True
                Else
                    ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_KONPO_F = True
                End If
            End If
        
        End If
            
            
        
        
            
        
        com = BtOpGetNext
    
    Loop
    
    Y_SYUKA_TEI_SYUGO_Check_Proc = False
    If i = -1 Then
        Y_SYUKA_TEI_SYUGO_Check_Proc = BtErrEOF
    End If

End Function

Private Sub SEK_SYUGO_CNT_Proc(SEK_SYUGO_CNT As Long)

'-------------------------------------------------------
'
'   『積水ハウス出荷集合梱包　梱包状態のカウント』
'               2011.05.12
'
'-------------------------------------------------------
Dim i   As Integer


    SEK_SYUGO_CNT = 0
    For i = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL)
    
        If ID_KANRI_TBL(ING_No).SEK_SYUGO_TBL(i).SEK_SYUGO_F Then
            SEK_SYUGO_CNT = SEK_SYUGO_CNT + 1
        End If
    
    Next i



End Sub

Private Function SEK_Label_File_Make_Proc(fileName As String, Start_Page_No As Integer, Mai_Su As Integer, TOTAL_Mai_Su As Integer) As Integer
'-------------------------------------------------------
'
'
'   『積水向け　荷札用データファイル作成』
'       2011.05.09
'-------------------------------------------------------
Dim sts         As Integer


Dim FileNo      As Long

Dim FullPath    As String


Dim LCnt        As Integer

Dim OKURI_NO    As Integer


Dim Work        As String * 20


    
Dim c           As String * 128
Dim DEF_FLG     As Boolean

    
    
''''''''''''''''''  邸別検品時、１枚目から荷札発行      2011.05.25
'    If ID_KANRI_TBL(ING_No).SEK_PAGE_NO < SEK_LABEL_PAGE Then
'        ID_KANRI_TBL(ING_No).SEK_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO + 1
'        SEK_Label_File_Make_Proc = False
'        Exit Function
'    End If
''''''''''''''''''  邸別検品時、１枚目から荷札発行      2011.05.25
    
'sts = MsgBox("荷札作成", vbYesNo, "テスト用")
'If sts = vbNo Then
'    SEK_Label_File_Make_Proc = False
'    Exit Function
'End If
    
''''''''''''''''''''''''''''''' 2011.06.29
    If Start_Page_No < SEK_LABEL_PAGE Then
        Mai_Su = Mai_Su - Start_Page_No
    End If
''''''''''''''''''''''''''''''' 2011.06.29
    
    
    
    SEK_Label_File_Make_Proc = True
        
    Start_Page_No = Start_Page_No + 1

    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = CtrsWsk1.SendFolder & "\" & F0_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    Else
        FullPath = CtrsWsk1.SendFolder & F0_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    End If


    If GetIni("LABEL", "LABEL_DEF", "F110010LABEL", c) Then
        DEF_FLG = False
    Else
        DEF_FLG = True
    End If


    On Error Resume Next
    Kill (FullPath)             '送信用ファイル削除
    On Error GoTo 0
        
    FileNo = FreeFile           '送信用ファイルＯＰＥＮ
    Open FullPath For Output As #FileNo

    Print #FileNo, "#"
    Print #FileNo, "JOB"
    
    
    If DEF_FLG Then
        Print #FileNo, Trim(c)
    Else
        Print #FileNo, "DEF MK=1,DK=8,MD=3,PW=384,PH=344,XO=8,UM=24,BM=0,AF=1"
    End If
    
    Print #FileNo, "START"
    OKURI_NO = Len(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) + 1
    '送り状№(BC)
    If Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_CHARTER_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_AKABOU_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_LOGISTIC_CD) Then
        Print #FileNo, ""
    Else
        
        
        Print #FileNo, "BCD TP=6,X=0,Y=0,RA=1,HT=80,HR=1,MG=0,NS=" & Format(OKURI_NO, "#0") & ",NE=2,NZ=0"
        Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) & Format(Start_Page_No, "00")
    End If
    
    Print #FileNo, "#FONT TP=3,CS=0"
    
    '送り状№
    If Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_CHARTER_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_AKABOU_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_LOGISTIC_CD) Then
        Print #FileNo, ""
    Else
        Print #FileNo, "#TEXT X=33,Y=60,L=1,NS=12,NS=" & Format(OKURI_NO, "#0") & ",NE=2,NZ=0"
        Print #FileNo, "#" & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) & Format(Start_Page_No, "00")
    End If
    
    
    '印刷枚数
    Print #FileNo, "FONT TP=7,CS=0,LG=72,WD=36,LS=0"
    Print #FileNo, "TEXT X=214,Y=245,L=1,NS=1,NE=3,NZ=1"
    Print #FileNo, Format(Start_Page_No, "000") & "/" & Format(TOTAL_Mai_Su, "#")
    
    Print #FileNo, "FONT TP=7,CS=0,LG=36,WD=18,LS=0"
    Print #FileNo, "TEXT X=0,Y=65,L=7"
    
    Print #FileNo, ""
    
    
    
    
    
    
    '住所1
    Print #FileNo, Trim(Mid(ID_KANRI_TBL(ING_No).KEN_JYUSHO, 1, 20))
    
    '住所2
    Print #FileNo, Trim(Mid(ID_KANRI_TBL(ING_No).KEN_JYUSHO, 21, 20))
    
    '送り先
    Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
    
    Print #FileNo, ""
    
    '日付
    Print #FileNo, Mid(ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD, 1, 4) & _
                                               "年" & Mid(ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD, 5, 2) & _
                                               "月" & Mid(ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD, 7, 2) & "日"
    


    
    '送り元
    Print #FileNo, "ＳＤＣ内　部材流通Ｃ"
    
    
    
    Print #FileNo, "QTY P=" & Format(Mai_Su, "#0")
    Print #FileNo, "END"


    
    Print #FileNo, "JOBE"
    
    fileName = F0_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"










    Close #FileNo



    SEK_Label_File_Make_Proc = False


End Function


Private Sub SEK_KUTI_SU_Count_Proc(SAI_SU As Double, KUTI_SU As Integer)
'-------------------------------------------------------
'
'   『積水ハウス向け出荷予定 口数／才数のカウント』
'   大阪ＰＣ用  2011.05.09
'-------------------------------------------------------
Dim i   As Integer

    KUTI_SU = 0
    SAI_SU = 0

    For i = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)



'        KUTI_SU = KUTI_SU + ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(i).SEK_KUTI_SU
'        If ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(i).SEK_SAI_SU > 999 Or ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(i).SEK_SAI_SU = 0 Then
        If ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(i).SEK_SAI_SU >= 999999 Then
            SAI_SU = ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(i).SEK_SAI_SU
            Exit For
        Else
            SAI_SU = SAI_SU + ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(i).SEK_SAI_SU
        End If


    Next i


    For i = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)

        KUTI_SU = KUTI_SU + ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(i).SEK_KUTI_SU


Debug.Print KUTI_SU

    Next i


End Sub



Private Function Ido_Out_Hin_Furikae_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ品番振替移動出庫指定時のチェック＆更新処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8

Dim Hinban          As String * 20

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Ido_Out_Hin_Furikae_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(FROM_Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Ido_Out_Hin_Furikae_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Ido_Out_Hin_Furikae_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Ido_Out_Hin_Furikae_Proc = False
                                Exit Function
                            End If
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(TO_Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            FROM_Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            Ido_Out_Hin_Furikae_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Ido_Out_Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                        'FROM 実棚番
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_Hin_Furikae_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                Ido_Out_Hin_Furikae_Proc = False
                Exit Function
            End If
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban     '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品の数量
                                                            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                            
                                                            
                                                            
                                                            '商品化用倉庫区分をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.fileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
    
            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                             '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                           '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "#"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
'            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
'                                                            '表示内容
'            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
'                                                            '数値初期表示
'            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
'                                                            '初期カーソル位置
'            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
'                                                            '入力桁数
'            Send_Text.Box_Type(4).Max_Size = "05"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
'
'            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
        
        
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Ido_Out_Hin_Furikae_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Ido_Out_Hin_Furikae_Proc = False
                            Exit Function
                        End If
            
            
                        If QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                            Ido_Out_Hin_Furikae_Proc = False
                            Exit Function
                        End If
        
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
        
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Ido_Out_Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Ido_Out_Hin_Furikae_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        '次の作業要求
            
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Ido_Out_Hin_Furikae_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Private Function Hin_Furikae_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ品番振替指定時のチェック＆更新処理』
'
'   2011.06.01
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8

Dim Hinban          As String * 20
Dim TO_Hinban       As String * 20


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Hin_Furikae_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（振替前品番／振替後品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_BEF_Hinban         '振替前品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
        
        
        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                                    'FROM 仮想棚番
                        FROM_Tanaban = ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_Proc = False
                                Exit Function
                        End Select
                                
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Hin_Furikae_Proc = False
                            Exit Function
                        End If
        
        
        
        
        
                        ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN = Hinban
        
        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
        
        
        
                        ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
                        ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
        
        
                    Case LCD_AFT_Hinban         '振替後品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                        Call UniCode_Conv(K0_FURIKAE.JGYOBU_MAE, RET_JGYOBU)        '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.NAIGAI_MAE, RET_NAIGAI)        '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.HIN_MAE, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        
                        Call UniCode_Conv(K0_FURIKAE.JGYOBU_GO, RET_JGYOBU)        '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.NAIGAI_GO, RET_NAIGAI)        '2012.03.13
                        
                        
                        Call UniCode_Conv(K0_FURIKAE.HIN_GO, Hinban)
                        sts = BTRV(BtOpGetEqual, FURIKAE_POS, FURIKAEREC, Len(FURIKAEREC), K0_FURIKAE, Len(K0_FURIKAE), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, Hinban, "振替品番エラー", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品番振替Ｍ", 0)
                                Exit Function
                        End Select
                                        
                
                        
                                        
'-----------------------    2011.06.13
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select

                        ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN = Hinban

                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                                    
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
            
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, _
                                        LCD_Tanaban & " " & StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & StrConv(ITEMREC.ST_DAN, vbUnicode))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, _
                                        LCD_Tanaban & " " & StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & StrConv(ITEMREC.ST_DAN, vbUnicode))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "12"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""            '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
            '
                    
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i

'-----------------------    2011.06.13
        Case Step_Sagyo2_RES        '２回目の受信（棚番）
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    Case LCD_Tanaban    '棚番
                        TO_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(TO_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 混載チェック
                        If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                            If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_Proc = False
                                Exit Function
                            End If
                        End If
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(TO_Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(TO_Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(TO_Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(TO_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
        
        
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Hin_Furikae_Proc = False
                            Exit Function
                        End If
        
                
                
        
                
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    
                    ID_KANRI_TBL(ING_No).Tanaban = TO_Tanaban       '棚番をセーブ
                                                                
                                                                
                                                                
                    SUMI_QTY = ID_KANRI_TBL(ING_No).Send_SUMI_QTY   '送信する商品化済み数量
                    MI_QTY = ID_KANRI_TBL(ING_No).Send_MI_QTY       '送信する未商品数量
                                                                
                                                                
                                                                '商品化用倉庫区分をセーブ
                    ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
                    '数量付きの送信メッセージを作成する
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                    Send_Text.fileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
            
                    Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                                
                    '-----------------------------------------------１行目
                                                                    'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                    '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
        
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                    '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                    Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
        
                    '-----------------------------------------------２行目
                                                                    'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                                                                    '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                    '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                    Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    
                    
                    
                    '-----------------------------------------------３行目
                                                                    'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                                                                    '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                    '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                    Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    
                    
                    '-----------------------------------------------４行目
                                                                    'BOX属性
                    Send_Text.Box_Type(3).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, _
                                    Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
        
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, _
                                    Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
                                                                    '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                    
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                    '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                    Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------４行目
                                                                    'BOX属性
                    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY + MI_QTY, "#")))) & Format(SUMI_QTY + MI_QTY, "#"))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY + MI_QTY, "#")))) & Format(SUMI_QTY + MI_QTY, "#"))
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SUMI_QTY + MI_QTY, "#"))) & Format(SUMI_QTY + MI_QTY, "#")
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SUMI_QTY + MI_QTY, "#"))) & Format(SUMI_QTY + MI_QTY, "#")
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                                    '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "05"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                        
                    Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        '
                
                    Sendbuf = Text_Create_Proc()
                End Select
            
            
            Next i
        
        
        Case Step_Sagyo3_RES        '３回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_Proc = False
                            Exit Function
                        End If
            
            
                        If QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_Proc = False
                            Exit Function
                        End If
            
            
            
            
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, _
                                    "", _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    YOIN_BEF_HINBAN, _
                                    QTY, _
                                    0, 0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, Trim(ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN) & "へ振替", _
                                    , , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "-" & "01-01-01", ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Furikae_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
    
            sts = Nyuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN, _
                                    Format(Now, "YYYYMMDD"), _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    YOIN_AFT_HINBAN, _
                                    QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, Trim(ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN) & "より振替", , , , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "-" & "01-01-01", ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Furikae_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Hin_Furikae_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Private Function SEK_KYOSEI_END_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水強制完了（大阪ＰＣ向け）』
'
'       2011.06.28
'-------------------------------------------------------
Dim sts                     As Integer
Dim com                     As Integer

Dim ID_NO                   As String * 20



Dim i                       As Integer
Dim j                       As Integer


Dim SYU_JUN                 As String * 10          '出荷順番
Dim TEI_NM                  As String * 30          '邸名
Dim SYUGO_SYU_YMD           As String * 8           '出荷確定日
Dim SYUGO_L_TOK_NAME        As String * 50          '得意先名

Dim SYUGO_SUMI_CNT          As Integer
Dim HINB_CD_CNT             As Integer


Dim SEK_KYOSEI_TBL()        As SEK_KYOSEI_TBL_Tag
Dim SEK_KYOSEI_HINB_CD_TBL() _
                            As SEK_KYOSEI_HINB_CD_TBL_Tag
                        


Dim KUTI_SU                 As Integer
Dim SAI_SU                  As Double

Dim In_Word                 As String * 30
Dim Out_Word                As String * 16



    SEK_KYOSEI_END_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（邸別ＩＤ／梱包ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SEK_ID_NO      '邸別ID/梱包ID
                                
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase SEK_KYOSEI_TBL
                        j = -1
                        com = BtOpGetGreaterEqual
                        If Len(Trim(ID_NO)) > 13 Then
                        '集合梱包
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_NO)
                            
                            Do
                            
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                Select Case sts
                                    Case BtNoErr
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_NO) Then
                                            Exit Do
                                        End If
                                    Case BtErrEOF
                                        Exit Do
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
                        
                        
                                If j = -1 Then
                                    j = j + 1
                                    SYUGO_SYU_YMD = StrConv(Y_SYU_TEI_REC.SYU_YMD, vbUnicode)
                                    SYUGO_L_TOK_NAME = StrConv(Y_SYU_TEI_REC.L_TOK_NAME, vbUnicode)
                                    ReDim Preserve SEK_KYOSEI_TBL(0 To j)
                                    SEK_KYOSEI_TBL(j).SEK_ID = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                    If Trim(StrConv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, vbUnicode)) <> "" Then
                                        SEK_KYOSEI_TBL(j).SEK_KONPO_F = True
                                    Else
                                        SEK_KYOSEI_TBL(j).SEK_KONPO_F = False
                                    End If
                                    
                                    If IsNumeric(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode)) Then
                                        KUTI_SU = Val(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode))
                                    Else
                                        KUTI_SU = 1
                                    End If
                                    
                                    
                                    If IsNumeric(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) Then
                                        If Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) > 999999 Then
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                        Else
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                        End If
                                    Else
                                        SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                    End If
                                Else
                                
                                    For j = 0 To UBound(SEK_KYOSEI_TBL)
                                                                    
                                        If Trim(SEK_KYOSEI_TBL(j).SEK_ID) = Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) Then
                                            Exit For
                                        End If
                                    
                                    Next j
                                
                                    If j > UBound(SEK_KYOSEI_TBL) Then
                                    
                                        ReDim Preserve SEK_KYOSEI_TBL(0 To j)
                                        SEK_KYOSEI_TBL(j).SEK_ID = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                        If Trim(StrConv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, vbUnicode)) <> "" Then
                                            SEK_KYOSEI_TBL(j).SEK_KONPO_F = True
                                        Else
                                            SEK_KYOSEI_TBL(j).SEK_KONPO_F = False
                                        End If
                                    
                                    
                                        If IsNumeric(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) Then
                                            If Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) > 999999 Then
                                                SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                            Else
                                                SEK_KYOSEI_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                    
                                    
                                            End If
                                        Else
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                        End If
                                    End If
                                
                                End If
                                com = BtOpGetNext
                            Loop
                        Else
                        '邸別梱包
                            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_NO)
                            Erase SEK_KYOSEI_HINB_CD_TBL
                            Do
                            
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        If Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7) <> Left(ID_NO, 7) Then
                                            Exit Do
                                        End If
                                    Case BtErrEOF
                                        Exit Do
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
                        
                        
                                If j = -1 Then
                                    j = j + 1
                                    SYU_JUN = Trim(StrConv(Y_SYU_TEI_REC.SYU_JUN, vbUnicode))
                                    TEI_NM = Trim(StrConv(Y_SYU_TEI_REC.TEI_NM, vbUnicode))
                                    
                                    ReDim Preserve SEK_KYOSEI_TBL(0 To j)
                                    SEK_KYOSEI_TBL(j).SEK_ID = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                    If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                        SEK_KYOSEI_TBL(j).SEK_KONPO_F = True
                                    Else
                                        SEK_KYOSEI_TBL(j).SEK_KONPO_F = False
                                    End If
                                    
                                    If IsNumeric(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode)) Then
                                        KUTI_SU = Val(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode))
                                    Else
                                        KUTI_SU = 1
                                    End If
                                
                                
                                
                                    If IsNumeric(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) Then
                                        SEK_KYOSEI_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                        If SEK_KYOSEI_TBL(j).SEK_SAI_SU > 999 Then
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                        End If
                                    Else
                                        SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                    
                                    End If
                                
                                
                                    If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = Trim(ID_NO) Then
                                        ReDim Preserve SEK_KYOSEI_HINB_CD_TBL(0 To j)
                                        SEK_KYOSEI_HINB_CD_TBL(j).SEK_HINB_CD = Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode))
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                            SEK_KYOSEI_HINB_CD_TBL(j).SEK_KONPO_F = True
                                        Else
                                            SEK_KYOSEI_HINB_CD_TBL(j).SEK_KONPO_F = False
                                        End If
                                    End If
                                Else
                                
                                    For j = 0 To UBound(SEK_KYOSEI_TBL)
                                                                    
                                        If Trim(SEK_KYOSEI_TBL(j).SEK_ID) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                                            Exit For
                                        End If
                                    Next j
                                
                                    If j > UBound(SEK_KYOSEI_TBL) Then
                                        ReDim Preserve SEK_KYOSEI_TBL(0 To j)
                                        SEK_KYOSEI_TBL(j).SEK_ID = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                            SEK_KYOSEI_TBL(j).SEK_KONPO_F = True
                                        Else
                                            SEK_KYOSEI_TBL(j).SEK_KONPO_F = False
                                        End If
                                    
                                    
                                        If IsNumeric(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) Then
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                            If SEK_KYOSEI_TBL(j).SEK_SAI_SU > 999 Then
                                                SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                            End If
                                        
                                        Else
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                        End If
                                    
                                    End If
                                
                                
                                
                                    If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = Trim(ID_NO) Then
                                        
'2011.11.18                                        For j = 0 To UBound(SEK_KYOSEI_TBL)
                                        For j = 0 To UBound(SEK_KYOSEI_HINB_CD_TBL)
                                                                        
                                            If Trim(SEK_KYOSEI_HINB_CD_TBL(j).SEK_HINB_CD) = Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) Then
                                                Exit For
                                            End If
                                        Next j
                                        
'2011.11.18                                        If j > UBound(SEK_KYOSEI_TBL) Then
                                        If j > UBound(SEK_KYOSEI_HINB_CD_TBL) Then
                                        
                                            ReDim Preserve SEK_KYOSEI_HINB_CD_TBL(0 To j)
                                            SEK_KYOSEI_HINB_CD_TBL(j).SEK_HINB_CD = Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode))
                                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                                SEK_KYOSEI_HINB_CD_TBL(j).SEK_KONPO_F = True
                                            Else
                                                SEK_KYOSEI_HINB_CD_TBL(j).SEK_KONPO_F = False
                                            End If
                                        End If
                                    End If
                                
                                
                                
                                End If
                                com = BtOpGetNext
                            Loop
                        End If
                                        
                        If j = -1 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "注文ﾃﾞｰﾀなし", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_KYOSEI_END_PROC = False
                            Exit Function
                        End If
                                                            
                        ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID = ID_NO
                                                            
                                                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        If Len(Trim(ID_NO)) > 13 Then
                            '集合梱包
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            In_Word = Trim(SYUGO_L_TOK_NAME)
                            Call Moji_Cut_Proc(In_Word, Out_Word, 20)
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(Out_Word))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(Out_Word))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                            '集合梱包状態のカウント
                            SYUGO_SUMI_CNT = 0
                            For j = 0 To UBound(SEK_KYOSEI_TBL)
                                If SEK_KYOSEI_TBL(j).SEK_KONPO_F Then
                                    SYUGO_SUMI_CNT = SYUGO_SUMI_CNT + 1
                                End If
                            Next j
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Mid(SYUGO_SYU_YMD, 1, 4) & "/" & Mid(SYUGO_SYU_YMD, 5, 2) & "/" & Mid(SYUGO_SYU_YMD, 7, 2) & _
                                                                        " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(SEK_KYOSEI_TBL) + 1, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Mid(SYUGO_SYU_YMD, 1, 4) & "/" & Mid(SYUGO_SYU_YMD, 5, 2) & "/" & Mid(SYUGO_SYU_YMD, 7, 2) & _
                                                                        " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(SEK_KYOSEI_TBL) + 1, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        Else
                            '邸別梱包
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID), 2)), "#0") & "/" & Format(UBound(SEK_KYOSEI_TBL) + 1, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID), 2)), "#0") & "/" & Format(UBound(SEK_KYOSEI_TBL) + 1, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            
                            '-----------------------------------------------２行目
                            In_Word = TEI_NM
                            Call Moji_Cut_Proc(In_Word, Out_Word, 16)
                                                                                    
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(SYU_JUN) & " " & Out_Word)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(SYU_JUN) & " " & Out_Word)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            '品番状態のカウント
                            HINB_CD_CNT = 0
                            
                            For j = 0 To UBound(SEK_KYOSEI_HINB_CD_TBL)
                                If SEK_KYOSEI_HINB_CD_TBL(j).SEK_KONPO_F Then
                                    HINB_CD_CNT = HINB_CD_CNT + 1
                                End If
                            Next j
                                                        
                                                        
                            
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(UBound(SEK_KYOSEI_HINB_CD_TBL) + 1, "#0)"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(UBound(SEK_KYOSEI_HINB_CD_TBL) + 1, "#0)"))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        End If
                        '-----------------------------------------------４行目
                        
'                        KUTI_SU = 0
'                        For j = 0 To UBound(SEK_KYOSEI_TBL)
'
'                            If SEK_KYOSEI_TBL(j).SEK_ID = ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID Then
'                                KUTI_SU = KUTI_SU + SEK_KYOSEI_TBL(j)
'                            End If
'
'                        Next j
                        
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(Trim(Format(KUTI_SU, "#0")))) & Trim(Format(KUTI_SU, "#0"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Trim(Format(KUTI_SU, "#0")))) & Trim(Format(KUTI_SU, "#0"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "12"
                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "04"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "04"
                        '-----------------------------------------------５行目
                        SAI_SU = 0
                        For j = 0 To UBound(SEK_KYOSEI_TBL)
                        
                            If SEK_KYOSEI_TBL(j).SEK_ID = ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID Then
                                SAI_SU = SAI_SU + SEK_KYOSEI_TBL(j).SEK_SAI_SU
                            End If
                        
                        Next j
                        
                        
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(SAI_SU, "#0.00")))) & Trim(Format(SAI_SU, "#0.00"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(SAI_SU, "#0.00")))) & Trim(Format(SAI_SU, "#0.00"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                        Sendbuf = Text_Create_Proc()
                            
                        SEK_KYOSEI_END_PROC = False
                        Exit Function
                            
                End Select
            Next i
        
                
        Case Step_Sagyo2_RES        '２回目の受信(口数,入り数）
                
                
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '口数
                    Case LCD_KUTI_SU_S
                    
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                    
                        KUTI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If KUTI_SU <= 0 Then
                        
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                    
                    '才数
                    Case LCD_SAI_SU_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                
                        SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                
                
                        If SAI_SU <= 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                        '------------------------------------   注文ﾃﾞｰﾀの処理
                        If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID)) > 13 Then
                        
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID)
                            com = BtOpGetGreaterEqual
            
                            Do
                    
                                DoEvents
                
                                Do
                    
                                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrEOF
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                
                                Loop
            
                
                                If sts = BtErrEOF Then
                                    Exit Do
                                End If
                    
                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID) Then
                                    Exit Do
                                End If
                        
                
                                Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, Format(KUTI_SU, "0000"))
                                Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(SAI_SU, "000.00"))
                            
                                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                        
                        
                
                                Do
                                    DoEvents
                                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                
                    
                                com = BtOpGetNext
                
                
                            Loop
                        
                        Else
                            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID)
                            com = BtOpGetGreaterEqual
            
                            Do
                    
                                DoEvents
                
                                Do
                    
                                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrEOF
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                
                                Loop
            
                
                                If sts = BtErrEOF Then
                                    Exit Do
                                End If
                    
                                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID) Then
                                    Exit Do
                                End If
                        
                
                                Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, Format(KUTI_SU, "0000"))
                                Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(SAI_SU, "000.00"))
                            
                                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                        
                        
                
                                Do
                                    DoEvents
                                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                
                    
                                com = BtOpGetNext
                
                
                            Loop
                        End If
                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
    
    
                        '次の作業要求
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                        End Select
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                    
                        Sendbuf = Text_Create_Proc()
                    
                End Select
            Next i
                
    End Select

    SEK_KYOSEI_END_PROC = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function


Private Function NYUKO_KENPIN_OSAKA_S_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　資材検収入庫』
'
'   2012.03.06
'
'-------------------------------------------------------
Dim i               As Integer


Dim Hinban          As String * 20
Dim Tanaban         As String * 8
Dim QTY             As Long

Dim sts             As Integer


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2


Dim wkORDER_QTY     As Long
Dim wkNYUKO_QTY     As Long
Dim wkQty           As Long

Dim ST_TANABAN      As String * 11


    NYUKO_KENPIN_OSAKA_S_Proc = True


    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）

            For i = 0 To M_Gyo - 1
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                NYUKO_KENPIN_OSAKA_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        If Trim(StrConv(ITEMREC.ST_SOKO, vbUnicode)) = "" Then
                            ST_TANABAN = ""
                        Else
                            ST_TANABAN = StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & _
                                            StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & _
                                            StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & _
                                            StrConv(ITEMREC.ST_DAN, vbUnicode)
                        End If
                        
                        
                        
                        '当月仕入予定残集計
                        If ORDER_ZAN_Proc(RET_JGYOBU, NAIGAI_NAI, Hinban, wkORDER_QTY, wkNYUKO_QTY) Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        ID_KANRI_TBL(ING_No).ORDER_QTY = wkORDER_QTY
                        ID_KANRI_TBL(ING_No).NYUKO_QTY = wkNYUKO_QTY
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban & " " & ST_TANABAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban & " " & ST_TANABAN)
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "16"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "16"
                                                                                
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                    
                    
                    

                        Sendbuf = Text_Create_Proc()
                        
                        Exit Function
                
                End Select
            Next i
    
    
        Case Step_Sagyo2_RES        '２回目の受信（棚番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                    
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                NYUKO_KENPIN_OSAKA_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 混載チェック
                        If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                            If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).S_JGYOBU Or _
                                StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                NYUKO_KENPIN_OSAKA_S_Proc = False
                                Exit Function
                            End If
                        End If
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                    
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                        
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                                NYUKO_KENPIN_OSAKA_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
                    
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                                
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")
                    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            
                            NYUKO_KENPIN_OSAKA_S_Proc = False
                            Exit Function
                        End If
                        ID_KANRI_TBL(ING_No).Tanaban = Tanaban
    
    
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, _
                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))

                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, _
                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "注残(" & USE_YM & "):" & Format(ID_KANRI_TBL(ING_No).ORDER_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "注残(" & USE_YM & "):" & Format(ID_KANRI_TBL(ING_No).ORDER_QTY, "#0"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

                        '-----------------------------------------------５行目
                                                            'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        
                        wkQty = ID_KANRI_TBL(ING_No).ORDER_QTY - ID_KANRI_TBL(ING_No).NYUKO_QTY
                        If wkQty < 0 Then
                            wkQty = 0
                        End If
                        
                        
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(wkQty, "#0"))) & Format(wkQty, "#0")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(wkQty, "#0"))) & Format(wkQty, "#0")
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        
                        NYUKO_KENPIN_OSAKA_S_Proc = False
                        Exit Function
                End Select
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（数量）
            For i = 0 To M_Gyo - 1
            
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
            
            
                    Case LCD_Suryo          '数量
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            NYUKO_KENPIN_OSAKA_S_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            NYUKO_KENPIN_OSAKA_S_Proc = False
                            Exit Function
                        End If
                
                
                        If QTY <= (ID_KANRI_TBL(ING_No).ORDER_QTY - ID_KANRI_TBL(ING_No).NYUKO_QTY) Then
                        
                        
                                                                'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                Exit Function
                            End If
                                                                
                                                                
                            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                        
                            Else
                                        
                                MENU_NO = ""
                            End If
                                                                '入庫更新
                            sts = Nyuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).Hinban, _
                                                    Format(Now, "YYYYMMDD"), _
                                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    QTY, _
                                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, , , , , MENU_NO)
                            Select Case sts
                                Case False
                                Case True           '入庫時は発生しない
                                Case SYS_CANCEL
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    
                                    NYUKO_KENPIN_OSAKA_S_Proc = False
                                    GoTo Abort_Tran
                                Case SYS_ERR
                                    Sendbuf = Text_Create_Proc()
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    NYUKO_KENPIN_OSAKA_S_Proc = SYS_ERR    'システム異常発生
                                    
                                    GoTo Abort_Tran
                            End Select
                                        
                            GoTo End_Tran
                        
                                                    
                        Else
                        
                            ID_KANRI_TBL(ING_No).INPUT_QTY = QTY
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DOUBLE                        'ブザー音　二重警告音
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
'                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
'                                                                                    '数値初期表示
'                            Send_Text.Box_Type(0).INIT = ""
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
'                                                                                    '初期カーソル位置
'                            Send_Text.Box_Type(0).Start_Pos = ""
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                                                    '入力桁数
'                            Send_Text.Box_Type(0).Max_Size = "00"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
'                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "注文残:" & Format(ID_KANRI_TBL(ING_No).ORDER_QTY, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "注文残:" & Format(ID_KANRI_TBL(ING_No).ORDER_QTY, "#0"))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "総入庫数:" & Format(ID_KANRI_TBL(ING_No).NYUKO_QTY + QTY, "#0"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "総入庫数:" & Format(ID_KANRI_TBL(ING_No).NYUKO_QTY + QTY, "#0"))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "棚入れを行いますか？")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "棚入れを行いますか？")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "20"                  '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "20"
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "01"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
                            NYUKO_KENPIN_OSAKA_S_Proc = False
                            
                            Exit Function
                        End If
                
                End Select
            Next i
    
    
        Case Step_Sagyo4_RES        '４回目の受信（処理継続(Y/N)）
            
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
            
            
                    Case LCD_CAN_ANS          '数量
                        If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) <> "1" And Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) <> "9" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "1 OR 9 を入力", "して下さい。", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            NYUKO_KENPIN_OSAKA_S_Proc = False
                            Exit Function
                        End If
                
                
                
                        If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) = "1" Then
                                                                'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                Exit Function
                            End If
                                                                
                                                                
                            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                        
                            Else
                                        
                                MENU_NO = ""
                            End If
                                                                '入庫更新
                            sts = Nyuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).Hinban, _
                                                    Format(Now, "YYYYMMDD"), _
                                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    ID_KANRI_TBL(ING_No).INPUT_QTY, _
                                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, , , , , MENU_NO)
                            Select Case sts
                                Case False
                                Case True           '入庫時は発生しない
                                Case SYS_CANCEL
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    
                                    NYUKO_KENPIN_OSAKA_S_Proc = False
                                    GoTo Abort_Tran
                                Case SYS_ERR
                                    Sendbuf = Text_Create_Proc()
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    NYUKO_KENPIN_OSAKA_S_Proc = SYS_ERR    'システム異常発生
                                    
                                    GoTo Abort_Tran
                            End Select
                                        
                            GoTo End_Tran
                        Else
                                                                '次の作業要求
                            
                            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                            Select Case sts
                                Case BtNoErr
                                '   -------------------------------- エラーメッセージ作成
                                Case Else
                                '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                            End Select
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                                    
                            Sendbuf = Text_Create_Proc()
                            
                            
                            
                            NYUKO_KENPIN_OSAKA_S_Proc = False
                            
                            Exit Function
                        
                        End If
            
                End Select
            Next i
    End Select

End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        GoTo Abort_Tran
    End If
                                        '次の作業要求
    
    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
    Select Case sts
        Case BtNoErr
        '   -------------------------------- エラーメッセージ作成
        Case Else
        '重要な要因なので未登録はシステム停止とする
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
        Exit Function
    End Select
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
    If Sagyo_Send_Proc() Then
        Sendbuf = Text_Create_Proc()
        Exit Function
    End If
            
    Sendbuf = Text_Create_Proc()
    
    
    
    NYUKO_KENPIN_OSAKA_S_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Private Function ORDER_ZAN_Proc(JGYOBU As String, NAIGAI As String, Hinban As String, ORDER_QTY As Long, NYUKO_QTY As Long) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　資材注文残集計』
'
'   2012.03.06
'
'-------------------------------------------------------
Dim com         As Integer
Dim sts         As Integer
    
    
Dim i           As Integer
    
Dim wkJgyobu    As String * 1
    
    
    ORDER_ZAN_Proc = True
    
    If JGYOBU = BUZAI Then
        wkJgyobu = SHIZAI
    Else
        wkJgyobu = JGYOBU
    End If
    
    Call UniCode_Conv(K7_P_SHORDER.USE_YM, USE_YM)
    Call UniCode_Conv(K7_P_SHORDER.JGYOBU, wkJgyobu)
    Call UniCode_Conv(K7_P_SHORDER.NAIGAI, NAIGAI)
    Call UniCode_Conv(K7_P_SHORDER.HIN_GAI, Hinban)
    Call UniCode_Conv(K7_P_SHORDER.CANCEL_F, P_CANCEL_OFF)
    
    ORDER_QTY = 0
    com = BtOpGetGreaterEqual
    
        
    Do
        
        DoEvents
        
        sts = BTRV(com, P_SHORDER_POS, P_SHORDER_REC, Len(P_SHORDER_REC), K7_P_SHORDER, Len(K7_P_SHORDER), 7)
        Select Case sts
            Case BtNoErr
            
                If StrConv(P_SHORDER_REC.USE_YM, vbUnicode) <> USE_YM Or _
                    StrConv(P_SHORDER_REC.JGYOBU, vbUnicode) <> wkJgyobu Or _
                    StrConv(P_SHORDER_REC.NAIGAI, vbUnicode) <> NAIGAI Or _
                    RTrim(StrConv(P_SHORDER_REC.HIN_GAI, vbUnicode)) <> RTrim(Hinban) Or _
                    StrConv(P_SHORDER_REC.CANCEL_F, vbUnicode) <> P_CANCEL_OFF Then
                       
                    Exit Do
                    
                End If
            
            Case BtErrEOF
                Exit Do
            
            '   -------------------------------- エラーメッセージ作成
            Case Else
                '重要な要因なので未登録はシステム停止とする
                Call File_Error(sts, BtOpGetEqual, "資材注文ﾃﾞｰﾀ", 0)
                Exit Function
        End Select
    
        ORDER_QTY = ORDER_QTY + (Val(StrConv(P_SHORDER_REC.ORDER_QTY, vbUnicode)) - Val(StrConv(P_SHORDER_REC.UKEIRE_QTY, vbUnicode)))
    
        com = BtOpGetNext
    
    Loop
    
    Call UniCode_Conv(K1_IDO.JGYOBU, JGYOBU)
    Call UniCode_Conv(K1_IDO.NAIGAI, NAIGAI)
    Call UniCode_Conv(K1_IDO.HIN_GAI, Hinban)
    Call UniCode_Conv(K1_IDO.JITU_DT, BUZAI_DATE_S)
    Call UniCode_Conv(K1_IDO.JITU_TM, "")
    NYUKO_QTY = 0
    com = BtOpGetGreaterEqual
    
    Do
        
        DoEvents
        
        sts = BTRV(com, IDO_POS, IDOREC, Len(IDOREC), K1_IDO, Len(K1_IDO), 1)
        Select Case sts
            Case BtNoErr
            
                If StrConv(IDOREC.JGYOBU, vbUnicode) <> JGYOBU Or _
                    StrConv(IDOREC.NAIGAI, vbUnicode) <> NAIGAI Or _
                    RTrim(StrConv(IDOREC.HIN_GAI, vbUnicode)) <> RTrim(Hinban) Or _
                    StrConv(IDOREC.JITU_DT, vbUnicode) > BUZAI_DATE_E Then
                       
                    Exit Do
                    
                End If
            
            Case BtErrEOF
                Exit Do
            
            '   -------------------------------- エラーメッセージ作成
            Case Else
                '重要な要因なので未登録はシステム停止とする
                Call File_Error(sts, BtOpGetEqual, "在庫移動歴", 0)
                Exit Function
        End Select
    
    
    
            
    
        For i = 0 To UBound(IN_TANA_S_OSAKA)
        
            If StrConv(IDOREC.RIRK_ID, vbUnicode) = IN_TANA_S_OSAKA(i) Then
            
                NYUKO_QTY = NYUKO_QTY + (Val(StrConv(IDOREC.SUMI_JITU_QTY, vbUnicode)) + Val(StrConv(IDOREC.MI_JITU_QTY, vbUnicode)))
                    
            
            End If
        
        Next i
        
        com = BtOpGetNext
    
    Loop
    
    
    
    
    ORDER_ZAN_Proc = False

End Function
Private Function Ido_Out_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材用移動出庫指定時のチェック＆更新処理』
'       2012.03.10
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer
Dim j               As Integer      '2012.03.29

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8

Dim Hinban          As String * 20

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim SHIJI_No        As String * 8
Dim Found_F         As Boolean

Dim MENU_NO         As String * 2

Dim fileName        As String

Dim wkQty           As Long         '2012.04.07
Dim SYUKO_QTY       As Long         '2012.04.07


Dim Hinban_GO       As String * 20  '2012.12.27


    Ido_Out_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票№）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO       '指図票№
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
                        
                        
                        sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "未登録です", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_Out_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "商品化指図票(親)", 0)
                                Ido_Out_OSAKA_Proc = SYS_ERR
                                Exit Function
                        End Select
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                       'ブザー音　標準
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№:" & SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№:" & SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "09"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        Ido_Out_OSAKA_Proc = False
                        Exit Function
            
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case RTrim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    Case LCD_Tanaban        '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_Out_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Ido_Out_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
                        
                        For j = 0 To UBound(JGYOBU_T)
                            
                            If JGYOBU_T(j).CODE = SHIZAI Then
                                sts = Item_Read_Proc(JGYOBU_T(j).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                            Else
                                sts = Item_Read_Proc(JGYOBU_T(j).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                            End If
                            Select Case sts
                                Case BtNoErr
                                    Exit For
                                Case BtErrKeyNotFound
                                    '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                                
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            
                                    Ido_Out_OSAKA_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                    Exit Function
                            End Select
                        Next j
                        
                                                
                        
                        '------------------ 子品番の有無
                        Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
                        Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
                        Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")
        
                        Found_F = False
                        com = BtOpGetGreater
        
                        Do
                            
                            DoEvents
                            sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                            Select Case sts
                                Case BtNoErr
                                    If ID_KANRI_TBL(ING_No).SHIJI_No <> StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) Then
                                        Exit Do
                                    End If
                                
                                    If RTrim(Hinban) = RTrim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)) Then
                                        
                                        
                                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                                        
                                        If Fueikae_Read_Proc(Hinban, Hinban_GO) Then
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Exit Function
                                        End If
                                        
                                        If Trim(Hinban_GO) <> "" Then
                                            Hinban = Hinban_GO
                                            SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.HIKIATE_QTY, vbUnicode))
                                            ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode)) * Val(StrConv(FURIKAEREC.CUT_SU, vbUnicode))
                                        Else
                                            
                                            SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode)) - Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))                           '2012.04.13
                                            ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))
                                        
                                        
                                        End If
                                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                                        
                                        
                                        'ID_KANRI_TBL(ING_No).Send_MI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))    2012.04.07
                                        'SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))                           2012.04.13
'2012.12.27                                        SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode)) - Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))                           '2012.04.13
'2012.12.27                                        ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))    '2012.04.13
                                        
                                        
                                        Found_F = True
                                        Exit Do
                                    End If
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "指図票(子)", 0)
                                    Exit Function
                            End Select
                            
                            com = BtOpGetNext
                        
                        Loop
        
        
                        If Not Found_F Then
                            
                            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.27
                            
'                            '-------------------------------------  読み替えコードで再読み込み  2012.04.05
'
'                            '------------------ 子品番の有無
'                            Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
'                            Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
'                            Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")
'
'
'                            com = BtOpGetGreater
'
'                            Do
'
'                                DoEvents
'                                sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
'                                Select Case sts
'                                    Case BtNoErr
'                                        If ID_KANRI_TBL(ING_No).SHIJI_No <> StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) Then
'                                            Exit Do
'                                        End If
'                                        Call UniCode_Conv(K1_FURIKAE.JGYOBU_GO, BUZAI)
'                                        Call UniCode_Conv(K1_FURIKAE.NAIGAI_GO, NAIGAI_NAI)
'                                        Call UniCode_Conv(K1_FURIKAE.HIN_GO, Hinban)
'
'                                        Call UniCode_Conv(K1_FURIKAE.JGYOBU_MAE, BUZAI)
'                                        Call UniCode_Conv(K1_FURIKAE.NAIGAI_MAE, NAIGAI_NAI)
'                                        Call UniCode_Conv(K1_FURIKAE.HIN_MAE, StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode))
'
'
'                                        sts = BTRV(BtOpGetEqual, FURIKAE_POS, FURIKAEREC, Len(FURIKAEREC), K1_FURIKAE, Len(K1_FURIKAE), 1)
'                                        Select Case sts
'                                            Case BtNoErr
'
'                                                'ID_KANRI_TBL(ING_No).Send_MI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))    2012.04.07
'                                                'SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))                           2012.04.13
'                                                SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.HIKIATE_QTY, vbUnicode))                             '2012.04.13
'                                                ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))    '2012.04.13
'
'                                                Found_F = True
'                                                Exit Do
'
'                                            Case BtErrKeyNotFound
'
'
'                                            Case Else
'                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                                Sendbuf = Text_Create_Proc()
'                                                Call File_Error(sts, BtOpGetEqual, "品番振替マスタ", 0)
'                                                Exit Function
'                                        End Select
'
'                                    Case BtErrEOF
'                                        Exit Do
'                                    Case Else
'                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                        Sendbuf = Text_Create_Proc()
'                                        Call File_Error(sts, BtOpGetEqual, "指図票(子)", 0)
'                                        Exit Function
'                                End Select
'
'                                com = BtOpGetNext
'
'                            Loop
'
'                            '-------------------------------------  読み替えコードで再読み込み  2012.04.05
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.27
                            
                            '   -------------------------------- エラーメッセージ作成
                            
                            If Not Found_F Then
                            
                            
                                
                            
                            
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "子品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                Ido_Out_OSAKA_Proc = False
                                Exit Function
                            End If
                        End If
        
        
                        If StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode) = "9" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "商品化用に移動済み！", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
        
        
        
                End Select
            Next i
            
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                        'FROM 実棚番
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_OSAKA_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                Ido_Out_OSAKA_Proc = False
                Exit Function
            End If
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban     '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する商品化済み数量
                                                            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                            
                                                            
                                                            
                                                            '商品化用倉庫区分をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
    
            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
            Send_Text.fileName = ""                                 '送信データファイル名
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                             '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                           '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.04.07 出庫数を１行に変更
'            '-----------------------------------------------４行目
'                                                            'BOX属性
'            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
'                                                            '表示内容
'            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0")))) & Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0")))) & Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))
'                                                            '数値初期表示
'            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0")
'                                                            '初期カーソル位置
'            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
'                                                            '入力桁数
'            Send_Text.Box_Type(3).Max_Size = "05"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
'
'            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
'            '-----------------------------------------------５行目
'                                                            'BOX属性
'            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
'                                                        '表示内容
'            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0")))) & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0")))) & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))
'                                                            '数値初期表示
'            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0")
'                                                            '初期カーソル位置
'            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
'                                                            '入力桁数
'            Send_Text.Box_Type(4).Max_Size = "05"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
'
'            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
'
'            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                           '表示内容
            
            
            
            
            If ID_KANRI_TBL(ING_No).S_JGYOBU = BUZAI Then
                
                If SYUKO_QTY = 0 Then                               '2012.04.13
                    SYUKO_QTY = ID_KANRI_TBL(ING_No).KO_SHIJI_QTY   '2012.04.13
                End If                                              '2012.04.13
                
                
                If ID_KANRI_TBL(ING_No).Send_MI_QTY < SYUKO_QTY Then
                    wkQty = ID_KANRI_TBL(ING_No).Send_MI_QTY
                Else
                    wkQty = SYUKO_QTY
                End If
                ID_KANRI_TBL(ING_No).Send_MI_QTY = wkQty
                ID_KANRI_TBL(ING_No).Send_SUMI_QTY = 0
            Else
                
                If SYUKO_QTY = 0 Then                               '2012.04.13
                    SYUKO_QTY = ID_KANRI_TBL(ING_No).KO_SHIJI_QTY   '2012.04.13
                End If                                              '2012.04.13
                
                
                If ID_KANRI_TBL(ING_No).Send_SUMI_QTY < SYUKO_QTY Then
                    wkQty = ID_KANRI_TBL(ING_No).Send_SUMI_QTY
                Else
                    wkQty = SYUKO_QTY
                End If
                ID_KANRI_TBL(ING_No).Send_MI_QTY = 0
                ID_KANRI_TBL(ING_No).Send_SUMI_QTY = wkQty
            End If
            
            
            
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OSAKA_IDO_OUT & Space(M_Keta - (Len(LCD_OSAKA_IDO_OUT) * 2) - 5 + (5 - Len(Format(wkQty, "#0")))) & Format(wkQty, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OSAKA_IDO_OUT & Space(M_Keta - (Len(LCD_OSAKA_IDO_OUT) * 2) - 5 + (5 - Len(Format(wkQty, "#0")))) & Format(wkQty, "#0"))
                                                           '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(wkQty, "#0"))) & Format(wkQty, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(wkQty, "#0"))) & Format(wkQty, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"

            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                        '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.04.07 出庫数を１行に変更
        
        
            Sendbuf = Text_Create_Proc()
            Ido_Out_OSAKA_Proc = False
            Exit Function
        
        
        Case Step_Sagyo3_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
'                    Case LCD_Suryo          '数量（ここは無い）
'                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                            Ido_Out_OSAKA_Proc = False
'                            Exit Function
'                        End If
'
'                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
'                        If QTY = 0 Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                            Ido_Out_OSAKA_Proc = False
'                            Exit Function
'                        End If
'
'
'                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
'
'                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                            Ido_Out_OSAKA_Proc = False
'                            Exit Function
'                        End If
'
'
'                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
'                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
''                            If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
''                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
''                                Sendbuf = Text_Create_Proc()
''                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
''
''                                Ido_Out_OSAKA_Proc = False
''                                Exit Function
''                            End If
'                        Else
'                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
''                            If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
''                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
''                                Sendbuf = Text_Create_Proc()
''                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
''
''                                Ido_Out_OSAKA_Proc = False
''                                Exit Function
''                            End If
'                        End If
'
'                        If i = M_Gyo - 1 Then       '最終行だったら
'                            If SUMI_QTY = 0 And MI_QTY = 0 Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                Ido_Out_OSAKA_Proc = False
'                                Exit Function
'                            End If
'
'
'                            If SUMI_QTY + MI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "数量オーバー", "数量入力ミス", "", "")
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                Ido_Out_OSAKA_Proc = False
'                                Exit Function
'                            End If
'
'                        End If
                    Case LCD_OSAKA_IDO_OUT
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If

                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
               
                        If QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "数量オーバー", "数量入力ミス", Format(QTY, "#0"), Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
              
               
                
                End Select
            Next i
            
            
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
        
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
            If ID_KANRI_TBL(ING_No).S_JGYOBU = BUZAI Then
                MI_QTY = QTY
                SUMI_QTY = 0
            Else
                MI_QTY = 0
                SUMI_QTY = QTY
            End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
            
            
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, ID_KANRI_TBL(ING_No).SHIJI_No, MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Ido_Out_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Ido_Out_OSAKA_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
    
            '------------------ 子品番の移動済み更新
            Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
            Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")

            Found_F = False
            com = BtOpGetGreater

            Do
                
                DoEvents
                sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                Select Case sts
                    Case BtNoErr
                        If ID_KANRI_TBL(ING_No).SHIJI_No <> StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) Then
                            Exit Do
                        End If
                    
                        If RTrim(ID_KANRI_TBL(ING_No).Hinban) = RTrim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)) Then
                            
                            
                            QTY = Val(StrConv(P_SSHIJI_K_REC.HIKIATE_QTY, vbUnicode))                                   '2012.04.13
                            QTY = QTY - (SUMI_QTY + MI_QTY)                                                             '2012.04.13
                            If QTY < 0 Then
                                QTY = 0
                            End If
                            'Call UniCode_Conv(P_SSHIJI_K_REC.HIKIATE_QTY, Format(SUMI_QTY + MI_QTY, "00000000.00"))    2012.04.13
                            Call UniCode_Conv(P_SSHIJI_K_REC.HIKIATE_QTY, Format(QTY, "00000000.00"))                   '2012.04.13
                            
                            
                            
                            QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))                                  '2012.04.13
                            QTY = QTY + (SUMI_QTY + MI_QTY)                                                             '2012.04.13
                            Call UniCode_Conv(P_SSHIJI_K_REC.IDO_SUMI_QTY, Format(QTY, "00000000.00"))                  '2012.04.13
                            
                            If QTY >= ID_KANRI_TBL(ING_No).KO_SHIJI_QTY Then                                            '2012.04.13
                                Call UniCode_Conv(P_SSHIJI_K_REC.IDO_SUMI, "9")
                            End If                                                                                      '2012.04.13
                            
                            sts = BTRV(BtOpUpdate, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                        
                            Select Case sts
                                Case BtNoErr
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpUpdate, "指図票(子)", 0)
                                    Exit Function
                            End Select
                        
                        
                        
                        
                        End If
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "指図票(子)", 0)
                        Exit Function
                End Select
                
                com = BtOpGetNext
            
            Loop
    
    
    
    
    
    
    
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            
            'ラベル発行処理
            If LABEL_88_SendFile <> "" And _
                Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) <> "" Then
                
                
                fileName = LABEL_88_SendFile
                
                If Label_Print_File_Make_Proc(fileName, ID_KANRI_TBL(ING_No).Hinban, 0) Then
                End If
            
            
            
                'データ送信
                ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                            
                                            
                ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
            
                ID_KANRI_TBL(ING_No).LABEL_ON = True
            
                '-----------------------------------------------ヘッダー
            
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL
            
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                Send_Text.fileName = fileName                           '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = fileName
            
                Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
            
                Sendbuf = Text_Create_Proc()
                Ido_Out_OSAKA_Proc = False
                
                Exit Function
            
            Else
                '出荷予定／在庫の予約解除
                sts = Data_Clear_Proc(0, Sendbuf)
                Select Case sts
                    Case SYS_CANCEL
                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    
                    Case SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                End Select
                                            
'                                            '次の作業要求
'
'
'                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
'                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
'                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
'                Select Case sts
'                    Case BtNoErr
'                    '   -------------------------------- エラーメッセージ作成
'                    Case Else
'                    '重要な要因なので未登録はシステム停止とする
'                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                    Sendbuf = Text_Create_Proc()
'                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
'                    Exit Function
'                End Select
'
'                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
'
'                Sendbuf = Text_Create_Proc()
'                Ido_Out_OSAKA_Proc = False
'
'                Exit Function
            
                '>>>>2012.03.29　品番入力へ
                '-----------------------------------------------ヘッダー
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.fileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
        
                Send_Text.Buzzer = Buzzer_DEF                       'ブザー音　標準
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "09"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                    
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()
                Ido_Out_OSAKA_Proc = False
                Exit Function
            
            
            
            
            End If
                                        
                                        
                                        
        Case Step_PRINT_RES         '２回目の受信（印刷終了）
'                                                    '次の作業要求
'                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
'                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
'                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
'                Select Case sts
'                    Case BtNoErr
'                    '   -------------------------------- エラーメッセージ作成
'                    Case Else
'                    '重要な要因なので未登録はシステム停止とする
'                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                    Sendbuf = Text_Create_Proc()
'                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
'                    Exit Function
'                End Select
'                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
'
'                Sendbuf = Text_Create_Proc()
                                        
            '>>>>2012.03.29　品番入力へ
            '-----------------------------------------------ヘッダー
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.fileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
    
            Send_Text.Buzzer = Buzzer_DEF                       'ブザー音　標準
            '-----------------------------------------------１行目
                                                                    'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                    '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                                    'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                    '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(1).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                                    'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                    '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(2).Max_Size = "09"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                    
            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                                    'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                    '数値初期表示
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(3).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                    
                                                                    
                                                                    
            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------４行目
                                                                    'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                
                                                                    '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                    '入力桁数
             Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

            Sendbuf = Text_Create_Proc()
            Ido_Out_OSAKA_Proc = False
            Exit Function
            
            
            
            
                                        
                                        
                                        
    
    End Select

    Ido_Out_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Private Function Hin_Furikae_S_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ 部材ｾﾝﾀｰ品番振替指定時のチェック＆更新処理』
'
'           2012.03.13
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long

Dim BEF_QTY         As Long
Dim AFT_QTY         As Long



Dim i               As Integer

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8
Dim ST_TANABAN      As String * 8


Dim Hinban          As String * 20
Dim TO_Hinban       As String * 20


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Hin_Furikae_S_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（振替前品番／振替後品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_BEF_Hinban         '振替前品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                        ST_TANABAN = StrConv(ITEMREC.ST_SOKO, vbUnicode) & _
                                        StrConv(ITEMREC.ST_RETU, vbUnicode) & _
                                        StrConv(ITEMREC.ST_REN, vbUnicode) & _
                                        StrConv(ITEMREC.ST_REN, vbUnicode)
        
                        ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN = Hinban
        
        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
        
        
        
                        ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
                        ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
        
        
                    Case LCD_AFT_Hinban         '振替後品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                        Call UniCode_Conv(K0_FURIKAE.JGYOBU_MAE, RET_JGYOBU)        '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.NAIGAI_MAE, RET_NAIGAI)        '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.HIN_MAE, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        
                        Call UniCode_Conv(K0_FURIKAE.JGYOBU_GO, RET_JGYOBU)         '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.NAIGAI_GO, RET_NAIGAI)         '2012.03.13
                        
                        
                        Call UniCode_Conv(K0_FURIKAE.HIN_GO, Hinban)
                        sts = BTRV(BtOpGetEqual, FURIKAE_POS, FURIKAEREC, Len(FURIKAEREC), K0_FURIKAE, Len(K0_FURIKAE), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, Hinban, "振替品番エラー", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品番振替Ｍ", 0)
                                Exit Function
                        End Select
                                        
                
                        
                                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select

                        ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN = Hinban

                        ID_KANRI_TBL(ING_No).CUT_SU = Val(StrConv(FURIKAEREC.CUT_SU, vbUnicode))


                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                                    
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
            
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, _
                                        LCD_Tanaban & " " & Mid(ST_TANABAN, 1, 2) & "-" & Mid(ST_TANABAN, 3, 2) & "-" & Mid(ST_TANABAN, 5, 2) & "-" & Mid(ST_TANABAN, 7, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, _
                                        LCD_Tanaban & " " & Mid(ST_TANABAN, 1, 2) & "-" & Mid(ST_TANABAN, 3, 2) & "-" & Mid(ST_TANABAN, 5, 2) & "-" & Mid(ST_TANABAN, 7, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "12"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""            '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
            '
                    
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i

'-----------------------    2011.06.13
        Case Step_Sagyo2_RES        '２回目の受信（棚番）
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    Case LCD_Tanaban    '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 混載チェック
                        If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                            If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            End If
                        End If
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
        
        
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Hin_Furikae_S_Proc = False
                            
                            Exit Function
                        End If
        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                                    'FROM 棚番
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, ID_KANRI_TBL(ING_No).S_JGYOBU, ID_KANRI_TBL(ING_No).S_NAIGAI, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_S_Proc = False
                                Exit Function
                        End Select
                                
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Hin_Furikae_S_Proc = False
                            Exit Function
                        End If
                
                
        
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban         '棚番をセーブ
                                                                    
                                                                    
                                                                    
                        ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY       '送信する商品化済み数量
                        ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY           '送信する未商品数量
                                                                    
                                                                    
                                                                    '商品化用倉庫区分をセーブ
                        ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
                        '数量付きの送信メッセージを作成する
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                                    
                        '-----------------------------------------------１行目
                                                                        'BOX属性
    '                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    '                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
    '                                                                    '表示内容
    '                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    '                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    '                                                                    '数値初期表示
    '                    Send_Text.Box_Type(0).INIT = ""
    '                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
    '
    '                                                                    '初期カーソル位置
    '                    Send_Text.Box_Type(0).Start_Pos = ""
    '                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
    '                                                                    '入力桁数
    '                    Send_Text.Box_Type(0).Max_Size = "00"
    '                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
    '                    Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
    '                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        
                        
                        
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, _
                                        Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, _
                                        Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_BEF_Su & Space(M_Keta - (Len(LCD_BEF_Su) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "#"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_BEF_Su & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "#"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            
            
            
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        Sendbuf = Text_Create_Proc()
                
                        Hin_Furikae_S_Proc = False
                        Exit Function
                
                End Select
            
            
            Next i
        
        
        Case Step_Sagyo3_RES        '３回目の受信（振替前数量）
            
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 5)
            
            
                    Case LCD_BEF_Su          '数量（振替前）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "振替前数量", "数量入力ミス", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_S_Proc = False
                            Exit Function
                        End If
                
                        BEF_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If BEF_QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "振替前数量", "数量入力ミス", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_S_Proc = False
                            Exit Function
                        End If
            
            
                        If BEF_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "振替前数量", "数量入力ミス", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_S_Proc = False
                            Exit Function
                        End If
                
                        ID_KANRI_TBL(ING_No).BEF_QTY = BEF_QTY
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                                    
                        
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        
                        
                        
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, _
                                        Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, _
                                        Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_BEF_Su & Format(BEF_QTY, "#"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_BEF_Su & Format(BEF_QTY, "#"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            
            
            
                        '-----------------------------------------------５行目
                        AFT_QTY = BEF_QTY * ID_KANRI_TBL(ING_No).CUT_SU
                        ID_KANRI_TBL(ING_No).AFT_QTY = AFT_QTY
                                                                        
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_AFT_Su & Format(AFT_QTY, "#"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_AFT_Su & Format(AFT_QTY, "#"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
            
                        Hin_Furikae_S_Proc = False
                        Exit Function
            
            
                End Select
            
            
            Next i
            
            
        Case Step_Sagyo4_RES        '４回目の受信（ＥＮＴ）
            
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    YOIN_BEF_HINBAN_S, _
                                    0, _
                                    ID_KANRI_TBL(ING_No).BEF_QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, Trim(ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN) & "へ振替", _
                                    , , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "-" & "01-01-01", ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Hin_Furikae_S_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Hin_Furikae_S_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Furikae_S_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
    
            sts = Nyuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN, _
                                    Format(Now, "YYYYMMDD"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    YOIN_AFT_HINBAN_S, _
                                    0, _
                                    ID_KANRI_TBL(ING_No).AFT_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, Trim(ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN) & "より振替", , , , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "-" & "01-01-01", ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Hin_Furikae_S_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Hin_Furikae_S_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Furikae_S_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Hin_Furikae_S_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Private Function Ido_In_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ 部材ｾﾝﾀｰ移動入庫指定時のチェック＆更新処理』
'
'       2012.03.15
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8
Dim ST_TANABAN      As String * 8


Dim Hinban          As String * 20

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Ido_In_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Ido_In_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                                    'FROM 仮想棚番
                        FROM_Tanaban = ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_In_OSAKA_Proc = False
                                Exit Function
                        End Select
                    
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ido_In_OSAKA_Proc = False
                            Exit Function
                        End If
        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
                        ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                       'ブザー音　標準
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                        
                        ST_TANABAN = StrConv(ITEMREC.ST_SOKO, vbUnicode) & StrConv(ITEMREC.ST_RETU, vbUnicode) & StrConv(ITEMREC.ST_REN, vbUnicode) & StrConv(ITEMREC.ST_DAN, vbUnicode)
                        
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, _
                                        LCD_Tanaban & " " & Mid(ST_TANABAN, 1, 2) & "-" & Mid(ST_TANABAN, 3, 2) & "-" & Mid(ST_TANABAN, 5, 2) & "-" & Mid(ST_TANABAN, 7, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, _
                                        LCD_Tanaban & " " & Mid(ST_TANABAN, 1, 2) & "-" & Mid(ST_TANABAN, 3, 2) & "-" & Mid(ST_TANABAN, 5, 2) & "-" & Mid(ST_TANABAN, 7, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "12"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        Ido_In_OSAKA_Proc = False
                        Exit Function
            
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（棚番）
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    Case LCD_Tanaban        '棚番
                        TO_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(TO_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_In_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 混載チェック
                        If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                            If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_In_OSAKA_Proc = False
                                Exit Function
                            End If
                        End If
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(TO_Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(TO_Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(TO_Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(TO_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Ido_In_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
        
        
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Ido_In_OSAKA_Proc = False
                            Exit Function
                        End If
        
        
        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                        ID_KANRI_TBL(ING_No).Tanaban = TO_Tanaban       '棚番をセーブ
                                                                    '商品化用倉庫区分をセーブ
                        ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
                        '数量付きの送信メッセージを作成する
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                                                                    
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                            'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, _
                                        Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, _
                                        Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "08"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "08"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Suryo & ":" & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY + ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Suryo & ":" & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY + ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                    
                    
                        Sendbuf = Text_Create_Proc()
                        Ido_In_OSAKA_Proc = False
                        Exit Function
        
        
                End Select
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（ENT待ち）
            
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    0, _
                                    ID_KANRI_TBL(ING_No).Send_MI_QTY + ID_KANRI_TBL(ING_No).Send_SUMI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Ido_In_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_In_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Ido_In_OSAKA_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Ido_In_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Private Function COMPO_OSAKA_CHECK_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材ｾﾝﾀｰ商品化構成ﾁｪｯｸ処理』
'       2012.03.16
'
'-------------------------------------------------------
Dim sts             As Integer



Dim SHIJI_No        As String * 8

Dim Hinban          As String * 20

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim MENU_NO         As String * 2

Dim KO_CNT          As Integer
Dim RD_CNT          As Integer


Dim Found_F         As Boolean
Dim wkJgoybu        As String * 1

    COMPO_OSAKA_CHECK_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票№）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO      '指図票№
    
    
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        
                        
                        sts = COMPO_OSAKA_Check_Read_Proc(SHIJI_No, KO_CNT)
                        
                        
                        Select Case sts
                            Case False          '正常
                                
                            
                            
                            Case BtErrKeyNotFound
                                    
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "該当データなし", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                COMPO_OSAKA_CHECK_PROC = False
                                Exit Function
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        
                        End Select
                
                        
                        '子部品なし
                        If KO_CNT < 0 Then
                        
                        
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "子部品なし", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            COMPO_OSAKA_CHECK_PROC = False
                            Exit Function
                        
                        
                        
                        
                        End If
                        
                        
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            COMPO_OSAKA_CHECK_PROC = False
                            Exit Function
                        End If
                                                
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            COMPO_OSAKA_CHECK_PROC = False
                            Exit Function
                        End If
                        
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 子部品チェック 20012.04.13
                        If StrConv(P_SSHIJI_O_REC.COMPO_END_F, vbUnicode) = "9" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "子部品ﾁｪｯｸ", "完了済", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            COMPO_OSAKA_CHECK_PROC = False
                            Exit Function
                        End If
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 子部品チェック 20012.04.13
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        ID_KANRI_TBL(ING_No).Hinban = StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)
                        ID_KANRI_TBL(ING_No).Input_Line = 0
                                                
                        
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                        Call COMPO_Check_Cnt_Proc(KO_CNT, RD_CNT)
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SHIJI_No & "     " & Format(RD_CNT, "##0") & "/" & Format(KO_CNT, "#"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SHIJI_No & "     " & Format(RD_CNT, "##0") & "/" & Format(KO_CNT, "#"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Hinban)
                                                                                
                                                                                
                                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（ラベル品番）
            For i = 0 To M_Gyo - 1
            
                Select Case i
                
                                    
                    Case 0
                                    
                                    
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    
                        If Trim(Hinban) = Ent_Para Then
                        
                            '2011.06.14
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL)
                                If ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).RD_FLAG <> 1 Then
                                    Exit For
                                End If
                            Next k
                            
                            If k > UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL) Then
                            Else
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No, "ﾁｪｯｸ未完了", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                COMPO_OSAKA_CHECK_PROC = False
                                Exit Function
                            
                            End If
                            
                            
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                        
                        
                        
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.fileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                    
                            Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                    
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                            'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "チェック完了")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "チェック完了")
                
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------４行目
                                                                                            'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                
                            Sendbuf = Text_Create_Proc()
                        
                            COMPO_OSAKA_CHECK_PROC = False
        
                            Exit Function
                            
                            
                            
                            '2011.06.14
                            Exit For
                        End If
                    Case 2, 3, 4        '品番
                        
                        
                        
                        For j = 2 To 4
                        
                            If j - 2 = ID_KANRI_TBL(ING_No).Input_Line Then
                        
                                                    
                        
                                Hinban = ID_KANRI_TBL(ING_No).Recv_text(j)
                    
                    
                                For k = 0 To UBound(JGYOBU_T)
                                
                                
                                    If JGYOBU_T(k).CODE = SHIZAI Then
                                        sts = Item_Read_Proc(JGYOBU_T(k).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                                    Else
                                        sts = Item_Read_Proc(JGYOBU_T(k).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                                            Select Case sts
                                            Case BtNoErr
                                                Exit For
                                            Case BtErrKeyNotFound
                                        
                                            Case Else
                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                                Sendbuf = Text_Create_Proc()
                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                                Exit Function
                                
                                        End Select
                                    End If
                                Next k
                    
                    
                                Found_F = False
                                For k = 0 To UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).KO_HIN_GAI) = Trim(Hinban) Then
                                    
                                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.04.13
                                        If ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).RD_FLAG = 1 Then
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No, Hinban, "チェック済", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            COMPO_OSAKA_CHECK_PROC = False
                                            Exit Function
                                        End If
                                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.04.13
                                    
                                        Found_F = True
                                        If ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).RD_FLAG = 0 Then
                                            ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).RD_FLAG = 1
                                            Exit For
                                        End If
                                    
                                    End If
                                
                                
                                Next k
                    
                    
                                If Not Found_F Then
                                
                                
                                
                                    For k = 0 To UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL)
                                
                                        '品番読み替えでチェック
                                        
                                        If ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).KO_JGYOBU = SHIZAI Then
                                            Call UniCode_Conv(K1_FURIKAE.JGYOBU_GO, BUZAI)
                                            Call UniCode_Conv(K1_FURIKAE.NAIGAI_GO, NAIGAI_NAI)
                                            Call UniCode_Conv(K1_FURIKAE.HIN_GO, Hinban)
                                        
                                            Call UniCode_Conv(K1_FURIKAE.JGYOBU_MAE, BUZAI)
                                            Call UniCode_Conv(K1_FURIKAE.NAIGAI_MAE, NAIGAI_NAI)
                                            Call UniCode_Conv(K1_FURIKAE.HIN_MAE, ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).KO_HIN_GAI)
                                        
                                    
                                            sts = BTRV(BtOpGetEqual, FURIKAE_POS, FURIKAEREC, Len(FURIKAEREC), K1_FURIKAE, Len(K1_FURIKAE), 1)
                                            Select Case sts
                                                Case BtNoErr
                                                    
                                                                                                        
                                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.04.13
                                                    If ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).RD_FLAG = 1 Then
                                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No, Hinban, "チェック済", "")
                                                        Sendbuf = Text_Create_Proc()
                                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                                        COMPO_OSAKA_CHECK_PROC = False
                                                        Exit Function
                                                    End If
                                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.04.13
                                                    
                                                    
                                                    ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(k).RD_FLAG = 1
                                                    Exit For
                                                    
                                                Case BtErrKeyNotFound
                                                
'                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No, Hinban, "品番ｴﾗｰ", "")
'
'                                                    Sendbuf = Text_Create_Proc()
'                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                                    COMPO_OSAKA_CHECK_PROC = False
'                                                    Exit Function
                                                
                                                Case Else
                                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                                    Sendbuf = Text_Create_Proc()
                                                    Call File_Error(sts, BtOpGetEqual, "品番振替マスタ", 0)
                                                    Exit Function
                                            End Select
                                    
                                    
                                    
                                        End If
                                    Next k
                                
                                    If k > UBound(ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL) Then
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & ID_KANRI_TBL(ING_No).SHIJI_No, Hinban, "品番ｴﾗｰ", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        COMPO_OSAKA_CHECK_PROC = False
                                        Exit Function
                                    End If
                                        
                                                            
                                End If
                        
                            
                           End If
                        
                        
                        
                        Next j
                        
                        ID_KANRI_TBL(ING_No).RD_HINBAN(ID_KANRI_TBL(ING_No).Input_Line) = Hinban
                        ID_KANRI_TBL(ING_No).Input_Line = ID_KANRI_TBL(ING_No).Input_Line + 1
                        
                        If ID_KANRI_TBL(ING_No).Input_Line > 2 Then
                            ID_KANRI_TBL(ING_No).Input_Line = 0
                        
                            ID_KANRI_TBL(ING_No).RD_HINBAN(0) = ""
                            ID_KANRI_TBL(ING_No).RD_HINBAN(1) = ""
                            ID_KANRI_TBL(ING_No).RD_HINBAN(2) = ""
                        
                        End If
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            
                            
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                        Call COMPO_Check_Cnt_Proc(KO_CNT, RD_CNT)
                                                                                
                                                                                
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SHIJI_No & "     " & Format(RD_CNT, "##0") & "/" & Format(KO_CNT, "#"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).SHIJI_No & "     " & Format(RD_CNT, "##0") & "/" & Format(KO_CNT, "#"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                        For j = 0 To 2
                        
                            If j = ID_KANRI_TBL(ING_No).Input_Line Then
                                                                                    'BOX属性
                                Send_Text.Box_Type(j + 2).Box_Type = TYPE_BCANK
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(j + 2).LCD, LCD_Hinban)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).LCD, LCD_Hinban)
                        
                        
                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(j + 2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(j + 2).Start_Pos = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Start_Pos = "01"
                                                                                        '入力桁数
                                                                                        
                                Send_Text.Box_Type(j + 2).Max_Size = "20"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Max_Size = "20"
                                                                                        
                                                                                        
                                Send_Text.Box_Type(j + 2).MENU = ""                     'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).MENU = ""
                        
                        
                        
                        
                            Else
                                                                                    'BOX属性
                                Send_Text.Box_Type(j + 2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Box_Type = TYPE_REF
                                Call UniCode_Conv(Send_Text.Box_Type(j + 2).LCD, ID_KANRI_TBL(ING_No).RD_HINBAN(j))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).LCD, ID_KANRI_TBL(ING_No).RD_HINBAN(j))
                        
                        
                            
                            
                                                                                        '数値初期表示
                                Send_Text.Box_Type(j + 2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(j + 2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Start_Pos = ""
                                                                                        '入力桁数
                                                                                        
                                Send_Text.Box_Type(j + 2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).Max_Size = "00"
                                                                                        
                                                                                        
                                Send_Text.Box_Type(j + 2).MENU = ""                       'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j + 2).MENU = ""
                            
                            
                            End If
                        
                        Next j
                                                                                                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   全品目チェック済みは　ブザー音を替える  2012.04.13
                        If (KO_CNT = RD_CNT) Then
                            Send_Text.Buzzer = Buzzer_DOUBLE
                            ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DOUBLE
                        End If
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   全品目チェック済みは　ブザー音を替える  2012.04.13
                                                                                    
                                                                                    
                                                                                    
    
                        Sendbuf = Text_Create_Proc()
                                    
                        Exit For
                           
                End Select
            
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（ＥＮＴ）
        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).Hinban, , , , , , , , , _
                                                     ID_KANRI_TBL(ING_No).SHIJI_No) Then
                    COMPO_OSAKA_CHECK_PROC = SYS_ERR
                    Exit Function
                End If
            End If
            
            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 指図表(親)更新  2012.04.13
            Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
            sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case BtErrKeyNotFound
                    Call Err_Send_Proc("未登録異常", "指図表(親)", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    COMPO_OSAKA_CHECK_PROC = False
                    Exit Function
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "指図表(親)", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "指図表(親)", 0)
                    Exit Function
            End Select
                        
            Call UniCode_Conv(P_SSHIJI_O_REC.COMPO_END_F, "9")
            sts = BTRV(BtOpUpdate, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                    Call Err_Send_Proc("システム異常発生", "指図表(親)", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpUpdate, "指図表(親)", 0)
                    Exit Function
            End Select
                   
            
            
            
            
            
            
            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 指図表(親)更新  2012.04.13
            
            
            
            
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select

            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
        
        
    End Select
        

    COMPO_OSAKA_CHECK_PROC = False
    


End Function


Private Function COMPO_OSAKA_Check_Read_Proc(SHIJI_No As String, KO_CNT As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材ｾﾝﾀｰ指図票データの構成部品数』
'
'       2012.03.16
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer


Dim i           As Integer

            
            
Dim Check_f     As Boolean
Dim j           As Integer
            
            
            
    COMPO_OSAKA_Check_Read_Proc = True



    
        
    
    
    
    Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
    
    
    sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            COMPO_OSAKA_Check_Read_Proc = BtErrKeyNotFound
            Exit Function
        Case Else
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "指図票データ(親)", 0)
            COMPO_OSAKA_Check_Read_Proc = SYS_ERR
            Exit Function
    End Select
    
    
    Erase ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL
    KO_CNT = -1
    
    
    Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, SHIJI_No)
    Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
    Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")
    
    com = BtOpGetGreater
            
            
    Do
    
    
        DoEvents
    
        sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
        Select Case sts
            Case BtNoErr
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                COMPO_OSAKA_Check_Read_Proc = SYS_ERR
                Exit Function
        End Select
    
    
    
        If StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) <> SHIJI_No Then
            Exit Do
        End If
    
    
        If StrConv(P_SSHIJI_K_REC.DATA_KBN, vbUnicode) = "3" Then
    
    
            Check_f = False
            If Kousei_check_F Then
                If Kousei_check_Tb(0) = "*" Then
                    Check_f = True
                Else
                
                
                    For j = 0 To UBound(Kousei_check_Tb)
                        If Kousei_check_Tb(j) = Trim(StrConv(P_SSHIJI_K_REC.KO_SYUBETSU, vbUnicode)) Then
                            Check_f = True
                            Exit For
                        End If
                    
                    Next j
                
                
                End If
            End If
            If Check_f Then
                KO_CNT = KO_CNT + 1
                
                ReDim Preserve ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(0 To KO_CNT)
                            
                ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).KO_JGYOBU = StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode)
                ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).KO_NAIGAI = StrConv(P_SSHIJI_K_REC.KO_NAIGAI, vbUnicode)
                ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).KO_HIN_GAI = StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)
            
                ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).RD_FLAG = False
            
                ID_KANRI_TBL(ING_No).CHK_HINBAN_TBL(KO_CNT).KO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_QTY, vbUnicode))
            
            End If
        
        
        End If
    Loop
    
    COMPO_OSAKA_Check_Read_Proc = False

End Function


Private Function KENPIN_OSAKA_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材ｾﾝﾀｰ検品処理』
'       2012.03.18
'
'-------------------------------------------------------
Dim sts             As Integer



Dim SHIJI_No        As String * 8


Dim MENU_NO         As String * 2

Dim ans             As String * 1

Dim i               As Integer



    KENPIN_OSAKA_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票№）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO      '指図票№
    
    
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        
                        Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
                        
                        
                        sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "該当データなし", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KENPIN_OSAKA_PROC = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                        
                        
                
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KENPIN_OSAKA_PROC = False
                            Exit Function
                        End If
                                                
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票№:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KENPIN_OSAKA_PROC = False
                            Exit Function
                        End If
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = StrConv(P_SSHIJI_O_REC.JGYOBU, vbUnicode)
                        ID_KANRI_TBL(ING_No).S_NAIGAI = StrConv(P_SSHIJI_O_REC.NAIGAI, vbUnicode)
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.fileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.fileName = ""
                
                        Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票№：" & SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票№：" & SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SHIJI_END)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SHIJI_END)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                                                                                
                        Send_Text.Box_Type(4).INIT = ""                         '数値初期表示
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                
                        Send_Text.Box_Type(4).Start_Pos = "20"                  '初期カーソル位置
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "20"
                                                                                
                         Send_Text.Box_Type(4).Max_Size = "01"                  '入力桁数
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        KENPIN_OSAKA_PROC = False
                        Exit Function
                            
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（YES or No）
            For i = 0 To M_Gyo - 1
            
                Select Case RTrim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    Case LCD_CAN_ANS        'YES or No
                        ans = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        Select Case ans
                            Case "1"
                                
                                
                                '----------------------------------- データ更新処理開始 -----------
                                                                    
                                                                    'トランザクション開始
                                sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    Exit Function
                                End If
                                                                    
                                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                    MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                            
                                Else
                                            
                                    MENU_NO = ""
                                End If
                                
                                
                                
                                If KENPIN_OSAKA_Update_PROC(Sendbuf) Then
                                    
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                                End If
                                
                                
                                
                                                                    'トランザクション終了
                                sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpEndTransaction, "", 0)
                                    GoTo Abort_Tran
                                End If
                                
                                
                                
                                
                            Case "9"
                            Case Else
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ans, "(1 OR 9)", "を入力して下さい", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KENPIN_OSAKA_PROC = False
                                Exit Function
                        End Select
                         
                         
                         
                         
                End Select
            
            Next i
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select

            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
        
        
    End Select
        

    KENPIN_OSAKA_PROC = False
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Private Function KENPIN_OSAKA_Update_PROC(Sendbuf As String) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材ｾﾝﾀｰ検品更新処理』
'       2012.03.18
'
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim MENU_NO         As String * 2

Dim wkJgyobu        As String * 1

Dim SUMI_QTY        As Long         '2012.04.14
Dim MI_QTY          As Long         '2012.04.14


Dim SEQNO           As Integer      '2012.09.14


    KENPIN_OSAKA_Update_PROC = True


'-----------------------------------------------------------------------    指図票データ更新
    '指図票データ(ﾍｯﾀﾞｰ)処理
    Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
            
    Select Case sts
        Case BtNoErr
        
            
        Case Else
            Call File_Error(sts, BtOpGetEqual, "商品化指図票ﾃﾞｰﾀ(親)", 0)
            Exit Function
    End Select


    Call UniCode_Conv(K0_P_UKEHARAI.UKEHARAI_CODE, StrConv(P_SSHIJI_O_REC.UKEHARAI_CODE, vbUnicode))
    sts = BTRV(BtOpGetEqual, P_UKEHARAI_POS, P_UKEHARAIREC, Len(P_UKEHARAIREC), K0_P_UKEHARAI, Len(K0_P_UKEHARAI), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call UniCode_Conv(P_UKEHARAIREC.TORI_KBN, "0")
        Case Else
            Call File_Error(sts, BtOpGetEqual, "受払先マスタ", 0)
            Exit Function
    End Select
    Call UniCode_Conv(P_SSHIJI_O_REC.TORI_KBN, StrConv(P_UKEHARAIREC.TORI_KBN, vbUnicode))

    Call UniCode_Conv(P_SSHIJI_O_REC.KAN_F, P_KAN_ON)                   '完了ﾌﾗｸﾞ
    Call UniCode_Conv(P_SSHIJI_O_REC.KAN_DT, Format(Now, "YYYYMMDD"))   '完了日

    Call UniCode_Conv(P_SSHIJI_O_REC.BUNNOU_CNT, "00")                  '分納回数
                                                                            
    Call UniCode_Conv(P_SSHIJI_O_REC.S_TANTO, "")                       '収単／担当者ｸﾗｽ
                                                                        '受入数量
    Call UniCode_Conv(P_SSHIJI_O_REC.UKEIRE_QTY, StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))
                                                                        '更新日時
    Call UniCode_Conv(P_SSHIJI_O_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))

    sts = BTRV(BtOpUpdate, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
    Select Case sts
        Case BtNoErr
        Case Else
            Call File_Error(sts, BtOpUpdate, "商品化指図ﾃﾞｰﾀ(親)", 0)
            Exit Function
    End Select
'-----------------------------------------------------------------------    受入履歴ﾃﾞｰﾀ処理
        
        
        
        
    '受入履歴ﾃﾞｰﾀ処理               2012.09.14  ▽
    Call UniCode_Conv(K0_P_SUKEIRE.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    Call UniCode_Conv(K0_P_SUKEIRE.SEQNO, "")
    
    SEQNO = 0
    
    com = BtOpGetGreater
    
    Do
    
        sts = BTRV(com, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
            
        Select Case sts
            Case BtNoErr
            
                If StrConv(P_SUKEIRE_REC.SHIJI_No, vbUnicode) <> ID_KANRI_TBL(ING_No).SHIJI_No Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            
            Case Else
                Call File_Error(sts, BtOpUpdate, "商品化受入履歴", 0)
                Exit Function
        
        End Select
        
        
        
        SEQNO = SEQNO + 1
        
        
        com = BtOpGetNext
        
    Loop
    '                               2012.09.14　△
        
        
        
        
        
    Call UniCode_Conv(P_SUKEIRE_REC.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)    '指図票№
                                                                                '仕向け先ｺｰﾄﾞ
    Call UniCode_Conv(P_SUKEIRE_REC.SHIMUKE_CODE, StrConv(P_SSHIJI_O_REC.SHIMUKE_CODE, vbUnicode))
                                                                                '受入日
    Call UniCode_Conv(P_SUKEIRE_REC.UKEIRE_DT, Format(Now, "YYYYMMDD"))
                                                                                '受入数量
    Call UniCode_Conv(P_SUKEIRE_REC.UKEIRE_QTY, StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))
    
                                            
    Call UniCode_Conv(P_SUKEIRE_REC.LAST_F, P_UKEIRE_END)
                                                                                '取引先
    Call UniCode_Conv(P_SUKEIRE_REC.TORI_CODE, StrConv(P_SSHIJI_O_REC.UKEHARAI_CODE, vbUnicode))
    '前1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(4).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(4).TIMES, "000.00")
        
    '前2
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(5).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(5).TIMES, "000.00")
        
    '前3
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(6).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(6).TIMES, "000.00")
    
    '作業1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(0).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(0).TIMES, "000.00")
        
    '作業2
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(1).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(1).TIMES, "000.00")
        
    '作業3
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(2).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(2).TIMES, "000.00")
        
    '後1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(7).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(7).TIMES, "000.00")
        
    '後2
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(8).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(8).TIMES, "000.00")
        
    '加工1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(9).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(9).TIMES, "000.00")
        
        
    Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_NAME, "")
    Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_TIMES, "000.00")
    
    Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_NAME, "")
    Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_TIMES, "000.00")
                                                
    Call UniCode_Conv(P_SUKEIRE_REC.BIKOU, "")                                  '備考
        
    Call UniCode_Conv(P_SUKEIRE_REC.FILLER, "")
                                                                                '更新日時
    Call UniCode_Conv(P_SUKEIRE_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))
                                                                                '追番
    Call UniCode_Conv(P_SUKEIRE_REC.SEQNO, "001")
            
    
    
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.09.14
'    sts = BTRV(BtOpInsert, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
'    Select Case sts
'        Case BtNoErr
'        Case BtErrDuplicates
'            sts = BTRV(BtOpUpdate, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
'            Select Case sts
'                Case BtNoErr
'                Case Else
'                    Call File_Error(sts, BtOpUpdate, "商品化受入履歴", 0)
'                    Exit Function
'            End Select
'        Case Else
'            Call File_Error(sts, BtOpInsert, "商品化受入履歴", 0)
'            Exit Function
'    End Select
 

    Do
            
        SEQNO = SEQNO + 1
                                                '追番
        Call UniCode_Conv(P_SUKEIRE_REC.SEQNO, Format(SEQNO, "000"))
            
        DoEvents
            
        sts = BTRV(BtOpInsert, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrDuplicates
            
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                            
            Case Else
                Call File_Error(sts, BtOpInsert, "受入履歴", 0)
                Exit Function
        End Select
        
    Loop
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.09.14




'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26  更新順　変更
'-----------------------------------------------------------------------    発注検討：親部品注文データ更新
    If Trim(StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode)) <> "" Then
        Call UniCode_Conv(K6_ODR_ORDER.ORDER_NO, StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode))
        sts = BTRV(BtOpGetEqual, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
        Select Case sts
            Case BtNoErr
            Case BtErrKeyNotFound
                KENPIN_OSAKA_Update_PROC = False
                Exit Function
            Case Else
                Call File_Error(sts, BtOpGetEqual, "親品番　注文Ｆ", 0)
                KENPIN_OSAKA_Update_PROC = SYS_ERR
                Exit Function
        End Select
    
    
        
        Call UniCode_Conv(ODR_ORDER_REC.UPD_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
        Call UniCode_Conv(ODR_ORDER_REC.FIN_DT, Format(Now, "YYYYMMDD"))
    
        Call UniCode_Conv(ODR_ORDER_REC.UPD_DT, Format(Now, "YYYYMMDD"))
        Call UniCode_Conv(ODR_ORDER_REC.UPD_TM, Format(Now, "HHMMSS"))
        Call UniCode_Conv(ODR_ORDER_REC.UPD_PG, App.EXEName)
        
        sts = BTRV(BtOpUpdate, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
        Select Case sts
            Case BtNoErr
            Case BtErrKeyNotFound
            Case Else
                Call File_Error(sts, BtOpUpdate, "親品番　注文Ｆ", 0)
                KENPIN_OSAKA_Update_PROC = SYS_ERR
                Exit Function
        End Select
    End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26





'-----------------------------------------------------------------------    子部品出庫処理

    Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
    Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")


    com = BtOpGetGreater

    Do
        DoEvents
        sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
        Select Case sts
            Case BtNoErr
                If StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) <> ID_KANRI_TBL(ING_No).SHIJI_No Then
                    Exit Do
                End If
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "指図票データ(子)", 0)
                KENPIN_OSAKA_Update_PROC = SYS_ERR
                Exit Function
        End Select
    
    
        If Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode)) = 9 Then
    
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
    
    
    
                                            '出庫更新
            If StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode) = SHIZAI Then
                wkJgyobu = BUZAI
                MI_QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
                SUMI_QTY = 0
            Else
                wkJgyobu = StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode)
                SUMI_QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
                MI_QTY = 0
            End If
            
            
            
            
            
            sts = Syuko_Update_Proc(wkJgyobu, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode), _
                                    "", _
                                    KENPIN_OSAKA_SOKO_No & "01" & "01" & "01", _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, ID_KANRI_TBL(ING_No).SHIJI_No, , , , , , MENU_NO)
            Select Case sts
                Case False
                
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, KENPIN_OSAKA_SOKO_No & "-01-01-01", RTrim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)), "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                
                    Exit Function
                Case SYS_ERR
                    Sendbuf = Text_Create_Proc()
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    KENPIN_OSAKA_Update_PROC = SYS_ERR    'システム異常発生
                    
                    Exit Function
            End Select
        End If
    
        com = BtOpGetNext
    
    Loop


'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26  更新順　変更
'-----------------------------------------------------------------------    発注検討：親部品注文データ更新
'
'    Call UniCode_Conv(K6_ODR_ORDER.ORDER_NO, StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode))
'    sts = BTRV(BtOpGetEqual, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
'    Select Case sts
'        Case BtNoErr
'        Case BtErrKeyNotFound
'            KENPIN_OSAKA_Update_PROC = False
'            Exit Function
'        Case Else
'            Call File_Error(sts, BtOpGetEqual, "親品番　注文Ｆ", 0)
'            KENPIN_OSAKA_Update_PROC = SYS_ERR
'            Exit Function
'    End Select
'
'
'
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
'    Call UniCode_Conv(ODR_ORDER_REC.FIN_DT, Format(Now, "YYYYMMDD"))
'
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_DT, Format(Now, "YYYYMMDD"))
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_TM, Format(Now, "HHMMSS"))
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_PG, App.EXEName)
'
'    sts = BTRV(BtOpUpdate, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
'    Select Case sts
'        Case BtNoErr
'        Case BtErrKeyNotFound
'        Case Else
'            Call File_Error(sts, BtOpUpdate, "親品番　注文Ｆ", 0)
'            KENPIN_OSAKA_Update_PROC = SYS_ERR
'            Exit Function
'    End Select
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26  更新順　変更
    

    
    
    
    KENPIN_OSAKA_Update_PROC = False
    


End Function




Private Sub Text2_Change(Index As Integer)
    
    Label3.Caption = ""             '2012.11.06

End Sub

Private Sub Text2_GotFocus(Index As Integer)
    Text2(Index) = Trim(Text2(Index).Text)
    Text2(Index).SelStart = 0
    Text2(Index).SelLength = Len(Text2(Index).Text)
End Sub

Private Sub Text2_LostFocus(Index As Integer)
    
    Text2(0).Text = Format(Val(Text2(0).Text), "00")
    Text2(1).Text = Format(Val(Text2(1).Text), "00")

End Sub

Private Sub Timer1_Timer()
'-------------------------------------------------------
'
'   『終了監視タイマー』
'       2012.05.18
'
'-------------------------------------------------------
    Timer1.Enabled = False
    
    
    If Text2(0).Text & Text2(1).Text = Format(Time, "HHMM") Then
        Command1(2).Value = True
    End If
    Timer1.Enabled = True
End Sub


Private Sub Wel_OKURI_SAKI_PROC()
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                            
    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""

End Sub

Private Function Fueikae_Read_Proc(Hinban As String, Hinban_GO As String) As Integer
'-------------------------------------------------------
'
'   『品番振替ﾏｽﾀ読込み』
'       2012.12.27
'
'-------------------------------------------------------
Dim wkVal1  As Integer
Dim wkVal2  As Integer
    
Dim sts     As Integer
    
    
    Fueikae_Read_Proc = True

        



    Hinban_GO = ""



    wkVal1 = ToRoundDown(CCur(1 / Val(StrConv(P_SSHIJI_K_REC.KO_QTY, vbUnicode))), 0)



    Call UniCode_Conv(K0_FURIKAE.JGYOBU_MAE, BUZAI)
    Call UniCode_Conv(K0_FURIKAE.NAIGAI_MAE, NAIGAI_NAI)
    Call UniCode_Conv(K0_FURIKAE.HIN_MAE, Hinban)

    Call UniCode_Conv(K0_FURIKAE.JGYOBU_GO, BUZAI)
    Call UniCode_Conv(K0_FURIKAE.NAIGAI_GO, NAIGAI_NAI)
    Call UniCode_Conv(K0_FURIKAE.HIN_GO, Trim(Hinban) & "-" & Format(wkVal1, "0"))
    
    sts = BTRV(BtOpGetEqual, FURIKAE_POS, FURIKAEREC, Len(FURIKAEREC), K0_FURIKAE, Len(K0_FURIKAE), 0)
    Select Case sts
        Case BtNoErr
            Hinban_GO = StrConv(FURIKAEREC.HIN_GO, vbUnicode)
        Case BtErrKeyNotFound
        Case Else
            Call File_Error(sts, BtOpGetEqual, "品番振替", 0)
            Fueikae_Read_Proc = SYS_ERR
            Exit Function
    End Select
    

    Fueikae_Read_Proc = False
End Function

