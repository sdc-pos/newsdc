Attribute VB_Name = "mdlProc"
Option Explicit



Public Function Tanahyoji_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『棚番表示処理』
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07

Dim Tanaban     As String * 8
Dim ST_TANABAN  As String * 8


Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim Tanahyoji() As Tanahyoji_tag
Dim Tana_Cnt    As Integer


Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1

Dim MENU_NO     As String * 2   '2008.08.08


Dim DSP_Tanaban As String * 12   '2017.09.23


    Tanahyoji_Proc = True

    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & B1_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & B1_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    '品目マスタ読み込み（標準棚番ＧＥＴ）
'                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                        ST_TANABAN = (StrConv(ITEMREC.ST_SOKO, vbUnicode) & StrConv(ITEMREC.ST_RETU, vbUnicode) & StrConv(ITEMREC.ST_REN, vbUnicode) & StrConv(ITEMREC.ST_DAN, vbUnicode))
                    Case BtErrKeyNotFound
'                        '   -------------------------------- エラーメッセージ作成
'                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
'
'                        Sendbuf = Text_Create_Proc()
'                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                        Tanahyoji_Proc = False
'                        Exit Function
                        '未登録は出荷予定読み込み   2006.06.01
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                        Select Case sts
                            Case BtNoErr
                                Hinban = StrConv(Y_SYUREC.HIN_NO, vbUnicode)
                                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                                Select Case sts
                                    Case BtNoErr
                                        ST_TANABAN = (StrConv(ITEMREC.ST_SOKO, vbUnicode) & StrConv(ITEMREC.ST_RETU, vbUnicode) & StrConv(ITEMREC.ST_REN, vbUnicode) & StrConv(ITEMREC.ST_DAN, vbUnicode))
                            
                                    
                                    Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                                    
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Tanahyoji_Proc = False
                                        Exit Function
                                    
                                    Case Else
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, com, "在庫データ", 0)
                                        Exit Function
                            
                                End Select
                            
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Tanahyoji_Proc = False
                                Exit Function
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, com, "在庫データ", 0)
                                Exit Function
                        End Select
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                Erase Tanahyoji
                Tana_Cnt = -1
        
                If Len(Trim(ST_TANABAN)) = 0 Then
                                            '標準棚番設定なし
                
                    Tana_Cnt = Tana_Cnt + 1
                    ReDim Tanahyoji(Tana_Cnt)
                    Tanahyoji(Tana_Cnt).Tanaban = ST_TANABAN
                
                    Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                    Tanahyoji(Tana_Cnt).MI_QTY = 0
                Else
                    If Zaiko_Syukei_Proc(SUMI_QTY, _
                                            MI_QTY, _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            Hinban, _
                                            ST_TANABAN) Then

            
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    End If
                    Tana_Cnt = Tana_Cnt + 1
                    ReDim Tanahyoji(Tana_Cnt)
                    Tanahyoji(Tana_Cnt).Tanaban = ST_TANABAN
                    Tanahyoji(Tana_Cnt).SUMI_QTY = SUMI_QTY
                    Tanahyoji(Tana_Cnt).MI_QTY = MI_QTY
                    
                    
                    
                End If
                
                Call UniCode_Conv(K6_ZAIKO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K6_ZAIKO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K6_ZAIKO.HIN_GAI, Hinban)
                Call UniCode_Conv(K6_ZAIKO.NYUKA_DT, "")
                Call UniCode_Conv(K6_ZAIKO.SOKO_NO, "")
                Call UniCode_Conv(K6_ZAIKO.Retu, "")
                Call UniCode_Conv(K6_ZAIKO.Ren, "")
                Call UniCode_Conv(K6_ZAIKO.Dan, "")
                    
                com = BtOpGetGreater
        
                SUMI_QTY = 0
                MI_QTY = 0
    
    
                Do
                    sts = BTRV(com, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K6_ZAIKO, Len(K6_ZAIKO), 6)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫データ", 0)
                            Exit Function
                    End Select
                
                    If StrConv(ZAIKOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                        StrConv(ZAIKOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                        Trim(StrConv(ZAIKOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                        '事業部／国内外／品番ブレーク
                        Exit Do
                    End If
                    
                    If (StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)) _
                        = ST_TANABAN Then
                        '標準棚番は対象外
                    Else
                        If Tana_Cnt = (-1) Then
                            Tana_Cnt = Tana_Cnt + 1
                            ReDim Tanahyoji(Tana_Cnt)
                            Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                            If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                Tanahyoji(Tana_Cnt).MI_QTY = 0
                            Else
                                Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                            End If
                        
                        Else
                            For j = 0 To UBound(Tanahyoji)
                                If Tanahyoji(j).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode) Then
                                    Exit For
                                End If
                            Next j
                        
                            If j <= UBound(Tanahyoji) Then
                            
                                If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                    Tanahyoji(j).SUMI_QTY = Tanahyoji(j).SUMI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                Else
                                    Tanahyoji(j).MI_QTY = Tanahyoji(j).MI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                End If
                            
                            
                            Else
                            
                                Tana_Cnt = Tana_Cnt + 1
                            
                                ReDim Preserve Tanahyoji(Tana_Cnt)
                                Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                                If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    Tanahyoji(Tana_Cnt).MI_QTY = 0
                                Else
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                    Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                End If
                            
                            End If
                        
                        End If
                    
                    End If
                    
                    com = BtOpGetNext
                    
                Loop
        
        
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
        
                SendFileRec.Title = "0"     'タイトル行
                'Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME & Format(Tana_Cnt + 1, "#0") & "件")                '2017.09.22
                'Call UniCode_Conv(SendFileRec.LCD, Left(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, 15) & Format(Tana_Cnt + 1, "#0") & "件")   '2017.09.22   --> 2017.09.23 品番表示
                Call UniCode_Conv(SendFileRec.LCD, Left(Hinban, 15) & Format(Tana_Cnt + 1, " #0") & "件")   ' 2017.09.23 品番表示
                
                
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
        
        
                If Tana_Cnt > -1 Then
                                '集計テーブルよりデータ出力
                    For j = 0 To UBound(Tanahyoji)
                                
                        SendFileRec.Title = "1"
'                        Call UniCode_Conv(SendFileRec.LCD, Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
'                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
'                        SendFileRec.CRLF = vbCrLf
                        
                        
                        '棚番編集追加   >>>> 2017.09.23
                        If Len(Trim(Tanahyoji(j).Tanaban)) < 8 Then
                            DSP_Tanaban = Tanahyoji(j).Tanaban
                        Else
                            DSP_Tanaban = Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2)
                        End If
                        
'                        If j = 0 Then
'                            Call UniCode_Conv(SendFileRec.LCD, "*" & Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
'                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
'                        Else
'                            Call UniCode_Conv(SendFileRec.LCD, " " & Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
'                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
'                        End If
                        
                        If j = 0 Then
                            Call UniCode_Conv(SendFileRec.LCD, "*" & DSP_Tanaban & ":" _
                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
                        Else
                            Call UniCode_Conv(SendFileRec.LCD, " " & DSP_Tanaban & ":" _
                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
                        End If
                        '棚番編集追加   >>>> 2017.09.23
                        
                        SendFileRec.CRLF = vbCrLf
                                            
                        Put #FileNo, , SendFileRec
                                            
                                            
                        Call UniCode_Conv(SendFileRec.LCD, "  商：" & Format(Tanahyoji(j).SUMI_QTY, "#0") & "  未：" & Format(Tanahyoji(j).MI_QTY, "#0"))
                        SendFileRec.CRLF = vbCrLf
                                            
                                            
                        
                        Put #FileNo, , SendFileRec
                            
                    Next j
                End If
        
        
                Close #FileNo
        
        
        End Select
    Next i
    
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Tanahyoji_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = B1_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.FileName = B1_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１〜５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    Tanahyoji_Proc = False
    

End Function
Public Function Tanahyoji_Kaso_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『棚番表示(仮想優先)処理』
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07


Dim Tanaban     As String * 8
Dim ST_TANABAN  As String * 8


Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim Tanahyoji() As Tanahyoji_tag
Dim Tana_Cnt    As Integer


Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1


Dim MENU_NO     As String * 2   '2008.08.08


    Tanahyoji_Kaso_Proc = True

    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & B9_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & B9_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                    '品目マスタ読み込み（標準棚番ＧＥＴ）
'                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                        ST_TANABAN = (StrConv(ITEMREC.ST_SOKO, vbUnicode) & StrConv(ITEMREC.ST_RETU, vbUnicode) & StrConv(ITEMREC.ST_REN, vbUnicode) & StrConv(ITEMREC.ST_DAN, vbUnicode))
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Tanahyoji_Kaso_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                Erase Tanahyoji
                Tana_Cnt = -1
        
                If Len(Trim(ST_TANABAN)) = 0 Then
                                            '標準棚番設定なし
                
                    Tana_Cnt = Tana_Cnt + 1
                    ReDim Tanahyoji(Tana_Cnt)
                    Tanahyoji(Tana_Cnt).Tanaban = ST_TANABAN
                
                    Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                    Tanahyoji(Tana_Cnt).MI_QTY = 0
                Else
                    If Zaiko_Syukei_Proc(SUMI_QTY, _
                                            MI_QTY, _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            Hinban, _
                                            ST_TANABAN) Then

            
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    End If
                    Tana_Cnt = Tana_Cnt + 1
                    ReDim Tanahyoji(Tana_Cnt)
                    Tanahyoji(Tana_Cnt).Tanaban = ST_TANABAN
                    Tanahyoji(Tana_Cnt).SUMI_QTY = SUMI_QTY
                    Tanahyoji(Tana_Cnt).MI_QTY = MI_QTY
                    
                    
                    
                End If
                
                Call UniCode_Conv(K6_ZAIKO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K6_ZAIKO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K6_ZAIKO.HIN_GAI, Hinban)
                Call UniCode_Conv(K6_ZAIKO.NYUKA_DT, "")
                Call UniCode_Conv(K6_ZAIKO.SOKO_NO, "")
                Call UniCode_Conv(K6_ZAIKO.Retu, "")
                Call UniCode_Conv(K6_ZAIKO.Ren, "")
                Call UniCode_Conv(K6_ZAIKO.Dan, "")
                    
                com = BtOpGetGreater
        
                SUMI_QTY = 0
                MI_QTY = 0
    
    
                Do
                    sts = BTRV(com, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K6_ZAIKO, Len(K6_ZAIKO), 6)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫データ", 0)
                            Exit Function
                    End Select
                
                    If StrConv(ZAIKOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                        StrConv(ZAIKOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                        Trim(StrConv(ZAIKOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                        '事業部／国内外／品番ブレーク
                        Exit Do
                    End If
                    
                    If (StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)) _
                        = ST_TANABAN Then
                        '標準棚番は対象外
                    Else
                        
                        '仮想倉庫を優先する
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, StrConv(ZAIKOREC.SOKO_NO, vbUnicode))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(SOKOREC.SOKO_BUN, BUN_JITU)
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫ﾏｽﾀ", 0)
                                Exit Function
                        End Select
                        
                        
                        
                        If StrConv(SOKOREC.SOKO_BUN, vbUnicode) = BUN_KASO Then
                        
                            If Tana_Cnt = (-1) Then
                                Tana_Cnt = Tana_Cnt + 1
                                ReDim Tanahyoji(Tana_Cnt)
                                Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                                If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    Tanahyoji(Tana_Cnt).MI_QTY = 0
                                Else
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                    Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                End If
                            
                            Else
                                For j = 0 To UBound(Tanahyoji)
                                    If Tanahyoji(j).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode) Then
                                        Exit For
                                    End If
                                Next j
                            
                                If j <= UBound(Tanahyoji) Then
                                
                                    If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                        Tanahyoji(j).SUMI_QTY = Tanahyoji(j).SUMI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    Else
                                        Tanahyoji(j).MI_QTY = Tanahyoji(j).MI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    End If
                                
                                
                                Else
                                
                                    Tana_Cnt = Tana_Cnt + 1
                                
                                    ReDim Preserve Tanahyoji(Tana_Cnt)
                                    Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                                    If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                        Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                        Tanahyoji(Tana_Cnt).MI_QTY = 0
                                    Else
                                        Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                        Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    End If
                                
                                End If
                            
                            End If
                        
                        End If
                    End If
                    
                    com = BtOpGetNext
                    
                Loop
        
        
                Call UniCode_Conv(K6_ZAIKO.JGYOBU, RET_JGYOBU)
                Call UniCode_Conv(K6_ZAIKO.NAIGAI, RET_NAIGAI)
                Call UniCode_Conv(K6_ZAIKO.HIN_GAI, Hinban)
                Call UniCode_Conv(K6_ZAIKO.NYUKA_DT, "")
                Call UniCode_Conv(K6_ZAIKO.SOKO_NO, "")
                Call UniCode_Conv(K6_ZAIKO.Retu, "")
                Call UniCode_Conv(K6_ZAIKO.Ren, "")
                Call UniCode_Conv(K6_ZAIKO.Dan, "")
                    
                com = BtOpGetGreater
        
                SUMI_QTY = 0
                MI_QTY = 0
    
    
                Do
                    sts = BTRV(com, ZAIKO_POS, ZAIKOREC, Len(ZAIKOREC), K6_ZAIKO, Len(K6_ZAIKO), 6)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, com, "在庫データ", 0)
                            Exit Function
                    End Select
                
                    If StrConv(ZAIKOREC.JGYOBU, vbUnicode) <> RET_JGYOBU Or _
                        StrConv(ZAIKOREC.NAIGAI, vbUnicode) <> RET_NAIGAI Or _
                        Trim(StrConv(ZAIKOREC.HIN_GAI, vbUnicode)) <> Trim(Hinban) Then
                        '事業部／国内外／品番ブレーク
                        Exit Do
                    End If
                    
                    If (StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)) _
                        = ST_TANABAN Then
                        '標準棚番は対象外
                    Else
                        
                        '仮想倉庫を優先する
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, StrConv(ZAIKOREC.SOKO_NO, vbUnicode))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(SOKOREC.SOKO_BUN, BUN_KASO)
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫ﾏｽﾀ", 0)
                                Exit Function
                        End Select
                        
                        
                        
                        If StrConv(SOKOREC.SOKO_BUN, vbUnicode) = BUN_JITU Then
                        
                            If Tana_Cnt = (-1) Then
                                Tana_Cnt = Tana_Cnt + 1
                                ReDim Tanahyoji(Tana_Cnt)
                                Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                                If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    Tanahyoji(Tana_Cnt).MI_QTY = 0
                                Else
                                    Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                    Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                End If
                            
                            Else
                                For j = 0 To UBound(Tanahyoji)
                                    If Tanahyoji(j).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode) Then
                                        Exit For
                                    End If
                                Next j
                            
                                If j <= UBound(Tanahyoji) Then
                                
                                    If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                        Tanahyoji(j).SUMI_QTY = Tanahyoji(j).SUMI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    Else
                                        Tanahyoji(j).MI_QTY = Tanahyoji(j).MI_QTY + CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    End If
                                
                                
                                Else
                                
                                    Tana_Cnt = Tana_Cnt + 1
                                
                                    ReDim Preserve Tanahyoji(Tana_Cnt)
                                    Tanahyoji(Tana_Cnt).Tanaban = StrConv(ZAIKOREC.SOKO_NO, vbUnicode) & StrConv(ZAIKOREC.Retu, vbUnicode) & StrConv(ZAIKOREC.Ren, vbUnicode) & StrConv(ZAIKOREC.Dan, vbUnicode)
                                    If StrConv(ZAIKOREC.GOODS_ON, vbUnicode) = "0" Then
                                        Tanahyoji(Tana_Cnt).SUMI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                        Tanahyoji(Tana_Cnt).MI_QTY = 0
                                    Else
                                        Tanahyoji(Tana_Cnt).SUMI_QTY = 0
                                        Tanahyoji(Tana_Cnt).MI_QTY = CLng(StrConv(ZAIKOREC.YUKO_Z_QTY, vbUnicode))
                                    End If
                                
                                End If
                            
                            End If
                        
                        End If
                    End If
                    
                    com = BtOpGetNext
                    
                Loop
        
        
        
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
        
                SendFileRec.Title = "0"     'タイトル行
                'Call UniCode_Conv(SendFileRec.LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME & Format(Tana_Cnt + 1, "#0") & "件")                '2017.09.22
                Call UniCode_Conv(SendFileRec.LCD, Left(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, 5) & Format(Tana_Cnt + 1, "#0") & "件")   '2017.09.22
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
        
        
                If Tana_Cnt > -1 Then
                                '集計テーブルよりデータ出力
                    For j = 0 To UBound(Tanahyoji)
                                
                        SendFileRec.Title = "1"
'                        Call UniCode_Conv(SendFileRec.LCD, Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
'                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
'                        SendFileRec.CRLF = vbCrLf
                        
                        If j = 0 Then
                            Call UniCode_Conv(SendFileRec.LCD, "*" & Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
                        Else
                            Call UniCode_Conv(SendFileRec.LCD, " " & Left(Tanahyoji(j).Tanaban, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 3, 2) & "-" & Mid(Tanahyoji(j).Tanaban, 5, 2) & "-" & Right(Tanahyoji(j).Tanaban, 2) & ":" _
                                            & Format(Tanahyoji(j).SUMI_QTY + Tanahyoji(j).MI_QTY, "#0"))
                        End If
                        SendFileRec.CRLF = vbCrLf
                                            
                        Put #FileNo, , SendFileRec
                                            
                                            
                        Call UniCode_Conv(SendFileRec.LCD, "  商：" & Format(Tanahyoji(j).SUMI_QTY, "#0") & "  未：" & Format(Tanahyoji(j).MI_QTY, "#0"))
                        SendFileRec.CRLF = vbCrLf
                                            
                                            
                        
                        Put #FileNo, , SendFileRec
                            
                    Next j
                End If
        
        
                Close #FileNo
        
        
        End Select
    Next i
    
    '作業ﾛｸﾞ出力    2008.08.08
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
    If Trim(MENU_NO) = "" Then
    Else
    '作業ﾛｸﾞ出力
        
        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            RET_JGYOBU, _
                                            RET_NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            Hinban) Then
            Tanahyoji_Kaso_Proc = SYS_ERR
            Exit Function
        End If
    End If
    '作業ﾛｸﾞ出力    2008.08.08
    
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = B9_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.FileName = B9_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１〜５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    Tanahyoji_Kaso_Proc = False
    

End Function





Public Function SAI_SU_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『入り数／口数処理』
'
'-------------------------------------------------------
Dim sts         As Integer
Dim i           As Integer
Dim Hinban      As String
Dim SAI_SU      As String
Dim KUCHI_SU    As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2   '2008.08.08

Dim wkNum1      As Double
Dim wkNum2      As Double

Dim wkKUTI_SU   As String


    SAI_SU_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                SAI_SU_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            '   -------------------------------- 送信テキスト作成
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
            
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            
            
            
            If IsNumeric(StrConv(ITEMREC.SAI_SU, vbUnicode)) Then
                ID_KANRI_TBL(ING_No).SAI_SU = StrConv(ITEMREC.SAI_SU, vbUnicode)    '送信する才数
            Else
                ID_KANRI_TBL(ING_No).SAI_SU = "00.0"
            End If
            
            If IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                ID_KANRI_TBL(ING_No).KUTI_SU = ToRoundDown(CCur(StrConv(ITEMREC.KUTI_SU, vbUnicode)), 0) '送信する口
            Else
                ID_KANRI_TBL(ING_No).KUTI_SU = "0"
            End If
            
            
            
            
            
            
            
            
            If Trim(StrConv(ITEMREC.KONPOU_F, vbUnicode)) <> "1" Then
                ID_KANRI_TBL(ING_No).KUTI_SU = "0"
            End If
                        
            
            
            
            
            
            
            If IsNumeric(StrConv(ITEMREC.D_SIZE_W, vbUnicode)) Then
                ID_KANRI_TBL(ING_No).SIZE_W = StrConv(ITEMREC.D_SIZE_W, vbUnicode)    '送信する(W)
            Else
                ID_KANRI_TBL(ING_No).SIZE_W = "00000000"
            End If
            
            If IsNumeric(StrConv(ITEMREC.D_SIZE_D, vbUnicode)) Then
                ID_KANRI_TBL(ING_No).SIZE_D = StrConv(ITEMREC.D_SIZE_D, vbUnicode)    '送信する(D)
            Else
                ID_KANRI_TBL(ING_No).SIZE_D = "00000000"
            End If
            
            If IsNumeric(StrConv(ITEMREC.D_SIZE_H, vbUnicode)) Then
                ID_KANRI_TBL(ING_No).SIZE_H = StrConv(ITEMREC.D_SIZE_H, vbUnicode)    '送信する(H)
            Else
                ID_KANRI_TBL(ING_No).SIZE_H = "00000000"
            End If
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_BCNUM
                                                            '表示内容
            
            
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, LCD_SIZE_W_S & Space(M_Keta - (Len(LCD_SIZE_W_S) * 2) - 8 + (8 - Len(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")))) & Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, LCD_SIZE_W_S & Space(M_Keta - (Len(LCD_SIZE_W_S) * 2) - 8 + (8 - Len(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")))) & Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, LCD_SIZE_W_S)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, LCD_SIZE_W_S)
                                                            
                                                            '数値初期表示
'            Send_Text.Box_Type(0).INIT = Space(10 - Len(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))) & Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = Space(10 - Len(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))) & Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")
            Send_Text.Box_Type(0).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))
                                                            
                                                            
                                                            
                                                            
                                                            '初期カーソル位置
'            Send_Text.Box_Type(0).Start_Pos = Format(10 - Len(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0")), "00")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = Format(10 - Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"), "00")
'            Send_Text.Box_Type(0).Start_Pos = 10 + Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "#0"))) - 2
            Send_Text.Box_Type(0).Start_Pos = "07"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = "07"
                                                            
                                                            
                                                            
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "03"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "03"
                                                                                
                                                                                
                                                                                
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCNUM
                                                            '表示内容
            
            
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_SIZE_D_S)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_SIZE_D_S)
                                                            
                                                            
                                                            '数値初期表示
                                                            
                                                            
            Send_Text.Box_Type(1).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0"))
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0"))
                                                            
                                                            
                                                            
                                                            
                                                            '初期カーソル位置
'            Send_Text.Box_Type(1).Start_Pos = 10 + Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0"))) - 2
            Send_Text.Box_Type(1).Start_Pos = "07"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "07"
                                                            
                                                            
                                                            
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "03"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "03"
                                                                                
                                                                                
                                                                                
                                                                                
            Send_Text.Box_Type(1).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                            '表示内容
            
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_SIZE_H_S)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_SIZE_H_S)
                                                            
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_H), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_H), "#0"))
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_H), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_H), "#0"))
                                                            
                                                            
                                                            
                                                            
                                                            '初期カーソル位置
'            Send_Text.Box_Type(2).Start_Pos = 10 + Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "#0"))) - 2
            Send_Text.Box_Type(2).Start_Pos = "07"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "07"
                                                            
                                                            
                                                            
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "03"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "03"
                                                                                
                                                                                
                                                                                
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            
            
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
            
            
            
            wkNum1 = Val(ID_KANRI_TBL(ING_No).SIZE_W) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_D) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_H) / 1000
            wkNum1 = ToHalfAdjust(CCur(Val(ID_KANRI_TBL(ING_No).SIZE_W) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_D) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_H) / 1000), 4)
            
            
            
            
            If IsNumeric(StrConv(ITEMREC.SAI_SU, vbUnicode)) Then
                wkNum2 = CCur(StrConv(ITEMREC.SAI_SU, vbUnicode))
            Else
                wkNum2 = ToHalfAdjust(wkNum1 / 0.028, 1)
            End If
            
            ID_KANRI_TBL(ING_No).SAI_SU = Format(wkNum2, "00.0")
            
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SAI_SU_S1 & Format(wkNum2, "0.0") & "(" & Format(wkNum1, "0.000") & ")")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SAI_SU_S1 & Format(wkNum2, "0.0") & "(" & Format(wkNum1, "0.00") & ")")
                                                            
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = ""            '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            
            
            
            
            
            
            
            '-----------------------------------------------５行目
                                                                     
'口数４

                                                                     
                                                                     'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            
            
'            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_KUTI_SU_S1 & Space(M_Keta - (Len(LCD_KUTI_SU_S) * 2) - 4 + (4 - Len(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0")))) & Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0"))
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_KUTI_SU_S1 & Space(M_Keta - (Len(LCD_KUTI_SU_S) * 2) - 4 + (4 - Len(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0")))) & Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0"))
                                                            
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_KUTI_SU_S1)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_KUTI_SU_S1)
                                                            
                                                            
                                                            '数値初期表示
                                                            
                                                            
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0"))
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0")))) & Trim(Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "#0"))
                                                            
                                                            
                                                            
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = "14"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "14"
                                                            
                                                            
                                                            
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "02"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "02"
                                                                                
                                                                                
                                                                                
                                                                                
            Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_SIZE_W_S          'W
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "サイズ(W)エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "サイズ(W)エラー", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SAI_SU_Proc = False
                            Exit Function
                        End If
                
                        ID_KANRI_TBL(ING_No).SIZE_W = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
            
                    Case LCD_SIZE_D_S          'D
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "サイズ(D)エラー", "", "")    '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "サイズ(D)エラー", "", "")     '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SAI_SU_Proc = False
                            Exit Function
                        End If
                
                        ID_KANRI_TBL(ING_No).SIZE_D = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
            
            
                    Case LCD_SIZE_H_S          'H
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "サイズ(H)エラー", "", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "サイズ(H)エラー", "", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SAI_SU_Proc = False
                            Exit Function
                        End If
                
                        ID_KANRI_TBL(ING_No).SIZE_H = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
            
            
                    Case LCD_KUTI_SU_S1         '口数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SAI_SU_Proc = False
                            Exit Function
                        End If
                
                        If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) < 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SAI_SU_Proc = False
                            Exit Function
                        End If
                
                
                        ID_KANRI_TBL(ING_No).KUTI_SU = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
            
            
        
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                        '品目マスタ読込み
            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
            Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).Hinban)
            Do
                sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")         '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")     '2017.09.22

                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                        SAI_SU_Proc = False
                        GoTo Abort_Tran
                    Case BtErrKeyNotFound
                    '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品番未登録", "", "")     '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品番未登録", "", "") '2017.09.22

                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                        SAI_SU_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目マスタ", 0)
                        SAI_SU_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select

            Loop
                                        'W
            Call UniCode_Conv(ITEMREC.D_SIZE_W, Format(Val(ID_KANRI_TBL(ING_No).SIZE_W), "00000000"))
                                        'D
            Call UniCode_Conv(ITEMREC.D_SIZE_D, Format(Val(ID_KANRI_TBL(ING_No).SIZE_D), "00000000"))
                                        'D
            Call UniCode_Conv(ITEMREC.D_SIZE_H, Format(Val(ID_KANRI_TBL(ING_No).SIZE_H), "00000000"))
                                        '才数
            
            wkNum1 = Val(ID_KANRI_TBL(ING_No).SIZE_W) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_D) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_H) / 1000
            wkNum1 = ToHalfAdjust(CCur(Val(ID_KANRI_TBL(ING_No).SIZE_W) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_D) / 1000 * Val(ID_KANRI_TBL(ING_No).SIZE_H) / 1000), 4)
            wkNum2 = ToHalfAdjust(wkNum1 / 0.028, 1)
            
            
            
            Call UniCode_Conv(ITEMREC.SAI_SU, Format(wkNum2, "000.00"))
                                        '口数
            
            
            
            If Val(ID_KANRI_TBL(ING_No).KUTI_SU) = 0 Then
                Call UniCode_Conv(ITEMREC.KONPOU_F, "0")
            Else
                Call UniCode_Conv(ITEMREC.KONPOU_F, "1")
                Call UniCode_Conv(ITEMREC.KUTI_SU, Format(Val(ID_KANRI_TBL(ING_No).KUTI_SU), "00.0"))
            End If


        
            Call UniCode_Conv(ITEMREC.UPD_TANTO, App.EXEName)                                   '更新担当者ｺｰﾄﾞ
                                                                                                '更新日時
            Call UniCode_Conv(ITEMREC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))



'                                        '品目マスタ書き込み
            Do
                sts = BTRV(BtOpUpdate, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE

                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")         '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")     '2017.09.22

                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                        SAI_SU_Proc = False
                        GoTo Abort_Tran

                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpUpdate, "品目マスタ", 0)
                        SAI_SU_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
            Loop
        
        
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        '次の作業要求
            
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    SAI_SU_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If
    

End Function






Public Function Hin_Shogo_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『品番別在庫照合処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim Tanaban         As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MEMO            As String

Dim MENU_NO         As String

    Hin_Shogo_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then     '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Hin_Shogo_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 混載チェック
'                            If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
'                                If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
'                                    StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
'                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
'                                    SendBuf = Text_Create_Proc()
'                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                    Hin_Shogo_Proc = False
'                                    Exit Function
'                                End If
'                            End If
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    If Len(Trim(Tanaban)) < 8 Then
                                        
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")    '2017.09.22
                                    Else
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    End If
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Hin_Shogo_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
            
                            '------------------ 禁止棚のチェック
'                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
'
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(To_Tanaban, 2) & "-" & Mid(To_Tanaban, 3, 2) & "-" & Mid(To_Tanaban, 5, 2) & "-" & Right(To_Tanaban, 2), "棚使用不可", "", "")
'
'                                SendBuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                Ido_In_Proc = False
'                                Exit Function
'                            End If
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            If Len(Trim(Tanaban)) < 8 Then
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")    '2017.09.22
                                            Else
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            End If
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            Hin_Shogo_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Shogo_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            '   -------------------------------- 在庫数集計
            If Zaiko_Syukei_Proc(SUMI_QTY, _
                                    MI_QTY, _
                                    RET_JGYOBU, _
                                    RET_NAIGAI, Hinban) Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            '   -------------------------------- 送信テキスト作成
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = Tanaban          '棚番をセーブ
            
            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
            
            
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
                                                        
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            '>>>>>>>>>>>>   2017.09.22
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            '>>>>>>>>>>>>   2017.09.22
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            '有効桁数により棚番の編集を変える   '2017.09.23
'            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
'                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
'
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
'                            Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                            
            If Len(Trim(Tanaban)) < 8 Then
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Tanaban)
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Tanaban)
            Else
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
            End If
            '有効桁数により棚番の編集を変える   '2017.09.23
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "13"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Shogo_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
            
            
                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Shogo_Proc = False
                            Exit Function
                        End If
                
                
                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            
                        Else
                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        
                        End If
        
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                        '品目マスタ読込み
            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).S_JGYOBU)
            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).S_NAIGAI)
            Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).Hinban)
            Do
                sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")     '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "") '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Hin_Shogo_Proc = False
                        GoTo Abort_Tran
                    Case BtErrKeyNotFound
                    '   -------------------------------- エラーメッセージ作成
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品番未登録", "", "")     '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品番未登録", "", "") '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Hin_Shogo_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目マスタ", 0)
                        Hin_Shogo_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
        
            Loop
                                        '最終照合日付
            Call UniCode_Conv(ITEMREC.LAST_CHK_DT, Format(Date, "yyyymmdd"))
                                        '最終照合在庫数
            Call UniCode_Conv(ITEMREC.LAST_CHK_QTY, Format(SUMI_QTY + MI_QTY, "00000000"))
                                        '品目マスタ書き込み
            Do
                sts = BTRV(BtOpUpdate, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
            
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")         '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")     '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Hin_Shogo_Proc = False
                        GoTo Abort_Tran
            
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpUpdate, "品目マスタ", 0)
                        Hin_Shogo_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
            Loop
        
            If (SUMI_QTY + MI_QTY) = (ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY) Then
                MEMO = B2_MEMO & StrConv(Format((SUMI_QTY + MI_QTY), "#0"), vbWide) & "[OK]"
            Else
                MEMO = B2_MEMO & StrConv(Format((ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY), "#0"), vbWide) & "[" & StrConv(Format(SUMI_QTY + MI_QTY, "#0"), vbWide) & "]"
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
                                
'>>>>>>>>>> 2017.09.21
'            sts = IDOREKI_OUTPUT_PROC("", _
'                                        "", _
'                                        ID_KANRI_TBL(ING_No).S_JGYOBU, _
'                                        ID_KANRI_TBL(ING_No).S_NAIGAI, _
'                                        ID_KANRI_TBL(ING_No).Hinban, _
'                                        "", _
'                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
'                                        0, _
'                                        0, _
'                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
'                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                        FILE_RETRY, _
'                                        , _
'                                        MEMO, , , , , MENU_NO)
            
            
            
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        SUMI_QTY, _
                                        MI_QTY, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        MEMO, , , , , MENU_NO)
'>>>>>>>>>> 2017.09.21
            
            
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Shogo_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        
    
    
                
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        '次の作業要求
            
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Hin_Shogo_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function MTS_Dec_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『向け先宣言での出荷処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8

'2010.12.07
Dim Hinban          As String * 13
'Dim Hinban          As String * 20
'2010.12.07

Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    MTS_Dec_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    MTS_Dec_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    MTS_Dec_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                MTS_Dec_Proc = False
                                Exit Function
                            End If
                        End If
                            
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            MTS_Dec_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                MTS_Dec_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
            ID_NO = ""
            sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                    Hinban, _
                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                    ID_KANRI_TBL(ING_No).SS_CODE, _
                                    ID_KANRI_TBL(ING_No).CYU_KBN, _
                                    Y_SYU_CNT, _
                                    ID_NO, _
                                    SYUKA_QTY, _
                                    DEN_NO, _
                                    KAN_KBN)
            Select Case sts
                Case False          '正常
                    If Y_SYU_CNT = 0 Then   '対象データなし
                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "出荷予定無し", "", "")        '2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "出荷予定無し", "", "")    '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        MTS_Dec_Proc = False
                        Exit Function
                    End If
                
                Case True
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "出荷予定使用中", "", "")      '2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "出荷予定使用中", "", "")  '2017.09.22
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    MTS_Dec_Proc = False
                    Exit Function
            End Select
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    MTS_Dec_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                MTS_Dec_Proc = False
                Exit Function
            End If
        
                
        
        
            ID_KANRI_TBL(ING_No).Tanaban = Tanaban          '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Y_SYU_CNT = Y_SYU_CNT      '該当伝票枚数
            ID_KANRI_TBL(ING_No).ID_NO = ID_NO              '伝票
            ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO            '伝票
            ID_KANRI_TBL(ING_No).YUKO_SUMI_QTY = SUMI_QTY   '使用可能な商品化済み在庫
            ID_KANRI_TBL(ING_No).YUKO_MI_QTY = MI_QTY       '使用可能な未商品在庫
        
        
            Select Case Y_SYU_CNT
                Case 1              '対象伝票が１枚
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                    ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                    '数量付きの送信メッセージを作成する
                    Send_Text.sts = Sts_OK                                      'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                    Send_Text.Display_Flg = Display_DEF                         '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                    Send_Text.End_Menu = Menu_Only                              '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                                   'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                    Send_Text.FileName = ""                                     '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
                    Send_Text.buzzer = Buzzer_DEF                               'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                
                    '-----------------------------------------------１行目
                                                                                'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                    '>>>>>>>>>  2017.09.22
'                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                    
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    '>>>>>>>>>  2017.09.22
                                                                                '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                                                '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                    Send_Text.Box_Type(0).MENU = ""                             'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                                'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "08"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "13"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '-----------------------------------------------４行目
                                                                            'BOX属性
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                            
                    If SYUKA_QTY > (SUMI_QTY + MI_QTY) Then
                        SYUKA_QTY = SUMI_QTY + MI_QTY           '在庫数が少ない時は在庫数を送信
                    End If
                                                                            
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                                                                            
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "05"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
                    Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                                                                            'BOX属性
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
                    Sendbuf = Text_Create_Proc()
                
                
                Case Else           '対象伝票が複数枚
            
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                    
                    '数量付きの送信メッセージを作成する
                    Send_Text.sts = Sts_OK                                      'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                    Send_Text.Display_Flg = Display_DEF                         '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                    Send_Text.End_Menu = Menu_Only                              '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                                   'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                    Send_Text.FileName = ""                                     '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
                    Send_Text.buzzer = Buzzer_DEF                               'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                
                    '-----------------------------------------------１行目
                                                                                'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                    '>>>>>> 2017.09.22
'                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                    
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    '>>>>>> 2017.09.22
                                                                                
                                                                                '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                                                '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                    Send_Text.Box_Type(0).MENU = ""                             'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                                'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "08"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                            '入力桁数
                    '2010.12.07
'                    Send_Text.Box_Type(2).Max_Size = "13"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                    Send_Text.Box_Type(2).Max_Size = "20"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                    '2010.12.07
                                                                                
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '-----------------------------------------------４行目
                                                                            'BOX属性
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_ID_No)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_ID_No)
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "08"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "08"
                                                                                
                    Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                                                                            'BOX属性
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
                    Sendbuf = Text_Create_Proc()
            
            End Select
        
        Case Step_Sagyo2_RES        '２回目の受信（出荷数／伝票ＩＤ）
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    Case LCD_Syuka      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                    
                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    
                                    '出庫処理
                        sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                    0, _
                                    0, _
                                    SYUKA_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).CYU_KBN, _
                                    ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).DEN_NO, _
                                    ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "他端末で使用中", "", "")  '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                MTS_Dec_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        '次の作業要求
                        
                        
                        '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                Call Err_Send_Proc("データ使用中", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                        
                        
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
            
                        Sendbuf = Text_Create_Proc()
            
            
            
                    Case LCD_ID_No      '伝票ＩＤ
                
'''                        If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'''                            ID_NO = Format(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "00000000")
'''                        Else
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
'''                        End If
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                "", _
                                                "", _
                                                "", _
                                                "", _
                                                "", _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "出荷予定無し", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "出荷予定無し", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    MTS_Dec_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Hinban, "出荷予定使用中", "", "")         '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "出荷予定使用中", "", "")     '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                MTS_Dec_Proc = False
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                
                        '------------------ 確定した出荷予定の予定数を送信する
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                        '数量付きの送信メッセージを作成する
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>>>> 2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        
                        '>>>>>>>>>> 2017.09.22
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                                    Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                                    Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
                                                                            '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                            '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "08"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                            'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                            '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                            '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "13"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                            'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                            
                        If SYUKA_QTY > (ID_KANRI_TBL(ING_No).YUKO_SUMI_QTY + ID_KANRI_TBL(ING_No).YUKO_MI_QTY) Then
                            SYUKA_QTY = ID_KANRI_TBL(ING_No).YUKO_SUMI_QTY + ID_KANRI_TBL(ING_No).YUKO_MI_QTY
                        End If
                                                                            
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                                                                            '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                                                                            '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                            '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                            'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（出荷数）
            For i = 0 To M_Gyo - 1
            
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    Case LCD_Syuka      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            MTS_Dec_Proc = False
                            Exit Function
                        End If
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    '出庫処理
                        sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                    0, _
                                    0, _
                                    SYUKA_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).CYU_KBN, _
                                    ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).DEN_NO, _
                                    ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "他端末で使用中", "", "")  '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                MTS_Dec_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        '次の作業要求
                        
                        
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
            
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
    End Select

    MTS_Dec_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
Public Function DEN_ID_Dec_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『伝票ＩＤでの出荷処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8


Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim KAN_KBN         As String * 1

Dim MENU_NO         As String * 2

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim wkTEXT          As String       '2007.07.21


Dim HAIKI_F         As Boolean      '2010.02.22
Dim j               As Integer      '2010.02.22


    DEN_ID_Dec_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
'            For i = 0 To M_Gyo - 1                             '2016.10.07
            For i = 1 To M_Gyo - 1                              '2016.10.07
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            RET_JGYOBU = Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 1)
                            ID_NO = Right(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 12)
                        Else
                            RET_JGYOBU = ID_KANRI_TBL(ING_No).JGYOBU
'''                            If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'''                                ID_NO = Format(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "00000000")
'''                            Else
                                ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
'''                            End If
                        End If
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                RET_JGYOBU, _
                                                RET_NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
'                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")         '2016.09.21
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")     '2016.09.21
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    DEN_ID_Dec_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")           '2016.09.21
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")       '2016.09.21
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                DEN_ID_Dec_Proc = False
                                Exit Function
                        End Select
                
                
                        If KAN_KBN <> KAN_KBN_UN Then
                            
                            
'---------------------------    データ解放を追加    2011.07.29
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
'---------------------------    データ解放を追加    2011.07.29
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫処理済み", "", "")         '2016.09.21
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出庫処理済み", "", "")     '2016.09.21
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
                                                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                           
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        '2009.07.29
                        If SYUKA_QTY > 1 Then
                        
                            Send_Text.buzzer = Wel_SYUKA_BUZZER                 'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        Else
                            Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        End If
                        
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)                          '2016.09.21
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)     '2016.09.21
                                                                                    
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)                      '2016.09.21
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME) '2016.09.21
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "09"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
'2007.07.21                        Send_Text.Box_Type(3).Max_Size = "13"
'2007.07.21                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番／数量）
            For i = 0 To M_Gyo - 1
                
                
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case wkTEXT
                '2007.07.21 ↑
                                    
                    
                    
                    Case LCD_Tanaban    '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
'                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2016.09.21
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2016.09.21
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    DEN_ID_Dec_Proc = False
                                    Exit Function
                    
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
'                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2016.09.21
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2016.09.21
            
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    DEN_ID_Dec_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")            '2016.09.21
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2016.09.21
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                DEN_ID_Dec_Proc = False
                                Exit Function
                            End If
                        End If
                            
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        
                        If ID_KANRI_TBL(ING_No).JGYOBU = ID_KANRI_TBL(ING_No).S_JGYOBU And _
                            ID_KANRI_TBL(ING_No).NAIGAI = ID_KANRI_TBL(ING_No).S_NAIGAI Then
                        
                            sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        
                        Else
                        
                            sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, ID_KANRI_TBL(ING_No).S_NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        
                        End If
                        
                        
                        
                        
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
'                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2016.09.21
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2016.09.21
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            DEN_ID_Dec_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")          '2016.09.21
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")      '2016.09.21
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                DEN_ID_Dec_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                    
                    
'2007.07.21                        If Hinban <> ID_KANRI_TBL(ING_No).Hinban Then
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                        
                        '   -------------------------------- エラーメッセージ作成
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")          '2016.09.21
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")      '2016.09.21
    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            DEN_ID_Dec_Proc = False
                            Exit Function
                        
                        End If
                    
                    
                    Case LCD_Syuka      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2016.09.21
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2016.09.21
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2016.09.21
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2016.09.21
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2016.09.21
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2016.09.21
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
                        
                        
                        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                DEN_ID_Dec_Proc = False
                                Exit Function
                        End Select
                    
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
                        
                        
                        
                        If SYUKA_QTY > (SUMI_QTY + MI_QTY) Then
                            Call Err_Send_Proc("出荷数不足", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            DEN_ID_Dec_Proc = False
                            Exit Function
                        End If
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    '出庫処理
                        '2010.02.22　↓
                        HAIKI_F = False
                                    
                        If HAIKI_MTS_F Then
                                    
                            For j = 0 To UBound(HAIKI_MTS)
                            
                            
                                If Trim(ID_KANRI_TBL(ING_No).MTS_CODE) = HAIKI_MTS(j) Then
                                
                            
                                    HAIKI_F = True
                                    Exit For
                                
                                End If
                            
                            Next j
                                    
                        End If
                                    
                                    
                                    '出庫処理
                        
                        
                        If HAIKI_F Then
                        
                        
                            sts = Syuko_Update_HAIKI_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        Hinban, _
                                        "", _
                                        Tanaban, _
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                        0, _
                                        0, _
                                        SYUKA_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).CYU_KBN, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_NO, _
                                        ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        
                        Else
                        '2010.02.22 ↑
                        
                            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        Hinban, _
                                        "", _
                                        Tanaban, _
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                        0, _
                                        0, _
                                        SYUKA_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).CYU_KBN, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_NO, _
                                        ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        
                        
                        
                        End If
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")          '2016.09.21
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "他端末で使用中", "", "")      '2016.09.21
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                DEN_ID_Dec_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        
                                        
                        '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                Call Err_Send_Proc("データ使用中", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                        
                                        
                                        '次の作業要求
                                        
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
            
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
    End Select
    DEN_ID_Dec_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function

Public Function DEN_ID_Dec2_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『*伝票ＩＤでの出荷処理』
'
'       2015.02.21
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8


Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim KAN_KBN         As String * 1

Dim MENU_NO         As String * 2

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim wkTEXT          As String       '2007.07.21


Dim HAIKI_F         As Boolean      '2010.02.22
Dim j               As Integer      '2010.02.22

Dim Y_SYUKA_QTY     As Long      '2017.09.23


    DEN_ID_Dec2_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            RET_JGYOBU = Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 1)
                            ID_NO = Right(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 12)
                        Else
                            RET_JGYOBU = ID_KANRI_TBL(ING_No).JGYOBU
'''                            If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'''                                ID_NO = Format(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "00000000")
'''                            Else
                                ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
'''                            End If
                        End If
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                RET_JGYOBU, _
                                                RET_NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, , , , , , Y_SYUKA_QTY)
                                '               2017.09.23  Y_SYUKA_QTY 追加
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                                    
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "") '2017.09.22 2017.09.25 DEL
                                    Call Err_Send_Proc(ID_NO, "出荷予定なし", "", "", "") '2017.09.25
                                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    DEN_ID_Dec2_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")   '2017.09.22 2017.09.25 DEL
                                Call Err_Send_Proc(ID_NO, "出荷予定使用中", "", "", "")                                      '2017.09.25
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                DEN_ID_Dec2_Proc = False
                                Exit Function
                        End Select
                
                
                        If KAN_KBN <> KAN_KBN_UN Then
                            
                            
'---------------------------    データ解放を追加    2011.07.29
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
'---------------------------    データ解放を追加    2011.07.29
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫処理済み", "", "")         '2017.09.22
                            
                            
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出庫処理済み", "", "")     '2017.09.22 2017.09.25 DEL
                             
                            Call Err_Send_Proc(ID_NO, Hinban, "出荷数:" & Format(Y_SYUKA_QTY, "#0"), "出庫処理済み", "")    '2017.09.25
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            DEN_ID_Dec2_Proc = False
                            Exit Function
                        End If
                                                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                           
                        
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        '>>>>>>>>>> 2017.09.25
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                
                                                                                
                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                        '>>>>>>>>>> 2017.09.25
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "09"                               '2017.09.29
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "09"          '2017.09.29
                        Send_Text.Box_Type(1).Max_Size = "20"                               '2017.09.29
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "20"          '2017.09.29
                                                                                
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                                                                                
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Syuka_QTY)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Syuka_QTY)
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""


                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "残在庫")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "残在庫")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = ""
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""


                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番／数量）
            For i = 0 To M_Gyo - 1
                
                If Not IsNumeric(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) Then
                    Exit For
                End If
                
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case wkTEXT
                '2007.07.21 ↑
                                    
                    
                    
                    Case LCD_Tanaban    '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    DEN_ID_Dec2_Proc = False
                                    Exit Function
                    
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    
                                    If Len(Trim(Tanaban)) < 8 Then
                                        Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, "棚番エラー", "", "")    '2017.09.22
                                    Else
                                        Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    End If
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    DEN_ID_Dec2_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                                    
                                If Len(Trim(Tanaban)) < 8 Then
                                    Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, "棚使用不可", "", "")    '2017.09.22
                                Else
                                    Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                                End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                    
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                DEN_ID_Dec2_Proc = False
                                Exit Function
                            End If
                        End If
                            
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        
                        If ID_KANRI_TBL(ING_No).JGYOBU = ID_KANRI_TBL(ING_No).S_JGYOBU And _
                            ID_KANRI_TBL(ING_No).NAIGAI = ID_KANRI_TBL(ING_No).S_NAIGAI Then
                        
                            sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        
                        Else
                        
                            sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, ID_KANRI_TBL(ING_No).S_NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        
                        End If
                        
                        
                        
                        
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            If Len(Trim(Tanaban)) < 8 Then
                                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, "棚番エラー", "", "")   '2017.09.22
                                            Else
                                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            End If
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            DEN_ID_Dec2_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                
                                '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22    2017.09.25 DEL
                                
                                
                                If Len(Trim(Tanaban)) < 8 Then
                                    Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, Hinban, "品番エラー", "")
                                Else
                                    Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "品番エラー", "")
                                End If
                                '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                DEN_ID_Dec2_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                    
                    
'2007.07.21                        If Hinban <> ID_KANRI_TBL(ING_No).Hinban Then
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                        
                        '   -------------------------------- エラーメッセージ作成
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                            
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).ID, Hinban, "品番エラー", "", "")  '2017.09.22
    
                            If Len(Trim(Tanaban)) < 8 Then
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, Hinban, "品番エラー", "")
                            Else
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "品番エラー", "")
                            End If
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            DEN_ID_Dec2_Proc = False
                            Exit Function
                        
                        End If
                    
                    
                    Case LCD_Syuka_QTY      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            
                            
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22    2017.09.25 DEL
                            
                            
    
                            If Len(Trim(Tanaban)) < 8 Then
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "出荷数エラー:" & SYUKA_QTY)
                            Else
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "出荷数エラー:" & SYUKA_QTY)
                            End If
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            DEN_ID_Dec2_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22    2017.09.25 DEL
                            
    
                            If Len(Trim(Tanaban)) < 8 Then
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "出荷数エラー:" & SYUKA_QTY)
                            Else
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "出荷数エラー:" & SYUKA_QTY)
                            End If
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            DEN_ID_Dec2_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")        '2017.09.22 2017.09.25 DEL
                            
    
                            If Len(Trim(Tanaban)) < 8 Then
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "出荷数エラー:" & SYUKA_QTY)
                            Else
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "出荷数エラー:" & SYUKA_QTY)
                            End If
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            DEN_ID_Dec2_Proc = False
                            Exit Function
                        End If
                        
                        
                        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                
                                                                
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                'Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                                'If Len(Trim(Tanaban)) < 8 Then
                                '    Call Err_Send_Proc("在庫使用中", Tanaban, Hinban, "", "")
                                'Else
                                '    Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                                'End If
                                '有効桁数により棚番の編集を変える   '2017.09.23
                                
                                
                                    
                                If Len(Trim(Tanaban)) < 8 Then
                                    Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "在庫使用中")
                                Else
                                    Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "出荷数エラー:" & Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                                End If
                                
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                                
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                DEN_ID_Dec2_Proc = False
                                Exit Function
                        End Select
                    
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            
                        '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            
                            '有効桁数により棚番の編集を変える   '2017.09.23
                            'Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            
                            'If Len(Trim(Tanaban)) < 8 Then
                            '    Call Err_Send_Proc("有効在庫無し", Tanaban, Hinban, "", "")
                            'Else
                            '    Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            'End If
                            '有効桁数により棚番の編集を変える   '2017.09.23
                    
                    
                            If Len(Trim(Tanaban)) < 8 Then
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "在庫なし:" & Format(SUMI_QTY + MI_QTY, "#0"))
                            Else
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "在庫なし:" & Format(SUMI_QTY + MI_QTY, "#0"))
                            End If
                        
                        '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            DEN_ID_Dec2_Proc = False
                            Exit Function
                        End If
                        '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                        
                        
                        
                        If SYUKA_QTY > (SUMI_QTY + MI_QTY) Then
                            
                        '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            '有効桁数により棚番の編集を変える   '2017.09.23
                            'Call Err_Send_Proc("出荷数不足", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            
                            'If Len(Trim(Tanaban)) < 8 Then
                            '    Call Err_Send_Proc("出荷数不足", Tanaban, Hinban, "", "")
                            'Else
                            '    Call Err_Send_Proc("出荷数不足", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            'End If
                            '有効桁数により棚番の編集を変える   '2017.09.23
                        
                            If Len(Trim(Tanaban)) < 8 Then
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "在庫なし:" & Format(SUMI_QTY + MI_QTY, "#0"))
                            Else
                                Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "在庫なし:" & Format(SUMI_QTY + MI_QTY, "#0"))
                            End If
                        
                        
                        '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            DEN_ID_Dec2_Proc = False
                            Exit Function
                        End If
                        
                        
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).Tanaban = Tanaban
                        
                        ID_KANRI_TBL(ING_No).Inp_QTY = SYUKA_QTY
                        
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    '出庫処理
                        '2010.02.22　↓
                        HAIKI_F = False
                                    
                        If HAIKI_MTS_F Then
                                    
                            For j = 0 To UBound(HAIKI_MTS)
                            
                            
                                If Trim(ID_KANRI_TBL(ING_No).MTS_CODE) = HAIKI_MTS(j) Then
                                
                            
                                    HAIKI_F = True
                                    Exit For
                                
                                End If
                            
                            Next j
                                    
                        End If
                                    
                                    
                                    '出庫処理
                        
                        
                        If HAIKI_F Then
                        
                        
                            sts = Syuko_Update_HAIKI_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        Hinban, _
                                        "", _
                                        Tanaban, _
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                        0, _
                                        0, _
                                        SYUKA_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).CYU_KBN, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_NO, _
                                        ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        
                        Else
                        '2010.02.22 ↑
                        
                            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        Hinban, _
                                        "", _
                                        Tanaban, _
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                        0, _
                                        0, _
                                        SYUKA_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).CYU_KBN, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_NO, _
                                        ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        
                        
                        
                        End If
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
                                
                                
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")      '2017.09.22
                                
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "他端末で使用中", "", "")  '2017.09.22
                                
                                If Len(Trim(Tanaban)) < 8 Then
                                    Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Tanaban, Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "他端末で使用中")
                                Else
                                    Call Err_Send_Proc(Format(ID_KANRI_TBL(ING_No).ID_NO), Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "出荷数:" & ID_KANRI_TBL(ING_No).Send_Syuka_QTY, "他端末で使用中")
                                End If
                                
                            '>>>>>>>>>>>    2017.09.25 エラーメッセージ　変更
                                
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                DEN_ID_Dec2_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        
                                        
                        '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                Call Err_Send_Proc("データ使用中", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                        
                
'-----------------------------------------
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>>>>>    2017.09.25
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                        
                        
                        '>>>>>>>>>>>    2017.09.25
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        
            '有効桁数により棚番の編集を変える   '2017.09.23
'                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Mid(ID_KANRI_TBL(ING_No).Tanaban, 1, 2) & "-" & _
'                                                                        Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & _
'                                                                        Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & _
'                                                                        Mid(ID_KANRI_TBL(ING_No).Tanaban, 7, 2))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Mid(ID_KANRI_TBL(ING_No).Tanaban, 1, 2) & "-" & _
'                                                                        Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & _
'                                                                        Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & _
'                                                                        Mid(ID_KANRI_TBL(ING_No).Tanaban, 7, 2))
                                                                                
                        If Len(Trim(ID_KANRI_TBL(ING_No).Tanaban)) < 8 Then
                                                                                
                                                                                
                                                                                
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Tanaban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Tanaban)
                                                                                
                        Else
                                                                                
                                                                                
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Mid(ID_KANRI_TBL(ING_No).Tanaban, 1, 2) & "-" & _
                                                                            Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & _
                                                                            Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & _
                                                                            Mid(ID_KANRI_TBL(ING_No).Tanaban, 7, 2))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Mid(ID_KANRI_TBL(ING_No).Tanaban, 1, 2) & "-" & _
                                                                            Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & _
                                                                            Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & _
                                                                            Mid(ID_KANRI_TBL(ING_No).Tanaban, 7, 2))
                        End If
            '有効桁数により棚番の編集を変える   '2017.09.23
                                                                                
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出庫数:" & Format(ID_KANRI_TBL(ING_No).Inp_QTY))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出庫数:" & Format(ID_KANRI_TBL(ING_No).Inp_QTY))
                                                                            
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出荷数:" & Format(ID_KANRI_TBL(ING_No).Inp_QTY))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出荷数:" & Format(ID_KANRI_TBL(ING_No).Inp_QTY))
                                                                            
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""


                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                
                        
                        If ZAIKO_DISP_FLG = 0 Then          '2017.12.05
                        
                            If Zaiko_Syukei_Proc(SUMI_QTY, MI_QTY, ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, ID_KANRI_TBL(ING_No).Hinban) Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                        '>>>>>>>>>>>    '2017.12.05
                        Else
                            If Zaiko_Syukei_Proc(SUMI_QTY, MI_QTY, ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, ID_KANRI_TBL(ING_No).Hinban, ID_KANRI_TBL(ING_No).Tanaban) Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                        End If
                        '>>>>>>>>>>>    '2017.12.05
                                                                                
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "残在庫:" & Format(SUMI_QTY + MI_QTY))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "残在庫:" & Format(SUMI_QTY + MI_QTY))
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = ""
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""


                        Sendbuf = Text_Create_Proc()

                
                
                
                
                
                
                
                
                
                
                
                
                
                
                End Select
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（確認)
                            '次の作業要求
                            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If

            Sendbuf = Text_Create_Proc()
    
    
    
    End Select
    DEN_ID_Dec2_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function


Public Function SYUKO_HYO_Dec_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『出庫表での出荷処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8
Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim wkTEXT          As String



Dim HAIKI_F         As Boolean      '2010.02.22
Dim j               As Integer      '2010.02.22



    SYUKO_HYO_Dec_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（出庫表ａj
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SYUKO_HYO_No   '出庫表
    
                        
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫表使用不可", "", "")           '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出庫表使用不可", "", "")       '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                        
'''                        If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'''                            ID_NO = Format(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "000000000000")
'''                        Else
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
'''                        End If
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                "", _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")         '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_Proc = False
                                Exit Function
                        End Select
                
                        If KAN_KBN <> KAN_KBN_UN Then
                            
'---------------------------    データ解放を追加    2011.07.29
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
'---------------------------    データ解放を追加    2011.07.29
                            
                            
                            
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫処理済み", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出庫処理済み", "", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        '2009.07.29
                        If SYUKA_QTY > 1 Then
                        
                            Send_Text.buzzer = Wel_SYUKA_BUZZER                 'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        Else
                            Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        End If
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '>>>>>>>    2017.09.22
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '>>>>>>>    2017.09.22
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "09"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
'2007.07.21                        Send_Text.Box_Type(3).Max_Size = "13"
'2007.07.21                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka & Space(M_Keta - (Len(LCD_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番／数量）
            For i = 0 To M_Gyo - 1
                
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                Select Case wkTEXT
                '2007.07.21 ↑
                
                
                    Case LCD_Tanaban    '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_Proc = False
                                    Exit Function
                    
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
            
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    SYUKO_HYO_Dec_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                SYUKO_HYO_Dec_Proc = False
                                Exit Function
                            End If
                        End If
                            
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            SYUKO_HYO_Dec_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                SYUKO_HYO_Dec_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                    
                    
'2007.07.21                        If Hinban <> ID_KANRI_TBL(ING_No).Hinban Then
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                        
                        '   -------------------------------- エラーメッセージ作成
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        
                        End If
                    
                    
                    Case LCD_Syuka      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_Proc = False
                                Exit Function
                        End Select
                    
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                        
                        
                        If SYUKA_QTY > (SUMI_QTY + MI_QTY) Then
                            Call Err_Send_Proc("出荷数不足", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_Proc = False
                            Exit Function
                        End If
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                    
                                    
                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    
                        '2010.02.22　↓
                        HAIKI_F = False
                                    
                        If HAIKI_MTS_F Then
                                    
                            For j = 0 To UBound(HAIKI_MTS)
                            
                            
                                If Trim(ID_KANRI_TBL(ING_No).MTS_CODE) = HAIKI_MTS(j) Then
                                
                            
                                    HAIKI_F = True
                                    Exit For
                                
                                End If
                            
                            Next j
                                    
                        End If
                                    
                                    
                                    '出庫処理
                        
                        
                        If HAIKI_F Then
                        
                        
                            sts = Syuko_Update_HAIKI_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        Hinban, _
                                        "", _
                                        Tanaban, _
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                        0, _
                                        0, _
                                        SYUKA_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).CYU_KBN, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_NO, _
                                        ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        
                        Else
                        '2010.02.22 ↑
                        
                            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        Hinban, _
                                        "", _
                                        Tanaban, _
                                        ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                        0, _
                                        0, _
                                        SYUKA_QTY, _
                                        Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).CYU_KBN, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_NO, _
                                        ID_KANRI_TBL(ING_No).ID_NO, MENU_NO)
                        
                        
                        
                        End If
                        
                        
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "他端末で使用中", "", "")  '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        
                                        
                        '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                Call Err_Send_Proc("データ使用中", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                        
                                        '次の作業要求
                                        
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                           '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
            
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
    End Select
    SYUKO_HYO_Dec_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function

Public Function SYUKO_HYO_Dec_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   大阪PC向け『出庫表での出荷処理』    2007.03.16
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long

Dim MI_QTY          As Long

Dim i               As Integer

Dim Y_SYU_CNT       As Integer

Dim Y_SURYO         As Long
Dim J_SURYO         As Long

Dim ID_NO           As String * 12
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim BIN_NO          As String * 2   '2007.05.16

Dim DEN_NO          As String * 6   '2007.06.12
Dim Found_F         As Integer      '2007.06.12
Dim SEQ_NO          As String * 3   '2007.06.12
Dim QTY             As Long         '2007.06.12

Dim wkTEXT          As String

Dim Mod_Return      As Integer      '2010.12.09
Dim iNum            As Integer      '2010.12.09
'Dim wkIri_Su        As String * 8
'Dim j               As Integer


    SYUKO_HYO_Dec_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（出庫表ａj
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SYUKO_HYO_No   '出庫表
    
                        
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) <> 12 Then
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫表ａH？", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出庫表ａH？", "", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_OSAKA_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                ID_KANRI_TBL(ING_No).NAIGAI, _
                                                Hinban, _
                                                Y_SYU_CNT, _
                                                Y_SURYO, _
                                                J_SURYO, _
                                                ID_NO, _
                                                BIN_NO)         '2007.05.16
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")         '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_OSAKA_Proc = False
                                    Exit Function
                                End If
                
                                If Y_SURYO <= J_SURYO Then
                
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出庫処理済み", "", "")         '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出庫処理済み", "", "")     '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_OSAKA_Proc = False
                                    Exit Function
                                            
                                End If
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")           '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_OSAKA_Proc = False
                                Exit Function
                        End Select
                
                
                        '2010.12.09
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(ITEMREC.GAISO_IRI_QTY, "")
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        
                        End Select
                        '2010.12.09
                                                    
                        
                        
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        
                        SYUKA_QTY = Y_SURYO - J_SURYO
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                        
                        
                        ID_KANRI_TBL(ING_No).BIN_NO = BIN_NO        '2007.05.16
                        
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN_SPO  '2007.05.16
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
'                                                                                'BOX属性
'                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(0).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(0).Start_Pos = ""
'
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(0).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
'                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
'                        '-----------------------------------------------２行目
'                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "出庫:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "出庫:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "09"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "09"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        '2010.12.07
'                        Send_Text.Box_Type(3).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                        Send_Text.Box_Type(2).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                        '2010.12.07
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OSAKA_Syuka & Space(M_Keta - (Len(LCD_OSAKA_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OSAKA_Syuka & Space(M_Keta - (Len(LCD_OSAKA_Syuka) * 2) - 5 + (5 - Len(Format(SYUKA_QTY, "#0")))) & Format(SYUKA_QTY, "#0"))
                                                                            
                                                                                '数値初期表示
                        
                        If SYUKO_QTY = 1 Then   '2007.08.02
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                        Else
                            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SYUKA_QTY, "#0"))) & Format(SYUKA_QTY, "#0")
                        End If
                                                                                                            
                                                                                
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                                '入力桁数
                         Send_Text.Box_Type(3).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""





                        '-----------------------------------------------４行目
                                                                                    'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
'                        Call UniCode_Conv(ITEMREC.GAISO_IRI_QTY, " 3 ")
'                        wkIri_Su = StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)
'                        For j = 1 To Len(wkIri_Su)
'                            If Mid(wkIri_Su, j, 1) < " " Then
'                                Mid(wkIri_Su, j, 1) = " "
'                            End If
'                        Next j
                        
                        '2010.12.09
                        If IsNumeric(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)) Then
                            If Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)) <> 0 Then
                                Mod_Return = SYUKA_QTY Mod Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                                iNum = CInt(ToRoundDown(CCur(SYUKA_QTY) / CCur(Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))), 0))
                        
                                
                                Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                        
                        
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                
                                If Mod_Return <> 0 Then
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱＋" & StrConv(Format(Mod_Return, "#0"), vbWide) & "余")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱＋" & StrConv(Format(Mod_Return, "#0"), vbWide) & "余")
                                Else
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱")
                                End If
                                
                                
''Call LOG_OUT(LOG_F, Hinban & " " & StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode) & " " & StrConv(Send_Text.Box_Type(4).LCD, vbUnicode))
                                
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                 Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            End If
                        
                                                    
                        End If







                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番／数量）
            For i = 0 To M_Gyo - 1
                

                '2010.12.07 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                Select Case wkTEXT


'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    
                '2010.12.07 ↑
                    
                    Case LCD_Tanaban    '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_OSAKA_Proc = False
                                    Exit Function
                    
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
            
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    SYUKO_HYO_Dec_OSAKA_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                SYUKO_HYO_Dec_OSAKA_Proc = False
                                Exit Function
                            End If
                        End If
                            
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")        '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            SYUKO_HYO_Dec_OSAKA_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                SYUKO_HYO_Dec_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                    
                    
                        If Hinban <> ID_KANRI_TBL(ING_No).Hinban Then
                        
                        '   -------------------------------- エラーメッセージ作成
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")          '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        
                        End If
                    
                    
                    
                        '伝票ｖ｢登録は出荷不可 2007.06.12
                        If Left(Tanaban, 2) = NYUKA_SOKO_NO Then
                            
                    
                    
                    
                    
                    
                            '------------------ 入荷データの確認
                            sts = Y_Nyuka_O_Chek_Proc(3, RET_JGYOBU, _
                                                        RET_NAIGAI, _
                                                        Hinban, _
                                                        DEN_NO, _
                                                        Found_F, _
                                                        SEQ_NO, _
                                                        QTY)
                    
                    
                    
                            Select Case sts
                                Case False          '正常
                                    If Found_F = 9 Then
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "該当品番使用中", "", "")      '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "該当品番使用中", "", "")  '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SYUKO_HYO_Dec_OSAKA_Proc = False
                                        Exit Function
                                    End If
                    
                    
                                    If Found_F = 1 Then
                                        If Trim(DEN_NO) = "" Or DEN_NO = "000000" Then
                    
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "伝票番号未入力です。", "入庫作業を、", "完了させて下さい。")      '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "伝票番号未入力です。", "入庫作業を、", "完了させて下さい。")  '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SYUKO_HYO_Dec_OSAKA_Proc = False
                                            Exit Function
                                        End If
                                    End If
                    
                                Case True, SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                Case SYS_CANCEL
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "該当品番使用中", "", "")      '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "該当品番使用中", "", "")  '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_HYO_Dec_OSAKA_Proc = False
                                    Exit Function
                            End Select
                    
                    
                    
                    
                        End If
                    Case LCD_OSAKA_Syuka      '出荷残数
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
                
                        SYUKA_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If SYUKA_QTY = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
            
                        If SYUKA_QTY > ID_KANRI_TBL(ING_No).Send_Syuka_QTY Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, Tanaban, ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_OSAKA_Proc = False
                                Exit Function
                        End Select
                    
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        
                        If SYUKA_QTY > (SUMI_QTY + MI_QTY) Then
                            Call Err_Send_Proc("出荷数不足", Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKO_HYO_Dec_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                    
                                    
                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                    
                                    
                                    
                                    '出庫処理
                        sts = Syuko_OSAKA_Update_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                    Hinban, _
                                    "", _
                                    Tanaban, _
                                    ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                    0, _
                                    0, _
                                    SYUKA_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).CYU_KBN, _
                                    ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).DEN_NO, _
                                    ID_KANRI_TBL(ING_No).ID_NO, _
                                    MENU_NO, _
                                    ID_KANRI_TBL(ING_No).BIN_NO)
                        Select Case sts
                            Case False
                            Case SYS_CANCEL
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "他端末で使用中", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "他端末で使用中", "", "")  '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_HYO_Dec_OSAKA_Proc = False
                                GoTo Abort_Tran
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                        End Select
    
                                        'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                                        
                                        
                        '出荷予定／在庫の予約解除
                        sts = Data_Clear_Proc(0, Sendbuf)
                        Select Case sts
                            Case SYS_CANCEL
                                Call Err_Send_Proc("データ使用中", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                        
                                        '次の作業要求
                                        
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                           '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
            
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
    End Select
    SYUKO_HYO_Dec_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function



Public Function HINBAN_CHECK_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『品番ﾁｪｯｸ処理』
'       2010.09.10
'       '2016.12.08
'-------------------------------------------------------
Dim sts             As Integer



'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim i               As Integer


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim MENU_NO         As String * 2

Dim Out_Moji        As String           '2012.03.29

Dim IN_HINBAN       As String * 20      '2016.07.13




    HINBAN_CHECK_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
    
    
    
    
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        IN_HINBAN = ID_KANRI_TBL(ING_No).Recv_text(i)       '2016.07.13
                        
'                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)         '2016.07.13
                        sts = Item_Read3_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)         '2016.07.13 2016.12.08
'>>>>>>>>>> 2016.12.08
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            
                            
                                sts = Item_Read3_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , , 1)   '2016.12.08
                                Select Case sts
                                    Case BtNoErr
                            
                                    Case BtErrKeyNotFound
                                    '   -------------------------------- エラーメッセージ作成
        '                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")          '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                            
                                        
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        HINBAN_CHECK_PROC = False
                                        Exit Function
                                
                                    Case Else
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                        Exit Function
                        
                                End Select
                            
                            
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        
                        
                        
                        
    
'>>>>>>>>>> 2016.12.08
    
                        
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).IN_HINBAN = IN_HINBAN      '2016.07.13
                        '2012.03.19
                        Call Moji_Cut_Proc(StrConv(ITEMREC.HIN_NAME, vbUnicode), Out_Moji, 20)
                        'ID_KANRI_TBL(ING_No).HIN_NAME = StrConv(ITEMREC.HIN_NAME, vbUnicode)
                        ID_KANRI_TBL(ING_No).HIN_NAME = Out_Moji
                        '2012.03.19
                        ID_KANRI_TBL(ING_No).LABEL_CNT = 1
                        ID_KANRI_TBL(ING_No).GENPIN_CNT = 0
                        
                        ID_KANRI_TBL(ING_No).RET_JGYOBU = RET_JGYOBU    '2016.12.08
                        ID_KANRI_TBL(ING_No).RET_NAIGAI = RET_NAIGAI    '2016.12.08
                        
                                    
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        '2010.09.15
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        '2010.09.15
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)                          '2016.07.13
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)     '2016.07.13
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).IN_HINBAN)                        '2016.07.13
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).IN_HINBAN)   '2016.07.13
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).Hinban, 13) & _
'                                                                                Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                                                                                
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).IN_HINBAN, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(ID_KANRI_TBL(ING_No).IN_HINBAN, 16) & _
                                                                                Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        '2010.12.07
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        '2010.12.07
'                        Send_Text.Box_Type(3).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                        '2010.12.07
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（ラベル品番）
            For i = 0 To M_Gyo - 1
            
                
'                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Select Case i
                
                    Case 0
                
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        IN_HINBAN = ID_KANRI_TBL(ING_No).Recv_text(i)       '2016.07.13
                
                        If Trim(Hinban) = Ent_Para Then
                        
                        
            '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                Exit Function
                            End If
                            
                            
                            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                        
                            Else
                                        
                                MENU_NO = ""
                            End If
                            
                            If Trim(MENU_NO) = "" Then
                            Else
                            '作業ﾛｸﾞ出力
                                
                                '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2016.12.08
                                'If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                '                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                '                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                '                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                '                                    MENU_NO, _
                                '                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                '                                     ID_KANRI_TBL(ING_No).Hinban, , , , , , , , , _
                                '                                     , Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "000")) Then
                                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                                    ID_KANRI_TBL(ING_No).RET_JGYOBU, _
                                                                    ID_KANRI_TBL(ING_No).RET_NAIGAI, _
                                                                    MENU_NO, _
                                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                                     ID_KANRI_TBL(ING_No).Hinban, , , , , , , , , _
                                                                     , Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "000")) Then
                                    
                                '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2016.12.08
                                    
                                    
                                    HINBAN_CHECK_PROC = SYS_ERR
                                    GoTo Abort_Tran
                                End If
                            End If
                                        
                                                        'トランザクション終了
                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                            End If
                            '次の作業要求
                            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                            Select Case sts
                                Case BtNoErr
                                '   -------------------------------- エラーメッセージ作成
                                Case Else
                                '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                            End Select
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                            
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                        
                            Sendbuf = Text_Create_Proc()
                        
                        
                            HINBAN_CHECK_PROC = False
    
                            Exit Function
                        
                        End If

                
                
                    '品番
                    Case 3
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        IN_HINBAN = ID_KANRI_TBL(ING_No).Recv_text(i)       '2016.07.13
                        
                                    
                        
                        
'                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)     '2016.07.13
                        sts = Item_Read3_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)     '2016.07.13 2016.12.08
                        
                        
                        
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                        
                            
                                sts = Item_Read3_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , , 1)  '2016.12.08
                                Select Case sts
                                    Case BtNoErr
                            
                                    Case BtErrKeyNotFound
                                
                                    Case Else
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                        Exit Function
                        
                                End Select
                            
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        
                        
                        
                        
                        
'                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then          '2016.07.13
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then        '2016.07.13
                        
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                    
                            Send_Text.buzzer = Buzzer_DOUBLE                        'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                    
                                                                                    
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)                          '2016.07.13
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)     '2016.07.13
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).IN_HINBAN)                        '2016.07.13
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).IN_HINBAN)   '2016.07.13
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            '2010.12.07
'                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban & "    ｴﾗｰ")
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban & "    ｴﾗｰ")
                                                                                    
'                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & " ｴﾗｰ")                        '2016.07.13
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & " ｴﾗｰ")   '2016.07.13
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(IN_HINBAN, 16) & " ｴﾗｰ")                      '2016.07.13
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(IN_HINBAN, 16) & " ｴﾗｰ") '2016.07.13
                            '2010.12.07
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
                            
                            HINBAN_CHECK_PROC = False
    
                            Exit Function
                        
                        
                        End If
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        ID_KANRI_TBL(ING_No).RET_JGYOBU = RET_JGYOBU    '2016.12.08
                        ID_KANRI_TBL(ING_No).RET_NAIGAI = RET_NAIGAI    '2016.12.08
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)                          '2016.07.13
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)     '2016.07.13
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).IN_HINBAN)                        '2016.07.13
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).IN_HINBAN)   '2016.07.13
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).HIN_NAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                        
                        ID_KANRI_TBL(ING_No).LABEL_CNT = ID_KANRI_TBL(ING_No).LABEL_CNT + 1
                        '2010.12.07
'                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban & Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban & _
'                                                                                Space(7 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                                                                                
                                                                                
'>>>>>>>>>> 2016.07.13　入力品番を表示
'                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
'                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
'                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(Hinban, 16) & _
'                                                                                Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Left(IN_HINBAN, 16) & Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & _
                                                                                Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Left(IN_HINBAN, 16) & _
                                                                                Space(4 - Len(Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))) & Format(ID_KANRI_TBL(ING_No).LABEL_CNT, "#0"))
'>>>>>>>>>> 2016.07.13　入力品番を表示
                        
                        
                        
                        '2010.12.07
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        '2010.12.08
'                        Send_Text.Box_Type(3).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                        '2010.12.08
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        
    End Select
            
    HINBAN_CHECK_PROC = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function


Public Function Inspe_Proc_DEN_ALL(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（宅配伝票読み込み 大阪ＰＣ向け）』
'
'       2006.12.07
'
'全数検品対応    2012.03.21
'
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07


Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Long

Dim SAI_SU          As Double

Dim UNSOU_KAISHA    As String
 
Dim SYUKA_YMD       As String
Dim JYUSHO          As String
Dim BIKOU           As String

Dim SURYO           As String

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag

Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim OKURISAKI_CD    As String * 9           '2015.10.21

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean

'2010.01.21
Dim KONPOU_ON           As Integer




Dim KONPOU_ON_SUMI      As Integer
Dim KONPOU_OFF          As Integer
Dim KONPOU_OFF_SUMI     As Integer



Dim PRINT_OFF           As Boolean
Dim Start_Page_No       As Long
Dim PRINT_TOTAL_SU      As Long
Dim PRINT_MAISU         As Long
Dim FileName            As String
Dim ID_SEQ              As Integer
Dim DISP_SAI_SU         As Double

Dim wkKUTI_SU           As String
Dim wkKONPO_F           As String * 1

Dim TOTAL_KUTI_SU       As Integer
Dim TOTAL_SAI_SU        As Double
Dim MUKE_NAME           As String
Dim OKURI_NO_MAX        As Integer
Dim KUTI_SU_INPUT_F     As Boolean

Dim KEN_TEL_NO          As String * 20

Dim KEN_TYAKUTEN        As String * 3       '2017.04.06

Dim OKURI_NO_F          As Boolean
'2010.01.21


Dim FUKUYAMA_CHK_F      As Boolean

Dim Cnt_F               As Boolean
Dim Print_bara_F        As Boolean
Dim Hin_Total           As Long             '2012.04.07

Dim KEN_HINBAN          As String * 20      '2012.10.02

    Inspe_Proc_DEN_ALL = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                        '2012.10.02　KEN_HINBAN追加 2015.10.21　OKURISAKI_CD追加 2017.04.06 KEN_TYAKUTEN 追加
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, _
                                                SYUKA_YMD, _
                                                JYUSHO, _
                                                BIKOU, _
                                                Start_Page_No, _
                                                KUTI_SU, _
                                                MUKE_NAME, _
                                                OKURI_NO_MAX, , , _
                                                KEN_TEL_NO, _
                                                KEN_HINBAN, _
                                                OKURISAKI_CD, _
                                                KEN_TYAKUTEN)
                        
                        
                        '他端末で使用中 2011.04.07
                        If sts = SYS_CANCEL Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")           '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                        '他端末で使用中 2011.04.07
                                
                        
                        
                        
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                                                    
                            Next j
                                                     
                                                     
                            If CANCEL_F Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "キャンセル伝票です。", "", "")     '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "キャンセル伝票です。", "", "") '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        End If
                        
                        
                        If Y_SYU_CNT = 0 Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                                                 
                        If Sumi_CNT = Y_SYU_CNT And Start_Page_No <> 0 Then
                            
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品処理済！", "", "")     '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "検品処理済！", "", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        
                        End If
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = Y_SYU_TBL(j).KONPOU_F        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_CND = Y_SYU_TBL(j).KONPOU_CND    '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).TOTAL_SU = Y_SYU_TBL(j).TOTAL_SU        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = Y_SYU_TBL(j).SAI_SU            '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = Y_SYU_TBL(j).KUTI_SU          '2010.01.21
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = Y_SYU_TBL(j).PRINT_SUMI    '2010.01.21
                        
                                                                                                        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ = Y_SYU_TBL(j).OKURI_NO_SEQ
                        
                        
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = Y_SYU_TBL(j).CNT_BARA_SU      '検品実績　バラ
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = Y_SYU_TBL(j).CNT_HAKO_SU      '検品実績　箱
                            
                
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = Y_SYU_TBL(j).Y_HIN_CHK_CNT  '品番読込み回数
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = Y_SYU_TBL(j).J_HIN_CHK_CNT  '品番読込み済み回数

                        
                        
                        
'2012.11.15                            ID_KANRI_TBL(ING_No).KEN_HINBAN = KEN_HINBAN
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                        
                        
                        
                        
                        
                        
                        
                        Next j
                        
                        '送り状
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        '送り先CD   2015.10.21
                        ID_KANRI_TBL(ING_No).KEN_OKURISAKI_CD = OKURISAKI_CD
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        '出荷日
                        ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = SYUKA_YMD
                        '住所
                        ID_KANRI_TBL(ING_No).KEN_JYUSHO = JYUSHO
                        
                        '備考
                        ID_KANRI_TBL(ING_No).KEN_BIKOU = BIKOU
                        '向け先
                        ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = MUKE_NAME
                        
                        '枝番
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO_MAX = OKURI_NO_MAX
                        '電話番号
                        ID_KANRI_TBL(ING_No).KEN_TEL_NO = KEN_TEL_NO
                        '着店コード
                        ID_KANRI_TBL(ING_No).KEN_TYAKUTEN = KEN_TYAKUTEN    '2017.04.06
                        
                        
                        '検品ﾊﾟﾀｰﾝ  2012.03.31
                        ID_KANRI_TBL(ING_No).KEN_TYPE = ""
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                '2012.11.15
                        ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = KEN_HINBAN    '2012.11.15
                        
                        'ﾗﾍﾞﾙ開始ページ
                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                        
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                        
                    
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        
                        
                        
                        End If
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                        
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                        If KONPOU_ON <> 0 Then
                            If KONPOU_ON = KONPOU_ON_SUMI Then
                                                    
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                                    
                            End If
                        End If
                        
                        
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            '-----------------------------------------------ヘッダ
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
'                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
'                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
'                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
'                            Send_Text.Box_Type(4).INIT = ""
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
'                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
'                             Send_Text.Box_Type(4).Max_Size = "00"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
'                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
    
    
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                
                
                
                        Else
                
                
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                                                                                    'BOX属性
                                                                                    
                                                                                    
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
        
    ''' 品番単位での丸め処理
KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI          '2011.03.17
                            
                            
Select Case KONPOU_ON                           '2011.03.17
                    
''''''''''''Select Case (KONPOU_ON - KONPOU_ON_SUMI)     '2011.03.17
                            
                                Case 0
                                '集合梱包なし
                                
                                    
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                        If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                        
                                        
                                        
                                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                            
                                            '-----------------------------------------------ヘッダー
                                            Call Wel_Head_Text_Proc
                                            '-----------------------------------------------１行目
                                            Call Wel_DETAIL_0_Text_Proc
                                            '-----------------------------------------------２行目
                                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                            '-----------------------------------------------３行目
                                                                                                    'BOX属性
'2012.11.15                                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                                    '表示内容
'2012.11.15
'2012.11.15                                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                                    '数値初期表示
'2012.11.15                                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                                    '初期カーソル位置
'2012.11.15                                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                                    '入力桁数
'2012.11.15                                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        
                                        
                                        
                                            '2012.11.15
                                            Call Wel_OKURI_SAKI_PROC
                                        
                                            TOTAL_KUTI_SU = 1
                                            KUTI_SU_INPUT_F = True
                                            TOTAL_SAI_SU = 0#
                                                
                                                
                                                
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                            End If
                                                
                                                
                                    
                                            Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                            ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                            ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                            ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                                    
                                    
                                            Sendbuf = Text_Create_Proc()
                                        
                                            Inspe_Proc_DEN_ALL = False
                                            Exit Function
                                        
                                        
                                        End If
                                    End If
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    
                                    
                                    
                                    '-----------------------------------------------ボディ
                                    Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
            
                                    Sendbuf = Text_Create_Proc()
                                Case Else
                                '集合梱包あり
                                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                            
                                    '-----------------------------------------------２行目
                                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                    '-----------------------------------------------３行目
                                                                                            'BOX属性
'2012.11.15                                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                            '表示内容
'2012.11.15
'2012.11.15                                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                            '数値初期表示
'2012.11.15                                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                            '初期カーソル位置
'2012.11.15                                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                            '入力桁数
'2012.11.15                                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    
                                    '2012.11.15
                                    Call Wel_OKURI_SAKI_PROC
                                    '-----------------------------------------------４行目
                                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                            '表示内容
                                                                                        '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = "01"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                            '入力桁数
                                    Send_Text.Box_Type(3).Max_Size = "13"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------５行目
                                    Call Wel_Clear_Text_Proc
            
                                    Sendbuf = Text_Create_Proc()
                            
                            End Select
                        End If
                
                
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状ａj
                
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else
'2009.10.14                         If Len(OKURI_NO) < 11 Or Len(OKURI_NO) > 13 Then
'                            If Len(OKURI_NO) < 10 Or Len(OKURI_NO) > 13 Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
'
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                Inspe_Proc_DEN = False
'                                Exit Function
'                            End If
                        
                            If Not IsNumeric(OKURI_NO) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状ｃGラー", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状ｃGラー", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        
                        
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            
                            
                            
                            
                            If Not OKURI_NO_F Then
                            
                        
                        
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状ｃGラー", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状ｃGラー", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                                                
                            End If
                        
                        
                        
                            '2017.04.28
                            If FUKUYAMA_CHK_F Then
                            
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")    '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            
                            End If
                            '2017.04.28
                        
                        
                        
                        
                        
                        
                        
                        End If
                    
                        '送り状
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")    '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")     '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "") '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2107.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                                    
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                                
                                                    
                                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                    
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_DEN_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
                                                                                'BOX属性
                                                                                
                                                                                
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI              '2011.03.17
        
    ''' 品番単位での丸め処理
Select Case KONPOU_ON                               '2011.03.17
'''''Select Case (KONPOU_ON - KONPOU_ON_SUMI)     '2011.03.17



                        
                            Case 0
                            '集合梱包なし
                            
                                
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                    
                                    
                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                        
                                        '-----------------------------------------------ヘッダー
                                        Call Wel_Head_Text_Proc
                                        '-----------------------------------------------１行目
                                        Call Wel_DETAIL_0_Text_Proc
                                        '-----------------------------------------------２行目
                                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                        '-----------------------------------------------３行目
                                                                                                'BOX属性
'2012.11.15                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                                '表示内容
'2012.11.15
'2012.11.15                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                                '数値初期表示
'2012.11.15                                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                                '初期カーソル位置
'2012.11.15                                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                                '入力桁数
'2012.11.15                                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    
                                        '2012.11.15
                                        Call Wel_OKURI_SAKI_PROC
                                    
                                    
                                    
                                        TOTAL_KUTI_SU = 1
                                        KUTI_SU_INPUT_F = True
                                        TOTAL_SAI_SU = 0#
                                            
                                            
                                            
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                        End If
                                            
                                            
                                
                                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                        ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                                
                                
                                        Sendbuf = Text_Create_Proc()
                                    
                                        Inspe_Proc_DEN_ALL = False
                                        Exit Function
                                    
                                    
                                    End If
                                End If
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                
                                
                                
                                '-----------------------------------------------ボディ
                                Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
        
                                Sendbuf = Text_Create_Proc()
                            Case Else
                            '集合梱包あり
                        
                        
                                '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント 2011.03.04
                                Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
'2012.11.15                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                        '表示内容
'2012.11.15
'2012.11.15                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                                Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                                Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                                Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '2012.11.15
                                Call Wel_OKURI_SAKI_PROC
                                '-----------------------------------------------４行目
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                        '表示内容
                                                                                    '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                        '入力桁数
                                '2010.12.07
'                                Send_Text.Box_Type(3).Max_Size = "13"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                Send_Text.Box_Type(3).Max_Size = "20"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                '2010.12.07
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                        
                        End Select
                    End Select
                Next i
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            Cnt_F = False
            For i = 0 To M_Gyo - 1
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban, "出荷"    '品番/出荷数（品番）
                        If Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = "出荷" Then
                            Cnt_F = True
                        Else
                            ID_KANRI_TBL(ING_No).LAST_START_PAGE = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1 '2012.04.01
                        End If
                        
                        
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")      '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                '集合梱包有り時の品番チェック
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")  '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")  '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                        
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND <> "1" Then
                        
                            If KONPOU_ON <> KONPOU_ON_SUMI Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
                            
                            
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")      '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")  '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    Exit Function
                            
                                End If
                            End If
                        
                        End If
                        'ｷｬﾝｾﾙのﾁｪｯｸ
                        CANCEL_F = True
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            End If
                        Next j
                        
                        If CANCEL_F Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "キャンセル品番です。", "")        '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "キャンセル品番です。", "")    '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        
                        
                        End If
                        
                        
                        
                                
                        '検品済みのﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "検品済み！", "")      '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "検品済み！", "")  '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                
                        '未出庫のﾁｪｯｸ   2007.05.14
                        If Inspection_Flg = 0 Then
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KAN_KBN <> KAN_KBN_FIN Then
                                        Exit For
                                    End If
                                End If
                            Next k
                                            
                            If k <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")    '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        End If
                        '未出庫のﾁｪｯｸ   2007.05.14
                        
                        
                        '仕掛中品番のﾁｪｯｸ   2012.10.02-->2012.11.15 KEN_HINBAN-->KEN_ING_HINBAN
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) Then
                            If Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) <> "" Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "他品番検品中！", ID_KANRI_TBL(ING_No).KEN_ING_HINBAN)     '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "他品番検品中！", ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        End If
                        '仕掛中品番のﾁｪｯｸ   2012.10.02
                        
                        If Cnt_F Then
                        
                            If RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) <> RTrim(Hinban) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")         '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")     '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        End If
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                        
                        
If Trim(Hinban) = "AD-AF100-4SH" Then
    Debug.Print
End If
                        
                        Print_bara_F = False
                
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1
                            End If
                        
                                        
                            '2012.04.07
                            Hin_Total = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If ID_KANRI_TBL(ING_No).KEN_HINBAN = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then                '2012.09.05
                                        Hin_Total = Hin_Total + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If                                                                  '2012.09.05
                                End If
                            Next k
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)) + _
                            '                                                            (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO - _
                            '                                                            ((CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY)
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)) + _
                                                                                        (Hin_Total - _
                                                                                        ((CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY)
                            '2012.04.07
                            
                            
                            
                            Print_bara_F = False
'>>>>>>>>>>>>>  2013.02.03
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1 Then
'                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1 Or _
'                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY > Hin_Total Then
'>>>>>>>>>>>>>  2013.02.03
                                'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO   2012.04.09
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = Hin_Total                                    '2012.04.09
                                Print_bara_F = True
                            Else
                                'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = CLng(ToRoundUp(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO Mod ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0))
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = CLng(ToRoundUp(CCur(Hin_Total Mod ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0))    '2012.04.09
                            End If
                            
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            '
                            'If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 1
                            'Else
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            'End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                        
                        
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                                Print_bara_F = True     '2013.02.03
                            
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                        
                        
                        End If
                        
                        
                        If Cnt_F Then
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                                Print_bara_F = True
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                        
                        
                        End If
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02
                        '----------------------------------- トランザクション開始 -----------
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If


                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
'2012.10.02                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
'2012.10.02
'2012.10.02                                '------------------------------------   出荷予定の処理
'2012.10.02                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
'2012.10.02
'2012.10.02
'2012.10.02                                Do
'2012.10.02
'2012.10.02                                    sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.01.02                                    Select Case sts
'2012.01.02                                        Case BtNoErr
'2012.01.02                                            Exit Do
'2012.01.02                                        Case BtErrKeyNotFound
'2012.01.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
'2012.01.02                                            Sendbuf = Text_Create_Proc()
'2012.01.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.01.02                                            Inspe_Proc_DEN_ALL = False
'2012.01.02                                            GoTo Abort_Tran
'2012.01.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.01.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.01.02                                            Sendbuf = Text_Create_Proc()
'2012.01.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.01.02                                            Inspe_Proc_DEN_ALL = False
'2012.01.02                                            GoTo Abort_Tran
'2012.01.02                                        Case Else
'2012.01.02                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
'2012.01.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.01.02                                            Sendbuf = Text_Create_Proc()
'2012.01.02                                            GoTo Abort_Tran
'2012.01.02                                    End Select
'2012.01.02
'2012.01.02                                Loop
'2012.01.02
'2012.01.02
'2012.01.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
'2012.01.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
'2012.01.02
'2012.01.02                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))
'2012.01.02
'2012.01.02                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
'2012.01.02                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
'2012.01.02
'2012.01.02
'2012.01.02
'2012.01.02                                Do
'2012.01.02
'2012.01.02                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.01.02                                    Select Case sts
'2012.01.02                                        Case BtNoErr
'2012.01.02                                            Exit Do
'2012.01.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.01.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.01.02                                            Sendbuf = Text_Create_Proc()
'2012.01.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.01.02                                            Inspe_Proc_DEN_ALL = False
'2012.01.02                                            GoTo Abort_Tran
'2012.01.02                                        Case Else
'2012.01.02                                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
'2012.01.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.01.02                                            Sendbuf = Text_Create_Proc()
'2012.01.02                                            GoTo Abort_Tran
'2012.01.02                                    End Select
'2012.01.02
'2012.01.02                                Loop
'2012.01.02
'2012.01.02
'2012.01.02
'2012.01.02                            End If
                            '------------------------------------   出荷予定の処理  2012.10.02
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
                
                
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")     '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "") '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")    '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
    

                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
    
                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))

                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
                            End If
                        
                            Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, ID_KANRI_TBL(ING_No).KEN_HINBAN)


                            Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                            Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10


                        
                            Do
                            
                                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                        
                        '------------------------------------   出荷予定の処理  2012.10.02
                        
                        Next k
                        
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            Exit Function
                        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 荷札発行処理    2012.03.30
                        PRINT_OFF = False
    
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
                            PRINT_OFF = True
                        Else
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
                            
''                                If KONPOU_ON = KONPOU_ON_SUMI Then
        
                                    PRINT_OFF = True

''                                End If
        
                            End If
                        End If
                        
                        If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                            ID_KANRI_TBL(ING_No).LABEL_ON = False
                        Else
                                    
                            PRINT_OFF = False
                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
                                If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                    
                                    For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                
                                        If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                            
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                                '枝番更新   2010.02.15
                                                Start_Page_No = 1
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01                                                End If
                                                
                                                PRINT_OFF = True
                                            End If
                                        
                                        
                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KONPOU_F <> "1" Then
                                                
                            
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                    End If
                                                
                                                
                                                
                                                End If
                                                                    
                                            End If
                                        
                                        
                                        
                                        
                                        
                                        End If
                                    Next k
                                End If
                            End If
                            
                            If Not PRINT_OFF Then
                            
                                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
                                '2010.06.16
                                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                '2010.06.16
                                Select Case sts
                                    Case BtNoErr
                                    
                                        If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                        
                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                        
                                        End If
                                    
                                    Case BtErrKeyNotFound
                                    
                                        Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                    
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                                
                                '>>>>>>>>>>>>>>>>>>>>   2013.02.03 プリント枚数は口数をセット
                                If Print_bara_F Then
                                    PRINT_MAISU = Val(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                Else
                                    PRINT_MAISU = Val(StrConv(ITEMREC.KUTI_SU, vbUnicode)) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                                End If
                                '>>>>>>>>>>>>>>>>>>>>   2013.02.03
                                                        
                                Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
                                                        
                                PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                
                                If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
                                    PRINT_MAISU = PRINT_MAISU - 1
                                    If PRINT_MAISU < 1 Then
                                        
                                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                    
                                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                            
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                
                                                '枝番更新   2010.02.15
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                    End If
                                                
                                                
                                                '枝番更新   2010.02.15
                                
                                
                                
                                                End If
                                            
                                            
                                            
                                            
                                            
                                            
                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KONPOU_F <> "1" Then
                                                    
                                
'2012.04.01                                                        If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01                                                        End If
                                                        
                                                
                                                    
                                                    End If
                                                                        
                                                End If
                                            
                                            
                                            
                                            
                                            
                                            
                                            End If
                                        Next k
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                        PRINT_OFF = True
                                    Else
    '                                    PRINT_MAISU = PRINT_MAISU - 1
                                        Start_Page_No = Start_Page_No + 1
                                    End If
                                End If
                            End If
                            
                            If Not PRINT_OFF Then
                            
                                ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                
                                Y_SYU_CNT = 0
                                SYUKA_QTY = 0
                                For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                        
                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                        
                                            Y_SYU_CNT = Y_SYU_CNT + 1
                                            SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                        
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).PRINT_SUMI Then
                                                PRINT_OFF = True
                                            Else
                                        
'                                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).PRINT_SUMI = True
                                            
                                            End If
                                        
                                        End If
                                    End If
                                Next k
                            End If
                            
                            If Not PRINT_OFF Then
                                
                                ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01
                                
                                If Label_File_Make_Proc(FileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                End If
                                '枝番更新   2010.02.15
                                For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                                    If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                    
                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
'2012.04.01                                            If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                GoTo Abort_Tran
'2012.04.01                                           End If
                                        End If
                                    
                                    Else
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KONPOU_F <> "1" Then
                                            
                        
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU, "000")) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01                                                End If
                                            
                                            
                                            End If
                                                                
                                        End If
                                    
                                    
                                    
                                    
                                    
                                    
                                    
                                    End If
                                Next k
                                '枝番更新   2010.02.15
                                
                                
                                
                                
                                
                                If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                Else
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                End If
                                
                                'データ送信
                                                            
                                ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                            
                                ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                            
                                ID_KANRI_TBL(ING_No).LABEL_ON = True
                            
                                '-----------------------------------------------ヘッダー
                        
                                Call Wel_Head_Print_Text_Proc(FileName)
                            
                                
                                
                                Sendbuf = Text_Create_Proc()
                                
                            
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            
                            End If
                        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 荷札発行処理    2012.03.30
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT Then
                
                
                
                
                
                
                
                
                
                
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                            
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            If Inspection_QTY = 1 Then
    
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            Else
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                            End If
                            
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                    
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If
                                End If
                            Next k
                                                                                    '表示内容
                            
                            If Y_SYU_CNT < 2 Then
    
'                                If Inspection_QTY = 1 Then
    
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
'                                End If
                                                                                    
                            Else
                            
'                                If Inspection_QTY = 1 Then
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                            End If
                                                                                    
                                                                                    '数値初期表示
                            If Inspection_QTY = 1 Then
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                            Else
                                Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                            End If
                                                                                    '初期カーソル位置
                            If Inspection_QTY = 1 Then
    
                                Send_Text.Box_Type(4).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                            Else
                                Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                            End If
                                                                                    
                                                                                    '入力桁数
                            If Inspection_QTY = 1 Then
                                Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                            Else
                                Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                            End If
                                                                                    
                                                                                    
                            '2009.04.15
                            If SYUKA_QTY > 1 Then
                                Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                            End If
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            Sendbuf = Text_Create_Proc()
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                
                
                        Else
                
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                            
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                            Else
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCANK                             '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK        '2007.04.21
'                            End If
                            
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then            '2012.09.05 j-->k
                                    
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If
                                End If
                            Next k
                                                                                    '表示内容
                            
                            If Y_SYU_CNT < 2 Then
    
 '                               If Inspection_QTY = 1 Then
    
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
 '                               Else
 '                                   Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
 '                                   Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
 '                               End If
                                                                                    
                            Else

'                                If Inspection_QTY = 1 Then
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                            End If
                                                                                    
                                                                                    '数値初期表示
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                            Else
                                Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
'                            End If
                                                                                    '初期カーソル位置
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Start_Pos = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                            Else
                                Send_Text.Box_Type(4).Start_Pos = "01"                                              '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"                         '2007.04.21
'                            End If
                                                                                    
                                                                                    '入力桁数
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).Max_Size = "00"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'                            Else
                                Send_Text.Box_Type(4).Max_Size = "20"                                               '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"                          '2007.04.21
'                            End If
                                                                                    
                                                                                    
                            '2009.04.15
                            If SYUKA_QTY > 1 Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then       '2012.04.09
                                Else
                                    Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                                End If                  '2012.04.09
                            
                            Else                                            '2012.11.15
                                ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""    '2012.11.15
                            End If
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            Sendbuf = Text_Create_Proc()
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                
                
                End Select
            
            Next i
'''''''''''''''''''''''''''''''
    
    
        Case Step_Sagyo4_RES        '４回目の受信（検品数　受信）
            
            For i = 0 To M_Gyo - 1
                
                    
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 10))
                    
                    Case LCD_Syuka_Su1, LCD_Syuka_Su2, "出荷数："  '出荷数(検品数)
                        
                        SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        If Not IsNumeric(SURYO) Then
                        
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        
                        End If
                
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                
                        If CLng(SURYO) <> SYUKA_QTY Then
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷数エラー", "", "")       '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷数エラー", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_DEN_ALL = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
            
            ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""        '2012.11.15
                        
            
            Y_SYU_CNT = 0
            SYUKA_QTY = 0
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                    
                        Y_SYU_CNT = Y_SYU_CNT + 1
                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                    End If
                End If
            Next j
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        '------------------------------------   出荷予定の処理
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                                 Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
        
                    '''他行の使用を継続するため
                    '''Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                    '''Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                        Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                    '出荷予定書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    
                                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                    Inspe_Proc_DEN_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                        
                        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                                            
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                        Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                                    
                                                    
                        Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
'2012.10.31                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                                    
                                                    
                                                    
                        Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                        Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                    
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_DEN_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Inspe_Proc_DEN_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                                            
                                            
                        '------------------------------------   在庫移動履歴の処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                            MENU_NO = ""
                        End If
                                            
                        '履歴出力の為の読み込み
                        Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                        Call UniCode_Conv(K0_MTS.SS_CODE, "")
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                                Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                            
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    CYU_KBN_SPO, _
                                                    Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                                    , , , , MENU_NO, _
                                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_DEN_ALL = SYS_ERR
                                GoTo Abort_Tran
                        End Select
                                            
                        '検品済！！
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = True
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
                                        
                    End If
                
                
                '--------------------   2012.10.02  ▽
                Else
                
                    Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID
    
                    Do
                    
                        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrKeyNotFound
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")        '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")    '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                GoTo Abort_Tran
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                GoTo Abort_Tran
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                
                    Loop
                
                
                    Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
'''''''''''''''                    ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                                
                                                
                    Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                    Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                
                                                '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                    Do
                        sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                GoTo Abort_Tran
                        
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Inspe_Proc_DEN_ALL = SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                
                '--------------------   2012.10.02  △
                
                
                End If
            
            Next j
            
            
'2012.11.15            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.31
            
            '作業ﾛｸﾞ出力    2009.04.17
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO) Then
                    Inspe_Proc_DEN_ALL = SYS_ERR
                    Exit Function
                End If
            End If
            '作業ﾛｸﾞ出力    2009.04.17
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
                    
                    
                    
                    
                    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                    
            Select Case ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND
            
            
                Case "1"
                    '集合梱包なし
                
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ


''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
'''' 荷札処置
'                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
'                                ID_KANRI_TBL(ING_No).LABEL_ON = False
'                            Else
'
'                                PRINT_OFF = False
'
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
'                                    If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
'                                        PRINT_OFF = True
'                                    End If
'                                End If
'
'                                If Not PRINT_OFF Then
'
'                                    '2010.06.16
'                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'
'                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                    Select Case sts
'                                        Case BtNoErr
'
'                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            End If
'
'                                        Case BtErrKeyNotFound
'
'
'                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                        Case Else
'                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                            Sendbuf = Text_Create_Proc()
'                                            GoTo Abort_Tran
'                                    End Select
'
'
'                                    '2010.06.16
'
'                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
'                                    Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
'
'                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'                                    'Y_SYU_CNT = 0
'                                    SYUKA_QTY = 0
'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                'Y_SYU_CNT = Y_SYU_CNT + 1
'                                                SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'                                                    PRINT_OFF = True
'                                                Else
'
'                                                   ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
'
'                                                End If
'
'                                            End If
'                                        End If
'                                    Next j
'                                End If
'
'                                If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
'                                    PRINT_MAISU = PRINT_MAISU - 1
'                                    If PRINT_MAISU < 1 Then
'
'                                    '枝番更新   2010.02.15
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                        GoTo Abort_Tran
'
'                                                    End If
'
'
'                                                End If
'                                            Else
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                            GoTo Abort_Tran
'
'                                                        End If
'
'
'
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
'                                    '枝番更新   2010.02.15
'
'                                        PRINT_OFF = True
'
'                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
'
'
'                                    Else
''                                            PRINT_MAISU = PRINT_MAISU - 1
'                                        Start_Page_No = Start_Page_No + 1
'                                    End If
'                                End If
'
'                                If Not PRINT_OFF Then
'
'                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'                                    '2010.06.16
'                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                    '2010.06.16
'                                    Select Case sts
'                                        Case BtNoErr
'
'                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            End If
'
'                                        Case BtErrKeyNotFound
'
'
'                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                        Case Else
'                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                            Sendbuf = Text_Create_Proc()
'                                            GoTo Abort_Tran
'                                    End Select
'
'
''2010.02.21                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
''2010.02.21                                    Start_Page_No = Start_Page_No + 1
'
''2010.02.21                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'
'                                    If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
'                                    End If
'
'
'
'                                    '枝番更新   2010.02.15
'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And _
'                                                    (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'
'                                                        GoTo Abort_Tran
'                                                    End If
'
'
'                                                Else
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                        GoTo Abort_Tran
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Else
'                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                        GoTo Abort_Tran
'
'                                                    End If
'
'
'
'                                                End If
'
'
'
'                                            End If
'                                        End If
'                                    Next j
'                                    'データ送信
'
'                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'
'                                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
'
'                                    ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU - 1
'                                    '-----------------------------------------------ヘッダー
'
'                                    Call Wel_Head_Print_Text_Proc(fileName)
'
'                                    Sendbuf = Text_Create_Proc()
'
'
'                                    Inspe_Proc_DEN_ALL = False
'                                    Exit Function
'                                End If
'
'                            End If
'''' 荷札処置
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
'                            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 1
                    
                            ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""        '2012.11.15
                    
                    
                        Case True
                            '残なし　口数へ
                    
                    
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
'''' 荷札処置
'                                PRINT_OFF = False
'
'                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
'                                    PRINT_OFF = True
'                                Else
'                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
'
'                                        If KONPOU_ON = KONPOU_ON_SUMI Then
'
'                                            PRINT_OFF = True
'
'                                        End If
'
'                                    End If
'                                End If
'
'                                If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
'                                    ID_KANRI_TBL(ING_No).LABEL_ON = False
'                                Else
'
'            '                        Y_SYU_CNT = 0
'            '                        SYUKA_QTY = 0
'
'                                    PRINT_OFF = False
'
'                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
'                                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
'
'                                                        '枝番更新   2010.02.15
'                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'                                                    Start_Page_No = 1
'                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'
'
'
'                                                        '枝番更新   2010.02.15
'
'                                                        PRINT_OFF = True
'
'                                                    End If
'
'                                                Else
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                GoTo Abort_Tran
'
'                                                            End If
'
'
'                                                        End If
'
'                                                    End If
'                                                End If
'                                            Next j
'                                        End If
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                        Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'                                        '2010.06.16
'                                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                        Select Case sts
'                                            Case BtNoErr
'
'                                                If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'                                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                                End If
'
'                                            Case BtErrKeyNotFound
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            Case Else
'                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                                Sendbuf = Text_Create_Proc()
'                                                GoTo Abort_Tran
'                                        End Select
'
'                                        PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
'                                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
'
'                                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'                                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
'                                            PRINT_MAISU = PRINT_MAISU - 1
'
'
'
'                                            If PRINT_MAISU < 1 Then
'
'                                                        '枝番更新   2010.02.15
'                                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                GoTo Abort_Tran
'                                                            End If
'
'                                                        End If
'
'
'
'                                                    Else
'                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                    GoTo Abort_Tran
'                                                                End If
'
'
'
'                                                            End If
'
'                                                        End If
'
'
'
'                                                    End If
'                                                Next j
'                                                        '枝番更新   2010.02.15
'
'                                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
'
'                                                PRINT_OFF = True
'                                            Else
'            '                                    PRINT_MAISU = PRINT_MAISU - 1
'                                                Start_Page_No = Start_Page_No + 1
'                                            End If
'                                        End If
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'                                        Y_SYU_CNT = 0
'                                        SYUKA_QTY = 0
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                    Y_SYU_CNT = Y_SYU_CNT + 1
'                                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'                                                        PRINT_OFF = True
'                                                    Else
'
'                                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
'
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
'                                        End If
'
'
'
'
'
'                                                        '枝番更新   2010.02.15
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'                                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And Start_Page_No = 2 Then
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'                                                    Else
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'                                                    End If
'
'                                                End If
'
'
'
'                                            Else
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'
'                                                    End If
'
'                                                End If
'
'
'
'
'
'                                            End If
'                                        Next j
'                                                        '枝番更新   2010.02.15
'
'
'
'
'                                        If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
'                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
'                                        Else
'                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
'                                        End If
'
'
'                                        'データ送信
'
'                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 2
'
'                                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
'
'                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                        '-----------------------------------------------ヘッダー
'
'                                        Call Wel_Head_Print_Text_Proc(fileName)
'
'                                        Sendbuf = Text_Create_Proc()
'
'
'                                        Inspe_Proc_DEN_ALL = False
'                                        Exit Function
'
'                                    End If
'                                End If
'            ''' 荷札処置
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
'2012.11.15                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                        '表示内容
'2012.11.15
'2012.11.15                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                                Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                                Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                                Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '2012.11.15
                                Call Wel_OKURI_SAKI_PROC
                                '-----------aaa------------------------------------４行目
                                
'口数INPUT １
                                
                                wkKONPO_F = ""
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                    
                                        wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                        Exit For
                                    End If
                                Next j
                                
                                If wkKONPO_F = "1" Then
                                                        
                                    If Inspection_Input Then
                                        KUTI_SU_INPUT_F = False
                                    Else
                                        KUTI_SU_INPUT_F = True
                                    End If
                                
                                
                                    TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                    TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                            
                                Else
                                    TOTAL_KUTI_SU = 1
                                    KUTI_SU_INPUT_F = True
                                    TOTAL_SAI_SU = 0#
                                End If
                                            
                                            
                                            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                            
                                            
                                If KUTI_SU_INPUT_F Then
                                
                                    Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                                
                                Else
                                    Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                
                                    
                                    If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                    
                                    
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                                
        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.10
                                    '----------------------------------- データ更新処理開始 -----------
                                                                    'トランザクション開始
                                    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    If sts <> BtNoErr Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    End If
                                            
                                                                
                                    For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                            '単体梱包１口時
                                            If OKURI_NO_SEQ_Update_Proc(k, Format(1, "000"), Sendbuf, Format(TOTAL_KUTI_SU, "000")) Then
                                                GoTo Abort_Tran
                                            End If
                                            
                                        End If
                                    Next k
                                            
                                                        'トランザクション終了
                                    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    If sts <> BtNoErr Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpEndTransaction, "", 0)
                                        GoTo Abort_Tran
                                    End If
                                            
        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.10
                                
                                
                                
                                
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                                
'                                ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 2
                        
                        End Select
                        
                
                
                Case "2"
                    '集合梱包のみ
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                    
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
'                            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 3
                    
                    
                    
                        Case True
                            '残なし　口数へ
                    
                    
''' 荷札処置
                                PRINT_OFF = False
Debug.Print ID_KANRI_TBL(ING_No).KEN_TYPE
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
                                    PRINT_OFF = True
                                Else
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
                                    
                                        If KONPOU_ON = KONPOU_ON_SUMI Then
                
                                            PRINT_OFF = True
                
                                        End If
                
                                    End If
                                End If
                                
                                If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                    ID_KANRI_TBL(ING_No).LABEL_ON = False
                                Else
                                    
            '                        Y_SYU_CNT = 0
            '                        SYUKA_QTY = 0
                                    
                                    PRINT_OFF = False
                                    
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
                                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                            
                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                    
                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                    
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                                        Start_Page_No = 1
'2012.04.01                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01                                                        End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        PRINT_OFF = True
                                                    End If
                                                
                                                
                                                Else
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                        
                                    
'2012.04.01                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                                GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                            End If
                                                        
                                                        
                                                        
                                                        End If
                                                                            
                                                    End If
                                                
                                                
                                                
                                                
                                                
                                                End If
                                            Next j
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                        Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                        '2010.06.16
                                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                        '2010.06.16
                                        Select Case sts
                                            Case BtNoErr
                                            
                                                If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                                
                                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                                
                                                End If
                                            
                                            Case BtErrKeyNotFound
                                            
                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                                            
                                            Case Else
                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                                Sendbuf = Text_Create_Proc()
                                                GoTo Abort_Tran
                                        End Select
                                        
                                        PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                                                                
                                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
                                                                
                                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                        
                                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
                                            PRINT_MAISU = PRINT_MAISU - 1
                                            If PRINT_MAISU < 1 Then
                                                
                                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                    
                                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                        
                                                        '枝番更新   2010.02.15
'2012.04.01                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                                GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                            End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                                        
                                        
                                        
                                                        End If
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    Else
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                            
                                        
'2012.04.01                                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                                    GoTo Abort_Tran
'2012.04.01                                                                End If
                                                                
                                                        
                                                            
                                                            End If
                                                                                
                                                        End If
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    
                                                    End If
                                                Next j
                                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                                PRINT_OFF = True
                                            Else
            '                                    PRINT_MAISU = PRINT_MAISU - 1
                                                Start_Page_No = Start_Page_No + 1
                                            End If
                                        End If
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                        
                                        Y_SYU_CNT = 0
                                        SYUKA_QTY = 0
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                        
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                                
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                                
                                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                                
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                                        PRINT_OFF = True
                                                    Else
                                                
                                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                                                    
                                                    End If
                                                
                                                End If
                                            End If
                                        Next j
                                    End If
                                    
                                    If Not PRINT_OFF Then
                                        
                                        ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01

                                        
                                        If Label_File_Make_Proc(FileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                        End If
                                        
                                        
                                        
                                        
                                        
                                        '枝番更新   2010.02.15
                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                    
                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                            
                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01                                                    End If
                                                End If
                                            
                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                    
                                
'2012.04.01                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01                                                        End If
                                                    
                                                    
                                                    End If
                                                                        
                                                End If
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            End If
                                        Next j
                                        '枝番更新   2010.02.15
                                        
                                        
                                        
                                        
                                        
                                        If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                        Else
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                        End If
                                        
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                        GoTo Abort_Tran
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
                                        
                                        'データ送信
                                                                    
                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 2
                                                                    
                                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                                    
                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                                    
                                        '-----------------------------------------------ヘッダー
                                
                                        Call Wel_Head_Print_Text_Proc(FileName)
                                    
                                        Sendbuf = Text_Create_Proc()
                                        
'                                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 4
                                    
                                        Inspe_Proc_DEN_ALL = False
                                        Exit Function
                                    
                                    End If
                                End If
            ''' 荷札処置
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
'2012.11.15                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                        '表示内容
'2012.11.15
'2012.11.15                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                                Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                                Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                                Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '2012.11.15
                                Call Wel_OKURI_SAKI_PROC
                                '-----------aaa------------------------------------４行目
                                
'口数INPUT ２
                                wkKONPO_F = ""
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                    
                                        wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                        Exit For
                                    End If
                                Next j
                                
                                If wkKONPO_F = "1" Then
                                                        
                                    If Inspection_Input Then
                                        KUTI_SU_INPUT_F = False
                                    Else
                                        KUTI_SU_INPUT_F = True
                                    End If
                                
                                
                                    TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                    TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                            
                                Else
                                    TOTAL_KUTI_SU = 1
                                    KUTI_SU_INPUT_F = True
                                    TOTAL_SAI_SU = 0#
                                End If
                                            
                                            
                                            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                            
                                            
                                If KUTI_SU_INPUT_F Then
                                
                                    Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                                
                                Else
                                    Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                
                                    If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                
                                
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                                
                                
                                
                                End If
                                
                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 5
            
                        End Select
                    
                Case "3"
                    '混在
            
                    
                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
            
            
                    Select Case (KONPOU_ON - KONPOU_ON_SUMI)
            
                        Case 0
                            '口数へ
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------aaa------------------------------------４行目
'口数input ３
                            wkKONPO_F = ""
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                
                                    wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                    Exit For
                                End If
                            Next j
                            
                            If wkKONPO_F = "1" Then
                                                    
                                If Inspection_Input Then
                                    KUTI_SU_INPUT_F = False
                                Else
                                    KUTI_SU_INPUT_F = True
                                End If
                            
                            
                                TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                        
                            Else
                                TOTAL_KUTI_SU = 1
                                KUTI_SU_INPUT_F = True
                                TOTAL_SAI_SU = 0#
                            End If
                                        
                                        
                                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                            End If
                                        
                                        
                            If KUTI_SU_INPUT_F Then
                            
                                Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                                
                                                        
                            Else
                                Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                            
                                
                                
                                
                                
                                If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                            
                            
                            
                            End If
                        
                        
                            Sendbuf = Text_Create_Proc()
                        
                        
'                            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 6
                        
                        
                        
                        Case Else
                            '品番へ
            
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                                        
                                                                                        '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                            
'                            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 7
                    
                    End Select
            
            End Select
                    
                    
                    
                    
        Case Step_Sagyo5_RES        '５回目の受信（口数）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Left(Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)), 6)
                    '口数
                    Case LCD_KUTI_SU_S
                
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU < 0 Then
                        
                
                
                
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")         '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")     '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            
                            End If
                    
                            KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If KUTI_SU < 1 Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")         '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")     '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        Else
                            KUTI_SU = ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU
                        End If
                    
                    
                    
                    '才数
                    Case LCD_SAI_SU_S
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU < 0 Then
                        
                        
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")         '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")     '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            
                            End If
                    
                            SAI_SU = CDbl(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If SAI_SU <= 0 Then
                                'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")         '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")     '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_DEN_ALL = False
                                Exit Function
                            End If
                        Else
                            SAI_SU = ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU
                        
                        
                            If SAI_SU < 1 Then
                                SAI_SU = 1
                            Else
                                If SAI_SU > 1 Then
                                    SAI_SU = CLng(ToHalfAdjust(CCur(SAI_SU), 0))
                                End If
                            End If
                        
                        End If
                    
                        '送り状最大印刷枚数獲得 2010.01.21
                            
                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                
                                    If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                
                                
                                Else
                                
                                    If Label_Print_Total_Su_Proc(0, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                End If
                            Else                                                                '2013.02.15
                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = "" Then              '2013.02.15
                                    If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then  '2013.02.15
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")  '2013.02.15
                                        Sendbuf = Text_Create_Proc()                            '2013.02.15
                                        Exit Function                                           '2013.02.15
                                    End If                                                      '2013.02.15
                                End If                                                          '2013.02.15
                            
                            End If
                        Next j
                                        
                            
                            
                            
                        
                    
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                            Else
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU <= 1 Then
                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                    End If
                                
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                                
                                End If
                            End If
                        Next j
                        
                        
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")    '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2017.09.22
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_DEN_ALL = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        Inspe_Proc_DEN_ALL = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")     '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "") '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                
                                
                                
                                
                                
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                    'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                    If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                        If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                        End If
                                    Else
'''''''                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                        
                                        
                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                                                            
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                    
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN_SAV, Format(SAI_SU, "00.00"))
                                                    
                                                    
                                Else
                                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                        
                                        'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                        If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                            If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                            Else
                                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                            End If
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                                                                
                                        End If
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                
                                
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN_SAV, Format(SAI_SU, "00.00"))
                                
                                
                                
                                End If
                                                    
                                
                                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                
                                
                                
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_DEN_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j

        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                   
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                
                                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                    'ID
                                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
                
                                Do
                                
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")        '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")    '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")      '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")  '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                            
                                Loop
                                
                                
                                
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")     '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "") '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                                
                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                                    
                                                    
                                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                    
                                                    
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")       '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")   '2017.09.22
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_DEN_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_DEN_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                

''' 品番単位での丸め処理
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
''' 品番単位での丸め処理

                        If ID_KANRI_TBL(ING_No).KEN_TYPE = "1" Then
                            
                            
                            
                            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                            '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            End If
                                    
                                                        
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                    '集合梱包時
                                    If OKURI_NO_SEQ_Update_Proc(k, Format(1, "000"), Sendbuf, Format(KUTI_SU, "000")) Then
                                        GoTo Abort_Tran
                                    End If
                                    
                                End If
                            Next k
                                    
                                                'トランザクション終了
                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                            End If
                                    
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                            
                            ID_KANRI_TBL(ING_No).KEN_TYPE = ""

'2012.03.29

                            If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 0 Then
                                ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                            End If

    
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) Then
                                If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                    PRINT_OFF = True
                                End If
                            End If



                            PRINT_MAISU = KUTI_SU


                            Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
    
                            PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU


                            If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD)) Then
                                PRINT_MAISU = PRINT_MAISU - 1
                                If PRINT_MAISU < 1 Then

                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then


                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then


                                                        '枝番更新   2010.02.15
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01                                                End If


                                                        '枝番更新   2010.02.15

                                            End If
                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                    End If


                                                End If

                                            End If
                                        End If
                                    Next j



                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No




                                    PRINT_OFF = True
                                Else
'                                    PRINT_MAISU = PRINT_MAISU - 1
                                    Start_Page_No = Start_Page_No + 1

                                End If
                            End If

''' 荷札処置
                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                ID_KANRI_TBL(ING_No).LABEL_ON = False
                            Else

'2012.03.30
'                                Y_SYU_CNT = 0
'                                SYUKA_QTY = 0
'
'                                PRINT_OFF = False
'
'                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                            Y_SYU_CNT = Y_SYU_CNT + 1
'                                            SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'
'                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'
'                                                PRINT_OFF = True
'                                            Else
'
'                                            End If
'                                        End If
'                                    End If
'                                Next j
'
'                                If Not PRINT_OFF Then
                                ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01

                                If Label_File_Make_Proc(FileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                End If




                                '枝番更新   2010.02.15
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then

                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then


                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01
'2012.04.01
'2012.04.01                                                End If

                                            Else


                                                    '枝番更新   2010.02.15
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01
'2012.04.01
'2012.04.01                                                End If

                                            End If

                                                    '枝番更新   2010.02.15





                                        End If
                                    Else
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then


                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01                                                    End If
                                                Else

'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01                                                    End If



                                                End If
                                            End If
                                        End If
                                    End If
                                Next j
                                '枝番更新   2010.02.15
                                If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                Else
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                End If


                                ID_KANRI_TBL(ING_No).LABEL_STEP = 9

                                'データ送信

                                ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ

                                ID_KANRI_TBL(ING_No).LABEL_ON = True

                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Print_Text_Proc(FileName)
                                '-----------------------------------------------ボディ
                                Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)

                                Sendbuf = Text_Create_Proc()

                                Inspe_Proc_DEN_ALL = False
                                Exit Function

                            End If
                        End If
'                        End If
''' 荷札処置

                        KENPIN_END = True
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                            
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                    KENPIN_END = False
                                    Exit For
                                End If
                            End If
                        Next j

'                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15


                        Select Case KENPIN_END
                    
                            Case True
    
                            '次の作業要求

                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                                            
                                            
                                            
                                            
                                            
                    
                    
                            Case Else
                    
    ''''''''''''''''''''''''''''''''''''''''''''''
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                
                                '-----------------------------------------------３行目
                                Call Wel_HIN_NO_Req_Text_3_Proc
                                '-----------------------------------------------４行目
                                Call Wel_HIN_NO_Req_Text_4_Proc
                                
                                '-----------------------------------------------３行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                    
                        End Select
                    
                    End Select
                
            Next i
        

        Case Step_PRINT_RES        '印刷終了
    
    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    
    
            Select Case ID_KANRI_TBL(ING_No).LABEL_STEP
                Case 1      '品番へ
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------  2012.03.30
'
'                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
'
'                    '-----------------------------------------------ヘッダー 02.24
'                    Call Wel_Head_Text_Proc
'
'                    '-----------------------------------------------１行目
'                    Call Wel_DETAIL_0_Text_Proc
'                    '-----------------------------------------------２行目
'                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
'
'
'
'
'                    '-----------------------------------------------３行目
'                    Call Wel_HIN_NO_Req_Text_3_Proc
'                    '-----------------------------------------------４行目
'                    Call Wel_HIN_NO_Req_Text_4_Proc
'                    '-----------------------------------------------５行目
'                    Call Wel_Clear_Text_Proc
'
'                    Sendbuf = Text_Create_Proc()



                        
                        
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                        If RTrim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                            Exit For
                        End If
                    
                    Next j
                        
'                    Print_bara_F = False
'
'                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
'
'                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Cnt_Bara_Su < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
'                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Cnt_Bara_Su = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Cnt_Bara_Su + 1
'                        Print_bara_F = True
'                    Else
'                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Cnt_Hako_Su = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Cnt_Hako_Su + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
'                    End If
                    
                    
 



                   If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT Then
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                                                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                        End If
                                
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If ID_KANRI_TBL(ING_No).KEN_HINBAN = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO And _
                                Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                '単体梱包時
                                If OKURI_NO_SEQ_Update_Proc(k, Format(ID_KANRI_TBL(ING_No).LAST_START_PAGE, "000"), Sendbuf, Format(ID_KANRI_TBL(ING_No).LAST_END_PAGE, "000")) Then
                                    GoTo Abort_Tran
                                End If
                                
                            End If
                        Next k
                                
                                
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
'2012.11.15                                                                                'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        Else
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                        End If
                        
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                End If
                            End If
                        Next k
                                                                                    '表示内容
                            
                        If Y_SYU_CNT < 2 Then
    
'                                If Inspection_QTY = 1 Then
    
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
'                                End If
                                                                                    
                        Else
                            
'                                If Inspection_QTY = 1 Then
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                        End If
                                                                                    
                                                                                '数値初期表示
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                        Else
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                        End If
                                                                                '初期カーソル位置
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                        Else
                            Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                        End If
                                                                                
                                                                                '入力桁数
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Else
                            Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                        End If
                                                                                
                                                                                
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                        End If
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
'                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.11.15 8
                        
                        Sendbuf = Text_Create_Proc()
                        Inspe_Proc_DEN_ALL = False
                        Exit Function
                
                
                    Else
                
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            
                            
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                                
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
'2012.11.15                                                                                'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        
                        
                        '-----------------------------------------------５行目
                                                                                    'BOX属性
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                            Else
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCANK                             '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK        '2007.04.21
'                            End If
                            
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                End If
                            End If
                        Next k
                                                                                    '表示内容
                            
                        If Y_SYU_CNT < 2 Then
    
 '                               If Inspection_QTY = 1 Then
    
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
 '                               Else
 '                                   Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
 '                                   Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
 '                               End If
                                                                                    
                        Else

'                                If Inspection_QTY = 1 Then
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                        End If
                                                                                
                                                                                    '数値初期表示
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                            Else
                        Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
'                            End If
                                                                                    '初期カーソル位置
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Start_Pos = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                            Else
                        Send_Text.Box_Type(4).Start_Pos = "01"                                              '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"                         '2007.04.21
'                            End If
                                                                                    
                                                                                    '入力桁数
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).Max_Size = "00"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'                            Else
                        Send_Text.Box_Type(4).Max_Size = "20"                                               '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"                          '2007.04.21
'                            End If
                                                                                    
                                                                                    
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then     '2012.04.13
                            Else
                                Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                            End If                  '2012.04.13
                        End If
                                                                            
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                        Inspe_Proc_DEN_ALL = False
                        Exit Function
                    End If
                    
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------  2012.03.30
                
                Case 2      '口数へ
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    '-----------------------------------------------ヘッダー
                    Call Wel_Head_Text_Proc
                    
                    '-----------------------------------------------１行目
                    Call Wel_DETAIL_0_Text_Proc
                    '-----------------------------------------------２行目
                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                    
                    '-----------------------------------------------３行目
'2012.11.15                                                                            'BOX属性
'2012.11.15                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                            '表示内容
'2012.11.15
'2012.11.15                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                            '数値初期表示
'2012.11.15                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                            '初期カーソル位置
'2012.11.15                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                            '入力桁数
'2012.11.15                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '2012.11.15
                    Call Wel_OKURI_SAKI_PROC
                    
                    '-----------------------------------------------４行目
'口数　４
                    wkKONPO_F = ""
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                    
                        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                        
                            wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                            Exit For
                        End If
                    Next j
                    
                    If wkKONPO_F = "1" Then
                                            
                        If Inspection_Input Then
                            KUTI_SU_INPUT_F = False
                        Else
                            KUTI_SU_INPUT_F = True
                        End If
                    
                    
                        TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                        TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                
                    Else
                        TOTAL_KUTI_SU = 1
                        KUTI_SU_INPUT_F = True
                        TOTAL_SAI_SU = 0#
                    End If
                                
                                
                                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                    End If
                                
                                
                    If KUTI_SU_INPUT_F Then
                    
                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                        ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                    
                    Else
                        Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                    
                    
                    
                        If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                    
                    
                    
                    
                    
                    
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                    
                    
                    
                    End If
                    
                    Sendbuf = Text_Create_Proc()
                
                Case 9
        
                    Select Case (Y_SYU_CNT - Sumi_CNT)
                
                        Case 0
                
                            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                            Select Case sts
                                Case BtNoErr
                                '   -------------------------------- エラーメッセージ作成
                                Case Else
                                '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                            End Select
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                            
                            Sendbuf = Text_Create_Proc()
            
            
                        Case Else
                        
        ''''''''''''''''''''''''''''''''''''''''''''''
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                            Call Wel_HIN_NO_Req_Text_3_Proc
                            '-----------------------------------------------４行目
                            Call Wel_HIN_NO_Req_Text_4_Proc
                            '-----------------------------------------------５行目
                            Call Wel_Clear_Text_Proc
        
                            Sendbuf = Text_Create_Proc()
        
            
                End Select
            End Select
    
    End Select
                    
                    

    Inspe_Proc_DEN_ALL = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function



Public Function Inspe_Proc_LOGISTIC_ALL(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（宅配伝票読み込み 大阪ＰＣ向け）』
'       'ロジステックス対応
'       2010.02.25
'
'       全数検品対応    2012.03.21
'
'       2017.09.22 YOIN_DNAME -- > YOIN_LONG_DNAME に　置き換え
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07


Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Long

Dim SAI_SU          As Double

Dim UNSOU_KAISHA    As String
 
Dim SYUKA_YMD       As String
Dim JYUSHO          As String
Dim BIKOU           As String

Dim SURYO           As String

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag

Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean

'2010.01.21
Dim KONPOU_ON           As Integer


Dim KONPOU_ON_SUMI      As Integer
Dim KONPOU_OFF          As Integer
Dim KONPOU_OFF_SUMI     As Integer
Dim PRINT_OFF           As Boolean
Dim Start_Page_No       As Long
Dim PRINT_TOTAL_SU      As Long
Dim PRINT_MAISU         As Long
Dim FileName            As String
Dim ID_SEQ              As Integer
Dim DISP_SAI_SU         As Double

Dim wkKUTI_SU           As String
Dim wkKONPO_F           As String * 1

Dim TOTAL_KUTI_SU       As Integer
Dim TOTAL_SAI_SU        As Double
Dim MUKE_NAME           As String
Dim OKURI_NO_MAX        As Integer
Dim KUTI_SU_INPUT_F     As Boolean

Dim KEN_TEL_NO          As String * 20

Dim KEN_TYAKUTEN        As String * 3       '2017.04.06

Dim LOGIXTICS_F         As Boolean

Dim OKURI_NO_F          As Boolean
'2010.01.21
Dim FUKUYAMA_CHK_F      As Boolean

Dim Cnt_F               As Boolean  '2012.03.31
Dim Print_bara_F        As Boolean  '2012.03.31

Dim Hin_Total           As Long     '2012.04.07

Dim KEN_HINBAN          As String * 20      '2012.10.02

Dim OKURISAKI_CD    As String * 9           '2015.10.21


    Inspe_Proc_LOGISTIC_ALL = True

    LOGIXTICS_F = True
    
    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                                        
                        '2012.10.02　KEN_HINBAN追加 2015.10.21 OKURISAKI_CD追加 2017.04.06 KEN_TYAKUTEN 追加
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, _
                                                SYUKA_YMD, _
                                                JYUSHO, _
                                                BIKOU, _
                                                Start_Page_No, _
                                                KUTI_SU, _
                                                MUKE_NAME, _
                                                OKURI_NO_MAX, , , _
                                                KEN_TEL_NO, _
                                                KEN_HINBAN, _
                                                OKURISAKI_CD, _
                                                KEN_TYAKUTEN)
                        
                        '他端末で使用中 2011.04.07
                        If sts = SYS_CANCEL Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                        '他端末で使用中 2011.04.07
                        
                        
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            Next j
                                                     
                            If CANCEL_F Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "キャンセル伝票です。", "", "") '2017.09.22
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        End If
                        
                        
                        If Y_SYU_CNT = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "") '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                                                 
                        If Sumi_CNT = Y_SYU_CNT And Start_Page_No <> 0 Then
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "検品処理済！", "", "")  '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        
                        End If
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = Y_SYU_TBL(j).KONPOU_F        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_CND = Y_SYU_TBL(j).KONPOU_CND    '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).TOTAL_SU = Y_SYU_TBL(j).TOTAL_SU        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = Y_SYU_TBL(j).SAI_SU            '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = Y_SYU_TBL(j).KUTI_SU          '2010.01.21
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = Y_SYU_TBL(j).PRINT_SUMI    '2010.01.21
                        
                                                                                                        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ = Y_SYU_TBL(j).OKURI_NO_SEQ
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = Y_SYU_TBL(j).CNT_BARA_SU      '検品実績　バラ
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = Y_SYU_TBL(j).CNT_HAKO_SU      '検品実績　箱
                            
                
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = Y_SYU_TBL(j).Y_HIN_CHK_CNT  '品番読込み回数
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = Y_SYU_TBL(j).J_HIN_CHK_CNT  '品番読込み済み回数

'2012.11.15                            ID_KANRI_TBL(ING_No).KEN_HINBAN = KEN_HINBAN
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                        
                        Next j
                        
                        '送り状
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
'                        ID_KANRI_TBL(ING_No).KEN_OKURISAKI_CD = ""                  '2015.10.21
                        '送り先CD   2015.10.21
                        ID_KANRI_TBL(ING_No).KEN_OKURISAKI_CD = OKURISAKI_CD
                        
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        '出荷日
                        ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = SYUKA_YMD
                        '住所
                        ID_KANRI_TBL(ING_No).KEN_JYUSHO = JYUSHO
                        
                        '備考
                        ID_KANRI_TBL(ING_No).KEN_BIKOU = BIKOU
                        '向け先
                        ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = MUKE_NAME
                        
                        '枝番
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO_MAX = OKURI_NO_MAX
                        '電話番号
                        ID_KANRI_TBL(ING_No).KEN_TEL_NO = KEN_TEL_NO
                        '着店
                        ID_KANRI_TBL(ING_No).KEN_TYAKUTEN = KEN_TYAKUTEN    '2017.04.06
                        
                         '検品ﾊﾟﾀｰﾝ  2012.03.31
                        ID_KANRI_TBL(ING_No).KEN_TYPE = ""
            
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                '2012.11.15
                        ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = KEN_HINBAN    '2012.11.15
                        
                        'ﾗﾍﾞﾙ開始ページ
                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                        
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                        
                    
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        
                        
                        
                        End If
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                        
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                        If KONPOU_ON <> 0 Then
                            If KONPOU_ON = KONPOU_ON_SUMI Then
                                                    
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                                    
                            End If
                        End If
                                   
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                
                
                
                        Else
                
                
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                                                                                    'BOX属性
                                                                                    
                                                                                    
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                            
                            KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI   '2011.03.17
        
    ''' 品番単位での丸め処理
                            Select Case KONPOU_ON    '2011.03.17
                            
                            
''''''''''2011.03.17Select Case (KONPOU_ON - KONPOU_ON_SUMI)
                                Case 0
                                '集合梱包なし
                                
                                    
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                        If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                            '-----------------------------------------------ヘッダー
                                            Call Wel_Head_Text_Proc
                                            '-----------------------------------------------１行目
                                            Call Wel_DETAIL_0_Text_Proc
                                            '-----------------------------------------------２行目
                                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                            '-----------------------------------------------３行目
'2012.11.15                                                                                                    'BOX属性
'2012.11.15                                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                                    '表示内容
'2012.11.15
'2012.11.15                                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                                    '数値初期表示
'2012.11.15                                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                                    '初期カーソル位置
'2012.11.15                                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                                    '入力桁数
'2012.11.15                                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        
                                            '2012.11.15
                                            Call Wel_OKURI_SAKI_PROC
                                        
                                        
                                            TOTAL_KUTI_SU = 1
                                            KUTI_SU_INPUT_F = True
                                            TOTAL_SAI_SU = 0#
                                                
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                            End If
                                    
                                            Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                            ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                            ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                            ID_KANRI_TBL(ING_No).KEN_TYPE = "1"         '2012.03.31
                                    
                                            Sendbuf = Text_Create_Proc()
                                        
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            Exit Function
                                        End If
                                    End If
    '''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                    
                                    
                                    
                                    '-----------------------------------------------ボディ
                                    Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
            
                                    Sendbuf = Text_Create_Proc()
                                Case Else
                                '集合梱包あり
                            
                                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                                    '-----------------------------------------------２行目
                                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                    '-----------------------------------------------３行目
'2012.11.15                                                                                            'BOX属性
'2012.11.15                                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                            '表示内容
'2012.11.15
'2012.11.15                                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                            '数値初期表示
'2012.11.15                                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                            '初期カーソル位置
'2012.11.15                                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                            '入力桁数
'2012.11.15                                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    '2012.11.15
                                    Call Wel_OKURI_SAKI_PROC
                                    '-----------------------------------------------４行目
                                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                            '表示内容
                                                                                        '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                            "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = "01"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                            '入力桁数
                                    '2010.12.07
'                                    Send_Text.Box_Type(3).Max_Size = "13"
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                    Send_Text.Box_Type(3).Max_Size = "13"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                    '2010.12.07
                                                                                            
                                                                                            
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------５行目
                                    Call Wel_Clear_Text_Proc
            
                                    Sendbuf = Text_Create_Proc()
                            
                            End Select
                        End If
                        
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状ａj
                
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else
                        
                            If Not IsNumeric(OKURI_NO) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状ｃGラー", "", "") '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            If Not OKURI_NO_F Then
                                '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                                                
                            End If
                        
                        
                            '2009.04.28
                            If FUKUYAMA_CHK_F Then
                                '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            
                            End If
                            '2009.04.28
                        
                        End If
                    
                        '送り状
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                         '2018.12.20       Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "ロジスティクス")
                                            
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                                            
'                                End If
                                
                                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                
                                
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
                                                                                'BOX属性
                                                                                
                                                                                
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        KONPOU_ON = KONPOU_ON - KONPOU_ON_SUMI '2011.03.17
    
                        ''' 品番単位での丸め処理
                        Select Case KONPOU_ON  '2011.03.17
'''''''''''''''''Select Case (KONPOU_ON - KONPOU_ON_SUMI)    '2011.03.17
                            Case 0
                            '集合梱包なし
                            
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                                
                                If KONPOU_ON_SUMI <> 0 And KONPOU_OFF_SUMI = 0 Then
                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                        
                                        
                                        
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                            
                                            '-----------------------------------------------ヘッダー
                                        Call Wel_Head_Text_Proc
                                            '-----------------------------------------------１行目
                                        Call Wel_DETAIL_0_Text_Proc
                                            '-----------------------------------------------２行目
                                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                        '-----------------------------------------------３行目
'2012.11.15                                                                                                    'BOX属性
'2012.11.15                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                                    '表示内容
'2012.11.15
'2012.11.15                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                                    '数値初期表示
'2012.11.15                                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                                    '初期カーソル位置
'2012.11.15                                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                                    '入力桁数
'2012.11.15                                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        '2012.11.15
                                        Call Wel_OKURI_SAKI_PROC
                                        
                                        TOTAL_KUTI_SU = 1
                                        KUTI_SU_INPUT_F = True
                                        TOTAL_SAI_SU = 0#
                                                
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                        End If
                                    
                                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                        ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
    
                                    
                                    
                                        Sendbuf = Text_Create_Proc()
                                        
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        Exit Function
                                        
                                        
                                    End If
                                End If
'''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''   2010.03.05
                            '-----------------------------------------------ボディ
                                Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
            
                                Sendbuf = Text_Create_Proc()
                            Case Else
                            '集合梱包あり
                        
                                '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                                Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                                    '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                    '-----------------------------------------------３行目
'2012.11.15                                                                                        'BOX属性
'2012.11.15                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                        '表示内容
'2012.11.15
'2012.11.15                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                                Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                                Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                                Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '2012.11.15
                                Call Wel_OKURI_SAKI_PROC
                                '-----------------------------------------------４行目
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                        '表示内容
                                                                                    '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                        "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                        '入力桁数
                                '2010.12.07
'                               Send_Text.Box_Type(3).Max_Size = "13"
'                               ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                Send_Text.Box_Type(3).Max_Size = "20"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                '2010.12.07
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                        
                            End Select
                        End Select
                    Next i
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            For i = 0 To M_Gyo - 1
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban, "出荷"   '品番/出荷数（品番）
                        If Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = "出荷" Then
                            Cnt_F = True
                        Else
                            ID_KANRI_TBL(ING_No).LAST_START_PAGE = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1 '2012.04.01
                        End If
                        
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
                                '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                '集合梱包有り時の品番チェック
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                            '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                        
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND <> "1" Then
                        
                            If KONPOU_ON <> KONPOU_ON_SUMI Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
                            
                                    '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    Exit Function
                            
                                End If
                            End If
                        
                        End If
                        'ｷｬﾝｾﾙのﾁｪｯｸ
                        CANCEL_F = True
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            End If
                        Next j
                        
                        If CANCEL_F Then
                            '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "キャンセル品番です。", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        
                        
                        End If
                        
                        
                        
                                
                        '検品済みのﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "検品済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                
                        '未出庫のﾁｪｯｸ   2007.05.14
                        If Inspection_Flg = 0 Then
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KAN_KBN <> KAN_KBN_FIN Then
                                        Exit For
                                    End If
                                End If
                            Next k
                                            
                            If k <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                                '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        End If
                        '未出庫のﾁｪｯｸ   2007.05.14
                        
                        '仕掛中品番のﾁｪｯｸ   2012.10.02-->2012.11.15 KEN_HINBAN-->KEN_ING_HINBAN
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) Then
                            If Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) <> "" Then
                                '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "他品番検品中！", ID_KANRI_TBL(ING_No).KEN_ING_HINBAN)
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        End If
                        '仕掛中品番のﾁｪｯｸ   2012.10.02
                        
                        
                        If Cnt_F Then
                        
                            If RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) <> RTrim(Hinban) Then
                                '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        End If
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                
                        Print_bara_F = False
                
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1
                            End If
                        
                            
                            '2012.04.07
                            Hin_Total = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If ID_KANRI_TBL(ING_No).KEN_HINBAN = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then                '2012.09.05
                                    
                                        Hin_Total = Hin_Total + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If                                                                  '2012.09.05
                                End If
                            Next k
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)) + _
                            '                                                            (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO - _
                            '                                                            ((CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY)
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)) + _
                                                                                        (Hin_Total - _
                                                                                        ((CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY)
                            '2012.04.07
                            
                            
                            Print_bara_F = False
                            
                            
                            
                            
'>>>>>>>>>>>>>  2013.02.03
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1 Then
'                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1 Or _
'                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY > Hin_Total Then
'                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1 Then
'>>>>>>>>>>>>>  2013.02.03
                            
                                'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO   2012.04.09
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = Hin_Total                                    '2012.04.09
                                Print_bara_F = True
                            Else
                                'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = CLng(ToRoundUp(CCur(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO Mod ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0))
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = CLng(ToRoundUp(CCur(Hin_Total Mod ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0))    '2012.04.09
                            End If
                            
                            
                            
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            '
                            'If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 1
                            'Else
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            'End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                            
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                                Print_bara_F = True         '2013.02.03
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                        
                        End If
                        
                        If Cnt_F Then
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                                Print_bara_F = True
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                        
                        
                        End If

'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02
                        '----------------------------------- トランザクション開始 -----------
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If


                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
'2012.10.02                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
'2012.10.02
'2012.10.02                                '------------------------------------   出荷予定の処理
'2012.10.02                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
'2012.10.02
'2012.10.02
'2012.10.02                                Do
'2012.10.02
'2012.10.02                                    sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.10.02                                    Select Case sts
'2012.10.02                                        Case BtNoErr
'2012.10.02                                            Exit Do
'2012.10.02                                        Case BtErrKeyNotFound
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_LOGISTIC_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_LOGISTIC_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                        Case Else
'2012.10.02                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
'2012.10.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                    End Select
'2012.10.02
'2012.10.02                                Loop
'2012.10.02
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
'2012.10.02
'2012.10.02
'2012.10.02
'2012.10.02                                Do
'2012.10.02
'2012.10.02                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.10.02                                    Select Case sts
'2012.10.02                                        Case BtNoErr
'2012.10.02                                            Exit Do
'2012.10.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_LOGISTIC_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                        Case Else
'2012.10.02                                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
'2012.10.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                    End Select
'2012.10.02
'2012.10.02                                Loop
'2012.10.02
'2012.10.02
'2012.10.02
'2012.10.02                            End If
                            '------------------------------------   出荷予定の処理  2012.10.02
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
                
                
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
    

                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
    
                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))

                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
                            End If
                        
                            Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, ID_KANRI_TBL(ING_No).KEN_HINBAN)

                            Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                            Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                        
                            Do
                            
                                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                        
                        '------------------------------------   出荷予定の処理  2012.10.02
                        Next k
                        
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            Exit Function
                        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 荷札発行処理    2012.03.30
                        PRINT_OFF = False
    
    
                            
    
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
                            PRINT_OFF = True
                        Else
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
                            
''                                If KONPOU_ON = KONPOU_ON_SUMI Then
        
                                    PRINT_OFF = True

''                                End If
        
                            End If
                        End If

'                        PRINT_OFF = False

                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                            Not LOGIXTICS_F Then
                            If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                PRINT_OFF = True
                            End If
                        End If


                        '2012.09.05
                        If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
                                PRINT_OFF = True
                        End If
                        '2012.09.05


                        If Not PRINT_OFF Then


                            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                            Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
                            '2010.06.16
                            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            Select Case sts
                                Case BtNoErr
                                    If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then

                                        Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                    End If

                                Case BtErrKeyNotFound

                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                Case Else
                                    Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select

                            '>>>>>>>>>      2013.02.03プリンタ枚数は口数をセット
                            If Print_bara_F Then
                                PRINT_MAISU = Val(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                            Else
                                PRINT_MAISU = Val(StrConv(ITEMREC.KUTI_SU, vbUnicode)) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                            '>>>>>>>>>      2013.02.03プリンタ枚数は口数をセット



                            Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
    
                            PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
    
                            ID_KANRI_TBL(ING_No).LABEL_STEP = 1

                            'Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then

                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then

                                        'Y_SYU_CNT = Y_SYU_CNT + 1
                                       SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO

                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).PRINT_SUMI Then
                                            PRINT_OFF = True
                                        Else

'2012.03.                                           ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).PRINT_SUMI = True

                                        End If

                                    End If
                                End If
                            Next k
                        End If

                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                               Not LOGIXTICS_F) Then
                            PRINT_MAISU = PRINT_MAISU - 1
                            If PRINT_MAISU < 1 Then

                            '枝番更新   2010.02.15
                                For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                    If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then

                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then

'2012.04.01                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                GoTo Abort_Tran
'2012.04.01
'2012.04.01                                            End If


                                        End If
                                    Else
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KONPOU_F <> "1" Then


'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                End If



                                            End If

                                        End If
                                    End If
                                Next k
                                '枝番更新   2010.02.15

                                PRINT_OFF = True

                                ID_KANRI_TBL(ING_No).LABEL_ON = True

                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No

                            Else
'                                            PRINT_MAISU = PRINT_MAISU - 1
                                Start_Page_No = Start_Page_No + 1
                            End If
                        End If

                        If Not PRINT_OFF Then

                            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                            Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)

                            sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            Select Case sts
                                Case BtNoErr

                                    If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then


                                        Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                    End If

                                Case BtErrKeyNotFound


                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                Case Else
                                    Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select


'2010.02.21                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))

'2010.02.21                                    Start_Page_No = Start_Page_No + 1

'2010.02.21                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                            ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01

                            If Label_File_Make_Proc(FileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                            End If



                            '枝番更新   2010.02.15
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then

                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then

                                        If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And _
                                            (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                              Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                               Not LOGIXTICS_F) Then

'2012.04.01                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'2012.04.01
'2012.04.01                                                GoTo Abort_Tran
'2012.04.01                                            End If


                                        Else


'2012.04.01                                            If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                GoTo Abort_Tran
'2012.04.01                                            End If

                                        End If
                                    End If
                                Else
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KONPOU_F <> "1" Then

'2012.04.01                                            If OKURI_NO_SEQ_Update_Proc(k, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                GoTo Abort_Tran
'2012.04.01
'2012.04.01                                            End If



                                        End If



                                    End If
                                End If
                            Next k
                                    '枝番更新   2010.02.15




'2010.02.21                                    If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
'                                    Else
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
'                                    End If

'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
'                                                    GoTo Abort_Tran
'                                                End If
'
'                                            End If
'                                        End If
'                                    Next j

                                    'データ送信

                            ID_KANRI_TBL(ING_No).LABEL_STEP = 1


                            ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ

                            ID_KANRI_TBL(ING_No).LABEL_ON = True

                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU - 1
                            '-----------------------------------------------ヘッダー

                            Call Wel_Head_Print_Text_Proc(FileName)

                            Sendbuf = Text_Create_Proc()


                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If

''' 荷札処置
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 荷札発行処理    2012.03.30
                
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT Then


                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True

                
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc

    ''' 品番単位での丸め処理
                        
                             '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                                                                                'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"

                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                            If Inspection_QTY = 1 Then

                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            Else
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                            End If
                            
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                                    If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                
                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                
                                                Y_SYU_CNT = Y_SYU_CNT + 1
                                                SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                        End If
                                    End If
                            Next k
                                                                                '表示内容
                        
                        If Y_SYU_CNT < 2 Then

'                            If Inspection_QTY = 1 Then

                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
'                            Else
'                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
'                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
'                            End If
                                                                                
                        Else
                        
'                            If Inspection_QTY = 1 Then
                                
                                
                                'Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")                          '2012.04.10
                                'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")     '2012.04.10
                                                                                                                                                                    '2012.04.10
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                                                                                                                                                    '2012.04.10
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                            Else
'                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                            End If
                        
                        End If
                                                                                
                                                                                '数値初期表示
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                        Else
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                        End If
                                                                                '初期カーソル位置
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                        Else
                            Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                        End If
                                                                                
                                                                                '入力桁数
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Else
                            Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                        End If
                                                                                
                                                                                
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                        Else                                            '2012.11.15
                            ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""    '2012.11.15
                        End If
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                
                        Inspe_Proc_LOGISTIC_ALL = False
                        Exit Function
                
                
                Else
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                            
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                                                                                    'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                   '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                    'BOX属性
'                       If Inspection_QTY = 1 Then
'
'                           Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                               ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                       Else
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCANK                             '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK        '2007.04.21
'                       End If
                            
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then                '2012.09.05 j-->k
                                    
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                End If
                            End If
                        Next k
                                                                                    '表示内容
                            
                        If Y_SYU_CNT < 2 Then
    
 '                          If Inspection_QTY = 1 Then
    
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
 '                              Else
 '                                      Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
 '                                  Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
 '                              End If
                                                                                        
                        Else

'                                If Inspection_QTY = 1 Then
                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                            End If
                                                                                    
                                                                                    '数値初期表示
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                            Else
                                Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
'                            End If
                                                                                    '初期カーソル位置
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Start_Pos = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                            Else
                                Send_Text.Box_Type(4).Start_Pos = "01"                                              '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"                         '2007.04.21
'                            End If
                                                                                    
                                                                                    '入力桁数
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).Max_Size = "00"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'                            Else
                                Send_Text.Box_Type(4).Max_Size = "20"                                               '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"                          '2007.04.21
'                            End If
                                                                                    
                                                                                    
                            '2009.04.15
                            If SYUKA_QTY > 1 Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then        '2012.04.09
                                Else
                                    Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                                End If                  '2012.04.09
                            End If
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            Sendbuf = Text_Create_Proc()
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                End Select
            
            Next i
'''''''''''''''''''''''''''''''
    
    
        Case Step_Sagyo4_RES        '４回目の受信（検品数　受信）
            
            For i = 0 To M_Gyo - 1
                
'                Select Case RTrim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), _
'                                Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 10))
                    
                    Case LCD_Syuka_Su1, LCD_Syuka_Su2, "出荷数："  '出荷数(検品数)
                        
                        SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        If Not IsNumeric(SURYO) Then
                            '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        
                        End If
                
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                
                        If CLng(SURYO) <> SYUKA_QTY Then
                            '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷数エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_LOGISTIC_ALL = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
            
            ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""        '2012.11.15
            
            
            Y_SYU_CNT = 0
            SYUKA_QTY = 0
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                    
                        Y_SYU_CNT = Y_SYU_CNT + 1
                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                    End If
                End If
            Next j
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        '------------------------------------   出荷予定の処理
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                                 Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
        
                    '''他行の使用を継続するため
                    '''Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                    '''Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                        Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                    '出荷予定書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    
                                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                    Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                        
                        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                                            
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                        Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
'2012.10.31                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                                    
                        Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                        Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                    
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                                            
                                            
                        '------------------------------------   在庫移動履歴の処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                            MENU_NO = ""
                        End If
                                            
                        '履歴出力の為の読み込み
                        Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                        Call UniCode_Conv(K0_MTS.SS_CODE, "")
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                                Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                            
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    CYU_KBN_SPO, _
                                                    Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                                    , , , , MENU_NO, _
                                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                GoTo Abort_Tran
                        End Select
                                            
                        '検品済！！
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = True
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
                                        
                    End If
                '--------------------   2012.10.02  ▽
                Else
                
                    Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID
    
                    Do
                    
                        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrKeyNotFound
                                '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                GoTo Abort_Tran
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                GoTo Abort_Tran
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                
                    Loop
                
                
                    Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
'''''''''''''''                    ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                                
                                                
                    Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                    Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                
                                                '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                    Do
                        sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                
                                '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                GoTo Abort_Tran
                        
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                
                '--------------------   2012.10.02  △
                End If
            
            Next j
'2012.11.15            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.31
            '作業ﾛｸﾞ出力    2009.04.17
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO) Then
                    Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                    Exit Function
                End If
            End If
            '作業ﾛｸﾞ出力    2009.04.17
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
                    
                    
                    
                    
                    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                    
            Select Case ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND
            
            
                Case "1"
                    '集合梱包なし
                
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
'''' 荷札処置
'                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
'                                ID_KANRI_TBL(ING_No).LABEL_ON = False
'                            Else
'
'                                PRINT_OFF = False
'
'                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
'                                    Not LOGIXTICS_F Then
'                                    If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
'                                        PRINT_OFF = True
'                                    End If
'                                End If
'
'                                If Not PRINT_OFF Then
'
'
'                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'                                    '2010.06.16
'                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                    Select Case sts
'                                        Case BtNoErr
'
'                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            End If
'
'                                        Case BtErrKeyNotFound
'
'                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                        Case Else
'                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                            Sendbuf = Text_Create_Proc()
'                                            GoTo Abort_Tran
'                                    End Select
'
'
'
'
'
'
'
'                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
'                                    Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
'
'                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'                                    'Y_SYU_CNT = 0
'                                    SYUKA_QTY = 0
'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                'Y_SYU_CNT = Y_SYU_CNT + 1
'                                                SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'                                                    PRINT_OFF = True
'                                                Else
'
'                                                   ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
'
'                                                End If
'
'                                            End If
'                                        End If
'                                    Next j
'                                End If
'
'                                If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
'                                                       Not LOGIXTICS_F) Then
'                                    PRINT_MAISU = PRINT_MAISU - 1
'                                    If PRINT_MAISU < 1 Then
'
'                                    '枝番更新   2010.02.15
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                        GoTo Abort_Tran
'
'                                                    End If
'
'
'                                                End If
'                                            Else
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                            GoTo Abort_Tran
'
'                                                        End If
'
'
'
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
'                                    '枝番更新   2010.02.15
'
'                                        PRINT_OFF = True
'
'                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
'
'
'                                    Else
''                                            PRINT_MAISU = PRINT_MAISU - 1
'                                        Start_Page_No = Start_Page_No + 1
'                                    End If
'                                End If
'
'                                If Not PRINT_OFF Then
'
'                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'
'                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                    Select Case sts
'                                        Case BtNoErr
'
'                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            End If
'
'                                        Case BtErrKeyNotFound
'
'
'                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                        Case Else
'                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                            Sendbuf = Text_Create_Proc()
'                                            GoTo Abort_Tran
'                                    End Select
'
'
''2010.02.21                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
''2010.02.21                                    Start_Page_No = Start_Page_No + 1
'
''2010.02.21                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'
'                                    If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
'                                    End If
'
'
'
'                                    '枝番更新   2010.02.15
'                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And _
'                                                    (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                      Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                       Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
'                                                       Not LOGIXTICS_F) Then
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'
'                                                        GoTo Abort_Tran
'                                                    End If
'
'
'                                                Else
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                        GoTo Abort_Tran
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Else
'                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                        GoTo Abort_Tran
'
'                                                    End If
'
'
'
'                                                End If
'
'
'
'                                            End If
'                                        End If
'                                    Next j
'                                    '枝番更新   2010.02.15
'
'
'
'
''2010.02.21                                    If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
''                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
''                                    Else
''                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
''                                    End If
'
''                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
''
''                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
''
''                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
''
''                                                If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
''                                                    GoTo Abort_Tran
''                                                End If
''
''                                            End If
''                                        End If
''                                    Next j
'
'                                    'データ送信
'
'                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'
'                                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
'
'                                    ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU - 1
'                                    '-----------------------------------------------ヘッダー
'
'                                    Call Wel_Head_Print_Text_Proc(fileName)
'
'                                    Sendbuf = Text_Create_Proc()
'
'
'                                    Inspe_Proc_LOGISTIC_ALL = False
'                                    Exit Function
'                                End If
'
'                            End If
''' 荷札処置
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            
                            
                            '-----------------------------------------------３行目
                            Call Wel_HIN_NO_Req_Text_3_Proc
                            '-----------------------------------------------４行目
                            Call Wel_HIN_NO_Req_Text_4_Proc
                            
                            
                            
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
                    
                    
                    
                        Case True
                            '残なし　口数へ
                    
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
''' 荷札処置
'                                PRINT_OFF = False
'
'                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then
'                                    PRINT_OFF = True
'                                Else
'                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then
'
'                                        If KONPOU_ON = KONPOU_ON_SUMI Then
'
'                                            PRINT_OFF = True
'
'                                        End If
'
'                                    End If
'                                End If
'
'                                If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
'                                    ID_KANRI_TBL(ING_No).LABEL_ON = False
'                                Else
'
'            '                        Y_SYU_CNT = 0
'            '                        SYUKA_QTY = 0
'
'                                    PRINT_OFF = False
'
'                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
'                                        Not LOGIXTICS_F Then
'                                        If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
'
'                                                        '枝番更新   2010.02.15
'                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'                                                    Start_Page_No = 1
'                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'
'
'
'                                                        '枝番更新   2010.02.15
'
'                                                        PRINT_OFF = True
'
'                                                    End If
'
'                                                Else
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                GoTo Abort_Tran
'
'                                                            End If
'
'
'                                                        End If
'
'                                                    End If
'                                                End If
'                                            Next j
'                                        End If
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                                        Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)
'
'                                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'                                        Select Case sts
'                                            Case BtNoErr
'
'                                                If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
'
'                                                    Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                                End If
'
'                                            Case BtErrKeyNotFound
'
'                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
'
'                                            Case Else
'                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                                Sendbuf = Text_Create_Proc()
'                                                GoTo Abort_Tran
'                                        End Select
'
'                                        PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
'
'                                        Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1
'
'                                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
'
'                                        If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
'                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
'                                                               Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
'                                                               Not LOGIXTICS_F) Then
'                                            PRINT_MAISU = PRINT_MAISU - 1
'
'
'
'                                            If PRINT_MAISU < 1 Then
'
'                                                        '枝番更新   2010.02.15
'                                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                                    If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                GoTo Abort_Tran
'                                                            End If
'
'                                                        End If
'
'
'
'                                                    Else
'                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'
'                                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'
'                                                                    GoTo Abort_Tran
'                                                                End If
'
'
'
'                                                            End If
'
'                                                        End If
'
'
'
'                                                    End If
'                                                Next j
'                                                        '枝番更新   2010.02.15
'
'                                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
'
'                                                PRINT_OFF = True
'                                            Else
'            '                                    PRINT_MAISU = PRINT_MAISU - 1
'                                                Start_Page_No = Start_Page_No + 1
'                                            End If
'                                        End If
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
'
'                                        Y_SYU_CNT = 0
'                                        SYUKA_QTY = 0
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                                    Y_SYU_CNT = Y_SYU_CNT + 1
'                                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'                                                        PRINT_OFF = True
'                                                    Else
'
'                                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
'
'                                                    End If
'
'                                                End If
'                                            End If
'                                        Next j
'                                    End If
'
'                                    If Not PRINT_OFF Then
'
'                                        If Label_File_Make_Proc(fileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
'                                        End If
'
'
'
'
'
'                                                        '枝番更新   2010.02.15
'                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'
'                                                    If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 And Start_Page_No = 2 Then
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'                                                    Else
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'                                                    End If
'
'                                                End If
'
'
'
'                                            Else
'                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
'                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
'
'
'                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'
'                                                            GoTo Abort_Tran
'                                                        End If
'
'                                                    End If
'
'                                                End If
'
'
'
'
'
'                                            End If
'                                        Next j
'                                                        '枝番更新   2010.02.15
'
'
'
'
'                                        If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
'                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
'                                        Else
'                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
'                                        End If
'
''                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
''
''                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
''
''                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
''
''
''
''                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO, "000"), Sendbuf) Then
''                                                        GoTo Abort_Tran
''                                                    End If
''                                                End If
''                                            End If
''                                        Next j
'
'                                        'データ送信
'
'                                        ID_KANRI_TBL(ING_No).LABEL_STEP = 2
'
'                                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
'
'                                        ID_KANRI_TBL(ING_No).LABEL_ON = True
'
'                                        '-----------------------------------------------ヘッダー
'
'                                        Call Wel_Head_Print_Text_Proc(fileName)
'
'                                        Sendbuf = Text_Create_Proc()
'
'
'                                        Inspe_Proc_LOGISTIC_ALL = False
'                                        Exit Function
'
'                                    End If
'                                End If
            ''' 荷札処置
''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''''' 品番全数検品に移管  2012.03.30
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                '-----------------------------------------------３行目
'2012.11.15                                                                                        'BOX属性
'2012.11.15                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                        '表示内容
'2012.11.15
'2012.11.15                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                                Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                                Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                                Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '2012.11.15
                                Call Wel_OKURI_SAKI_PROC
                                '-----------aaa------------------------------------４行目
                                
'口数INPUT １
                                
                                wkKONPO_F = ""
                                For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                    
                                        wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                        Exit For
                                    End If
                                Next j
                                
                                If wkKONPO_F = "1" Then
                                                        
                                    If Inspection_Input Then
                                        KUTI_SU_INPUT_F = False
                                    Else
                                        KUTI_SU_INPUT_F = True
                                    End If
                                
                                
                                    TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                    TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                            
                                Else
                                    TOTAL_KUTI_SU = 1
                                    KUTI_SU_INPUT_F = True
                                    TOTAL_SAI_SU = 0#
                                End If
                                            
                                            
                                            
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                                End If
                                            
                                            
                                If KUTI_SU_INPUT_F Then
                                
                                    Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                
                                
                                Else
                                    Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                
                                    
                                    
                                    If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                    
                                    
                                    
                                    
                                    
                                    ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                    ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                                
        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.10
                                    '----------------------------------- データ更新処理開始 -----------
                                                                    'トランザクション開始
                                    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    If sts <> BtNoErr Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    End If
                                            
                                                                
                                    For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                            '単体梱包１口時
                                            If OKURI_NO_SEQ_Update_Proc(k, Format(1, "000"), Sendbuf, Format(TOTAL_KUTI_SU, "000")) Then
                                                GoTo Abort_Tran
                                            End If
                                            
                                        End If
                                    Next k
                                            
                                                        'トランザクション終了
                                    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    If sts <> BtNoErr Then
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpEndTransaction, "", 0)
                                        GoTo Abort_Tran
                                    End If
                                            
        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.10
                                
                                
                                
                                
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                        
                        End Select
                        
                
                
                Case "2"
                    '集合梱包のみ
                
                    KENPIN_END = True
                    
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                        
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                KENPIN_END = False
                                Exit For
                            End If
                        End If
                    Next j
                
                
                
                
                
                
                    Select Case KENPIN_END
                    
                        Case False
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    
                    
                    
                    
                    
                        Case True
                            '残なし　口数へ
''' 荷札処置
                            PRINT_OFF = False

                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" And KONPOU_OFF_SUMI = 0 Then '                                    PRINT_OFF = True
                            Else
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "2" Then

                                    If KONPOU_ON = KONPOU_ON_SUMI Then

                                        PRINT_OFF = True

                                    End If

                                End If
                            End If

                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                ID_KANRI_TBL(ING_No).LABEL_ON = False
                            Else

            '                        Y_SYU_CNT = 0
            '                        SYUKA_QTY = 0
'
                                PRINT_OFF = False

                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                    Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                    Not LOGIXTICS_F Then
                                    If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then

                                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then

                                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then






                                                    '枝番更新   2010.02.15
                                                    Start_Page_No = 1
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01                                                    End If
                                                    '枝番更新   2010.02.15
                                                    PRINT_OFF = True
                                                End If


                                            Else
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                     If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
    
    
'2012.04.01                                                         If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                             GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                         End If
    
    
    
                                                     End If
    
                                                 End If





                                            End If
                                        Next j
                                    End If
                                End If

                                If Not PRINT_OFF Then

                                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_HINBAN)

                                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                    Select Case sts
                                        Case BtNoErr

                                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then

                                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                            End If

                                        Case BtErrKeyNotFound

                                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")

                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select

                                    PRINT_MAISU = SYUKA_QTY * CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))

                                    Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1

                                    PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU

                                    If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                            Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                                            Not LOGIXTICS_F) Then
                                        PRINT_MAISU = PRINT_MAISU - 1
                                        If PRINT_MAISU < 1 Then

                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then

                                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then

                                                    '枝番更新   2010.02.15
'2012.04.01                                                       If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                        End If


                                                        '枝番更新   2010.02.15



                                                    End If






                                                Else
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
    
    
'2012.04.01                                                            If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                                GoTo Abort_Tran
'2012.04.01                                                            End If
    
    
    
                                                        End If
                                                    End If
                                                End If
                                            Next j
                                            ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                            PRINT_OFF = True
                                        Else
            '                                    PRINT_MAISU = PRINT_MAISU - 1
                                            Start_Page_No = Start_Page_No + 1
                                        End If
                                    End If
                                End If

                                If Not PRINT_OFF Then

                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1

                                    Y_SYU_CNT = 0
                                    SYUKA_QTY = 0
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then

                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then

                                                Y_SYU_CNT = Y_SYU_CNT + 1
                                                SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO

                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
                                                    PRINT_OFF = True
                                                Else

                                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True

                                                End If

                                            End If
                                        End If
                                    Next j
                                End If

                                If Not PRINT_OFF Then
                                    ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01

                                    If Label_File_Make_Proc(FileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                    End If
                                    '枝番更新   2010.02.15
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then

                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01                                                End If
                                            End If

                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then


'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01                                                    End If


                                                End If

                                            End If







                                        End If
                                    Next j
                                    '枝番更新   2010.02.15





                                    If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                    Else
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                    End If


                                    'データ送信

                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 2

                                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ

                                    ID_KANRI_TBL(ING_No).LABEL_ON = True

                                    '-----------------------------------------------ヘッダー

                                    Call Wel_Head_Print_Text_Proc(FileName)

                                    Sendbuf = Text_Create_Proc()


                                    Inspe_Proc_LOGISTIC_ALL = False
                                    Exit Function

                                End If
                            End If
            ''' 荷札処置
                                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------aaa------------------------------------４行目
'口数INPUT ２
                            wkKONPO_F = ""
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                
                                    wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                    Exit For
                                End If
                            Next j
                            
                            If wkKONPO_F = "1" Then
                                                    
                                If Inspection_Input Then
                                    KUTI_SU_INPUT_F = False
                                Else
                                    KUTI_SU_INPUT_F = True
                                End If
                            
                            
                                TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                        
                            Else
                                TOTAL_KUTI_SU = 1
                                KUTI_SU_INPUT_F = True
                                TOTAL_SAI_SU = 0#
                            End If
                                            
                                            
                                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                            End If
                                        
                                        
                            If KUTI_SU_INPUT_F Then
                            
                                Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                            
                                ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                            
                            Else
                                Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                            
                                If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                            
                            
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                            
                            
                            
                            End If
                                
                            Sendbuf = Text_Create_Proc()
                    
                    End Select
                    
                Case "3"
                    '混在
            
                    
                    '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                    Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
            
            
                    Select Case (KONPOU_ON - KONPOU_ON_SUMI)
            
                        Case 0
                            '口数へ
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                            
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------aaa------------------------------------４行目
'口数input ３
                            wkKONPO_F = ""
                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            
                                If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                
                                    wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                                    Exit For
                                End If
                            Next j
                            
                            If wkKONPO_F = "1" Then
                                                    
                                If Inspection_Input Then
                                    KUTI_SU_INPUT_F = False
                                Else
                                    KUTI_SU_INPUT_F = True
                                End If
                            
                            
                                TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                                TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                        
                            Else
                                TOTAL_KUTI_SU = 1
                                KUTI_SU_INPUT_F = True
                                TOTAL_SAI_SU = 0#
                            End If
                                        
                                        
                                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                            End If
                                        
                                        
                            If KUTI_SU_INPUT_F Then
                            
                                Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                                ID_KANRI_TBL(ING_No).KEN_TYPE = "1"

                            
                            Else
                                Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                            
                                
                                If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                
                                ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                            
                            
                            
                            End If
                        
                        
                            Sendbuf = Text_Create_Proc()
                        
                        
                        
                        
                        
                        Case Else
                            '品番へ
            
                            '残あり　次品番へ
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
'2012.11.15                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_HIN_SYUKON & _
                                                                    "(" & Format(KONPOU_ON_SUMI, "0") & "/" & Format(KONPOU_ON, "0") & ")")
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            '2010.12.07
'                            Send_Text.Box_Type(3).Max_Size = "13"
'                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                            '2010.12.07
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Call Wel_Clear_Text_Proc
    
                            Sendbuf = Text_Create_Proc()
                    End Select
            
            End Select
                    
                    
                    
                    
        Case Step_Sagyo5_RES        '５回目の受信（口数）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Left(Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)), 6)
                    '口数
                    Case LCD_KUTI_SU_S
                
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU < 0 Then
                        
                
                
                
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            
                            End If
                    
                            KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If KUTI_SU < 1 Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        Else
                            KUTI_SU = ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU
                        End If
                    
                    
                    
                    '才数
                    Case LCD_SAI_SU_S
                
                        If ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU < 0 Then
                        
                        
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            
                            End If
                    
                            SAI_SU = CDbl(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            If SAI_SU <= 0 Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_LOGISTIC_ALL = False
                                Exit Function
                            End If
                        Else
                            SAI_SU = ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU
                        
                            If SAI_SU < 1 Then
                                SAI_SU = 1
                            Else
                                If SAI_SU > 1 Then
                                    SAI_SU = CLng(ToHalfAdjust(CCur(SAI_SU), 0))
                                End If
                            End If
                        
                        
                        End If
                    
                        '送り状最大印刷枚数獲得 2010.01.21
                            
                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                
                                    If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                
                                
                                Else
                                
                                    If Label_Print_Total_Su_Proc(0, PRINT_TOTAL_SU) Then
                                
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                
                                End If
                            Else                                                                '2013.02.15
                                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = "" Then              '2013.02.15
                                    If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then  '2013.02.15
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")  '2013.02.15
                                        Sendbuf = Text_Create_Proc()                            '2013.02.15
                                        Exit Function                                           '2013.02.15
                                    End If                                                      '2013.02.15
                                End If                                                          '2013.02.15
                            End If
                        Next j
                                        
                            
                            
                            
                        
'                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
'
'                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            Exit Function
'                        End If
                    
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                            If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                            Else
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU <= 1 Then
                                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = KUTI_SU
                                    End If
                                
                                    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = SAI_SU
                                
                                End If
                            End If
                        Next j
                        
                        
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        
                                        '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
 '2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_LOGISTIC_ALL = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                
                                
                                
                                
                                
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                
                                    'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                    If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                        If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                        End If
                                    Else
'''''''                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                        
                                        
                                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                                                            
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                    
                                Else
                                                
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                                        
                                        'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                                        If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                                            If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                                            Else
                                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                            End If
                                        Else
                                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                                                                
                                        End If
                                    End If
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                                
                                End If
                                                    
                                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                    
                                                    
                                
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j

        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                   
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                
                                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                    'ID
                                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
                
                                Do
                                
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                            
                                Loop
                                
                                
                                
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            
                                            '2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                                
                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                                    
                                                    
                                                    
                                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                    
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_LOGISTIC_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_LOGISTIC_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                

''' 品番単位での丸め処理
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
''' 品番単位での丸め処理

                            
'                        PRINT_OFF = False
'
'                        If KONPOU_OFF = KONPOU_OFF_SUMI Then
'
'                            PRINT_OFF = True
'
'                        End If
                        If ID_KANRI_TBL(ING_No).KEN_TYPE = "1" Then
                            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                            '----------------------------------- データ更新処理開始 -----------
                                                            'トランザクション開始
                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            End If
                                    
                                                        
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SUMI Then
                                    '集合梱包時
                                    If OKURI_NO_SEQ_Update_Proc(k, Format(1, "000"), Sendbuf, Format(KUTI_SU, "000")) Then
                                        GoTo Abort_Tran
                                    End If
                                    
                                End If
                            Next k
                                    
                                                'トランザクション終了
                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                            If sts <> BtNoErr Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpEndTransaction, "", 0)
                                GoTo Abort_Tran
                            End If
                                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            
                            ID_KANRI_TBL(ING_No).KEN_TYPE = ""

                            If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 0 Then
                                ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                            End If
    
    
                            If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                Not LOGIXTICS_F Then
                                If ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = 1 Then
                                    PRINT_OFF = True
                                End If
                            End If


    
                            PRINT_MAISU = KUTI_SU
                                                
                                                
                            Start_Page_No = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1

                            PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU


                            If Start_Page_No = 1 And (Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_CHARTER_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_AKABOU_CD) And _
                                                        Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) <> Trim(KEN_LOGISTIC_CD) And _
                                                        Not LOGIXTICS_F) Then
                                PRINT_MAISU = PRINT_MAISU - 1
                                If PRINT_MAISU < 1 Then
                                
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        
                                                        '枝番更新   2010.02.15
'2012.04.01                                                If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01                                                    GoTo Abort_Tran
'2012.04.01                                                End If
                                                        
                                                        
                                                        '枝番更新   2010.02.15
                        
                                            End If
                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                            
                        
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf) Then
'2012.04.01
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01                                                    End If
                                            
                                                
                                                End If
                                                                
                                            End If
                                        End If
                                    Next j
                                
                                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                                
                                    PRINT_OFF = True
                                Else
'                                PRINT_MAISU = PRINT_MAISU - 1
                                    Start_Page_No = Start_Page_No + 1
                            
                                End If
                            End If

''' 荷札処置
                            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Or PRINT_OFF Then
                                ID_KANRI_TBL(ING_No).LABEL_ON = False
                            Else
                                
'2012.03.30                     Y_SYU_CNT = 0
'                               SYUKA_QTY = 0
'
'                               PRINT_OFF = False
'
'                               For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
'
'                                   If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
'
'                                       If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
'
'                                           Y_SYU_CNT = Y_SYU_CNT + 1
'                                           SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
'
'
'                                           If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI Then
'
'                                               PRINT_OFF = True
'                                           Else
'
'                                           End If
'                                       End If
'                                   End If
'2012.03.30                     Next j
                                
                                If Not PRINT_OFF Then
                                    ID_KANRI_TBL(ING_No).LAST_END_PAGE = Start_Page_No + PRINT_MAISU - 1    '2012.04.01

                                    If Label_File_Make_Proc(FileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                                    End If
                            
                            
                            
                            
                                    '枝番更新   2010.02.15
                                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                
                                        If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                        
                                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            
                            
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01
'2012.04.01                                                    End If
                            
                                                Else
                            
                            
                                                            '枝番更新   2010.02.15
'2012.04.01                                                    If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                        GoTo Abort_Tran
'2012.04.01
'2012.04.01
'2012.04.01                                                    End If
                                                            
                                                End If
                                                            
                                                            '枝番更新   2010.02.15
                                            End If
                                        Else
                                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
                                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" And Start_Page_No = 2 Then
'2012.04.01                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No - 1, "000"), Sendbuf, Format(Start_Page_No - 1 + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01                                                        End If
                                                    Else
                                                    
'2012.04.01                                                        If OKURI_NO_SEQ_Update_Proc(j, Format(Start_Page_No, "000"), Sendbuf, Format(Start_Page_No + PRINT_MAISU - 1, "000")) Then
'2012.04.01
'2012.04.01                                                            GoTo Abort_Tran
'2012.04.01                                                        End If
                                                    
                                                                            
                                                    
                                                    End If
                                                End If
                                            End If
                                        End If
                                    Next j
                                    '枝番更新   2010.02.15
                            
                            
                                
    '                                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No + PRINT_MAISU
                                    
                                    If Start_Page_No = 2 And ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = 0 Then
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU + 1
                                    Else
                                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + PRINT_MAISU
                                    End If
                                    
                                
                                    ID_KANRI_TBL(ING_No).LABEL_STEP = 9
                                    
                                    'データ送信
                                                                
                                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                                
                                    ID_KANRI_TBL(ING_No).LABEL_ON = True
                                
                                    '-----------------------------------------------ヘッダー
                                    Call Wel_Head_Print_Text_Proc(FileName)
                                    '-----------------------------------------------ボディ
                                    Call Wel_Hin_No_Req_Text_Proc(Sumi_CNT, Y_SYU_CNT)
                                
                                    Sendbuf = Text_Create_Proc()
                                
                                    Inspe_Proc_LOGISTIC_ALL = False
                                    Exit Function
                            
                                End If

''' 荷札処置
                            End If
                        End If
                    

                        KENPIN_END = True
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                            
                                                            
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                                    KENPIN_END = False
                                    Exit For
                                End If
                            End If
                        Next j
                    
                    

                        Select Case KENPIN_END
                            
                            Case True
        
                                '次の作業要求
    
                                    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                    Select Case sts
                                        Case BtNoErr
                                        '   -------------------------------- エラーメッセージ作成
                                        Case Else
                                        '重要な要因なので未登録はシステム停止とする
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                        Exit Function
                                    End Select
                                    
                                    
                                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                    If Sagyo_Send_Proc() Then
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    End If
                                    
                                    Sendbuf = Text_Create_Proc()
                                            
                                            
                                            
                                            
                                            
                    
                    
                            Case Else
                    
    ''''''''''''''''''''''''''''''''''''''''''''''
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    
                                '-----------------------------------------------ヘッダー
                                Call Wel_Head_Text_Proc
                                '-----------------------------------------------１行目
                                Call Wel_DETAIL_0_Text_Proc
                                '-----------------------------------------------２行目
                                Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                                
                                 '-----------------------------------------------３行目
                                Call Wel_HIN_NO_Req_Text_3_Proc
                                '-----------------------------------------------４行目
                                Call Wel_HIN_NO_Req_Text_4_Proc
                               
                                '-----------------------------------------------５行目
                                Call Wel_Clear_Text_Proc
        
                                Sendbuf = Text_Create_Proc()
                    
                        End Select
                    
                    End Select
                
            Next i
        

        Case Step_PRINT_RES        '印刷終了
    
    
            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    
            '-----------------------------------------------ヘッダー
            Call Wel_Head_Text_Proc
    
            Select Case ID_KANRI_TBL(ING_No).LABEL_STEP
                Case 1      '品番へ
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------  2012.03.30
'
'                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
'
'                    '-----------------------------------------------ヘッダー 02.24
'                    Call Wel_Head_Text_Proc
'
'                    '-----------------------------------------------１行目
'                    Call Wel_DETAIL_0_Text_Proc
'                    '-----------------------------------------------２行目
'                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
'                    '-----------------------------------------------３行目
'                                                                            'BOX属性
'                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'                                                                            '表示内容
'
'                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'
'
'                                                                            '数値初期表示
'                    Send_Text.Box_Type(2).INIT = ""
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'                                                                            '初期カーソル位置
'                    Send_Text.Box_Type(2).Start_Pos = ""
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'                                                                            '入力桁数
'                    Send_Text.Box_Type(2).Max_Size = "00"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'
'                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
'                    '-----------------------------------------------４行目
'                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
'                                                                            '表示内容
'                                                                        '表示内容
'                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
'                                                                            '数値初期表示
'                    Send_Text.Box_Type(3).INIT = ""
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
'                                                                            '初期カーソル位置
'                    Send_Text.Box_Type(3).Start_Pos = "01"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
'                                                                            '入力桁数
'                    '2010.12.07
''                    Send_Text.Box_Type(3).Max_Size = "13"
''                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
'                    Send_Text.Box_Type(3).Max_Size = "20"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
'                    '2010.12.07
'
'                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
'                    '-----------------------------------------------５行目
'                    Call Wel_Clear_Text_Proc
'
'                    Sendbuf = Text_Create_Proc()
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                        If RTrim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                            Exit For
                        End If
                    
                    Next j
                    
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT Then
            
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
                                                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                        End If
                                
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If ID_KANRI_TBL(ING_No).KEN_HINBAN = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO And _
                                Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                '単体梱包時
                                If OKURI_NO_SEQ_Update_Proc(k, Format(ID_KANRI_TBL(ING_No).LAST_START_PAGE, "000"), Sendbuf, Format(ID_KANRI_TBL(ING_No).LAST_END_PAGE, "000")) Then
                                    GoTo Abort_Tran
                                End If
                                
                            End If
                        Next k
                                
                                
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.04.01
            
            
            
            
            
            
            
            
            
            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = True
                        
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
'2012.11.15                                                                                'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        Else
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                        End If
                        
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                End If
                            End If
                        Next k
                                                                                    '表示内容
                            
                        If Y_SYU_CNT < 2 Then
    
'                                If Inspection_QTY = 1 Then
    
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
'                                End If
                                                                                    
                        Else
                            
'                                If Inspection_QTY = 1 Then
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                        End If
                                                                                    
                                                                                '数値初期表示
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                        Else
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                        End If
                                                                                '初期カーソル位置
                        If Inspection_QTY = 1 Then

                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                        Else
                            Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                        End If
                                                                                
                                                                                '入力桁数
                        If Inspection_QTY = 1 Then
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Else
                            Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                        End If
                                                                                
                                                                                
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                        End If
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                        Inspe_Proc_LOGISTIC_ALL = False
                        Exit Function
                
                
                    Else
                
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            
                            
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Call Wel_DETAIL_0_Text_Proc
    
    ''' 品番単位での丸め処理
                                
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    ''' 品番単位での丸め処理
                        '-----------------------------------------------２行目
                        Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                        '-----------------------------------------------３行目
'2012.11.15                                                                                'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        
                        
                        '-----------------------------------------------５行目
                                                                                    'BOX属性
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                            Else
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCANK                             '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK        '2007.04.21
'                            End If
                            
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                End If
                            End If
                        Next k
                                                                                    '表示内容
                            
                        If Y_SYU_CNT < 2 Then
    
 '                               If Inspection_QTY = 1 Then
    
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
 '                               Else
 '                                   Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
 '                                   Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
 '                               End If
                                                                                    
                        Else

'                                If Inspection_QTY = 1 Then
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                            
                        End If
                                                                                
                                                                                    '数値初期表示
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).INIT = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                            Else
                        Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
'                            End If
                                                                                    '初期カーソル位置
'                            If Inspection_QTY = 1 Then
'
'                                Send_Text.Box_Type(4).Start_Pos = ""
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                            Else
                        Send_Text.Box_Type(4).Start_Pos = "01"                                              '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"                         '2007.04.21
'                            End If
                                                                                    
                                                                                    '入力桁数
'                            If Inspection_QTY = 1 Then
'                                Send_Text.Box_Type(4).Max_Size = "00"
'                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'                            Else
                        Send_Text.Box_Type(4).Max_Size = "20"                                               '2007.04.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"                          '2007.04.21
'                            End If
                                                                                    
                                                                                    
                        '2009.04.15
                        If SYUKA_QTY > 1 Then
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then   '2012.04.13
                            Else
                                Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                            End If                  '2012.04.13
                        End If
                                                                            
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
                        Inspe_Proc_LOGISTIC_ALL = False
                        Exit Function
                    End If
                    
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------  2012.03.30

                
                Case 2      '口数へ
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    '-----------------------------------------------ヘッダー
                    Call Wel_Head_Text_Proc
                    
                    '-----------------------------------------------１行目
                    Call Wel_DETAIL_0_Text_Proc
                    '-----------------------------------------------２行目
                    Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                    
                    '-----------------------------------------------３行目
'2012.11.15                                                                            'BOX属性
'2012.11.15                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                            '表示内容
'2012.11.15
'2012.11.15                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                            '数値初期表示
'2012.11.15                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                            '初期カーソル位置
'2012.11.15                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                            '入力桁数
'2012.11.15                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '2012.11.15
                    Call Wel_OKURI_SAKI_PROC
                    
                    
                    '-----------------------------------------------４行目
'口数　４
                    wkKONPO_F = ""
                    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                    
                        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                        
                            wkKONPO_F = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F
                            Exit For
                        End If
                    Next j
                    
                    If wkKONPO_F = "1" Then
                                            
                        If Inspection_Input Then
                            KUTI_SU_INPUT_F = False
                        Else
                            KUTI_SU_INPUT_F = True
                        End If
                    
                    
                        TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU
                        TOTAL_SAI_SU = Syuka_END_Count_Proc()
                                
                    Else
                        TOTAL_KUTI_SU = 1
                        KUTI_SU_INPUT_F = True
                        TOTAL_SAI_SU = 0#
                    End If
                                
                                
                                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "3" Then
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(0).KONPOU_CND = "1"
                    End If
                                
                                
                    If KUTI_SU_INPUT_F Then
                    
                        Call Wel_Kuti_Su_Input_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = -1
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = -1
                        ID_KANRI_TBL(ING_No).KEN_TYPE = "1"
                    
                    
                    Else
                        Call Wel_Kuti_Su_Notinput_text_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU)
                    
                        
                        If KutiSai_Update_Proc(TOTAL_KUTI_SU, TOTAL_SAI_SU) Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_INP_KUTI_SU = TOTAL_KUTI_SU
                        ID_KANRI_TBL(ING_No).KEN_INP_SAI_SU = TOTAL_SAI_SU
                    
                    
                    
                    End If
                    
                    Sendbuf = Text_Create_Proc()
                
                Case 9
        
                    Select Case (Y_SYU_CNT - Sumi_CNT)
                
                        Case 0
                
                            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                            Select Case sts
                                Case BtNoErr
                                '   -------------------------------- エラーメッセージ作成
                                Case Else
                                '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                            End Select
                            
                            
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                            If Sagyo_Send_Proc() Then
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            End If
                            
                            Sendbuf = Text_Create_Proc()
            
            
                        Case Else
                        
        ''''''''''''''''''''''''''''''''''''''''''''''
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                            '-----------------------------------------------ヘッダー 02.24
                            Call Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Call Wel_DETAIL_0_Text_Proc
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                            Call Wel_HIN_NO_Req_Text_3_Proc
                            '-----------------------------------------------４行目
                            Call Wel_HIN_NO_Req_Text_4_Proc
                            '-----------------------------------------------５行目
                            Call Wel_Clear_Text_Proc
        
                            Sendbuf = Text_Create_Proc()
        
            
                End Select
            End Select
    
    End Select
                    
                    

    Inspe_Proc_LOGISTIC_ALL = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function
















Public Function Inspe_Proc_E_BAG_ALL(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（宅配伝票読み込み 大阪ＰＣ向け）ｲｰﾊﾞｯｸ対応』
'
'       2010.01.21
'       2012.06.20      全数検品対応
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Integer
Dim UNSOU_KAISHA    As String
Dim SURYO           As String


Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag


Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1

Dim KONPOU_ON       As Integer
Dim KONPOU_ON_SUMI  As Integer
Dim KONPOU_OFF      As Integer
Dim KONPOU_OFF_SUMI As Integer




Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2


Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean


Dim OKURI_NO_F      As Boolean

Dim FUKUYAMA_CHK_F  As Boolean

    
Dim Cnt_F               As Boolean  '2012.06.20
Dim Print_bara_F        As Boolean  '2012.06.20

Dim Hin_Total           As Long     '2012.06.20
    
Dim KEN_HINBAN          As String * 20      '2012.10.02
    
    
    Inspe_Proc_E_BAG_ALL = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                        '2012.10.02　KEN_HINBAN追加
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, , , , , , , , , , , _
                                                KEN_HINBAN)
                        
                        
                        
                        
                        '他端末で使用中 2011.04.07
                        If sts = SYS_CANCEL Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                        '他端末で使用中 2011.04.07
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            Next j
                                                     
                                                     
                            If CANCEL_F Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            End If
                        End If
                        
                        
                        
                        If Y_SYU_CNT = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                        
                        If Sumi_CNT = Y_SYU_CNT Then
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "検品処理済！", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        
                        End If
                                                 
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = Y_SYU_TBL(j).CNT_BARA_SU      '検品実績　バラ
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = Y_SYU_TBL(j).CNT_HAKO_SU      '検品実績　箱
                            
                
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = Y_SYU_TBL(j).Y_HIN_CHK_CNT  '品番読込み回数
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = Y_SYU_TBL(j).J_HIN_CHK_CNT  '品番読込み済み回数

'2012.11.15                            ID_KANRI_TBL(ING_No).KEN_HINBAN = KEN_HINBAN
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                        
                        Next j
                        
                        '送り状
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        ID_KANRI_TBL(ING_No).KEN_OKURISAKI_CD = ""                  '2015.10.21
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                '2012.11.15
                        ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = KEN_HINBAN    '2012.11.15
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                         '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                                            
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                        Else
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO))
                        End If
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
    
    
    
                End Select
            Next i
        
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状ａj
                
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                    
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else
                        
                    
                            If Not IsNumeric(OKURI_NO) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            End If
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            
                            
                            
                            
                            If Not OKURI_NO_F Then
                            
                        
                        
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                                                
                            End If
                        
                        
                            '2009.04.28
                            If FUKUYAMA_CHK_F Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            
                            End If
                            '2009.04.28
                        
                        
                        
                        End If
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                        '送り状
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                                            
                                            
                                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                            
                                            
                                '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_E_BAG_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                
                                                                                
                        Sumi_CNT = 0
                        Y_SYU_CNT = 0
                                                                                

                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
'2012.11.15                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                '表示内容
'2012.11.15
'2012.11.15                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
'2012.11.15
'2012.11.15
'2012.11.15                                                                                '数値初期表示
'2012.11.15                        Send_Text.Box_Type(2).INIT = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                '初期カーソル位置
'2012.11.15                        Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                '入力桁数
'2012.11.15                        Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '2012.11.15
                        Call Wel_OKURI_SAKI_PROC
                        
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
'                        Send_Text.Box_Type(3).Max_Size = "13"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                
                
                
                
                
                End Select
                
                
                
            Next i
        
        
        
        
        
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            For i = 0 To M_Gyo - 1
            
                
                '2010.12.07
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                '2010.12.07
                    
                    Case LCD_Hinban, "出荷"   '品番/出荷数（品番）
                        If Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = "出荷" Then
                            Cnt_F = True
                        Else
                            ID_KANRI_TBL(ING_No).LAST_START_PAGE = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO + 1 '2012.04.01
                        End If
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                        
                        
                        'ｷｬﾝｾﾙのﾁｪｯｸ
                        CANCEL_F = True
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            End If
                        Next j
                        
                        If CANCEL_F Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "キャンセル品番です。", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        
                        
                        End If
                        
                        
                        
                                
                        '検品済みのﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                Exit For
                            End If
                        Next j
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "検品済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                
                        '未出庫のﾁｪｯｸ   2007.05.14
                        If Inspection_Flg = 0 Then
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).KAN_KBN <> KAN_KBN_FIN Then
                                        Exit For
                                    End If
                                End If
                            Next k
                            '2012.09.24 j-->k
                            If k <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            End If
                        End If
                        '未出庫のﾁｪｯｸ   2007.05.14
                
                
                        '仕掛中品番のﾁｪｯｸ   2012.10.02-->2012.11.15 KEN_HINBAN-->KEN_ING_HINBAN
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) Then
                            If Trim(ID_KANRI_TBL(ING_No).KEN_ING_HINBAN) <> "" Then
                                
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "他品番検品中！", ID_KANRI_TBL(ING_No).KEN_ING_HINBAN)
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            End If
                        End If
                        '仕掛中品番のﾁｪｯｸ   2012.10.02
                
                
                
                        If Cnt_F Then
                        
                            If RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) <> RTrim(Hinban) Then
                                
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                Exit Function
                            End If
                        End If
                
                
                
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                
                
                
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.06.20  全数検品対応
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 0 Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1
                            End If
                            Hin_Total = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                If ID_KANRI_TBL(ING_No).KEN_HINBAN = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then                '2012.09.05
                                    
                                        Hin_Total = Hin_Total + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If                                                                  '2012.09.05
                                End If
                            Next k
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)) + _
                                                                                        (Hin_Total - _
                                                                                        ((CLng(ToRoundDown(CCur(Hin_Total / ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY)
                            
                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY = 1 Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = Hin_Total
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY = CLng(ToRoundUp(CCur(Hin_Total Mod ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY), 0))    '2012.04.09
                            End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = 0
                            'ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            '
                            'If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = 1
                            'Else
                            '    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            'End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  DELETE
                        
                        
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                            
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                            '>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.10.02  INS
                        
                        End If
                        
                        If Cnt_F Then
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT + 1
                        
                            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).BARA_QTY Then
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + 1
                                Print_bara_F = True
                            Else
                                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).GAISO_IRI_QTY
                            End If
                        
                        
                        End If


'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02
                        '----------------------------------- トランザクション開始 -----------
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If


                        For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
'2012.10.02                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
'2012.10.02
'2012.10.02                                '------------------------------------   出荷予定の処理
'2012.10.02                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
'2012.10.02
'2012.10.02
'2012.10.02                                Do
'2012.10.02
'2012.10.02                                    sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.10.02                                    Select Case sts
'2012.10.02                                        Case BtNoErr
'2012.10.02                                            Exit Do
'2012.10.02                                        Case BtErrKeyNotFound
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_E_BAG_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_E_BAG_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                        Case Else
'2012.10.02                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
'2012.10.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                    End Select
'2012.10.02
'2012.10.02                                Loop
'2012.10.02
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))
'2012.10.02
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
'2012.10.02                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
'2012.10.02
'2012.10.02
'2012.10.02
'2012.10.02                                Do
'2012.10.02
'2012.10.02                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
'2012.10.02                                    Select Case sts
'2012.10.02                                        Case BtNoErr
'2012.10.02                                            Exit Do
'2012.10.02                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2012.10.02                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.10.02                                            Inspe_Proc_E_BAG_ALL = False
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                        Case Else
'2012.10.02                                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
'2012.10.02                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2012.10.02                                            Sendbuf = Text_Create_Proc()
'2012.10.02                                            GoTo Abort_Tran
'2012.10.02                                    End Select
'2012.10.02
'2012.10.02                                Loop
'2012.10.02
'2012.10.02                            End If
'2012.10.02
'2012.10.02
                            '------------------------------------   出荷予定の処理  2012.10.02
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
                
                
                            Do
                            
                                sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(Hinban) Then
    

                                Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
    
                                Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))

                                Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
                                Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
                            End If
                        
                            Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, ID_KANRI_TBL(ING_No).KEN_HINBAN)

                        
                            
                            Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                            Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                            
                            
                            Do
                            
                                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
                        
                        '------------------------------------   出荷予定の処理  2012.10.02
                        Next k
                        
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            Exit Function
                        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 検品の仕掛情報書き込み  2012.10.02

'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.06.20  全数検品対応
                
                
                
                
                
                
                
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).Y_HIN_CHK_CNT Then
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                    
                            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    
                                                                                    
                        
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
    
    
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                    "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                    "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            
                            
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                                    '表示内容
'2012.11.15
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                                    '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                    '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                    '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            If Inspection_QTY = 1 Then
    
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            Else
                                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM                             '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM        '2007.04.21
                            End If
                            
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)                       '2012.09.05 J-->k
                            
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                    
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                                    
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                        SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If
                                End If
                            Next k
                                                                                    
                                                                                    
                                                                                    '表示内容
                            
                            If Y_SYU_CNT < 2 Then
    
                                '                               2012.09.05　DEL　▽
                                'If Inspection_QTY = 1 Then
                                '    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                                '    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                                'Else
                                '    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)                         '2007.04.21
                                '    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su1)    '2007.04.21
                                'End If
                                '                               2012.09.05　DEL　△
                                
                                
                                '                               2012.09.05　INS　▽
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                '                               2012.09.05　INS　△
                                                   
                                                                                    
                            Else
                            
                                '                               2012.09.05　DEL　▽
'                                If Inspection_QTY = 1 Then
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & StrConv(Format(SYUKA_QTY, "#0"), vbWide) & "*")
'                                Else
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)                       '2007.04.21
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Syuka_Su2)  '2007.04.21
'                                End If
                                '                               2012.09.05　DEL　△
                                
                                
                                '                               2012.09.05　INS　▽
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                '                               2012.09.05　INS　△
                            
                            End If
                                                                                    
                                                                                    '数値初期表示
                            If Inspection_QTY = 1 Then
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                            Else
                                Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                            End If
                                                                                    
                                                                                    
                                                                                    '初期カーソル位置
                            If Inspection_QTY = 1 Then
    
                                Send_Text.Box_Type(4).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                            Else
                                Send_Text.Box_Type(4).Start_Pos = "10"                                          '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "10"                     '2007.04.21
                            End If
                                                                                    
                                                                                    '入力桁数
                            If Inspection_QTY = 1 Then
                                Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                            Else
                                Send_Text.Box_Type(4).Max_Size = "07"                                           '2007.04.21
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"                      '2007.04.21
                            End If
                                                                                    
                                                                                    
                            '2009.04.15
                            If SYUKA_QTY > 1 Then
                                Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                            Else                                            '2012.11.15
                                ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""    '2012.11.15
                                                                                    
                            End If
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            
                            
                            Sendbuf = Text_Create_Proc()
                
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        Else
                
                
    '------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                
                                
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                    
                            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                            
                            '-----------------------------------------------１行目
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
        
        ''' 品番単位での丸め処理
                                
                            '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                            Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
        ''' 品番単位での丸め処理
                            '-----------------------------------------------２行目
                            Call Wel_DETAIL_1_Text_Proc(ID_KANRI_TBL(ING_No).ID_NO, Sumi_CNT, Y_SYU_CNT)
                            '-----------------------------------------------３行目
                                                                                        'BOX属性

'2012.11.15                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15
'2012.11.15                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                                                                                        '数値初期表示
'2012.11.15                            Send_Text.Box_Type(2).INIT = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                                        '初期カーソル位置
'2012.11.15                            Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                                        '入力桁数
'2012.11.15                            Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '2012.11.15
                            Call Wel_OKURI_SAKI_PROC
                            
                            '-----------------------------------------------４行目
                                                                                        'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                       '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                        '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                        
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK                             '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK        '2007.04.21
                            
                            Y_SYU_CNT = 0
                            SYUKA_QTY = 0
                            For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                
                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                                        
                                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then        '2012.09.05 j-->k
                                        
                                        Y_SYU_CNT = Y_SYU_CNT + 1
                                            SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SURYO
                                    End If
                                End If
                            Next k
                                                                                    '表示内容
                            
                            If Y_SYU_CNT < 2 Then
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY)
                                                                                        
                            Else

                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出荷数：" & (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU) & "/" & SYUKA_QTY & "*")
                            End If
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""                                                     '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""                                '2007.04.21
                            Send_Text.Box_Type(4).Start_Pos = "01"                                              '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"                         '2007.04.21
                            Send_Text.Box_Type(4).Max_Size = "20"                                               '2007.04.21
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"                          '2007.04.21
                            '2009.04.15
                            If SYUKA_QTY > 1 Then
                                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then        '2012.04.09
                                Else
                                    Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                                End If                  '2012.04.09
                            End If
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            Sendbuf = Text_Create_Proc()
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
        
                
        Case Step_Sagyo4_RES        '４回目の受信（検品数　受信）
            
            
            
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case RTrim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), _
                                Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    Case LCD_Syuka_Su1, LCD_Syuka_Su2   '出荷数(検品数)
                        SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        If Not IsNumeric(SURYO) Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        
                        End If
                
                        Y_SYU_CNT = 0
                        SYUKA_QTY = 0
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                            If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                                
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    SYUKA_QTY = SYUKA_QTY + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO
                                End If
                            End If
                        Next j
                
                
                
                        If CLng(SURYO) <> SYUKA_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷数エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                
                End Select
            
            Next i
            
            
            
            ID_KANRI_TBL(ING_No).KEN_ING_HINBAN = ""        '2012.11.15

            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
                    
                    
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                        
                        
                        
                        
                        '------------------------------------   出荷予定の処理
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                                 Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                        Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                        Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                
                                                
                                                    '出荷予定書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                    Inspe_Proc_E_BAG_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                        
                        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID
        
                        Do
                        
                            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrKeyNotFound
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                    
                        Loop
                                            
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                        Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                            
                                            
                                            
                                            
                                            
                        Select Case Len(Trim(OKURI_NO))
                        
                            Case FUKUYAMA_Length
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
                            Case SEIBU_Length
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
                        
                            Case KURUME_Length
                        
                                For k = 0 To UBound(KURUME_CODE)
                                
                                    If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
                                        Exit For
                                    End If
                                Next k
                        
                                If k > UBound(KURUME_CODE) Then
                                Else
                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
                                End If
                        
                            Case SAGAWA_Length, YAMATO_Length
                        
                                For k = 0 To UBound(KURUME_CODE)
                                
                                    If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
                                        Exit For
                                    End If
                                Next k
                        
                                If k > UBound(SAGAWA_CODE) Then
                                
                                    For k = 0 To UBound(YAMATO_CODE)
                                    
                                        If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
                                            Exit For
                                        End If
                                    
                                    Next k
                                 
                                    If k > UBound(YAMATO_CODE) Then
                                    Else
                                
                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
                                    End If
                                
                                Else
                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
                                End If
                        
                        
                        End Select
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                        '物流 2010.02.19
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_CHARTER_CD) Then
                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "物流")
                        End If
                        
                        '赤帽 2010.02.19
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_AKABOU_CD) Then
                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "赤帽")
                        End If
                                                                    
                                            
                        Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
'2012.10.31                        ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                            
                                            
                                            
                                            
                                            
                                            
                                            
                        Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                        Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                            
                                            
                                            
                                            
                                            
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                        Do
                            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                    Exit Do
                                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_E_BAG_ALL = False
                                    GoTo Abort_Tran
                            
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                    Inspe_Proc_E_BAG_ALL = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        Loop
                                            
                                            
                        '------------------------------------   在庫移動履歴の処理
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                            MENU_NO = ""
                        End If
                                            
                        '履歴出力の為の読み込み
                        Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                        Call UniCode_Conv(K0_MTS.SS_CODE, "")
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                                Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                                            
                                            
                        sts = IDOREKI_OUTPUT_PROC("", _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                                    "", _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    0, _
                                                    0, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    FILE_RETRY, _
                                                    CYU_KBN_SPO, _
                                                    Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                                    , , , , MENU_NO, _
                                                    ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                    "", _
                                                    ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
                        Select Case sts
                            Case False      '正常終了
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_E_BAG_ALL = SYS_ERR
                                GoTo Abort_Tran
                        End Select
                                            
                        '検品済！！
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = True
                                            
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
                                        
                    End If
                
                
                '--------------------   2012.10.02  ▽
                Else
                
                    Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID
    
                    Do
                    
                        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrKeyNotFound
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                GoTo Abort_Tran
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                GoTo Abort_Tran
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                
                    Loop
                
                
                    Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")                '2012.10.02
''''''''''''                    ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.02
                                                
                    Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                    Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                
                                                '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                    Do
                        sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_E_BAG_ALL = False
                                GoTo Abort_Tran
                        
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                Inspe_Proc_E_BAG_ALL = SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                
                '--------------------   2012.10.02  △
                
                
                End If
            
            Next j
                                
                                
'2012.11.15            ID_KANRI_TBL(ING_No).KEN_HINBAN = ""                        '2012.10.31
                                
                                
                                
            '作業ﾛｸﾞ出力    2009.04.17
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO) Then
                    Inspe_Proc_E_BAG_ALL = SYS_ERR
                    Exit Function
                End If
            End If
            '作業ﾛｸﾞ出力    2009.04.17
                                
                                
                                
                                
                                
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
        
                    
            KENPIN_END = True
            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                                                
                                                
                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                    If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                        KENPIN_END = False
                        Exit For
                    End If
                End If
            Next j
        ''' 品番単位での丸め処理
                                
                '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
        ''' 品番単位での丸め処理
            Select Case KENPIN_END
                Case False
                    '検品残あり、品番へ
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    '-----------------------------------------------ヘッダー
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                    Send_Text.FileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
            
                    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                    
                    '-----------------------------------------------１行目
                                                                            'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                            'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            
                                                                            

                                                                            
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    '-----------------------------------------------３行目
                                                                            'BOX属性
'2012.11.15                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                            '表示内容
'2012.11.15                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15
'2012.11.15                                                                            '数値初期表示
'2012.11.15                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                            '初期カーソル位置
'2012.11.15                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                            '入力桁数
'2012.11.15                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '2012.11.15
                    Call Wel_OKURI_SAKI_PROC

                    '-----------------------------------------------４行目
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                            '入力桁数
                    '2010.12.07
'                    Send_Text.Box_Type(3).Max_Size = "13"
'                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                    Send_Text.Box_Type(3).Max_Size = "20"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                    '2010.12.07
                                                                            
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                                                                            'BOX属性
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                     Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                    Sendbuf = Text_Create_Proc()
                Case True
                    '検品完了、口数へ
            
            
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    
                    
                    '-----------------------------------------------ヘッダー
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                    Send_Text.FileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
            
                    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                    
                    '-----------------------------------------------１行目
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                                                                            'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            
                                                                            
                                                                            
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    
                    
                    
                    '-----------------------------------------------３行目
                                                                            'BOX属性
'2012.11.15                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
'2012.11.15                                                                            '表示内容
'2012.11.15
'2012.11.15                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
'2012.11.15
'2012.11.15                                                                            '数値初期表示
'2012.11.15                    Send_Text.Box_Type(2).INIT = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
'2012.11.15                                                                            '初期カーソル位置
'2012.11.15                    Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
'2012.11.15                                                                            '入力桁数
'2012.11.15                    Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
'2012.11.15
'2012.11.15                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
'2012.11.15                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    
                    '2012.11.15
                    Call Wel_OKURI_SAKI_PROC
                    
                    '-----------------------------------------------４行目
                                                                            'BOX属性
                    Send_Text.Box_Type(3).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    
                    
                    '-----------------------------------------------５行目
                    KUTI_SU = 1
                                
                    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_KUTI_SU)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_KUTI_SU)
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = Space(9) & "1"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(9) & "1"
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = "07"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "07"
                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "04"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "04"
                    
                    
                    
                    Sendbuf = Text_Create_Proc()
            
            
            
            
            
            
            
            End Select
            
                
                
                
                
        Case Step_Sagyo5_RES        '５回目の受信（口数）
                
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    
                    '口数
                    Case LCD_KUTI_SU
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        
                        End If
                
                        KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If KUTI_SU < 1 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_E_BAG_ALL = False
                            Exit Function
                        End If
                
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
            
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_E_BAG_ALL = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        Inspe_Proc_E_BAG_ALL = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
                            'ID_NO
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                            
                                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                            
                                                            
                                                            
                                                            
                                                            
                                Call UniCode_Conv(Y_SYU_HREC.JURYO, "0002.0")
                                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, "01.00")
                                                            
                                                    
                                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                    
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            Inspe_Proc_E_BAG_ALL = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Inspe_Proc_E_BAG_ALL = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                            End If
                                        
            
                        Next j
                                
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                
                                        '次の作業要求
            
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
                
                
                
                
                
            Next i
                
                
                
                
    
    
    End Select

    Inspe_Proc_E_BAG_ALL = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function



Public Function LABEL_RePrint_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『荷札ラベル　再発行』
'
'       2010.01.21
'-------------------------------------------------------
Dim sts             As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Long

Dim SAI_SU          As Double

Dim UNSOU_KAISHA    As String
 
Dim SYUKA_YMD       As String
Dim JYUSHO          As String
Dim BIKOU           As String

Dim SURYO           As String

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag

Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean

Dim FAST_F          As Boolean
Dim Found_F         As Boolean

'2010.01.21
Dim KONPOU_ON           As Integer
Dim KONPOU_ON_SUMI      As Integer
Dim KONPOU_OFF          As Integer
Dim KONPOU_OFF_SUMI     As Integer
Dim PRINT_OFF           As Boolean
Dim Start_Page_No       As Long
Dim PRINT_TOTAL_SU      As Long
Dim PRINT_MAISU         As Long
Dim FileName            As String
Dim ID_SEQ              As Integer
Dim DISP_SAI_SU         As Double

Dim wkKUTI_SU           As String
Dim wkKONPO_F           As String * 1

Dim TOTAL_KUTI_SU       As Integer
Dim TOTAL_SAI_SU        As Double
Dim MUKE_NAME           As String
Dim OKURI_NO_MAX        As Integer
Dim KUTI_SU_INPUT_F     As Boolean


Dim S_PAGE              As Integer
Dim E_PAGE              As Integer

Dim Label_RePrint_Kuti_Su _
                        As Integer
Dim Label_RePrint_Sai_Su _
                        As Double



'2010.01.21

    LABEL_RePrint_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                                        
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, _
                                                SYUKA_YMD, _
                                                JYUSHO, _
                                                BIKOU, _
                                                Start_Page_No, _
                                                KUTI_SU, _
                                                MUKE_NAME, _
                                                OKURI_NO_MAX, _
                                                Label_RePrint_Kuti_Su, _
                                                Label_RePrint_Sai_Su)
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        
                        If Found_F Then
                        
                            CANCEL_F = True
                                                     
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            Next j
                                                     
                            If CANCEL_F Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                LABEL_RePrint_Proc = False
                                Exit Function
                            End If
                        End If
                        
                        
                        If Y_SYU_CNT = 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        End If
                                                 
'2012.03.06                        If Sumi_CNT <> Y_SYU_CNT Then
'2012.03.06
'2012.03.06                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品未処理！", "", "")
'2012.03.06                            Sendbuf = Text_Create_Proc()
'2012.03.06                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.03.06                            LABEL_RePrint_Proc = False
'2012.03.06                            Exit Function
'2012.03.06
'2012.03.06                        End If
                                                             
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                 
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN = Y_SYU_TBL(j).KAN_KBN      '2007.05.14
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = Y_SYU_TBL(j).KONPOU_F        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_CND = Y_SYU_TBL(j).KONPOU_CND    '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).TOTAL_SU = Y_SYU_TBL(j).TOTAL_SU        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU = Y_SYU_TBL(j).SAI_SU            '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU = Y_SYU_TBL(j).KUTI_SU          '2010.01.21
                        
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).PRINT_SUMI = Y_SYU_TBL(j).PRINT_SUMI    '2010.01.21
                        
                                                                                                        '2010.01.21
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ = Y_SYU_TBL(j).OKURI_NO_SEQ
                        
                        Next j
                        
                        '送り状
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                        
                        '送り先
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        
                        '運送会社
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                        
                        '出荷日
                        ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = SYUKA_YMD
                        '住所
                        ID_KANRI_TBL(ING_No).KEN_JYUSHO = JYUSHO
                        
                        '備考
                        ID_KANRI_TBL(ING_No).KEN_BIKOU = BIKOU
                        '向け先
                        ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = MUKE_NAME
                        
                        '枝番
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO_MAX = OKURI_NO_MAX
                        
                        ID_KANRI_TBL(ING_No).Label_RePrint_Kuti_Su = Label_RePrint_Kuti_Su
                        ID_KANRI_TBL(ING_No).Label_RePrint_Sai_Su = Label_RePrint_Sai_Su
                        
                        
                        
                        'ﾗﾍﾞﾙ開始ページ
                        ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = Start_Page_No
                        
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = KUTI_SU
                        If Label_Print_Total_Su_Proc(KUTI_SU, PRINT_TOTAL_SU) Then
                        
                    
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        
                        
                        
                        End If
                        ID_KANRI_TBL(ING_No).LABEL_PRINT_TOTAL_SU = PRINT_TOTAL_SU
                        
                        
                        '出荷実績／出荷予定数／集合梱包件数（予定）／単体梱包件数（予定）／集合梱包件数（実績）／単体梱包件数（実績）のカウント
                        Call Syuka_Kenpin_Count_Proc(Sumi_CNT, Y_SYU_CNT, KONPOU_ON, KONPOU_OFF, KONPOU_ON_SUMI, KONPOU_OFF_SUMI)
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                                
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                                                    '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, LCD_ID_No & ":" & Trim(ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        If Inspection_Input Then
                            KUTI_SU_INPUT_F = False
                        Else
                            KUTI_SU_INPUT_F = True
                        End If
                        
                        TOTAL_KUTI_SU = ID_KANRI_TBL(ING_No).Label_RePrint_Kuti_Su
                        TOTAL_SAI_SU = ID_KANRI_TBL(ING_No).Label_RePrint_Sai_Su
                                            
                        If KUTI_SU_INPUT_F Then
                        
                            '-----------------------------------------------２行目
                        
                            wkKUTI_SU = Format(TOTAL_KUTI_SU, "#0")
                                        
                                        
                            Send_Text.Box_Type(1).Box_Type = TYPE_BCNUM
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCNUM
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_KUTI_SU_S)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_KUTI_SU_S)
                                                                            '数値初期表示
                            Send_Text.Box_Type(1).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = 13
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = 13
                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "04"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "04"
                            
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    
                            wkKUTI_SU = Format(TOTAL_SAI_SU, "#0.00")
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_SAI_SU_S)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_SAI_SU_S)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = 12
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = 12
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "05"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "05"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                
                        Else
                            '-----------------------------------------------２行目
                            wkKUTI_SU = Format(TOTAL_KUTI_SU, "#0")
                                        
                                        
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_KUTI_SU_S & wkKUTI_SU)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_KUTI_SU_S & wkKUTI_SU)
                                                                            '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "00"
                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = ""
                            
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    
                            wkKUTI_SU = Format(TOTAL_SAI_SU, "#0.00")
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_SAI_SU_S & wkKUTI_SU)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_SAI_SU_S & wkKUTI_SU)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "00"
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = ""
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        End If
                            
                            
                            
                        '-----------------------------------------------４行目
                                                                                
                        wkKUTI_SU = "1"
                                    
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_S_PAGE_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_S_PAGE_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = 13
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = 13
                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "03"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "03"
                        
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            
                            
                            
                        '-----------------------------------------------５行目
                                                                                
                        wkKUTI_SU = Format(TOTAL_KUTI_SU, "#0")
                                    
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_E_PAGE_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_E_PAGE_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(wkKUTI_SU)) & wkKUTI_SU
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = 13
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = 13
                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "03"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "03"
                        
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            
                            
                        Sendbuf = Text_Create_Proc()
                        
                    End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（開始／終了）
                
            For i = 0 To M_Gyo - 1
                
                Select Case Left(Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)), 6)
                    '開始
                    Case LCD_S_PAGE_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "開始エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        
                        End If
                    
                        S_PAGE = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If S_PAGE < 1 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "開始エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        End If
                    
                    
                    
                    '終了
                    Case LCD_E_PAGE_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "終了エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        
                        End If
                    
                        E_PAGE = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If E_PAGE < 1 Then
                            
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "終了エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        End If

                        If S_PAGE > E_PAGE Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "開始＞終了", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_RePrint_Proc = False
                            Exit Function
                        End If


'2012.03.06                        If E_PAGE > ID_KANRI_TBL(ING_No).Label_RePrint_Kuti_Su Then
'2012.03.06                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "終了＞口", "", "")
'2012.03.06
'2012.03.06                            Sendbuf = Text_Create_Proc()
'2012.03.06                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2012.03.06                            LABEL_RePrint_Proc = False
'2012.03.06                            Exit Function
'2012.03.06                        End If




                        PRINT_MAISU = E_PAGE - S_PAGE + 1
                                                
                        Start_Page_No = S_PAGE
                                                            
                        PRINT_TOTAL_SU = ID_KANRI_TBL(ING_No).Label_RePrint_Kuti_Su
                                                            
                                                            
                        If Label_File_Make_Proc(FileName, PRINT_MAISU, Start_Page_No, PRINT_TOTAL_SU) Then
                        End If
                                
                                
                                    
                        'データ送信
                                                    
                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                    
                                                    
                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                    
                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                    
                        '-----------------------------------------------ヘッダー
                    
                        Call Wel_Head_Print_Text_Proc(FileName)
                    
                        Sendbuf = Text_Create_Proc()
                        
                    




                                            
                                            
                                            
                                                        
                End Select
            Next i

        Case Step_PRINT_RES        '印刷終了
    
    
    
    
    
            '作業ﾛｸﾞ出力    2018.12.20
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1

            Else

                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力

                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    "1", _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                    , , , , , ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).MTS_CODE, , , , , , , , Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & ":" & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) Then
                    LABEL_RePrint_Proc = SYS_ERR
                    Exit Function
                End If
            End If
            '作業ﾛｸﾞ出力    2018.12.20
    
    
    
    
    
    
    
    
    
        '次の作業要求

            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
        
            
    
    End Select
                    
                    

    LABEL_RePrint_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function


Public Function Inspe_Proc_GAI(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品処理（海外向け）』
'
'   2009.08.07
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8
Dim Hinban          As String * 20          '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07



Dim KAN_FLG         As String * 1

Dim i               As Integer

Dim DEN_ID_LOOP     As Integer      '2006.06.01
Dim DEN_ID_JGYOBU   As String * 1   '2006.06.01


Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

Dim wkTEXT          As String


Dim wkKENPIN_YMD    As String * 8   '検品日付   2007.10.10


Dim wkNull_Check    As String       '2009.04.27

Dim LK_MUKE_CODE    As String * 8

    Inspe_Proc_GAI = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（向け先）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_MTS    '向け先
                                
                                
                                
                        Call UniCode_Conv(K2_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).Recv_text(i))
                        sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K2_MTS, Len(K2_MTS), 2)
                        Select Case sts
                            Case BtNoErr
                                If Len(Trim(StrConv(MTSREC.SS_CODE, vbUnicode))) <> 0 Then
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "出荷先エラー", "", "")
                
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Inspe_Proc_GAI = False
                                    Exit Function
                                
                                End If
                            
                            Case BtErrKeyNotFound
                            
                                Call UniCode_Conv(K3_MTS.SS_CODE, ID_KANRI_TBL(ING_No).Recv_text(i))
                                                    
                                sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K3_MTS, Len(K3_MTS), 3)
                                Select Case sts
                                    Case BtNoErr
                                    
                                    Case BtErrKeyNotFound
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "出荷先エラー", "", "")
                
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                        Inspe_Proc_GAI = False
                                        Exit Function
                                    
                                    Case Else
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "向け先管理マスタ", 0)
                                        Exit Function
                                End Select
                    
                        End Select
                         
                        MTS_CODE = (ID_KANRI_TBL(ING_No).Recv_text(i))
                        SS_CODE = ""
                         
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = ""
                        
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN_BOU
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, MTS_CODE & SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, MTS_CODE & SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "13"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        
        
        Case Step_Sagyo2_RES        '２回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
                Select Case wkTEXT
                
                
                    Case LCD_ID_No      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "検品作業不可", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_GAI = False
                            Exit Function
                        End If
    
    
    
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        For DEN_ID_LOOP = 0 To UBound(JGYOBU_T) '2006.06.01
                        
                            sts = Y_Syuka_Chek_Proc(KAN_KBN_FIN, _
                                                    JGYOBU_T(DEN_ID_LOOP).CODE, _
                                                    NAIGAI, _
                                                    Hinban, _
                                                    MTS_CODE, _
                                                    SS_CODE, _
                                                    CYU_KBN, _
                                                    Y_SYU_CNT, _
                                                    ID_NO, _
                                                    SYUKA_QTY, _
                                                    DEN_NO, _
                                                    KAN_KBN, _
                                                    JITU_QTY, _
                                                    DEN_ID_JGYOBU, _
                                                    wkKENPIN_YMD, , _
                                                    LK_MUKE_CODE)
                            If sts <> False Or Y_SYU_CNT <> 0 Then
                                Exit For
                            End If
                        
                        Next DEN_ID_LOOP
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_GAI = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_GAI = False
                                Exit Function
                        End Select
                        
                        
                        '------------------ 向け先のチェック
                        If ID_KANRI_TBL(ING_No).MTS_CODE <> LK_MUKE_CODE Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "向け先エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_GAI = False
                            Exit Function
                        End If
                        '------------------ 注文区分のチェック
                        If ID_KANRI_TBL(ING_No).CYU_KBN <> CYU_KBN Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "注文区分ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_GAI = False
                            Exit Function
                        End If
                        '------------------ 出庫完了のチェック
                        If Inspection_Flg = 0 Then
                            If KAN_KBN <> KAN_KBN_FIN Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "作業未完了", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_GAI = False
                                Exit Function
                            End If
                        End If
                        
                        '------------------ 再検品のチェック    2007.10.10
                        If Inspection_CHK = 1 Then
                            If Trim(wkKENPIN_YMD) <> "" Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "検品済です", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_GAI = False
                                Exit Function
                            End If
                        End If
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).MTS_CODE = LK_MUKE_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = ""
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Y_SYU_CNT = Y_SYU_CNT
                        ID_KANRI_TBL(ING_No).SYUKA_QTY = JITU_QTY
                        ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU = DEN_ID_JGYOBU      '2006.06.01
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
'2007.07.21                        Send_Text.Box_Type(3).Max_Size = "13"
'2007.07.21                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "13"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo3_RES        '３回目の受信（品番）
            For i = 0 To M_Gyo - 1
            
                
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
'                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                Select Case wkTEXT
                '2007.07.21 ↑
                    
                    Case LCD_Hinban     '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_GAI = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "品番エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_GAI = False
                            Exit Function
                        End If
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        '2009.07.29
                        If ID_KANRI_TBL(ING_No).SYUKA_QTY > 1 Then
                        
                            Send_Text.buzzer = Wel_Inspe_BUZZER                 'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Wel_Inspe_BUZZER
                        
                        Else
                            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        End If
                        
                        '-----------------------------------------------１行目
'                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(0).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(0).Start_Pos = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(0).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
'                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目


                        
                        
                        '2009.04.16
                        wkNull_Check = Replace(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode), Chr(0), " ")
                        If Trim(wkNull_Check) = "" Then
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Else
                                                                                    
                                                                                    
                            Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                                                                                    
                                                                                    
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Trim(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode)))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Trim(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode)))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        End If



                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        Case Step_Sagyo4_RES        '４回目の受信（Any Key）
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            '出荷予定の読み込み
            '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU)     '事業部
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'ID
    
            Do
            
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrKeyNotFound
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_GAI = False
                        GoTo Abort_Tran
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_GAI = False
                        GoTo Abort_Tran
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
        
            Loop
    
    
            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
            Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                            
            '2006.07.20 検品担当者出力追加
            Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
            Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                            
                                            
                                            '出荷予定書込み
            Do
                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_GAI = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        Inspe_Proc_GAI = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop
                                        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                        
                                        
                                        
            '2004.07.16 ↓
            
            '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
            
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        "", , , , , MENU_NO, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE, _
                                        ID_KANRI_TBL(ING_No).SS_CODE, _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Inspe_Proc_GAI = SYS_ERR
                    GoTo Abort_Tran
            End Select
            '2004.07.16 ↑
                                        
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                '検品確認終了時は、伝票ＩＤ要求に戻す為の特殊処理
                
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "12"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()


'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
            
                Sendbuf = Text_Create_Proc()
    
    
    End Select

    Inspe_Proc_GAI = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function


Public Function Inspe_Proc_Drct(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『(新)直送検品処理』 荷積明細コピー元
'       2016.10.14
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8
Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1
Dim HIN_NO          As String * 13


Dim KAN_FLG         As String * 1

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1


Dim DEN_ID_LOOP     As Integer      '2006.06.01
Dim DEN_ID_JGYOBU   As String * 1   '2006.06.01

Dim wkKENPIN_YMD    As String * 8   '検品日付   2007.10.10


Dim wkTEXT          As String           '2007.07.21

Dim MENU_NO         As String * 2

Dim wkNull_Check    As String       '2009.04.27

Dim Mod_Return      As Integer      '2010.12.09
Dim iNum            As Integer      '2010.12.09

Dim DelvNo          As String * 20

Dim com             As Integer


    Inspe_Proc_Drct = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（送り状ａj
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    
                    Case LCD_OKURI_NO   '送り状
                    
                        DelvNo = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        '---------------------  送り状づﾞｰﾀ
                        Call UniCode_Conv(K0_HTDelvNo.DelvNo, DelvNo)
                        sts = BTRV(BtOpGetEqual, HTDelvNo_POS, HTDelvNoREC, Len(HTDelvNoREC), K0_HTDelvNo, Len(K0_HTDelvNo), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, DelvNo, "送り状ｖ｢登録です", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_Drct = False
                                Exit Function
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "HTDelvNO", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).cho_OKURI_NO = DelvNo
                        ID_KANRI_TBL(ING_No).cho_ChoCode = StrConv(HTDelvNoREC.ChoCode, vbUnicode)
                                    
                    
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                    
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, DelvNo)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, DelvNo)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, StrConv(HTDelvNoREC.ChoCode, vbUnicode))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, StrConv(HTDelvNoREC.ChoCode, vbUnicode))
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                    
                    
                End Select
                
            Next i
                    
                    
        Case Step_Sagyo2_RES        '２回目の受信（伝票ID）
                    
            For i = 0 To M_Gyo - 1
                
'                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                Select Case i
                    
                    
                    Case 2      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "検品作業不可", "伝票ID≠13桁", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_Drct = False
                            Exit Function
                        End If
    
    
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        
                        '---------------------  直送先IDﾃﾞｰﾀ
                        Call UniCode_Conv(K0_HTDrctId.IDNO, ID_NO)
                        sts = BTRV(BtOpGetEqual, HTDrctId_POS, HTDrctIdREC, Len(HTDrctIdREC), K0_HTDrctId, Len(K0_HTDrctId), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_NO, ID_KANRI_TBL(ING_No).cho_ChoCode, "出荷予定が有りません", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_Drct = False
                                Exit Function
                            Case Else
                                Call File_Error(sts, BtOpGetEqual, "HTDelvNO", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                        
                        
                        If Trim(ID_KANRI_TBL(ING_No).cho_ChoCode) <> Trim(StrConv(HTDrctIdREC.ChoCode, vbUnicode)) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_NO, ID_KANRI_TBL(ING_No).cho_ChoCode, Trim(StrConv(HTDrctIdREC.ChoCode, vbUnicode)), "直送先が異なります")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_Drct = False
                            Exit Function
                        End If
                        
                        
                        
                        
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
'                        sts = Y_Syuka_Chek_Proc(KAN_KBN_FIN, _
'                                                ID_KANRI_TBL(ING_No).JGYOBU, _
'                                                NAIGAI, _
'                                                Hinban, _
'                                                MTS_CODE, _
'                                                SS_CODE, _
'                                                CYU_KBN, _
'                                                Y_SYU_CNT, _
'                                                ID_NO, _
'                                                SYUKA_QTY, _
'                                                DEN_NO, _
'                                                KAN_KBN, _
'                                                JITU_QTY)
                        
                        
                        
                        
                        For DEN_ID_LOOP = 0 To UBound(JGYOBU_T) '2006.06.01
                        
                            '2007.10.10 引数　検品日付追加
                            sts = Y_Syuka_Chek_Proc(KAN_KBN_FIN, _
                                                    JGYOBU_T(DEN_ID_LOOP).CODE, _
                                                    NAIGAI, _
                                                    Hinban, _
                                                    MTS_CODE, _
                                                    SS_CODE, _
                                                    CYU_KBN, _
                                                    Y_SYU_CNT, _
                                                    ID_NO, _
                                                    SYUKA_QTY, _
                                                    DEN_NO, _
                                                    KAN_KBN, _
                                                    JITU_QTY, _
                                                    DEN_ID_JGYOBU, _
                                                    wkKENPIN_YMD)
                            If sts <> False Or Y_SYU_CNT <> 0 Then
                                Exit For
                            End If
                        
                        Next DEN_ID_LOOP
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_NO, "出荷予定が有りません", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_Drct = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_NO, "出荷予定使用中です", "", "")
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_Drct = False
                                Exit Function
                        End Select
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2016.10.14
'                        '------------------ 向け先のチェック
'                        If ID_KANRI_TBL(ING_No).MTS_CODE <> MTS_CODE Or _
'                            ID_KANRI_TBL(ING_No).SS_CODE <> SS_CODE Then
'
'
''---------------------------    データ解放を追加    2011.07.29
'                            sts = Data_Clear_Proc(0, Sendbuf)
'                            Select Case sts
'                                Case SYS_CANCEL
'                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
'                                    Sendbuf = Text_Create_Proc()
'                                    Exit Function
'
'                                Case SYS_ERR
'                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                    Sendbuf = Text_Create_Proc()
'                                    Exit Function
'                            End Select
''---------------------------    データ解放を追加    2011.07.29
'
'
'
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "向け先エラー", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                            Inspe_Proc_Drct = False
'                            Exit Function
'                        End If
'
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2016.10.14
                        
                        '------------------ 注文区分のチェック
                        If ID_KANRI_TBL(ING_No).CYU_KBN <> CYU_KBN Then
                            
                            
                            
'---------------------------    データ解放を追加    2011.07.29
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
'---------------------------    データ解放を追加    2011.07.29
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_NO, "注文区分が違います", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_Drct = False
                            Exit Function
                        End If
                        '------------------ 出庫完了のチェック
                        If Inspection_Flg = 0 Then
                            If KAN_KBN <> KAN_KBN_FIN Then
                                
                                
                                
'---------------------------    データ解放を追加    2011.07.29
                                sts = Data_Clear_Proc(0, Sendbuf)
                                Select Case sts
                                    Case SYS_CANCEL
                                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    
                                    Case SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
'---------------------------    データ解放を追加    2011.07.29
                                
                                
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_NO, "出庫作業が未完了です", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_Drct = False
                                Exit Function
                            End If
                        End If
                        
                        
                        
''                        '------------------ 再検品のチェック    2007.10.10
''                        If Inspection_CHK = 1 Then
''                            If Trim(wkKENPIN_YMD) <> "" Then
''
''
'''---------------------------    データ解放を追加    2011.07.29
''                                sts = Data_Clear_Proc(0, Sendbuf)
''                                Select Case sts
''                                    Case SYS_CANCEL
''                                        Call Err_Send_Proc("データ使用中", "", "", "", "")
''                                        Sendbuf = Text_Create_Proc()
''                                        Exit Function
''
''                                    Case SYS_ERR
''                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
''                                        Sendbuf = Text_Create_Proc()
''                                        Exit Function
''                                End Select
'''---------------------------    データ解放を追加    2011.07.29
''                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "検品済です", "", "")
''                                Sendbuf = Text_Create_Proc()
''                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
''                                Inspe_Proc_MTS = False
''                                Exit Function
''                            End If
''                        End If
                        
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Y_SYU_CNT = Y_SYU_CNT
                        ID_KANRI_TBL(ING_No).SYUKA_QTY = JITU_QTY
                        
                        
                        ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU = DEN_ID_JGYOBU      '2006.06.01
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).cho_OKURI_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).cho_OKURI_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "20"                       '2007.07.21
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"  '2007.07.21
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo3_RES        '２回目の受信（品番）
            For i = 0 To M_Gyo - 1
            
                '2007.07.21 ↓
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
                Select Case wkTEXT
                
                                    
                    Case LCD_Hinban     '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
'                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Trim(ID_KANRI_TBL(ING_No).Hinban), RET_JGYOBU, RET_NAIGAI)

                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_Drct = False
                                Exit Function
                    
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
'                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                        If Trim(Hinban) <> RTrim(StrConv(ITEMREC.HIN_GAI, vbUnicode)) Then
                            If Trim(Hinban) <> RTrim(StrConv(ITEMREC.HIN_CHANGE, vbUnicode)) Then
                                If Trim(Hinban) <> RTrim(StrConv(ITEMREC.JAN_CODE, vbUnicode)) Then
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_Drct = False
                                    Exit Function
                                End If
                            End If
                        End If
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        
                        '2009.07.29
                        If ID_KANRI_TBL(ING_No).SYUKA_QTY > 1 Then
                        
                            Send_Text.buzzer = Wel_Inspe_BUZZER                 'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Wel_Inspe_BUZZER
                        
                        Else
                            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        End If
                        
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).cho_OKURI_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).cho_OKURI_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                        wkNull_Check = Replace(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode), Chr(0), " ")
                        If Trim(wkNull_Check) = "" Then
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            If IsNumeric(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)) Then
                                If Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode)) <> 0 Then
                                    Mod_Return = ID_KANRI_TBL(ING_No).SYUKA_QTY Mod Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                                    iNum = CInt(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).SYUKA_QTY) / CCur(Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))), 0))
                            
                                    
                                    Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                            
                            
                                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                            '表示内容
                                    
                                    If Mod_Return <> 0 Then
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱＋" & StrConv(Format(Mod_Return, "#0"), vbWide) & "余")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱＋" & StrConv(Format(Mod_Return, "#0"), vbWide) & "余")
                                    Else
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "　外装：" & StrConv(Format(iNum, "#0"), vbWide) & "箱")
                                    End If
                                    
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(4).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                            '入力桁数
                                     Send_Text.Box_Type(4).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                                End If
                            
                                                        
                            End If



                        Else
                                                                                    
                                                                                    
                            Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                                                                                    
                                                                                    
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Trim(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode)))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Trim(StrConv(ITEMREC.INSP_MESSAGE, vbUnicode)))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        End If


                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        Case Step_Sagyo4_RES        '３回目の受信（Any Key）
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            '出荷予定の読み込み
            '2006.06.01 ID_KANRI_TBL(ING_No).JGYOBU--> DEN_ID_JGYOBU
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU)      '事業部
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)           'ID
    
            Do
            
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrKeyNotFound
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_Drct = False
                        GoTo Abort_Tran
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_Drct = False
                        GoTo Abort_Tran
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
        
            Loop
    
    
            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
            Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                            
            Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
            Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                            
                                            '出荷予定書込み
            Do
                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_Drct = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        Inspe_Proc_Drct = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop
                                        
                                        
                                        
                                        
'>>>>>>>>>>>>>>>>>>>>>>>>>  ID・送り状づﾞｰﾀ出力
            Call UniCode_Conv(K0_HTIdDelv.IDNO, ID_KANRI_TBL(ING_No).ID_NO)
            Call UniCode_Conv(K0_HTIdDelv.DelvNo, ID_KANRI_TBL(ING_No).cho_OKURI_NO)
            Do
            
                sts = BTRV(BtOpGetEqual + BtSNoWait, HTIdDelv_POS, HTIdDelvREC, Len(HTIdDelvREC), K0_HTIdDelv, Len(K0_HTIdDelv), 0)
                Select Case sts
                    Case BtNoErr
                        com = BtOpUpdate
                        Exit Do
                    Case BtErrKeyNotFound
                        com = BtOpInsert
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).cho_OKURI_NO, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO, "HtIdDelv.DAT", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_Drct = False
                        GoTo Abort_Tran
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "HtIdDelv.DAT", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
        
            Loop
    
    
            
            If com = BtOpInsert Then
                Call UniCode_Conv(HTIdDelvREC.IDNO, ID_KANRI_TBL(ING_No).ID_NO)
                Call UniCode_Conv(HTIdDelvREC.DelvNo, ID_KANRI_TBL(ING_No).cho_OKURI_NO)
            
            
                Call UniCode_Conv(HTIdDelvREC.EntID, ID_KANRI_TBL(ING_No).TANTO_CODE)
                Call UniCode_Conv(HTIdDelvREC.EntTm, Format(Now, "YYYYMMDDHHMMSS"))
            
                Call UniCode_Conv(HTIdDelvREC.UpdID, "")
                Call UniCode_Conv(HTIdDelvREC.UpdTm, "")
            
            
            Else
            
                Call UniCode_Conv(HTIdDelvREC.UpdID, ID_KANRI_TBL(ING_No).TANTO_CODE)
                Call UniCode_Conv(HTIdDelvREC.UpdTm, Format(Now, "YYYYMMDDHHMMSS"))
            End If
                                            '出荷予定書込み
            Do
                sts = BTRV(com, HTIdDelv_POS, HTIdDelvREC, Len(HTIdDelvREC), K0_HTIdDelv, Len(K0_HTIdDelv), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_Drct = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        Inspe_Proc_Drct = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop




                                        
                                        
                                        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                        
            '2004.07.16 ↓
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        "", , , , , MENU_NO, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE, _
                                        ID_KANRI_TBL(ING_No).SS_CODE, _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Inspe_Proc_Drct = SYS_ERR
                    GoTo Abort_Tran
            End Select
            '2004.07.16 ↑
                                        
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
        
            '-----------------------------------------------ヘッダー
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
            
            '-----------------------------------------------１行目
                                                                    'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).cho_OKURI_NO)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).cho_OKURI_NO)
                                                                    '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                                    'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).cho_ChoCode)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).cho_ChoCode)
                                                                    '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(1).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                                    'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                    '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                                    
                                                                    
                                                                    
            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                                    'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                    '数値初期表示
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(3).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------４行目
                                                                    'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                    '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                    '入力桁数
             Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

            Sendbuf = Text_Create_Proc()

    
    End Select

    Inspe_Proc_Drct = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function



Public Function KYOSEI_END_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品強制完了（宅配伝票読み込み 大阪ＰＣ向け）』
'
'       2006.12.21
'-------------------------------------------------------
Dim sts             As Integer


'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07


Dim SYUKA_QTY       As Long
Dim MTS_CODE        As String * 8

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim OKURI_NO        As String
Dim KUTI_SU         As Integer

Dim SAI_SU          As Double
Dim JYURYO          As Integer


Dim UNSOU_KAISHA    As String

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag


Dim KAN_FLG         As String * 1

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer

Dim DEN_ID_LOOP     As Integer
Dim DEN_ID_JGYOBU   As String * 1

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 7
Dim KAN_KBN         As String * 1


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2


Dim KENPIN_END      As Boolean

Dim OKURI_SAKI      As String
Dim KENPIN_END_MARK As String * 1


Dim CANCEL_F        As Boolean

Dim Found_F         As Boolean


Dim OKURI_NO_F      As Boolean

Dim FUKUYAMA_CHK_F  As Boolean


    KYOSEI_END_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                                
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase Y_SYU_TBL
                                        
                        sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                                MTS_CODE, _
                                                Y_SYU_CNT, _
                                                Sumi_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                Y_SYU_TBL(), _
                                                OKURI_NO, _
                                                UNSOU_KAISHA, _
                                                OKURI_SAKI, _
                                                Found_F, , , , , , , , KUTI_SU, SAI_SU)
                        
                        
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.10.04  削除
'                        '他端末で使用中 2011.04.07
'                        If sts = SYS_CANCEL Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "出荷予定使用中", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                            KYOSEI_END_PROC = False
'                            Exit Function
'                        End If
'                        '他端末で使用中 2011.04.07
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2012.10.04  削除
                        
                        
                        
                        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                        If Found_F Then
                            CANCEL_F = True
                                                     
                            For j = 0 To UBound(Y_SYU_TBL)
                            
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    CANCEL_F = False
                                    Exit For
                                End If
                            
                            Next j
                                                     
                                                     
                            If CANCEL_F Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KYOSEI_END_PROC = False
                                Exit Function
                            End If
                        End If
                        
                        
                        If Y_SYU_CNT = 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        End If
                
                        
                        If Y_SYU_CNT = Sumi_CNT Then

                            If Trim(OKURI_NO) = "" Then

                                KENPIN_END_MARK = ""
                            Else
                                KENPIN_END_MARK = "*"


                            End If
                        Else
                            KENPIN_END_MARK = ""

                        End If
                        
                        
                        
                        '検品を強制で完了する
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                                                         
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                                
                                
                                
                        Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                                
                        For j = 0 To UBound(Y_SYU_TBL)
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                        
                        Next j
                            
                            
                            
                        ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = UNSOU_KAISHA
                            
                        ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = OKURI_SAKI
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                            
                        ID_KANRI_TBL(ING_No).SAI_SU = SAI_SU
                        ID_KANRI_TBL(ING_No).KUTI_SU = KUTI_SU
                            
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                                
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                
                        '-----------------------------------------------１行目
'                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
'                                                                                '表示内容
'                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'                                                                                '数値初期表示
'                        Send_Text.Box_Type(0).INIT = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
'                                                                                '初期カーソル位置
'                        Send_Text.Box_Type(0).Start_Pos = ""
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                                                '入力桁数
'                        Send_Text.Box_Type(0).Max_Size = "00"
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
'                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
'                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, LCD_ID_No & ":" & Trim(KENPIN_END_MARK) & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, LCD_ID_No & ":" & Trim(KENPIN_END_MARK) & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(Y_SYU_CNT, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                
                                
                                
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                
                                
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                        If Not IsNumeric(OKURI_NO) Then
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(UNSOU_KAISHA) & LCD_OKURI_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(UNSOU_KAISHA) & LCD_OKURI_NO)
                        Else
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, OKURI_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, OKURI_NO)
                        End If
                            
                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                                
                                
                        '-----------------------------------------------５行目
                        
                        If KUTI_SU = 0 Then
                            KUTI_SU = 1
                        End If
                                    
                                    
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU)
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(Trim(Format(KUTI_SU, "#0")))) & Trim(Format(KUTI_SU, "#0"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Trim(Format(KUTI_SU, "#0")))) & Trim(Format(KUTI_SU, "#0"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "07"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "07"
                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "04"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "04"
                        
                        
                        
                        '-----------------------------------------------５行目
                                    
                                    
                        If SAI_SU = 0 Then
                        Else
                            If SAI_SU < 1 Then
                                SAI_SU = 1
                            Else
                                If SAI_SU > 1 Then
                                    SAI_SU = CLng(ToHalfAdjust(CCur(SAI_SU), 0))
                                End If
                            End If
                        End If
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(SAI_SU, "#0")))) & Trim(Format(SAI_SU, "#0"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(SAI_SU, "#0")))) & Trim(Format(SAI_SU, "#0"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "07"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "07"
                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "04"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "04"
                        
                        
                        Sendbuf = Text_Create_Proc()
                            
                        KYOSEI_END_PROC = False
                        Exit Function
                            
                End Select
            Next i
        
                
        Case Step_Sagyo2_RES        '２回目の受信（送り状,口数）
                
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                    
                        If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) = "" Then
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                            
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        'チャーター便   2010.01.21
                        
                        Else



'2009.10.14                        If Len(OKURI_NO) < 11 Or Len(OKURI_NO) > 13 Then
'                            If Len(OKURI_NO) < 10 Or Len(OKURI_NO) > 13 Then
'
'
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
'
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                KYOSEI_END_PROC = False
'                                Exit Function
'
'                            End If
                    
                            If Not IsNumeric(OKURI_NO) Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KYOSEI_END_PROC = False
                                Exit Function
                            End If
                    
                    
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            
                            
                            
                            
                            If Not OKURI_NO_F Then
                            
'2017.09.22
                        
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KYOSEI_END_PROC = False
                                Exit Function
                                                
                            End If
                    
                    
                    
                            '2009.04.28
                            If FUKUYAMA_CHK_F Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KYOSEI_END_PROC = False
                                Exit Function
                            
                            End If
                            '2009.04.28
                    
                    
                    
'                            Select Case Len(Trim(OKURI_NO))
'
'                                Case FUKUYAMA_Length
'                                Case SEIBU_Length
'                                Case KURUME_Length
'
'                                    For k = 0 To UBound(KURUME_CODE)
'
'                                        If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
'                                            Exit For
'                                        End If
'                                    Next k
'
'                                    If k > UBound(KURUME_CODE) Then
'
'
'                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
'
'                                        Sendbuf = Text_Create_Proc()
'                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                        KYOSEI_END_PROC = False
'                                        Exit Function
'
'                                    End If
'
'                                Case SAGAWA_Length, YAMATO_Length
'
'                                    For k = 0 To UBound(KURUME_CODE)
'
'                                        If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
'                                            Exit For
'                                        End If
'                                    Next k
'
'                                    If k > UBound(SAGAWA_CODE) Then
'
'                                        For k = 0 To UBound(YAMATO_CODE)
'
'                                            If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
'                                                Exit For
'                                            End If
'
'                                        Next k
'
'                                        If k > UBound(YAMATO_CODE) Then
'
'                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
'
'                                            Sendbuf = Text_Create_Proc()
'                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                            KYOSEI_END_PROC = False
'                                            Exit Function
'
'
'
'                                        End If
'
'                                    End If
'
'
'                            End Select
                    
                    
                    
                                                
                    
                    
                    
                            ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO
                    
                    
                    
                        End If
                    
                    
                    '口数
                    Case LCD_KUTI_SU
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            '2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                
                        KUTI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If KUTI_SU < 1 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        End If
                
                
                
                    '才数
                    Case LCD_SAI_SU
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                
                        SAI_SU = CInt(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
'                        If SAI_SU < 1 Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
'
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                            KYOSEI_END_PROC = False
'                            Exit Function
'                        End If
                
                
                        
                        If KUTI_SU = 0 And SAI_SU = 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                        
                
                        If KUTI_SU = 0 And SAI_SU <> 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                
                
                        JYURYO = 0
                
                        If KUTI_SU = 1 And SAI_SU = 0 Then
                            JYURYO = 2
                        End If
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                            
                                            
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
                        '------------------------------------   出荷予定の処理
                            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                                'ID
                            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
Debug.Print Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO
                            Do
                            
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        KYOSEI_END_PROC = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        KYOSEI_END_PROC = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                        
                            Loop
    
                            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
                            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                        
                            
                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                            
                                Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                            
                                Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                            
                            End If
                                                '出荷予定書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        KYOSEI_END_PROC = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                        KYOSEI_END_PROC = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                            '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
'                            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                'ID_NO
                                Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                                Do
                        
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                    
                                Loop
                                            
                                            
                                If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
                                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                    Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                                
                                    Call UniCode_Conv(Y_SYU_HREC.JURYO, Format(JYURYO, "0000.0"))
                   
                                                
                                                
                                    If Trim(StrConv(Y_SYU_HREC.KENPIN_NOW, vbUnicode)) = "" Then
                                    
                                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                                    
                                        Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                    
                                        Call UniCode_Conv(Y_SYU_HREC.KYOSEI_END, "1")
                                    
                                    End If
                                                
    '                                '運送会社変換
    '                                If Left(OKURI_NO, 3) = UNSOU_KAISHA_CODE Then
    '                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, UNSOU_KAISHA_NAME)
    '                                End If
    '
    '
    '                                '新運送会社変換 2007.01.09
    '
    '                                If KURUME_F Then        '久留米
    '                                    For k = 1 To UBound(KURUME)
    '
    '                                        If Left(OKURI_NO, Len(KURUME(k))) = KURUME(k) Then
    '                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME(0))
    '                                            Exit For
    '                                        End If
    '                                    Next k
    '                                End If
    '
    '                                If FUKUYAMA_F Then      '福山
    '                                    For k = 1 To UBound(FUKUYAMA)
    '
    '                                        If Left(OKURI_NO, Len(FUKUYAMA(k))) = FUKUYAMA(k) Then
    '                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA(0))
    '                                            Exit For
    '                                        End If
    '                                    Next k
    '                                End If
    '
    '                                If SAGAWA_F Then        '佐川
    '                                    For k = 1 To UBound(SAGAWA)
    '
    '                                        If Left(OKURI_NO, Len(SAGAWA(k))) = SAGAWA(k) Then
    '                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA(0))
    '                                            Exit For
    '                                        End If
    '                                    Next k
    '                                End If
                                                        
                                                        
                                                        
                                                        
    '                                Select Case Len(Trim(OKURI_NO))
    '
    '                                    Case FUKUYAMA_Length
    '                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
    '                                    Case SEIBU_Length
    '                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
    '
    '                                    Case KURUME_Length
    '
    '                                        For k = 0 To UBound(KURUME_CODE)
    '
    '                                            If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
    '                                                Exit For
    '                                            End If
    '                                        Next k
    '
    '                                        If k > UBound(KURUME_CODE) Then
    '                                        Else
    '                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
    '                                        End If
    '
    '                                    Case SAGAWA_Length, YAMATO_Length
    '
    '                                        For k = 0 To UBound(KURUME_CODE)
    '
    '                                            If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
    '                                                Exit For
    '                                            End If
    '                                        Next k
    '
    '                                        If k > UBound(SAGAWA_CODE) Then
    '
    '                                            For k = 0 To UBound(YAMATO_CODE)
    '
    '                                                If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
    '                                                    Exit For
    '                                                End If
    '
    '                                            Next k
    '
    '                                            If k > UBound(YAMATO_CODE) Then
    '                                            Else
    '
    '                                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
    '                                            End If
    '
    '                                        Else
    '                                            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
    '                                        End If
    '
    '
    '                                End Select
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                                        
                                    '物流 2010.02.19
    '                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_CHARTER_CD) Then
    '                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "物流")
    '                                End If
    '
    '                                '赤帽 2010.02.19
    '                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_AKABOU_CD) Then
    '                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "赤帽")
    '                                End If
    '
    
    
    
                                    Call OKURI_NO_SET_PROC(OKURI_NO)
    
    
    
    '                                'ロジステック 2010.02.19
                                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "ロジステック")
                                    End If
                                Else
                                                    
                                                    
                                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, "")
                                    Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, "")
                                    Call UniCode_Conv(Y_SYU_HREC.SAI_SU, "")
                                                
                                    Call UniCode_Conv(Y_SYU_HREC.JURYO, "")
                                                    
                                                    
                                End If
                                                    
                                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                    
                                                    
                                                    
                                                    '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                                Do
                                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                    
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                            KYOSEI_END_PROC = SYS_ERR
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
'                            End If
                                        
                                        
                                        
                            '------------------------------------   在庫移動履歴の処理      2010.10.28
'                            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
'                                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
'
'                            Else
'                                MENU_NO = ""
'                            End If
'
'                            '履歴出力の為の読み込み
'                            Call UniCode_Conv(K0_MTS.MUKE_CODE, StrConv(Y_SYUREC.MUKE_CODE, vbUnicode))
'                            Call UniCode_Conv(K0_MTS.SS_CODE, "")
'                            sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
'                            Select Case sts
'                                Case BtNoErr
'                                Case BtErrKeyNotFound
'                                    Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
'                                    Call UniCode_Conv(MTSREC.MUKE_NAME, "")
'                                Case Else
'                                    Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
'                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                    Sendbuf = Text_Create_Proc()
'                                    Exit Function
'                            End Select
'
'                            sts = IDOREKI_OUTPUT_PROC("", _
'                                                        "", _
'                                                        ID_KANRI_TBL(ING_No).JGYOBU, _
'                                                        ID_KANRI_TBL(ING_No).NAIGAI, _
'                                                        StrConv(Y_SYUREC.HIN_NO, vbUnicode), _
'                                                        "", _
'                                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
'                                                        0, _
'                                                        0, _
'                                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
'                                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                                        FILE_RETRY, _
'                                                        CYU_KBN_SPO, _
'                                                        Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
'                                                        , , , , MENU_NO, _
'                                                        StrConv(Y_SYUREC.MUKE_CODE, vbUnicode), _
'                                                        "", _
'                                                        ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO, , , , 1)
'                            Select Case sts
'                                Case False      '正常終了
'                                Case Else
'                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                    Sendbuf = Text_Create_Proc()
'                                    KYOSEI_END_PROC = SYS_ERR
'                                    GoTo Abort_Tran
'                            End Select
'
'
'
'
                        Next j
'
'
'
'                    '作業ﾛｸﾞ出力    2010.10.28
'                    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
'                        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
'
'                    Else
'
'                        MENU_NO = ""
'                    End If
'                    If Trim(MENU_NO) = "" Then
'                    Else
'                    '作業ﾛｸﾞ出力
'
'                        If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
'                                                            ID_KANRI_TBL(ING_No).JGYOBU, _
'                                                            ID_KANRI_TBL(ING_No).NAIGAI, _
'                                                            MENU_NO, _
'                                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
'                                                             , , , , , _
'                                                             ID_KANRI_TBL(ING_No).ID_NO) Then
'                            KYOSEI_END_PROC = SYS_ERR
'                            Exit Function
'                        End If
'                    End If
                    '作業ﾛｸﾞ出力    2010.10.28
                                            
                                            
                                            
                                            
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                
                                        '次の作業要求
            
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                            Exit Function
                        End Select
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
                
                
                
                
                
            Next i
                
                
                
                
    
    
    End Select

    KYOSEI_END_PROC = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function

Public Function Y_Syuka_H_Chek_Proc(JGYOBU As String, _
                                        MTS_CODE As String, _
                                        Y_SYU_CNT As Integer, _
                                        Sumi_CNT As Integer, _
                                        ID_NO As String, _
                                        SYUKA_QTY As Long, _
                                        DEN_NO As String, _
                                        Y_SYU_TBL() As KEN_DEN_TBL_Tag, _
                                        OKURI_NO As String, _
                                        UNSOU_KAISHA As String, _
                                        OKURI_SAKI As String, _
                                        Found_F As Boolean, _
                                        Optional SYUKA_YMD As String, _
                                        Optional JYUSHO As String, _
                                        Optional BIKOU As String, _
                                        Optional Start_Page_No As Long, _
                                        Optional KUTI_SU As Long, _
                                        Optional MUKE_NAME As String, _
                                        Optional OKURI_NO_MAX As Integer, _
                                        Optional Label_RePrint_Kuti_Su As Integer, _
                                        Optional Label_RePrint_Sai_Su As Double, _
                                        Optional KEN_TEL_NO As String, _
                                        Optional KEN_HINBAN As String, _
                                        Optional OKURISAKI_CD As String, _
                                        Optional KEN_TYAKUTEN As String) As Integer
'-------------------------------------------------------
'
'   『出荷予定の使用予約』
'   大阪ＰＣ用  2006.12.07
'   KEN_HINBAN追加  2012.10.02
'   OKURISAKI_CD追加  2015.10.21
'   KEN_TYAKUTEN追加    2017.04.06
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer


Dim ans         As Integer

Dim RETRY_CNT   As Integer

Dim i           As Integer
Dim j           As Integer

Dim FAST_F      As Boolean


Dim KONPOU_ON   As Boolean
Dim KONPOU_OFF  As Boolean
Dim wkTOTAL     As Long
Dim wkKUTI_SU   As Long


Dim GET_F       As Boolean


Dim CANCEL_F    As Boolean

Dim OKURISAKI_CD_F  As Boolean          '2015.12.22
Dim m               As Integer          '2015.12.22


    Y_Syuka_H_Chek_Proc = True
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Y_Syuka_H_Chek_Proc = SYS_ERR
        Exit Function
    End If



    Y_SYU_CNT = 0
    Sumi_CNT = 0
    OKURI_NO = ""
        
    Start_Page_No = 0
        
    Found_F = False
        
    '伝票ＩＤ指定での処理
    Call UniCode_Conv(K0_Y_SYU.JGYOBU, JGYOBU)
    Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_NO)
    
    RETRY_CNT = 0
    '出荷予定
    
    i = -1
    
    com = BtOpGetGreaterEqual
    
    Do
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        sts = BTRV(com + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
        Select Case sts
            Case BtNoErr
                
''''2010.09.29                If Trim(Left(StrConv(Y_SYUREC.ID_NO, vbUnicode), 7)) <> Trim(ID_NO) Then
                If StrConv(Y_SYUREC.ID_NO, vbUnicode) <> StrConv(Y_SYUREC.KEY_ID_NO, vbUnicode) Then

                    Call UniCode_Conv(Y_SYUREC.ID_NO, StrConv(Y_SYUREC.KEY_ID_NO, vbUnicode))

                End If
''''2010.09.29
Debug.Print StrConv(Y_SYUREC.KEY_ID_NO, vbUnicode)
Debug.Print StrConv(Y_SYUREC.ID_NO, vbUnicode)
                If Trim(Left(StrConv(Y_SYUREC.KEY_ID_NO, vbUnicode), 7)) <> Trim(ID_NO) Then
                    
                    
                    
                    sts = BTRV(BtOpUnlock, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                    If sts <> BtNoErr Then
                        Call File_Error(sts, BtOpUnlock, "出荷予定", 0)
                        Y_Syuka_H_Chek_Proc = SYS_ERR
                        GoTo Abort_Tran
                    End If
                        
                        
                    sts = BtErrEOF
                
                    Exit Do
                End If
            Case BtErrEOF
                Exit Do
            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                    Y_Syuka_H_Chek_Proc = SYS_CANCEL
                    GoTo Abort_Tran
                End If
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                Y_Syuka_H_Chek_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
        
If Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)) = "AD-HE37WF-C" Then
Debug.Print
End If
                                                
        If sts = BtErrEOF Then
            Exit Do
        End If
                                                
        '2013.01.24
        If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = Wel_KYOSEI_END Then
        
        Else
        '2013.01.24
            If Len(Trim(StrConv(Y_SYUREC.WEL_ID, vbUnicode))) = 0 And _
                Len(Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode))) = 0 Then
            Else
                If StrConv(Y_SYUREC.WEL_ID, vbUnicode) <> Format(ID_KANRI_TBL(ING_No).ID, "000") Or _
                    Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode)) <> StrConv(App.EXEName, vbUpperCase) Then
                                    '他で使用中
                    Y_Syuka_H_Chek_Proc = SYS_CANCEL
                    GoTo Abort_Tran
                End If
            End If
        End If      '2013.01.24
        
        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))
    
    
        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
        Select Case sts
            Case BtNoErr
                
            Case BtErrKeyNotFound
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                Y_Syuka_H_Chek_Proc = SYS_CANCEL
                GoTo Abort_Tran
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                Y_Syuka_H_Chek_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
            
        Found_F = True
            
            
        If Trim(StrConv(Y_SYUREC.KENPIN_YMD, vbUnicode)) = "" Then
        Else
            
'''            If Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)) <> "" Then
'''
'''                OKURI_NO = StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)
'''            End If
            
'''            UNSOU_KAISHA = Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode))
            
'''            OKURI_SAKI = Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode))
        
        End If
            
        
        OKURI_NO_MAX = 0
            
        i = i + 1
        
        
        GET_F = False
        
        If Not GET_F Then
            MTS_CODE = StrConv(Y_SYUREC.MUKE_CODE, vbUnicode)
        
        
        
        
            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))
        
        
            sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
            Select Case sts
                Case BtNoErr
                    
                    
                    
                    If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) = "1" Then
                    Else
                    
                    
                        OKURI_SAKI = Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode))
                    
                        UNSOU_KAISHA = Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode))
                    
                        OKURI_NO = Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode))
                    
                    
                        SYUKA_YMD = Trim(StrConv(Y_SYU_HREC.SYUKA_YMD, vbUnicode))      '2010.01.21
                    
                        JYUSHO = Trim(StrConv(Y_SYU_HREC.JYUSHO, vbUnicode))            '2010.01.21
                        
                        BIKOU = Trim(StrConv(Y_SYU_HREC.BIKOU, vbUnicode))              '2010.01.21
                    
                        KEN_TEL_NO = Trim(StrConv(Y_SYU_HREC.TEL_NO, vbUnicode))        '2010.01.21
                    
                        KEN_TYAKUTEN = Trim(StrConv(Y_SYU_HREC.TYAKUTEN, vbUnicode))    '2017.04.06
                    
                                                                                        '2010.01.21
                        If Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode)) <> Trim(StrConv(Y_SYU_HREC.MUKE_NAME, vbUnicode)) Then
                            MUKE_NAME = Trim(StrConv(Y_SYU_HREC.MUKE_NAME, vbUnicode))
                        Else
                            MUKE_NAME = ""
                        End If
                    
                        If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU, vbUnicode)) Then             '2010.01.21
                            Label_RePrint_Kuti_Su = CInt(StrConv(Y_SYU_HREC.KUTI_SU, vbUnicode))
                        Else
                            Label_RePrint_Kuti_Su = 0
                        End If
                    
                        If IsNumeric(StrConv(Y_SYU_HREC.SAI_SU, vbUnicode)) Then             '2010.01.21
                            Label_RePrint_Sai_Su = CDbl(StrConv(Y_SYU_HREC.SAI_SU, vbUnicode))
                        Else
                            Label_RePrint_Sai_Su = 0
                        End If
                        
                        
                        KEN_HINBAN = StrConv(Y_SYU_HREC.KEN_HINBAN, vbUnicode)              '2012.10.02
                        
                        OKURISAKI_CD = Trim(StrConv(Y_SYU_HREC.OKURISAKI_CD, vbUnicode))    '2015.10.21
                        
                        
                        GET_F = True
                
                    End If
                Case BtErrKeyNotFound
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                    Y_Syuka_H_Chek_Proc = SYS_CANCEL
                    GoTo Abort_Tran
                Case Else
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                    Y_Syuka_H_Chek_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        
        
        
        
        
        
        
        
        
        
        End If
        
        
        ReDim Preserve Y_SYU_TBL(i)
'        Y_SYU_TBL(i).SEQ_NO = Right(Trim(StrConv(Y_SYUREC.ID_NO, vbUnicode)), 2)
        '2007.07.17
        Y_SYU_TBL(i).SEQ_NO = Mid(StrConv(Y_SYUREC.ID_NO, vbUnicode), 8, 3)
        
        
        Y_SYU_TBL(i).HIN_NO = StrConv(Y_SYUREC.HIN_NO, vbUnicode)
        Y_SYU_TBL(i).SURYO = CLng(StrConv(Y_SYUREC.SURYO, vbUnicode))
        
        
                
        If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) = "1" Then
            Y_SYU_TBL(i).CANCEL_F = True
        Else
            Y_SYU_TBL(i).CANCEL_F = False
        End If
        
        
        If Trim(StrConv(Y_SYUREC.KENPIN_YMD, vbUnicode)) = "" Then
            Y_SYU_TBL(i).SUMI = False
        Else
            Y_SYU_TBL(i).SUMI = True
        End If
        
        '出庫情報を獲得 2007.05.14
        Y_SYU_TBL(i).KAN_KBN = StrConv(Y_SYUREC.KAN_KBN, vbUnicode)
            
            
'        Y_SYU_TBL(i).KONPOU_F = StrConv(Y_SYU_HREC.KONPOU_F, vbUnicode)
            
        '梱包区分を獲得 2010.01.21
        Call UniCode_Conv(K0_ITEM.JGYOBU, StrConv(Y_SYUREC.JGYOBU, vbUnicode))
        Call UniCode_Conv(K0_ITEM.NAIGAI, StrConv(Y_SYUREC.NAIGAI, vbUnicode))
        Call UniCode_Conv(K0_ITEM.HIN_GAI, StrConv(Y_SYUREC.HIN_NO, vbUnicode))
                    
        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        Select Case sts
            Case BtNoErr
                
                'Y_SYU_TBL(i).KONPOU_F = StrConv(ITEMREC.KONPOU_F, vbUnicode)
                
                                
            
            
            
            
            
            Case BtErrKeyNotFound
                Y_SYU_TBL(i).KONPOU_F = ""
            
                If Y_SYU_TBL(i).SAI_SU = 0 Then
                    Y_SYU_TBL(i).SAI_SU = 0
                End If
                
                If Y_SYU_TBL(i).KUTI_SU = 0 Then
                    Y_SYU_TBL(i).KUTI_SU = 1
                End If
                Call UniCode_Conv(ITEMREC.SAI_SU, "00.00")
            
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目ﾏｽﾀ", 0)
                Y_Syuka_H_Chek_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
            
        Y_SYU_TBL(i).KONPOU_F = StrConv(ITEMREC.KONPOU_F, vbUnicode)
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2015.10.21　特定品番時、集合梱包で行えるようにする
        
        '送り先CDをテーブル参照へ    2015.12.22
        OKURISAKI_CD_F = False
        For m = 0 To UBound(KONPOU_OKURISAKI_CD)
                    
            If Trim(KONPOU_OKURISAKI_CD(m)) = Trim(StrConv(Y_SYU_HREC.OKURISAKI_CD, vbUnicode)) Then
                OKURISAKI_CD_F = True
                Exit For
            End If
        Next m
        '送り先CDをテーブル参照へ    2015.12.22
        
'        If Trim(StrConv(Y_SYU_HREC.OKURISAKI_CD, vbUnicode)) = "E83000ZZZ" Then            '2015.12.22
        If OKURISAKI_CD_F Then                                                              '2015.12.22
            If Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)) = "AD-HEJJ3N-C" _
            Or Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)) = "AD-HEJJ4N-C" _
            Or Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)) = "AD-HEH43N-C" _
            Or Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)) = "AD-HEH44N-C" _
            Or Trim(StrConv(Y_SYUREC.HIN_NO, vbUnicode)) = "AD-HEJP4N-C" Then  '2019/10/30 集合梱包AD-HEJP4N-Cを追加
                Y_SYU_TBL(i).KONPOU_F = ""
            End If
        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2015.10.21　特定品番時、集合梱包で行えるようにする
            
            
        If Y_SYU_TBL(i).KONPOU_F = "1" Then
            
            If Y_SYU_TBL(i).SAI_SU = 0 Then
                If IsNumeric(StrConv(ITEMREC.SAI_SU, vbUnicode)) Then
                    
                    
                    Y_SYU_TBL(i).SAI_SU = CDbl(StrConv(ITEMREC.SAI_SU, vbUnicode))
                Else
                    Call UniCode_Conv(ITEMREC.SAI_SU, "00.00")
                    Y_SYU_TBL(i).SAI_SU = 0
                End If
            End If
                            
                        
            If Y_SYU_TBL(i).KUTI_SU = 0 Then
                If IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                    Y_SYU_TBL(i).KUTI_SU = CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode))
                
If F110010_LOG <> "" Then           '2016.02.02
    Call LOG_OUT(F110010_LOG, "PC内部     " & Format(ID_KANRI_TBL(ING_No).ID, "000") & "(新) ID=" & StrConv(Y_SYUREC.ID_NO, vbUnicode) & _
                        "[" & StrConv(ITEMREC.HIN_GAI, vbUnicode) & "] KUTI_SU=" & CInt(StrConv(ITEMREC.KUTI_SU, vbUnicode)))
End If
                
                
                Else
                    Y_SYU_TBL(i).KUTI_SU = 1
                End If
            End If
        End If
            
            
        If Y_SYU_TBL(i).SUMI Then
            If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                Y_SYU_TBL(i).KUTI_SU = CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode))
If F110010_LOG <> "" Then           '2016.02.02
    Call LOG_OUT(F110010_LOG, "PC内部     " & Format(ID_KANRI_TBL(ING_No).ID, "000") & "(RE) ID=" & StrConv(Y_SYUREC.ID_NO, vbUnicode) & _
                        "[" & StrConv(ITEMREC.HIN_GAI, vbUnicode) & "] KUTI_SU=" & CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)))
End If
            End If
            
            If IsNumeric(StrConv(Y_SYU_HREC.SAI_SU_TAN, vbUnicode)) Then
                Y_SYU_TBL(i).SAI_SU = CInt(StrConv(Y_SYU_HREC.SAI_SU_TAN, vbUnicode))
            End If
        
        
        
        
        
 '2010.02.16
            If IsNumeric(StrConv(Y_SYU_HREC.OKURI_NO_SEQ, vbUnicode)) Then
                Y_SYU_TBL(i).OKURI_NO_SEQ = CInt(StrConv(Y_SYU_HREC.OKURI_NO_SEQ, vbUnicode))
                If Y_SYU_TBL(i).OKURI_NO_SEQ > OKURI_NO_MAX Then
                    OKURI_NO_MAX = Y_SYU_TBL(i).OKURI_NO_SEQ
                End If
            
            Else
                Y_SYU_TBL(i).OKURI_NO_SEQ = 0
            End If
 '2010.02.16
        
        
        
        Else
        
            If Y_SYU_TBL(i).KONPOU_F = "1" Then
        
                Y_SYU_TBL(i).KUTI_SU = Y_SYU_TBL(i).KUTI_SU * Y_SYU_TBL(i).SURYO

If F110010_LOG <> "" Then           '2016.02.02
    Call LOG_OUT(F110010_LOG, "PC内部     " & Format(ID_KANRI_TBL(ING_No).ID, "000") & "(RE) ID=" & StrConv(Y_SYUREC.ID_NO, vbUnicode) & _
                        "[" & StrConv(ITEMREC.HIN_GAI, vbUnicode) & "] Y_SYU_TBL(i).KUTI_SU * Y_SYU_TBL(i).SURYO=" & Y_SYU_TBL(i).KUTI_SU)
End If




'                Y_SYU_TBL(i).SAI_SU = Y_SYU_TBL(i).KUTI_SU * CDbl(StrConv(ITEMREC.SAI_SU, vbUnicode))
                Y_SYU_TBL(i).SAI_SU = Y_SYU_TBL(i).SURYO * CDbl(StrConv(ITEMREC.SAI_SU, vbUnicode))
                
            End If
        
 '2010.02.16
            Y_SYU_TBL(i).OKURI_NO_SEQ = 0
 '2010.02.16
        
        End If
            
            
            
                    
        '印刷済をリセット   2010.01.21
'        Y_SYU_TBL(i).PRINT_SUMI = False
'        Y_SYU_TBL(i).OKURI_NO_SEQ = 0
'
'        If IsNumeric(StrConv(Y_SYU_HREC.OKURI_NO_SEQ, vbUnicode)) Then
'            Y_SYU_TBL(i).PRINT_SUMI = True
'            Y_SYU_TBL(i).OKURI_NO_SEQ = CInt(StrConv(Y_SYU_HREC.OKURI_NO_SEQ, vbUnicode))
'
'
'            If Start_Page_No < Y_SYU_TBL(i).OKURI_NO_SEQ Then
'                Start_Page_No = Y_SYU_TBL(i).OKURI_NO_SEQ
'            End If
'
            If Y_SYU_TBL(i).KONPOU_F <> "1" Then
                If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU, vbUnicode)) Then
                    KUTI_SU = CInt(StrConv(Y_SYU_HREC.KUTI_SU, vbUnicode))
                
                    Y_SYU_TBL(i).KUTI_SU = CInt(StrConv(Y_SYU_HREC.KUTI_SU, vbUnicode))
                End If
            End If
'        End If
                    
                    
                    
                    
                    
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
        Y_SYU_TBL(i).CNT_BARA_SU = Val(StrConv(Y_SYU_HREC.CNT_BARA_SU, vbUnicode))       '検品実績　バラ
        Y_SYU_TBL(i).CNT_HAKO_SU = Val(StrConv(Y_SYU_HREC.CNT_HAKO_SU, vbUnicode))       '検品実績　箱
    
        Y_SYU_TBL(i).GAISO_IRI_QTY = Val(StrConv(Y_SYU_HREC.GAISO_IRI_QTY, vbUnicode))   '外装入り数
    
        Y_SYU_TBL(i).Y_HIN_CHK_CNT = Val(StrConv(Y_SYU_HREC.Y_HIN_CHK_CNT, vbUnicode))   '品番読込み回数
    
        Y_SYU_TBL(i).J_HIN_CHK_CNT = Val(StrConv(Y_SYU_HREC.J_HIN_CHK_CNT, vbUnicode))   '品番読込み済み回数
    
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.10.02
                    
                    
                    
                    
                    
                    
            
            
            
            
            
        Call UniCode_Conv(Y_SYUREC.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
        Call UniCode_Conv(Y_SYUREC.PRG_ID, StrConv(App.EXEName, vbUpperCase))
                                            
        RETRY_CNT = 0
                                            
                                            '出荷予定書込み
        Do
'            DoEvents
            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                DoEvents                                                    '2016.01.26
            End If                                                          '2016.01.26
            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Y_Syuka_H_Chek_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                
                Case Else
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    Y_Syuka_H_Chek_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        Loop
                                

        com = BtOpGetNext
    Loop
                                
''' 品番単位での丸め処理
    
    If Found_F Then
    
        FAST_F = True
                                                                                    
        For i = 0 To UBound(Y_SYU_TBL)
        
        
            If Y_SYU_TBL(i).CANCEL_F Then
            Else
                If FAST_F Then
                
                    Y_SYU_CNT = Y_SYU_CNT + 1
                    If Y_SYU_TBL(i).SUMI Then
                        Sumi_CNT = Sumi_CNT + 1
                    End If
                    FAST_F = False
                
                Else
                    For j = 0 To i - 1
                        If Trim(Y_SYU_TBL(i).HIN_NO) = Trim(Y_SYU_TBL(j).HIN_NO) Then
                            If Not Y_SYU_TBL(j).CANCEL_F Then
                                Exit For
                            End If
                        End If
                    Next j
            
                    If j > i - 1 Then
            
                        Y_SYU_CNT = Y_SYU_CNT + 1
                        If Y_SYU_TBL(i).SUMI Then
                            Sumi_CNT = Sumi_CNT + 1
                        End If
                    End If
                End If
            End If
        Next i
    End If
''' 品番単位での丸め処理
                                
                                
''' 梱包状態の確認
                                
                                
                                
                                
    KONPOU_ON = False
    KONPOU_OFF = False
    wkTOTAL = 0
                                
                                
    If Found_F Then
        For i = 0 To UBound(Y_SYU_TBL)
        
            
            
            If Y_SYU_TBL(i).CANCEL_F Then
            Else
                If Y_SYU_TBL(i).KONPOU_F = "1" Then
                    
                    KONPOU_OFF = True
                Else
                    KONPOU_ON = True
                End If
            End If
        
            wkTOTAL = Y_SYU_TBL(i).SURYO
        
        Next i
    End If
                                
    If Found_F Then
        For i = 0 To UBound(Y_SYU_TBL)
            If KONPOU_ON And KONPOU_OFF Then
                Y_SYU_TBL(i).KONPOU_CND = "3"
            Else
                If KONPOU_ON Then
                    Y_SYU_TBL(i).KONPOU_CND = "2"
                Else
                    Y_SYU_TBL(i).KONPOU_CND = "1"
                End If
            End If
        
        
            Y_SYU_TBL(i).TOTAL_SU = wkTOTAL
        
        Next i





    

''' 梱包状態の確認
        Start_Page_No = 0
        
        wkKUTI_SU = 0
        
        For i = 0 To UBound(Y_SYU_TBL)
        
            If Y_SYU_TBL(i).KONPOU_F <> "1" Then
                
                If Not Y_SYU_TBL(i).CANCEL_F Then           '2012.04.25
                    Start_Page_No = Y_SYU_TBL(i).KUTI_SU
                End If                                      '2012.04.25
            End If
        
        Next i
                                    
        For i = 0 To UBound(Y_SYU_TBL)
        
            If Y_SYU_TBL(i).KONPOU_F = "1" Then
                
                If Y_SYU_TBL(i).SUMI Then
                    If Not Y_SYU_TBL(i).CANCEL_F Then           '2012.04.25
                       Start_Page_No = Start_Page_No + Y_SYU_TBL(i).SURYO * Y_SYU_TBL(i).KUTI_SU
                    End If                                      '2012.04.25
                End If
            End If
        
        Next i
                                
                                
                                
        '2012.10.02
        For i = 0 To UBound(Y_SYU_TBL)
        
            If Y_SYU_TBL(i).CANCEL_F <> "1" Then
                If Y_SYU_TBL(i).KONPOU_F = "1" Then
                    If Trim(Y_SYU_TBL(i).HIN_NO) = Trim(KEN_HINBAN) Then
                        Start_Page_No = Start_Page_No + Y_SYU_TBL(i).J_HIN_CHK_CNT
                    End If
                End If
            End If
        Next i
        '2012.10.02
                                
                                
'        For i = 0 To UBound(Y_SYU_TBL)
'
'            If Y_SYU_TBL(i).KONPOU_F = "1" Then
'
'                Y_SYU_TBL(i).SAI_SU = Y_SYU_TBL(i).SURYO * Y_SYU_TBL(i).KUTI_SU
'            End If
'
'        Next i
                                
                                
                                        
                                
                                
    End If
                                
                                
                                
'>>>>>>>>>>>>   2012.12.28
        'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
        If Not Found_F Then
            
            Y_Syuka_H_Chek_Proc = False
            GoTo Abort_Tran
        End If
                                         
                
        CANCEL_F = True
            
        For j = 0 To UBound(Y_SYU_TBL)
        
            If Not Y_SYU_TBL(j).CANCEL_F Then
                CANCEL_F = False
                Exit For
            End If
                                
        Next j
                                 
                                 
        If CANCEL_F Then
            Y_Syuka_H_Chek_Proc = False
            GoTo Abort_Tran
        End If
        
        
        If Y_SYU_CNT = 0 Then
            Y_Syuka_H_Chek_Proc = False
            GoTo Abort_Tran
        End If
                                 
        If Sumi_CNT = Y_SYU_CNT And Start_Page_No <> 0 Then
            Y_Syuka_H_Chek_Proc = False
            GoTo Abort_Tran
        
        End If
'>>>>>>>>>>>>   2012.12.28

                                
                                
Debug.Print Label_RePrint_Sai_Su
                                
    Y_Syuka_H_Chek_Proc = False

End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        Y_Syuka_H_Chek_Proc = SYS_ERR
        GoTo Abort_Tran
    End If
    
    
    Exit Function


Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function
Public Function Y_Syuka_OSAKA_Chek_Proc(JGYOBU As String, _
                                        NAIGAI As String, _
                                        HIN_NO As String, _
                                        Y_SYU_CNT As Integer, _
                                        Y_SURYO As Long, _
                                        J_SURYO As Long, _
                                        ID_NO As String, _
                                        BIN_NO As String) As Integer
'-------------------------------------------------------
'
'   『出庫表出庫時、出荷予定の使用予約』
'   大阪ＰＣ用  2007.03.16
'               2007.05.16 便(BIN_NO)追加
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer


Dim ans         As Integer

Dim RETRY_CNT   As Integer

Dim i           As Integer
Dim j           As Integer

Dim FAST_F      As Boolean



    Y_Syuka_OSAKA_Chek_Proc = True
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Y_Syuka_OSAKA_Chek_Proc = SYS_ERR
        Exit Function
    End If



    Y_SYU_CNT = 0
    
    J_SURYO = 0
    Y_SURYO = 0
    HIN_NO = ""
        
    BIN_NO = ""         '2007.05.16
    
    RETRY_CNT = 0
    '出荷予定
    i = -1
    
    com = BtOpGetGreaterEqual
    '伝票ＩＤ指定での処理
    Call UniCode_Conv(K6_Y_SYU_H.SYU_NO, ID_NO)
    
    Do
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K6_Y_SYU_H, Len(K6_Y_SYU_H), 6)
        Select Case sts
            Case BtNoErr
                
                If Trim(StrConv(Y_SYU_HREC.SYU_NO, vbUnicode)) <> Trim(ID_NO) Then
                    sts = BtErrEOF
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, com, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                Y_Syuka_OSAKA_Chek_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
        
                                                
        If sts = BtErrEOF Then
            Exit Do
        End If
                                                
        If Trim(BIN_NO) = "" Then
            BIN_NO = StrConv(Y_SYU_HREC.INS_BIN, vbUnicode)
        End If
                                                
                                                
                                                
        Call UniCode_Conv(K0_Y_SYU.JGYOBU, StrConv(Y_SYU_HREC.JGYOBU, vbUnicode))
        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, StrConv(Y_SYU_HREC.ID_NO, vbUnicode))
        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
        Select Case sts
            Case BtNoErr
                
            Case BtErrKeyNotFound
                Exit Do
            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                    Y_Syuka_OSAKA_Chek_Proc = SYS_CANCEL
                    GoTo Abort_Tran
                End If
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                Y_Syuka_OSAKA_Chek_Proc = SYS_ERR
                GoTo Abort_Tran
        End Select
        
                                                
        Call UniCode_Conv(Y_SYUREC.WEL_ID, "")          '2015.03.16
        Call UniCode_Conv(Y_SYUREC.PRG_ID, "")          '2015.03.16
                                                
                                                
                                                
                                                
        If Trim(StrConv(Y_SYUREC.WEL_ID, vbUnicode)) = "" And _
            Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode)) = "" Then
        Else
            If StrConv(Y_SYUREC.WEL_ID, vbUnicode) <> Format(ID_KANRI_TBL(ING_No).ID, "000") Or _
                Trim(StrConv(Y_SYUREC.PRG_ID, vbUnicode)) <> StrConv(App.EXEName, vbUpperCase) Then
                                '他で使用中
                Y_Syuka_OSAKA_Chek_Proc = SYS_CANCEL
                GoTo Abort_Tran
            End If
        End If
            
                    
            
'        Call UniCode_Conv(Y_SYUREC.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))     2015.03.16
'        Call UniCode_Conv(Y_SYUREC.PRG_ID, StrConv(App.EXEName, vbUpperCase))          2015.03.16
                                            
                                            
                                            
                                            
                                            
        RETRY_CNT = 0
                                            
                                            '出荷予定書込み
        Do
'            DoEvents
            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                DoEvents                                                    '2016.01.26
            End If                                                          '2016.01.26
            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    RETRY_CNT = RETRY_CNT + 1
                    If RETRY_CNT > FILE_RETRY Then
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Y_Syuka_OSAKA_Chek_Proc = SYS_CANCEL
                        GoTo Abort_Tran
                    End If
                
                Case Else
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    Y_Syuka_OSAKA_Chek_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
        Loop
                                
        
        If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) = "1" Then
        Else
        
            Y_SYU_CNT = Y_SYU_CNT + 1
            
            Y_SURYO = Y_SURYO + CLng(StrConv(Y_SYUREC.SURYO, vbUnicode))
            J_SURYO = J_SURYO + CLng(StrConv(Y_SYUREC.JITU_SURYO, vbUnicode))
        End If
        
        If Trim(HIN_NO) = "" Then
            HIN_NO = StrConv(Y_SYUREC.HIN_NO, vbUnicode)
        End If
        
        
        
        
        
        
        com = BtOpGetNext
    Loop
                                
                                
                                
    '2011.04.07
    If Y_SURYO <= J_SURYO Then
        Y_Syuka_OSAKA_Chek_Proc = False
        GoTo Abort_Tran
    End If
    '2011.04.07
                                
                                
                                
    Y_Syuka_OSAKA_Chek_Proc = False

End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        Y_Syuka_OSAKA_Chek_Proc = SYS_ERR
        GoTo Abort_Tran
    End If
    
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function





















Public Function KEN_Rireki_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『検品履歴表示処理』
'
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer
Dim l               As Integer

Dim ID_NO           As String
Dim MTS_CODE        As String
Dim DEN_NO          As String
Dim OKURI_NO        As String
Dim UNSOU_KAISHA    As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim FileNo          As Integer

Dim FullPath        As String

Dim SendFileRec     As SendFileRec_Tag

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim DATA_CNT        As Integer
Dim SYUKA_QTY       As Long

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag
Dim wY_SYU_TBL()    As KEN_DEN_TBL_Tag

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean
    
Dim Found_F         As Boolean
    
    
    KEN_Rireki_Proc = True

    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & BB_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & BB_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            
            Case LCD_ID_No          '伝票ＩＤ
                '親伝をＫＥＥＰ
                ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                 
                Erase Y_SYU_TBL
                                
                sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        MTS_CODE, _
                                        Y_SYU_CNT, _
                                        Sumi_CNT, _
                                        ID_NO, _
                                        SYUKA_QTY, _
                                        DEN_NO, _
                                        Y_SYU_TBL(), _
                                        OKURI_NO, _
                                        UNSOU_KAISHA, _
                                        OKURI_SAKI, _
                                        Found_F)
                
                
                
                sts = Data_Clear_Proc(0, Sendbuf)
                Select Case sts
                    Case SYS_ERR
                        Exit Function
                End Select
                
                
                'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                
                If Found_F Then
                    CANCEL_F = True
                                             
                    For j = 0 To UBound(Y_SYU_TBL)
                    
                        If Not Y_SYU_TBL(j).CANCEL_F Then
                            CANCEL_F = False
                            Exit For
                        End If
                    
                    Next j
                                             
                                             
                    If CANCEL_F Then
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KEN_Rireki_Proc = False
                        Exit Function
                    End If
                End If
                
                If Y_SYU_CNT = 0 Then
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    KEN_Rireki_Proc = False
                    Exit Function
                End If
                
                
                If Y_SYU_CNT = Sumi_CNT Then
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "未検品残なし！", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    KEN_Rireki_Proc = False
                    Exit Function
                
                
                End If
                
                Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                Erase wY_SYU_TBL
                                
                                
                For j = 0 To UBound(Y_SYU_TBL)
                
                    If Y_SYU_TBL(j).SUMI Then
                    Else
                    
                        ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                        
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                        ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                    
                    End If
                Next j
                
                k = 0
                
                Sumi_CNT = 0
                Y_SYU_CNT = 0
                
                For j = 0 To UBound(Y_SYU_TBL)
                    If k = 0 Then
                        If Y_SYU_TBL(j).CANCEL_F Then
                        Else
                    
                            ReDim Preserve wY_SYU_TBL(k)
                            wY_SYU_TBL(k).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            wY_SYU_TBL(k).SUMI = Y_SYU_TBL(j).SUMI
                            wY_SYU_TBL(k).SURYO = Y_SYU_TBL(j).SURYO
                            
                            Y_SYU_CNT = Y_SYU_CNT + 1
                            If Y_SYU_TBL(j).SUMI Then
                                Sumi_CNT = Sumi_CNT + 1
                            End If
                            
                            
                            k = k + 1
                    
                                                
                        End If
                    Else
                        For l = 0 To UBound(wY_SYU_TBL)
                        
                            If Y_SYU_TBL(j).HIN_NO = wY_SYU_TBL(l).HIN_NO Then
                                
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                
                                    wY_SYU_TBL(l).SURYO = wY_SYU_TBL(l).SURYO + Y_SYU_TBL(j).SURYO
                                    
                                    Exit For
                                End If
                            End If
                        Next l
                    
                        If l > UBound(wY_SYU_TBL) Then
                            
                            If Not Y_SYU_TBL(j).CANCEL_F Then
                                ReDim Preserve wY_SYU_TBL(k)
                                wY_SYU_TBL(k).HIN_NO = Y_SYU_TBL(j).HIN_NO
                                wY_SYU_TBL(k).SUMI = Y_SYU_TBL(j).SUMI
                                wY_SYU_TBL(k).SURYO = Y_SYU_TBL(j).SURYO
                                
                                Y_SYU_CNT = Y_SYU_CNT + 1
                                If Y_SYU_TBL(j).SUMI Then
                                    Sumi_CNT = Sumi_CNT + 1
                                End If
                                
                                k = k + 1
                            End If
                        End If
                    End If
                Next j
                
                
                
                
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
                SendFileRec.Title = "0"     'タイトル行
                Call UniCode_Conv(SendFileRec.LCD, Trim(ID_NO) & "(" & _
                                                    Format(Sumi_CNT, "#0") & "/" & _
                                                    Format(Y_SYU_CNT, "#0") & ")")
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                                    
                For j = 0 To UBound(wY_SYU_TBL)
                    
                    If wY_SYU_TBL(j).SUMI Then
                    Else
                        SendFileRec.Title = "1"
                    
                        
                        Call UniCode_Conv(SendFileRec.LCD, Left(wY_SYU_TBL(j).HIN_NO, 16) & ":" & _
                                                    Format(wY_SYU_TBL(j).SURYO, "#0"))
                        SendFileRec.CRLF = vbCrLf
                                                
                        Put #FileNo, , SendFileRec
                    End If
                Next j
                    
                Close #FileNo
        End Select
    Next i
                    
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = BB_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.FileName = BB_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１〜５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    KEN_Rireki_Proc = False
    

End Function






Public Function KEN_ZAN_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『集約検品残表示処理』
'   2010.02.15
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer
Dim l               As Integer

Dim ID_NO           As String
Dim MTS_CODE        As String
Dim DEN_NO          As String
Dim OKURI_NO        As String
Dim UNSOU_KAISHA    As String

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim FileNo          As Integer

Dim FullPath        As String

Dim SendFileRec     As SendFileRec_Tag

Dim Y_SYU_CNT       As Integer
Dim Sumi_CNT        As Integer
Dim DATA_CNT        As Integer
Dim SYUKA_QTY       As Long

Dim Y_SYU_TBL()     As KEN_DEN_TBL_Tag
Dim wY_SYU_TBL()    As KEN_DEN_TBL_Tag

Dim OKURI_SAKI      As String

Dim CANCEL_F        As Boolean
    
Dim Found_F         As Boolean
    
    
    KEN_ZAN_Proc = True

    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & BF_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & BF_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    End If

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            
            Case LCD_ID_No          '伝票ＩＤ
                '親伝をＫＥＥＰ
                ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                 
                Erase Y_SYU_TBL
                                
                sts = Y_Syuka_H_Chek_Proc(ID_KANRI_TBL(ING_No).JGYOBU, _
                                        MTS_CODE, _
                                        Y_SYU_CNT, _
                                        Sumi_CNT, _
                                        ID_NO, _
                                        SYUKA_QTY, _
                                        DEN_NO, _
                                        Y_SYU_TBL(), _
                                        OKURI_NO, _
                                        UNSOU_KAISHA, _
                                        OKURI_SAKI, _
                                        Found_F)
                
                
                
                sts = Data_Clear_Proc(0, Sendbuf)
                Select Case sts
                    Case SYS_ERR
                        Exit Function
                End Select
                
                
                'ｷｬﾝｾﾙ伝票のﾁｪｯｸ
                
                If Found_F Then
                    CANCEL_F = True
                                             
                    For j = 0 To UBound(Y_SYU_TBL)
                    
                        If Not Y_SYU_TBL(j).CANCEL_F Then
                            CANCEL_F = False
                            Exit For
                        End If
                    
                    Next j
                                             
                                             
                    If CANCEL_F Then
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KEN_ZAN_Proc = False
                        Exit Function
                    End If
                End If
                
                If Y_SYU_CNT = 0 Then
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    KEN_ZAN_Proc = False
                    Exit Function
                End If
                
                
                If Y_SYU_CNT = Sumi_CNT Then
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "未検品残なし！", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    KEN_ZAN_Proc = False
                    Exit Function
                
                
                End If
                
                Erase ID_KANRI_TBL(ING_No).KEN_DEN_TBL
                Erase wY_SYU_TBL
                                
                                
                For j = 0 To UBound(Y_SYU_TBL)
                
                    If Y_SYU_TBL(j).SUMI Then
                    Else
                    
                        
                        
                        If Y_SYU_TBL(j).KONPOU_F = "1" Then
                        Else
                        
                            ReDim Preserve ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j)
                            
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO = Y_SYU_TBL(j).SEQ_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO = Y_SYU_TBL(j).HIN_NO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO = Y_SYU_TBL(j).SURYO
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI = Y_SYU_TBL(j).SUMI
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F = Y_SYU_TBL(j).CANCEL_F
                            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = Y_SYU_TBL(j).KONPOU_F
                        End If
                    End If
                Next j
                
                k = 0
                
                Sumi_CNT = 0
                Y_SYU_CNT = 0
                
                For j = 0 To UBound(Y_SYU_TBL)
                    If k = 0 Then
                        If Y_SYU_TBL(j).CANCEL_F Then
                        Else
                    
                            If Y_SYU_TBL(j).KONPOU_F = "1" Then
                            Else
                    
                    
                                ReDim Preserve wY_SYU_TBL(k)
                                wY_SYU_TBL(k).HIN_NO = Y_SYU_TBL(j).HIN_NO
                                wY_SYU_TBL(k).SUMI = Y_SYU_TBL(j).SUMI
                                wY_SYU_TBL(k).SURYO = Y_SYU_TBL(j).SURYO
                                
                                Y_SYU_CNT = Y_SYU_CNT + 1
                                If Y_SYU_TBL(j).SUMI Then
                                    Sumi_CNT = Sumi_CNT + 1
                                End If
                                
                                
                                k = k + 1
                            End If
                                                
                        End If
                    Else
                        For l = 0 To UBound(wY_SYU_TBL)
                        
                            If Y_SYU_TBL(j).HIN_NO = wY_SYU_TBL(l).HIN_NO Then
                                
                                If Not Y_SYU_TBL(j).CANCEL_F Then
                                    If Y_SYU_TBL(j).KONPOU_F = "1" Then
                                    Else
                                
                                        wY_SYU_TBL(l).SURYO = wY_SYU_TBL(l).SURYO + Y_SYU_TBL(j).SURYO
                                    
                                        Exit For
                                    End If
                                End If
                            End If
                        Next l
                    
                        If l > UBound(wY_SYU_TBL) Then
                            
                            
                            If Not Y_SYU_TBL(j).CANCEL_F Then
                                
                                If Y_SYU_TBL(j).KONPOU_F = "1" Then
                                Else
                                    
                                    ReDim Preserve wY_SYU_TBL(k)
                                    wY_SYU_TBL(k).HIN_NO = Y_SYU_TBL(j).HIN_NO
                                    wY_SYU_TBL(k).SUMI = Y_SYU_TBL(j).SUMI
                                    wY_SYU_TBL(k).SURYO = Y_SYU_TBL(j).SURYO
                                    
                                    Y_SYU_CNT = Y_SYU_CNT + 1
                                    If Y_SYU_TBL(j).SUMI Then
                                        Sumi_CNT = Sumi_CNT + 1
                                    End If
                                    
                                    k = k + 1
                                End If
                            End If
                        End If
                    End If
                Next j
                
                
                
                
                
                
                On Error Resume Next
                Kill (FullPath)             '送信用ファイル削除
                On Error GoTo 0
        
                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                Open FullPath For Binary As #FileNo
        
                SendFileRec.Title = "0"     'タイトル行
                Call UniCode_Conv(SendFileRec.LCD, Trim(ID_NO) & "(" & _
                                                    Format(Sumi_CNT, "#0") & "/" & _
                                                    Format(Y_SYU_CNT, "#0") & ")")
                SendFileRec.CRLF = vbCrLf
                Put #FileNo, , SendFileRec
                    
                                    
                For j = 0 To UBound(wY_SYU_TBL)
                    
                    If wY_SYU_TBL(j).SUMI Then
                    Else
                        SendFileRec.Title = "1"
                    
                        Call UniCode_Conv(SendFileRec.LCD, Left(wY_SYU_TBL(j).HIN_NO, 13) & ":" & _
                                                    Format(wY_SYU_TBL(j).SURYO, "#0"))
                        SendFileRec.CRLF = vbCrLf
                                                
                        Put #FileNo, , SendFileRec
                    End If
                Next j
                    
                Close #FileNo
        End Select
    Next i
                    
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
    '送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
    Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
    
    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                                                            '送信データファイル名
    Send_Text.FileName = BF_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    ID_KANRI_TBL(ING_No).Send_Text.FileName = BF_SendFile & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
    
    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
    '-----------------------------------------------１〜５行目
                                                            
    For i = 0 To M_Gyo - 1
                                                            'BOX属性
        Send_Text.Box_Type(i).Box_Type = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = ""
                                                            '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(i).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                            
                                                            '数値初期表示
        Send_Text.Box_Type(i).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).INIT = ""
                                                            
                                                            '初期カーソル位置
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
                                                            '入力桁数
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
                                                            'メニュ―番号
        Send_Text.Box_Type(i).MENU = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).MENU = ""
        
    Next i

    Sendbuf = Text_Create_Proc()
    
    
    
    KEN_ZAN_Proc = False
    

End Function




Public Function NYUKO_KENPIN_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『入荷検品処理（大阪PC向け）』
'       2007.06.07
'
'-------------------------------------------------------
Dim i           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07


Dim Tanaban     As String * 8
Dim DEN_NO      As String * 6
Dim SEQ_NO      As String * 3

Dim sts         As Integer

Dim QTY         As Long
Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1

Dim MENU_NO     As String * 2


Dim Found_F     As Integer

Dim GYO_INS     As String * 1

    NYUKO_KENPIN_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        '------------------ 品目マスタ読込み
                        
                                                
                                                
                        '2010.10.01
'                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, 1)
                        
                        
                        Select Case sts
                            Case BtNoErr
                                RET_JGYOBU = ID_KANRI_TBL(ING_No).JGYOBU
                                RET_NAIGAI = ID_KANRI_TBL(ING_No).NAIGAI
                            
                            
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                NYUKO_KENPIN_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                
                        '------------------ 入荷データの確認
                        sts = Y_Nyuka_O_Chek_Proc(1, RET_JGYOBU, _
                                                    RET_NAIGAI, _
                                                    Hinban, _
                                                    DEN_NO, _
                                                    Found_F, _
                                                    SEQ_NO, _
                                                    QTY)
                
                
                
                        Select Case sts
                            Case False          '正常
                                If Found_F = 9 Then
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "該当品番使用中", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    NYUKO_KENPIN_OSAKA_Proc = False
                                    Exit Function
                                End If
                
                            Case True, SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "該当品番使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                NYUKO_KENPIN_OSAKA_Proc = False
                                Exit Function
                        End Select
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI
                
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).SEQ_NO = SEQ_NO

                        ID_KANRI_TBL(ING_No).GYO_INS = "0"

                        ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = StrConv(ITEMREC.GOODS_KBN, vbUnicode)
                        '入荷予定の情報により処理を振り分ける
                        Select Case Found_F
                            Case 0
                                '-----------------  データ無し
                            
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.FileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                        
                                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                
                                '-----------------------------------------------１行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
'2017.09.22
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
                                                                                        
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                                                                        
                                                                                        
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "該当なし(0:OK 1:CAN)")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "該当なし(0:OK 1:CAN)")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------------------------------------------４行目
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "品目追加？")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "品目追加？")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = "11"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "11"
                                                                                        '入力桁数
                                Send_Text.Box_Type(3).Max_Size = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "01"
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                 Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                            Case 1
                                '-----------------  未処理データ
                            
                            
                            
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.FileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                        
                                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                
                                '-----------------------------------------------１行目
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
'2017.09.22
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                                        
                                Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Suryo)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Suryo)
                                                                                    
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""                                                                                        '初期カーソル位置
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = Format(M_Keta - 4, "00")
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "05"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "05"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                                                                        
                                                                                        
                                '-----------------------------------------------４行目
                                                                                        
                                If DEN_NO = "000000" Then
                                                                                            'BOX属性
                                    Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                            '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_DEN_No)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_DEN_No)
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 5, "00")
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 5, "00")
                                                                                            '入力桁数
                                    Send_Text.Box_Type(3).Max_Size = "06"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "06"
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                Else
                                
                                                                                            'BOX属性
                                    Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                            '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_DEN_No & DEN_NO)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_DEN_No & DEN_NO)
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                            '入力桁数
                                    Send_Text.Box_Type(3).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                
                                End If
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                 Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                            
                            Case 2
                                '-----------------  処理済データ
                        
                            
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.FileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                        
                                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                
                                '-----------------------------------------------１行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
'2017.09.22
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
                                                                                        
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                                                                        
                                                                                        
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "処理済 (0:OK 1:CAN)")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "処理済 (0:OK 1:CAN)")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------------------------------------------４行目
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                                                                        
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "品目追加？")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "品目追加？")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = "11"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "11"
                                                                                        '入力桁数
                                Send_Text.Box_Type(3).Max_Size = "01"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "01"
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------５行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                 Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                        
                        
                        End Select
                
                
                
                End Select
            Next i
    
        Case Step_Sagyo2_RES        '処理継続の有無
    
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    Case LCD_HIN_ANS        '継続有無
                        GYO_INS = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                                    
                        If GYO_INS <> "0" And GYO_INS <> "1" Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, GYO_INS, "(0 OR 1)", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            NYUKO_KENPIN_OSAKA_Proc = False
                            Exit Function

                        End If

                        ID_KANRI_TBL(ING_No).GYO_INS = "1"
                        ID_KANRI_TBL(ING_No).DEN_NO = "000000"

                        '入荷予定の情報により処理を振り分ける
                        Select Case GYO_INS
                            Case "0"
                            
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.FileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                        
                                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                
                                '-----------------------------------------------１行目
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
'2017.09.22
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                        
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                                        
                                Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Suryo)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Suryo)
                                                                                    
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""                                                                                        '初期カーソル位置
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = Format(M_Keta - 4, "00")
                                                                                        '入力桁数
                                 Send_Text.Box_Type(2).Max_Size = "05"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "05"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                                                                        
                                                                                        
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_DEN_No)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_DEN_No)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 5, "00")
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 5, "00")
                                                                                        '入力桁数
                                Send_Text.Box_Type(3).Max_Size = "06"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "06"
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                 Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                            
                            Case "1"        'キャンセル
                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
            
        
                                Sendbuf = Text_Create_Proc()
                        
                        
                        End Select
                
                
                
                End Select
            Next i
    
    
    
        Case Step_Sagyo3_RES        '数量／伝票
    
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    Case LCD_Suryo      '数量
                        
                                    
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            NYUKO_KENPIN_OSAKA_Proc = False
                            Exit Function

                        End If

                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))


                    Case LCD_DEN_No     '伝票
                        
                                    
                        If IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            If CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 0 Then
                            Else
                                ID_KANRI_TBL(ING_No).DEN_NO = Format(CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))), "000000")
                            End If
                        End If

                
                
                
                End Select
            Next i
    
            '----------------------------------- データ更新処理開始 -----------
                                                'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                                
                                                
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                                
                                                
            If ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = GOODS_ON Then
                MI_QTY = QTY
                SUMI_QTY = 0
            Else
                SUMI_QTY = QTY
                MI_QTY = 0
            End If
                                                
                                                '入庫更新
            sts = Nyuko_OSAKA_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    Format(Now, "YYYYMMDD"), _
                                    (NYUKA_SOKO_NO & "01" & "01" & "01"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    ID_KANRI_TBL(ING_No).GYO_INS, _
                                    ID_KANRI_TBL(ING_No).DEN_NO, _
                                    ID_KANRI_TBL(ING_No).SEQ_NO, _
                                    FILE_RETRY, , MENU_NO)
            Select Case sts
                Case False
                Case True           '入庫時は発生しない
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                    NYUKO_KENPIN_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Sendbuf = Text_Create_Proc()
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    NYUKO_KENPIN_OSAKA_Proc = SYS_ERR    'システム異常発生
                    
                    GoTo Abort_Tran
            End Select
        
End_Tran:
                                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                                '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
                    
            Sendbuf = Text_Create_Proc()
    
    
    End Select
    
    
    NYUKO_KENPIN_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Public Function NYUKO_TANA_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『実棚入庫処理（大阪PC向け）』
'       2007.06.07
'       2007.11.02 標準棚番表示追加
'-------------------------------------------------------
Dim i               As Integer

'2010.12.07
'Dim Hinban          As String * 13
Dim Hinban          As String * 20
'2010.12.07

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8
Dim DEN_NO          As String * 6
Dim SEQ_NO          As String * 3

Dim sts         As Integer

Dim QTY         As Long
Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1

Dim MENU_NO     As String * 2

Dim Found_F     As Integer

Dim ST_TANABAN      As String * 11  '2007.11.02


Dim RETRY_CNT   As Integer
Dim RETRY_SU    As Integer

    NYUKO_TANA_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        '------------------ 品目マスタ読込み
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                NYUKO_TANA_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                    
                        '2007.11.02 ↓
                        If Trim(StrConv(ITEMREC.ST_SOKO, vbUnicode)) = "" Then
                            ST_TANABAN = ""
                        Else
                            ST_TANABAN = StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & _
                                            StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & _
                                            StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & _
                                            StrConv(ITEMREC.ST_DAN, vbUnicode)
                        End If
                        '2007.11.02 ↑
                    
                    
                
                        '------------------ 入荷データの確認
                        sts = Y_Nyuka_O_Chek_Proc(2, RET_JGYOBU, _
                                                    RET_NAIGAI, _
                                                    Hinban, _
                                                    DEN_NO, _
                                                    Found_F, _
                                                    SEQ_NO, _
                                                    QTY)
                        Select Case sts
                            Case False          '正常
                                Select Case Found_F
                                    Case 9
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "該当品番使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        NYUKO_TANA_OSAKA_Proc = False
                                        Exit Function
                                    Case 0
                                                                    
'---------------------------------------------- '異常対処 2011.04.02
                                        If RECOVER_F Then
                                            sts = BTRV(BtOpGetLast, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                                            Select Case sts
                                                Case BtNoErr
                                                    SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                                                Case BtErrEOF
                                                    SEQ_NO = "000"
                                                Case Else
                                                    Call File_Error(sts, BtOpGetEqual, "入荷予定ﾃﾞｰﾀ")
                                                    NYUKO_TANA_OSAKA_Proc = False
                                                    Exit Function
                                            End Select
        
                                            SEQ_NO = Format(CInt(SEQ_NO) + 1, "000")
                
                                            Call UniCode_Conv(Y_NYU_O_REC.JGYOBU, RET_JGYOBU)
                                            Call UniCode_Conv(Y_NYU_O_REC.SOKO_NO, DAITO_SOKO_NO)
                                            Call UniCode_Conv(Y_NYU_O_REC.SEQ_NO, SEQ_NO)
                                            Call UniCode_Conv(Y_NYU_O_REC.NYUKO_YMD, Format(Now, "YYYYMMDD"))
                                            Call UniCode_Conv(Y_NYU_O_REC.DEN_NO, "000000")
        
                                            Call UniCode_Conv(Y_NYU_O_REC.MAKER_CODE, StrConv(ITEMREC.MAKER_CODE, vbUnicode))
                                            Call UniCode_Conv(Y_NYU_O_REC.NAIGAI, RET_NAIGAI)
        
                                            Call UniCode_Conv(Y_NYU_O_REC.HIN_NO, Hinban)
        
                                            Call UniCode_Conv(Y_NYU_O_REC.Y_SURYO, "00000000")
        
                                            Call UniCode_Conv(Y_NYU_O_REC.ORDER_NO, "")
        
                                            Call UniCode_Conv(Y_NYU_O_REC.FILLER, "")
    
                                            Call UniCode_Conv(Y_NYU_O_REC.DEN_NO, "")
                                            Call UniCode_Conv(Y_NYU_O_REC.J_SURYO, "00000000")
    
                                            Call UniCode_Conv(Y_NYU_O_REC.TANTO_CODE, "RECOV")
        
                                            Call UniCode_Conv(Y_NYU_O_REC.KENPIN_F, "1")
        
                                            Call UniCode_Conv(Y_NYU_O_REC.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
                                            Call UniCode_Conv(Y_NYU_O_REC.PRG_ID, StrConv(App.EXEName, vbUpperCase))
        
            
                                            RETRY_SU = 5
                                            RETRY_CNT = 0
                                            Do
                                                sts = BTRV(BtOpInsert, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                                                Select Case sts
                                                    Case BtNoErr
                                                        Exit Do
                                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                                                                'リトライ回数チェック
                                                        If RETRY_SU <> 0 Then
                                                            
                                                            RETRY_CNT = RETRY_CNT + 1
                                                            If RETRY_CNT > RETRY_SU Then
                                                                                '回数オーバー
                                                                Call File_Error(sts, BtOpInsert, "入荷予定", 0)
                                                                NYUKO_TANA_OSAKA_Proc = False
                                                                Exit Function
                                                            End If
                                                        
                                                        End If
                                                        
'                                                        DoEvents
                                                        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                                            DoEvents                                                    '2016.01.26
                                                        End If                                                          '2016.01.26
                                                    Case Else
                                                        Call File_Error(sts, BtOpInsert, "入荷予定")
                                                        NYUKO_TANA_OSAKA_Proc = False
                                                        Exit Function
                                                End Select
                                            Loop
                                        
                                        
                                            DEN_NO = "000000"
'---------------------------------------------- '異常対処 2011.04.02
                                        
                                        Else
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "該当品番なし", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            NYUKO_TANA_OSAKA_Proc = False
                                            Exit Function
                                
                                        End If
                                
                                
                                End Select
                
                            Case True, SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "該当品番使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                NYUKO_TANA_OSAKA_Proc = False
                                Exit Function
                        End Select
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI
                
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).SEQ_NO = SEQ_NO

                        ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = StrConv(ITEMREC.GOODS_KBN, vbUnicode)
                        
                        
                        If ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = GOODS_ON Then
                            ID_KANRI_TBL(ING_No).Send_MI_QTY = QTY
                            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = 0
                        Else
                            ID_KANRI_TBL(ING_No).Send_MI_QTY = 0
                            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = QTY
                        End If
                        
                        
                        
                        
                        'FROM 入荷倉庫の在庫をKEEP
                        FROM_Tanaban = NYUKA_SOKO_NO & "01" & "01" & "01"
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                NYUKO_TANA_OSAKA_Proc = False
                                Exit Function
                        End Select
                    
            
'---------------------------------------------- '異常対処 2011.04.02
                        If RECOVER_F Then
                            QTY = SUMI_QTY + MI_QTY
                        End If
                        If ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = GOODS_ON Then
                            ID_KANRI_TBL(ING_No).Send_MI_QTY = QTY
                            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = 0
                        Else
                            ID_KANRI_TBL(ING_No).Send_MI_QTY = 0
                            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = QTY
                        End If
'---------------------------------------------- '異常対処 2011.04.02
            
            
                        If (SUMI_QTY + MI_QTY) < QTY Then
                            Call Err_Send_Proc("有効在庫数不足", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function
                        End If
                        
                        
                            
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
'2007.11.02                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
'2007.11.02                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban & " " & ST_TANABAN)                        '2007.11.02
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban & " " & ST_TANABAN)   '2007.11.02
                                                                                
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
'2007.11.02                        Send_Text.Box_Type(2).Max_Size = "09"
'2007.11.02                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                        Send_Text.Box_Type(2).Max_Size = "16"                       '入力桁数変更　2007.11.02
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "16"  '入力桁数変更　2007.11.02
                                                                                
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(QTY, "#0")))) & Format(QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(QTY, "#0")))) & Format(QTY, "#0"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(QTY, "#0"))) & Format(QTY, "#0")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(QTY, "#0"))) & Format(QTY, "#0")
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                        If DEN_NO = "000000" Then
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_DEN_No)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_DEN_No)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 5, "00")
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 5, "00")
                                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "06"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "06"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        Else
                        
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_DEN_No & DEN_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_DEN_No & DEN_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        End If
                    

                        Sendbuf = Text_Create_Proc()
                        
                
                
                
                End Select
            Next i
    
    
    
    
        Case Step_Sagyo2_RES        '棚番／数量／伝票
    
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                    
                    Case LCD_Tanaban    '棚番
                    
                        TO_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(TO_Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(TO_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2), "倉庫エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    NYUKO_TANA_OSAKA_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 混載チェック
                            If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                                If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                    StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    NYUKO_TANA_OSAKA_Proc = False
                                    Exit Function
                                End If
                            End If
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(TO_Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(TO_Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(TO_Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(TO_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    NYUKO_TANA_OSAKA_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                '2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                NYUKO_TANA_OSAKA_Proc = False
                                Exit Function
                            End If
            
                        End If
                   
                        ID_KANRI_TBL(ING_No).Tanaban = TO_Tanaban       '棚番をセーブ
                    
                    
                    Case LCD_Suryo      '数量
                        
                                    
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function

                        End If

                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))

                        If QTY > (ID_KANRI_TBL(ING_No).Send_MI_QTY + ID_KANRI_TBL(ING_No).Send_SUMI_QTY) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function
                        End If


                    Case LCD_DEN_No     '伝票
                        
                        '>>>>>> ｴﾗｰﾁｪｯｸ　廃止 2018.06.29
'                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
''2017.09.22
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "伝票ｓ力ミス", "", "")
'
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                            NYUKO_TANA_OSAKA_Proc = False
'                            Exit Function
'                        End If
'                        If CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 0 Then
''2017.09.22
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "伝票ｓ力ミス", "", "")
'
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                            NYUKO_TANA_OSAKA_Proc = False
'                            Exit Function
'                        End If
                        '>>>>>> ｴﾗｰﾁｪｯｸ　廃止 2018.06.29
                                                                
                                    
                        ID_KANRI_TBL(ING_No).DEN_NO = Format(CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))), "000000")

                
                
                
                End Select
            Next i
    
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
            If ID_KANRI_TBL(ING_No).ITEM_GOODS_ON_F = GOODS_ON Then
                MI_QTY = QTY
                SUMI_QTY = 0
            Else
                MI_QTY = 0
                SUMI_QTY = QTY
            End If
            sts = IDO_OSAKA_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    (NYUKA_SOKO_NO & "01" & "01" & "01"), _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    ID_KANRI_TBL(ING_No).DEN_NO, _
                                    ID_KANRI_TBL(ING_No).SEQ_NO, _
                                    FILE_RETRY, , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    NYUKO_TANA_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    NYUKO_TANA_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    NYUKO_TANA_OSAKA_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
    
    
'---------------------------------------------- '異常対処 2011.04.02
            If RECOVER_F Then
            
                Call UniCode_Conv(K0_Y_NYU_O.SEQ_NO, ID_KANRI_TBL(ING_No).SEQ_NO)
            
            
                RETRY_SU = 5
                RETRY_CNT = 0
                Do
                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                                    'リトライ回数チェック
                            If RETRY_SU <> 0 Then
                                
                                RETRY_CNT = RETRY_CNT + 1
                                If RETRY_CNT > RETRY_SU Then
                                                    '回数オーバー
                                    Call File_Error(sts, BtOpGetEqual, "入荷予定", 0)
                                    NYUKO_TANA_OSAKA_Proc = False
                                    Exit Function
                                End If
                            
                            End If
                            
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                        Case Else
                            Call File_Error(sts, BtOpGetEqual, "入荷予定")
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function
                    End Select
                Loop
            
            
            
                Call UniCode_Conv(Y_NYU_O_REC.Y_SURYO, Format(QTY, "00000000"))
                Call UniCode_Conv(Y_NYU_O_REC.J_SURYO, Format(QTY, "00000000"))
            
            
            
                RETRY_SU = 5
                RETRY_CNT = 0
                Do
                    sts = BTRV(BtOpUpdate, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                                    'リトライ回数チェック
                            If RETRY_SU <> 0 Then
                                
                                RETRY_CNT = RETRY_CNT + 1
                                If RETRY_CNT > RETRY_SU Then
                                                    '回数オーバー
                                    Call File_Error(sts, BtOpGetEqual, "入荷予定", 0)
                                    NYUKO_TANA_OSAKA_Proc = False
                                    Exit Function
                                End If
                            
                            End If
                            
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                        Case Else
                            Call File_Error(sts, BtOpGetEqual, "入荷予定")
                            NYUKO_TANA_OSAKA_Proc = False
                            Exit Function
                    End Select
                Loop
            
            
            
            End If
'---------------------------------------------- '異常対処 2011.04.02
    
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    
    End Select
    
    
    NYUKO_TANA_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Public Function Y_Nyuka_O_Chek_Proc(Mode As Integer, _
                                        JGYOBU As String, _
                                        NAIGAI As String, _
                                        HIN_NO As String, _
                                        DEN_NO As String, _
                                        Found_F As Integer, _
                                        SEQ_NO As String, _
                                        SURYO As Long) As Integer
'-------------------------------------------------------
'
'   『入荷予定の使用予約』
'   大阪ＰＣ用  2007.06.07
'
'   mode   :1   入荷検品処理用
'   mode   :2   入庫処理用
'   mode   :3   出荷処理用
'
'
'   FOUND_F:0　データなし
'          :1  データあり（未処理）
'          :2  データあり（処理済）
'          :9  データ他で使用中
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer


Dim ans         As Integer

Dim RETRY_CNT   As Integer

Dim i           As Integer
Dim j           As Integer




    Y_Nyuka_O_Chek_Proc = True
    
    Select Case Mode
        
        Case 1
            '------------------------------------------------------ 入荷検品
            Found_F = 0
                
                
                
            SEQ_NO = ""
            
            com = BtOpGetFirst
            Do
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
                sts = BTRV(com, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, com, "入荷予定", 0)
                        Y_Nyuka_O_Chek_Proc = SYS_ERR
                        Exit Function
                End Select
            
            
            
                If JGYOBU = StrConv(Y_NYU_O_REC.JGYOBU, vbUnicode) And _
                    NAIGAI = StrConv(Y_NYU_O_REC.NAIGAI, vbUnicode) And _
                    Trim(HIN_NO) = Trim(StrConv(Y_NYU_O_REC.HIN_NO, vbUnicode)) Then
        
        
                    If Trim(StrConv(Y_NYU_O_REC.WEL_ID, vbUnicode)) <> "" Then
                        Found_F = 9
                        Exit Do
                    Else
        
                        If CLng(StrConv(Y_NYU_O_REC.J_SURYO, vbUnicode)) = 0 Then
                        
                            DEN_NO = StrConv(Y_NYU_O_REC.DEN_NO, vbUnicode)
                            SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                            Found_F = 1
                        
                            Exit Do
                        End If
                    End If
            
                End If
                com = BtOpGetNext
            
            Loop
            
            
            If Found_F = 0 Then
                com = BtOpGetFirst
                Do
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                    sts = BTRV(com, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrEOF
                            Exit Do
                        Case Else
                            Call File_Error(sts, com, "入荷予定", 0)
                            Y_Nyuka_O_Chek_Proc = SYS_ERR
                            Exit Function
                    End Select
                
                
                
                    If JGYOBU = StrConv(Y_NYU_O_REC.JGYOBU, vbUnicode) And _
                        NAIGAI = StrConv(Y_NYU_O_REC.NAIGAI, vbUnicode) And _
                        Trim(HIN_NO) = Trim(StrConv(Y_NYU_O_REC.HIN_NO, vbUnicode)) Then
                        
                        DEN_NO = "000000"
                        SEQ_NO = "000"
                        Found_F = 2
                    
                        Exit Do
                
                    End If
                
                    com = BtOpGetNext
                Loop
            End If
            
            
            
            If Found_F = 1 Then
            
            
                Call UniCode_Conv(K0_Y_NYU_O.SEQ_NO, SEQ_NO)
                Do
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrKeyNotFound
                            DEN_NO = StrConv(Y_NYU_O_REC.DEN_NO, vbUnicode)
                            SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                            Found_F = 9
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            RETRY_CNT = RETRY_CNT + 1
                            If RETRY_CNT > FILE_RETRY Then
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "入荷予定", 0)
                                Y_Nyuka_O_Chek_Proc = SYS_CANCEL
                                Exit Function
                            End If
                        Case Else
                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                            Y_Nyuka_O_Chek_Proc = SYS_ERR
                            Exit Function
                    End Select
                    
                                                            
                Loop
                        
                
                If sts <> BtErrKeyNotFound Then
                
                    Call UniCode_Conv(Y_NYU_O_REC.WEL_ID, Format(ID_KANRI_TBL(ING_No).ID, "000"))
                    Call UniCode_Conv(Y_NYU_O_REC.PRG_ID, StrConv(App.EXEName, vbUpperCase))
                                                            
                    RETRY_CNT = 0
                                                            
                                                            '入荷予定書込み
                    Do
'                        DoEvents
                        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                            DoEvents                                                    '2016.01.26
                        End If                                                          '2016.01.26
                        sts = BTRV(BtOpUpdate, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                RETRY_CNT = RETRY_CNT + 1
                                If RETRY_CNT > FILE_RETRY Then
                                    Call File_Error(sts, BtOpUpdate, "入荷予定", 0)
                                    Y_Nyuka_O_Chek_Proc = SYS_CANCEL
                                    Exit Function
                                End If
                            
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "入荷予定", 0)
                                Y_Nyuka_O_Chek_Proc = SYS_ERR
                                Exit Function
                        End Select
                    Loop
                
                End If
            
            End If
    
        Case 2
    
            '------------------------------------------------------ 入荷検品
            Found_F = 0
                
            SEQ_NO = ""
            
            com = BtOpGetFirst
            Do
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
                sts = BTRV(com, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, com, "入荷予定", 0)
                        Y_Nyuka_O_Chek_Proc = SYS_ERR
                        Exit Function
                End Select
            
            
            
                If StrConv(Y_NYU_O_REC.KENPIN_F, vbUnicode) <> "1" Then
                Else
                    '検品済のみ対象とする
                    If JGYOBU = StrConv(Y_NYU_O_REC.JGYOBU, vbUnicode) And _
                        NAIGAI = StrConv(Y_NYU_O_REC.NAIGAI, vbUnicode) And _
                        Trim(HIN_NO) = Trim(StrConv(Y_NYU_O_REC.HIN_NO, vbUnicode)) Then
        
        
                        If Trim(StrConv(Y_NYU_O_REC.WEL_ID, vbUnicode)) <> "" Then
                            Found_F = 9
                            Exit Do
                        Else
        
                            
                            DEN_NO = StrConv(Y_NYU_O_REC.DEN_NO, vbUnicode)
                            SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                            SURYO = CLng(StrConv(Y_NYU_O_REC.J_SURYO, vbUnicode))
                            Found_F = 1
                        
                            Exit Do
                        End If
            
                    End If
                End If
                com = BtOpGetNext
            
            Loop
    
            If Found_F = 1 Then
            
            
                Call UniCode_Conv(K0_Y_NYU_O.SEQ_NO, SEQ_NO)
                Do
'                    DoEvents
                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                        DoEvents                                                    '2016.01.26
                    End If                                                          '2016.01.26
                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrKeyNotFound
                            DEN_NO = StrConv(Y_NYU_O_REC.DEN_NO, vbUnicode)
                            SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                            Found_F = 9
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                            RETRY_CNT = RETRY_CNT + 1
                            If RETRY_CNT > FILE_RETRY Then
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "入荷予定", 0)
                                Y_Nyuka_O_Chek_Proc = SYS_CANCEL
                                Exit Function
                            End If
                        Case Else
                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                            Y_Nyuka_O_Chek_Proc = SYS_ERR
                            Exit Function
                    End Select
                    
                                                            
                Loop
    
    
            End If
    
    
        Case 3
    
            '------------------------------------------------------ 出荷時ﾁｪｯｸ
            Found_F = 0
                
            SEQ_NO = ""
            
            com = BtOpGetFirst
            Do
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
                sts = BTRV(com, Y_NYU_O_POS, Y_NYU_O_REC, Len(Y_NYU_O_REC), K0_Y_NYU_O, Len(K0_Y_NYU_O), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, com, "入荷予定", 0)
                        Y_Nyuka_O_Chek_Proc = SYS_ERR
                        Exit Function
                End Select
            
            
                '伝票番号入力済のみ対象とする
                If JGYOBU = StrConv(Y_NYU_O_REC.JGYOBU, vbUnicode) And _
                    NAIGAI = StrConv(Y_NYU_O_REC.NAIGAI, vbUnicode) And _
                    Trim(HIN_NO) = Trim(StrConv(Y_NYU_O_REC.HIN_NO, vbUnicode)) Then
                        
                    DEN_NO = StrConv(Y_NYU_O_REC.DEN_NO, vbUnicode)
                    SEQ_NO = StrConv(Y_NYU_O_REC.SEQ_NO, vbUnicode)
                    SURYO = CLng(StrConv(Y_NYU_O_REC.J_SURYO, vbUnicode))
        
                    Found_F = 1
        
                    If Trim(DEN_NO) = "" Or DEN_NO = "000000" Then
                        Exit Do
                    End If
            
                End If
                com = BtOpGetNext
            
            Loop
    
    
    
    End Select
    
    
    
    Y_Nyuka_O_Chek_Proc = False
    

End Function

Public Function Furikae_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『資材振替　指定時のチェック＆更新処理』    2007.06.28
'
'-------------------------------------------------------
Dim i           As Integer

'2010.12.07
'Dim Hinban      As String * 13
Dim Hinban      As String * 20
'2010.12.07
Dim Tanaban     As String * 8
Dim sts         As Integer

Dim QTY         As Long
Dim SUMI_QTY    As Long
Dim MI_QTY      As Long

Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1

Dim MENU_NO     As String * 2

Dim WK_CODE     As String * 5
Dim WK_TANKA    As String * 11

Dim SYUSHI      As String * 3

    Furikae_Proc = True

    For i = 0 To M_Gyo - 1
        Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
            Case LCD_Tanaban        '棚番
                Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                
                If Trim(Tanaban) = Loc_OK_Para Then '棚番OK
                Else
                '------------------ 倉庫マスタ読込み
                    Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                    sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                            Furikae_Proc = False
                            Exit Function
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                            Exit Function
                    End Select
                    '------------------ 混載チェック
                    If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                        If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                            StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Furikae_Proc = False
                            Exit Function
                        End If
                    End If
                    '------------------ 棚マスタ読込み
                    Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                    Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                    Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                    Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                    Select Case sts
                        Case BtNoErr
                        Case BtErrKeyNotFound
                
                        '   -------------------------------- エラーメッセージ作成
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Furikae_Proc = False
                            Exit Function
                        Case Else
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                            Exit Function
                    End Select
            
                    '------------------ 禁止棚のチェック
                    If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚使用不可", "", "")
                
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                        Furikae_Proc = False
                        Exit Function
                    End If
            
            
                End If
            Case LCD_Hinban         '品番
                Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                '------------------ 品目マスタ読込み
'                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                
                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                Select Case sts
                    Case BtNoErr
                        If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                            Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                            Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                    Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                    '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Furikae_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
                        End If
                    
                        If RET_JGYOBU <> SHIZAI Or RET_NAIGAI <> NAIGAI_NAI Then
                        '   -------------------------------- エラーメッセージ作成
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "資材品番のみ有効", "", "")
            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Furikae_Proc = False
                            Exit Function
                        End If
                    
                    Case BtErrKeyNotFound
                        '   -------------------------------- エラーメッセージ作成
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Furikae_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                        Exit Function
                End Select
            
            Case LCD_Suryo          '数量
                If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Furikae_Proc = False
                    Exit Function
                End If
                
                QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                If QTY = 0 Then
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Furikae_Proc = False
                    Exit Function
                End If
            
            
            Case LCD_SYUSHI         '収支
                
                SYUSHI = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                
                If SYUSHI = Trim(StrConv(ITEMREC.G_SYUSHI, vbUnicode)) Then
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, SYUSHI, "同一収支です", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                    Furikae_Proc = False
                    Exit Function
                End If
                
                '------------------ コードマスタ読込み
                Call UniCode_Conv(K0_P_CODE.DATA_KBN, P_KBN03_CD)
                Call UniCode_Conv(K0_P_CODE.C_Code, SYUSHI)
                sts = BTRV(BtOpGetEqual, P_CODE_POS, P_CODEREC, Len(P_CODEREC), K0_P_CODE, Len(K0_P_CODE), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                    '   -------------------------------- エラーメッセージ作成
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, SYUSHI, "収支エラー", "", "")
        
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
    
                        Furikae_Proc = False
                        Exit Function
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                        Exit Function
                End Select
        
        End Select
    Next i
    '----------------------------------- データ更新処理開始 -----------
                                        
                                        'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Exit Function
    End If
                                        
                                        
    If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
        MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                
    Else
                
        MENU_NO = ""
    End If
                                        
                                        
                                        '出庫更新
    sts = Syuko_Update_Proc(RET_JGYOBU, _
                            RET_NAIGAI, _
                            Hinban, _
                            "", _
                            Tanaban, _
                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                            0, _
                            QTY, _
                            0, _
                            Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                            ID_KANRI_TBL(ING_No).TANTO_CODE, _
                            FILE_RETRY, , , , , , , MENU_NO)
    Select Case sts
        Case False
        
        Case True       '在庫不足時に発生
'2017.09.22
            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), Hinban, "在庫数不足", "")
            Sendbuf = Text_Create_Proc()
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
            Furikae_Proc = False
            GoTo Abort_Tran
        Case SYS_CANCEL
'2017.09.22
            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
            Sendbuf = Text_Create_Proc()
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
            Furikae_Proc = False
            GoTo Abort_Tran
        Case SYS_ERR
            Sendbuf = Text_Create_Proc()
            Call Err_Send_Proc("システム異常発生", "", "", "", "")
            Furikae_Proc = SYS_ERR      'システム異常発生
            
            GoTo Abort_Tran
    End Select

    '-----------------  入庫情報出力
    sts = S_NYUKO_Update_Proc(Hinban, QTY, SYUSHI)
    Select Case sts
        Case False
        Case True           '入庫時は発生しない
        Case SYS_CANCEL
'2017.09.22
            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
            Sendbuf = Text_Create_Proc()
            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
            Furikae_Proc = False
            GoTo Abort_Tran
        Case SYS_ERR
            Call Err_Send_Proc("システム異常発生", "", "", "", "")
            Sendbuf = Text_Create_Proc()
            Furikae_Proc = SYS_ERR    'システム異常発生
            
            GoTo Abort_Tran
    End Select







End_Tran:
                                        'トランザクション終了
    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpEndTransaction, "", 0)
        GoTo Abort_Tran
    End If
                                        '次の作業要求
    
    Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
    Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
    sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
    Select Case sts
        Case BtNoErr
        '   -------------------------------- エラーメッセージ作成
        Case Else
        '重要な要因なので未登録はシステム停止とする
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
        Exit Function
    End Select
    
    
    ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
    If Sagyo_Send_Proc() Then
        Sendbuf = Text_Create_Proc()
        Exit Function
    End If
            
    Sendbuf = Text_Create_Proc()
    
    
    
    Furikae_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Public Function S_NYUKO_Update_Proc(Hinban As String, QTY As Long, SYUSHI As String) As Integer
'----------------------------------------------------------------------------
'                  資材注文ﾃﾞｰﾀ更新 2007.06.28
'----------------------------------------------------------------------------
Dim sts         As Integer
Dim ans         As Integer
Dim com         As Integer

Dim SEQNO       As Integer

Dim RETRY_CNT   As Integer


    S_NYUKO_Update_Proc = True
                                        
                                        
    '---------------------------------------------------    '資材注文データ更新 (振替元)
                                        '管理ファイルより資材注文番号の獲得
    Call UniCode_Conv(K0_P_KANRI.REC_NO, P_ST_KANRI_No)
        
    RETRY_CNT = 0
        
    Do
        sts = BTRV(BtOpGetEqual + BtSNoWait, P_KANRI_POS, P_KANRIREC, Len(P_KANRIREC), K0_P_KANRI, Len(K0_P_KANRI), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrKeyNotFound
            
                If P_KANRI_MAKE_Proc() Then
                    S_NYUKO_Update_Proc = SYS_ERR
                    Exit Function
                End If
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE         'これは無い
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
            
        End Select
        
        
    Loop
    
    '注文書ａ{１

    If CLng(StrConv(P_KANRIREC.ORDER_NO, vbUnicode)) = 99999 Then
        Call UniCode_Conv(P_KANRIREC.ORDER_NO, "00001")
    Else
        Call UniCode_Conv(P_KANRIREC.ORDER_NO, Format(CLng(StrConv(P_KANRIREC.ORDER_NO, vbUnicode)) + 1, "00000"))
    End If


    RETRY_CNT = 0
    Do
        
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        
        sts = BTRV(BtOpUpdate, P_KANRI_POS, P_KANRIREC, Len(P_KANRIREC), K0_P_KANRI, Len(K0_P_KANRI), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpUpdate, "管理マスタ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
    Loop
                                                                            
                                                                            
    '品目ﾏｽﾀ読込み
    Call UniCode_Conv(K0_ITEM.JGYOBU, SHIZAI)
    Call UniCode_Conv(K0_ITEM.NAIGAI, NAIGAI_NAI)
    Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
    sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_CANCEL
            Exit Function
        Case Else
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_ERR
            Exit Function
    End Select
                                                                            
                                                                            '注文
    Call UniCode_Conv(P_SHORDER_REC.ORDER_NO, StrConv(P_KANRIREC.ORDER_NO, vbUnicode))
    Call UniCode_Conv(P_SHORDER_REC.ORDER_DT, Format(Now, "YYYYMMDD"))      '注文日
    Call UniCode_Conv(P_SHORDER_REC.Print_datetime, "")                     '発行日時
    Call UniCode_Conv(P_SHORDER_REC.TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)   '担当者
    Call UniCode_Conv(P_SHORDER_REC.JGYOBU, SHIZAI)                         '事業部（＝資材）
    Call UniCode_Conv(P_SHORDER_REC.NAIGAI, NAIGAI_NAI)                     '国内外
    Call UniCode_Conv(P_SHORDER_REC.HIN_GAI, Hinban)         '品番
                                                                            '注文先ｺｰﾄﾞ
    Call UniCode_Conv(P_SHORDER_REC.ORDER_CODE, StrConv(ITEMREC.G_SHIIRE_TBL(0).CODE, vbUnicode))
    Call UniCode_Conv(P_SHORDER_REC.DELI_CODE, "")                          '納入先ｺｰﾄﾞ
                                                                            '注文数
    Call UniCode_Conv(P_SHORDER_REC.ORDER_QTY, Format(QTY * -1, _
                                                                "00000000.00"))
        
    Call UniCode_Conv(P_SHORDER_REC.Y_NOUKI_DT, Format(Now, "YYYYMMDD"))    '予定納期
        
    If IsNumeric(StrConv(ITEMREC.G_ST_SHITAN, vbUnicode)) Then              '単価
        Call UniCode_Conv(P_SHORDER_REC.TANKA, Format(CDbl(StrConv(ITEMREC.G_ST_SHITAN, vbUnicode)), _
                                                            "00000000.00"))
    Else
        Call UniCode_Conv(P_SHORDER_REC.TANKA, "00000000.00")
    End If
    Call UniCode_Conv(P_SHORDER_REC.LOT, "00000001")                        'LOT
    
    Call UniCode_Conv(P_SHORDER_REC.KAN_F, P_KAN_ON)                        '完了ﾌﾗｸﾞ（即完了）
    Call UniCode_Conv(P_SHORDER_REC.KAN_DT, Format(Now, "YYYYMMDD"))        '完了日
    Call UniCode_Conv(P_SHORDER_REC.BUNNOU_CNT, "01")                       '受入回数
    Call UniCode_Conv(P_SHORDER_REC.UKEIRE_QTY, Format(QTY * -1, "00000000.00"))
    
    Call UniCode_Conv(P_SHORDER_REC.CANCEL_F, P_CANCEL_OFF)                 'ｷｬﾝｾﾙﾌﾗｸﾞ
    Call UniCode_Conv(P_SHORDER_REC.CANCEL_DATETIME, "")                    'ｷｬﾝｾﾙ日時
    
    Call UniCode_Conv(P_SHORDER_REC.PRINT_F, P_PRINT_ON)                    '印刷ﾌﾗｸﾞ(印刷済とする)
    
    Call UniCode_Conv(P_SHORDER_REC.WS_NO, Format(ID_KANRI_TBL(ING_No).ID, "000"))        '入力端末
                                                                            '仕入区分
    Call UniCode_Conv(P_SHORDER_REC.G_SHIIRE_KBN, StrConv(ITEMREC.G_SHIIRE_KBN, vbUnicode))
        
    '収支単位
    Call UniCode_Conv(P_SHORDER_REC.G_SYUSHI, StrConv(ITEMREC.G_SYUSHI, vbUnicode))
        
        
    '受払先ﾏｽﾀ読込み
    Call UniCode_Conv(K0_P_UKEHARAI.UKEHARAI_CODE, StrConv(ITEMREC.G_SHIIRE_TBL(0).CODE, vbUnicode))
    sts = BTRV(BtOpGetEqual, P_UKEHARAI_POS, P_UKEHARAIREC, Len(P_UKEHARAIREC), K0_P_UKEHARAI, Len(K0_P_UKEHARAI), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "受払先ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_CANCEL
            Exit Function
        Case Else
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "受払先ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_ERR
            Exit Function
    End Select
    
                                                                                '取引先区分
    Call UniCode_Conv(P_SHORDER_REC.TORI_KBN, StrConv(P_UKEHARAIREC.TORI_KBN, vbUnicode))
        
        
    Call UniCode_Conv(P_SHORDER_REC.FILLER, "")

    RETRY_CNT = 0

    Do
        
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        
        sts = BTRV(BtOpInsert, P_SHORDER_POS, P_SHORDER_REC, Len(P_SHORDER_REC), K0_P_SHORDER, Len(K0_P_SHORDER), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpInsert, "資材注文ﾃﾞｰﾀ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpInsert, "資材注文ﾃﾞｰﾀ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
    
    Loop
    
    
    
    
    SEQNO = 0
    
    
    
    '資材受入履歴ﾃﾞｰﾀ処理
    Call UniCode_Conv(K0_P_SHUKEIRE.ORDER_NO, StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode))
    Call UniCode_Conv(K0_P_SHUKEIRE.SEQNO, "")
    
    com = BtOpGetGreater
    
    Do
    
        sts = BTRV(com, P_SHUKEIRE_POS, P_SHUKEIRE_REC, Len(P_SHUKEIRE_REC), K0_P_SHUKEIRE, Len(K0_P_SHUKEIRE), 0)
            
        Select Case sts
            Case BtNoErr
            
                If StrConv(P_SHUKEIRE_REC.ORDER_NO, vbUnicode) <> StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode) Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            
            Case Else
                Call File_Error(sts, com, "資材受入履歴", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
                
        End Select
        
        
        
        SEQNO = SEQNO + 1
        
        
        com = BtOpGetNext
        
    Loop
        
                                                                                '注文
    Call UniCode_Conv(P_SHUKEIRE_REC.ORDER_NO, StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode))                                                                                         '受入日
                                                                                '注文先
    Call UniCode_Conv(P_SHUKEIRE_REC.ORDER_CODE, StrConv(P_SHORDER_REC.ORDER_CODE, vbUnicode))
                                                                                '受入日
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_DT, Format(Now, "YYYYMMDD"))
                                                                                '受入数量
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_QTY, Format(QTY * -1, "00000000.00"))
                                                                                '受入単価
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_TANKA, StrConv(P_SHORDER_REC.TANKA, vbUnicode))
                                                                                '受入金額
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_KINGAKU, Format(QTY * -1 * _
                                                        CDbl(StrConv(P_SHORDER_REC.TANKA, vbUnicode)), "00000000"))
    Call UniCode_Conv(P_SHUKEIRE_REC.LAST_F, P_UKEIRE_END)
                                                                                '計上年月
    Call UniCode_Conv(P_SHUKEIRE_REC.KEIJYO_YM, Left(Format(Now, "YYYYMMDD"), 6))
        
    Call UniCode_Conv(P_SHUKEIRE_REC.FILLER, "")
                                                        '更新日時
    Call UniCode_Conv(P_SHUKEIRE_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))
    
    
    RETRY_CNT = 0
    Do
            
        SEQNO = SEQNO + 1
                                                '追番
        Call UniCode_Conv(P_SHUKEIRE_REC.SEQNO, Format(SEQNO, "000"))
            
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
            
        sts = BTRV(BtOpInsert, P_SHUKEIRE_POS, P_SHUKEIRE_REC, Len(P_SHUKEIRE_REC), K0_P_SHUKEIRE, Len(K0_P_SHUKEIRE), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrDuplicates
            
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpInsert, "資材受入履歴", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpInsert, "資材受入履歴", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
        
    Loop



    '---------------------------------------------------    '資材注文データ更新 (振替先)
                                        '管理ファイルより資材注文番号の獲得
    Call UniCode_Conv(K0_P_KANRI.REC_NO, P_ST_KANRI_No)
        
    RETRY_CNT = 0
        
    Do
        sts = BTRV(BtOpGetEqual + BtSNoWait, P_KANRI_POS, P_KANRIREC, Len(P_KANRIREC), K0_P_KANRI, Len(K0_P_KANRI), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrKeyNotFound
            
                If P_KANRI_MAKE_Proc() Then
                    S_NYUKO_Update_Proc = SYS_ERR
                    Exit Function
                End If
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE         'これは無い
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
            
        End Select
        
        
    Loop
    
    '注文書ａ{１

    If CLng(StrConv(P_KANRIREC.ORDER_NO, vbUnicode)) = 99999 Then
        Call UniCode_Conv(P_KANRIREC.ORDER_NO, "00001")
    Else
        Call UniCode_Conv(P_KANRIREC.ORDER_NO, Format(CLng(StrConv(P_KANRIREC.ORDER_NO, vbUnicode)) + 1, "00000"))
    End If


    RETRY_CNT = 0
    Do
        
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        
        sts = BTRV(BtOpUpdate, P_KANRI_POS, P_KANRIREC, Len(P_KANRIREC), K0_P_KANRI, Len(K0_P_KANRI), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "管理マスタ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpUpdate, "管理マスタ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
    Loop
                                                                            
                                                                            
    '品目ﾏｽﾀ読込み
    Call UniCode_Conv(K0_ITEM.JGYOBU, SHIZAI)
    Call UniCode_Conv(K0_ITEM.NAIGAI, NAIGAI_NAI)
    Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
    sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_CANCEL
            Exit Function
        Case Else
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_ERR
            Exit Function
    End Select
                                                                            
                                                                            '注文
    Call UniCode_Conv(P_SHORDER_REC.ORDER_NO, StrConv(P_KANRIREC.ORDER_NO, vbUnicode))
    Call UniCode_Conv(P_SHORDER_REC.ORDER_DT, Format(Now, "YYYYMMDD"))      '注文日
    Call UniCode_Conv(P_SHORDER_REC.Print_datetime, "")                     '発行日時
    Call UniCode_Conv(P_SHORDER_REC.TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)   '担当者
    Call UniCode_Conv(P_SHORDER_REC.JGYOBU, SHIZAI)                         '事業部（＝資材）
    Call UniCode_Conv(P_SHORDER_REC.NAIGAI, NAIGAI_NAI)                     '国内外
    Call UniCode_Conv(P_SHORDER_REC.HIN_GAI, Hinban)         '品番
                                                                            '注文先ｺｰﾄﾞ
    Call UniCode_Conv(P_SHORDER_REC.ORDER_CODE, StrConv(ITEMREC.G_SHIIRE_TBL(0).CODE, vbUnicode))
    Call UniCode_Conv(P_SHORDER_REC.DELI_CODE, "")                          '納入先ｺｰﾄﾞ
                                                                            '注文数
    Call UniCode_Conv(P_SHORDER_REC.ORDER_QTY, Format(QTY, "00000000.00"))
        
    Call UniCode_Conv(P_SHORDER_REC.Y_NOUKI_DT, Format(Now, "YYYYMMDD"))    '予定納期
        
    If IsNumeric(StrConv(ITEMREC.G_ST_SHITAN, vbUnicode)) Then              '単価
        Call UniCode_Conv(P_SHORDER_REC.TANKA, Format(CDbl(StrConv(ITEMREC.G_ST_SHITAN, vbUnicode)), _
                                                            "00000000.00"))
    Else
        Call UniCode_Conv(P_SHORDER_REC.TANKA, "00000000.00")
    End If
    Call UniCode_Conv(P_SHORDER_REC.LOT, "00000001")                        'LOT
    
    Call UniCode_Conv(P_SHORDER_REC.KAN_F, P_KAN_ON)                        '完了ﾌﾗｸﾞ（即完了）
    Call UniCode_Conv(P_SHORDER_REC.KAN_DT, Format(Now, "YYYYMMDD"))        '完了日
    Call UniCode_Conv(P_SHORDER_REC.BUNNOU_CNT, "01")                       '受入回数
    Call UniCode_Conv(P_SHORDER_REC.UKEIRE_QTY, Format(QTY, "00000000.00"))
    
    Call UniCode_Conv(P_SHORDER_REC.CANCEL_F, P_CANCEL_OFF)                 'ｷｬﾝｾﾙﾌﾗｸﾞ
    Call UniCode_Conv(P_SHORDER_REC.CANCEL_DATETIME, "")                    'ｷｬﾝｾﾙ日時
    
    Call UniCode_Conv(P_SHORDER_REC.PRINT_F, P_PRINT_ON)                    '印刷ﾌﾗｸﾞ(印刷済とする)
    
    Call UniCode_Conv(P_SHORDER_REC.WS_NO, Format(ID_KANRI_TBL(ING_No).ID, "000"))        '入力端末
                                                                            '仕入区分
    Call UniCode_Conv(P_SHORDER_REC.G_SHIIRE_KBN, StrConv(ITEMREC.G_SHIIRE_KBN, vbUnicode))
        
    '収支単位
    Call UniCode_Conv(P_SHORDER_REC.G_SYUSHI, SYUSHI)
        
        
    '受払先ﾏｽﾀ読込み
    Call UniCode_Conv(K0_P_UKEHARAI.UKEHARAI_CODE, StrConv(ITEMREC.G_SHIIRE_TBL(0).CODE, vbUnicode))
    sts = BTRV(BtOpGetEqual, P_UKEHARAI_POS, P_UKEHARAIREC, Len(P_UKEHARAIREC), K0_P_UKEHARAI, Len(K0_P_UKEHARAI), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "受払先ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_CANCEL
            Exit Function
        Case Else
            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "受払先ﾏｽﾀ", 0)
            S_NYUKO_Update_Proc = SYS_ERR
            Exit Function
    End Select
    
                                                                                '取引先区分
    Call UniCode_Conv(P_SHORDER_REC.TORI_KBN, StrConv(P_UKEHARAIREC.TORI_KBN, vbUnicode))
        
        
    Call UniCode_Conv(P_SHORDER_REC.FILLER, "")

    RETRY_CNT = 0

    Do
        
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        
        sts = BTRV(BtOpInsert, P_SHORDER_POS, P_SHORDER_REC, Len(P_SHORDER_REC), K0_P_SHORDER, Len(K0_P_SHORDER), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpInsert, "資材注文ﾃﾞｰﾀ", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpInsert, "資材注文ﾃﾞｰﾀ", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
    
    Loop
    
    
    
    
    SEQNO = 0
    
    
    
    '資材受入履歴ﾃﾞｰﾀ処理
    Call UniCode_Conv(K0_P_SHUKEIRE.ORDER_NO, StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode))
    Call UniCode_Conv(K0_P_SHUKEIRE.SEQNO, "")
    
    com = BtOpGetGreater
    
    Do
    
        sts = BTRV(com, P_SHUKEIRE_POS, P_SHUKEIRE_REC, Len(P_SHUKEIRE_REC), K0_P_SHUKEIRE, Len(K0_P_SHUKEIRE), 0)
            
        Select Case sts
            Case BtNoErr
            
                If StrConv(P_SHUKEIRE_REC.ORDER_NO, vbUnicode) <> StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode) Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            
            Case Else
                Call File_Error(sts, com, "資材受入履歴", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
                
        End Select
        
        
        
        SEQNO = SEQNO + 1
        
        
        com = BtOpGetNext
        
    Loop
        
                                                                                '注文
    Call UniCode_Conv(P_SHUKEIRE_REC.ORDER_NO, StrConv(P_SHORDER_REC.ORDER_NO, vbUnicode))                                                                                         '受入日
                                                                                '注文先
    Call UniCode_Conv(P_SHUKEIRE_REC.ORDER_CODE, StrConv(P_SHORDER_REC.ORDER_CODE, vbUnicode))
                                                                                '受入日
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_DT, Format(Now, "YYYYMMDD"))
                                                                                '受入数量
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_QTY, Format(QTY, "00000000.00"))
                                                                                '受入単価
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_TANKA, StrConv(P_SHORDER_REC.TANKA, vbUnicode))
                                                                                '受入金額
    Call UniCode_Conv(P_SHUKEIRE_REC.UKEIRE_KINGAKU, Format(QTY * _
                                                        CDbl(StrConv(P_SHORDER_REC.TANKA, vbUnicode)), "00000000"))
    Call UniCode_Conv(P_SHUKEIRE_REC.LAST_F, P_UKEIRE_END)
                                                                                '計上年月
    Call UniCode_Conv(P_SHUKEIRE_REC.KEIJYO_YM, Left(Format(Now, "YYYYMMDD"), 6))
        
    Call UniCode_Conv(P_SHUKEIRE_REC.FILLER, "")
                                                        '更新日時
    Call UniCode_Conv(P_SHUKEIRE_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))
    
    
    RETRY_CNT = 0
    Do
            
        SEQNO = SEQNO + 1
                                                '追番
        Call UniCode_Conv(P_SHUKEIRE_REC.SEQNO, Format(SEQNO, "000"))
            
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
            
        sts = BTRV(BtOpInsert, P_SHUKEIRE_POS, P_SHUKEIRE_REC, Len(P_SHUKEIRE_REC), K0_P_SHUKEIRE, Len(K0_P_SHUKEIRE), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrDuplicates
            
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                RETRY_CNT = RETRY_CNT + 1
                If RETRY_CNT > FILE_RETRY Then
                    Call File_Error(sts, BtOpInsert, "資材受入履歴", 0)
                    S_NYUKO_Update_Proc = SYS_CANCEL
                    Exit Function
                End If
            Case Else
                Call File_Error(sts, BtOpInsert, "資材受入履歴", 0)
                S_NYUKO_Update_Proc = SYS_ERR
                Exit Function
        End Select
        
    Loop


    
    S_NYUKO_Update_Proc = False
    
End Function

Public Function SYUKA_CANCEL_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『出荷予定キャンセル処理』
'   2007.11.02
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8


Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim JITU_QTY        As Long

Dim SYUKO_QTY       As Long
Dim KENPIN_YMD      As String * 8


Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim KAN_KBN         As String * 1

Dim MENU_NO         As String * 2

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim CAN_ANS         As String * 1

Dim RETRY_CNT       As Integer

    SYUKA_CANCEL_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            RET_JGYOBU = Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 1)
                            ID_NO = Right(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 12)
                        Else
                            RET_JGYOBU = ID_KANRI_TBL(ING_No).JGYOBU
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                RET_JGYOBU, _
                                                RET_NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY, _
                                                , _
                                                KENPIN_YMD, _
                                                SYUKO_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKA_CANCEL_Proc = False
                                    Exit Function
                                End If
                
                
                
                
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKA_CANCEL_Proc = False
                                Exit Function
                        End Select
                
                
                        If KAN_KBN <> KAN_KBN_UN Then
                            
                            
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                            
                            
                            
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出庫処理済み", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKA_CANCEL_Proc = False
                            Exit Function
                        End If
                                                        
                                                        
                                                        
                        If SYUKO_QTY <> 0 Or Trim(KENPIN_YMD) <> "" Then
                            
                            
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                            
'2017.09.22
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出庫実績有り", "キャンセル不可", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKA_CANCEL_Proc = False
                            Exit Function
                        End If
                                                        
                                                        
                                                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                           
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_CAN_ANS)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_CAN_ANS)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "20"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（はい／いいえ）
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                    
                    Case LCD_CAN_ANS    '（はい／いいえ）
                        CAN_ANS = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        Select Case CAN_ANS
                        
                        
                        
                            Case "1"        'はい　データ更新
                        
                        
                        
                                '----------------------------------- データ更新処理開始 -----------
                                                                    'トランザクション開始
                                sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    Exit Function
                                End If
                                            
            
            
            
            
                                                        '出荷予定読込み
                                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).S_JGYOBU)   '事業部
                                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'IDNo

                                RETRY_CNT = 0
                                Do
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            
                                            SYUKA_CANCEL_Proc = False
                                            GoTo Abort_Tran
                                                
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'リトライ回数チェック
                                            If FILE_RETRY <> 0 Then
    
                                                RETRY_CNT = RETRY_CNT + 1
                                                
                                                If RETRY_CNT > FILE_RETRY Then
                                                            '回数オーバー
 '2017.09.22
                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                                                    Sendbuf = Text_Create_Proc()
                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                                    
                                                    SYUKA_CANCEL_Proc = False
                                                    GoTo Abort_Tran
    
                                                End If
    
                                            End If
    
'                                            DoEvents
                                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                                DoEvents                                                    '2016.01.26
                                            End If                                                          '2016.01.26
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                            SYUKA_CANCEL_Proc = SYS_ERR
                                            GoTo Abort_Tran
                                    End Select
                                Loop
            
                                                        '出荷予定削除
                                Do
                                
                                
                                    sts = BTRV(BtOpDelete, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            
                                            SYUKA_CANCEL_Proc = False
                                            GoTo Abort_Tran
                                                
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'リトライ回数チェック
                                            If FILE_RETRY <> 0 Then
    
                                                RETRY_CNT = RETRY_CNT + 1
                                                If RETRY_CNT > FILE_RETRY Then
                                                            '回数オーバー
'2017.09.22
                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                                                    Sendbuf = Text_Create_Proc()
                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                                    
                                                    SYUKA_CANCEL_Proc = False
                                                    GoTo Abort_Tran
    
                                                End If
    
                                            End If
    
'                                            DoEvents
                                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                                DoEvents                                                    '2016.01.26
                                            End If                                                          '2016.01.26
                                        Case Else
                                            Call File_Error(sts, BtOpDelete, "出荷予定", 0)
                                            SYUKA_CANCEL_Proc = SYS_ERR
                                            GoTo Abort_Tran
                                    End Select
                                
                                
                                Loop
            
            
                                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                    If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                                                ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                                ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                                ID_KANRI_TBL(ING_No).MENU_LV1, _
                                                                ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                                                ID_KANRI_TBL(ING_No).Hinban, _
                                                                0, 0, , , _
                                                                ID_KANRI_TBL(ING_No).ID_NO, _
                                                                ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                                ID_KANRI_TBL(ING_No).SS_CODE) Then
        

                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpEndTransaction, "", 0)
                                        GoTo Abort_Tran
                                    End If
                                End If
                                                
                                If SYUKA_LOG_ON Then
                                    Call SYUKA_LOG_OUT_PROC("DEL", "AFT")
                                End If
                                                
                                                
                                                'トランザクション終了
                                sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpEndTransaction, "", 0)
                                    GoTo Abort_Tran
                                End If
                                        
                                        
                                        
                                        
                                        
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.FileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                        
                                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                
                                
                                '-----------------------------------------------１行目
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
'2017.09.22
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "キャンセルしました")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "キャンセルしました")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                        '入力桁数
                                                                                        
                                                                                        
                                Send_Text.Box_Type(3).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                        
                                                                                        
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                            Case "9"        'いいえ　処理なし
                                        
                                            
                                sts = Data_Clear_Proc(0, Sendbuf)
                                Select Case sts
                                    Case SYS_CANCEL
                                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    
                                    Case SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
                                        
                                        
                                                '次の作業要求
                                                
                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                    
                                Sendbuf = Text_Create_Proc()
                        Case Else
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, CAN_ANS, "(1 OR 9)", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKA_CANCEL_Proc = False
                                Exit Function
                
                
                    End Select
                End Select
            Next i
        
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                '検品確認終了時は、伝票ＩＤ要求に戻す為の特殊処理
                
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "12"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()


'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
            
                Sendbuf = Text_Create_Proc()
    
    
    End Select
    SYUKA_CANCEL_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function



Public Function SYUKO_CANCEL_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『出庫キャンセル処理』
'   2008.12.05
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8


Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim JITU_QTY        As Long

Dim SYUKO_QTY       As Long
Dim KENPIN_YMD      As String * 8


Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim KAN_KBN         As String * 1

Dim MENU_NO         As String * 2

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim CAN_ANS         As String * 1

Dim RETRY_CNT       As Integer

    SYUKO_CANCEL_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            RET_JGYOBU = Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 1)
                            ID_NO = Right(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), 12)
                        Else
                            RET_JGYOBU = ID_KANRI_TBL(ING_No).JGYOBU
                            ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                RET_JGYOBU, _
                                                RET_NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY, _
                                                , _
                                                KENPIN_YMD, _
                                                SYUKO_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKO_CANCEL_Proc = False
                                    Exit Function
                                End If
                
                
                
                
                
                            Case True
                                Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_CANCEL_Proc = False
                                Exit Function
                        End Select
                
                                                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).DEN_NO = DEN_NO
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                           
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        
                        '-----------------------------------------------１行目
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        ID_KANRI_TBL(ING_No).Send_Syuka_QTY = SYUKA_QTY
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_CAN_ANS)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_CAN_ANS)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "20"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（はい／いいえ）
            For i = 0 To M_Gyo - 1
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                
                    
                    Case LCD_CAN_ANS    '（はい／いいえ）
                        CAN_ANS = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        Select Case CAN_ANS
                        
                        
                        
                            Case "1"        'はい　データ更新
                        
                        
                        
                                '----------------------------------- データ更新処理開始 -----------
                                                                    'トランザクション開始
                                sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    Exit Function
                                End If
                                            
            
            
            
            
                                                        '出荷予定読込み
                                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).S_JGYOBU)   '事業部
                                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'IDNo

                                RETRY_CNT = 0
                                Do
                                    sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            
                                            SYUKO_CANCEL_Proc = False
                                            GoTo Abort_Tran
                                                
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'リトライ回数チェック
                                            If FILE_RETRY <> 0 Then
    
                                                RETRY_CNT = RETRY_CNT + 1
                                                If RETRY_CNT > FILE_RETRY Then
                                                            '回数オーバー
'2017.09.22
                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                                                    Sendbuf = Text_Create_Proc()
                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                                    
                                                    SYUKO_CANCEL_Proc = False
                                                    GoTo Abort_Tran
    
                                                End If
    
                                            End If
    
'                                            DoEvents
                                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                                DoEvents                                                    '2016.01.26
                                            End If                                                          '2016.01.26
                                        Case Else
                                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                            SYUKO_CANCEL_Proc = SYS_ERR
                                            GoTo Abort_Tran
                                    End Select
                                Loop
            
                                                        '出荷予定クリアー更新
                                
                                '完了区分
                                Call UniCode_Conv(Y_SYUREC.KAN_KBN, KAN_KBN_UN)
                                '完了日付
                                Call UniCode_Conv(Y_SYUREC.KAN_YMD, "")
                                '検品日付
                                Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, "")
                                '実績数量
                                Call UniCode_Conv(Y_SYUREC.JITU_SURYO, "0000000")
                                '検品担当者
                                Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, "")
                                '検品時刻
                                Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, "")
    
                                '画面検品ﾌﾗｸﾞ
                                Call UniCode_Conv(Y_SYUREC.G_KENPIN_F, "")
                                '検品時数量
                                Call UniCode_Conv(Y_SYUREC.KENPIN_SURYO, "0000000")
    
    
                                
                                Do
                                
                                
                                    sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            
                                            SYUKO_CANCEL_Proc = False
                                            GoTo Abort_Tran
                                                
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                                            'リトライ回数チェック
                                            If FILE_RETRY <> 0 Then
    
                                                RETRY_CNT = RETRY_CNT + 1
                                                If RETRY_CNT > FILE_RETRY Then
                                                            '回数オーバー
'2017.09.22
                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                                                    Sendbuf = Text_Create_Proc()
                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                                    
                                                    SYUKO_CANCEL_Proc = False
                                                    GoTo Abort_Tran
    
                                                End If
    
                                            End If
    
'                                            DoEvents
                                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                                DoEvents                                                    '2016.01.26
                                            End If                                                          '2016.01.26
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                                            SYUKO_CANCEL_Proc = SYS_ERR
                                            GoTo Abort_Tran
                                    End Select
                                
                                
                                Loop
            
            
                                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                    If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                                                ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                                ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                                ID_KANRI_TBL(ING_No).MENU_LV1, _
                                                                ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE, _
                                                                ID_KANRI_TBL(ING_No).Hinban, _
                                                                0, 0, , , _
                                                                ID_KANRI_TBL(ING_No).ID_NO, _
                                                                ID_KANRI_TBL(ING_No).MTS_CODE, _
                                                                ID_KANRI_TBL(ING_No).SS_CODE) Then
        

                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpEndTransaction, "", 0)
                                        GoTo Abort_Tran
                                    End If
                                End If
                                                
'                                If SYUKA_LOG_ON Then
'                                    Call SYUKA_LOG_OUT_PROC("DEL", "AFT")
'                                End If
                                                
                                                
                                                'トランザクション終了
                                sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpEndTransaction, "", 0)
                                    GoTo Abort_Tran
                                End If
                                        
                                        
                                        
                                        
                                        
                                '-----------------------------------------------ヘッダー
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                        
                                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                        
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                        
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                        
                                Send_Text.FileName = ""                                 '送信データファイル名
                                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                        
                                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                
                                
                                '-----------------------------------------------１行目
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                                                                        'BOX属性
                                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                        '表示内容
'2017.09.22
                                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(0).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(0).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(0).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                '-----------------------------------------------２行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "キャンセルしました")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "キャンセルしました")
                                                                                        '数値初期表示
                                Send_Text.Box_Type(1).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(1).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(1).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(2).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(2).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(2).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).ID_NO)
                                                                                        '数値初期表示
                                Send_Text.Box_Type(3).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(3).Start_Pos = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                        '入力桁数
                                                                                        
                                                                                        
                                Send_Text.Box_Type(3).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                        
                                                                                        
                                                                                        
                                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                '-----------------------------------------------４行目
                                                                                        'BOX属性
                                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                        '表示内容
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    
                                                                                        '数値初期表示
                                Send_Text.Box_Type(4).INIT = ""
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                        '初期カーソル位置
                                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                        '入力桁数
                                Send_Text.Box_Type(4).Max_Size = "00"
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                        
                                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                                Sendbuf = Text_Create_Proc()
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                                        
                            Case "9"        'いいえ　処理なし
                                        
                                            
                                sts = Data_Clear_Proc(0, Sendbuf)
                                Select Case sts
                                    Case SYS_CANCEL
                                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    
                                    Case SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
                                        
                                        
                                                '次の作業要求
                                                
                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                    
                                Sendbuf = Text_Create_Proc()
                        Case Else
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, CAN_ANS, "(1 OR 9)", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SYUKO_CANCEL_Proc = False
                                Exit Function
                
                
                    End Select
                End Select
            Next i
        
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                '検品確認終了時は、伝票ＩＤ要求に戻す為の特殊処理
                
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).MTS_CODE & ID_KANRI_TBL(ING_No).SS_CODE)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_ID_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_ID_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "12"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()


'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
            
                Sendbuf = Text_Create_Proc()
    
    
    End Select
    SYUKO_CANCEL_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Public Function SYUKA_DEL_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『出荷削除処理』
'       2009.03.17
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 11
Dim Hinban          As String * 20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1

'2010.12.07
'Dim HIN_NO          As String * 13
Dim HIN_NO          As String * 20
'2010.12.07

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1


Dim i               As Integer

Dim MENU_NO         As String * 2



    SYUKA_DEL_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "出荷処理不可", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SYUKA_DEL_Proc = False
                            Exit Function
                        End If
    
    
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_UN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    SYUKA_DEL_Proc = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                SYUKA_DEL_Proc = False
                                Exit Function
                        End Select
                
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
                        ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SYUKA_QTY = SYUKA_QTY
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(1).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = ""  '2007.07.21
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                
                                                                                
                                                                                
                                                                                
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, MTS_CODE & SS_CODE)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, MTS_CODE & SS_CODE)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(2).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = ""  '2007.07.21
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""



                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo & ":" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo & ":" & StrConv(Format(SYUKA_QTY, "#0"), vbWide))
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "20"
                                                                                
                        Send_Text.Box_Type(4).Max_Size = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""


                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
            
            
            
            
        Case Step_Sagyo2_RES        '2回目の受信（Any Key）
            
            
            
            
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            '出荷予定の読み込み
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)   'ID
    
            Do
            
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrKeyNotFound
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        SYUKA_DEL_Proc = False
                        GoTo Abort_Tran
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        SYUKA_DEL_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
        
            Loop


                                            
                                            
                                            '出荷予定書込み
            Do
                sts = BTRV(BtOpInsert, DEL_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_DEL_SYU, Len(K0_DEL_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        SYUKA_DEL_Proc = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        SYUKA_DEL_Proc = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop
                                        
                                            '出荷予定書込み
            Do
                sts = BTRV(BtOpDelete, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        SYUKA_DEL_Proc = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                        SYUKA_DEL_Proc = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            Loop
                                        
                                        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                        
            '2004.07.16 ↓
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        "", , , , , MENU_NO, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE, ID_KANRI_TBL(ING_No).SS_CODE, _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    SYUKA_DEL_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
            '2004.07.16 ↑
                                        
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    SYUKA_DEL_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If



End Function




Public Function Label_File_Make_Proc(FileName As String, Print_Su As Long, Start_Page_No As Long, PRINT_TOTAL_SU As Long) As Integer
'-------------------------------------------------------
'
'   『荷札用データファイル作成』
'       2010.01.28
'-------------------------------------------------------
Dim sts         As Integer


Dim FileNo      As Long

Dim FullPath    As String


Dim LCnt        As Integer

Dim OKURI_NO    As Integer


Dim Work        As String * 20


    
Dim c           As String * 128     '2010.06.08
Dim DEF_FLG     As Boolean          '2010.06.08

    
    
'''''Exit Function
    
    Label_File_Make_Proc = True








    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & F0_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & F0_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    End If


    If GetIni("LABEL", "LABEL_DEF", "F110010LABEL", c) Then   '2010.06.08
        DEF_FLG = False
    Else
        DEF_FLG = True
    End If


    On Error Resume Next
    Kill (FullPath)             '送信用ファイル削除
    On Error GoTo 0
        
    FileNo = FreeFile           '送信用ファイルＯＰＥＮ
    Open FullPath For Output As #FileNo

    Print #FileNo, "#"
    Print #FileNo, "JOB"
    
    
    If DEF_FLG Then                                     '2010.06.08
        Print #FileNo, Trim(c)
    Else
        Print #FileNo, "DEF MK=1,DK=8,MD=3,PW=384,PH=344,XO=8,UM=24,BM=0,AF=1"
    End If





'    Print #FileNo, "DEF MK=1,DK=8,MD=1,PW=384,PH=344,XO=8,UM=8"
    Print #FileNo, "START"
    OKURI_NO = Len(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) + 1
    '送り状(BC)
    If Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_CHARTER_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_AKABOU_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_LOGISTIC_CD) Then
        Print #FileNo, ""
    Else
        
        
'        Print #FileNo, "BCD TP=6,X=0,Y=22,RA=1,HT=40,HR=0,MG=0,NS=" & Format(OKURI_NO, "#0") & ",NE=2,NZ=0"
        Print #FileNo, "BCD TP=6,X=0,Y=0,RA=1,HT=80,HR=1,MG=0,NS=" & Format(OKURI_NO, "#0") & ",NE=2,NZ=0"
        Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) & Format(Start_Page_No, "00")
    End If
    
    Print #FileNo, "#FONT TP=3,CS=0"
    
    '送り状
    If Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_CHARTER_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_AKABOU_CD) Or _
        Trim(Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)) = Trim(KEN_LOGISTIC_CD) Then
        Print #FileNo, ""
    Else
        Print #FileNo, "#TEXT X=33,Y=60,L=1,NS=12,NS=" & Format(OKURI_NO, "#0") & ",NE=2,NZ=0"
        Print #FileNo, "#" & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) & Format(Start_Page_No, "00")
    End If
    
    
    '印刷枚数
    Print #FileNo, "FONT TP=7,CS=0,LG=72,WD=36,LS=0"
'    Print #FileNo, "TEXT X=214,Y=245,L=1,NS=1,NE=3,NZ=1"
    Print #FileNo, "TEXT X=140,Y=245,L=1,NS=1,NE=3,NZ=1"
'    Print #FileNo, Format(Start_Page_No, "000") & "/" & Format(PRINT_TOTAL_SU, "#")
    Print #FileNo, Format(Start_Page_No, "000") & "/" & Format(PRINT_TOTAL_SU, "#")
    

'>>>>>>>>>>>>>>>>>>>>>  DEBUG 2013.02.15
'If PRINT_TOTAL_SU < Start_Page_No Then
'    Debug.Print
'
'
'End If
'
'    Call LOG_OUT("C:\F110010.txt", "ID_NO=" & ID_KANRI_TBL(ING_No).ID_NO & "Start_Page_No/PRINT_TOTAL_SU= " & Start_Page_No & "/" & PRINT_TOTAL_SU)
'>>>>>>>>>>>>>>>>>>>>>  DEBUG 2013.02.15
         
         
    '着店
'    Print #FileNo, "FONT TP=7,CS=0,LG=36,WD=18,LS=0"
'    Print #FileNo, "TEXT X=574,Y=65,L=1"
'
'    Print #FileNo, "着店:000"
         
    
    
        
    
    
'    Print #FileNo, "TEXT X=0,Y=65,L=7"
    
    Print #FileNo, "FONT TP=7,CS=0,LG=36,WD=18,LS=0"
    Print #FileNo, "TEXT X=0,Y=65,L=7"
'    Print #FileNo, "TEXT X=0,Y=0,L=1,NS=1,NE=3,NZ=1"
    
    
    'TEL
'    If Len(Trim(ID_KANRI_TBL(ING_No).KEN_TEL_NO)) < 1 Then
'        Print #FileNo, ""
'    Else
'        If IsNumeric(Mid(Trim(ID_KANRI_TBL(ING_No).KEN_TEL_NO), 1, 1)) Then
'            Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_TEL_NO)
'        Else
'            Print #FileNo, ""
'        End If
'    End If
     Print #FileNo, ""
    
    
    
'    Print #FileNo, "00-0000-0000"
    


    
    '住所1
    Print #FileNo, Trim(Mid(ID_KANRI_TBL(ING_No).KEN_JYUSHO, 1, 20))
    
    '住所2
    Print #FileNo, Trim(Mid(ID_KANRI_TBL(ING_No).KEN_JYUSHO, 21, 20))
    
    '送り先
    Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
    
    '備考
'    Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_BIKOU)
'    Print #FileNo, Trim(ID_KANRI_TBL(ING_No).KEN_MUKE_NAME)
    Print #FileNo, ""
    
    '日付
    Print #FileNo, Mid(ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD, 1, 4) & _
                                               "年" & Mid(ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD, 5, 2) & _
                                               "月" & Mid(ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD, 7, 2) & "日"
    


    
    '送り元
    Print #FileNo, "SDC内部材流通C"
    
    
    If TYAKUTEN_PRINT = 1 Then
        '>>>>>>>>>>>>>>>>>>>>>>> 着店   2017.04.06
        Print #FileNo, "FONT TP=7,CS=0,LG=20,WD=20,LS=0"
        Print #FileNo, "TEXT X=275,Y=245,L=1"
        Print #FileNo, "着"
        
        
        Print #FileNo, "FONT TP=7,CS=0,LG=20,WD=20,LS=0"
        Print #FileNo, "TEXT X=275,Y=285,L=1"
        Print #FileNo, "店"
        
        
        Print #FileNo, "FONT TP=7,CS=0,LG=72,WD=36,LS=0"
        Print #FileNo, "TEXT X=300,Y=245,L=1"
        Print #FileNo, ID_KANRI_TBL(ING_No).KEN_TYAKUTEN
        '>>>>>>>>>>>>>>>>>>>>>>> 着店   2017.04.06
    End If
    
    
    Print #FileNo, "QTY P=" & Format(Print_Su, "#")
    Print #FileNo, "END"


    
    Print #FileNo, "JOBE"
    
    FileName = F0_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
'    fileName = "label001" & ".txt"
'    fileName = "label091" & ".txt"










    Close #FileNo


'''''''''''''''''''''''''''''''''''''''


'
'    On Error Resume Next
'    Kill (FullPath)             '送信用ファイル削除
'    On Error GoTo 0
'
'    FileNo = FreeFile           '送信用ファイルＯＰＥＮ
'    Open FullPath For Output As #FileNo
'
'    Print #FileNo, "JOB"
'
'    Print #FileNo, "JOBE"
'
'
'    Close #FileNo
'''''''''''''''''''''''''''''''''''''''

    Label_File_Make_Proc = False


End Function




Public Function Label_Print_File_Make_Proc(FileName As String, Hinban As String, IRI_QTY As Long) As Integer
'-------------------------------------------------------
'
'   『品番ﾗﾍﾞﾙ用データファイル作成』
'       2011.03.05
'
'-------------------------------------------------------
Dim sts         As Integer


Dim FileNo      As Long

Dim FullPath    As String

Dim wkHinban    As String * 14
Dim wklen       As Long
Dim wkmod       As Long

    
    
    Label_Print_File_Make_Proc = True
'-------------------------  2012.03.19
'    If Right(CtrsWsk1.SendFolder, 1) <> "\" Then
'        FullPath = CtrsWsk1.SendFolder & "\" & EF_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
'    Else
'        FullPath = CtrsWsk1.SendFolder & EF_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
'    End If
    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & FileName & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & FileName & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    End If
'-------------------------  2012.03.19




    On Error Resume Next
    Kill (FullPath)             '送信用ファイル削除
    On Error GoTo 0
        
    FileNo = FreeFile           '送信用ファイルＯＰＥＮ
    Open FullPath For Output As #FileNo







    Print #FileNo, "#"
    Print #FileNo, "JOB"
    
'------------------------------------------------------------------ ラベルプリンター印字濃度    2016.02.15
'    Print #FileNo, "DEF MK=1,DK=8,MD=3,PW=384,PH=344,XO=8,UM=24,BM=0,AF=1"
    Print #FileNo, "DEF MK=1,DK=" & Format(DK_DEF, "0") & ",MD=3,PW=384,PH=344,XO=8,UM=24,BM=0,AF=1"
'------------------------------------------------------------------ ラベルプリンター印字濃度    2016.02.15





    Print #FileNo, "START"
    
    Print #FileNo, "FONT TP=7,CS=0,LG=80,WD=45,LS=0"
    Print #FileNo, "TEXT X=15,Y=30,L=1"
    
    
    
    
    wkHinban = Trim(Hinban)
    If Len(Trim(wkHinban)) < 14 Then
        wklen = 14 - Len(Trim(wkHinban))
        
        
        wklen = ToRoundDown(CCur(wklen / 2), 0)
        If wklen < 1 Then
        Else
            wkHinban = Space(wklen) & Trim(wkHinban)
        End If
    End If
    
'    Print #FileNo, Left(Trim(Hinban), 14)
    Print #FileNo, wkHinban

    
    Print #FileNo, "BCD TP=7,X=40,Y=120,DR=0,NW=1,RA=,HT=100,HR=0,MG=0,NS=0,NE=0,NZ=0"
    Print #FileNo, Left(Hinban, 14)
    
    
    If IRI_QTY = 0 Then
    Else
        Print #FileNo, "FONT TP=7,CS=0,LG=60,WD=45,LS=0"
        Print #FileNo, "TEXT X=150,Y=230,L=1"
        Print #FileNo, Format(IRI_QTY, "0") & "個"
    End If
    
    
    Print #FileNo, "QTY P=1"
    Print #FileNo, "END"


    
    Print #FileNo, "JOBE"
    

    Close #FileNo

    FileName = EF_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"


    Label_Print_File_Make_Proc = False


End Function


Public Function Label_Print_CNT_File_Make_Proc(FileName As String, Hinban As String, QTY As Long) As Integer
'-------------------------------------------------------
'
'   『品番ﾗﾍﾞﾙ用データファイル作成』
'       2011.03.05
'
'-------------------------------------------------------
Dim sts         As Integer


Dim FileNo      As Long

Dim FullPath    As String

Dim wkHinban    As String * 14
Dim wklen       As Long
Dim wkmod       As Long

    
    
    Label_Print_CNT_File_Make_Proc = True
    
    If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
        FullPath = F1100101.CtrsWsk1.SendFolder & "\" & FileName & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    Else
        FullPath = F1100101.CtrsWsk1.SendFolder & FileName & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"
    End If




    On Error Resume Next
    Kill (FullPath)             '送信用ファイル削除
    On Error GoTo 0
        
    FileNo = FreeFile           '送信用ファイルＯＰＥＮ
    Open FullPath For Output As #FileNo







    Print #FileNo, "#"
    Print #FileNo, "JOB"
    
    
'------------------------------------------------------------------ ラベルプリンター印字濃度    2016.02.15
'    Print #FileNo, "DEF MK=1,DK=8,MD=3,PW=384,PH=344,XO=8,UM=24,BM=0,AF=1"
    Print #FileNo, "DEF MK=1,DK=" & Format(DK_DEF, "0") & ",MD=3,PW=384,PH=344,XO=8,UM=24,BM=0,AF=1"
'------------------------------------------------------------------ ラベルプリンター印字濃度    2016.02.15




    Print #FileNo, "START"
    
    Print #FileNo, "FONT TP=7,CS=0,LG=80,WD=45,LS=0"
    Print #FileNo, "TEXT X=15,Y=30,L=1"
    
    
    
    
    wkHinban = Trim(Hinban)
    If Len(Trim(wkHinban)) < 14 Then
        wklen = 14 - Len(Trim(wkHinban))
        
        
        wklen = ToRoundDown(CCur(wklen / 2), 0)
        If wklen < 1 Then
        Else
            wkHinban = Space(wklen) & Trim(wkHinban)
        End If
    End If
    
'    Print #FileNo, Left(Trim(Hinban), 14)
    Print #FileNo, wkHinban

    
    Print #FileNo, "BCD TP=7,X=40,Y=120,DR=0,NW=1,RA=,HT=100,HR=0,MG=0,NS=0,NE=0,NZ=0"
    Print #FileNo, Left(Hinban, 14)
    
    
    
    
    Print #FileNo, "QTY P=" & Format(QTY, "#0")
    Print #FileNo, "END"


    
    Print #FileNo, "JOBE"
    

    Close #FileNo

    FileName = EI_SendFile & Format(ID_KANRI_TBL(ING_No).ID, "000") & ".txt"


    Label_Print_CNT_File_Make_Proc = False


End Function




Public Sub Syuka_Kenpin_Count_Proc(Sumi_CNT As Integer, _
                                    Y_SYU_CNT As Integer, _
                                    KONPOU_ON As Integer, _
                                    KONPOU_OFF As Integer, _
                                    KONPOU_ON_SUMI As Integer, _
                                    KONPOU_OFF_SUMI As Integer)
'-------------------------------------------------------
'
'   『検品関係実数のカウント』
'       2010.01.21
'-------------------------------------------------------
                        
Dim FAST_F  As Boolean
                        
Dim i       As Integer
Dim j       As Integer
                                                
Dim k       As Integer
                        
                        
                        
    Sumi_CNT = 0
    Y_SYU_CNT = 0
                                                            
                                                            
                                                            
    KONPOU_ON = 0
    KONPOU_OFF = 0
                                                            
                                                            
                                                            

    KONPOU_OFF_SUMI = 0
    KONPOU_ON_SUMI = 0

''' 品番単位での丸め処理
    FAST_F = True
                                                                                
    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
    
    
        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
        Else
            If FAST_F Then
            
                Y_SYU_CNT = Y_SYU_CNT + 1
                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                    Sumi_CNT = Sumi_CNT + 1
                End If
                
                
                
                If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
                    KONPOU_OFF = KONPOU_OFF + 1
                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                        KONPOU_OFF_SUMI = KONPOU_OFF_SUMI + 1
                    End If
                
                
                Else
                    KONPOU_ON = KONPOU_ON + 1
                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                        KONPOU_ON_SUMI = KONPOU_ON_SUMI + 1
                    End If
                
                
                
                End If
                
                
                FAST_F = False
            
                                            
            
            
            
            Else
                For k = 0 To j - 1
                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                            Exit For
                        End If
                    End If
                Next k
        
                If k > j - 1 Then
        
                    Y_SYU_CNT = Y_SYU_CNT + 1
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                        Sumi_CNT = Sumi_CNT + 1
                    End If
                
                
                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
                        KONPOU_OFF = KONPOU_OFF + 1
                    
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            KONPOU_OFF_SUMI = KONPOU_OFF_SUMI + 1
                        End If
                    
                    
                    Else
                        KONPOU_ON = KONPOU_ON + 1
                    
                        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
                            KONPOU_ON_SUMI = KONPOU_ON_SUMI + 1
                        End If
                    
                    
                    
                    End If
                
                
                
                
                End If
            End If
        End If
    Next j

End Sub

Public Sub Syuka_KUTI_SU_Count_Proc(TOTAL_KUTI_SU As Integer)
'-------------------------------------------------------
'
'   『口数合計のカウント』
'       2010.01.21
'-------------------------------------------------------
                        
Dim FAST_F  As Boolean
                        
Dim i       As Integer
Dim j       As Integer
                                                
Dim k       As Integer
                        
                        
    TOTAL_KUTI_SU = 0
''' 品番単位での丸め処理
    FAST_F = True
                                                                                
    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
    
    
        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
        
        
            If FAST_F Then
            
                TOTAL_KUTI_SU = TOTAL_KUTI_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU
                    
                FAST_F = False
            
            Else
                For k = 0 To j - 1
                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
                            Exit For
                        End If
                    End If
                Next k
        
                If k > j - 1 Then
        
                    TOTAL_KUTI_SU = TOTAL_KUTI_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KUTI_SU
                
                End If
            End If
        End If
    Next j

End Sub




Public Function Syuka_END_Count_Proc() As Double
'-------------------------------------------------------
'
'   『才数合計のカウント』
'       2010.01.21
'-------------------------------------------------------
                        
Dim FAST_F  As Boolean
                        
Dim i       As Integer
Dim j       As Integer
                                                
Dim k       As Integer
                        
                        
    Syuka_END_Count_Proc = 0
''' 品番単位での丸め処理
    FAST_F = True
                                                                                
    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
    
    
    
        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F = "1" Then
    
            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
            
                Syuka_END_Count_Proc = Syuka_END_Count_Proc + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU
            End If
        End If
    Next j


    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
    
    
    
        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
    
            If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
            
                Syuka_END_Count_Proc = Syuka_END_Count_Proc + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SAI_SU
            
                Exit For
            End If
        End If
    Next j


End Function



Public Function Label_Print_Total_Su_Proc(KUTI_SU As Long, PRINT_TOTAL_SU As Long) As Integer
'-------------------------------------------------------
'
'   『検品処理時のラベル印刷枚数獲得』
'       2010.01.21
'-------------------------------------------------------
Dim sts     As Integer

Dim FAST_F  As Boolean
                        
Dim i       As Integer
Dim j       As Integer
                                                
Dim k       As Integer

Dim wkKONPOU_F      As String * 1       '2015.10.21

Dim OKURISAKI_CD_F  As Boolean          '2015.12.22
Dim m               As Integer          '2015.12.22


    Label_Print_Total_Su_Proc = True
    
    
    
    
    
    PRINT_TOTAL_SU = KUTI_SU
    
    FAST_F = True
                                                                                
    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
    
    
        If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F Then
        Else
            If FAST_F Then
            
                Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO)
                
                
                sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        
                        If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                        End If
                        
                        
                    
                    
                    Case BtErrKeyNotFound
                    
                        Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                    
                    
                    Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        Exit Function
                End Select
                
                
                wkKONPOU_F = StrConv(ITEMREC.KONPOU_F, vbUnicode)       '2015.10.21
                
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2015.10.21　特定品番時、集合梱包で行えるようにする
                
                '送り先CDをテーブル参照へ    2015.12.22
                OKURISAKI_CD_F = False
                For m = 0 To UBound(KONPOU_OKURISAKI_CD)
                            
'                    If Trim(KONPOU_OKURISAKI_CD(m)) = Trim(StrConv(Y_SYU_HREC.OKURISAKI_CD, vbUnicode)) Then       '2016.02.09
                    If Trim(KONPOU_OKURISAKI_CD(m)) = Trim(ID_KANRI_TBL(ING_No).KEN_OKURISAKI_CD) Then              '2016.02.09
                        OKURISAKI_CD_F = True
                        Exit For
                    End If
                Next m
                '送り先CDをテーブル参照へ    2015.12.22
                
                
'                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURISAKI_CD) = "E83000ZZZ" Then          '2015.12.22
                If OKURISAKI_CD_F Then                                                      '2015.12.22
                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = "AD-HEJJ3N-C" _
                    Or Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = "AD-HEJJ4N-C" _
                    Or Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = "AD-HEH43N-C" _
                    Or Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = "AD-HEH44N-C" _
                    Or Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = "AD-HEJP4N-C" Then  '2019/10/30 集合梱包AD-HEJP4N-Cを追加
                        wkKONPOU_F = ""
                    End If
                End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2015.10.21　特定品番時、集合梱包で行えるようにする
                
                
                
'                If StrConv(ITEMREC.KONPOU_F, vbUnicode) = "1" Then     '2015.10.21
                If wkKONPOU_F = "1" Then                                '2015.10.21
                
                
                    PRINT_TOTAL_SU = PRINT_TOTAL_SU + (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO * CLng(StrConv(ITEMREC.KUTI_SU, vbUnicode)))
                
                
                End If
                
                FAST_F = False
            
                                            
            
            
            
            Else
'                For k = 0 To j - 1
'                    If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) Then
'                        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CANCEL_F Then
'                            Exit For
'                        End If
'                    End If
'                Next k
        
'                If k > j - 1 Then
        
                
                    Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                    Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
                    Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO)
                    
                    
                    sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                    Select Case sts
                        Case BtNoErr
                            
                            If Not IsNumeric(StrConv(ITEMREC.KUTI_SU, vbUnicode)) Then
                                Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                            End If
                            
                            
                        
                        
                        Case BtErrKeyNotFound
                        
                            Call UniCode_Conv(ITEMREC.KUTI_SU, "0001")
                        
                        
                        Case Else
                            Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                            Exit Function
                    End Select
                    
                    wkKONPOU_F = StrConv(ITEMREC.KONPOU_F, vbUnicode)       '2015.10.21
                    
    '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2015.10.21　特定品番時、集合梱包で行えるようにする
                    
                    
                    '送り先CDをテーブル参照へ    2015.12.22
                    OKURISAKI_CD_F = False
                    For m = 0 To UBound(KONPOU_OKURISAKI_CD)
                                
'                        If Trim(KONPOU_OKURISAKI_CD(m)) = Trim(StrConv(Y_SYU_HREC.OKURISAKI_CD, vbUnicode)) Then   '2016.02.09
                        If Trim(KONPOU_OKURISAKI_CD(m)) = Trim(ID_KANRI_TBL(ING_No).KEN_OKURISAKI_CD) Then          '2016.02.09
                            OKURISAKI_CD_F = True
                            Exit For
                        End If
                    Next m
                    '送り先CDをテーブル参照へ    2015.12.22
                    
                    
                    
                    
'                    If Trim(ID_KANRI_TBL(ING_No).KEN_OKURISAKI_CD) = "E83000ZZZ" Then      '2015.12.22
                    If OKURISAKI_CD_F Then                                                  '2015.12.22
                        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = "AD-HEJJ3N-C" _
                        Or Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = "AD-HEJJ4N-C" _
                        Or Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = "AD-HEH43N-C" _
                        Or Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = "AD-HEH44N-C" _
                        Or Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = "AD-HEJP4N-C" Then '2019/10/30 集合梱包AD-HEJP4N-Cを追加
                            wkKONPOU_F = ""
                        End If
                    End If
    '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2015.10.21　特定品番時、集合梱包で行えるようにする
                    
                    
                    

'                    If StrConv(ITEMREC.KONPOU_F, vbUnicode) = "1" Then     '2015.10.21
                    If wkKONPOU_F = "1" Then                                '2015.10.21
                    
                    
                        PRINT_TOTAL_SU = PRINT_TOTAL_SU + (ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SURYO * CLng(StrConv(ITEMREC.KUTI_SU, vbUnicode)))
                    
                    
                    End If
                
                
                
'                End If
            End If
        End If
    Next j
    
    
    
    
    
    
    
    
    
    
    Label_Print_Total_Su_Proc = False
        

End Function

Public Function OKURI_NO_SEQ_Update_Proc(j As Integer, OKURI_NO_SEQ As String, Sendbuf As String, _
                                            Optional OKURI_NO_SEQ_TO As String = "   ") As Integer
'-------------------------------------------------------
'
'   『検品処理時の出荷予定　送り状ｎ}番更新』
'       2010.01.21
'-------------------------------------------------------
    
Dim sts As Integer
    
    OKURI_NO_SEQ_Update_Proc = True
    
    
    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ <> 0 Then
        OKURI_NO_SEQ_Update_Proc = False
        Exit Function
    End If
    
                                            
    ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).OKURI_NO_SEQ = CInt(OKURI_NO_SEQ)
    
    If Trim(OKURI_NO_SEQ_TO) = "" Then
        OKURI_NO_SEQ_TO = OKURI_NO_SEQ
    End If
    
    '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理

    Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)    'ID

    Do

        sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrKeyNotFound
'2017.09.22
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定不明", "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                OKURI_NO_SEQ_Update_Proc = False
                Exit Function
            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                OKURI_NO_SEQ_Update_Proc = False
                Exit Function
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Exit Function
        End Select

    Loop
    
        
    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ, OKURI_NO_SEQ)
    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ_TO, OKURI_NO_SEQ_TO)
            
    Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
    Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
            
            
            '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
    Do
        sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                OKURI_NO_SEQ_Update_Proc = False
                Exit Function
        
            Case Else
                Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                OKURI_NO_SEQ_Update_Proc = SYS_ERR
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                
                Exit Function
        End Select
    Loop

    OKURI_NO_SEQ_Update_Proc = False


End Function



Public Function KutiSai_Update_Proc(KUTI_SU As Integer, SAI_SU As Double) As Integer
                        
                        
Dim sts         As Integer

Dim j           As Integer

Dim wkSAI_SU    As Integer
                        
    KutiSai_Update_Proc = True
    '----------------------------------- データ更新処理開始 -----------
                                    'トランザクション開始
    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Exit Function
    End If
                                            
    For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
                        
        '------------------------------------   出荷予定の処理
        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                            'ID
        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)
    
        
        sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
        Select Case sts
            Case BtNoErr
            
            Case BtErrKeyNotFound
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                KutiSai_Update_Proc = False
                GoTo Abort_Tran
             Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                KutiSai_Update_Proc = False
                GoTo Abort_Tran
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                GoTo Abort_Tran
        End Select

        '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理
                    
        'ID_NO
        If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番

            Do
    
                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrKeyNotFound
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        GoTo Abort_Tran
                End Select

            Loop
                                            
                                
            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F <> "1" Then
            
                If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                    If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                    Else
                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                    End If
                Else
                    
                    
                    Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "00.00"))
                                                        
                End If
                Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                                
            Else
                            
                If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
                    
                    'Call UniCode_Conv(Y_SYU_HREC.KONPOU_F, ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KONPOU_F)
                    If IsNumeric(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) Then
                        If CInt(StrConv(Y_SYU_HREC.KUTI_SU_TAN, vbUnicode)) > 0 Then
                        Else
                            Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                        End If
                    Else
                        Call UniCode_Conv(Y_SYU_HREC.KUTI_SU_TAN, Format(KUTI_SU, "0000"))
                                                            
                    End If
                End If
                Call UniCode_Conv(Y_SYU_HREC.SAI_SU_TAN, Format(SAI_SU, "00.00"))
                            
            End If
                                                    
            Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
            Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                
                                '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
            Do
                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                        GoTo Abort_Tran
                End Select
            Loop
        End If
                    

    Next j

        
     For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)

     '------------------------------------   出荷予定(ﾎｽﾄｲﾒｰｼﾞ)の処理

         'ID_NO
         If Not ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CANCEL_F And ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SUMI Then
             
             Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                 'ID
             Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO) & ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).SEQ_NO)

             Do
             
                 sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                 Select Case sts
                     Case BtNoErr
                         Exit Do
                     Case BtErrKeyNotFound
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                      Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                     Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                        GoTo Abort_Tran
                 End Select
         
             Loop
             
             
             
             Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番

             Do
     
                 sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                 Select Case sts
                     Case BtNoErr
                         Exit Do
                     Case BtErrKeyNotFound
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                     Case Else
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                        GoTo Abort_Tran
                 End Select
 
             Loop
                             
                             
            If SAI_SU < 1 Then
                wkSAI_SU = 1
            Else
                If SAI_SU > 1 Then
                    wkSAI_SU = CLng(ToHalfAdjust(CCur(SAI_SU), 0))
                End If
            End If
                             
                             
                             
             Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
             Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(wkSAI_SU, "00.00"))
                                 
                                 
            Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
            Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                 
                                 
                                 '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
             Do
                 sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                 Select Case sts
                     Case BtNoErr
                         Exit Do
                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        KutiSai_Update_Proc = False
                        GoTo Abort_Tran
                     Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                        GoTo Abort_Tran
                 End Select
             Loop
         End If
                     

     Next j
             
                         'トランザクション終了
     sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
     If sts <> BtNoErr Then
         Call File_Error(sts, BtOpEndTransaction, "", 0)
         GoTo Abort_Tran
     End If

    KutiSai_Update_Proc = False

    Exit Function





Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If







End Function



Public Function OKURI_NO_CHECK_PROC(OKURI_NO As String, OKURI_NO_F As Boolean, FUKUYAMA_CHK_F As Boolean) As Integer
    
Dim k   As Integer
    
    OKURI_NO_F = False
    FUKUYAMA_CHK_F = False
    
    
    If Len(Trim(OKURI_NO)) = FUKUYAMA_Length Then
        
        If FUKUYAMA_CODE(0) = "*" Then
            OKURI_NO_F = True
    
    
        Else
            For k = 0 To UBound(FUKUYAMA_CODE)
            
                If Mid(OKURI_NO, 1, Len(FUKUYAMA_CODE(k))) = FUKUYAMA_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k

    
        End If
    
    
    
        '2010.04.28 福山チェック追加
        If Not IsNumeric(Left(OKURI_NO, FUKUYAMA_Length - 1)) Then
            FUKUYAMA_CHK_F = True
        Else
            If Left(OKURI_NO, FUKUYAMA_Length - 1) - (ToRoundDown(CCur(Left(OKURI_NO, FUKUYAMA_Length - 1) / 7), 0) * 7) <> Val(Right(OKURI_NO, 1)) Then
                FUKUYAMA_CHK_F = True
            End If
        End If
        '2010.04.28
    
    
    
    
    End If

    If Len(Trim(OKURI_NO)) = SEIBU_Length Then
        If SEIBU_CODE(0) = "*" Then
            OKURI_NO_F = True
    
    
        Else
            For k = 0 To UBound(SEIBU_CODE)
            
                If Mid(OKURI_NO, 1, Len(SEIBU_CODE(k))) = SEIBU_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k

    
        End If
    End If

    If Len(Trim(OKURI_NO)) = KURUME_Length Then
    
        If KURUME_CODE(0) = "*" Then
            OKURI_NO_F = True
        Else
            For k = 0 To UBound(KURUME_CODE)
            
                If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k
        End If
    
    End If

    If Len(Trim(OKURI_NO)) = SAGAWA_Length Then
    
        If SAGAWA_CODE(0) = "*" Then
            OKURI_NO_F = True
        Else
            For k = 0 To UBound(SAGAWA_CODE)
            
                If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k
        End If
    
    End If
    
    If Len(Trim(OKURI_NO)) = YAMATO_Length Then
    
        If YAMATO_CODE(0) = "*" Then
            OKURI_NO_F = True
        Else
            For k = 0 To UBound(YAMATO_CODE)
            
                If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k
        End If
    
    End If




    'ﾊﾟﾅﾎｰﾑ 2011.06.06
    If Len(Trim(OKURI_NO)) = PANA_Length Then
    
        If PANA_CODE(0) = "*" Then
            OKURI_NO_F = True
        Else
            For k = 0 To UBound(PANA_CODE)
            
                If Mid(OKURI_NO, 1, Len(PANA_CODE(k))) = PANA_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k
        End If
    
    End If
    '積水 2011.06.06
    If Len(Trim(OKURI_NO)) = SEKISUI_Length Then
    
        If SEKISUI_CODE(0) = "*" Then
            OKURI_NO_F = True
        Else
            For k = 0 To UBound(SEKISUI_CODE)
            
                If Mid(OKURI_NO, 1, Len(SEKISUI_CODE(k))) = SEKISUI_CODE(k) Then
                    OKURI_NO_F = True
                End If
            Next k
        End If
    
    End If


End Function

Public Sub OKURI_NO_SET_PROC(OKURI_NO As String)
    
Dim k   As Integer
    
Dim wk_out  As String       '2016.09.16
                        
    
    
    
        
    
    If F110010_LOG <> "" Then                                                                                                               '2016.09.16
        wk_out = "ID_NO= " & ID_KANRI_TBL(ING_No).ID_NO & "(" & StrConv(Y_SYU_HREC.ID_NO, vbUnicode) & ") & OKURI_NO= " & OKURI_NO & " "    '2016.09.16
    End If                                                                                                                                  '2016.09.16
    
'<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<   送り先集約CD 2015.04.27
    For k = 0 To UBound(COL_OKURISAKI_CD)
        If Trim(StrConv(Y_SYU_HREC.COL_OKURISAKI_CD, vbUnicode)) = Trim(COL_OKURISAKI_CD(k)) Then
            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, COL_OKURISAKI_NAME(k))
            
            If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                wk_out = wk_out & "COL_OKURISAKI_CD= " & Trim(StrConv(Y_SYU_HREC.COL_OKURISAKI_CD, vbUnicode)) & COL_OKURISAKI_NAME(k) & " OK"  '2016.09.16
                Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
            End If                                                                                                                              '2016.09.16
            
            Exit Sub
        End If
    Next k
    
'<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<   送り先CD 2015.04.27
    For k = 0 To UBound(OKURISAKI_CD)
        If Trim(StrConv(Y_SYU_HREC.OKURISAKI_CD, vbUnicode)) = Trim(OKURISAKI_CD(k)) Then
            Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, OKURISAKI_NAME(k))
            
            If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                wk_out = wk_out & "OKURISAKI_CD= " & Trim(StrConv(Y_SYU_HREC.OKURISAKI_CD, vbUnicode)) & OKURISAKI_NAME(k) & " OK"              '2016.09.16
                Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
            End If                                                                                                                              '2016.09.16
            
            
            Exit Sub
        End If
    Next k
    
    
    
    
    
    If Len(Trim(OKURI_NO)) = FUKUYAMA_Length Then
        
        If Trim(FUKUYAMA_Name) <> "" Then         '2018.11.29
        
            If FUKUYAMA_CODE(0) = "*" Then
                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
        
                If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                    wk_out = wk_out & FUKUYAMA_Name & " OK"                                                                       '2016.09.16
                    Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                End If                                                                                                                              '2016.09.16
        
        
            Else
                For k = 0 To UBound(FUKUYAMA_CODE)
                
                    If Mid(OKURI_NO, 1, Len(FUKUYAMA_CODE(k))) = FUKUYAMA_CODE(k) Then
                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, FUKUYAMA_Name)
                    
                    
                        If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                            wk_out = wk_out & FUKUYAMA_Name & " OK"                                                                       '2016.09.16
                            Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                        End If                                                                                                                              '2016.09.16
                    
                    End If
                
                
                
                Next k
    
        
            End If
    
        End If                              '2018.11.29
    End If

    If Len(Trim(OKURI_NO)) = SEIBU_Length Then
        
        If Trim(SEIBU_Name) <> "" Then       '2018.11.29
        
            If SEIBU_CODE(0) = "*" Then
                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
        
                If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                    wk_out = wk_out & SEIBU_Name & " OK"                                                                          '2016.09.16
                    Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                End If                                                                                                                              '2016.09.16
        
            Else
                For k = 0 To UBound(SEIBU_CODE)
                
                    If Mid(OKURI_NO, 1, Len(SEIBU_CODE(k))) = SEIBU_CODE(k) Then
                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEIBU_Name)
                    
                    
                        If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                            wk_out = wk_out & SEIBU_Name & " OK"                                                                          '2016.09.16
                            Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                        End If                                                                                                                              '2016.09.16
                    
                    End If
                
                
                
                
                Next k
    
        
            End If
        End If                          '2018.11.29
    End If

    If Len(Trim(OKURI_NO)) = KURUME_Length Then
    
    
        If Trim(KURUME_Name) <> "" Then '2018.11.29
    
            If KURUME_CODE(0) = "*" Then
                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
                If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                    wk_out = wk_out & KURUME_Name & " OK"                                                                         '2016.09.16
                    Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                End If                                                                                                                              '2016.09.16
            Else
                For k = 0 To UBound(KURUME_CODE)
                
                    If Mid(OKURI_NO, 1, Len(KURUME_CODE(k))) = KURUME_CODE(k) Then
                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KURUME_Name)
                    
                        If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                            wk_out = wk_out & KURUME_Name & " OK"                                                                         '2016.09.16
                            Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                        End If                                                                                                                              '2016.09.16
                    
                    
                    End If
                Next k
            End If
    
        End If                      '2018.11.29
    
    End If

    If Len(Trim(OKURI_NO)) = SAGAWA_Length Then
    
        If Trim(SAGAWA_Name) <> "" Then     '2018.11.29
    
    
            If SAGAWA_CODE(0) = "*" Then
                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
                If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                    wk_out = wk_out & SAGAWA_Name & " OK"                                                                         '2016.09.16
                    Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                End If                                                                                                                              '2016.09.16
            Else
                For k = 0 To UBound(SAGAWA_CODE)
                
                    If Mid(OKURI_NO, 1, Len(SAGAWA_CODE(k))) = SAGAWA_CODE(k) Then
                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SAGAWA_Name)
                        If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                            wk_out = wk_out & SAGAWA_Name & " OK"                                                                         '2016.09.16
                            Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                        End If                                                                                                                              '2016.09.16
                    End If
                Next k
            End If
    
        End If                              '2018.11.29
    
    End If
    
    If Len(Trim(OKURI_NO)) = YAMATO_Length Then
    
        
        If Trim(YAMATO_Name) <> "" Then     '2018.11.29
        
            If YAMATO_CODE(0) = "*" Then
                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
                If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                    wk_out = wk_out & YAMATO_Name & " OK"                                                                         '2016.09.16
                    Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                End If                                                                                                                              '2016.09.16
            Else
                For k = 0 To UBound(YAMATO_CODE)
                
                    If Mid(OKURI_NO, 1, Len(YAMATO_CODE(k))) = YAMATO_CODE(k) Then
                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, YAMATO_Name)
                        If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                            wk_out = wk_out & YAMATO_Name & " OK"                                                                         '2016.09.16
                            Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                        End If                                                                                                                              '2016.09.16
                    End If
                Next k
            End If
    
        End If                              '2018.11.29
    
    End If
    
    
    
    
    
    'ﾊﾟﾅﾎｰﾑ 2011.06.06
    If Len(Trim(OKURI_NO)) = PANA_Length Then
    
        If Trim(PANA_Name) <> "" Then       '2018.11.29
    
            If PANA_CODE(0) = "*" Then
                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, PANA_Name)
            
                If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                    wk_out = wk_out & PANA_Name & " OK"                                                                           '2016.09.16
                    Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                End If                                                                                                                              '2016.09.16
            
            
            Else
                For k = 0 To UBound(PANA_CODE)
                
                    If Mid(OKURI_NO, 1, Len(PANA_CODE(k))) = PANA_CODE(k) Then
                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, PANA_Name)
                    
                    
                        If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                            wk_out = wk_out & PANA_Name & " OK"                                                                           '2016.09.16
                            Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                        End If                                                                                                                              '2016.09.16
                    
                    
                    End If
                Next k
            End If
    
        End If                              '2018.11.29
    End If
    
    '積水 2011.06.06
    If Len(Trim(OKURI_NO)) = SEKISUI_Length Then
    
        If Trim(SEKISUI_Name) <> "" Then    '2018.11.29
    
            If SEKISUI_CODE(0) = "*" Then
                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEKISUI_Name)
                If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                    wk_out = wk_out & SEKISUI_Name & " OK"                                                                           '2016.09.16
                    Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                End If                                                                                                                              '2016.09.16
            Else
                For k = 0 To UBound(SEKISUI_CODE)
                
                    If Mid(OKURI_NO, 1, Len(PANA_CODE(k))) = SEKISUI_CODE(k) Then
                        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, SEKISUI_Name)
                    
                        If F110010_LOG <> "" Then                                                                                                           '2016.09.16
                            wk_out = wk_out & SEKISUI_Name & " OK"                                                                           '2016.09.16
                            Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
                        End If                                                                                                                              '2016.09.16
                    
                    
                    End If
                Next k
            End If
    
        End If                              '2018.11.29
    End If
    
    
    
    
    
    '物流 2010.02.19
    If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "物流")
        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KEN_CHARTER_NM)
    
        If F110010_LOG <> "" Then                                                                                                           '2016.09.16
            wk_out = wk_out & KEN_CHARTER_NM & " OK"                                                                           '2016.09.16
            Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
        End If                                                                                                                              '2016.09.16
    
    End If
    
    '赤帽 2010.02.19
    If Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Then
'                                    Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "赤帽")
        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, KEN_AKABOU_NM)
    
        If F110010_LOG <> "" Then                                                                                                           '2016.09.16
            wk_out = wk_out & KEN_AKABOU_NM & " OK"                                                                           '2016.09.16
            Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
        End If                                                                                                                              '2016.09.16
    
    
    End If
    
    'ロジステック 2010.02.19
    If Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
        Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "ロジステック")
    
    
        If F110010_LOG <> "" Then                                                                                                           '2016.09.16
            wk_out = wk_out & "ロジステック" & " OK"                                                                           '2016.09.16
            Call LOG_OUT(F110010_LOG, wk_out)                                                                                               '2016.09.16
        End If                                                                                                                              '2016.09.16
    
    End If

End Sub










Public Function LABEL_Print_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『ラベル発行処理』
'
'   2011.03.05
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim Hinban      As String * 20


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim DATA_CNT    As Integer

Dim MENU_NO     As String * 2   '2008.08.08

Dim FileName    As String

Dim IRI_QTY     As Long

    LABEL_Print_Proc = True


    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）



            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                            
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                LABEL_Print_Proc = False
                                Exit Function
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        
                        End Select
                                            
                                            
                
                        Call UniCode_Conv(K8_Y_SYU.JGYOBU, StrConv(ITEMREC.JGYOBU, vbUnicode))
                        Call UniCode_Conv(K8_Y_SYU.NAIGAI, StrConv(ITEMREC.NAIGAI, vbUnicode))
                        Call UniCode_Conv(K8_Y_SYU.KEY_HIN_NO, StrConv(ITEMREC.HIN_GAI, vbUnicode))
                        Call UniCode_Conv(K8_Y_SYU.KAN_YMD, "99999999")
                        Call UniCode_Conv(K8_Y_SYU.KAN_HMS, "999999")
                
                
                        IRI_QTY = 0
                
                
                        com = BtOpGetLessEqual
                
                        Do
                            
                            
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                            
                            
                            sts = BTRV(com, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K8_Y_SYU, Len(K8_Y_SYU), 8)
                            Select Case sts
                                Case BtNoErr
                                    
                                                    
                                    If StrConv(Y_SYUREC.JGYOBU, vbUnicode) <> StrConv(ITEMREC.JGYOBU, vbUnicode) Or _
                                       StrConv(Y_SYUREC.NAIGAI, vbUnicode) <> StrConv(ITEMREC.NAIGAI, vbUnicode) Or _
                                        StrConv(Y_SYUREC.HIN_NO, vbUnicode) <> StrConv(ITEMREC.HIN_GAI, vbUnicode) Then
                                    
                                    
                                        Exit Do
                                    
                                    
                                    End If
        
                                    
                                    If StrConv(Y_SYUREC.KAN_KBN, vbUnicode) = KAN_KBN_FIN Then
                                    
                                        IRI_QTY = Val(StrConv(Y_SYUREC.SURYO, vbUnicode))
                                    
                                    
                                        Exit Do
                                    
                                    End If
                                    
                                    
                        
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "出荷予定", 0)
                                    Exit Function
                            End Select
                        
                        
                            com = BtOpGetPrev
                        
                        Loop
        
                        FileName = EF_SendFile
        
                        If Label_Print_File_Make_Proc(FileName, Hinban, IRI_QTY) Then
                        End If
                                
                                
                                    
                        'データ送信
                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                    
                                                    
                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                    
                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                    
                        
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU              '2016.12.07
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI              '2016.12.07

                        ID_KANRI_TBL(ING_No).Hinban = Hinban                    '2016.12.07
                        ID_KANRI_TBL(ING_No).SURYO = IRI_QTY                    '2016.12.07
                    
                    
                    
                    
                    
                    
                        '-----------------------------------------------ヘッダー
                    
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                        Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL
                    
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                        Send_Text.FileName = FileName                           '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = FileName
                    
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                    
                        Sendbuf = Text_Create_Proc()
                        Exit For
                    
                    
                End Select
            Next i
        Case Step_PRINT_RES         '２回目の受信（印刷終了）
    
                '作業ﾛｸﾞ出力    2008.08.08
                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                    MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                            
                Else
                            
                    MENU_NO = ""
                End If
                If Trim(MENU_NO) = "" Then
                Else
                '作業ﾛｸﾞ出力
                    
'>>>>>>>>>>>>>>     2016.12.07
'                    If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
'                                                        RET_JGYOBU, _
'                                                        RET_NAIGAI, _
'                                                        MENU_NO, _
'                                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
'                                                        Hinban) Then
                    If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                        ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                        ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                        MENU_NO, _
                                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                        ID_KANRI_TBL(ING_No).Hinban, _
                                                        , _
                                                        ID_KANRI_TBL(ING_No).SURYO) Then
'>>>>>>>>>>>>>>     2016.12.07
                        
                        
                        
                        
                        
                        
                        LABEL_Print_Proc = SYS_ERR
                        Exit Function
                    End If
                End If
        
        
                                                    '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                    Case BtNoErr
                    '   -------------------------------- エラーメッセージ作成
                    Case Else
                    '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                If Sagyo_Send_Proc() Then
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                End If
                        
                Sendbuf = Text_Create_Proc()
            
            
            
            
    End Select

    
    
    
    
    LABEL_Print_Proc = False
    

End Function



Public Function LABEL_Print_Cnt_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『ラベル発行処理(枚数指定)』
'
'   2015.10.06
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim Hinban      As String * 20


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1



Dim FileNo      As Integer

Dim FullPath    As String

Dim SendFileRec As SendFileRec_Tag

Dim DATA_CNT    As Integer

Dim MENU_NO     As String * 2   '2008.08.08

Dim FileName    As String

Dim QTY         As Long

    LABEL_Print_Cnt_Proc = True


    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）



            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                                            
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                LABEL_Print_Cnt_Proc = False
                                Exit Function
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        
                        End Select
                                            
                                            
                    Case LCD_Suryo          '数量(枚数)
                                            
                                            
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力異常", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_Print_Cnt_Proc = False
                            Exit Function
                        End If
                        
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力異常", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            LABEL_Print_Cnt_Proc = False
                            Exit Function
                        End If
                                            
                                            
        
                        FileName = EI_SendFile
        
                        If Label_Print_CNT_File_Make_Proc(FileName, Hinban, QTY) Then
                        End If
                                
                                
                                    
                        'データ送信
                        ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                    
                                                    
                        ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                    
                        ID_KANRI_TBL(ING_No).LABEL_ON = True
                    
                        ID_KANRI_TBL(ING_No).Hinban = Hinban                        '2017.04.10
                        ID_KANRI_TBL(ING_No).SURYO = QTY                            '2017.04.10
                    
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU                  '2017.04.10
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI                  '2017.04.10
                                
                    
                    
                        '-----------------------------------------------ヘッダー
                    
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                        Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL
                    
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                        Send_Text.FileName = FileName                           '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = FileName
                    
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                    
                        Sendbuf = Text_Create_Proc()
                        Exit For
                    
                    
                End Select
            Next i
        Case Step_PRINT_RES         '２回目の受信（印刷終了）
    
                '作業ﾛｸﾞ出力    2008.08.08
                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                    MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                            
                Else
                            
                    MENU_NO = ""
                End If
                If Trim(MENU_NO) = "" Then
                Else
                '作業ﾛｸﾞ出力
                    
                    '>>>>>>>>>>>>>> 2107.04.10 品番・数量を追加
                    'If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                    '                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                    '                                    RET_JGYOBU, _
                    '                                    RET_NAIGAI, _
                    '                                    MENU_NO, _
                    '                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                    '                                    Hinban) Then
                    '    LABEL_Print_Cnt_Proc = SYS_ERR
                    '    Exit Function
                    'End If
                
                
                
                    If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                        ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                        ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                        MENU_NO, _
                                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                        ID_KANRI_TBL(ING_No).Hinban, _
                                                        , _
                                                        ID_KANRI_TBL(ING_No).SURYO) Then
                    End If
                    '>>>>>>>>>>>>>> 2107.04.10
                
                
                
                
                End If
        
        
                                                    '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                    Case BtNoErr
                    '   -------------------------------- エラーメッセージ作成
                    Case Else
                    '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
                End Select
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                If Sagyo_Send_Proc() Then
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                End If
                        
                Sendbuf = Text_Create_Proc()
            
            
            
            
    End Select

    
    
    
    
    LABEL_Print_Cnt_Proc = False
    

End Function






Public Function SEK_PACKING_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス　邸別梱包処理』
'
'   2011.04.25
'               2011.07.20 品番毎の集約を廃止
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim k           As Integer      '2011.06.27
Dim l           As Integer      '2011.06.27




Dim Hinban      As String * 20

Dim ID_NO       As String * 13
Dim Found_Flg   As Integer
Dim JUC_SUU     As Long
Dim HINB_CD_CNT As Long



Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1
    

Dim MENU_NO     As String * 2

Dim IN_WORD     As String * 30
Dim OUT_WORD    As String * 16


Dim SAI_SU      As Double

    SEK_PACKING_Proc = True





    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SEK_ID_NO      '指図ＩＤ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        sts = Y_SYUKA_TEI_Check_Proc(ID_NO, Found_Flg)
                        Select Case sts
                            Case BtNoErr          '正常
                
                                '------------------ 梱包済みのチェック
                                If Not Found_Flg Then
                                    
                                    
                                    
                                    
                                    
                                    If ID_KANRI_TBL(ING_No).SEK_SAI_SU = 0 Then
                                        
                                        
                                        ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_NO
                                        
                                        '才数入力
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                        
                                        '-----------------------------------------------ヘッダー
                                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                                
                                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                                
                                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                                
                                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                                
                                        Send_Text.FileName = ""                                 '送信データファイル名
                                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                                
                                        Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                                        
                                        '-----------------------------------------------１行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(0).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(0).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(0).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                        
                                        '-----------------------------------------------２行目
                                        IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                                        Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                                                
                                                                                                'BOX属性
                                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(1).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(1).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(1).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        
                                        '-----------------------------------------------３行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        
                                        '品番状態のカウント
                                        Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                                        
                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(2).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(2).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                                
                                        Send_Text.Box_Type(2).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        '-----------------------------------------------４行目
                                                                                                'BOX属性
                                                
                                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(3).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(3).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                                        Send_Text.Box_Type(3).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                
                                        '-----------------------------------------------５行目
                                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(4).Start_Pos = "12"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                                '入力桁数
                                        Send_Text.Box_Type(4).Max_Size = "05"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                        Sendbuf = Text_Create_Proc()
                                    
                                        SEK_PACKING_Proc = False
                                        Exit Function
                                    
                                    Else
'2017.09.22
                                    
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "全数梱包済みです", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_Proc = False
                                        Exit Function
                                
                                    End If
                                End If
                            Case BtErrEOF
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "注文ﾃﾞｰﾀなし", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_Proc = False
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_NO
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                        Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                        '品番状態のカウント
                        Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                        
                        
                        
                        
                        
                        
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（品番）
        
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban     '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_Proc = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        
                        
                        
                        
                        
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) Then
                                Exit For
                            End If
                        Next j
                        
                        
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_Proc = False
                            Exit Function
                        End If
                        
                        'Pipeセットのﾁｪｯｸ   2011.07.20
'                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                            SEK_PACKING_Proc = False
'                            Exit Function
'                        End If
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) And Not ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F Then
                                ID_KANRI_TBL(ING_No).SEK_LINE = j
                                Exit For
                            End If
                        Next j
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
'2017.09.22
                    
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_Proc = False
                            Exit Function
                        End If
                        'Pipeセットのﾁｪｯｸ   2011.07.20
                        '------------------------------------------------------------   2011.06.27
                        For k = 0 To UBound(ID_KANRI_TBL)
                            If k = ING_No Then
                            Else
                                If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = _
                                    ID_KANRI_TBL(k).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(k).Sagyo_Code.YOIN_CODE Then
                                                            
                                    If ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_KANRI_TBL(k).SEK_TEI_LABELID Then
                                        
                                        'Pipeセットのﾁｪｯｸ   2011.07.20
'                                        For l = 0 To UBound(ID_KANRI_TBL(k).SEK_TBL)
'
'                                            If Trim(Hinban) = Trim(ID_KANRI_TBL(k).SEK_TBL(l).SEK_HINB_CD) Then
'
'
'                                                If ID_KANRI_TBL(k).SEK_TBL(l).SEK_KONPO_F Then
'                                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
'                                                    Sendbuf = Text_Create_Proc()
'                                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                                    SEK_PACKING_Proc = False
'                                                    Exit Function
'                                                End If
'
'                                            End If
'                                        Next l
                                        
                                        If ID_KANRI_TBL(k).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_KONPO_F Then
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_PACKING_Proc = False
                                            Exit Function
                                        End If
                                        'Pipeセットのﾁｪｯｸ   2011.07.20
                                    End If
                                End If
                            End If
                        Next k
                        '------------------------------------------------------------   2011.06.27
''                        If Inspection_Flg = 0 Then
''                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
''                                If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).HIN_NO) Then
''                                    If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).KAN_KBN <> KAN_KBN_FIN Then
''                                        Exit For
''                                    End If
''                                End If
''                            Next j
''
''                            If j <= UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL) Then
''                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, Hinban, "未出庫分有り！！", "")
''                                Sendbuf = Text_Create_Proc()
''                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
''                                SEK_PACKING_Proc = False
''                                Exit Function
''                            End If
''                        End If
                        
                        ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F = True
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        
                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU = 1 Then
                            Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        Else
                            Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                        End If
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        '-----------------------------------------------３行目
                                                                                
                        IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                        Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                                
                                                                                
                                                                                
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_DATA_CNT = 1 Then

                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                                                                
                        Else
                        
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                        
                        
                        End If
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        
                
                End Select
            
            Next i
        
        
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
    
    
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                            
                        
            '------------------------------------   注文ﾃﾞｰﾀの処理
            
            com = BtOpGetGreaterEqual
            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
            
            Do
                
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
            
                Do
                
                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrEOF
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_Proc = False
                            GoTo Abort_Tran
                        Case Else
                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
            
                Loop
            
                
                If sts = BtErrEOF Then
                    Exit Do
                End If
                
                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                    Exit Do
                End If
                '2011.07.20 IF条件追加
                If Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) And _
                    StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode) = ID_KANRI_TBL(ING_No).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_SEQ_NO Then
                
                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                    Do
'                        DoEvents
                        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                            DoEvents                                                    '2016.01.26
                        End If                                                          '2016.01.26
                        sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrKeyNotFound
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_Proc = False
                                GoTo Abort_Tran
                             Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_Proc = False
                                GoTo Abort_Tran
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                
                End If
                
                com = BtOpGetNext
                
                
            Loop
                                            
            '------------------------------------   在庫移動履歴の処理
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                MENU_NO = ""
            End If
                                            
                                            
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        ID_KANRI_TBL(ING_No).SEK_SYU_JUN & " " & Trim(ID_KANRI_TBL(ING_No).SEK_TEI_NM), _
                                        , , , , MENU_NO, _
                                        , _
                                        "", _
                                        , , , , 1, , , , , , , ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    SEK_PACKING_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
            
            '------------------------------------   作業ログの処理
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                    SEK_PACKING_Proc = SYS_ERR
                    Exit Function
                End If
            End If
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
            '品番状態のカウント
            Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
    
            If HINB_CD_CNT <> ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT Then
            '次　品番
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                
                
                
                
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        
                                                                        
                IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                        
                                                                        
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                
                
                
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                
                '品番状態のカウント
                Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                
                
                
                
                
                
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                Sendbuf = Text_Create_Proc()
            
            Else
            '梱包完了
            
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                
                '-----------------------------------------------３行目
                IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                        
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "検品完了" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "検品完了" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "→ENT")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "→ENT")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                Sendbuf = Text_Create_Proc()
            End If
    
    
        Case Step_Sagyo4_RES        '４回目の受信（Any Key）
            
            
            
            If ID_KANRI_TBL(ING_No).SEK_SAI_SU = 0 Then
                '才数入力
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                
                '-----------------------------------------------２行目
                IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                        
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                
                '品番状態のカウント
                Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                        
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                        
                '-----------------------------------------------５行目
                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                '数値初期表示
                Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                        '入力桁数
                Send_Text.Box_Type(4).Max_Size = "05"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                Sendbuf = Text_Create_Proc()
            
            Else
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                    Case BtNoErr
                    '   -------------------------------- エラーメッセージ作成
                    Case Else
                    '重要な要因なので未登録はシステム停止とする
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                        Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                
                If Sagyo_Send_Proc() Then
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                End If
            
                Sendbuf = Text_Create_Proc()
    
            End If
    
    
        Case Step_Sagyo5_RES        '５回目の受信（才数）
    
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '才数
                    Case LCD_SAI_SU_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_Proc = False
                            Exit Function
                        
                        End If
                
                        SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                
                
                        If SAI_SU = 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_Proc = False
                            Exit Function
                        
                        End If
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                        '------------------------------------   注文ﾃﾞｰﾀの処理
                        Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
                        com = BtOpGetGreaterEqual
            
                        Do
                    
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                
                            Do
                    
                                sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrEOF
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                
                            Loop
            
                
                            If sts = BtErrEOF Then
                                Exit Do
                            End If
                    
                            If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                                Exit Do
                            End If
                        
                
                            Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, "0001")
                            Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(SAI_SU, "000.00"))
                        
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                        
                        
                
                            Do
'                                DoEvents
                                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                    DoEvents                                                    '2016.01.26
                                End If                                                          '2016.01.26
                                sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_Proc = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                
                
                            com = BtOpGetNext
                
                
                        Loop
                                'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
    
                        '次の作業要求
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                        End Select
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                    
                        Sendbuf = Text_Create_Proc()
                    
                End Select
            Next i
    End Select

    SEK_PACKING_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If









    SEK_PACKING_Proc = False

End Function

Public Function Y_SYUKA_TEI_Check_Proc(ID_NO As String, Found_Flg As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス出荷梱包　注文データのチェック』
'               2011.04.25
'               2011.07.20 品番毎の集約を廃止
'
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim Fsw         As Integer


    Y_SYUKA_TEI_Check_Proc = True
    
    
    Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_NO)
    com = BtOpGetGreaterEqual
    
    
    Found_Flg = False
    Fsw = True
    
    Erase ID_KANRI_TBL(ING_No).SEK_TBL
    ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT = 0
    
    
    Do
    
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
    
        sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
        Y_SYUKA_TEI_Check_Proc = sts
        Select Case sts
            Case BtNoErr
                If Trim(ID_NO) <> Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            Case Else
                Y_SYUKA_TEI_Check_Proc = SYS_ERR
                Exit Function
        End Select
    
    
        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
            Found_Flg = True
        End If
        
        If Fsw Then

            ID_KANRI_TBL(ING_No).SEK_SYU_JUN = StrConv(Y_SYU_TEI_REC.SYU_JUN, vbUnicode)
            ID_KANRI_TBL(ING_No).SEK_TEI_NM = StrConv(Y_SYU_TEI_REC.TEI_NM, vbUnicode)

            ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT = ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT + 1
            ID_KANRI_TBL(ING_No).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))


            ReDim Preserve ID_KANRI_TBL(ING_No).SEK_TBL(0 To 0)
            ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_HINB_CD = StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)
'------------------------------------------------------------------ 全数検品対応    2012.03.21
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_GAISO_IRI_QTY = 0
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_Y_HIN_CHK_CNT = 0
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_J_HIN_CHK_CNT = 0
'------------------------------------------------------------------ 全数検品対応    2012.03.21
            ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_JUC_SUU = Val(StrConv(Y_SYU_TEI_REC.JUC_SUU, vbUnicode))
            ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_DATA_CNT = 1

            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
                ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_KONPO_F = False
                Found_Flg = True
            Else
                ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_KONPO_F = True
            End If

            '2011.07.20
            ID_KANRI_TBL(ING_No).SEK_TBL(0).SEK_SEQ_NO = StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode)
            '2011.07.20


            Fsw = False
        Else
'-------------------------------    2011.07.20
            
'            For i = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
'
'                If Trim(ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_HINB_CD) = Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) Then
'                   Exit For
'                End If
'
'            Next i
'
'            If i > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
'                ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT = ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT + 1
'
'                ReDim Preserve ID_KANRI_TBL(ING_No).SEK_TBL(0 To i)
'                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_HINB_CD = StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)
'                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_JUC_SUU = Val(StrConv(Y_SYU_TEI_REC.JUC_SUU, vbUnicode))
'                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
'                    ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_KONPO_F = False
'                    Found_Flg = True
'                Else
'                    ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_KONPO_F = True
'                End If
'                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_DATA_CNT = 1
'
'            Else
'                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_JUC_SUU = ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_JUC_SUU + _
'                                                                Val(StrConv(Y_SYU_TEI_REC.JUC_SUU, vbUnicode))
'                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_DATA_CNT = ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_DATA_CNT + 1
'
'            End If
            i = i + 1
            ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT = ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT + 1

            ReDim Preserve ID_KANRI_TBL(ING_No).SEK_TBL(0 To i)
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_HINB_CD = StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_JUC_SUU = Val(StrConv(Y_SYU_TEI_REC.JUC_SUU, vbUnicode))
            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_KONPO_F = False
                Found_Flg = True
            Else
                ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_KONPO_F = True
            End If
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_DATA_CNT = 1
            
            ID_KANRI_TBL(ING_No).SEK_TBL(i).SEK_SEQ_NO = StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode)
'-------------------------------    2011.07.20
                
        End If
        
        com = BtOpGetNext
    
    Loop
    
    If Not Fsw Then
        Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, Left(ID_NO, 8) & "zz")
        sts = BTRV(BtOpGetLessEqual, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
    
        Select Case sts
            Case BtNoErr
                If Left(ID_NO, 8) <> Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 8) Then
                    Y_SYUKA_TEI_Check_Proc = BtErrEOF
                Else
                    ID_KANRI_TBL(ING_No).SEK_HAKO_SU = Val(StrConv(Y_SYU_TEI_REC.HAKO_NO, vbUnicode))
                End If
                Y_SYUKA_TEI_Check_Proc = BtNoErr
            Case BtErrEOF
                Y_SYUKA_TEI_Check_Proc = BtErrEOF
            Case Else
                Y_SYUKA_TEI_Check_Proc = SYS_ERR
                Exit Function
        End Select
    
    Else
        Y_SYUKA_TEI_Check_Proc = BtErrEOF
    End If


End Function




Public Function Ido_Out_Hin_Furikae_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ品番振替移動出庫指定時のチェック＆更新処理』
'
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8

Dim Hinban          As String * 20

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Ido_Out_Hin_Furikae_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(FROM_Tanaban) = Loc_OK_Para Then '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Ido_Out_Hin_Furikae_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")
                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Ido_Out_Hin_Furikae_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
            
                            '------------------ 禁止棚のチェック
                            If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Ido_Out_Hin_Furikae_Proc = False
                                Exit Function
                            End If
            
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
'                        Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
'                        Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).NAIGAI)
'                        Call UniCode_Conv(K0_ITEM.HIN_GAI, Hinban)
'                        sts = BTRV(BtOpGetEqual, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(TO_Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            FROM_Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            Ido_Out_Hin_Furikae_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Ido_Out_Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                        'FROM 実棚番
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_Hin_Furikae_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                Ido_Out_Hin_Furikae_Proc = False
                Exit Function
            End If
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban     '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品の数量
                                                            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                            
                                                            
                                                            
                                                            '商品化用倉庫区分をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                             '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                           '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "#"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
'            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
'                                                            '表示内容
'            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
'                                                            '数値初期表示
'            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
'                                                            '初期カーソル位置
'            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
'                                                            '入力桁数
'            Send_Text.Box_Type(4).Max_Size = "05"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
'
'            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
        
        
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Ido_Out_Hin_Furikae_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Ido_Out_Hin_Furikae_Proc = False
                            Exit Function
                        End If
            
            
                        If QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                            Ido_Out_Hin_Furikae_Proc = False
                            Exit Function
                        End If
        
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
        
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Ido_Out_Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Ido_Out_Hin_Furikae_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        '次の作業要求
            
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Ido_Out_Hin_Furikae_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Public Function Hin_Furikae_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ品番振替指定時のチェック＆更新処理』
'
'   2011.06.01
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8

Dim Hinban          As String * 20
Dim TO_Hinban       As String * 20


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Hin_Furikae_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（振替前品番／振替後品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_BEF_Hinban         '振替前品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
        
        
        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                                    'FROM 仮想棚番
                        FROM_Tanaban = ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_Proc = False
                                Exit Function
                        End Select
                                
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Hin_Furikae_Proc = False
                            Exit Function
                        End If
        
        
        
        
        
                        ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN = Hinban
        
        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
        
        
        
                        ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
                        ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
        
        
                    Case LCD_AFT_Hinban         '振替後品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                        Call UniCode_Conv(K0_FURIKAE.JGYOBU_MAE, RET_JGYOBU)        '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.NAIGAI_MAE, RET_NAIGAI)        '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.HIN_MAE, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        
                        Call UniCode_Conv(K0_FURIKAE.JGYOBU_GO, RET_JGYOBU)        '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.NAIGAI_GO, RET_NAIGAI)        '2012.03.13
                        
                        
                        Call UniCode_Conv(K0_FURIKAE.HIN_GO, Hinban)
                        sts = BTRV(BtOpGetEqual, FURIKAE_POS, FURIKAEREC, Len(FURIKAEREC), K0_FURIKAE, Len(K0_FURIKAE), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, Hinban, "振替品番エラー", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品番振替Ｍ", 0)
                                Exit Function
                        End Select
                                        
                
                        
                                        
'-----------------------    2011.06.13
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select

                        ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN = Hinban

                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                                    
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
            
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, _
                                        LCD_Tanaban & " " & StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & StrConv(ITEMREC.ST_DAN, vbUnicode))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, _
                                        LCD_Tanaban & " " & StrConv(ITEMREC.ST_SOKO, vbUnicode) & "-" & StrConv(ITEMREC.ST_RETU, vbUnicode) & "-" & StrConv(ITEMREC.ST_REN, vbUnicode) & "-" & StrConv(ITEMREC.ST_DAN, vbUnicode))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "12"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""            '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
            '
                    
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i

'-----------------------    2011.06.13
        Case Step_Sagyo2_RES        '２回目の受信（棚番）
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    Case LCD_Tanaban    '棚番
                        TO_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(TO_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 混載チェック
                        If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                            If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_Proc = False
                                Exit Function
                            End If
                        End If
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(TO_Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(TO_Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(TO_Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(TO_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Hin_Furikae_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
        
        
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Hin_Furikae_Proc = False
                            Exit Function
                        End If
        
                
                
        
                
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    
                    ID_KANRI_TBL(ING_No).Tanaban = TO_Tanaban       '棚番をセーブ
                                                                
                                                                
                                                                
                    SUMI_QTY = ID_KANRI_TBL(ING_No).Send_SUMI_QTY   '送信する商品化済み数量
                    MI_QTY = ID_KANRI_TBL(ING_No).Send_MI_QTY       '送信する未商品数量
                                                                
                                                                
                                                                '商品化用倉庫区分をセーブ
                    ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
                    '数量付きの送信メッセージを作成する
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
            
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                    Send_Text.FileName = ""                                 '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
            
                    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                                
                    '-----------------------------------------------１行目
                                                                    'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                    '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
        
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                    '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                    Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
        
                    '-----------------------------------------------２行目
                                                                    'BOX属性
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                                                                    '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                    '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                    Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    
                    
                    
                    '-----------------------------------------------３行目
                                                                    'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                                                                    '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                    '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                        
                    Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    
                    
                    '-----------------------------------------------４行目
                                                                    'BOX属性
                    Send_Text.Box_Type(3).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, _
                                    Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
        
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, _
                                    Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
                                                                    '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                    
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                    '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                        
                    Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------４行目
                                                                    'BOX属性
                    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY + MI_QTY, "#")))) & Format(SUMI_QTY + MI_QTY, "#"))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY + MI_QTY, "#")))) & Format(SUMI_QTY + MI_QTY, "#"))
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SUMI_QTY + MI_QTY, "#"))) & Format(SUMI_QTY + MI_QTY, "#")
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(SUMI_QTY + MI_QTY, "#"))) & Format(SUMI_QTY + MI_QTY, "#")
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                                    '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "05"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                        
                    Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        '
                
                    Sendbuf = Text_Create_Proc()
                End Select
            
            
            Next i
        
        
        Case Step_Sagyo3_RES        '３回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_Proc = False
                            Exit Function
                        End If
            
            
                        If QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_Proc = False
                            Exit Function
                        End If
            
            
            
            
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, _
                                    "", _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    YOIN_BEF_HINBAN, _
                                    QTY, _
                                    0, 0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, Trim(ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN) & "へ振替", _
                                    , , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "-" & "01-01-01", ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Furikae_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
    
            sts = Nyuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN, _
                                    Format(Now, "YYYYMMDD"), _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    YOIN_AFT_HINBAN, _
                                    QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, Trim(ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN) & "より振替", , , , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "-" & "01-01-01", ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Hin_Furikae_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Furikae_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Hin_Furikae_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Public Function SEK_KYOSEI_END_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水強制完了（大阪ＰＣ向け）』
'
'       2011.06.28
'-------------------------------------------------------
Dim sts                     As Integer
Dim com                     As Integer

Dim ID_NO                   As String * 20



Dim i                       As Integer
Dim j                       As Integer


Dim SYU_JUN                 As String * 10          '出荷順番
Dim TEI_NM                  As String * 30          '邸名
Dim SYUGO_SYU_YMD           As String * 8           '出荷確定日
Dim SYUGO_L_TOK_NAME        As String * 50          '得意先名

Dim SYUGO_SUMI_CNT          As Integer
Dim HINB_CD_CNT             As Integer


Dim SEK_KYOSEI_TBL()        As SEK_KYOSEI_TBL_Tag
Dim SEK_KYOSEI_HINB_CD_TBL() _
                            As SEK_KYOSEI_HINB_CD_TBL_Tag
                        


Dim KUTI_SU                 As Integer
Dim SAI_SU                  As Double

Dim IN_WORD                 As String * 30
Dim OUT_WORD                As String * 16

Dim MENU_NO                 As String * 2   '201.07.22


    SEK_KYOSEI_END_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（邸別ＩＤ／梱包ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SEK_ID_NO      '邸別ID/梱包ID
                                
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        Erase SEK_KYOSEI_TBL
                        j = -1
                        com = BtOpGetGreaterEqual
                        If Len(Trim(ID_NO)) > 13 Then
                        '集合梱包
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_NO)
                            
                            Do
                            
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                Select Case sts
                                    Case BtNoErr
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_NO) Then
                                            Exit Do
                                        End If
                                    Case BtErrEOF
                                        Exit Do
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
                        
                        
                                If j = -1 Then
                                    j = j + 1
                                    SYUGO_SYU_YMD = StrConv(Y_SYU_TEI_REC.SYU_YMD, vbUnicode)
                                    SYUGO_L_TOK_NAME = StrConv(Y_SYU_TEI_REC.L_TOK_NAME, vbUnicode)
                                    ReDim Preserve SEK_KYOSEI_TBL(0 To j)
                                    SEK_KYOSEI_TBL(j).SEK_ID = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                    If Trim(StrConv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, vbUnicode)) <> "" Then
                                        SEK_KYOSEI_TBL(j).SEK_KONPO_F = True
                                    Else
                                        SEK_KYOSEI_TBL(j).SEK_KONPO_F = False
                                    End If
                                    
                                    If IsNumeric(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode)) Then
                                        KUTI_SU = Val(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode))
                                    Else
                                        KUTI_SU = 1
                                    End If
                                    
                                    
                                    If IsNumeric(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) Then
                                        If Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) > 999999 Then
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                        Else
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                        End If
                                    Else
                                        SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                    End If
                                Else
                                
                                    For j = 0 To UBound(SEK_KYOSEI_TBL)
                                                                    
                                        If Trim(SEK_KYOSEI_TBL(j).SEK_ID) = Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) Then
                                            Exit For
                                        End If
                                    
                                    Next j
                                
                                    If j > UBound(SEK_KYOSEI_TBL) Then
                                    
                                        ReDim Preserve SEK_KYOSEI_TBL(0 To j)
                                        SEK_KYOSEI_TBL(j).SEK_ID = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                        If Trim(StrConv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, vbUnicode)) <> "" Then
                                            SEK_KYOSEI_TBL(j).SEK_KONPO_F = True
                                        Else
                                            SEK_KYOSEI_TBL(j).SEK_KONPO_F = False
                                        End If
                                    
                                    
                                        If IsNumeric(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) Then
                                            If Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) > 999999 Then
                                                SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                            Else
                                                SEK_KYOSEI_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                    
                                    
                                            End If
                                        Else
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                        End If
                                    End If
                                
                                End If
                                com = BtOpGetNext
                            Loop
                        Else
                        '邸別梱包
                            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_NO)
                            Erase SEK_KYOSEI_HINB_CD_TBL
                            Do
                            
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        If Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7) <> Left(ID_NO, 7) Then
                                            Exit Do
                                        End If
                                    Case BtErrEOF
                                        Exit Do
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
                        
                        
                                If j = -1 Then
                                    j = j + 1
                                    SYU_JUN = Trim(StrConv(Y_SYU_TEI_REC.SYU_JUN, vbUnicode))
                                    TEI_NM = Trim(StrConv(Y_SYU_TEI_REC.TEI_NM, vbUnicode))
                                    
                                    ReDim Preserve SEK_KYOSEI_TBL(0 To j)
                                    SEK_KYOSEI_TBL(j).SEK_ID = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                    If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                        SEK_KYOSEI_TBL(j).SEK_KONPO_F = True
                                    Else
                                        SEK_KYOSEI_TBL(j).SEK_KONPO_F = False
                                    End If
                                    
                                    If IsNumeric(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode)) Then
                                        KUTI_SU = Val(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode))
                                    Else
                                        KUTI_SU = 1
                                    End If
                                
                                
                                
                                    If IsNumeric(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) Then
                                        SEK_KYOSEI_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                        If SEK_KYOSEI_TBL(j).SEK_SAI_SU > 999 Then
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                        End If
                                    Else
                                        SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                    
                                    End If
                                
                                
                                    If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = Trim(ID_NO) Then
                                        ReDim Preserve SEK_KYOSEI_HINB_CD_TBL(0 To j)
                                        SEK_KYOSEI_HINB_CD_TBL(j).SEK_HINB_CD = Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode))
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                            SEK_KYOSEI_HINB_CD_TBL(j).SEK_KONPO_F = True
                                        Else
                                            SEK_KYOSEI_HINB_CD_TBL(j).SEK_KONPO_F = False
                                        End If
                                    End If
                                Else
                                
                                    For j = 0 To UBound(SEK_KYOSEI_TBL)
                                                                    
                                        If Trim(SEK_KYOSEI_TBL(j).SEK_ID) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                                            Exit For
                                        End If
                                    Next j
                                
                                    If j > UBound(SEK_KYOSEI_TBL) Then
                                        ReDim Preserve SEK_KYOSEI_TBL(0 To j)
                                        SEK_KYOSEI_TBL(j).SEK_ID = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                            SEK_KYOSEI_TBL(j).SEK_KONPO_F = True
                                        Else
                                            SEK_KYOSEI_TBL(j).SEK_KONPO_F = False
                                        End If
                                    
                                    
                                        If IsNumeric(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode)) Then
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                            If SEK_KYOSEI_TBL(j).SEK_SAI_SU > 999 Then
                                                SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                            End If
                                        
                                        Else
                                            SEK_KYOSEI_TBL(j).SEK_SAI_SU = 0
                                        End If
                                    
                                    End If
                                
                                
                                
                                    If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = Trim(ID_NO) Then
                                        
'2011.11.18                                        For j = 0 To UBound(SEK_KYOSEI_TBL)
                                        For j = 0 To UBound(SEK_KYOSEI_HINB_CD_TBL)
                                                                        
                                            If Trim(SEK_KYOSEI_HINB_CD_TBL(j).SEK_HINB_CD) = Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) Then
                                                Exit For
                                            End If
                                        Next j
                                        
'2011.11.18                                        If j > UBound(SEK_KYOSEI_TBL) Then
                                        If j > UBound(SEK_KYOSEI_HINB_CD_TBL) Then
                                        
                                            ReDim Preserve SEK_KYOSEI_HINB_CD_TBL(0 To j)
                                            SEK_KYOSEI_HINB_CD_TBL(j).SEK_HINB_CD = Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode))
                                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                                SEK_KYOSEI_HINB_CD_TBL(j).SEK_KONPO_F = True
                                            Else
                                                SEK_KYOSEI_HINB_CD_TBL(j).SEK_KONPO_F = False
                                            End If
                                        End If
                                    End If
                                
                                
                                
                                End If
                                com = BtOpGetNext
                            Loop
                        End If
                                        
                        If j = -1 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "注文ﾃﾞｰﾀなし", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_KYOSEI_END_PROC = False
                            Exit Function
                        End If
                                                            
                        ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID = ID_NO
                                                            
                                                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        If Len(Trim(ID_NO)) > 13 Then
                            '集合梱包
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            IN_WORD = Trim(SYUGO_L_TOK_NAME)
                            Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 20)
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(OUT_WORD))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(OUT_WORD))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                            '集合梱包状態のカウント
                            SYUGO_SUMI_CNT = 0
                            For j = 0 To UBound(SEK_KYOSEI_TBL)
                                If SEK_KYOSEI_TBL(j).SEK_KONPO_F Then
                                    SYUGO_SUMI_CNT = SYUGO_SUMI_CNT + 1
                                End If
                            Next j
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Mid(SYUGO_SYU_YMD, 1, 4) & "/" & Mid(SYUGO_SYU_YMD, 5, 2) & "/" & Mid(SYUGO_SYU_YMD, 7, 2) & _
                                                                        " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(SEK_KYOSEI_TBL) + 1, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Mid(SYUGO_SYU_YMD, 1, 4) & "/" & Mid(SYUGO_SYU_YMD, 5, 2) & "/" & Mid(SYUGO_SYU_YMD, 7, 2) & _
                                                                        " (" & Format(SYUGO_SUMI_CNT, "#0") & "/" & Format(UBound(SEK_KYOSEI_TBL) + 1, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        Else
                            '邸別梱包
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID), 2)), "#0") & "/" & Format(UBound(SEK_KYOSEI_TBL) + 1, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID), 2)), "#0") & "/" & Format(UBound(SEK_KYOSEI_TBL) + 1, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            
                            '-----------------------------------------------２行目
                            IN_WORD = TEI_NM
                            Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                                    
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(SYU_JUN) & " " & OUT_WORD)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(SYU_JUN) & " " & OUT_WORD)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            '品番状態のカウント
                            HINB_CD_CNT = 0
                            
                            For j = 0 To UBound(SEK_KYOSEI_HINB_CD_TBL)
                                If SEK_KYOSEI_HINB_CD_TBL(j).SEK_KONPO_F Then
                                    HINB_CD_CNT = HINB_CD_CNT + 1
                                End If
                            Next j
                                                        
                                                        
                            
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(UBound(SEK_KYOSEI_HINB_CD_TBL) + 1, "#0)"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(UBound(SEK_KYOSEI_HINB_CD_TBL) + 1, "#0)"))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        End If
                        '-----------------------------------------------４行目
                        
'                        KUTI_SU = 0
'                        For j = 0 To UBound(SEK_KYOSEI_TBL)
'
'                            If SEK_KYOSEI_TBL(j).SEK_ID = ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID Then
'                                KUTI_SU = KUTI_SU + SEK_KYOSEI_TBL(j)
'                            End If
'
'                        Next j
                        
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(Trim(Format(KUTI_SU, "#0")))) & Trim(Format(KUTI_SU, "#0"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Trim(Format(KUTI_SU, "#0")))) & Trim(Format(KUTI_SU, "#0"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "12"
                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "04"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "04"
                        '-----------------------------------------------５行目
                        SAI_SU = 0
                        For j = 0 To UBound(SEK_KYOSEI_TBL)
                        
                            If SEK_KYOSEI_TBL(j).SEK_ID = ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID Then
                                SAI_SU = SAI_SU + SEK_KYOSEI_TBL(j).SEK_SAI_SU
                            End If
                        
                        Next j
                        
                        
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(SAI_SU, "#0.00")))) & Trim(Format(SAI_SU, "#0.00"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(SAI_SU, "#0.00")))) & Trim(Format(SAI_SU, "#0.00"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                        Sendbuf = Text_Create_Proc()
                            
                        SEK_KYOSEI_END_PROC = False
                        Exit Function
                            
                End Select
            Next i
        
                
        Case Step_Sagyo2_RES        '２回目の受信(口数,入り数）
                
                
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '口数
                    Case LCD_KUTI_SU_S
                    
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                    
                        KUTI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If KUTI_SU <= 0 Then
                        
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "口数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                    
                    '才数
                    Case LCD_SAI_SU_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                
                        SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                
                
                        If SAI_SU <= 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_KYOSEI_END_PROC = False
                            Exit Function
                        
                        End If
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                        '------------------------------------   注文ﾃﾞｰﾀの処理
                        If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID)) > 13 Then
                        
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID)
                            com = BtOpGetGreaterEqual
            
                            Do
                    
'                                DoEvents
                                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                    DoEvents                                                    '2016.01.26
                                End If                                                          '2016.01.26
                
                                Do
                    
                                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrEOF
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                
                                Loop
            
                
                                If sts = BtErrEOF Then
                                    Exit Do
                                End If
                    
                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID) Then
                                    Exit Do
                                End If
                        
                
                                Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, Format(KUTI_SU, "0000"))
                                Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(SAI_SU, "000.00"))
                            
                                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                        
                        
                
                                Do
'                                    DoEvents
                                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                        DoEvents                                                    '2016.01.26
                                    End If                                                          '2016.01.26
                                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                
                    
                                com = BtOpGetNext
                
                
                            Loop
                        
                        Else
                            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID)
                            com = BtOpGetGreaterEqual
            
                            Do
                    
'                                DoEvents
                                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                    DoEvents                                                    '2016.01.26
                                End If                                                          '2016.01.26
                
                                Do
                    
                                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrEOF
                                            Exit Do
                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                
                                Loop
            
                
                                If sts = BtErrEOF Then
                                    Exit Do
                                End If
                    
                                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID) Then
                                    Exit Do
                                End If
                        
                
                                Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, Format(KUTI_SU, "0000"))
                                Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(SAI_SU, "000.00"))
                            
                                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                        
                        
                
                                Do
'                                    DoEvents
                                    If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                        DoEvents                                                    '2016.01.26
                                    End If                                                          '2016.01.26
                                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                    Select Case sts
                                        Case BtNoErr
                                            Exit Do
                                        Case BtErrKeyNotFound
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_KYOSEI_END_PROC = False
                                            GoTo Abort_Tran
                                        Case Else
                                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            GoTo Abort_Tran
                                    End Select
                                Loop
                
                    
                                com = BtOpGetNext
                
                
                            Loop
                        End If
                            
                        '------------------------------------   作業ログの処理  2013.07.22
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                        If Trim(MENU_NO) = "" Then
                        Else
                        '作業ﾛｸﾞ出力
                            
                            If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                                ID_KANRI_TBL(ING_No).NAIGAI, _
                                                                MENU_NO, _
                                                                (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                                 , , , , , _
                                                                 ID_KANRI_TBL(ING_No).SEK_KYOSEI_END_ID) Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                            End If
                        End If
                        '------------------------------------   作業ログの処理  2013.07.22
                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
    
    
                        '次の作業要求
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                        End Select
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                    
                        Sendbuf = Text_Create_Proc()
                    
                End Select
            Next i
                
    End Select

    SEK_KYOSEI_END_PROC = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function


Public Function Ido_Out_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材用移動出庫指定時のチェック＆更新処理』
'       2012.03.10
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer
Dim j               As Integer      '2012.03.29

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8

Dim Hinban          As String * 20

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim SHIJI_No        As String * 8
Dim Found_F         As Boolean

Dim MENU_NO         As String * 2

Dim FileName        As String

Dim wkQty           As Long         '2012.04.07
Dim SYUKO_QTY       As Long         '2012.04.07


Dim Hinban_GO       As String * 20  '2012.12.27


    Ido_Out_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票ａj
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO       '指図票
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
                        
                        
                        sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "未登録です", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_Out_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "商品化指図票(親)", 0)
                                Ido_Out_OSAKA_Proc = SYS_ERR
                                Exit Function
                        End Select
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        ID_KANRI_TBL(ING_No).SHIJI_QTY = Val(StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))      '2013.01.26
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票:" & SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票:" & SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "09"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        Ido_Out_OSAKA_Proc = False
                        Exit Function
            
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case RTrim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    Case LCD_Tanaban        '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_Out_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Ido_Out_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                        
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
                        
                        For j = 0 To UBound(JGYOBU_T)
                            
                            If JGYOBU_T(j).CODE = SHIZAI Then
                                sts = Item_Read_Proc(JGYOBU_T(j).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                            Else
                                sts = Item_Read_Proc(JGYOBU_T(j).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                            End If
                            Select Case sts
                                Case BtNoErr
                                    Exit For
                                Case BtErrKeyNotFound
                                    '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                                
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            
                                    Ido_Out_OSAKA_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                    Exit Function
                            End Select
                        Next j
                        
                                                
                        
                        '------------------ 子品番の有無
                        Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
                        Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
                        Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")
        
                        Found_F = False
                        com = BtOpGetGreater
        
                        Do
                            
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                            sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                            Select Case sts
                                Case BtNoErr
                                    If ID_KANRI_TBL(ING_No).SHIJI_No <> StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) Then
                                        Exit Do
                                    End If
                                
                                    If RTrim(Hinban) = RTrim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)) And _
                                        StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode) <> "9" Then
                                        
                                        
                                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                                        
                                        If Fueikae_Read_Proc(Hinban, Hinban_GO) Then
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Exit Function
                                        End If
                                        
                                        If Trim(Hinban_GO) <> "" Then
                                            Hinban = Hinban_GO
                                            SYUKO_QTY = ID_KANRI_TBL(ING_No).SHIJI_QTY - Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
                                            ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = ID_KANRI_TBL(ING_No).SHIJI_QTY
                                        Else
                                            
                                            SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode)) - Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))                           '2012.04.13
                                            ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))
                                        
                                        
                                        End If
                                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                                        
                                        
                                        'ID_KANRI_TBL(ING_No).Send_MI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))    2012.04.07
                                        'SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))                           2012.04.13
'2012.12.27                                        SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode)) - Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))                           '2012.04.13
'2012.12.27                                        ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))    '2012.04.13
                                        
                                        
                                        Found_F = True
                                        Exit Do
                                    End If
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "指図票(子)", 0)
                                    Exit Function
                            End Select
                            
                            com = BtOpGetNext
                        
                        Loop
        
        
                        If Not Found_F Then
                            
                            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.27
                            
'                            '-------------------------------------  読み替えコードで再読み込み  2012.04.05
'
'                            '------------------ 子品番の有無
'                            Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
'                            Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
'                            Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")
'
'
'                            com = BtOpGetGreater
'
'                            Do
'
'                                DoEvents
'                                sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
'                                Select Case sts
'                                    Case BtNoErr
'                                        If ID_KANRI_TBL(ING_No).SHIJI_No <> StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) Then
'                                            Exit Do
'                                        End If
'                                        Call UniCode_Conv(K1_FURIKAE.JGYOBU_GO, BUZAI)
'                                        Call UniCode_Conv(K1_FURIKAE.NAIGAI_GO, NAIGAI_NAI)
'                                        Call UniCode_Conv(K1_FURIKAE.HIN_GO, Hinban)
'
'                                        Call UniCode_Conv(K1_FURIKAE.JGYOBU_MAE, BUZAI)
'                                        Call UniCode_Conv(K1_FURIKAE.NAIGAI_MAE, NAIGAI_NAI)
'                                        Call UniCode_Conv(K1_FURIKAE.HIN_MAE, StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode))
'
'
'                                        sts = BTRV(BtOpGetEqual, FURIKAE_POS, FURIKAEREC, Len(FURIKAEREC), K1_FURIKAE, Len(K1_FURIKAE), 1)
'                                        Select Case sts
'                                            Case BtNoErr
'
'                                                'ID_KANRI_TBL(ING_No).Send_MI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))    2012.04.07
'                                                'SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))                           2012.04.13
'                                                SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.HIKIATE_QTY, vbUnicode))                             '2012.04.13
'                                                ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))    '2012.04.13
'
'                                                Found_F = True
'                                                Exit Do
'
'                                            Case BtErrKeyNotFound
'
'
'                                            Case Else
'                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                                Sendbuf = Text_Create_Proc()
'                                                Call File_Error(sts, BtOpGetEqual, "品番振替マスタ", 0)
'                                                Exit Function
'                                        End Select
'
'                                    Case BtErrEOF
'                                        Exit Do
'                                    Case Else
'                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                        Sendbuf = Text_Create_Proc()
'                                        Call File_Error(sts, BtOpGetEqual, "指図票(子)", 0)
'                                        Exit Function
'                                End Select
'
'                                com = BtOpGetNext
'
'                            Loop
'
'                            '-------------------------------------  読み替えコードで再読み込み  2012.04.05
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.27
                            
                            '   -------------------------------- エラーメッセージ作成
                            
                            If Not Found_F Then
                            
                            
                                
                            
                            
'2017.09.22
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "子品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                Ido_Out_OSAKA_Proc = False
                                Exit Function
                            End If
                        End If
        
        
                        If StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode) = "9" Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "商品化用に移動済み！", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
        
        
        
                End Select
            Next i
            
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                        'FROM 実棚番
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_OSAKA_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                Ido_Out_OSAKA_Proc = False
                Exit Function
            End If
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban     '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
                      
            If Trim(Hinban_GO) <> "" Then       '2013.01.25
                ID_KANRI_TBL(ING_No).Hinban = Hinban_GO     '品番をセーブ
            End If
            
            
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する商品化済み数量
                                                            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                            
                                                            
                                                            
                                                            '商品化用倉庫区分をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
            Send_Text.FileName = ""                                 '送信データファイル名
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                    Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                             '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                           '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.04.07 出庫数を１行に変更
'            '-----------------------------------------------４行目
'                                                            'BOX属性
'            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
'                                                            '表示内容
'            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0")))) & Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0")))) & Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))
'                                                            '数値初期表示
'            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0")
'                                                            '初期カーソル位置
'            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
'                                                            '入力桁数
'            Send_Text.Box_Type(3).Max_Size = "05"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
'
'            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
'            '-----------------------------------------------５行目
'                                                            'BOX属性
'            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
'                                                        '表示内容
'            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0")))) & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0")))) & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))
'                                                            '数値初期表示
'            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0")
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))) & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0")
'                                                            '初期カーソル位置
'            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
'                                                            '入力桁数
'            Send_Text.Box_Type(4).Max_Size = "05"
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
'
'            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
'            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
'
'            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                           '表示内容
            
            
            
            
            If ID_KANRI_TBL(ING_No).S_JGYOBU = BUZAI Then
                
                If SYUKO_QTY = 0 Then                               '2012.04.13
                    SYUKO_QTY = ID_KANRI_TBL(ING_No).KO_SHIJI_QTY   '2012.04.13
                End If                                              '2012.04.13
                
                
                If ID_KANRI_TBL(ING_No).Send_MI_QTY < SYUKO_QTY Then
                    wkQty = ID_KANRI_TBL(ING_No).Send_MI_QTY
                Else
                    wkQty = SYUKO_QTY
                End If
                ID_KANRI_TBL(ING_No).Send_MI_QTY = wkQty
                ID_KANRI_TBL(ING_No).Send_SUMI_QTY = 0
            Else
                
                If SYUKO_QTY = 0 Then                               '2012.04.13
                    SYUKO_QTY = ID_KANRI_TBL(ING_No).KO_SHIJI_QTY   '2012.04.13
                End If                                              '2012.04.13
                
                
                If ID_KANRI_TBL(ING_No).Send_SUMI_QTY < SYUKO_QTY Then
                    wkQty = ID_KANRI_TBL(ING_No).Send_SUMI_QTY
                Else
                    wkQty = SYUKO_QTY
                End If
                ID_KANRI_TBL(ING_No).Send_MI_QTY = 0
                ID_KANRI_TBL(ING_No).Send_SUMI_QTY = wkQty
            End If
            
            
            
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OSAKA_IDO_OUT & Space(M_Keta - (Len(LCD_OSAKA_IDO_OUT) * 2) - 5 + (5 - Len(Format(wkQty, "#0")))) & Format(wkQty, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OSAKA_IDO_OUT & Space(M_Keta - (Len(LCD_OSAKA_IDO_OUT) * 2) - 5 + (5 - Len(Format(wkQty, "#0")))) & Format(wkQty, "#0"))
                                                           '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(wkQty, "#0"))) & Format(wkQty, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(wkQty, "#0"))) & Format(wkQty, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"

            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                        '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.04.07 出庫数を１行に変更
        
        
            Sendbuf = Text_Create_Proc()
            Ido_Out_OSAKA_Proc = False
            Exit Function
        
        
        Case Step_Sagyo3_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
'                    Case LCD_Suryo          '数量（ここは無い）
'                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                            Ido_Out_OSAKA_Proc = False
'                            Exit Function
'                        End If
'
'                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
'                        If QTY = 0 Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                            Ido_Out_OSAKA_Proc = False
'                            Exit Function
'                        End If
'
'
'                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
'
'                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                            Ido_Out_OSAKA_Proc = False
'                            Exit Function
'                        End If
'
'
'                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
'                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
''                            If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
''                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
''                                Sendbuf = Text_Create_Proc()
''                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
''
''                                Ido_Out_OSAKA_Proc = False
''                                Exit Function
''                            End If
'                        Else
'                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
''                            If SUMI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY Then
''                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
''                                Sendbuf = Text_Create_Proc()
''                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
''
''                                Ido_Out_OSAKA_Proc = False
''                                Exit Function
''                            End If
'                        End If
'
'                        If i = M_Gyo - 1 Then       '最終行だったら
'                            If SUMI_QTY = 0 And MI_QTY = 0 Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "商品／未商品＝０", "数量入力ミス", "", "")
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                Ido_Out_OSAKA_Proc = False
'                                Exit Function
'                            End If
'
'
'                            If SUMI_QTY + MI_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
'                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, "数量オーバー", "数量入力ミス", "", "")
'                                Sendbuf = Text_Create_Proc()
'                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'
'                                Ido_Out_OSAKA_Proc = False
'                                Exit Function
'                            End If
'
'                        End If
                    Case LCD_OSAKA_IDO_OUT
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If

                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
               
                        If QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "数量オーバー", "数量入力ミス", Format(QTY, "#0"), Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_Proc = False
                            Exit Function
                        End If
              
               
                
                End Select
            Next i
            
            
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
        
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
            If ID_KANRI_TBL(ING_No).S_JGYOBU = BUZAI Then
                MI_QTY = QTY
                SUMI_QTY = 0
            Else
                MI_QTY = 0
                SUMI_QTY = QTY
            End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
            
            
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, ID_KANRI_TBL(ING_No).SHIJI_No, MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Ido_Out_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Ido_Out_OSAKA_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
    
            '------------------ 子品番の移動済み更新
            Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
            Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")

            Found_F = False
            com = BtOpGetGreater

            Do
                
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
                sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                Select Case sts
                    Case BtNoErr
                        If ID_KANRI_TBL(ING_No).SHIJI_No <> StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) Then
                            Exit Do
                        End If
                    
                        
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                        
                        If Fueikae_Read_Proc(Trim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)), Hinban_GO) Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        If Trim(Hinban_GO) = "" Then
                            Hinban_GO = StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)
                        End If
                        
                        'If RTrim(ID_KANRI_TBL(ING_No).Hinban) = RTrim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)) Then
                        If RTrim(ID_KANRI_TBL(ING_No).Hinban) = RTrim(Hinban_GO) Then
                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                            
                            
                            QTY = Val(StrConv(P_SSHIJI_K_REC.HIKIATE_QTY, vbUnicode))                                   '2012.04.13
                            QTY = QTY - (SUMI_QTY + MI_QTY)                                                             '2012.04.13
                            If QTY < 0 Then
                                QTY = 0
                            End If
                            'Call UniCode_Conv(P_SSHIJI_K_REC.HIKIATE_QTY, Format(SUMI_QTY + MI_QTY, "00000000.00"))    2012.04.13
                            Call UniCode_Conv(P_SSHIJI_K_REC.HIKIATE_QTY, Format(QTY, "00000000.00"))                   '2012.04.13
                            
                            
                            
                            QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))                                  '2012.04.13
                            QTY = QTY + (SUMI_QTY + MI_QTY)                                                             '2012.04.13
                            Call UniCode_Conv(P_SSHIJI_K_REC.IDO_SUMI_QTY, Format(QTY, "00000000.00"))                  '2012.04.13
                            
                            If QTY >= ID_KANRI_TBL(ING_No).KO_SHIJI_QTY Then                                            '2012.04.13
                                Call UniCode_Conv(P_SSHIJI_K_REC.IDO_SUMI, "9")
                            End If                                                                                      '2012.04.13
                            
                            sts = BTRV(BtOpUpdate, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                        
                            Select Case sts
                                Case BtNoErr
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpUpdate, "指図票(子)", 0)
                                    Exit Function
                            End Select
                        
                        
                        
                        
                        End If
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "指図票(子)", 0)
                        Exit Function
                End Select
                
                com = BtOpGetNext
            
            Loop
    
    
    
    
    
    
    
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            
            'ラベル発行処理
            If LABEL_88_SendFile <> "" And _
                Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) <> "" Then
                
                
                FileName = LABEL_88_SendFile
                
                If Label_Print_File_Make_Proc(FileName, ID_KANRI_TBL(ING_No).Hinban, 0) Then
                End If
            
            
            
                'データ送信
                ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                            
                                            
                ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
            
                ID_KANRI_TBL(ING_No).LABEL_ON = True
            
                '-----------------------------------------------ヘッダー
            
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL
            
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                Send_Text.FileName = FileName                           '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = FileName
            
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
            
                Sendbuf = Text_Create_Proc()
                Ido_Out_OSAKA_Proc = False
                
                Exit Function
            
            Else
                '出荷予定／在庫の予約解除
                sts = Data_Clear_Proc(0, Sendbuf)
                Select Case sts
                    Case SYS_CANCEL
                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    
                    Case SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                End Select
                                            
'                                            '次の作業要求
'
'
'                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
'                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
'                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
'                Select Case sts
'                    Case BtNoErr
'                    '   -------------------------------- エラーメッセージ作成
'                    Case Else
'                    '重要な要因なので未登録はシステム停止とする
'                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                    Sendbuf = Text_Create_Proc()
'                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
'                    Exit Function
'                End Select
'
'                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
'
'                Sendbuf = Text_Create_Proc()
'                Ido_Out_OSAKA_Proc = False
'
'                Exit Function
            
                '>>>>2012.03.29　品番入力へ
                '-----------------------------------------------ヘッダー
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "09"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                    
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()
                Ido_Out_OSAKA_Proc = False
                Exit Function
            
            
            
            
            End If
                                        
                                        
                                        
        Case Step_PRINT_RES         '２回目の受信（印刷終了）
'                                                    '次の作業要求
'                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
'                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
'                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
'                Select Case sts
'                    Case BtNoErr
'                    '   -------------------------------- エラーメッセージ作成
'                    Case Else
'                    '重要な要因なので未登録はシステム停止とする
'                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                    Sendbuf = Text_Create_Proc()
'                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
'                    Exit Function
'                End Select
'                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
'                If Sagyo_Send_Proc() Then
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'                End If
'
'                Sendbuf = Text_Create_Proc()
                                        
            '>>>>2012.03.29　品番入力へ
            '-----------------------------------------------ヘッダー
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
            '-----------------------------------------------１行目
                                                                    'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                    '表示内容
'2017.09.22
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                    '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                                    'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                    '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(1).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                                    'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                    '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(2).Max_Size = "09"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                    
            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                                    'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                    '数値初期表示
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(3).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                    
                                                                    
                                                                    
            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------４行目
                                                                    'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                
                                                                    '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                    '入力桁数
             Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

            Sendbuf = Text_Create_Proc()
            Ido_Out_OSAKA_Proc = False
            Exit Function
            
            
            
            
                                        
                                        
                                        
    
    End Select

    Ido_Out_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Public Function Ido_Out_OSAKA_NEW2_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　商品化用移動出庫指定時のチェック＆更新処理』
'       2016.05.11
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer
Dim j               As Integer      '2012.03.29

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8

Dim Hinban          As String * 20

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim SHIJI_No        As String * 8
Dim Found_F         As Boolean

Dim MENU_NO         As String * 2

Dim FileName        As String

Dim wkQty           As Long         '2012.04.07
Dim SYUKO_QTY       As Long         '2012.04.07


Dim Hinban_GO       As String * 20  '2012.12.27

Dim wkRET_JGYOBU    As String * 1   '2016.05.27
Dim wkRET_NAIGAI    As String * 1   '2016.05.27



    Ido_Out_OSAKA_NEW2_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票ａj
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO       '指図票
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
                        
                        
                        sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "未登録です", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_Out_OSAKA_NEW2_Proc = False
                                Exit Function
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "商品化指図票(親)", 0)
                                Ido_Out_OSAKA_NEW2_Proc = SYS_ERR
                                Exit Function
                        End Select
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ido_Out_OSAKA_NEW2_Proc = False
                            Exit Function
                        End If
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ido_Out_OSAKA_NEW2_Proc = False
                            Exit Function
                        End If
                        
                        
                        ' 親品番　注文Ｆ読込み
                        If Trim(StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode)) <> "" Then       '2016.05.21
                            Call UniCode_Conv(K6_ODR_ORDER.ORDER_NO, StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode))
                            sts = BTRV(BtOpGetEqual, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
                            Select Case sts
                                Case BtNoErr
                                    ID_KANRI_TBL(ING_No).ODR_QTY = Val(StrConv(ODR_ORDER_REC.ODR_QTY, vbUnicode))
                                Case BtErrKeyNotFound
                                    ID_KANRI_TBL(ING_No).ODR_QTY = 0
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "親品番　注文Ｆ", 0)
                                    Ido_Out_OSAKA_NEW2_Proc = SYS_ERR
                                    Exit Function
                            End Select
                        Else                                    '2016.05.21
                            ID_KANRI_TBL(ING_No).ODR_QTY = 0    '2016.05.21
                        End If
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        ID_KANRI_TBL(ING_No).SHIJI_QTY = Val(StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))      '2013.01.26
                        ID_KANRI_TBL(ING_No).OYA_HINBAN = StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)            '2014.10.30
                            
                            
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票:" & SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票:" & SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "09"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        Ido_Out_OSAKA_NEW2_Proc = False
                        Exit Function
            
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case RTrim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    Case LCD_Tanaban        '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_Out_OSAKA_NEW2_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Ido_Out_OSAKA_NEW2_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                        
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Ido_Out_OSAKA_NEW2_Proc = False
                            Exit Function
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        'Janｺｰﾄﾞ　読み替え  201605.27
                        sts = Item_Read2_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, wkRET_JGYOBU, wkRET_NAIGAI)
                        
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                            
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
                        'Janｺｰﾄﾞ　読み替え 2016.05.27
'>>>>>>>>>>>>>>>>>  2016.05.11 品目の読込を子品番チェック後に移動
'                        '------------------ 品目マスタ読込み
'
'
' '>>>>>>>>>>>>>         2016.05.11  資材を先に読込
'                        sts = Item_Read_Proc(SHIZAI, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
'
'
'
'                        Select Case sts
'                            Case BtNoErr
''                                Exit For
'                            Case BtErrKeyNotFound
'
'
'                                For j = 0 To UBound(JGYOBU_T)
'
'         '                          2016.05.11
'         '                           If JGYOBU_T(j).CODE = SHIZAI Then
'         '                               sts = Item_Read_Proc(JGYOBU_T(j).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
'         '                           Else
'         '                               sts = Item_Read_Proc(JGYOBU_T(j).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
'         '                           End If
'
'                                     sts = Item_Read_Proc(JGYOBU_T(j).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
'         '                          2016.05.11
'
'
'
'                                    Select Case sts
'                                        Case BtNoErr
'                                            Exit For
'                                        Case BtErrKeyNotFound
'
'
'        '2016.05.11
'                                            '   -------------------------------- エラーメッセージ作成
'        '                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
'        '
'        '                                    Sendbuf = Text_Create_Proc()
'        '                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'        '
'        '                                    Ido_Out_OSAKA_NEW2_Proc = False
'        '                                    Exit Function
'        '2016.05.11
'                                        Case Else
'                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                            Sendbuf = Text_Create_Proc()
'                                            Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                            Exit Function
'                                    End Select
'                                Next j
'
'
'
'
'                                If j > UBound(JGYOBU_T) Then
'
'                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Hinban, "品番エラー", "", "")
'                                    Sendbuf = Text_Create_Proc()
'                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                                    Ido_Out_OSAKA_NEW2_Proc = False
'                                    Exit Function
'                                End If
'
'
'
'
'                            Case Else
'                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                Sendbuf = Text_Create_Proc()
'                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
'                                Exit Function
'                        End Select
' '>>>>>>>>>>>>>         2016.05.11  資材を先に読込
''>>>>>>>>>>>>>>>>>  2016.05.11 品目の読込を子品番チェック後に移動
                        
                        
                        
                        
                        
                                                
                        
                        '------------------ 子品番の有無
                        Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
                        Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
                        Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")
        
                        Found_F = False
                        com = BtOpGetGreater
        
                        Do
                            
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                            sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                            Select Case sts
                                Case BtNoErr
                                    If ID_KANRI_TBL(ING_No).SHIJI_No <> StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) Then
                                        Exit Do
                                    End If
                                
'                                    If RTrim(Hinban) = RTrim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)) And _
'                                        StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode) <> "9" Then
                                    If RTrim(Hinban) = RTrim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)) Then
                                        If StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode) <> "9" Then
                                        
                                        
                                            '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                                            
                                            If Fueikae_Read_Proc(Hinban, Hinban_GO) Then
                                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                                Sendbuf = Text_Create_Proc()
                                                Exit Function
                                            End If
                                            
                                            If Trim(Hinban_GO) <> "" Then
                                                Hinban = Hinban_GO
                                                SYUKO_QTY = ID_KANRI_TBL(ING_No).SHIJI_QTY - Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
                                                ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = ID_KANRI_TBL(ING_No).SHIJI_QTY
                                            Else
                                                
                                                SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode)) - Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))                           '2012.04.13
                                                ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))
                                            
                                            
                                            End If
                                            '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                                            
                                            Found_F = True
                                            Exit Do
                                        Else                    '2016.05.11
                                            Found_F = True      '2016.05.11
                                            Exit Do             '2016.05.11
                                        End If
                                    End If
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "指図票(子)", 0)
                                    Exit Function
                            End Select
                            
                            com = BtOpGetNext
                        
                        Loop
        
        
                        If Not Found_F Then
                            
                            
                            
                            '   -------------------------------- エラーメッセージ作成
                            
                            If Not Found_F Then
                            
                            
                                
                            
                            
                                
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "子品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                Ido_Out_OSAKA_NEW2_Proc = False
                                Exit Function
                            End If
                        End If
        
        
                        If StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode) = "9" Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "商品化用に移動済み！", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            Ido_Out_OSAKA_NEW2_Proc = False
                            Exit Function
                        End If
        
        
        
        
''>>>>>>>>>>>>>>>>>  2016.05.11 品目の読込を子品番チェック後に移動
                        sts = Item_Read_Proc(StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode), StrConv(P_SSHIJI_K_REC.KO_NAIGAI, vbUnicode), Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")

                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                                Ido_Out_OSAKA_NEW2_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
''>>>>>>>>>>>>>>>>>  2016.05.11 品目の読込を子品番チェック後に移動
        
                End Select
            Next i
            
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                        'FROM 実棚番
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_OSAKA_NEW2_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                Ido_Out_OSAKA_NEW2_Proc = False
                Exit Function
            End If
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban     '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
                      
            If Trim(Hinban_GO) <> "" Then       '2013.01.25
                ID_KANRI_TBL(ING_No).Hinban = Hinban_GO     '品番をセーブ
            End If
            
            
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する商品化済み数量
                                                            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                            
                                                            
                                                            
                                                            '商品化用倉庫区分をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
            Send_Text.FileName = ""                                 '送信データファイル名
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                    Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                    Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                             '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                           '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.04.07 出庫数を１行に変更
'
'            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                           '表示内容
            
            
            
            
'2016.05.11            If ID_KANRI_TBL(ING_No).S_JGYOBU = BUZAI Then
            If ID_KANRI_TBL(ING_No).S_JGYOBU = SHIZAI Then          '2016.05.11
                
                If SYUKO_QTY = 0 Then                               '2012.04.13
                    SYUKO_QTY = ID_KANRI_TBL(ING_No).KO_SHIJI_QTY   '2012.04.13
                End If                                              '2012.04.13
                
                
                If ID_KANRI_TBL(ING_No).Send_MI_QTY < SYUKO_QTY Then
                    wkQty = ID_KANRI_TBL(ING_No).Send_MI_QTY
                Else
                    wkQty = SYUKO_QTY
                End If
                ID_KANRI_TBL(ING_No).Send_MI_QTY = wkQty
                ID_KANRI_TBL(ING_No).Send_SUMI_QTY = 0
            Else
                
                If SYUKO_QTY = 0 Then                               '2012.04.13
                    SYUKO_QTY = ID_KANRI_TBL(ING_No).KO_SHIJI_QTY   '2012.04.13
                End If                                              '2012.04.13
                
                
                If ID_KANRI_TBL(ING_No).Send_SUMI_QTY < SYUKO_QTY Then
                    wkQty = ID_KANRI_TBL(ING_No).Send_SUMI_QTY
                Else
                    wkQty = SYUKO_QTY
                End If
                ID_KANRI_TBL(ING_No).Send_MI_QTY = 0
                ID_KANRI_TBL(ING_No).Send_SUMI_QTY = wkQty
            End If
            
            
            
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OSAKA_IDO_OUT & Space(M_Keta - (Len(LCD_OSAKA_IDO_OUT) * 2) - 5 + (5 - Len(Format(wkQty, "#0")))) & Format(wkQty, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OSAKA_IDO_OUT & Space(M_Keta - (Len(LCD_OSAKA_IDO_OUT) * 2) - 5 + (5 - Len(Format(wkQty, "#0")))) & Format(wkQty, "#0"))
                                                           '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(wkQty, "#0"))) & Format(wkQty, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(wkQty, "#0"))) & Format(wkQty, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"

            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                        '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.04.07 出庫数を１行に変更
        
        
            Sendbuf = Text_Create_Proc()
            Ido_Out_OSAKA_NEW2_Proc = False
            Exit Function
        
        
        Case Step_Sagyo3_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
                    Case LCD_OSAKA_IDO_OUT
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_NEW2_Proc = False
                            Exit Function
                        End If

                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_NEW2_Proc = False
                            Exit Function
                        End If
               
                        If QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "数量オーバー", "数量入力ミス", Format(QTY, "#0"), Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_NEW2_Proc = False
                            Exit Function
                        End If
              
                        ID_KANRI_TBL(ING_No).IDO_OUT_OSAKA_NEW_QTY = QTY
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        '数量付きの送信メッセージを作成する
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                                
                        '-----------------------------------------------１行目
                        Send_Text.FileName = ""                                 '送信データファイル名
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                                                                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                         '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                       '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
'
            '            '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                           '表示内容
            
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出庫数：" & QTY)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出庫数：" & QTY)
                                                            '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                       '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                    
                                                                    
                                                                    
                        If Zaiko_Syukei_Proc(SUMI_QTY, MI_QTY, ID_KANRI_TBL(ING_No).S_JGYOBU, ID_KANRI_TBL(ING_No).S_NAIGAI, ID_KANRI_TBL(ING_No).Hinban, , , , , IDO_OUT_ZAIKO_SOKO_F) Then
                                                                    
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        QTY = (SUMI_QTY + MI_QTY) - QTY
                                                                    
                                                                    '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出庫後在庫:" & QTY)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出庫後在庫:" & QTY)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
            
                    
                    
                        Sendbuf = Text_Create_Proc()
                        Ido_Out_OSAKA_NEW2_Proc = False
                        Exit Function
                
                
                
                
                End Select
            
            
            
            
            
            
            
            
            Next i
            
            
            
            
            
            
            
            
            
            
        Case Step_Sagyo4_RES        '１回目の受信（指図票ａj
            
            
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
        
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
'            If ID_KANRI_TBL(ING_No).S_JGYOBU = BUZAI Then
            If ID_KANRI_TBL(ING_No).S_JGYOBU = SHIZAI Then      '2016.05.11
                MI_QTY = ID_KANRI_TBL(ING_No).IDO_OUT_OSAKA_NEW_QTY
                SUMI_QTY = 0
            Else
                MI_QTY = 0
                SUMI_QTY = ID_KANRI_TBL(ING_No).IDO_OUT_OSAKA_NEW_QTY
            End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
            
            
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, (ID_KANRI_TBL(ING_No).SHIJI_No & " " & RTrim(ID_KANRI_TBL(ING_No).OYA_HINBAN) & " " & Format(ID_KANRI_TBL(ING_No).ODR_QTY, "#")), MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Ido_Out_OSAKA_NEW2_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_OSAKA_NEW2_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Ido_Out_OSAKA_NEW2_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
    
            '------------------ 子品番の移動済み更新
            Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
            Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")

            Found_F = False
            com = BtOpGetGreater

            Do
                
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
                sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                Select Case sts
                    Case BtNoErr
                        If ID_KANRI_TBL(ING_No).SHIJI_No <> StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) Then
                            Exit Do
                        End If
                    
                        
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                        
                        If Fueikae_Read_Proc(Trim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)), Hinban_GO) Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        If Trim(Hinban_GO) = "" Then
                            Hinban_GO = StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)
                        End If
                        
                        If RTrim(ID_KANRI_TBL(ING_No).Hinban) = RTrim(Hinban_GO) Then
                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                            
                            
                            QTY = Val(StrConv(P_SSHIJI_K_REC.HIKIATE_QTY, vbUnicode))                                   '2012.04.13
                            QTY = QTY - (SUMI_QTY + MI_QTY)                                                             '2012.04.13
                            If QTY < 0 Then
                                QTY = 0
                            End If
                            Call UniCode_Conv(P_SSHIJI_K_REC.HIKIATE_QTY, Format(QTY, "00000000.00"))                   '2012.04.13
                            
                            
                            
                            QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))                                  '2012.04.13
                            QTY = QTY + (SUMI_QTY + MI_QTY)                                                             '2012.04.13
                            Call UniCode_Conv(P_SSHIJI_K_REC.IDO_SUMI_QTY, Format(QTY, "00000000.00"))                  '2012.04.13
                            
                            If QTY >= ID_KANRI_TBL(ING_No).KO_SHIJI_QTY Then                                            '2012.04.13
                                Call UniCode_Conv(P_SSHIJI_K_REC.IDO_SUMI, "9")
                            End If                                                                                      '2012.04.13
                            
                            sts = BTRV(BtOpUpdate, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                        
                            Select Case sts
                                Case BtNoErr
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpUpdate, "指図票(子)", 0)
                                    Exit Function
                            End Select
                        
                        
                        
                        
                        End If
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "指図票(子)", 0)
                        Exit Function
                End Select
                
                com = BtOpGetNext
            
            Loop
    
    
    
    
    
    
    
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            
            'ラベル発行処理
            If LABEL_88_SendFile <> "" And _
                Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) <> "" Then
                
                
                FileName = LABEL_88_SendFile
                
                If Label_Print_File_Make_Proc(FileName, ID_KANRI_TBL(ING_No).Hinban, 0) Then
                End If
            
            
            
                'データ送信
                ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                            
                                            
                ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
            
                ID_KANRI_TBL(ING_No).LABEL_ON = True
            
                '-----------------------------------------------ヘッダー
            
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL
            
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                Send_Text.FileName = FileName                           '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = FileName
            
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
            
                Sendbuf = Text_Create_Proc()
                Ido_Out_OSAKA_NEW2_Proc = False
                
                Exit Function
            
            Else
                '出荷予定／在庫の予約解除
                sts = Data_Clear_Proc(0, Sendbuf)
                Select Case sts
                    Case SYS_CANCEL
                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    
                    Case SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                End Select
                
                '-----------------------------------------------ヘッダー
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "09"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                    
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()
                Ido_Out_OSAKA_NEW2_Proc = False
                Exit Function
            
            
            
            
            End If
                                        
                                        
                                        
        Case Step_PRINT_RES         '２回目の受信（印刷終了）
                                        
            '>>>>2012.03.29　品番入力へ
            '-----------------------------------------------ヘッダー
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
            '-----------------------------------------------１行目
                                                                    'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                    '表示内容
'2017.09.22
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                    '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                                    'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                    '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(1).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                                    'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                    '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(2).Max_Size = "09"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                    
            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                                    'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                    '数値初期表示
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(3).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                    
                                                                    
                                                                    
            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------４行目
                                                                    'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                
                                                                    '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                    '入力桁数
             Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

            Sendbuf = Text_Create_Proc()
            Ido_Out_OSAKA_NEW2_Proc = False
            Exit Function
            
            
            
            
                                        
                                        
                                        
    
    End Select

    Ido_Out_OSAKA_NEW2_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Public Function Ido_Out_OSAKA_NEW_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材用移動出庫指定時のチェック＆更新処理』
'       2014.10.30
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer
Dim j               As Integer      '2012.03.29

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8

Dim Hinban          As String * 20

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim SHIJI_No        As String * 8
Dim Found_F         As Boolean

Dim MENU_NO         As String * 2

Dim FileName        As String

Dim wkQty           As Long         '2012.04.07
Dim SYUKO_QTY       As Long         '2012.04.07


Dim Hinban_GO       As String * 20  '2012.12.27


    Ido_Out_OSAKA_NEW_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票ａj
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO       '指図票
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
                        
                        
                        sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "未登録です", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_Out_OSAKA_NEW_Proc = False
                                Exit Function
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "商品化指図票(親)", 0)
                                Ido_Out_OSAKA_NEW_Proc = SYS_ERR
                                Exit Function
                        End Select
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ido_Out_OSAKA_NEW_Proc = False
                            Exit Function
                        End If
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ido_Out_OSAKA_NEW_Proc = False
                            Exit Function
                        End If
                        
                        
                        ' 親品番　注文Ｆ読込み
                        Call UniCode_Conv(K6_ODR_ORDER.ORDER_NO, StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode))
                        sts = BTRV(BtOpGetEqual, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
                        Select Case sts
                            Case BtNoErr
                                ID_KANRI_TBL(ING_No).ODR_QTY = Val(StrConv(ODR_ORDER_REC.ODR_QTY, vbUnicode))
                            Case BtErrKeyNotFound
                                ID_KANRI_TBL(ING_No).ODR_QTY = 0
                            Case Else
                                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "親品番　注文Ｆ", 0)
                                Ido_Out_OSAKA_NEW_Proc = SYS_ERR
                                Exit Function
                        End Select
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        ID_KANRI_TBL(ING_No).SHIJI_QTY = Val(StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))      '2013.01.26
                        ID_KANRI_TBL(ING_No).OYA_HINBAN = StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)            '2014.10.30
                            
                            
                            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票:" & SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票:" & SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "09"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        Ido_Out_OSAKA_NEW_Proc = False
                        Exit Function
            
                End Select
            Next i
        Case Step_Sagyo2_RES        '２回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case RTrim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    Case LCD_Tanaban        '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_Out_OSAKA_NEW_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Ido_Out_OSAKA_NEW_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                        
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚使用不可", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Ido_Out_OSAKA_NEW_Proc = False
                            Exit Function
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
                        
                        For j = 0 To UBound(JGYOBU_T)
                            
                            If JGYOBU_T(j).CODE = SHIZAI Then
                                sts = Item_Read_Proc(JGYOBU_T(j).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                            Else
                                sts = Item_Read_Proc(JGYOBU_T(j).CODE, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                            End If
                            Select Case sts
                                Case BtNoErr
                                    Exit For
                                Case BtErrKeyNotFound
                                    '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                                
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            
                                    Ido_Out_OSAKA_NEW_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                    Exit Function
                            End Select
                        Next j
                        
                                                
                        
                        '------------------ 子品番の有無
                        Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
                        Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
                        Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")
        
                        Found_F = False
                        com = BtOpGetGreater
        
                        Do
                            
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                            sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                            Select Case sts
                                Case BtNoErr
                                    If ID_KANRI_TBL(ING_No).SHIJI_No <> StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) Then
                                        Exit Do
                                    End If
                                
                                    If RTrim(Hinban) = RTrim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)) And _
                                        StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode) <> "9" Then
                                        
                                        
                                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                                        
                                        If Fueikae_Read_Proc(Hinban, Hinban_GO) Then
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Exit Function
                                        End If
                                        
                                        If Trim(Hinban_GO) <> "" Then
                                            Hinban = Hinban_GO
                                            SYUKO_QTY = ID_KANRI_TBL(ING_No).SHIJI_QTY - Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
                                            ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = ID_KANRI_TBL(ING_No).SHIJI_QTY
                                        Else
                                            
                                            SYUKO_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode)) - Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))                           '2012.04.13
                                            ID_KANRI_TBL(ING_No).KO_SHIJI_QTY = Val(StrConv(P_SSHIJI_K_REC.KO_SHIJI_QTY, vbUnicode))
                                        
                                        
                                        End If
                                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                                        
                                        Found_F = True
                                        Exit Do
                                    End If
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "指図票(子)", 0)
                                    Exit Function
                            End Select
                            
                            com = BtOpGetNext
                        
                        Loop
        
        
                        If Not Found_F Then
                            
                            
                            
                            '   -------------------------------- エラーメッセージ作成
                            
                            If Not Found_F Then
                            
                            
                                
                            
                            
'2017.09.22
                                
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "子品番エラー", "", "")
                            
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        
                                Ido_Out_OSAKA_NEW_Proc = False
                                Exit Function
                            End If
                        End If
        
        
                        If StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode) = "9" Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "商品化用に移動済み！", "", "")
                        
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                            Ido_Out_OSAKA_NEW_Proc = False
                            Exit Function
                        End If
        
        
        
                End Select
            Next i
            
            '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                        'FROM 実棚番
            sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
            Select Case sts
                Case False
                Case True           'ここでは発生しない
                    Exit Function
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_OSAKA_NEW_Proc = False
                    Exit Function
            End Select
                    
            If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                Sendbuf = Text_Create_Proc()
                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                Ido_Out_OSAKA_NEW_Proc = False
                Exit Function
            End If
        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban     '棚番をセーブ
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
                      
            If Trim(Hinban_GO) <> "" Then       '2013.01.25
                ID_KANRI_TBL(ING_No).Hinban = Hinban_GO     '品番をセーブ
            End If
            
            
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する商品化済み数量
                                                            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
                                                            
                                                            
                                                            
                                                            '商品化用倉庫区分をセーブ
            ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
            Send_Text.FileName = ""                                 '送信データファイル名
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
'            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
'            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_DNAME)
                                                            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                    Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))

            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                    Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                             '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                           '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.04.07 出庫数を１行に変更
'
'            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                           '表示内容
            
            
            
            
            If ID_KANRI_TBL(ING_No).S_JGYOBU = BUZAI Then
                
                If SYUKO_QTY = 0 Then                               '2012.04.13
                    SYUKO_QTY = ID_KANRI_TBL(ING_No).KO_SHIJI_QTY   '2012.04.13
                End If                                              '2012.04.13
                
                
                If ID_KANRI_TBL(ING_No).Send_MI_QTY < SYUKO_QTY Then
                    wkQty = ID_KANRI_TBL(ING_No).Send_MI_QTY
                Else
                    wkQty = SYUKO_QTY
                End If
                ID_KANRI_TBL(ING_No).Send_MI_QTY = wkQty
                ID_KANRI_TBL(ING_No).Send_SUMI_QTY = 0
            Else
                
                If SYUKO_QTY = 0 Then                               '2012.04.13
                    SYUKO_QTY = ID_KANRI_TBL(ING_No).KO_SHIJI_QTY   '2012.04.13
                End If                                              '2012.04.13
                
                
                If ID_KANRI_TBL(ING_No).Send_SUMI_QTY < SYUKO_QTY Then
                    wkQty = ID_KANRI_TBL(ING_No).Send_SUMI_QTY
                Else
                    wkQty = SYUKO_QTY
                End If
                ID_KANRI_TBL(ING_No).Send_MI_QTY = 0
                ID_KANRI_TBL(ING_No).Send_SUMI_QTY = wkQty
            End If
            
            
            
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_OSAKA_IDO_OUT & Space(M_Keta - (Len(LCD_OSAKA_IDO_OUT) * 2) - 5 + (5 - Len(Format(wkQty, "#0")))) & Format(wkQty, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_OSAKA_IDO_OUT & Space(M_Keta - (Len(LCD_OSAKA_IDO_OUT) * 2) - 5 + (5 - Len(Format(wkQty, "#0")))) & Format(wkQty, "#0"))
                                                           '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(wkQty, "#0"))) & Format(wkQty, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(wkQty, "#0"))) & Format(wkQty, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"

            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                        '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.04.07 出庫数を１行に変更
        
        
            Sendbuf = Text_Create_Proc()
            Ido_Out_OSAKA_NEW_Proc = False
            Exit Function
        
        
        Case Step_Sagyo3_RES        '２回目の受信（商品／未商品数量）
            
            QTY = 0
            SUMI_QTY = 0
            MI_QTY = 0
            
            
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
                    Case LCD_OSAKA_IDO_OUT
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_NEW_Proc = False
                            Exit Function
                        End If

                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If QTY = 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_NEW_Proc = False
                            Exit Function
                        End If
               
                        If QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "数量オーバー", "数量入力ミス", Format(QTY, "#0"), Format(ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY, "#0"))
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1

                            Ido_Out_OSAKA_NEW_Proc = False
                            Exit Function
                        End If
              
                        ID_KANRI_TBL(ING_No).IDO_OUT_OSAKA_NEW_QTY = QTY
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        '数量付きの送信メッセージを作成する
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                                
                        '-----------------------------------------------１行目
                        Send_Text.FileName = ""                                 '送信データファイル名
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                                                                        
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                         '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                       '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
'
            '            '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                           '表示内容
            
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出庫数：" & QTY)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出庫数：" & QTY)
                                                            '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                       '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                    
                                                                    
                                                                    
                        If Zaiko_Syukei_Proc(SUMI_QTY, MI_QTY, ID_KANRI_TBL(ING_No).S_JGYOBU, ID_KANRI_TBL(ING_No).S_NAIGAI, ID_KANRI_TBL(ING_No).Hinban, , , , , IDO_OUT_ZAIKO_SOKO_F) Then
                                                                    
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        QTY = (SUMI_QTY + MI_QTY) - QTY
                                                                    
                                                                    '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "出庫後在庫:" & QTY)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "出庫後在庫:" & QTY)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                        Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
            
                    
                    
                        Sendbuf = Text_Create_Proc()
                        Ido_Out_OSAKA_NEW_Proc = False
                        Exit Function
                
                
                
                
                End Select
            
            
            
            
            
            
            
            
            Next i
            
            
            
            
            
            
            
            
            
            
        Case Step_Sagyo4_RES        '１回目の受信（指図票ａj
            
            
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
        
            
            
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
            If ID_KANRI_TBL(ING_No).S_JGYOBU = BUZAI Then
                MI_QTY = ID_KANRI_TBL(ING_No).IDO_OUT_OSAKA_NEW_QTY
                SUMI_QTY = 0
            Else
                MI_QTY = 0
                SUMI_QTY = ID_KANRI_TBL(ING_No).IDO_OUT_OSAKA_NEW_QTY
            End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2012.04.07 出庫数を１行に変更
            
            
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, (ID_KANRI_TBL(ING_No).SHIJI_No & " " & RTrim(ID_KANRI_TBL(ING_No).OYA_HINBAN) & " " & ID_KANRI_TBL(ING_No).ODR_QTY), MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Ido_Out_OSAKA_NEW_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_Out_OSAKA_NEW_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Ido_Out_OSAKA_NEW_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
    
            '------------------ 子品番の移動済み更新
            Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
            Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")

            Found_F = False
            com = BtOpGetGreater

            Do
                
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
                sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                Select Case sts
                    Case BtNoErr
                        If ID_KANRI_TBL(ING_No).SHIJI_No <> StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) Then
                            Exit Do
                        End If
                    
                        
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                        
                        If Fueikae_Read_Proc(Trim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)), Hinban_GO) Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                        
                        If Trim(Hinban_GO) = "" Then
                            Hinban_GO = StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)
                        End If
                        
                        If RTrim(ID_KANRI_TBL(ING_No).Hinban) = RTrim(Hinban_GO) Then
                        '>>>>>>>>>>>>>>>>>>>>>>>>振替検索   2012.12.27
                            
                            
                            QTY = Val(StrConv(P_SSHIJI_K_REC.HIKIATE_QTY, vbUnicode))                                   '2012.04.13
                            QTY = QTY - (SUMI_QTY + MI_QTY)                                                             '2012.04.13
                            If QTY < 0 Then
                                QTY = 0
                            End If
                            Call UniCode_Conv(P_SSHIJI_K_REC.HIKIATE_QTY, Format(QTY, "00000000.00"))                   '2012.04.13
                            
                            
                            
                            QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))                                  '2012.04.13
                            QTY = QTY + (SUMI_QTY + MI_QTY)                                                             '2012.04.13
                            Call UniCode_Conv(P_SSHIJI_K_REC.IDO_SUMI_QTY, Format(QTY, "00000000.00"))                  '2012.04.13
                            
                            If QTY >= ID_KANRI_TBL(ING_No).KO_SHIJI_QTY Then                                            '2012.04.13
                                Call UniCode_Conv(P_SSHIJI_K_REC.IDO_SUMI, "9")
                            End If                                                                                      '2012.04.13
                            
                            sts = BTRV(BtOpUpdate, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                        
                            Select Case sts
                                Case BtNoErr
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpUpdate, "指図票(子)", 0)
                                    Exit Function
                            End Select
                        
                        
                        
                        
                        End If
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "指図票(子)", 0)
                        Exit Function
                End Select
                
                com = BtOpGetNext
            
            Loop
    
    
    
    
    
    
    
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            
            'ラベル発行処理
            If LABEL_88_SendFile <> "" And _
                Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) <> "" Then
                
                
                FileName = LABEL_88_SendFile
                
                If Label_Print_File_Make_Proc(FileName, ID_KANRI_TBL(ING_No).Hinban, 0) Then
                End If
            
            
            
                'データ送信
                ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                            
                                            
                ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
            
                ID_KANRI_TBL(ING_No).LABEL_ON = True
            
                '-----------------------------------------------ヘッダー
            
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
            
                Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL
            
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
            
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
            
                Send_Text.FileName = FileName                           '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = FileName
            
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
            
                Sendbuf = Text_Create_Proc()
                Ido_Out_OSAKA_NEW_Proc = False
                
                Exit Function
            
            Else
                '出荷予定／在庫の予約解除
                sts = Data_Clear_Proc(0, Sendbuf)
                Select Case sts
                    Case SYS_CANCEL
                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                    
                    Case SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Exit Function
                End Select
                
                '-----------------------------------------------ヘッダー
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "09"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                    
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Sendbuf = Text_Create_Proc()
                Ido_Out_OSAKA_NEW_Proc = False
                Exit Function
            
            
            
            
            End If
                                        
                                        
                                        
        Case Step_PRINT_RES         '２回目の受信（印刷終了）
                                        
            '>>>>2012.03.29　品番入力へ
            '-----------------------------------------------ヘッダー
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
            '-----------------------------------------------１行目
                                                                    'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                    '表示内容
'2017.09.22
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                    '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                                    'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票:" & ID_KANRI_TBL(ING_No).SHIJI_No)
                                                                    '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                    '入力桁数
            Send_Text.Box_Type(1).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                                    'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Tanaban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Tanaban)
                                                                    '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(2).Max_Size = "09"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "09"
                                                                    
            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                                    'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                    '数値初期表示
            Send_Text.Box_Type(3).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                    '入力桁数
            Send_Text.Box_Type(3).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                    
                                                                    
                                                                    
            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------４行目
                                                                    'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                    '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                
                                                                    '数値初期表示
            Send_Text.Box_Type(4).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                    '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                    '入力桁数
             Send_Text.Box_Type(4).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                    
            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

            Sendbuf = Text_Create_Proc()
            Ido_Out_OSAKA_NEW_Proc = False
            Exit Function
            
            
            
            
                                        
                                        
                                        
    
    End Select

    Ido_Out_OSAKA_NEW_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function


Public Function Hin_Furikae_S_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ 部材ｾﾝﾀｰ品番振替指定時のチェック＆更新処理』
'
'           2012.03.13
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long

Dim BEF_QTY         As Long
Dim AFT_QTY         As Long



Dim i               As Integer

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8
Dim ST_TANABAN      As String * 8


Dim Hinban          As String * 20
Dim TO_Hinban       As String * 20


Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Hin_Furikae_S_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（振替前品番／振替後品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_BEF_Hinban         '振替前品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                        ST_TANABAN = StrConv(ITEMREC.ST_SOKO, vbUnicode) & _
                                        StrConv(ITEMREC.ST_RETU, vbUnicode) & _
                                        StrConv(ITEMREC.ST_REN, vbUnicode) & _
                                        StrConv(ITEMREC.ST_REN, vbUnicode)
        
                        ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN = Hinban
        
        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
        
        
        
                        ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
                        ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
        
        
                    Case LCD_AFT_Hinban         '振替後品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                        Call UniCode_Conv(K0_FURIKAE.JGYOBU_MAE, RET_JGYOBU)        '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.NAIGAI_MAE, RET_NAIGAI)        '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.HIN_MAE, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        
                        Call UniCode_Conv(K0_FURIKAE.JGYOBU_GO, RET_JGYOBU)         '2012.03.13
                        Call UniCode_Conv(K0_FURIKAE.NAIGAI_GO, RET_NAIGAI)         '2012.03.13
                        
                        
                        Call UniCode_Conv(K0_FURIKAE.HIN_GO, Hinban)
                        sts = BTRV(BtOpGetEqual, FURIKAE_POS, FURIKAEREC, Len(FURIKAEREC), K0_FURIKAE, Len(K0_FURIKAE), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, Hinban, "振替品番エラー", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品番振替Ｍ", 0)
                                Exit Function
                        End Select
                                        
                
                        
                                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select

                        ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN = Hinban

                        ID_KANRI_TBL(ING_No).CUT_SU = Val(StrConv(FURIKAEREC.CUT_SU, vbUnicode))


                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                                    
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
            
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            
            
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, _
                                        LCD_Tanaban & " " & Mid(ST_TANABAN, 1, 2) & "-" & Mid(ST_TANABAN, 3, 2) & "-" & Mid(ST_TANABAN, 5, 2) & "-" & Mid(ST_TANABAN, 7, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, _
                                        LCD_Tanaban & " " & Mid(ST_TANABAN, 1, 2) & "-" & Mid(ST_TANABAN, 3, 2) & "-" & Mid(ST_TANABAN, 5, 2) & "-" & Mid(ST_TANABAN, 7, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "12"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""            '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
            '
                    
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i

'-----------------------    2011.06.13
        Case Step_Sagyo2_RES        '２回目の受信（棚番）
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    Case LCD_Tanaban    '棚番
                        FROM_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 混載チェック
                        If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                            If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            End If
                        End If
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(FROM_Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(FROM_Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(FROM_Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(FROM_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), "棚番エラー", "", "")
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Hin_Furikae_S_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
        
        
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Hin_Furikae_S_Proc = False
                            
                            Exit Function
                        End If
        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                                    'FROM 棚番
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, ID_KANRI_TBL(ING_No).S_JGYOBU, ID_KANRI_TBL(ING_No).S_NAIGAI, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Hin_Furikae_S_Proc = False
                                Exit Function
                        End Select
                                
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Hin_Furikae_S_Proc = False
                            Exit Function
                        End If
                
                
        
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        ID_KANRI_TBL(ING_No).Tanaban = FROM_Tanaban         '棚番をセーブ
                                                                    
                                                                    
                                                                    
                        ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY       '送信する商品化済み数量
                        ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY           '送信する未商品数量
                                                                    
                                                                    
                                                                    '商品化用倉庫区分をセーブ
                        ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
                        '数量付きの送信メッセージを作成する
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                                    
                        '-----------------------------------------------１行目
                                                                        'BOX属性
    '                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    '                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
    '                                                                    '表示内容
    '                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    '                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
    '                                                                    '数値初期表示
    '                    Send_Text.Box_Type(0).INIT = ""
    '                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
    '
    '                                                                    '初期カーソル位置
    '                    Send_Text.Box_Type(0).Start_Pos = ""
    '                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
    '                                                                    '入力桁数
    '                    Send_Text.Box_Type(0).Max_Size = "00"
    '                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
    '                    Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
    '                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        
                        
                        
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, _
                                        Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, _
                                        Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_BEF_Su & Space(M_Keta - (Len(LCD_BEF_Su) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "#"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_BEF_Su & Space(M_Keta - (Len(LCD_Suryo) * 2) - 5 + (5 - Len(Format(0, "#")))) & Format(0, "#"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(0, "#"))) & Format(0, "#")
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            
            
            
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        Sendbuf = Text_Create_Proc()
                
                        Hin_Furikae_S_Proc = False
                        Exit Function
                
                End Select
            
            
            Next i
        
        
        Case Step_Sagyo3_RES        '３回目の受信（振替前数量）
            
            
            
            For i = 0 To M_Gyo - 1
            
                
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 5)
            
            
                    Case LCD_BEF_Su          '数量（振替前）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "振替前数量", "数量入力ミス", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_S_Proc = False
                            Exit Function
                        End If
                
                        BEF_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        If BEF_QTY = 0 Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "振替前数量", "数量入力ミス", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_S_Proc = False
                            Exit Function
                        End If
            
            
                        If BEF_QTY > ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "振替前数量", "数量入力ミス", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Furikae_S_Proc = False
                            Exit Function
                        End If
                
                        ID_KANRI_TBL(ING_No).BEF_QTY = BEF_QTY
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                                    
                        
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        
                        
                        
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, _
                                        Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, _
                                        Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_BEF_Su & Format(BEF_QTY, "#"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_BEF_Su & Format(BEF_QTY, "#"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            
            
            
                        '-----------------------------------------------５行目
                        AFT_QTY = BEF_QTY * ID_KANRI_TBL(ING_No).CUT_SU
                        ID_KANRI_TBL(ING_No).AFT_QTY = AFT_QTY
                                                                        
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_AFT_Su & Format(AFT_QTY, "#"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_AFT_Su & Format(AFT_QTY, "#"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        Sendbuf = Text_Create_Proc()
            
                        Hin_Furikae_S_Proc = False
                        Exit Function
            
            
                End Select
            
            
            Next i
            
            
        Case Step_Sagyo4_RES        '４回目の受信（ＥＮＴ）
            
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
            sts = Syuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, _
                                    "", _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    YOIN_BEF_HINBAN_S, _
                                    0, _
                                    ID_KANRI_TBL(ING_No).BEF_QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, Trim(ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN) & "へ振替", _
                                    , , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "-" & "01-01-01", ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Hin_Furikae_S_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Hin_Furikae_S_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Furikae_S_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
    
            sts = Nyuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).FURI_AFT_HINBAN, _
                                    Format(Now, "YYYYMMDD"), _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    YOIN_AFT_HINBAN_S, _
                                    0, _
                                    ID_KANRI_TBL(ING_No).AFT_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, Trim(ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN) & "より振替", , , , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "-" & "01-01-01", ID_KANRI_TBL(ING_No).FURI_BEF_HINBAN, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Hin_Furikae_S_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Hin_Furikae_S_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Furikae_S_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
    
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Hin_Furikae_S_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Public Function Ido_In_OSAKA_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ 部材ｾﾝﾀｰ移動入庫指定時のチェック＆更新処理』
'
'       2012.03.15
'-------------------------------------------------------
Dim sts             As Integer

Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long


Dim i               As Integer

Dim FROM_Tanaban    As String * 8
Dim TO_Tanaban      As String * 8
Dim ST_TANABAN      As String * 8


Dim Hinban          As String * 20

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1

Dim MENU_NO         As String * 2

    Ido_In_OSAKA_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI, , BUZAI)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Ido_In_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
        
                        '------------------ 在庫の使用予約を行い、有効在庫数を獲得する
                                                    'FROM 仮想棚番
                        FROM_Tanaban = ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"
                        sts = Zaiko_Reserve_Proc(ID_KANRI_TBL(ING_No).ID, FROM_Tanaban, RET_JGYOBU, RET_NAIGAI, Hinban, SUMI_QTY, MI_QTY)
                        Select Case sts
                            Case False
                            Case True           'ここでは発生しない
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
                                Call Err_Send_Proc("在庫使用中", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_In_OSAKA_Proc = False
                                Exit Function
                        End Select
                    
                        If (SUMI_QTY = 0) And (MI_QTY = 0) Then
                            Call Err_Send_Proc("有効在庫無し", Left(FROM_Tanaban, 2) & "-" & Mid(FROM_Tanaban, 3, 2) & "-" & Mid(FROM_Tanaban, 5, 2) & "-" & Right(FROM_Tanaban, 2), Hinban, "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Ido_In_OSAKA_Proc = False
                            Exit Function
                        End If
        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU
                        ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        
                        ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
                        ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                        
                        ST_TANABAN = StrConv(ITEMREC.ST_SOKO, vbUnicode) & StrConv(ITEMREC.ST_RETU, vbUnicode) & StrConv(ITEMREC.ST_REN, vbUnicode) & StrConv(ITEMREC.ST_DAN, vbUnicode)
                        
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, _
                                        LCD_Tanaban & " " & Mid(ST_TANABAN, 1, 2) & "-" & Mid(ST_TANABAN, 3, 2) & "-" & Mid(ST_TANABAN, 5, 2) & "-" & Mid(ST_TANABAN, 7, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, _
                                        LCD_Tanaban & " " & Mid(ST_TANABAN, 1, 2) & "-" & Mid(ST_TANABAN, 3, 2) & "-" & Mid(ST_TANABAN, 5, 2) & "-" & Mid(ST_TANABAN, 7, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "12"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        Ido_In_OSAKA_Proc = False
                        Exit Function
            
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（棚番）
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    Case LCD_Tanaban        '棚番
                        TO_Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        '------------------ 倉庫マスタ読込み
                        Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(TO_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2), "倉庫エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_In_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                Exit Function
                        End Select
                        '------------------ 混載チェック
                        If StrConv(SOKOREC.KONS_KBN, vbUnicode) = KONS_KBN_NG Then
                            If StrConv(SOKOREC.JGYOBU, vbUnicode) <> ID_KANRI_TBL(ING_No).JGYOBU Or _
                                StrConv(SOKOREC.NAIGAI, vbUnicode) <> ID_KANRI_TBL(ING_No).NAIGAI Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Recv_text(i), 2), "混載エラー", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Ido_In_OSAKA_Proc = False
                                Exit Function
                            End If
                        End If
                        '------------------ 棚マスタ読込み
                        Call UniCode_Conv(K0_TANA.SOKO_NO, Left(TO_Tanaban, 2))
                        Call UniCode_Conv(K0_TANA.Retu, Mid(TO_Tanaban, 3, 2))
                        Call UniCode_Conv(K0_TANA.Ren, Mid(TO_Tanaban, 5, 2))
                        Call UniCode_Conv(K0_TANA.Dan, Right(TO_Tanaban, 2))
                        sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
            
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚番エラー", "", "")
                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                                Ido_In_OSAKA_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                Exit Function
                        End Select
        
        
                        '------------------ 禁止棚のチェック
                        If StrConv(TANAREC.KAHI_KBN, vbUnicode) = KAHI_KBN_NG Then
'2017.09.22
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2), "棚使用不可", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        
                            Ido_In_OSAKA_Proc = False
                            Exit Function
                        End If
        
        
        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                
                        ID_KANRI_TBL(ING_No).Tanaban = TO_Tanaban       '棚番をセーブ
                                                                    '商品化用倉庫区分をセーブ
                        ID_KANRI_TBL(ING_No).GOODS_ON_F = StrConv(SOKOREC.GOODS_ON_F, vbUnicode)
                        '数量付きの送信メッセージを作成する
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                                    
                        '-----------------------------------------------１行目
                                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                        'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                        '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                            'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, _
                                        Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
            
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, _
                                        Left(TO_Tanaban, 2) & "-" & Mid(TO_Tanaban, 3, 2) & "-" & Mid(TO_Tanaban, 5, 2) & "-" & Right(TO_Tanaban, 2))
                                                                        '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "08"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "08"
                                                                                            
                        Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Suryo & ":" & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY + ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Suryo & ":" & Format(ID_KANRI_TBL(ING_No).Send_MI_QTY + ID_KANRI_TBL(ING_No).Send_SUMI_QTY, "#0"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
                        Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                    
                    
                        Sendbuf = Text_Create_Proc()
                        Ido_In_OSAKA_Proc = False
                        Exit Function
        
        
                End Select
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（ENT待ち）
            
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
        
        
            sts = IDO_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    ID_KANRI_TBL(ING_No).Hinban, _
                                    "", _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.PARAM & "01" & "01" & "01"), _
                                    ID_KANRI_TBL(ING_No).Tanaban, _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    0, _
                                    ID_KANRI_TBL(ING_No).Send_MI_QTY + ID_KANRI_TBL(ING_No).Send_SUMI_QTY, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, , MENU_NO)

    
    
            Select Case sts
                Case False
        
                Case True       '在庫不足時に発生
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(ID_KANRI_TBL(ING_No).Tanaban, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 3, 2) & "-" & Mid(ID_KANRI_TBL(ING_No).Tanaban, 5, 2) & "-" & Right(ID_KANRI_TBL(ING_No).Tanaban, 2), ID_KANRI_TBL(ING_No).Hinban, "在庫数不足", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
            
                    Ido_In_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Ido_In_OSAKA_Proc = False
                    GoTo Abort_Tran
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Ido_In_OSAKA_Proc = SYS_ERR    'システム異常発生
                    GoTo Abort_Tran
            End Select
    
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        
                                        
                            
            '出荷予定／在庫の予約解除
            sts = Data_Clear_Proc(0, Sendbuf)
            Select Case sts
                Case SYS_CANCEL
                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
            End Select
                                        
                                        
                                        '次の作業要求
            
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Ido_In_OSAKA_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function



Public Function KENPIN_OSAKA_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材ｾﾝﾀｰ検品処理』
'       2012.03.18
'
'-------------------------------------------------------
Dim sts             As Integer



Dim SHIJI_No        As String * 8


Dim MENU_NO         As String * 2

Dim ans             As String * 1

Dim i               As Integer



    KENPIN_OSAKA_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票ａj
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO      '指図票
    
    
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        
                        Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
                        
                        
                        sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "該当データなし", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KENPIN_OSAKA_PROC = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                        
                        
                
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KENPIN_OSAKA_PROC = False
                            Exit Function
                        End If
                                                
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KENPIN_OSAKA_PROC = False
                            Exit Function
                        End If
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = StrConv(P_SSHIJI_O_REC.JGYOBU, vbUnicode)
                        ID_KANRI_TBL(ING_No).S_NAIGAI = StrConv(P_SSHIJI_O_REC.NAIGAI, vbUnicode)
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票ａF" & SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票ａF" & SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SHIJI_END)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SHIJI_END)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                                                                                
                        Send_Text.Box_Type(4).INIT = ""                         '数値初期表示
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                
                        Send_Text.Box_Type(4).Start_Pos = "20"                  '初期カーソル位置
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "20"
                                                                                
                         Send_Text.Box_Type(4).Max_Size = "01"                  '入力桁数
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        KENPIN_OSAKA_PROC = False
                        Exit Function
                            
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（YES or No）
            For i = 0 To M_Gyo - 1
            
                Select Case RTrim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    Case LCD_CAN_ANS        'YES or No
                        ans = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        Select Case ans
                            Case "1"
                                
                                
                                '----------------------------------- データ更新処理開始 -----------
                                                                    
                                                                    'トランザクション開始
                                sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    Exit Function
                                End If
                                                                    
                                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                    MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                            
                                Else
                                            
                                    MENU_NO = ""
                                End If
                                
                                
                                
                                If KENPIN_OSAKA_Update_PROC(Sendbuf) Then
                                    
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                                End If
                                
                                
                                
                                                                    'トランザクション終了
                                sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpEndTransaction, "", 0)
                                    GoTo Abort_Tran
                                End If
                                
                                
                                
                                
                            Case "9"
                            Case Else
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ans, "(1 OR 9)", "を入力して下さい", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KENPIN_OSAKA_PROC = False
                                Exit Function
                        End Select
                         
                         
                         
                         
                End Select
            
            Next i
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select

            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
        
        
    End Select
        

    KENPIN_OSAKA_PROC = False
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Public Function KENPIN_OSAKA_Update_PROC(Sendbuf As String) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材ｾﾝﾀｰ検品更新処理』
'       2012.03.18
'
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim MENU_NO         As String * 2

Dim wkJgyobu        As String * 1

Dim SUMI_QTY        As Long         '2012.04.14
Dim MI_QTY          As Long         '2012.04.14


Dim SEQNO           As Integer      '2012.09.14


    KENPIN_OSAKA_Update_PROC = True


'-----------------------------------------------------------------------    指図票データ更新
    '指図票データ(ﾍｯﾀﾞｰ)処理
    Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
            
    Select Case sts
        Case BtNoErr
        
            
        Case Else
            Call File_Error(sts, BtOpGetEqual, "商品化指図票ﾃﾞｰﾀ(親)", 0)
            Exit Function
    End Select


    Call UniCode_Conv(K0_P_UKEHARAI.UKEHARAI_CODE, StrConv(P_SSHIJI_O_REC.UKEHARAI_CODE, vbUnicode))
    sts = BTRV(BtOpGetEqual, P_UKEHARAI_POS, P_UKEHARAIREC, Len(P_UKEHARAIREC), K0_P_UKEHARAI, Len(K0_P_UKEHARAI), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call UniCode_Conv(P_UKEHARAIREC.TORI_KBN, "0")
        Case Else
            Call File_Error(sts, BtOpGetEqual, "受払先マスタ", 0)
            Exit Function
    End Select
    Call UniCode_Conv(P_SSHIJI_O_REC.TORI_KBN, StrConv(P_UKEHARAIREC.TORI_KBN, vbUnicode))

    Call UniCode_Conv(P_SSHIJI_O_REC.KAN_F, P_KAN_ON)                   '完了ﾌﾗｸﾞ
    Call UniCode_Conv(P_SSHIJI_O_REC.KAN_DT, Format(Now, "YYYYMMDD"))   '完了日

    Call UniCode_Conv(P_SSHIJI_O_REC.BUNNOU_CNT, "00")                  '分納回数
                                                                            
    Call UniCode_Conv(P_SSHIJI_O_REC.S_TANTO, "")                       '収単／担当者ｸﾗｽ
                                                                        '受入数量
    Call UniCode_Conv(P_SSHIJI_O_REC.UKEIRE_QTY, StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))
                                                                        '更新日時
    Call UniCode_Conv(P_SSHIJI_O_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))

    sts = BTRV(BtOpUpdate, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
    Select Case sts
        Case BtNoErr
        Case Else
            Call File_Error(sts, BtOpUpdate, "商品化指図ﾃﾞｰﾀ(親)", 0)
            Exit Function
    End Select
'-----------------------------------------------------------------------    受入履歴ﾃﾞｰﾀ処理
        
        
        
        
    '受入履歴ﾃﾞｰﾀ処理               2012.09.14  ▽
    Call UniCode_Conv(K0_P_SUKEIRE.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    Call UniCode_Conv(K0_P_SUKEIRE.SEQNO, "")
    
    SEQNO = 0
    
    com = BtOpGetGreater
    
    Do
    
        sts = BTRV(com, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
            
        Select Case sts
            Case BtNoErr
            
                If StrConv(P_SUKEIRE_REC.SHIJI_No, vbUnicode) <> ID_KANRI_TBL(ING_No).SHIJI_No Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            
            Case Else
                Call File_Error(sts, BtOpUpdate, "商品化受入履歴", 0)
                Exit Function
        
        End Select
        
        
        
        SEQNO = SEQNO + 1
        
        
        com = BtOpGetNext
        
    Loop
    '                               2012.09.14　△
        
        
        
        
        
    Call UniCode_Conv(P_SUKEIRE_REC.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)    '指図票
                                                                                '仕向け先ｺｰﾄﾞ
    Call UniCode_Conv(P_SUKEIRE_REC.SHIMUKE_CODE, StrConv(P_SSHIJI_O_REC.SHIMUKE_CODE, vbUnicode))
                                                                                '受入日
    Call UniCode_Conv(P_SUKEIRE_REC.UKEIRE_DT, Format(Now, "YYYYMMDD"))
                                                                                '受入数量
    Call UniCode_Conv(P_SUKEIRE_REC.UKEIRE_QTY, StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))
    
                                            
    Call UniCode_Conv(P_SUKEIRE_REC.LAST_F, P_UKEIRE_END)
                                                                                '取引先
    Call UniCode_Conv(P_SUKEIRE_REC.TORI_CODE, StrConv(P_SSHIJI_O_REC.UKEHARAI_CODE, vbUnicode))
    '前1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(4).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(4).TIMES, "000.00")
        
    '前2
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(5).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(5).TIMES, "000.00")
        
    '前3
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(6).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(6).TIMES, "000.00")
    
    '作業1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(0).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(0).TIMES, "000.00")
        
    '作業2
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(1).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(1).TIMES, "000.00")
        
    '作業3
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(2).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(2).TIMES, "000.00")
        
    '後1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(7).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(7).TIMES, "000.00")
        
    '後2
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(8).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(8).TIMES, "000.00")
        
    '加工1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(9).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(9).TIMES, "000.00")
        
        
    Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_NAME, "")
    Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_TIMES, "000.00")
    
    Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_NAME, "")
    Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_TIMES, "000.00")
                                                
    Call UniCode_Conv(P_SUKEIRE_REC.BIKOU, "")                                  '備考
        
    Call UniCode_Conv(P_SUKEIRE_REC.FILLER, "")
                                                                                '更新日時
    Call UniCode_Conv(P_SUKEIRE_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))
                                                                                '追番
    Call UniCode_Conv(P_SUKEIRE_REC.SEQNO, "001")
            
    
    
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.09.14
'    sts = BTRV(BtOpInsert, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
'    Select Case sts
'        Case BtNoErr
'        Case BtErrDuplicates
'            sts = BTRV(BtOpUpdate, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
'            Select Case sts
'                Case BtNoErr
'                Case Else
'                    Call File_Error(sts, BtOpUpdate, "商品化受入履歴", 0)
'                    Exit Function
'            End Select
'        Case Else
'            Call File_Error(sts, BtOpInsert, "商品化受入履歴", 0)
'            Exit Function
'    End Select
 

    Do
            
        SEQNO = SEQNO + 1
                                                '追番
        Call UniCode_Conv(P_SUKEIRE_REC.SEQNO, Format(SEQNO, "000"))
            
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
            
        sts = BTRV(BtOpInsert, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrDuplicates
            
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                            
            Case Else
                Call File_Error(sts, BtOpInsert, "受入履歴", 0)
                Exit Function
        End Select
        
    Loop
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.09.14




'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26  更新順　変更
'-----------------------------------------------------------------------    発注検討：親部品注文データ更新
    If Trim(StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode)) <> "" Then
        Call UniCode_Conv(K6_ODR_ORDER.ORDER_NO, StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode))
        sts = BTRV(BtOpGetEqual, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
        Select Case sts
            Case BtNoErr
            Case BtErrKeyNotFound
                KENPIN_OSAKA_Update_PROC = False
                Exit Function
            Case Else
                Call File_Error(sts, BtOpGetEqual, "親品番　注文Ｆ", 0)
                KENPIN_OSAKA_Update_PROC = SYS_ERR
                Exit Function
        End Select
    
    
        
        Call UniCode_Conv(ODR_ORDER_REC.UPD_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
        Call UniCode_Conv(ODR_ORDER_REC.FIN_DT, Format(Now, "YYYYMMDD"))
    
        Call UniCode_Conv(ODR_ORDER_REC.UPD_DT, Format(Now, "YYYYMMDD"))
        Call UniCode_Conv(ODR_ORDER_REC.UPD_TM, Format(Now, "HHMMSS"))
        Call UniCode_Conv(ODR_ORDER_REC.UPD_PG, App.EXEName)
        
        sts = BTRV(BtOpUpdate, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
        Select Case sts
            Case BtNoErr
            Case BtErrKeyNotFound
            Case Else
                Call File_Error(sts, BtOpUpdate, "親品番　注文Ｆ", 0)
                KENPIN_OSAKA_Update_PROC = SYS_ERR
                Exit Function
        End Select
    End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26





'-----------------------------------------------------------------------    子部品出庫処理

    Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
    Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")


    com = BtOpGetGreater

    Do
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
        Select Case sts
            Case BtNoErr
                If StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) <> ID_KANRI_TBL(ING_No).SHIJI_No Then
                    Exit Do
                End If
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "指図票データ(子)", 0)
                KENPIN_OSAKA_Update_PROC = SYS_ERR
                Exit Function
        End Select
    
    
        If Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode)) = 9 Then
    
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
    
    
                                            '出庫更新
            If StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode) = SHIZAI Or _
                StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode) = BUZAI Then       '2013.01.30 部材を追加
                wkJgyobu = BUZAI
                MI_QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
                SUMI_QTY = 0
            Else
                wkJgyobu = StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode)
                SUMI_QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
                MI_QTY = 0
            End If
            
            
            
            

            
            
            
            sts = Syuko_Update_Proc(wkJgyobu, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode), _
                                    "", _
                                    KENPIN_OSAKA_SOKO_No & "01" & "01" & "01", _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, ID_KANRI_TBL(ING_No).SHIJI_No, , , , , , MENU_NO)
            
            
            
            Select Case sts
                Case False
                
                Case True       '在庫不足時に発生
                    '>>>>>>>>>>>    2013.02.02
                    
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, KENPIN_OSAKA_SOKO_No & "-01-01-01", RTrim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)), "在庫数不足", "")
                    'Sendbuf = Text_Create_Proc()
                    'ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    '
                    'Exit Function
                    GoTo NEXT_PROC
                    '>>>>>>>>>>>    2013.02.02
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                
                    Exit Function
                Case SYS_ERR
                    Sendbuf = Text_Create_Proc()
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    KENPIN_OSAKA_Update_PROC = SYS_ERR    'システム異常発生
                    
                    Exit Function
            End Select
        End If
    
NEXT_PROC:
    
        com = BtOpGetNext
    
    Loop


'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26  更新順　変更
'-----------------------------------------------------------------------    発注検討：親部品注文データ更新
'
'    Call UniCode_Conv(K6_ODR_ORDER.ORDER_NO, StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode))
'    sts = BTRV(BtOpGetEqual, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
'    Select Case sts
'        Case BtNoErr
'        Case BtErrKeyNotFound
'            KENPIN_OSAKA_Update_PROC = False
'            Exit Function
'        Case Else
'            Call File_Error(sts, BtOpGetEqual, "親品番　注文Ｆ", 0)
'            KENPIN_OSAKA_Update_PROC = SYS_ERR
'            Exit Function
'    End Select
'
'
'
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
'    Call UniCode_Conv(ODR_ORDER_REC.FIN_DT, Format(Now, "YYYYMMDD"))
'
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_DT, Format(Now, "YYYYMMDD"))
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_TM, Format(Now, "HHMMSS"))
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_PG, App.EXEName)
'
'    sts = BTRV(BtOpUpdate, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
'    Select Case sts
'        Case BtNoErr
'        Case BtErrKeyNotFound
'        Case Else
'            Call File_Error(sts, BtOpUpdate, "親品番　注文Ｆ", 0)
'            KENPIN_OSAKA_Update_PROC = SYS_ERR
'            Exit Function
'    End Select
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26  更新順　変更
    

    
    
    
    KENPIN_OSAKA_Update_PROC = False
    


End Function


Public Function KENPIN_OSAKA_NEW_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材ｾﾝﾀｰ検品処理』
'       2012.03.18
'
'-------------------------------------------------------
Dim sts             As Integer



Dim SHIJI_No        As String * 8


Dim MENU_NO         As String * 2

Dim ans             As String * 1

Dim i               As Integer



    KENPIN_OSAKA_NEW_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票ａj
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO      '指図票
    
    
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        
                        Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
                        
                        
                        sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "該当データなし", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KENPIN_OSAKA_NEW_PROC = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                        
                        
                
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KENPIN_OSAKA_NEW_PROC = False
                            Exit Function
                        End If
                                                
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KENPIN_OSAKA_NEW_PROC = False
                            Exit Function
                        End If
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = StrConv(P_SSHIJI_O_REC.JGYOBU, vbUnicode)
                        ID_KANRI_TBL(ING_No).S_NAIGAI = StrConv(P_SSHIJI_O_REC.NAIGAI, vbUnicode)
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票ａF" & SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票ａF" & SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SHIJI_END)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SHIJI_END)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                                                                                
                        Send_Text.Box_Type(4).INIT = ""                         '数値初期表示
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                
                        Send_Text.Box_Type(4).Start_Pos = "20"                  '初期カーソル位置
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "20"
                                                                                
                         Send_Text.Box_Type(4).Max_Size = "01"                  '入力桁数
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        KENPIN_OSAKA_NEW_PROC = False
                        Exit Function
                            
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（YES or No）
            For i = 0 To M_Gyo - 1
            
                Select Case RTrim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    Case LCD_CAN_ANS        'YES or No
                        ans = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        Select Case ans
                            Case "1"
                                
                                
                                '----------------------------------- データ更新処理開始 -----------
                                                                    
                                                                    'トランザクション開始
                                sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    Exit Function
                                End If
                                                                    
                                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                    MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                            
                                Else
                                            
                                    MENU_NO = ""
                                End If
                                
                                
                                
                                If KENPIN_OSAKA_Update_NEW_PROC(Sendbuf) Then
                                    
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                                End If
                                
                                
                                
                                                                    'トランザクション終了
                                sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpEndTransaction, "", 0)
                                    GoTo Abort_Tran
                                End If
                                
                                
                                
                                
                            Case "9"
                            Case Else
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ans, "(1 OR 9)", "を入力して下さい", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KENPIN_OSAKA_NEW_PROC = False
                                Exit Function
                        End Select
                         
                         
                         
                         
                End Select
            
            Next i
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select

            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
        
        
    End Select
        

    KENPIN_OSAKA_NEW_PROC = False
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Public Function KENPIN_OSAKA_Update_NEW_PROC(Sendbuf As String) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　部材ｾﾝﾀｰ検品更新処理』
'       2012.03.18
'
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim MENU_NO         As String * 2

Dim wkJgyobu        As String * 1

Dim SUMI_QTY        As Long         '2012.04.14
Dim MI_QTY          As Long         '2012.04.14


Dim SEQNO           As Integer      '2012.09.14


    KENPIN_OSAKA_Update_NEW_PROC = True


'-----------------------------------------------------------------------    指図票データ更新
    '指図票データ(ﾍｯﾀﾞｰ)処理
    Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
            
    Select Case sts
        Case BtNoErr
        
            
        Case Else
            Call File_Error(sts, BtOpGetEqual, "商品化指図票ﾃﾞｰﾀ(親)", 0)
            Exit Function
    End Select


    Call UniCode_Conv(K0_P_UKEHARAI.UKEHARAI_CODE, StrConv(P_SSHIJI_O_REC.UKEHARAI_CODE, vbUnicode))
    sts = BTRV(BtOpGetEqual, P_UKEHARAI_POS, P_UKEHARAIREC, Len(P_UKEHARAIREC), K0_P_UKEHARAI, Len(K0_P_UKEHARAI), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call UniCode_Conv(P_UKEHARAIREC.TORI_KBN, "0")
        Case Else
            Call File_Error(sts, BtOpGetEqual, "受払先マスタ", 0)
            Exit Function
    End Select
    Call UniCode_Conv(P_SSHIJI_O_REC.TORI_KBN, StrConv(P_UKEHARAIREC.TORI_KBN, vbUnicode))

    Call UniCode_Conv(P_SSHIJI_O_REC.KAN_F, P_KAN_ON)                   '完了ﾌﾗｸﾞ
    Call UniCode_Conv(P_SSHIJI_O_REC.KAN_DT, Format(Now, "YYYYMMDD"))   '完了日

    Call UniCode_Conv(P_SSHIJI_O_REC.BUNNOU_CNT, "00")                  '分納回数
                                                                            
    Call UniCode_Conv(P_SSHIJI_O_REC.S_TANTO, "")                       '収単／担当者ｸﾗｽ
                                                                        '受入数量
    Call UniCode_Conv(P_SSHIJI_O_REC.UKEIRE_QTY, StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))
                                                                        '更新日時
    Call UniCode_Conv(P_SSHIJI_O_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))

    sts = BTRV(BtOpUpdate, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
    Select Case sts
        Case BtNoErr
        Case Else
            Call File_Error(sts, BtOpUpdate, "商品化指図ﾃﾞｰﾀ(親)", 0)
            Exit Function
    End Select
'-----------------------------------------------------------------------    受入履歴ﾃﾞｰﾀ処理
        
        
        
        
    '受入履歴ﾃﾞｰﾀ処理               2012.09.14  ▽
    Call UniCode_Conv(K0_P_SUKEIRE.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    Call UniCode_Conv(K0_P_SUKEIRE.SEQNO, "")
    
    SEQNO = 0
    
    com = BtOpGetGreater
    
    Do
    
        sts = BTRV(com, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
            
        Select Case sts
            Case BtNoErr
            
                If StrConv(P_SUKEIRE_REC.SHIJI_No, vbUnicode) <> ID_KANRI_TBL(ING_No).SHIJI_No Then
                    Exit Do
                End If
            
            Case BtErrEOF
                Exit Do
            
            Case Else
                Call File_Error(sts, BtOpUpdate, "商品化受入履歴", 0)
                Exit Function
        
        End Select
        
        
        
        SEQNO = SEQNO + 1
        
        
        com = BtOpGetNext
        
    Loop
    '                               2012.09.14　△
        
        
        
        
        
    Call UniCode_Conv(P_SUKEIRE_REC.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)    '指図票
                                                                                '仕向け先ｺｰﾄﾞ
    Call UniCode_Conv(P_SUKEIRE_REC.SHIMUKE_CODE, StrConv(P_SSHIJI_O_REC.SHIMUKE_CODE, vbUnicode))
                                                                                '受入日
    Call UniCode_Conv(P_SUKEIRE_REC.UKEIRE_DT, Format(Now, "YYYYMMDD"))
                                                                                '受入数量
    Call UniCode_Conv(P_SUKEIRE_REC.UKEIRE_QTY, StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))
    
                                            
    Call UniCode_Conv(P_SUKEIRE_REC.LAST_F, P_UKEIRE_END)
                                                                                '取引先
    Call UniCode_Conv(P_SUKEIRE_REC.TORI_CODE, StrConv(P_SSHIJI_O_REC.UKEHARAI_CODE, vbUnicode))
    '前1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(4).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(4).TIMES, "000.00")
        
    '前2
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(5).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(5).TIMES, "000.00")
        
    '前3
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(6).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(6).TIMES, "000.00")
    
    '作業1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(0).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(0).TIMES, "000.00")
        
    '作業2
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(1).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(1).TIMES, "000.00")
        
    '作業3
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(2).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(2).TIMES, "000.00")
        
    '後1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(7).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(7).TIMES, "000.00")
        
    '後2
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(8).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(8).TIMES, "000.00")
        
    '加工1
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(9).NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(9).TIMES, "000.00")
        
        
    Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_NAME, "")
    Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_TIMES, "000.00")
    
    Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_NAME, "")
    Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_NIN, "0.0")
    Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_TIMES, "000.00")
                                                
    Call UniCode_Conv(P_SUKEIRE_REC.BIKOU, "")                                  '備考
        
    Call UniCode_Conv(P_SUKEIRE_REC.FILLER, "")
                                                                                '更新日時
    Call UniCode_Conv(P_SUKEIRE_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))
                                                                                '追番
    Call UniCode_Conv(P_SUKEIRE_REC.SEQNO, "001")
            
    
    
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.09.14
'    sts = BTRV(BtOpInsert, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
'    Select Case sts
'        Case BtNoErr
'        Case BtErrDuplicates
'            sts = BTRV(BtOpUpdate, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
'            Select Case sts
'                Case BtNoErr
'                Case Else
'                    Call File_Error(sts, BtOpUpdate, "商品化受入履歴", 0)
'                    Exit Function
'            End Select
'        Case Else
'            Call File_Error(sts, BtOpInsert, "商品化受入履歴", 0)
'            Exit Function
'    End Select
 

    Do
            
        SEQNO = SEQNO + 1
                                                '追番
        Call UniCode_Conv(P_SUKEIRE_REC.SEQNO, Format(SEQNO, "000"))
            
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
            
        sts = BTRV(BtOpInsert, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
        Select Case sts
            Case BtNoErr
                Exit Do
            Case BtErrDuplicates
            
            Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                            
            Case Else
                Call File_Error(sts, BtOpInsert, "受入履歴", 0)
                Exit Function
        End Select
        
    Loop
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>  2012.09.14




'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26  更新順　変更
'-----------------------------------------------------------------------    発注検討：親部品注文データ更新
    If Trim(StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode)) <> "" Then
        Call UniCode_Conv(K6_ODR_ORDER.ORDER_NO, StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode))
        sts = BTRV(BtOpGetEqual, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
        Select Case sts
            Case BtNoErr
            Case BtErrKeyNotFound
                KENPIN_OSAKA_Update_NEW_PROC = False
                Exit Function
            Case Else
                Call File_Error(sts, BtOpGetEqual, "親品番　注文Ｆ", 0)
                KENPIN_OSAKA_Update_NEW_PROC = SYS_ERR
                Exit Function
        End Select
    
    
        
        Call UniCode_Conv(ODR_ORDER_REC.UPD_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
        Call UniCode_Conv(ODR_ORDER_REC.FIN_DT, Format(Now, "YYYYMMDD"))
    
        Call UniCode_Conv(ODR_ORDER_REC.UPD_DT, Format(Now, "YYYYMMDD"))
        Call UniCode_Conv(ODR_ORDER_REC.UPD_TM, Format(Now, "HHMMSS"))
        Call UniCode_Conv(ODR_ORDER_REC.UPD_PG, App.EXEName)
        
        sts = BTRV(BtOpUpdate, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
        Select Case sts
            Case BtNoErr
            Case BtErrKeyNotFound
            Case Else
                Call File_Error(sts, BtOpUpdate, "親品番　注文Ｆ", 0)
                KENPIN_OSAKA_Update_NEW_PROC = SYS_ERR
                Exit Function
        End Select
    End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26





'-----------------------------------------------------------------------    子部品出庫処理

    Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
    Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")


    com = BtOpGetGreater

    Do
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
        Select Case sts
            Case BtNoErr
                If StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) <> ID_KANRI_TBL(ING_No).SHIJI_No Then
                    Exit Do
                End If
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, BtOpGetEqual + BtSNoWait, "指図票データ(子)", 0)
                KENPIN_OSAKA_Update_NEW_PROC = SYS_ERR
                Exit Function
        End Select
    
    
        If Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode)) = 9 Then
    
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
    
    
'                                            '出庫更新
'            If StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode) = SHIZAI Or _
'                StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode) = BUZAI Then       '2013.01.30 部材を追加
'                wkJgyobu = BUZAI
'                MI_QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
'                SUMI_QTY = 0
'            Else
'                wkJgyobu = StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode)
'                SUMI_QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
'                MI_QTY = 0
'            End If
            
            
            If StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode) = SHIZAI Then
                wkJgyobu = SHIZAI
                MI_QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
                SUMI_QTY = 0
            Else
                wkJgyobu = StrConv(P_SSHIJI_K_REC.KO_JGYOBU, vbUnicode)
                SUMI_QTY = Val(StrConv(P_SSHIJI_K_REC.IDO_SUMI_QTY, vbUnicode))
                MI_QTY = 0
            End If
'>>>>>>>>>>>>>>>>   2016.05.20
            
            

            
            
            
            sts = Syuko_Update_Proc(wkJgyobu, _
                                    ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                    StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode), _
                                    "", _
                                    KENPIN_OSAKA_SOKO_No & "01" & "01" & "01", _
                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                    SUMI_QTY, _
                                    MI_QTY, _
                                    0, _
                                    Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                    ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                    FILE_RETRY, ID_KANRI_TBL(ING_No).SHIJI_No, , , , , , MENU_NO)
            
            
            
            Select Case sts
                Case False
                
                Case True       '在庫不足時に発生
                    '>>>>>>>>>>>    2013.02.02
                    
                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, KENPIN_OSAKA_SOKO_No & "-01-01-01", RTrim(StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)), "在庫数不足", "")
                    'Sendbuf = Text_Create_Proc()
                    'ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    '
                    'Exit Function
                    GoTo NEXT_PROC
                    '>>>>>>>>>>>    2013.02.02
                Case SYS_CANCEL
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    
                
                    Exit Function
                Case SYS_ERR
                    Sendbuf = Text_Create_Proc()
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    KENPIN_OSAKA_Update_NEW_PROC = SYS_ERR    'システム異常発生
                    
                    Exit Function
            End Select
        End If
    
NEXT_PROC:
    
        com = BtOpGetNext
    
    Loop


'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26  更新順　変更
'-----------------------------------------------------------------------    発注検討：親部品注文データ更新
'
'    Call UniCode_Conv(K6_ODR_ORDER.ORDER_NO, StrConv(P_SSHIJI_O_REC.ORDER_DT, vbUnicode) & StrConv(P_SSHIJI_O_REC.ORDER_DT_SEQ, vbUnicode))
'    sts = BTRV(BtOpGetEqual, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
'    Select Case sts
'        Case BtNoErr
'        Case BtErrKeyNotFound
'            KENPIN_OSAKA_Update_PROC = False
'            Exit Function
'        Case Else
'            Call File_Error(sts, BtOpGetEqual, "親品番　注文Ｆ", 0)
'            KENPIN_OSAKA_Update_PROC = SYS_ERR
'            Exit Function
'    End Select
'
'
'
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
'    Call UniCode_Conv(ODR_ORDER_REC.FIN_DT, Format(Now, "YYYYMMDD"))
'
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_DT, Format(Now, "YYYYMMDD"))
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_TM, Format(Now, "HHMMSS"))
'    Call UniCode_Conv(ODR_ORDER_REC.UPD_PG, App.EXEName)
'
'    sts = BTRV(BtOpUpdate, ODR_ORDER_POS, ODR_ORDER_REC, Len(ODR_ORDER_REC), K6_ODR_ORDER, Len(K6_ODR_ORDER), 6)
'    Select Case sts
'        Case BtNoErr
'        Case BtErrKeyNotFound
'        Case Else
'            Call File_Error(sts, BtOpUpdate, "親品番　注文Ｆ", 0)
'            KENPIN_OSAKA_Update_PROC = SYS_ERR
'            Exit Function
'    End Select
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2012.12.26  更新順　変更
    

    
    
    
    KENPIN_OSAKA_Update_NEW_PROC = False
    


End Function

Public Function Fueikae_Read_Proc(Hinban As String, Hinban_GO As String) As Integer
'-------------------------------------------------------
'
'   『品番振替ﾏｽﾀ読込み』
'       2012.12.27
'
'-------------------------------------------------------
Dim wkVal1  As Integer
Dim wkVal2  As Integer
    
Dim sts     As Integer
Dim com     As Integer
    
    Fueikae_Read_Proc = True

        



    Hinban_GO = ""

    Call UniCode_Conv(K0_FURIKAE.JGYOBU_MAE, BUZAI)
    Call UniCode_Conv(K0_FURIKAE.NAIGAI_MAE, NAIGAI_NAI)
    Call UniCode_Conv(K0_FURIKAE.HIN_MAE, Hinban)

    Call UniCode_Conv(K0_FURIKAE.JGYOBU_GO, "")
    Call UniCode_Conv(K0_FURIKAE.NAIGAI_GO, "")
    Call UniCode_Conv(K0_FURIKAE.HIN_GO, "")

    com = BtOpGetGreaterEqual
    
    Do
'        DoEvents
        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
            DoEvents                                                    '2016.01.26
        End If                                                          '2016.01.26
        sts = BTRV(com, FURIKAE_POS, FURIKAEREC, Len(FURIKAEREC), K0_FURIKAE, Len(K0_FURIKAE), 0)
        Select Case sts
            Case BtNoErr
                If BUZAI <> StrConv(FURIKAEREC.JGYOBU_MAE, vbUnicode) Or _
                    NAIGAI_NAI <> StrConv(FURIKAEREC.NAIGAI_MAE, vbUnicode) Or _
                    Trim(Hinban) <> Trim(StrConv(FURIKAEREC.HIN_MAE, vbUnicode)) Then
                    Exit Do
                End If
                '>>>>>>>>>>>    2013.02.04
                If Val(StrConv(FURIKAEREC.CUT_SU, vbUnicode)) = 0 Then
                    Fueikae_Read_Proc = False
                    Exit Function
                End If
                '>>>>>>>>>>>    2013.02.04
                
                wkVal1 = ToRoundDown(CCur(Val(StrConv(FURIKAEREC.MOTO_LEN, vbUnicode)) * Val(StrConv(P_SSHIJI_K_REC.KO_QTY, vbUnicode))), 0)
                
                
                If wkVal1 = ToRoundDown(CCur(Val(StrConv(FURIKAEREC.MOTO_LEN, vbUnicode)) / Val(StrConv(FURIKAEREC.CUT_SU, vbUnicode))), 0) Then
                    Hinban_GO = StrConv(FURIKAEREC.HIN_GO, vbUnicode)
                    Exit Do
                End If
            Case BtErrEOF
                Exit Do
            Case Else
                Call File_Error(sts, BtOpGetEqual, "品番振替", 0)
                Fueikae_Read_Proc = SYS_ERR
                Exit Function
        End Select
    
        com = BtOpGetNext
    Loop

    Fueikae_Read_Proc = False
End Function

Public Function SEK_PACKING_ALL_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス　邸別梱包処理』
'
'   2011.04.25
'               2011.07.20 品番毎の集約を廃止
'
'               全数検品対応    2012.03.21
'-------------------------------------------------------
Dim sts         As Integer
Dim com         As Integer

Dim i           As Integer
Dim j           As Integer

Dim k           As Integer      '2011.06.27
Dim l           As Integer      '2011.06.27




Dim Hinban      As String * 20

Dim ID_NO       As String * 13
Dim Found_Flg   As Integer
Dim JUC_SUU     As Long
Dim HINB_CD_CNT As Long



Dim RET_JGYOBU  As String * 1
Dim RET_NAIGAI  As String * 1
    

Dim MENU_NO     As String * 2

Dim IN_WORD     As String * 30
Dim OUT_WORD    As String * 16


Dim SAI_SU      As Double

Dim Cnt_F       As Boolean


    SEK_PACKING_ALL_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SEK_ID_NO      '指図ＩＤ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        sts = Y_SYUKA_TEI_Check_Proc(ID_NO, Found_Flg)
                        Select Case sts
                            Case BtNoErr          '正常
                
                                '------------------ 梱包済みのチェック
                                If Not Found_Flg Then
                                    
                                    If ID_KANRI_TBL(ING_No).SEK_SAI_SU = 0 Then
                                        
                                        
                                        ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_NO
                                        
                                        '才数入力
                                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                                        
                                        '-----------------------------------------------ヘッダー
                                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                                
                                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                                
                                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                                
                                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                                
                                        Send_Text.FileName = ""                                 '送信データファイル名
                                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                                
                                        Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                                        
                                        '-----------------------------------------------１行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(0).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(0).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(0).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                        
                                        '-----------------------------------------------２行目
                                        IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                                        Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                                                
                                                                                                'BOX属性
                                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(1).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(1).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                                '入力桁数
                                        Send_Text.Box_Type(1).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                        
                                        '-----------------------------------------------３行目
                                                                                                'BOX属性
                                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                                '表示内容
                                        
                                        '品番状態のカウント
                                        Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                                        
                                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                                                '数値初期表示
                                        Send_Text.Box_Type(2).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                                '初期カーソル位置
                                        Send_Text.Box_Type(2).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                                
                                        Send_Text.Box_Type(2).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                                
                                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                        '-----------------------------------------------４行目
                                                                                                'BOX属性
                                                
                                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(3).INIT = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(3).Start_Pos = ""
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                                        Send_Text.Box_Type(3).Max_Size = "00"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                
                                        '-----------------------------------------------５行目
                                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                        '表示内容
                                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                                        '数値初期表示
                                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                                        '初期カーソル位置
                                        Send_Text.Box_Type(4).Start_Pos = "12"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                                '入力桁数
                                        Send_Text.Box_Type(4).Max_Size = "05"
                                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                        Sendbuf = Text_Create_Proc()
                                    
                                        SEK_PACKING_ALL_Proc = False
                                        Exit Function
                                    
                                    Else
'2017.09.22
                                    
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "全数梱包済みです", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_ALL_Proc = False
                                        Exit Function
                                
                                    End If
                                End If
                            Case BtErrEOF
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "注文ﾃﾞｰﾀなし", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_ALL_Proc = False
                                Exit Function
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                
                        ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_NO
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                        Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                        
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                        
                        
                        
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        
                        '品番状態のカウント
                        Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                        
                        
                        
                        
                        
                        
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（品番）
            Cnt_F = False
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2)
                    
                    Case LCD_Hinban, " 数", "*数"   '品番/数量
                        
                        If Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = " 数" Or _
                            Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 2) = "*数" Then
                        
                            Cnt_F = True
                        End If
                        
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                    
                            Case BtErrKeyNotFound
                            '   -------------------------------- エラーメッセージ作成
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_ALL_Proc = False
                                Exit Function
                        
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                
                        End Select
                        '該当品番有無のﾁｪｯｸ
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) Then
                                Exit For
                            End If
                        Next j
                        
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "品番エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            Exit Function
                        End If
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_TBL)
                            If Trim(Hinban) = Trim(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_HINB_CD) Then
                                If Not ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F Then
                                    ID_KANRI_TBL(ING_No).SEK_LINE = j
                                    Exit For
                                End If
                            End If
                        Next j
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_TBL) Then
                    
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            Exit Function
                        End If
                        
                        For k = 0 To UBound(ID_KANRI_TBL)
                            If k = ING_No Then
                            Else
                                If ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE = _
                                    ID_KANRI_TBL(k).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(k).Sagyo_Code.YOIN_CODE Then
                                                            
                                    If ID_KANRI_TBL(ING_No).SEK_TEI_LABELID = ID_KANRI_TBL(k).SEK_TEI_LABELID Then
                                        
                                        
                                        If ID_KANRI_TBL(k).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_KONPO_F Then
'2017.09.22
                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, "梱包済み！", "")
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                            SEK_PACKING_ALL_Proc = False
                                            Exit Function
                                        End If
                                    End If
                                End If
                            End If
                        Next k
                        
                                                
                        '---------------------  品番仕掛中　チェック    2012.04.05
                        If Cnt_F Then
                            If RTrim(ID_KANRI_TBL(ING_No).KEN_HINBAN) <> RTrim(Hinban) Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, Hinban, ID_KANRI_TBL(ING_No).KEN_HINBAN, "品番エラー")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_ALL_Proc = False
                                Exit Function
                            End If
                        End If
                        '---------------------  品番仕掛中　チェック    2012.04.05
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).KEN_HINBAN = Hinban
                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 0 Then
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = Val(StrConv(ITEMREC.GAISO_IRI_QTY, vbUnicode))
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 0 Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 1
                            End If
                        
                            
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_Y_HIN_CHK_CNT = CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU / ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY), 0)) + _
                                                                                (ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU - _
                                                                                ((CLng(ToRoundDown(CCur(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU / ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY), 0)))) * ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY)
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY = 1 Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU
                            Else
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY = CLng(ToRoundUp(CCur(ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU Mod ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY), 0))
                            End If
                            
                            
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = 0
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = 0
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT + 1
                        
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = 1
                            Else
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY
                            End If
                        End If
                        
                        If Cnt_F Then
                        
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT + 1
                        
                        
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU < ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_BARA_QTY Then
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU = ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + 1
                            Else
                                ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_GAISO_IRI_QTY
                            End If
                        
                        
                        End If
                        
                        If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_J_HIN_CHK_CNT >= ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_Y_HIN_CHK_CNT Then
                            
'------------------------------------------ 全数検品終了　----------------------------------------------------------
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_KONPO_F = True
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                            
                            Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'2017.09.22
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    
                            IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                            Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_DATA_CNT = 1 Then
    
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                                                                    
                            Else
                            
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                            
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            
                            
                            '>>>>>>>>>>>>>>>    2012.06.21
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU > 1 Then

                                '2012.09.27
'                               If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).KEN_DEN_TBL(j).CNT_HAKO_SU > 1 Then
                                If ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU > 1 Then
                                    Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　標準
                                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE


                                '2012.09.27
                                Else
                                End If
                            End If
                            '>>>>>>>>>>>>>>>    2012.06.21
                            
                            
                            Sendbuf = Text_Create_Proc()
                        
                            SEK_PACKING_ALL_Proc = False
                            
                            Exit Function
                        
                        
                        Else
                        
                        
                        
                        
                        
'------------------------------------------ 全数検品仕掛中　----------------------------------------------------------
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                            
                            Send_Text.buzzer = Buzzer_DEF                       'ブザー音　標準
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'2017.09.22
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                                    "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            
                            '-----------------------------------------------３行目
                                                                                    
                            IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                            Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).KEN_HINBAN)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                                                                                    
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            If ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_DATA_CNT = 1 Then
    
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su1 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                                                                    
                            Else
                            
                                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SEK_Su2 & (ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_BARA_SU + ID_KANRI_TBL(ING_No).SEK_TBL(j).CNT_HAKO_SU) & "/" & ID_KANRI_TBL(ING_No).SEK_TBL(j).SEK_JUC_SUU)
                            
                            
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "01"
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                            Sendbuf = Text_Create_Proc()
                        
                            SEK_PACKING_ALL_Proc = False
                            
                            Exit Function
                        
                        End If
                
                End Select
            
            Next i
        
        
        Case Step_Sagyo3_RES        '３回目の受信（Any Key）
    
    
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                            
                        
            '------------------------------------   注文ﾃﾞｰﾀの処理
            
            com = BtOpGetGreaterEqual
            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
            
            Do
                
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
            
                Do
                
                    sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrEOF
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            GoTo Abort_Tran
                        Case Else
                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
            
                Loop
            
                
                If sts = BtErrEOF Then
                    Exit Do
                End If
                
                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                    Exit Do
                End If
                
                If Trim(StrConv(Y_SYU_TEI_REC.HINB_CD, vbUnicode)) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) And _
                    StrConv(Y_SYU_TEI_REC.SEQ_NO, vbUnicode) = ID_KANRI_TBL(ING_No).SEK_TBL(ID_KANRI_TBL(ING_No).SEK_LINE).SEK_SEQ_NO Then
                
                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
                    Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                    Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
                    Do
'                        DoEvents
                        If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                            DoEvents                                                    '2016.01.26
                        End If                                                          '2016.01.26
                        sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                        Select Case sts
                            Case BtNoErr
                                Exit Do
                            Case BtErrKeyNotFound
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_ALL_Proc = False
                                GoTo Abort_Tran
                             Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                SEK_PACKING_ALL_Proc = False
                                GoTo Abort_Tran
                            Case Else
                                Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                GoTo Abort_Tran
                        End Select
                    Loop
                
                End If
                
                com = BtOpGetNext
                
                
            Loop
                                            
            '------------------------------------   在庫移動履歴の処理
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                MENU_NO = ""
            End If
                                            
                                            
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).KEN_HINBAN, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        ID_KANRI_TBL(ING_No).SEK_SYU_JUN & " " & Trim(ID_KANRI_TBL(ING_No).SEK_TEI_NM), _
                                        , , , , MENU_NO, _
                                        , _
                                        "", _
                                        , , , , 1, , , , , , , ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    SEK_PACKING_ALL_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select
            
            '------------------------------------   作業ログの処理
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     ID_KANRI_TBL(ING_No).KEN_HINBAN, , , , , _
                                                     ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                    SEK_PACKING_ALL_Proc = SYS_ERR
                    Exit Function
                End If
            End If
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                    
            '品番状態のカウント
            Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
    
            If HINB_CD_CNT <> ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT Then
            '次　品番
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                
                
                
                
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        
                                                                        
                IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                        
                                                                        
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                
                
                
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                        '表示内容
                
                '品番状態のカウント
                Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                
                
                
                
                
                
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_Suryo)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_Suryo)
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                Sendbuf = Text_Create_Proc()
            
            Else
            '梱包完了
            
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                
                '-----------------------------------------------３行目
                IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                        
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                '-----------------------------------------------４行目
                                                                        'BOX属性
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "検品完了" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "検品完了" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                                                                        
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性
                Send_Text.Box_Type(4).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "→ENT")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "→ENT")
                                                                        '数値初期表示
                Send_Text.Box_Type(4).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
                 Send_Text.Box_Type(4).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                Sendbuf = Text_Create_Proc()
            End If
    
    
        Case Step_Sagyo4_RES        '４回目の受信（Any Key）
            
            
            
            If ID_KANRI_TBL(ING_No).SEK_SAI_SU = 0 Then
                '才数入力
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                
                '-----------------------------------------------ヘッダー
                Send_Text.sts = Sts_OK                                  'ステータス　OK
                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
        
                Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
        
                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
        
                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
        
                Send_Text.FileName = ""                                 '送信データファイル名
                ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
        
                Send_Text.buzzer = Buzzer_DOUBLE                    'ブザー音　二重警告音
                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, Left(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID, 7) & "    " & _
                                        "(" & Format(Val(Right(Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID), 2)), "#0") & "/" & Format(ID_KANRI_TBL(ING_No).SEK_HAKO_SU, "#0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                
                '-----------------------------------------------２行目
                IN_WORD = ID_KANRI_TBL(ING_No).SEK_TEI_NM
                Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                                                                        
                                                                        'BOX属性
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_SYU_JUN) & " " & OUT_WORD)
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                
                '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                
                '品番状態のカウント
                Call SEK_HINB_CD_CNT_Proc(HINB_CD_CNT)
                
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "才数入力" & "(" & Format(HINB_CD_CNT, "#0/") & Format(ID_KANRI_TBL(ING_No).SEK_HINB_CD_CNT, "#0)"))
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                                                                        'BOX属性
                        
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & " 1")
                                                                '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                        
                '-----------------------------------------------５行目
                Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                '数値初期表示
                Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                '初期カーソル位置
                Send_Text.Box_Type(4).Start_Pos = "12"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                        '入力桁数
                Send_Text.Box_Type(4).Max_Size = "05"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                Sendbuf = Text_Create_Proc()
            
            Else
            '次の作業要求
                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                Select Case sts
                    Case BtNoErr
                    '   -------------------------------- エラーメッセージ作成
                    Case Else
                    '重要な要因なので未登録はシステム停止とする
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                        Exit Function
                End Select
                
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                
                If Sagyo_Send_Proc() Then
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                End If
            
                Sendbuf = Text_Create_Proc()
    
            End If
    
    
        Case Step_Sagyo5_RES        '５回目の受信（才数）
    
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '才数
                    Case LCD_SAI_SU_S
                
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            Exit Function
                        
                        End If
                
                        SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                
                
                        If SAI_SU = 0 Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SEK_PACKING_ALL_Proc = False
                            Exit Function
                        
                        End If
                
                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                        '------------------------------------   注文ﾃﾞｰﾀの処理
                        Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_TEI_LABELID)
                        com = BtOpGetGreaterEqual
            
                        Do
                    
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                
                            Do
                    
                                sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrEOF
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_ALL_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                
                            Loop
            
                
                            If sts = BtErrEOF Then
                                Exit Do
                            End If
                    
                            If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_TEI_LABELID) Then
                                Exit Do
                            End If
                        
                
                            Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, "0001")
                            Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(SAI_SU, "000.00"))
                        
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                            Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                        
                        
                
                            Do
'                                DoEvents
                                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                    DoEvents                                                    '2016.01.26
                                End If                                                          '2016.01.26
                                sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_ALL_Proc = False
                                        GoTo Abort_Tran
                                     Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        SEK_PACKING_ALL_Proc = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                
                
                            com = BtOpGetNext
                
                
                        Loop
                                'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
    
                        '次の作業要求
                        Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                        Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                        sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                        Select Case sts
                            Case BtNoErr
                            '   -------------------------------- エラーメッセージ作成
                            Case Else
                            '重要な要因なので未登録はシステム停止とする
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                Exit Function
                        End Select
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                        
                        If Sagyo_Send_Proc() Then
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        End If
                    
                        Sendbuf = Text_Create_Proc()
                    
                End Select
            Next i
    End Select

    SEK_PACKING_ALL_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If









    SEK_PACKING_ALL_Proc = False

End Function



Public Function Print_Cancel_Proc() As Integer
'-------------------------------------------------------
'
'   『ラベル印刷時の途中キャンセル』
'
'   2013.04.05
'-------------------------------------------------------
Dim sts     As Integer
Dim k       As Integer
    
    Print_Cancel_Proc = True
    
    For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then
            
            
            ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT - 1
            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU = 0 And _
                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU <= ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).BARA_QTY Then
                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU - 1
            Else
                ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU - ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY
            End If
            
            Exit For
        
        End If
    Next k

    '----------------------------------- トランザクション開始 -----------
    sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
        Exit Function
    End If



    For k = 0 To UBound(ID_KANRI_TBL(ING_No).KEN_DEN_TBL)
                        
        Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).SEQ_NO, "00"))
        Do
            sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
            Select Case sts
                Case BtNoErr
                    Exit Do
                Case BtErrKeyNotFound
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                    Print_Cancel_Proc = False
                    GoTo Abort_Tran
                Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                    Print_Cancel_Proc = False
                    GoTo Abort_Tran
                Case Else
                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(H)", 0)
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    GoTo Abort_Tran
                End Select
                        
        Loop
                            
        If Trim(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).HIN_NO) = Trim(ID_KANRI_TBL(ING_No).KEN_HINBAN) Then

            Call UniCode_Conv(Y_SYU_HREC.CNT_BARA_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_BARA_SU, "0"))
            Call UniCode_Conv(Y_SYU_HREC.CNT_HAKO_SU, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).CNT_HAKO_SU, "0"))
    
            Call UniCode_Conv(Y_SYU_HREC.GAISO_IRI_QTY, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).GAISO_IRI_QTY, "0"))
    
            Call UniCode_Conv(Y_SYU_HREC.Y_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT, "0"))
            Call UniCode_Conv(Y_SYU_HREC.J_HIN_CHK_CNT, Format(ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT, "0"))
        
            If ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).Y_HIN_CHK_CNT = ID_KANRI_TBL(ING_No).KEN_DEN_TBL(k).J_HIN_CHK_CNT Then
                Call UniCode_Conv(Y_SYU_HREC.KEN_HINBAN, "")
            End If
        
        
        End If
                        
        Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
        Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                        
                        
                        
        Do
        
            sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
            Select Case sts
                Case BtNoErr
                    Exit Do
                 Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Print_Cancel_Proc = False
                    GoTo Abort_Tran
                Case Else
                    Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    GoTo Abort_Tran
            End Select
    
        Loop



'        If Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) <> "" Then
'            If ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO < 2 Then
'            Else
'                ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO - 1
'            End If
'        End If

    Next k


    sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


    Print_Cancel_Proc = False
    Exit Function


Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Public Function Inspe_Proc_SEK(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『積水ハウス検品処理（宅配伝票読み込み 大阪ＰＣ向け）』
'
'       2011.05.09
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim i               As Integer
Dim j               As Integer
Dim k               As Integer
Dim l               As Integer

Dim MENU_NO         As String * 2

Dim ID_NO           As String * 12
Dim SEK_ID_NO       As String

Dim CANCEL_F        As Boolean
Dim KENPIN_F        As Boolean
Dim SHOGO_F         As Boolean
Dim Y_Found_F       As Boolean
Dim T_Found_F       As Boolean

Dim Sumi_CNT        As Integer
Dim KUTI_SU         As Integer
Dim SAI_SU          As Double
Dim INPUT_SAI_SU    As Double



Dim OKURI_NO        As String
Dim OKURI_NO_F      As Boolean
Dim FUKUYAMA_CHK_F  As Boolean

Dim FileName        As String

Dim IN_WORD         As String * 30
Dim OUT_WORD        As String * 16

Dim wkTEI_LABELID() As String * 13
                        
Dim wkSai_Input     As Long

Dim wkSEK_PAGE_NO   As Integer
Dim From_Page_No    As Integer
Dim To_Page_No      As Integer
Dim wkKUTI_SU       As Integer

Dim SPACE_F         As Boolean      '2013.07.25
Dim NOTFOUND_F      As Boolean      '2013.07.25


    Inspe_Proc_SEK = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
        
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No  '伝票ＩＤ
                        
                                        
                        '親伝をＫＥＥＰ
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                         
                        CANCEL_F = True
                        KENPIN_F = True
                        Y_Found_F = False
                        T_Found_F = False
                        
                        Erase ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL
                        
                        
                        ID_KANRI_TBL(ING_No).SEK_PAGE_NO = 0
                        j = -1
                            
                        
                        '梱包済み＆キャンセルのチェック
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_NO)
                                                
                                                
                        com = BtOpGetGreaterEqual
                        
                        SPACE_F = False         '2013.07.25
                        NOTFOUND_F = False      '2013.07.25
                        
                        
                        Do
                        
                            sts = BTRV(com, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                    If Trim(ID_NO) <> Left(StrConv(Y_SYUREC.ID_NO, vbUnicode), 7) Then
                                        Exit Do
                                    End If
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call File_Error(sts, com, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                        
                            
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))
                                            
                            sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                                    Call File_Error(sts, com, "出荷予定(H)", 0)
                                    Call Err_Send_Proc("システム異常発生", "出荷ﾃﾞｰﾀｱﾝﾏｯﾁ", Trim(ID_NO), "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                
                                Case Else
                                    Call File_Error(sts, com, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                        
                            If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) <> "1" Then
                                CANCEL_F = False
                            End If
                        
                        
                            ID_KANRI_TBL(ING_No).KEN_OKURI_NO = Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode))               '送り状
                            ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode))       '運送会社
                            ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI = Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode))            '送り先
                                                                                                                            '向け先
                            If Trim(StrConv(Y_SYU_HREC.OKURISAKI, vbUnicode)) <> Trim(StrConv(Y_SYU_HREC.MUKE_NAME, vbUnicode)) Then
                                ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = Trim(StrConv(Y_SYU_HREC.MUKE_NAME, vbUnicode))
                            Else
                                ID_KANRI_TBL(ING_No).KEN_MUKE_NAME = ""
                            End If
                            ID_KANRI_TBL(ING_No).KEN_SYUKA_YMD = Trim(StrConv(Y_SYU_HREC.SYUKA_YMD, vbUnicode))             '出荷日
                            ID_KANRI_TBL(ING_No).KEN_JYUSHO = Trim(StrConv(Y_SYU_HREC.JYUSHO, vbUnicode))                   '住所
                            ID_KANRI_TBL(ING_No).KEN_BIKOU = Trim(StrConv(Y_SYU_HREC.BIKOU, vbUnicode))                     '備考
                            
                            If Trim(StrConv(Y_SYUREC.KENPIN_TANTO_CODE, vbUnicode)) = "" Then
                                KENPIN_F = False
                            End If
                            
                            
                            If IsNumeric(StrConv(Y_SYU_HREC.OKURI_NO_SEQ_TO, vbUnicode)) Then
                                                                                                                            '荷札印刷開始ﾍﾟｰｼﾞ
                                If ID_KANRI_TBL(ING_No).SEK_PAGE_NO < CInt(StrConv(Y_SYU_HREC.OKURI_NO_SEQ_TO, vbUnicode)) Then
                                    ID_KANRI_TBL(ING_No).SEK_PAGE_NO = CInt(StrConv(Y_SYU_HREC.OKURI_NO_SEQ_TO, vbUnicode))
                                End If
                            End If
                            
                            
                            Y_Found_F = True
                            
                            Call UniCode_Conv(K2_Y_SYU_TEI.KEN_NO, StrConv(Y_SYU_HREC.SEK_KEN_NO, vbUnicode))
                            Call UniCode_Conv(K2_Y_SYU_TEI.HIN_NO, StrConv(Y_SYU_HREC.SEK_HIN_NO, vbUnicode))
                            
                            sts = BTRV(BtOpGetEqual, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K2_Y_SYU_TEI, Len(K2_Y_SYU_TEI), 2)
                            Select Case sts
                                'Case BtNoErr                                               '2013.07.25
                                Case BtNoErr, BtErrKeyNotFound                              '2013.07.25

                                    If sts = BtErrKeyNotFound Then                          '2013.07.25
                                        Call UniCode_Conv(Y_SYU_TEI_REC.KONPO_ID, "*")      '2013.07.25
                                        Call UniCode_Conv(Y_SYU_TEI_REC.TEI_LABELID, "*")   '2013.07.25
                                        Call UniCode_Conv(Y_SYU_TEI_REC.KENPIN_TANTO, "")   '2013.07.25
                                        NOTFOUND_F = True                                   '2013.07.25
                                    End If                                                  '2013.07.25
                                    
                                    '2013.07.25If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) = "" And Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = "" Then
                                    '2013.07.25Else
                                        T_Found_F = True
                                    
                                        If j = -1 Then
                                            j = j + 1
                                            ReDim Preserve ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(0 To j)
                                            
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = "*"                      '2013.07.25
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                            Else
                                                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> "" Then       '2013.07.25
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                                Else                                                                    '2013.07.25
                                                    SPACE_F = True                                                      '2013.07.25
                                                End If                                                                  '2013.07.25
                                            End If
                                        
                                                                                                            '出荷順
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN = Trim(StrConv(Y_SYU_TEI_REC.SYU_JUN, vbUnicode))
                                                                                                            '邸名
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_TEI_NM = Trim(StrConv(Y_SYU_TEI_REC.TEI_NM, vbUnicode))
                                                                                                            '口数
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KUTI_SU = Val(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode))
                                                                                                            '才数
                                            ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                            
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.KENPIN_TANTO, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = True
                                            Else
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = False
                                            End If
                                            
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = True
                                            Else
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = False
                                            End If
                                            
                                            If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) <> "" Then
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = True
                                            Else
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = False
                                            End If
        
                                        Else
                                        
                                            For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                                                
                                                '2013.07.25
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) = "" And Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = "" Then
                                                    If Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) = "*" Then
                                                        Exit For
                                                    End If
                                                End If
                                                '2013.07.25
                                                
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> "" Then
                                                    If Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) = Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) Then
                                                        Exit For
                                                    End If
                                                End If
                                            
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) = "" Then
                                            
                                                    If Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                                                        Exit For
                                                    End If
                                                End If
                                            Next j
                                        
                                        
                                            If j > UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) Then
                                        
                                                ReDim Preserve ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(0 To j)
                                                
                                                '2013.07.25
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) = "" And Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) = "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = "*"
                                                    SPACE_F = True
                                                Else
                                                '2013.07.25
                                                    If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> "" Then
                                                        ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)
                                                    Else
                                                        
                                                        ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                                    
                                                    
                                                    End If
                                                End If      '2013.07.25
                                                                                                                
                                                                                                                '出荷順
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN = Trim(StrConv(Y_SYU_TEI_REC.SYU_JUN, vbUnicode))
                                                                                                                '邸名
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_TEI_NM = Trim(StrConv(Y_SYU_TEI_REC.TEI_NM, vbUnicode))
                                                                                                                '口数
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KUTI_SU = Val(StrConv(Y_SYU_TEI_REC.KUTI_SU, vbUnicode))
                                                                                                                '才数
                                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SAI_SU = Val(StrConv(Y_SYU_TEI_REC.SAI_SU, vbUnicode))
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.KENPIN_TANTO, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = True
                                                Else
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = False
                                                End If
                                                
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = True
                                                Else
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = False
                                                End If
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) <> "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = True
                                                Else
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = False
                                                End If
                                            
                                            
                                                If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)) > 13 Then
                                                                                                                    '梱包ID毎の件数
                                                End If
                                            
                                            
                                            Else
                                            
                                            
                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPOU_F = False
                                                End If
                                                
                                                If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) = "" Then
                                                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SHOGO_F = False
                                                End If
                                            
                                            
                                            End If
                                        
                                        End If
                                    '2013.07.25End If
                                'Case BtErrKeyNotFound          2013.07.25
                                    
                                Case Else
                                    Call File_Error(sts, com, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                            
                            
                        
                            com = BtOpGetNext
                                
                        Loop
                        
                        '出荷データ有無チェック
                        If Not Y_Found_F Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        End If
                        'キャンセルチェック
                        If CANCEL_F Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "キャンセル伝票です。", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        End If
                        '検品処理済みチェック
                        If KENPIN_F Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "検品処理済！", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        End If
                        
                        
                        
                        '梱包ＩＤ毎の件数を集計
 '                       For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
 '
 '                           If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)) > 13 Then
 '
 '                               Erase wkTEI_LABELID
 '                               Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)
 '
 '                               com = BtOpGetGreaterEqual
 '                               k = -1
 '                               Do
 '
 '                                   DoEvents
 '
 '                                   sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
 '                                   Select Case sts
 '                                       Case BtNoErr
 '                                           If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(StrConv(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO, vbUnicode)) Then
 '                                               Exit Do
 '                                           End If
 '                                       Case BtErrEOF
 '                                           Exit Do
 '                                       Case Else
 '                                           Call File_Error(sts, com, "邸別注文ﾃﾞｰﾀ", 0)
 '                                           Call Err_Send_Proc("システム異常発生", "", "", "", "")
 '                                           Sendbuf = Text_Create_Proc()
 '                                           Exit Function
 '                                   End Select
 '
 '                                   If k = -1 Then
 '                                        k = k + 1
 '                                       ReDim Preserve wkTEI_LABELID(0 To k)
 '                                       wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
 '                                   Else
 '                                       For k = 0 To UBound(wkTEI_LABELID)
 '
 '                                           If Trim(wkTEI_LABELID(k)) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
 '                                                Exit For
 '                                           End If
 '
 '                                       Next k
 '
 '
 '                                       If k > UBound(wkTEI_LABELID) Then
 '                                           ReDim Preserve wkTEI_LABELID(0 To k)
 '                                           wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
 '                                       End If
 '
 '                                   End If
 '
 '                                   com = BtOpGetNext
 '
 '                               Loop
 '
 '
 '
 '                               If k = -1 Then
 '                                   ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = 0
 '                               Else
 '                                   ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = UBound(wkTEI_LABELID) + 1
 '
 '                               End If
 '                           Else
 '                               ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = 0
 '                           End If
 '
 '                       Next j
                        
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2013.07.25 ▽
                        If SPACE_F Or NOTFOUND_F Then
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Check_REQ
                        
                        
                            '-----------------------------------------------ヘッダー
                            'Send_Text.sts = Sts_OK                                  'ステータス　OK
                            'ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                            '
                            'Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            'ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                            '
                            'Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            'ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                            '
                            'Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            'ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                            '
                            'Send_Text.FileName = ""                                 '送信データファイル名
                            'ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                            '
                            'Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            'ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
                            Send_Text.buzzer = Buzzer_DOUBLE                         'ブザー音　標準
                            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                            '-----------------------------------------------１行目
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'2017.09.22
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            If SPACE_F Then
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "ラベル未印刷有り")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "ラベル未印刷有り")
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "")
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            If NOTFOUND_F Then
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "注文データ未登録有り")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "注文データ未登録有り")
                            Else
                                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                            End If
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, " 0:継続 9:CANCEL")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, " 0:継続 9:CANCEL")
                                                                                    
                                                                                    
                                                                                    
                                                                                    
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "20"
                                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "01"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        
                            Sendbuf = Text_Create_Proc()
                        
                            Inspe_Proc_SEK = False
                            Exit Function
                        
                        End If
                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2013.07.25　△
                        If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                            
                            '-----------------------------------------------ヘッダー
                            'Send_Text.sts = Sts_OK                                  'ステータス　OK
                            'ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                            '
                            'Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            'ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                            '
                            'Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            'ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                            '
                            'Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            'ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                            '
                            'Send_Text.FileName = ""                                 '送信データファイル名
                            'ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                            '
                            'Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            'ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
                            '-----------------------------------------------１行目
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'2017.09.22
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
                
                
                
                        Else
                
                
                            Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            '-----------------------------------------------ヘッダー
                            'Send_Text.sts = Sts_OK                                  'ステータス　OK
                            'ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                            '
                            'Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            'ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                            '
                            'Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            'ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                            '
                            'Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            'ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                            '
                            'Send_Text.FileName = ""                                 '送信データファイル名
                            'ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                            '
                            'Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                            'ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                            
                            Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
                            
                            '-----------------------------------------------１行目
                                                            'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'2017.09.22
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    
                            
                            '-----------------------------------------------２行目
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                            'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                                                                                    
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                                                                                '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------５行目
                                                                                    'BOX属性
    
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
            
                            Sendbuf = Text_Create_Proc()
                        End If
                
                
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（送り状ａj
                
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    '送り状
                    Case Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO, _
                                LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                        
                        If Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) = LCD_OKURI_NO_S & Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) Then
                            
                            If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) > Len(LCD_OKURI_NO_S) Then
                                If Left(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), Len(LCD_OKURI_NO_S)) = LCD_OKURI_NO_S Then
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO)
                                Else
                                    OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                                End If
                            Else
                                OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            End If
                        Else
                            OKURI_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        End If
                        
                        If Trim(OKURI_NO) = Trim(KEN_CHARTER_CD) Or Trim(OKURI_NO) = Trim(KEN_AKABOU_CD) Or Trim(OKURI_NO) = Trim(KEN_LOGISTIC_CD) Then
                        
                        
                        Else
                        
                            If Not IsNumeric(OKURI_NO) Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                Exit Function
                            End If
                        
                        
                        
                            If OKURI_NO_CHECK_PROC(OKURI_NO, OKURI_NO_F, FUKUYAMA_CHK_F) Then
                            End If
                            
                            If Not OKURI_NO_F Then
                            
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "送り状ｃGラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                Exit Function
                                                
                            End If
                        
                            If FUKUYAMA_CHK_F Then
'2017.09.22
                            
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, OKURI_NO, "福山 ﾁｪｯｸﾃﾞｼﾞｯﾄｴﾗｰ", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                Exit Function
                            
                            End If
                        
                        End If
                    
                        '送り状
                        ID_KANRI_TBL(ING_No).KEN_OKURI_NO = OKURI_NO

                
                        '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                    
                        Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)     '事業部
                                                                                            'ID
                        Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, Trim(ID_KANRI_TBL(ING_No).ID_NO))
                        com = BtOpGetGreaterEqual
                        Do
                        
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                                                        
                            sts = BTRV(com, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                            Select Case sts
                                Case BtNoErr
                                
                                    If Left(StrConv(Y_SYUREC.ID_NO, vbUnicode), 7) <> Trim(ID_KANRI_TBL(ING_No).ID_NO) Then
                                        Exit Do
                                    End If
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定", 0)
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                            End Select
                        
                            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, StrConv(Y_SYUREC.ID_NO, vbUnicode))                                                                                           '追番
        
                            Do
                        
                                sts = BTRV(BtOpGetEqual + BtSNoWait, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrKeyNotFound
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)不明", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_SEK = False
                                        GoTo Abort_Tran
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_SEK = False
                                        GoTo Abort_Tran
                                    Case Else
                                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                                            
                                            
                            If StrConv(Y_SYU_HREC.CANCEL_F, vbUnicode) = "1" Then
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, "")
                                Call UniCode_Conv(Y_SYU_HREC.UNSOU_KAISHA, "")
                            Else
                                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO, OKURI_NO)
                                Call OKURI_NO_SET_PROC(OKURI_NO)
                            End If
                                                        
                                                        
                            Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))  '2015.01.10
                            Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))   '2015.01.10
                                                        
                                                        
                            '出荷予定(ﾎｽﾄｲﾒｰｼﾞ)書込み
                            Do
                                sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                                Select Case sts
                                    Case BtNoErr
                                        Exit Do
                                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        Inspe_Proc_SEK = False
                                        GoTo Abort_Tran
                                
                                    Case Else
                                        Call File_Error(sts, BtOpUpdate, "出荷予定(ﾎｽﾄｲﾒｰｼﾞ)", 0)
                                        Inspe_Proc_SEK = SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        GoTo Abort_Tran
                                End Select
                            Loop
                        
                            com = BtOpGetNext
                        
                        Loop
                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        Call SEK_Kenpin_Count_Proc(Sumi_CNT)
            
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
                        
                        '-----------------------------------------------１行目
                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                
                        
                        '-----------------------------------------------２行目
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性

                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                        Sendbuf = Text_Create_Proc()
                End Select
            Next i
        Case Step_Sagyo3_RES        '３回目の受信（指示ａj
            For i = 0 To M_Gyo - 1
                Select Case Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), 3)
                    
                    Case LCD_SEK_ID_NO     '指示ID
                        SEK_ID_NO = ID_KANRI_TBL(ING_No).Recv_text(i)
                        
                        For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                        
                            If Trim(SEK_ID_NO) = Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) Then
                                Exit For
                            End If
                        
                        Next j
                        
                        '指示っｪｯｸ
                        If j > UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, SEK_ID_NO, "指示ｃGラー", "", "")
                
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        
                        End If
                        
                        If Len(Trim(SEK_ID_NO)) > 13 Then
                        '梱包IDでのﾁｪｯｸ
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, SEK_ID_NO)
                        Else
                        '邸別IDでのﾁｪｯｸ
                            Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, SEK_ID_NO)
                        End If
                                                        
                        com = BtOpGetGreaterEqual
                        T_Found_F = False
                        
                        Do
                        
'                            DoEvents
                            If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                DoEvents                                                    '2016.01.26
                            End If                                                          '2016.01.26
                        
                            If Len(Trim(SEK_ID_NO)) > 13 Then
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                            Else
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                            End If
                            
                            Select Case sts
                                Case BtNoErr
                                        
                                    If Len(Trim(SEK_ID_NO)) > 13 Then
                                    '梱包IDでのﾁｪｯｸ
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(SEK_ID_NO) Then
                                            Exit Do
                                        End If
                                    Else
                                    '邸別IDでのﾁｪｯｸ
                                        If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(SEK_ID_NO) Then
                                            Exit Do
                                        End If
                                    End If
                                    
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                                    Inspe_Proc_SEK = SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
'                                   GoTo Abort_Tran                  2011.12.22
                                    Exit Function                   '2011.12.22
                            End Select
                        
                            '2011.05.27
                            If SEK_KEN_SHOGO_F Then
                                If Trim(StrConv(Y_SYU_TEI_REC.SHOGO_TANTO, vbUnicode)) = "" Then
                            
'2011.06.22                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未照合注文有り！！", "")
                                    
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未照合注文です！！", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_SEK = False
                                    Exit Function
                                End If
                            End If
                        
                        
                            If SEK_KEN_KONPO_F Then
                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_TANTO, vbUnicode)) = "" And Trim(StrConv(Y_SYU_TEI_REC.SYUGO_KONPO_TANTO, vbUnicode)) = "" Then
                            
'2011.06.22                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未梱包有り！", "")
                                    
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "未梱包です！！", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_SEK = False
                                    Exit Function
                                End If
                            End If
                        
                                                
                            If SEK_KEN_KENPIN_F Then
                        
                                If Trim(StrConv(Y_SYU_TEI_REC.KENPIN_TANTO, vbUnicode)) <> "" Then
'2017.09.22
                            
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "検品済み！！", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_SEK = False
                                    Exit Function
                                End If
                            
                            End If
                            '2011.05.27
                                                
                        
                            T_Found_F = True
                        
                        
                            com = BtOpGetNext
                        
                        
                        Loop
                        
                        If Not T_Found_F Then
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, SEK_ID_NO, "邸別注文データなし！", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        End If
                                    
                        
                        ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO = SEK_ID_NO
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        '-----------------------------------------------ヘッダー
                        Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc

                        '-----------------------------------------------１行目
                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        
                        '-----------------------------------------------２行目
                        
                        Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                        
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        
                        '-----------------------------------------------３行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        
                        
                        IN_WORD = ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_TEI_NM
                        Call Moji_Cut_Proc(IN_WORD, OUT_WORD, 16)
                        
                        
                        
                        If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
                            
                           '梱包ＩＤ毎の件数を集計
    
                            Erase wkTEI_LABELID
                            Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO)
    
                            com = BtOpGetGreaterEqual
                            k = -1
                            Do
    
'                                DoEvents
                                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                                    DoEvents                                                    '2016.01.26
                                End If                                                          '2016.01.26
    
                                sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                                Select Case sts
                                    Case BtNoErr
                                        If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) Then
                                            Exit Do
                                        End If
                                    Case BtErrEOF
                                        Exit Do
                                    Case Else
                                        Call File_Error(sts, com, "邸別注文ﾃﾞｰﾀ", 0)
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
    
                                If k = -1 Then
                                    k = k + 1
                                    ReDim Preserve wkTEI_LABELID(0 To k)
'''                                    wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                    wkTEI_LABELID(k) = Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7)
                                Else
                                    For k = 0 To UBound(wkTEI_LABELID)

'''                                           If Trim(wkTEI_LABELID(k)) = Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) Then
                                           If Left(wkTEI_LABELID(k), 7) = Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7) Then
                                                Exit For
                                           End If
    
                                    Next k
    
    
                                    If k > UBound(wkTEI_LABELID) Then
                                        ReDim Preserve wkTEI_LABELID(0 To k)
'''                                        wkTEI_LABELID(k) = StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)
                                        wkTEI_LABELID(k) = Left(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode), 7)
                                    End If
    
                                End If
    
                                com = BtOpGetNext
    
                            Loop
    
    
    
                            If k = -1 Then
                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = 0
                            Else
                                ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT = UBound(wkTEI_LABELID) + 1

                            End If
                            
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Format(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT, "#0") & "件(" _
                                                                                & Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & _
                                                                                OUT_WORD & ")")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Format(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KONPO_CNT, "#0") & "件" _
                                                                                & Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & _
                                                                                OUT_WORD)
                        Else
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & OUT_WORD)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_SYU_JUN) & " " & OUT_WORD)
                        End If
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                        
                        
                        Sendbuf = Text_Create_Proc()
                
                End Select
            
            Next i
    
        Case Step_Sagyo4_RES        '４回目の受信（ANY KEY　受信）
            
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            
                                                    
            '----------------------------------- 邸別注文データ処理 -----------
            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                If ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO = ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO Then
                    wkKUTI_SU = ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KUTI_SU
                    Exit For
                End If
            Next j
            
            
            
            If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
            '梱包IDでのﾁｪｯｸ
                Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
            Else
            '邸別IDでのﾁｪｯｸ
                Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
            End If
                                                        
            com = BtOpGetGreaterEqual
                        
            Do
            
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
            
                If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
                    sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
                Else
                    sts = BTRV(com, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
                End If
                
                Select Case sts
                    Case BtNoErr
                            
                        If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
                        '梱包IDでのﾁｪｯｸ
                            If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
                                Exit Do
                            End If
                        Else
                        '邸別IDでのﾁｪｯｸ
                            If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
                                Exit Do
                            End If
                        End If
                        
                    
                    Case BtErrEOF
                        Exit Do
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
                        Inspe_Proc_SEK = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            '----------------------------------- 出荷予定(H)処理 -----------
                Call UniCode_Conv(K8_Y_SYU_H.SEK_KEN_NO, StrConv(Y_SYU_TEI_REC.KEN_NO, vbUnicode))
                Call UniCode_Conv(K8_Y_SYU_H.SEK_HIN_NO, StrConv(Y_SYU_TEI_REC.HIN_NO, vbUnicode))
                                            
                sts = BTRV(BtOpGetEqual, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K8_Y_SYU_H, Len(K8_Y_SYU_H), 8)
                
                Select Case sts
                    Case BtNoErr
                    
                    Case BtErrKeyNotFound
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, "出荷予定(H)", "アンマッチ！")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_SEK = False
                        Exit Function
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                        Inspe_Proc_SEK = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
            '----------------------------------- 出荷予定処理 -----------
                Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
                Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, StrConv(Y_SYU_HREC.ID_NO, vbUnicode))
                                            
                sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                
                Select Case sts
                    Case BtNoErr
                    
                    Case BtErrKeyNotFound
'2017.09.22
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, "出荷予定", "アンマッチ！")
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        Inspe_Proc_SEK = False
                        'Exit Function              2011.12.22
                        GoTo Abort_Tran         '   2011.12.22
                    Case Else
                        'GoTo Abort_Tran            '2013.07.25
                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                        Inspe_Proc_SEK = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
                                            
            '----------------------------------- 出荷予定書き込み処理 -----------
                                        
                Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
                                                    
                Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
                                                
                                                
                Call UniCode_Conv(Y_SYUREC.UPD_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                                                
                Do
                    sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            GoTo Abort_Tran
                    
                        Case Else
                            
                            Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                            Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                                            
                                            
            '----------------------------------- 出荷予定(H)書き込み処理 -----------
                                            
                Call UniCode_Conv(Y_SYU_HREC.KENPIN_NOW, Format(Now, "YYYYMMDDHHMMSS"))
                Call UniCode_Conv(Y_SYU_HREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                    
                
                 If com = BtOpGetGreaterEqual Then
                
                    wkSEK_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                    
                    
                    ID_KANRI_TBL(ING_No).SEK_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO + 1
                    From_Page_No = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                    
                    ID_KANRI_TBL(ING_No).SEK_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO + wkKUTI_SU - 1
                    To_Page_No = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                                            
                End If
                                            
                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ, Format(From_Page_No, "000"))
                Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ_TO, Format(To_Page_No, "000"))
                                            
                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                                            
                                            
                                            
                Do
                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K8_Y_SYU_H, Len(K8_Y_SYU_H), 8)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            GoTo Abort_Tran
                    
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                            Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                
            '----------------------------------- 邸別注文ﾃﾞｰﾀ(H)書き込み処理 -----------
                                            
                Call UniCode_Conv(Y_SYU_TEI_REC.KENPIN_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                Call UniCode_Conv(Y_SYU_TEI_REC.KENPIN_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)
                                            
                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                Call UniCode_Conv(Y_SYU_TEI_REC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                                            
                                            
                Do
                    
                    If Len(Trim(SEK_ID_NO)) > 13 Then
                    '梱包IDでのﾁｪｯｸ
                        sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU, Len(K3_Y_SYU), 3)
                    Else
                    '邸別IDでのﾁｪｯｸ
                        sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU, Len(K1_Y_SYU), 1)
                    End If
                    
                    
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文ﾃﾞｰﾀ使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            GoTo Abort_Tran
                    
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "邸別注文ﾃﾞｰﾀ", 0)
                            Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                '------------------------------------   在庫移動履歴の処理
                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                    MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                            
                Else
                    MENU_NO = ""
                End If
                                            
                '履歴出力の為の読み込み
                Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                Call UniCode_Conv(K0_MTS.SS_CODE, "")
                sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
                Select Case sts
                    Case BtNoErr
                    Case BtErrKeyNotFound
                        Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                        Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                    Case Else
                        Call File_Error(sts, BtOpGetEqual, "向け先マスタ", 0)
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        'Exit Function              2011.12.22
                        GoTo Abort_Tran         '   2011.12.22
                                        
                End Select
                sts = IDOREKI_OUTPUT_PROC("", _
                                            "", _
                                            ID_KANRI_TBL(ING_No).JGYOBU, _
                                            ID_KANRI_TBL(ING_No).NAIGAI, _
                                            "", _
                                            "", _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            0, _
                                            0, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            FILE_RETRY, _
                                            CYU_KBN_SPO, _
                                            Trim(StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)) & " 送り状:" & Trim(StrConv(Y_SYU_HREC.OKURI_NO, vbUnicode)), _
                                            , , , , MENU_NO, _
                                            ID_KANRI_TBL(ING_No).MTS_CODE, _
                                            "", _
                                            ID_KANRI_TBL(ING_No).ID_NO & "-" & ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO, , , , 1)
                Select Case sts
                    Case False      '正常終了
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Inspe_Proc_SEK = SYS_ERR
                        GoTo Abort_Tran
                End Select
                
                '運送会社
                ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA = StrConv(Y_SYU_HREC.UNSOU_KAISHA, vbUnicode)
            
                
                com = BtOpGetNext
            
            Loop
            
            '作業ﾛｸﾞ出力
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
            If Trim(MENU_NO) = "" Then
            Else
            '作業ﾛｸﾞ出力
                
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                    (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                                    ID_KANRI_TBL(ING_No).NAIGAI, _
                                                    MENU_NO, _
                                                    (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                     , , , , , _
                                                     ID_KANRI_TBL(ING_No).ID_NO, ID_KANRI_TBL(ING_No).MTS_CODE) Then
                    Inspe_Proc_SEK = SYS_ERR
                    'Exit Function          2011.12.22
                   GoTo Abort_Tran      '   2011.12.22
                End If
            End If
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If

            
            For j = 0 To UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL)
                If Trim(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_ID_NO) = Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
                    ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL(j).SEK_KENPIN_F = True
                    Exit For
                End If
            Next j
            
            
                    
            Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                    
                    
            ''' 荷札処置
            If Trim(F0_SendFile) = "" Or Trim(ID_KANRI_TBL(ING_No).CTR_TYPE) = "" Then
            
            
                If Sumi_CNT = UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1 Then
                '--------------------------------------------------------------------口数・才数へ
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                    '-----------------------------------------------ヘッダー
                    
                    Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
'-----------------------------------------------１行目
                                                                            'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
'2017.09.22
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                    '-----------------------------------------------２行目
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                            "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                '-----------------------------------------------３行目
                                                                            'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                            
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '--------------------------------------------------４行目
                    Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                                                                'BOX属性
                                
                    Send_Text.Box_Type(3).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                    
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
        
                    '-----------------------------------------------５行目
                                                                        'BOX属性
                    If SAI_SU >= 999999 Or SAI_SU = 0 Then
                    
                    
                    
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                        '数値初期表示
                        Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                    
                    
                    Else
                    
                    
                    
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                                                                        '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                    
'                        ID_KANRI_TBL(ING_No).SEK_SAI_SU = SAI_SU
'                        ID_KANRI_TBL(ING_No).SEK_KUTI_SU = KUTI_SU
                            
                    
                    End If
                            
                            
                    Sendbuf = Text_Create_Proc()
                Else
                
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    '-----------------------------------------------ヘッダー
                    
                    Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc

                    '-----------------------------------------------１行目
                                                    'BOX属性
                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                            '表示内容
'2017.09.22
                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                            '数値初期表示
                    Send_Text.Box_Type(0).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(0).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(0).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            
                    
                    '-----------------------------------------------２行目
                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                            '数値初期表示
                    Send_Text.Box_Type(1).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(1).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(1).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                    '-----------------------------------------------３行目
                                                                                    'BOX属性
                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                            '表示内容
                                                                            
                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                            '数値初期表示
                    Send_Text.Box_Type(2).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(2).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                            '入力桁数
                    Send_Text.Box_Type(2).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                    '-----------------------------------------------４行目
                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                            '表示内容
                                                                        '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                            '数値初期表示
                    Send_Text.Box_Type(3).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(3).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                            '入力桁数
                    Send_Text.Box_Type(3).Max_Size = "20"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                            
                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                    '-----------------------------------------------５行目
                                                                            'BOX属性
    
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                            '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                            '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                            '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                            '入力桁数
                     Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                            
                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                    Sendbuf = Text_Create_Proc()
                End If
            
            Else
                
                Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                
'''''''''''''''''''''''''   2011.06.29
                If wkSEK_PAGE_NO = 0 Then
                    wkSEK_PAGE_NO = SEK_LABEL_PAGE - 1
                End If
'''''''''''''''''''''''''   2011.06.29
                
                If SEK_Label_File_Make_Proc(FileName, wkSEK_PAGE_NO, wkKUTI_SU, KUTI_SU) Then
                    Inspe_Proc_SEK = SYS_ERR
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    'GoTo Abort_Tran        2011.12.22
                    Exit Function       '   2011.12.22
                End If
                If ID_KANRI_TBL(ING_No).SEK_PAGE_NO < SEK_LABEL_PAGE Then

                    If Sumi_CNT = UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1 Then
                    '--------------------------------------------------------------------口数・才数へ
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                        '-----------------------------------------------ヘッダー
                        
                        Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"

                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                                "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"

                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                    '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容

                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)

                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"

                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '--------------------------------------------------４行目
                        Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                                                                    'BOX属性

                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""

                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

                        '-----------------------------------------------５行目
                                                                        'BOX属性
                        If ID_KANRI_TBL(ING_No).SEK_SYUGO_SAI_SU > 999 Or ID_KANRI_TBL(ING_No).SEK_SYUGO_SAI_SU = 0 Then



                            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                            '数値初期表示
                            Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00")))) & Trim(Format(ID_KANRI_TBL(ING_No).SEK_SAI_SU, "#0.00"))
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = "12"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                                    '入力桁数
                            Send_Text.Box_Type(4).Max_Size = "05"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"


                        Else



                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                            '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(SAI_SU, "#0.00"))
                                                                            '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                            '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"



                        End If



                        Sendbuf = Text_Create_Proc()
                    Else

                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        '-----------------------------------------------ヘッダー
                        
                        Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
 
                        '-----------------------------------------------１行目
                                                        'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"

                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""


                        '-----------------------------------------------２行目
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "#0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"

                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                        'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容

                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"

                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                                                                            '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"

                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
                                                                                'BOX属性

                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"

                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                    End If




                
                Else
            
                '印刷要求送信
                                            
                    ID_KANRI_TBL(ING_No).LABEL_STEP = 1
                                                
                                                
                    ID_KANRI_TBL(ING_No).Step = Step_PRINT_REQ
                
                    ID_KANRI_TBL(ING_No).LABEL_ON = True
                
                    ID_KANRI_TBL(ING_No).LABEL_START_PAGE_NO = ID_KANRI_TBL(ING_No).SEK_PAGE_NO
                    '-----------------------------------------------ヘッダー
                
                    Send_Text.sts = Sts_OK                                  'ステータス　OK
                    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                    Send_Text.Display_Flg = Display_LABEL                   '表示画面フラグ 通常入力画面
                    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_LABEL
                
                    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                    Send_Text.FileName = FileName                           '送信データファイル名
                    ID_KANRI_TBL(ING_No).Send_Text.FileName = FileName
                
                    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                
                    Sendbuf = Text_Create_Proc()
            
                End If
            
            End If
                    
        Case Step_PRINT_RES        '印刷終了
                    
            Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                    
            If Sumi_CNT = UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1 Then
            '--------------------------------------------------------------------口数・才数へ
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo5_REQ
                '-----------------------------------------------ヘッダー
                
                Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
                    
                '-----------------------------------------------１行目
                                                                        'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                '-----------------------------------------------２行目
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                        "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & _
                                                        "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                        'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                                                                        
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                        
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '--------------------------------------------------４行目
                Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                                                            'BOX属性
                            
                Send_Text.Box_Type(3).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_KUTI_SU_S & Format(KUTI_SU, "0"))
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "00"
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = ""
                
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    
                '-----------------------------------------------５行目
                                                                        'BOX属性
                If SAI_SU >= 999999 Or SAI_SU = 0 Then
                
                
                
                    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S)
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Trim(Format(0, "#0.00")))) & Trim(Format(0, "#0.00"))
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = "12"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "12"
                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "05"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                
                
                Else
                
                
                
                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                    '表示内容
                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S & Format(SAI_SU, "#0.00"))
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_SAI_SU_S & Format(SAI_SU, "#0.00"))
                                                                    '数値初期表示
                    Send_Text.Box_Type(4).INIT = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                    '初期カーソル位置
                    Send_Text.Box_Type(4).Start_Pos = ""
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                            '入力桁数
                    Send_Text.Box_Type(4).Max_Size = "00"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                
'                    ID_KANRI_TBL(ING_No).SEK_SAI_SU = SAI_SU
'                    ID_KANRI_TBL(ING_No).SEK_KUTI_SU = KUTI_SU
                        
                        
                End If
                        
                        
                Sendbuf = Text_Create_Proc()
            Else
            
                ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                '-----------------------------------------------ヘッダー
                
                Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
 
                '-----------------------------------------------１行目
                                                'BOX属性
                Send_Text.Box_Type(0).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                        '表示内容
'2017.09.22
                Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                        '数値初期表示
                Send_Text.Box_Type(0).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(0).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(0).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
        
                
                '-----------------------------------------------２行目
                
                Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                
                
                Send_Text.Box_Type(1).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                        '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                        '数値初期表示
                Send_Text.Box_Type(1).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(1).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(1).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                '-----------------------------------------------３行目
                                                                                'BOX属性
                Send_Text.Box_Type(2).Box_Type = TYPE_REF
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                        '表示内容
                                                                        
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                        '数値初期表示
                Send_Text.Box_Type(2).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(2).Start_Pos = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                        '入力桁数
                Send_Text.Box_Type(2).Max_Size = "00"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                        
                Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                '-----------------------------------------------４行目
                Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                    '表示内容
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                        '数値初期表示
                Send_Text.Box_Type(3).INIT = ""
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                        '初期カーソル位置
                Send_Text.Box_Type(3).Start_Pos = "01"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                        '入力桁数
                Send_Text.Box_Type(3).Max_Size = "20"
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                        
                Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                '-----------------------------------------------５行目
                                                                        'BOX属性

'                Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                        '表示内容
'                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
'                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                        '数値初期表示
'                Send_Text.Box_Type(4).INIT = ""
'                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                        '初期カーソル位置
'                Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
'                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                        '入力桁数
'                 Send_Text.Box_Type(4).Max_Size = "00"
'                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                        
'                Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
'                ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                Call Wel_Clear_Text_Proc                 '2016.01.26


                Sendbuf = Text_Create_Proc()
            End If
    
        Case Step_Sagyo5_RES        '５回目の受信（ANY KEY　受信）
            
            Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
            
            If SAI_SU >= 999999 Or SAI_SU = 0 Then
            
            
                For i = 0 To M_Gyo - 1
            
                
                
                    Select Case Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                        '才数
                        Case LCD_SAI_SU_S
                    
                            If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                Exit Function
                            
                            End If
                    
                            INPUT_SAI_SU = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                    
                    
                            If INPUT_SAI_SU = 0 Then
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "才数エラー", "", "")
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_SEK = False
                                Exit Function
                            
                            End If
            
            
'2011.05.26                            '----------------------------------- データ更新処理開始 -----------
'2011.05.26                                                            'トランザクション開始
'2011.05.26                            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'2011.05.26                            If sts <> BtNoErr Then
'2011.05.26                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                Sendbuf = Text_Create_Proc()
'2011.05.26                                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
'2011.05.26                                Exit Function
'2011.05.26                            End If
'2011.05.26                            '------------------------------------   注文ﾃﾞｰﾀの処理
'2011.05.26
'2011.05.26
'2011.05.26                            If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
'2011.05.26                            '梱包IDでのﾁｪｯｸ
'2011.05.26                                Call UniCode_Conv(K3_Y_SYU_TEI.KONPO_ID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
'2011.05.26                            Else
'2011.05.26                            '邸別IDでのﾁｪｯｸ
'2011.05.26                                Call UniCode_Conv(K1_Y_SYU_TEI.TEI_LABELID, ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)
'2011.05.26                            End If
'2011.05.26
'2011.05.26                            com = BtOpGetGreaterEqual
'2011.05.26
'2011.05.26                            Do
'2011.05.26
'2011.05.26                                DoEvents
'2011.05.26
'2011.05.26                                Do
'2011.05.26                                    If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
'2011.05.26                                        sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K3_Y_SYU_TEI, Len(K3_Y_SYU_TEI), 3)
'2011.05.26                                    Else
'2011.05.26                                        sts = BTRV(com + BtSNoWait, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
'2011.05.26                                    End If
'2011.05.26
'2011.05.26                                    Select Case sts
'2011.05.26                                        Case BtNoErr
'2011.05.26                                            If Len(Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO)) > 13 Then
'2011.05.26                                            '梱包IDでのﾁｪｯｸ
'2011.05.26                                                If Trim(StrConv(Y_SYU_TEI_REC.KONPO_ID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
'2011.05.26                                                    sts = BtErrEOF
'2011.05.26                                                    Exit Do
'2011.05.26                                                End If
'2011.05.26                                            Else
'2011.05.26                                            '邸別IDでのﾁｪｯｸ
'2011.05.26                                                If Trim(StrConv(Y_SYU_TEI_REC.TEI_LABELID, vbUnicode)) <> Trim(ID_KANRI_TBL(ING_No).SEK_KEN_ID_NO) Then
'2011.05.26                                                    sts = BtErrEOF
'2011.05.26                                                    Exit Do
'2011.05.26                                                End If
'2011.05.26                                            End If
'2011.05.26                                            Exit Do
'2011.05.26                                        Case BtErrEOF
'2011.05.26                                            Exit Do
'2011.05.26                                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2011.05.26                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2011.05.26                                            Inspe_Proc_SEK = False
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                        Case Else
'2011.05.26                                            Call File_Error(sts, com + BtSNoWait, "邸別注文データ", 0)
'2011.05.26                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                    End Select
'2011.05.26
'2011.05.26                                Loop
'2011.05.26
'2011.05.26
'2011.05.26                                If sts = BtErrEOF Then
'2011.05.26                                    Exit Do
'2011.05.26                                End If
'2011.05.26
'2011.05.26                                Call UniCode_Conv(Y_SYU_TEI_REC.KUTI_SU, "0001")
'2011.05.26                                Call UniCode_Conv(Y_SYU_TEI_REC.SAI_SU, Format(INPUT_SAI_SU, "000.00"))
'2011.05.26
'2011.05.26
'2011.05.26                                Do
'2011.05.26                                    DoEvents
'2011.05.26                                    sts = BTRV(BtOpUpdate, Y_SYU_TEI_POS, Y_SYU_TEI_REC, Len(Y_SYU_TEI_REC), K1_Y_SYU_TEI, Len(K1_Y_SYU_TEI), 1)
'2011.05.26                                    Select Case sts
'2011.05.26                                        Case BtNoErr
'2011.05.26                                            Exit Do
'2011.05.26                                        Case BtErrKeyNotFound
'2011.05.26                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ不明", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2011.05.26                                            Inspe_Proc_SEK = False
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                         Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2011.05.26                                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "邸別注文データ使用中", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2011.05.26                                            Inspe_Proc_SEK = False
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                        Case Else
'2011.05.26                                            Call File_Error(sts, BtOpUpdate, "邸別注文データ", 0)
'2011.05.26                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                            Sendbuf = Text_Create_Proc()
'2011.05.26                                            GoTo Abort_Tran
'2011.05.26                                    End Select
'2011.05.26                                Loop
'2011.05.26
'2011.05.26
'2011.05.26                                com = BtOpGetNext
'2011.05.26
'2011.05.26
'2011.05.26                            Loop
'2011.05.26                                    'トランザクション終了
'2011.05.26                            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
'2011.05.26                            If sts <> BtNoErr Then
'2011.05.26                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'2011.05.26                                Sendbuf = Text_Create_Proc()
'2011.05.26                                Call File_Error(sts, BtOpEndTransaction, "", 0)
'2011.05.26                                GoTo Abort_Tran
'2011.05.26                            End If
'2011.05.26
                    End Select
                Next i
                Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
                wkSai_Input = 1
                SAI_SU = INPUT_SAI_SU
            Else
                wkSai_Input = 0
                Call SEK_KUTI_SU_Count_Proc(SAI_SU, KUTI_SU)
            End If
            
            
            '----------------------------------- 出荷予定(H)処理 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
            
            
            Call UniCode_Conv(K4_Y_SYU_H.ID_NO, Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") & "00")
            
            com = BtOpGetGreaterEqual
            
            Do
                
'                DoEvents
                If StrComp(App.EXEName, "F110010", vbTextCompare) <> 0 Then     '2016.01.26
                    DoEvents                                                    '2016.01.26
                End If                                                          '2016.01.26
                sts = BTRV(com, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                
                Select Case sts
                    Case BtNoErr
                    
                        If Left(StrConv(Y_SYU_HREC.ID_NO, vbUnicode), 7) <> Format(ID_KANRI_TBL(ING_No).ID_NO, "0000000") Then
                            Exit Do
                        End If
                    
                    Case BtErrEOF
                        
                        Exit Do
                    Case Else
                        Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                        Inspe_Proc_SEK = SYS_ERR
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        GoTo Abort_Tran
                End Select
                                            
                                            
            '----------------------------------- 出荷予定(H)書き込み処理 -----------
                
                Call UniCode_Conv(Y_SYU_HREC.KUTI_SU, Format(KUTI_SU, "0000"))
                Call UniCode_Conv(Y_SYU_HREC.SAI_SU, Format(SAI_SU, "00.00"))
                                            
                                            
''                If wkSai_Input = 1 Then
''                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ, "001")
''                    Call UniCode_Conv(Y_SYU_HREC.OKURI_NO_SEQ_TO, Format(KUTI_SU, "000"))
''                End If
                                            
                Call UniCode_Conv(Y_SYU_HREC.UPD_TANTO, StrConv(App.EXEName, vbUpperCase))
                Call UniCode_Conv(Y_SYU_HREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                                            
                                            
                Do
                    sts = BTRV(BtOpUpdate, Y_SYU_H_POS, Y_SYU_HREC, Len(Y_SYU_HREC), K4_Y_SYU_H, Len(K4_Y_SYU_H), 4)
                    Select Case sts
                        Case BtNoErr
                            Exit Do
                        Case BtErrFILE_INUSE, BtErrRECORD_INUSE
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).ID_NO, "出荷予定(H)使用中", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            GoTo Abort_Tran
                    
                        Case Else
                            Call File_Error(sts, BtOpUpdate, "出荷予定(H)", 0)
                            Inspe_Proc_SEK = SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                    End Select
                Loop
                
            
                
                com = BtOpGetNext
            
            Loop
            
                                'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
    
    
    
    
    
    
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    
    
    
    
    
    
    
        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2013.07.25
        Case Step_Check_RES
        
            For i = 0 To M_Gyo - 1
                Select Case i
                    Case 4
        
                        If Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) <> "0" And Trim(ID_KANRI_TBL(ING_No).Recv_text(i)) <> "9" Then
                        
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "[0] OR [9]", "を入力してください", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_SEK = False
                            Exit Function
                        
                        End If
        
        
        
        
                        Select Case Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                            Case "0"
        
                                If Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_NO) = "" Then
                        
                        
                                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                                    
                                    '-----------------------------------------------ヘッダー
                                    Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
                                    '-----------------------------------------------１行目
                                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                            '表示内容
'2017.09.22
                                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(0).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(0).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                            '入力桁数
                                    Send_Text.Box_Type(0).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                                    '-----------------------------------------------２行目
                                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                            '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(0/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(1).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(1).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                            '入力桁数
                                    Send_Text.Box_Type(1).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                    '-----------------------------------------------３行目
                                                                                            'BOX属性
                                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                            '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI)
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(2).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(2).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                            '入力桁数
                                    Send_Text.Box_Type(2).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    '-----------------------------------------------４行目
                                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                            '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_UNSOU_KAISHA) & LCD_OKURI_NO)
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = "01"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                            '入力桁数
                                    Send_Text.Box_Type(3).Max_Size = "20"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------５行目
                                                                                            'BOX属性
            
'                                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                            '表示内容
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                            '数値初期表示
'                                    Send_Text.Box_Type(4).INIT = ""
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                            '初期カーソル位置
'                                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                            '入力桁数
'                                     Send_Text.Box_Type(4).Max_Size = "00"
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                            
'                                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
            
                                    Call Wel_Clear_Text_Proc                 '2016.01.26
            
            
                                    Sendbuf = Text_Create_Proc()
                    
                                Else
                    
                                    Call SEK_Kenpin_Count_Proc(Sumi_CNT)
                        
                                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                                    '-----------------------------------------------ヘッダー
                                    'Send_Text.sts = Sts_OK                                  'ステータス　OK
                                    'ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                                    '
                                    'Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                                    'ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                                    '
                                    'Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                    'ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                                    '
                                    'Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                    'ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                                    '
                                    'Send_Text.FileName = ""                                 '送信データファイル名
                                    'ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                                    '
                                    'Send_Text.Buzzer = Buzzer_DEF                           'ブザー音　標準
                                    'ID_KANRI_TBL(ING_No).Send_Text.Buzzer = Buzzer_DEF
                                    
                                    Call Wel_Head_Text_Proc             '2013.07.25 --> Wel_Head_Text_Proc
                                    
                                    '-----------------------------------------------１行目
                                                                    'BOX属性
                                    Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                            '表示内容
'2017.09.22
                                    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(0).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(0).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                            '入力桁数
                                    Send_Text.Box_Type(0).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            
                                    
                                    '-----------------------------------------------２行目
                                    Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                            '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_ID_No & ":" & Trim(ID_KANRI_TBL(ING_No).ID_NO) & "(" & Format(Sumi_CNT, "0") & "/" & Format(UBound(ID_KANRI_TBL(ING_No).SEK_KENPIN_TBL) + 1, "0") & ")")
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(1).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(1).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                            '入力桁数
                                    Send_Text.Box_Type(1).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                                    '-----------------------------------------------３行目
                                                                                                    'BOX属性
                                    Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                            '表示内容
                                                                                            
                                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(ID_KANRI_TBL(ING_No).KEN_OKURI_SAKI))
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(2).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(2).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                            '入力桁数
                                    Send_Text.Box_Type(2).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                            
                                    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                                    '-----------------------------------------------４行目
                                    Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                            '表示内容
                                                                                        '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SEK_ID_NO)
                                                                                            '数値初期表示
                                    Send_Text.Box_Type(3).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                            '初期カーソル位置
                                    Send_Text.Box_Type(3).Start_Pos = "01"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                            '入力桁数
                                    Send_Text.Box_Type(3).Max_Size = "20"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                            
                                    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                                    '-----------------------------------------------５行目
                                                                                            'BOX属性
            
'                                    Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                                                                            '表示内容
'                                    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
'                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
'                                                                                            '数値初期表示
'                                    Send_Text.Box_Type(4).INIT = ""
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                                                                                            '初期カーソル位置
'                                    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                                                                                            '入力桁数
'                                     Send_Text.Box_Type(4).Max_Size = "00"
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'
'                                    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
'                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
                    
                                    Call Wel_Clear_Text_Proc                 '2016.01.26
                    
                    
                                    Sendbuf = Text_Create_Proc()
                                End If
                            Case "9"
                        
                                Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
                                Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
                                sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
                                Select Case sts
                                    Case BtNoErr
                                    '   -------------------------------- エラーメッセージ作成
                                    Case Else
                                    '重要な要因なので未登録はシステム停止とする
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                                    Exit Function
                                End Select
                                
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                If Sagyo_Send_Proc() Then
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                End If
                                
                                Sendbuf = Text_Create_Proc()
                        
                        
                        End Select
                End Select
            Next i
        
        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> 2013.07.25
    
    End Select
                    
                    

    Inspe_Proc_SEK = False
    
    Exit Function

Abort_Tran:
    
   sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

    


End Function



Public Function Inspe_Proc_Su(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『数量検品処理』
'       2014.03.05
'
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8
Dim Hinban          As String * 20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1
Dim HIN_NO          As String * 13


Dim KAN_FLG         As String * 1

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1


Dim wkTEXT          As String

Dim MENU_NO         As String * 2

Dim Inspe_SU        As Long





    Inspe_Proc_Su = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（伝票ＩＤ）
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_ID_No      '伝票ＩＤ
    
    
                        If Len(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) = 13 Then
                            
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "検品作業不可", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_Su = False
                            Exit Function
                        End If
    
    
                        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
                        sts = Y_Syuka_Chek_Proc(KAN_KBN_FIN, _
                                                ID_KANRI_TBL(ING_No).JGYOBU, _
                                                NAIGAI, _
                                                Hinban, _
                                                MTS_CODE, _
                                                SS_CODE, _
                                                CYU_KBN, _
                                                Y_SYU_CNT, _
                                                ID_NO, _
                                                SYUKA_QTY, _
                                                DEN_NO, _
                                                KAN_KBN, _
                                                JITU_QTY)
                        Select Case sts
                            Case False          '正常
                                If Y_SYU_CNT = 0 Then   '対象データなし
'2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Inspe_Proc_Su = False
                                    Exit Function
                                End If
                
                            Case True
                            Case SYS_ERR
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                            Case SYS_CANCEL
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Sendbuf = Text_Create_Proc()
                                Inspe_Proc_Su = False
                                Exit Function
                        End Select
                
                        '------------------ 向け先のチェック
                        If ID_KANRI_TBL(ING_No).MTS_CODE <> MTS_CODE Or _
                            ID_KANRI_TBL(ING_No).SS_CODE <> SS_CODE Then
                            
                            
                            sts = Data_Clear_Proc(0, Sendbuf)
                            Select Case sts
                                Case SYS_CANCEL
                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                                
                                Case SYS_ERR
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                            
                            
'2017.09.22
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "向け先エラー", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_Su = False
                            Exit Function
                        End If
                        '------------------ 注文区分のチェック
'                        If ID_KANRI_TBL(ING_No).CYU_KBN <> CYU_KBN Then
'
'
'
'                            sts = Data_Clear_Proc(0, Sendbuf)
'                            Select Case sts
'                                Case SYS_CANCEL
'                                    Call Err_Send_Proc("データ使用中", "", "", "", "")
'                                    Sendbuf = Text_Create_Proc()
'                                    Exit Function
'
'                                Case SYS_ERR
'                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                    Sendbuf = Text_Create_Proc()
'                                    Exit Function
'                            End Select
'
'
'                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_NO, "注文区分ミス", "", "")
'                            Sendbuf = Text_Create_Proc()
'                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                            Inspe_Proc = False
'                            Exit Function
'                        End If
                        '------------------ 出庫完了のチェック
                        If Inspection_Flg = 0 Then
                            If KAN_KBN <> KAN_KBN_FIN Then
                                
                                sts = Data_Clear_Proc(0, Sendbuf)
                                Select Case sts
                                    Case SYS_CANCEL
                                        Call Err_Send_Proc("データ使用中", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                    
                                    Case SYS_ERR
                                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Exit Function
                                End Select
                                
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出庫作業未完了", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                Inspe_Proc_Su = False
                                Exit Function
                            End If
                        End If
                        
                        ID_KANRI_TBL(ING_No).ID_NO = ID_NO
                        ID_KANRI_TBL(ING_No).Hinban = Hinban
                        ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
                        ID_KANRI_TBL(ING_No).Y_SYU_CNT = Y_SYU_CNT
                        ID_KANRI_TBL(ING_No).SYUKA_QTY = JITU_QTY
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        'Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_Suryo)
                        'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_Suryo)
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_CNT)                       '2014.03.19
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_CNT)  '2014.03.19
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = "10"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "10"
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "05"
                                                                                
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（数量）
            For i = 0 To M_Gyo - 1
            
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
                
                Select Case wkTEXT
                
                                    
                    'Case LCD_Suryo     '数量  '2014.03.19
                    Case LCD_CNT        '回数   '2014.03.19
                        
                        
                        If Not IsNumeric(ID_KANRI_TBL(ING_No).Recv_text(i)) Then
                        
                            'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "数量を正しく入力して", "下さい", "")   '2014.03.19
'2017.09.22
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "回数を正しく入力して", "下さい", "")    '2014.03.19
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            Inspe_Proc_Su = False
                            Exit Function
                        
                        End If
                        
                        Inspe_SU = Val(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                
                        ID_KANRI_TBL(ING_No).Inspe_SU = Inspe_SU
                        ID_KANRI_TBL(ING_No).Inspe_CNT = 0
                
                
                
                
                
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
'2017.09.22
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        'Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "数量:" & Format(Inspe_SU, "#"))                      '2014.03.19
                        'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "数量:" & Format(Inspe_SU, "#")) '2014.03.19
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "回数:" & Format(Inspe_SU, "#"))                       '2014.03.19
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "回数:" & Format(Inspe_SU, "#"))  '2014.03.19
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "20"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                         Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                
                
                
                End Select
            
            Next i
        
        
        Case Step_Sagyo3_RES        '3回目の受信（品番）
            For i = 0 To M_Gyo - 1
            
                If Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size) < 1 Then
                    wkTEXT = Trim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                Else
                    wkTEXT = Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
                End If
                
                
                Select Case wkTEXT
                
                                    
                    Case LCD_Hinban '品番
                        
                        
                                                
                        
                        If RTrim(ID_KANRI_TBL(ING_No).Hinban) <> RTrim(ID_KANRI_TBL(ING_No).Recv_text(i)) Then
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'2017.09.22

                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Recv_text(i), "伝票の品番と異なって", "います。", "")
                            Sendbuf = Text_Create_Proc()
                            Inspe_Proc_Su = False
                            Exit Function
                        End If
                        
                
                        ID_KANRI_TBL(ING_No).Inspe_CNT = ID_KANRI_TBL(ING_No).Inspe_CNT + 1
                
                
                        If ID_KANRI_TBL(ING_No).Inspe_SU > ID_KANRI_TBL(ING_No).Inspe_CNT Then
                
                
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                    
                            
                            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                            
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'2017.09.22
                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            'Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "数量:" & Format(ID_KANRI_TBL(ING_No).Inspe_SU, "#"))                         '2014.03.19
                            'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "数量:" & Format(ID_KANRI_TBL(ING_No).Inspe_SU, "#"))    '2014.03.19
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "回数:" & Format(ID_KANRI_TBL(ING_No).Inspe_SU, "#"))                          '2014.03.19
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "回数:" & Format(ID_KANRI_TBL(ING_No).Inspe_SU, "#"))     '2014.03.19
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCANK
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
                        Else
                        
                        
                        
                        
                        
                            ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                            
                            
                            '-----------------------------------------------ヘッダー
                            Send_Text.sts = Sts_OK                                  'ステータス　OK
                            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                    
                            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                    
                            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                    
                            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                    
                            Send_Text.FileName = ""                                 '送信データファイル名
                            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                    
                            
                            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                            
                            
                            '-----------------------------------------------１行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(0).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                    '表示内容
'2017.09.22

                            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(0).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(0).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(0).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                            '-----------------------------------------------２行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(1).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(1).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(1).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(1).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                            '-----------------------------------------------３行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(2).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                    '表示内容
                            'Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "数量:" & Format(ID_KANRI_TBL(ING_No).Inspe_SU, "#"))                         '2014.03.19
                            'Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "数量:" & Format(ID_KANRI_TBL(ING_No).Inspe_SU, "#"))    '2014.03.19
                            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "回数:" & Format(ID_KANRI_TBL(ING_No).Inspe_SU, "#"))                          '2014.03.19
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "回数:" & Format(ID_KANRI_TBL(ING_No).Inspe_SU, "#"))     '2014.03.19
                                                                                    '数値初期表示
                            Send_Text.Box_Type(2).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(2).Start_Pos = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                    '入力桁数
                            Send_Text.Box_Type(2).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    'BOX属性
                            Send_Text.Box_Type(3).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).Hinban)
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                    '数値初期表示
                            Send_Text.Box_Type(3).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(3).Start_Pos = "01"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = "01"
                                                                                    '入力桁数
                            Send_Text.Box_Type(3).Max_Size = "20"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "20"
                                                                                    
                            Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                            '-----------------------------------------------４行目
                                                                                    
                                                                                    'BOX属性
                            Send_Text.Box_Type(4).Box_Type = TYPE_REF
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                    '表示内容
                            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
                                                                                    '数値初期表示
                            Send_Text.Box_Type(4).INIT = ""
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                    '初期カーソル位置
                            Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                    '入力桁数
                             Send_Text.Box_Type(4).Max_Size = "00"
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                    
                            Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    
                            Sendbuf = Text_Create_Proc()
                        
                        
                        
                        
                        
                        
                        
                        
                        End If
                
                End Select
            
            Next i
        
        
        Case Step_Sagyo4_RES        '３回目の受信（Any Key）
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                        
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                        
            Else
                        
                MENU_NO = ""
            End If
                                        
                                        
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)
            sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "出荷予定", 0)
                    Exit Function
            End Select
            
                                        
                                        
            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
                                        
            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    Exit Function
            End Select
                                        
                                        
            Call UniCode_Conv(K0_MTS.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
            Call UniCode_Conv(K0_MTS.SS_CODE, ID_KANRI_TBL(ING_No).SS_CODE)
                                        
            sts = BTRV(BtOpGetEqual, MTS_POS, MTSREC, Len(MTSREC), K0_MTS, Len(K0_MTS), 0)
            Select Case sts
                Case BtNoErr
                
                
                Case BtErrKeyNotFound
                
                    Call UniCode_Conv(MTSREC.MUKE_CODE, ID_KANRI_TBL(ING_No).MTS_CODE)
                    Call UniCode_Conv(MTSREC.SS_CODE, ID_KANRI_TBL(ING_No).SS_CODE)
                
                    Call UniCode_Conv(MTSREC.MUKE_DNAME, "")
                    Call UniCode_Conv(MTSREC.MUKE_NAME, "")
                    Call UniCode_Conv(MTSREC.SS_NAME, "")
                
                
                
                '   -------------------------------- エラーメッセージ作成
                
                            
                
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    Exit Function
            End Select
                                        
                                        
            '2014.03.19 "読込み回数"-->"スキャン回数"
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        StrConv(Y_SYUREC.CYU_KBN, vbUnicode), _
                                        "スキャン回数:" & Format(ID_KANRI_TBL(ING_No).Inspe_SU, "#"), , , , , MENU_NO, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE, _
                                        ID_KANRI_TBL(ING_No).SS_CODE, _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Inspe_Proc_Su = SYS_ERR
                    GoTo Abort_Tran
            End Select
                                        
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    Inspe_Proc_Su = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function




Public Function T_back_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『引取処理 (広島)』
'
'       2015.01.22
'       2016.06.22  改訂
'-------------------------------------------------------

Dim sts             As Integer

Dim HIKI_ID         As String * 18

Dim Hinban          As String * 20
Dim wkHinban        As String * 20  '2016.12.08

Dim JITU_SURYO      As Long

Dim RET_JGYOBU      As String * 1   '2016.06.22
Dim RET_NAIGAI      As String * 1   '2016.06.22


Dim wkSuryo         As String * 7

Dim G_Messege       As String

Dim i               As Integer

Dim MENU_NO         As String * 2


'Dim T_back_F        As Boolean     2016.07.04


    T_back_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        
        Case Step_Sagyo1_RES        '引取ID
                
        
            For i = 0 To M_Gyo - 1
                
                Select Case i
                    Case 1
        
        
'                        T_back_F = False        '2016.06.22        2016.07.04
        
        
                        HIKI_ID = ID_KANRI_TBL(ING_No).Recv_text(i)
        
                        
'                        If Mid(HIKI_ID, 16, 1) = "A" Then   '2016.06.22    2016.07.04
'                            T_back_F = True                 '2016.06.22    2016.07.04
'                        End If                              '2016.06.22    2016.07.04
        
        
        
    
                        '---------------------  <入荷予定　読込> --------------------------------------------
                        Call UniCode_Conv(K0_Y_NYU.JGYOBU, Mid(HIKI_ID, 1, 1))          '事業部
                        Call UniCode_Conv(K0_Y_NYU.SYUKA_YMD, Mid(HIKI_ID, 2, 8))       '日付
                        Call UniCode_Conv(K0_Y_NYU.TEXT_NO, Mid(HIKI_ID, 10, 9))        'ﾃｷｽﾄ
                        sts = BTRV(BtOpGetEqual, Y_NYU_POS, Y_NYUREC, Len(Y_NYUREC), K0_Y_NYU, Len(K0_Y_NYU), 0)
                        Select Case sts
                            Case BtNoErr
'                                '追加用ダミー解除
'                                T_back_F = False                 '2016.06.22   2016.07.04
                            
                            Case BtErrKeyNotFound
                                    
'                                If Not T_back_F Then        '2016.06.22        2016.07.04
                                '   -------------------------------- データ未登録　エラーメッセージ作成
                                    Call Err_Send_Proc(HIKI_ID, "該当データなし", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    T_back_PROC = False
                                    Exit Function

'                                End If                                         2016.07.04
                            
                            Case Else
                            '   -------------------------------- 読込異常　エラーメッセージ作成
                                Call Err_Send_Proc(HIKI_ID, "Error:" & sts, "", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                T_back_PROC = False
                                Exit Function
                        End Select
                        
        
        
                           
                        ID_KANRI_TBL(ING_No).T_back_Hiki_ID = HIKI_ID
                        
'                        ID_KANRI_TBL(ING_No).T_back_F = T_back_F                                                '2016.06.22    2016.07.04
                        ID_KANRI_TBL(ING_No).T_back_KAN_KBN = StrConv(Y_NYUREC.KAN_KBN, vbUnicode)              '2016.06.22
                            
                        

                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
                        
'                        If T_back_F Then            '2016.06.22                                                                2016.07.04
'                                                                                                                               2016.07.04
'                            ID_KANRI_TBL(ING_No).Hinban = ""                        '品番をセーブ           2016.06.22         2016.07.04
'                            ID_KANRI_TBL(ING_No).T_back_SURYO = 0                   '送信する引取数(数量)   2016.06.22         2016.07.04
'                            ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO = 0              '送信する実績数(数量)   2016.06.22         2016.07.04
'                        Else                                                                                '2016.06.22        2016.07.04
                            ID_KANRI_TBL(ING_No).Hinban = StrConv(Y_NYUREC.HIN_NO, vbUnicode)                       '品番をセーブ
                            ID_KANRI_TBL(ING_No).T_back_SURYO = Val(StrConv(Y_NYUREC.SURYO, vbUnicode))             '送信する引取数(数量)
                            ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO = Val(StrConv(Y_NYUREC.JITU_SURYO, vbUnicode))   '送信する実績数(数量)
                            ID_KANRI_TBL(ING_No).T_back_ID_No = StrConv(Y_NYUREC.ID_NO, vbUnicode)          'ID_NO 2016.07.06
                            
'                        End If                                                                              '2016.06.22        2016.07.04
                        
                        
                        Call T_back_Step_1_Proc     '送信ﾊﾟﾗﾒｰﾀ作成
                        
        
                        Sendbuf = Text_Create_Proc()

        
                End Select
        
        
            Next i
        
        
        
        
        
        
        Case Step_Sagyo2_RES        '品番   2016.06.22　品番入力追加
                
        
            For i = 0 To M_Gyo - 1
                
                Select Case i
                    Case 2
        
        
        
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                        wkHinban = Replace(Hinban, " ", "")             '2016.12.08
                                        
                        If Left(Hinban, 5) = "品番を入力" Then
                            Hinban = ""
                        End If
                        
'                        If (Not ID_KANRI_TBL(ING_No).T_back_F And Trim(Hinban) = ".") Or (ID_KANRI_TBL(ING_No).T_back_F And Trim(Hinban) = "") Then                            '2016.06.29
'                        If (Not ID_KANRI_TBL(ING_No).T_back_F And Trim(Hinban) = ".") Or (ID_KANRI_TBL(ING_No).T_back_F And Trim(ID_KANRI_TBL(ING_No).Hinban) = "") Then       '2016.06.29 2016.07.04
'                        If (Trim(Hinban) = ".") Or (Trim(ID_KANRI_TBL(ING_No).Hinban) = "") Then                                    '2016.07.04 2016.07.05
                        If (Trim(Hinban) = ".") Then                                                                                 '2016.07.04 2016.07.05
                        
                        Else
                            
'                            If ID_KANRI_TBL(ING_No).T_back_F Then  2016.07.04
                            
                                sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                                Select Case sts
                                    Case BtNoErr
                                    
                                    Case BtErrKeyNotFound
                                    
                                    
                                    
                                    
                                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2016.12.08(空白を除外して再読み込み)
                                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, wkHinban, RET_JGYOBU, RET_NAIGAI)
                                        Select Case sts
                                            Case BtNoErr
                                            Case BtErrKeyNotFound
                                            '   -------------------------------- エラーメッセージ作成
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, ID_KANRI_TBL(ING_No).Hinban, Hinban, "品番未登録", "")
            
            
                                                Sendbuf = Text_Create_Proc()
                                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                                T_back_PROC = False
                                                Exit Function
            
                                            Case Else
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, "ITEM.DAT", "Error:" & sts, "", "")
                                                Sendbuf = Text_Create_Proc()
                                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                                T_back_PROC = False
                                                Exit Function
            
                                        End Select
                                        '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2016.12.08(空白を除外して再読み込み)
                                    
                                    
                                    '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2016.12.08
                                    ''   -------------------------------- エラーメッセージ作成
                                    '    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, ID_KANRI_TBL(ING_No).Hinban, Hinban, "品番未登録", "")
                                    '
                                    '
                                    '    Sendbuf = Text_Create_Proc()
                                    '    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    '    T_back_PROC = False
                                    '    Exit Function
                                    '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>    2016.12.08
    
                                    Case Else
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, "ITEM.DAT", "Error:" & sts, "", "")
                                        Sendbuf = Text_Create_Proc()
                                        Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                        T_back_PROC = False
                                        Exit Function
    
                                End Select
'                            End If                                 2016.07.04
        
        
        
'                            If ID_KANRI_TBL(ING_No).T_back_F Then      2016.07.04
'                                ID_KANRI_TBL(ING_No).Hinban = Hinban   2016.07.04
'                            End If                                     2016.07.04
                                    
        
                            If Trim(ID_KANRI_TBL(ING_No).Hinban) <> "" Then '2016.07.05
                                If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                                    If Trim(wkHinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then '2016.12.08
                                
                                    
                                    '   -------------------------------- エラーメッセージ作成
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, ID_KANRI_TBL(ING_No).Hinban, Hinban, "品番エラー", "")
                            
                                        
                                        Sendbuf = Text_Create_Proc()
                                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                        T_back_PROC = False
                                        Exit Function
                                    End If                                                      '2016.12.08
                                End If
                            End If                                          '2016.07.05

                        End If
                            
'                        If ID_KANRI_TBL(ING_No).T_back_F Then      2016.07.04
'                            ID_KANRI_TBL(ING_No).Hinban = Hinban   2016.07.04
'                        End If                                     2016.07.04
                            
                            
                        ID_KANRI_TBL(ING_No).T_back_IN_HINBAN = Hinban
                        ID_KANRI_TBL(ING_No).T_back_IN_wkHINBAN = wkHinban      '2016.12.08
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
            
                        
                        Call T_back_Step_2_Proc     '送信ﾊﾟﾗﾒｰﾀ作成
                        
        
                        Sendbuf = Text_Create_Proc()

        
                End Select
        
        
            Next i
        
        
        
        Case Step_Sagyo3_RES        '２回目の受信（実績数量）
            For i = 0 To M_Gyo - 1
                
                Select Case i
                
                    Case 1
    
    
                    Case 2
    
                    Case 3
                       
                    Case 4
                        
                        If Not IsNumeric(ID_KANRI_TBL(ING_No).Recv_text(i)) Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, ID_KANRI_TBL(ING_No).Hinban, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数値エラー", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            T_back_PROC = False
                            Exit Function
                        
                        End If
                        
                        JITU_SURYO = Val(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        
                        ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO = JITU_SURYO
        

                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo4_REQ
                        
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).T_back_Hiki_ID)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).T_back_Hiki_ID)
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                'メニュ―番号
                        Send_Text.Box_Type(0).MENU = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                'メニュ―番号
                        Send_Text.Box_Type(1).MENU = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        wkSuryo = Space(7 - Trim(Len(Format(ID_KANRI_TBL(ING_No).T_back_SURYO, "#")))) & Format(ID_KANRI_TBL(ING_No).T_back_SURYO, "#")
                        
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "引 取 数：" & wkSuryo)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "引 取 数：" & wkSuryo)
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                'メニュ―番号
                        Send_Text.Box_Type(2).MENU = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        
                        
                        wkSuryo = Space(7 - Trim(Len(Format(ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO, "#0")))) & Format(ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO, "#0")
                        
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "実 績 数：" & wkSuryo)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "実 績 数：" & wkSuryo)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------５行目
'2016.06.22                        If 0 = ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO Then
'2016.06.22                            G_Messege = "ENT:引取ｷｬﾝｾﾙ C:戻る"
'2016.06.22                        Else
                            If ID_KANRI_TBL(ING_No).T_back_SURYO = ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO Then
                                G_Messege = "ENT:引取OK C:戻る"
                            Else
                                If ID_KANRI_TBL(ING_No).T_back_SURYO > ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO Then
                                    G_Messege = "ENT:不足OK C:戻る"
                                Else
                                    If ID_KANRI_TBL(ING_No).T_back_SURYO < ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO Then
                                        G_Messege = "ENT:過剰OK c: 戻る"
                                    End If
                                End If
                            End If
'2016.06.22                        End If
                                                                                
                                                                                
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, G_Messege)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, G_Messege)
                                                                                '数値初期表示
                        Send_Text.Box_Type(4).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(4).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(4).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                                'メニュ―番号
                        Send_Text.Box_Type(4).MENU = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
                        Sendbuf = Text_Create_Proc()
                        
                        
                End Select
        
        
            Next i
                        
                        
                        
                        
        Case Step_Sagyo4_RES        '４回目の受信（確認）
                        
                    
                    
'            '---------------------  <入荷予定　読込> --------------------------------------------
'            Call UniCode_Conv(K0_Y_NYU.JGYOBU, Mid(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, 1, 1))          '事業部
'            Call UniCode_Conv(K0_Y_NYU.SYUKA_YMD, Mid(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, 2, 8))       '日付
'            Call UniCode_Conv(K0_Y_NYU.TEXT_NO, Mid(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, 10, 10))       'ﾃｷｽﾄ
'            sts = BTRV(BtOpGetEqual, Y_NYU_POS, Y_NYUREC, Len(Y_NYUREC), K0_Y_NYU, Len(K0_Y_NYU), 0)
'
'            Select Case sts
'                Case BtNoErr
'
'                Case BtErrKeyNotFound
'                '   -------------------------------- データ未登録　エラーメッセージ作成
'                    Call Err_Send_Proc(HIKI_ID, "該当データなし", "", "", "")
'                    Sendbuf = Text_Create_Proc()
'                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                    T_back_PROC = False
'                    Exit Function
'                Case Else
'                '   -------------------------------- 読込異常　エラーメッセージ作成
'                    Call Err_Send_Proc(HIKI_ID, "Error:" & sts, "", "", "")
'                    Sendbuf = Text_Create_Proc()
'                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
'                    T_back_PROC = False
'                    Exit Function
'            End Select
'
'                                                                    '完了区分
'            If ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO = 0 Then
'                Call UniCode_Conv(Y_NYUREC.KAN_KBN, KAN_KBN_UN)     '未完
'                Call UniCode_Conv(Y_NYUREC.KAN_DT, "")
'            Else
'                Call UniCode_Conv(Y_NYUREC.KAN_KBN, KAN_KBN_FIN)    '完了
'                Call UniCode_Conv(Y_NYUREC.KAN_DT, Format(Now, "YYYYMMDD"))
'            End If
'                                                                    '実績数量
'            Call UniCode_Conv(Y_NYUREC.JITU_SURYO, Format(ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO, "0000000"))
'                                                                    '更新　担当者
'            'Call UniCode_Conv(Y_NYUREC.UPD_TANTO, App.EXEName)                             '2015.04.22
'            Call UniCode_Conv(Y_NYUREC.UPD_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)          '2015.04.22
'
'
'                                                                    '更新　日時
'            Call UniCode_Conv(Y_NYUREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
'
'
'            '書き込み   -------------
'            sts = BTRV(BtOpUpdate, Y_NYU_POS, Y_NYUREC, Len(Y_NYUREC), K0_Y_NYU, Len(K0_Y_NYU), 0)
'            Select Case sts
'                Case BtNoErr
'                Case Else
'                    Call File_Error(sts, BtOpUpdate, "入荷予定", 0)
'                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                    Sendbuf = Text_Create_Proc()
'                    Exit Function
'            End Select
                
                
'>>>>>>>>>>>>>>>>>  入荷予定更新    2016.06.22
            If T_back_Update_Proc() Then
                Call File_Error(sts, BtOpUpdate, "入荷予定", 0)
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
'>>>>>>>>>>>>>>>>>  入荷予定更新    2016.06.22
                
                
                
            '-------------------------------------------    作業ログ出力
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                        
                MENU_NO = ""
            End If
                    
            If Trim(MENU_NO) = "" Then
            Else
'>>>>>>>>>  2016.07.08
'                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
'                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
'                                            ID_KANRI_TBL(ING_No).JGYOBU, _
'                                            ID_KANRI_TBL(ING_No).NAIGAI, _
'                                            MENU_NO, _
'                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
'                                            ID_KANRI_TBL(ING_No).Hinban, , ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO, , , _
'                                            Mid(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, 10, 10), , , , , , , , , _
'                                            ID_KANRI_TBL(ING_No).T_back_Hiki_ID) Then
'                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
'                                Sendbuf = Text_Create_Proc()
'                                Exit Function
'                End If
            
            
            
            
            
    '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2016.12.08
    
    '            If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
    '                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
    '                                        ID_KANRI_TBL(ING_No).JGYOBU, _
    '                                        ID_KANRI_TBL(ING_No).NAIGAI, _
    '                                        MENU_NO, _
    '                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
    '                                        ID_KANRI_TBL(ING_No).Hinban, , ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO, , , _
    '                                        ID_KANRI_TBL(ING_No).T_back_ID_No, , , , , , , , , _
    '                                        ID_KANRI_TBL(ING_No).T_back_Hiki_ID) Then
    '                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
    '                            Sendbuf = Text_Create_Proc()
    '                            Exit Function
    '            End If
    
    
                If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                            (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                            ID_KANRI_TBL(ING_No).JGYOBU, _
                                            ID_KANRI_TBL(ING_No).NAIGAI, _
                                            MENU_NO, _
                                            (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                            ID_KANRI_TBL(ING_No).T_back_IN_HINBAN, , ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO, , , _
                                            ID_KANRI_TBL(ING_No).T_back_ID_No, , , , , , , , , _
                                            ID_KANRI_TBL(ING_No).T_back_Hiki_ID) Then
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                End If
    
    '>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>   2016.12.08
            
            
            
'>>>>>>>>>  2016.07.08
            
            End If
            '-------------------------------------------    更新完了
                        
                        
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
    
    
    End Select

    T_back_PROC = False


End Function



Public Sub T_back_Step_1_Proc()
        
Dim wkSuryo         As String * 7
        
        
    '数量付きの送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

    Send_Text.FileName = ""                                 '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""

    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                    
    '-----------------------------------------------１行目
                                                            'BOX属性
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).T_back_Hiki_ID)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).T_back_Hiki_ID)
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(0).Max_Size = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = ""
                                                            'メニュ―番号
    Send_Text.Box_Type(0).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    '-----------------------------------------------２行目
                                                            'BOX属性
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(1).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                            'メニュ―番号
    Send_Text.Box_Type(1).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    
    
    
    
    
    '-----------------------------------------------３行目                  '2016.06.22
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                            '表示内容
    
    
    If ID_KANRI_TBL(ING_No).T_back_KAN_KBN = "8" Then
        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "品番を入力(未ﾁｪｯｸ)")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "品番を入力(未ﾁｪｯｸ)")
    Else
        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "品番を入力")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "品番を入力")
    End If
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "20"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                            'メニュ―番号
    Send_Text.Box_Type(2).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    '-----------------------------------------------３行目-->４行目 2016.06.22
                                                            'BOX属性
    Send_Text.Box_Type(3).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
    
'    If ID_KANRI_TBL(ING_No).T_back_F And (ID_KANRI_TBL(ING_No).T_back_KAN_KBN <> "8" And ID_KANRI_TBL(ING_No).T_back_KAN_KBN <> "9") Then   '2016.06.22    2016.07.04
'        wkSuryo = ""                            '2016.06.22                                                                                                2016.07.04
'    Else                                        '2016.06.22                                                                                                2016.07.04
        wkSuryo = Space(7 - Trim(Len(Format(ID_KANRI_TBL(ING_No).T_back_SURYO, "#")))) & Format(ID_KANRI_TBL(ING_No).T_back_SURYO, "#")
'    End If                                      '2016.06.22                                                                                                2016.07.04
    
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "引 取 数：" & wkSuryo)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "引 取 数：" & wkSuryo)
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                            'メニュ―番号
    Send_Text.Box_Type(3).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    '-----------------------------------------------４行目-->５行目 2016.06.22
                                                            'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    If ID_KANRI_TBL(ING_No).T_back_KAN_KBN = "8" Or ID_KANRI_TBL(ING_No).T_back_KAN_KBN = "9" Then      '2016.06.22
        
        wkSuryo = Space(7 - Trim(Len(Format(ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO, "#")))) & Format(ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO, "#")
                                                                
        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "実 績 数：" & wkSuryo)
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "実 績 数：" & wkSuryo)
                                                                '数値初期表示
        Send_Text.Box_Type(3).INIT = "   " & wkSuryo
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = "   " & wkSuryo
                                                            
    Else                                                                                                '2016.06.22
        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "実 績 数：")                                      '2016.06.22
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "実 績 数：")                 '2016.06.22
                                                                '数値初期表示
        Send_Text.Box_Type(3).INIT = ""                                                                 '2016.06.22
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""                                            '2016.06.22
    End If                                                                                              '2016.06.22
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = "11"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "11"
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = "07"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"
                                                            
    Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
    '-----------------------------------------------５行目-->× 2016.06.22
'                                                            'BOX属性
'    Send_Text.Box_Type(4).Box_Type = TYPE_REF
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
'                                                            '表示内容
'    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
'    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
'                                                            '数値初期表示
'    Send_Text.Box_Type(4).INIT = ""
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
'                                                            '初期カーソル位置
'    Send_Text.Box_Type(4).Start_Pos = ""
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                                                            '入力桁数
'    Send_Text.Box_Type(4).Max_Size = "00"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
'                                                            'メニュ―番号
'    Send_Text.Box_Type(4).MENU = ""
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
'

End Sub
                                    
                                    
Public Sub T_back_Step_2_Proc()
'2016.06.22
        
Dim wkSuryo         As String * 7
        
        
    '数量付きの送信メッセージを作成する
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

    Send_Text.FileName = ""                                 '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""

    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                    
    '-----------------------------------------------１行目
                                                            'BOX属性
    Send_Text.Box_Type(0).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).T_back_Hiki_ID)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).T_back_Hiki_ID)
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(0).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(0).Max_Size = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = ""
                                                            'メニュ―番号
    Send_Text.Box_Type(0).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    '-----------------------------------------------２行目
                                                            'BOX属性
    Send_Text.Box_Type(1).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    
'    If ID_KANRI_TBL(ING_No).T_back_F Then                                      2016.07.04
'        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "")                       2016.07.04
'        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "")  2016.07.04
'    Else                                                                       2016.07.04
        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, ID_KANRI_TBL(ING_No).Hinban)
'    End If                                                                     2016.07.04
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(1).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(1).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                            'メニュ―番号
    Send_Text.Box_Type(1).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    
    
    
    
    
    '-----------------------------------------------３行目                  '2016.06.22
                                                            'BOX属性
    Send_Text.Box_Type(2).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
    
    
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).T_back_IN_HINBAN)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, ID_KANRI_TBL(ING_No).T_back_IN_HINBAN)
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(2).Start_Pos = "01"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                                            '入力桁数
    Send_Text.Box_Type(2).Max_Size = "20"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                                            'メニュ―番号
    Send_Text.Box_Type(2).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    '-----------------------------------------------３行目-->４行目 2016.06.22
                                                            'BOX属性
    Send_Text.Box_Type(3).Box_Type = TYPE_REF
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
    
'    If ID_KANRI_TBL(ING_No).T_back_F Then       '2016.06.22    2016.07.04
'        wkSuryo = ""                            '2016.06.22    2016.07.04
'    Else                                        '2016.06.22    2016.07.04
        wkSuryo = Space(7 - Trim(Len(Format(ID_KANRI_TBL(ING_No).T_back_SURYO, "#")))) & Format(ID_KANRI_TBL(ING_No).T_back_SURYO, "#")
'    End If                                      '2016.06.22    2016.07.04
    
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "引 取 数：" & wkSuryo)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "引 取 数：" & wkSuryo)
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
    Send_Text.Box_Type(3).Start_Pos = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                            '入力桁数
    Send_Text.Box_Type(3).Max_Size = "00"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                            'メニュ―番号
    Send_Text.Box_Type(3).MENU = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
    '-----------------------------------------------４行目-->５行目 2016.06.22
                                                            'BOX属性
    Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "実 績 数：")                                      '2016.06.22
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "実 績 数：")                 '2016.06.22
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""                                                                 '2016.06.22
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""                                            '2016.06.22
                                                            '初期カーソル位置
    Send_Text.Box_Type(4).Start_Pos = "11"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "11"
                                                            '入力桁数
    Send_Text.Box_Type(4).Max_Size = "07"
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "07"
                                                            
    Send_Text.Box_Type(4).MENU = ""                     'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
End Sub
                                    

Private Function T_back_Update_Proc() As Integer
'2016.06.22
    
Dim sts As Integer
Dim com As Integer
    
    
    
    
    
    
                    
    '---------------------  <入荷予定　読込> --------------------------------------------
    Call UniCode_Conv(K0_Y_NYU.JGYOBU, Mid(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, 1, 1))          '事業部
    Call UniCode_Conv(K0_Y_NYU.SYUKA_YMD, Mid(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, 2, 8))       '日付
    Call UniCode_Conv(K0_Y_NYU.TEXT_NO, Mid(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, 10, 10))       'ﾃｷｽﾄ
    sts = BTRV(BtOpGetEqual, Y_NYU_POS, Y_NYUREC, Len(Y_NYUREC), K0_Y_NYU, Len(K0_Y_NYU), 0)
                
    Select Case sts
        Case BtNoErr
            
            com = BtOpUpdate
        
        Case BtErrKeyNotFound
        
            com = BtOpInsert
        
        
            Call UniCode_Conv(Y_NYUREC.KAN_KBN, "")         '完了区分
            Call UniCode_Conv(Y_NYUREC.DT_SYU, "")          'データ種別
            Call UniCode_Conv(Y_NYUREC.JGYOBU, "")          '事業部区分
            Call UniCode_Conv(Y_NYUREC.NAIGAI, "")          '国内外
            Call UniCode_Conv(Y_NYUREC.TEXT_NO, "")         'テキスト
    
            '-----------------  ﾎｽﾄ入庫ﾃﾞｰﾀｲﾒｰｼﾞ　▽
            Call UniCode_Conv(Y_NYUREC.JGYOBA, "")          '事業場ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.DATA_KBN, "")        'データ区分
            Call UniCode_Conv(Y_NYUREC.TORI_KBN, "")        '取引区分
            Call UniCode_Conv(Y_NYUREC.ID_NO, "")           'ID-NO
            Call UniCode_Conv(Y_NYUREC.KAIKEI_JGYOBA, "")   '会計用事業場ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.SHISAN_JGYOBA, "")   '資産管理用事業場ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.HIN_NO, "")          '品目番号
            Call UniCode_Conv(Y_NYUREC.DEN_NO, "")          '伝票番号
            Call UniCode_Conv(Y_NYUREC.SURYO, "")           '出荷数量
            Call UniCode_Conv(Y_NYUREC.MUKE_CODE, "")       '得意先コード
            Call UniCode_Conv(Y_NYUREC.SYUKO_SYUSI, "")     '在庫収支
            Call UniCode_Conv(Y_NYUREC.SHISAN_SYUSI, "")    '資産管理用在庫収支ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.HOJYO_SYUSI, "")     '補助在庫収支ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.SYUKO_YMD, "")       '出庫日付
            Call UniCode_Conv(Y_NYUREC.TANKA, "")           '実際単価
            Call UniCode_Conv(Y_NYUREC.ODER_NO, "")         'オーダー番号
            Call UniCode_Conv(Y_NYUREC.ITEM_NO, "")         'アイテム番号
            Call UniCode_Conv(Y_NYUREC.ODER_NO_R, "")       '注文管理番号略号
            Call UniCode_Conv(Y_NYUREC.KOSO_KEITAI, "")     '個装形態ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.SYUKA_YMD, "")       '出荷予定日
            Call UniCode_Conv(Y_NYUREC.TANABAN1, "")        'ﾛｹｰｼｮﾝ1
            Call UniCode_Conv(Y_NYUREC.TANABAN2, "")        'ﾛｹｰｼｮﾝ2
            Call UniCode_Conv(Y_NYUREC.TANABAN3, "")        'ﾛｹｰｼｮﾝ3
            Call UniCode_Conv(Y_NYUREC.MUKE_NAME, "")       '得意先名称
            Call UniCode_Conv(Y_NYUREC.CYU_KBN, "")         '注文区分
            Call UniCode_Conv(Y_NYUREC.CYU_KBN_NAME, "")    '注文区分名称
            Call UniCode_Conv(Y_NYUREC.ORIGIN1, "")         '原産国1
            Call UniCode_Conv(Y_NYUREC.ORIGIN2, "")         '原産国2
            Call UniCode_Conv(Y_NYUREC.BIKOU2, "")          '備考2
            Call UniCode_Conv(Y_NYUREC.HAN_KBN, "")         '販売区分
            Call UniCode_Conv(Y_NYUREC.CHOKU_KBN, "")       '直送指示区分
            Call UniCode_Conv(Y_NYUREC.UNIT_ID_NO, "")      'ﾕﾆｯﾄ修正管理番号
            Call UniCode_Conv(Y_NYUREC.ZAIKO_HIKIATE, "")   '在庫引当順序
            Call UniCode_Conv(Y_NYUREC.GOKON_KANRI_NO, "")  '合梱管理番号
            Call UniCode_Conv(Y_NYUREC.JYUCHU_ZAN, "")      '受注残数量
            Call UniCode_Conv(Y_NYUREC.KYOKYU_KBN, "")      '供給区分
            Call UniCode_Conv(Y_NYUREC.SHOHIN_SYUSI, "")    '商品化納品在庫収支ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.S_SHISAN_SYUSI, "")  '商品化納品資産管理収支ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.S_HOJYO_SYUSI, "")   '商品化納品補助収支ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.BIKOU1, "")          '備考1
            Call UniCode_Conv(Y_NYUREC.CHOHA_KBN, "")       '帳端区分
            Call UniCode_Conv(Y_NYUREC.JYU_HIN_NO, "")      '受付品目番号
            Call UniCode_Conv(Y_NYUREC.HIN_NAME, "")        '品名
            Call UniCode_Conv(Y_NYUREC.HIN_CHANGE_KBN, "")  '品目番号変更区分
            Call UniCode_Conv(Y_NYUREC.MODULE_EXCHANGE, "") 'ﾓｼﾞｭｰﾙ交換区分
            Call UniCode_Conv(Y_NYUREC.ZAIKO_SYUSI, "")     '残在庫まとめ在庫収支ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.ZAN_SHISAN_SYUSI, "") '残在庫まとめ資産管理収支ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.ZAN_HOJYO_SYUSI, "") '残在庫まとめ補助収支ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.NOUKI_YMD, "")       '指定納期
            Call UniCode_Conv(Y_NYUREC.SERVICE_KANRI_NO, "") 'ｻｰﾋﾞｽ会社管理番号
            Call UniCode_Conv(Y_NYUREC.KI_HIN_NO, "")       '機種品目ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.ENVIRONMENT_KBN, "") '環境企画部品区分
            Call UniCode_Conv(Y_NYUREC.SS_CODE, "")         '直送相手先ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.KEPIN_KAIJYO, "")    '欠品解消区分
            '-----------------  ﾎｽﾄ入庫ﾃﾞｰﾀｲﾒｰｼﾞ　△
    
            Call UniCode_Conv(Y_NYUREC.KAN_DT, "")          '完了日付
            Call UniCode_Conv(Y_NYUREC.BEF_NYU_QTY, "")     '先行入荷数
            Call UniCode_Conv(Y_NYUREC.YOSAN_FROM, "")      '予算単位（元）
            Call UniCode_Conv(Y_NYUREC.YOSAN_TO, "")        '予算単位（先）
            Call UniCode_Conv(Y_NYUREC.HTANABAN, "")        '標準棚番
            Call UniCode_Conv(Y_NYUREC.HIN_NAI, "")         '品番（内部）
            Call UniCode_Conv(Y_NYUREC.H_SOKO, "")          'ﾎｽﾄ倉庫 2006.10.17
            
            Call UniCode_Conv(Y_NYUREC.NYU_LIST_OUT, "")    '入庫予定出力ﾌﾗｸﾞ 2007.06.12    現在未使用 0:データ出力対象 9:出力済(もしくは出力対象外)
    
            '----------------   2010.07.08 ▽
            Call UniCode_Conv(Y_NYUREC.GENSANKOKU, "")      '原産国名
            Call UniCode_Conv(Y_NYUREC.GEN_GENSANKOKU, "")  '現物表示原産国名
            Call UniCode_Conv(Y_NYUREC.SHIIRE_WORK_CENTER, "") '資材仕入先ﾜｰｸｾﾝﾀｰ
            Call UniCode_Conv(Y_NYUREC.KANKYO_KBN, "")      '環境種類区分
            Call UniCode_Conv(Y_NYUREC.KANKYO_KBN_ST, "")   '環境種類区分適用開始
            Call UniCode_Conv(Y_NYUREC.KANKYO_KBN_SURYO, "") '環境種類区分数量
            Call UniCode_Conv(Y_NYUREC.ID_NO2, "")          'ID_NO
            Call UniCode_Conv(Y_NYUREC.AITESAKI_CODE, "")   '相手先ｺｰﾄﾞ
            Call UniCode_Conv(Y_NYUREC.JYUCHU_YMD, "")      '受注年月日
            Call UniCode_Conv(Y_NYUREC.SHITEI_NOUKI_YMD, "") '指定納期年月日
            Call UniCode_Conv(Y_NYUREC.LIST_OUT_END_F, "")  '入庫関連ﾘｽﾄ出力F    0:複数原産国部品入庫管理ﾘｽﾄまたは入庫／棚番ﾁｪｯｸﾘｽﾄが未処理
                                                            '9:複数原産国部品入庫管理ﾘｽﾄかつ入庫／棚番ﾁｪｯｸﾘｽﾄが処理済
            Call UniCode_Conv(Y_NYUREC.LIST_NYU_KANRI_F, "") '入庫管理ﾘｽﾄ出力F　　「複数原産国部品入庫管理ﾘｽﾄ用」 0:印刷対象(未印刷) 8:印刷対象外　9:印刷済(0→9)
            Call UniCode_Conv(Y_NYUREC.LIST_NYU_CHECK_F, "") '入庫ﾁｪｯｸﾘｽﾄ出力F    「入庫／棚番ﾁｪｯｸﾘｽﾄ用」　0:未印刷 9:印刷済
            Call UniCode_Conv(Y_NYUREC.NYUKO_TANABAN, "")   '入庫棚番
            Call UniCode_Conv(Y_NYUREC.MAEGARI_SURYO, "")   '前借相殺数
    
            Call UniCode_Conv(Y_NYUREC.INS_TANTO, "")       '追加　担当者　     2009.01.21
            Call UniCode_Conv(Y_NYUREC.Ins_DateTime, "")    '追加　日時         2009.01.21

            Call UniCode_Conv(Y_NYUREC.UPD_TANTO, "")       '更新　担当者　     2005.11.15
            Call UniCode_Conv(Y_NYUREC.UPD_DATETIME, "")    '更新　日時         2005.11.15
    
            '----------------   2010.07.08 △
    
            '----------------   2011.03.23 ▽
            Call UniCode_Conv(Y_NYUREC.MOTO_PROG_ID, "")    '発生元プログラム
            Call UniCode_Conv(Y_NYUREC.MOTO_TEXT_NO, "")    '元テキスト
            '----------------   2011.03.23 △
            Call UniCode_Conv(Y_NYUREC.JITU_SURYO, "")      '実績数量           2015.01.21
            Call UniCode_Conv(Y_NYUREC.FILLER, "")          '49-->32-->25       2011.03.23-->2015.01.21
        
        Case Else
        '   -------------------------------- 読込異常　エラーメッセージ作成
            Call File_Error(sts, BtOpGetEqual, "入荷予定", 0)
            Exit Function
    
    End Select
    
    
    Call UniCode_Conv(Y_NYUREC.JGYOBU, Mid(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, 1, 1))          '事業部
    Call UniCode_Conv(Y_NYUREC.SYUKA_YMD, Mid(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, 2, 8))       '日付
    Call UniCode_Conv(Y_NYUREC.TEXT_NO, Mid(ID_KANRI_TBL(ING_No).T_back_Hiki_ID, 10, 10))       'ﾃｷｽﾄ
    
    If Trim(ID_KANRI_TBL(ING_No).T_back_IN_HINBAN) = "." Then
        Call UniCode_Conv(Y_NYUREC.KAN_KBN, "8")    '完了
    Else
        Call UniCode_Conv(Y_NYUREC.KAN_KBN, KAN_KBN_FIN)    '完了
    End If
    Call UniCode_Conv(Y_NYUREC.KAN_DT, Format(Now, "YYYYMMDD"))
                                                            
                                                            
                                                            
'    If ID_KANRI_TBL(ING_No).T_back_F Then          '2016.07.04
    If Trim(ID_KANRI_TBL(ING_No).Hinban) = "" Then           '2016.07.04
'        Call UniCode_Conv(Y_NYUREC.HIN_NO, ID_KANRI_TBL(ING_No).Hinban)                    '品番   2016.07.04
        Call UniCode_Conv(Y_NYUREC.HIN_NO, ID_KANRI_TBL(ING_No).T_back_IN_HINBAN)           '品番   2016.07.04
'        Call UniCode_Conv(Y_NYUREC.SURYO, Format(ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO, "0000000"))    '数量
    End If
                                                                
                                                            
                                                            '実績数量
    Call UniCode_Conv(Y_NYUREC.JITU_SURYO, Format(ID_KANRI_TBL(ING_No).T_back_Jitu_SURYO, "0000000"))
                                                            
'    If ID_KANRI_TBL(ING_No).T_back_F Then                                                              2016.07.04
'                                                                '更新　担当者                          2016.07.04
'        Call UniCode_Conv(Y_NYUREC.INS_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)          '2015.04.22    2016.07.04
'                                                                '更新　日時                            2016.07.04
'        Call UniCode_Conv(Y_NYUREC.Ins_DateTime, Format(Now, "YYYYMMDDHHMMSS"))                        2016.07.04
'    End If                                                                                             2016.07.04
                                                            
                                                            
                                                            
                                                            '更新　担当者
    Call UniCode_Conv(Y_NYUREC.UPD_TANTO, ID_KANRI_TBL(ING_No).TANTO_CODE)          '2015.04.22
                                                            '更新　日時
    Call UniCode_Conv(Y_NYUREC.UPD_DATETIME, Format(Now, "YYYYMMDDHHMMSS"))
                
            
    '書き込み   -------------
    sts = BTRV(com, Y_NYU_POS, Y_NYUREC, Len(Y_NYUREC), K0_Y_NYU, Len(K0_Y_NYU), 0)
    Select Case sts
        Case BtNoErr
        Case Else
            Call File_Error(sts, com, "入荷予定", 0)
            Exit Function
    End Select

End Function
Public Function KENPIN_OSAKA_NEW2_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『大阪ＰＣ　指図表完了　検品処理 未出庫品番表示機能追加』
'       2016.06.27
'
'-------------------------------------------------------
Dim sts             As Integer



Dim SHIJI_No        As String * 8


Dim MENU_NO         As String * 2

Dim ans             As String * 1

Dim i               As Integer


Dim FullPath        As String

Dim com             As Integer

Dim Hinban()        As String * 20
Dim Hin_Cnt         As Integer
Dim FileNo          As Long
Dim SendFileRec     As SendFileRec_Tag
Dim j               As Integer


    KENPIN_OSAKA_NEW2_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票ａj
            For i = 0 To M_Gyo - 1
                
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_SHIJI_NO      '指図票
    
    
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        
                        Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
                        
                        
                        sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "該当データなし", "", "")
                                
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KENPIN_OSAKA_NEW2_PROC = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                        
                        
                
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                            
                            
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "キャンセル済", "", "")
                            
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KENPIN_OSAKA_NEW2_PROC = False
                            Exit Function
                        End If
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "完了済", "", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            KENPIN_OSAKA_NEW2_PROC = False
                            Exit Function
                        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>   未出庫のチェック    2016.06.27
                        Call UniCode_Conv(K0_P_SSHIJI_K.SHIJI_No, SHIJI_No)
                        Call UniCode_Conv(K0_P_SSHIJI_K.DATA_KBN, "")
                        Call UniCode_Conv(K0_P_SSHIJI_K.SEQNO, "")

                        
                        If Trim(KENPIN_OSAKA_NEW2_FILE) = "" Then
                            FullPath = ""
                        Else
                            If Right(F1100101.CtrsWsk1.SendFolder, 1) <> "\" Then
                                FullPath = F1100101.CtrsWsk1.SendFolder & "\" & KENPIN_OSAKA_NEW2_FILE & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
                            Else
                                FullPath = F1100101.CtrsWsk1.SendFolder & KENPIN_OSAKA_NEW2_FILE & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
                            End If
                        End If

                        If Trim(KENPIN_OSAKA_NEW2_FILE) <> "" Then
                            On Error Resume Next
                            Kill (FullPath)             '送信用ファイル削除
                            On Error GoTo 0
                        End If

                        Erase Hinban
                        Hin_Cnt = -1


                        com = BtOpGetGreater


                        Do
                        
                            sts = BTRV(com, P_SSHIJI_K_POS, P_SSHIJI_K_REC, Len(P_SSHIJI_K_REC), K0_P_SSHIJI_K, Len(K0_P_SSHIJI_K), 0)
                            Select Case sts
                                Case BtNoErr
                                                                
                                    If StrConv(P_SSHIJI_K_REC.SHIJI_No, vbUnicode) <> SHIJI_No Then
                                        Exit Do
                                    End If
                                
                                    If StrConv(P_SSHIJI_K_REC.IDO_SUMI, vbUnicode) <> "9" Then
                                        Hin_Cnt = Hin_Cnt + 1
                                        ReDim Preserve Hinban(0 To Hin_Cnt)
                                        Hinban(Hin_Cnt) = StrConv(P_SSHIJI_K_REC.KO_HIN_GAI, vbUnicode)
                                    End If
                                
                                Case BtErrEOF
                                    Exit Do
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Exit Function
                            End Select
                            
                            com = BtOpGetNext
                        
                        Loop

                        If Hin_Cnt <> -1 Then
                            If Trim(KENPIN_OSAKA_NEW2_FILE) = "" Then
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "指図票:" & SHIJI_No, "未出庫品番が有ります", "", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KENPIN_OSAKA_NEW2_PROC = False
                                Exit Function
                            Else
                                FileNo = FreeFile           '送信用ファイルＯＰＥＮ
                                Open FullPath For Binary As #FileNo

                                SendFileRec.Title = "0"     'タイトル行
                                Call UniCode_Conv(SendFileRec.LCD, "指図票:" & SHIJI_No)
                                SendFileRec.CRLF = vbCrLf
                                Put #FileNo, , SendFileRec

                                
                                For Hin_Cnt = 0 To UBound(Hinban)
                                
                                    SendFileRec.Title = "1"
                                    Call UniCode_Conv(SendFileRec.LCD, Hinban(Hin_Cnt))
                                    SendFileRec.CRLF = vbCrLf

                                
                                    Put #FileNo, , SendFileRec
                                
                                Next Hin_Cnt

                                Close #FileNo
                                
                                ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
                                        
                                '送信メッセージを作成する
                                Send_Text.sts = Sts_OK                                  'ステータス　OK
                                ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                                
                                Send_Text.Display_Flg = Display_REF                     '表示画面フラグ 参照画面
                                ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_REF
                                
                                Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                                ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                                
                                Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                                ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                                
                                                                                        '送信データファイル名
                                Send_Text.FileName = KENPIN_OSAKA_NEW2_FILE & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
                                ID_KANRI_TBL(ING_No).Send_Text.FileName = KENPIN_OSAKA_NEW2_FILE & "." & Format(ID_KANRI_TBL(ING_No).ID, "000")
                                
                                Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                                ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                                                    
                                '-----------------------------------------------１〜５行目
                                                                                        
                                For j = 0 To M_Gyo - 1
                                                                                        'BOX属性
                                    Send_Text.Box_Type(j).Box_Type = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Box_Type = ""
                                                                                        '表示内容
                                    Call UniCode_Conv(Send_Text.Box_Type(j).LCD, "")
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, "")
                                                                                        '数値初期表示
                                    Send_Text.Box_Type(j).INIT = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).INIT = ""
                                                                                        
                                                                                        '初期カーソル位置
                                    Send_Text.Box_Type(j).Start_Pos = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Start_Pos = ""
                                                                                        '入力桁数
                                    Send_Text.Box_Type(j).Max_Size = "00"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).Max_Size = "00"
                                                                                        'メニュ―番号
                                    Send_Text.Box_Type(j).MENU = ""
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(j).MENU = ""
                                    
                                Next j
                            
                                Sendbuf = Text_Create_Proc()


                                KENPIN_OSAKA_NEW2_PROC = False
                                Exit Function
                            End If
                        End If
'>>>>>>>>>>>>>>>>>>>>>>>>>>>>   未出庫のチェック    2016.06.27
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = StrConv(P_SSHIJI_O_REC.JGYOBU, vbUnicode)
                        ID_KANRI_TBL(ING_No).S_NAIGAI = StrConv(P_SSHIJI_O_REC.NAIGAI, vbUnicode)
                        
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        
                        '-----------------------------------------------ヘッダー
                        Send_Text.sts = Sts_OK                                  'ステータス　OK
                        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
                
                        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
                        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
                
                        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
                        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
                
                        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
                        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
                
                        Send_Text.FileName = ""                                 '送信データファイル名
                        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
                
                        Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
                        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                        
                        '-----------------------------------------------１行目
                                                                                'BOX属性
                        Send_Text.Box_Type(0).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                                
                        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                                
                                                                                '数値初期表示
                        Send_Text.Box_Type(0).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(0).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(0).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
                        '-----------------------------------------------２行目
                                                                                'BOX属性
                        Send_Text.Box_Type(1).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "指図票ａF" & SHIJI_No)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "指図票ａF" & SHIJI_No)
                                                                                '数値初期表示
                        Send_Text.Box_Type(1).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(1).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(1).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
                        '-----------------------------------------------３行目
                                                                                'BOX属性
                        Send_Text.Box_Type(2).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Trim(StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)))
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Trim(StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)))
                                                                                '数値初期表示
                        Send_Text.Box_Type(2).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(2).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                                '入力桁数
                                                                                
                        Send_Text.Box_Type(2).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                                
                                                                                
                        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(3).Box_Type = TYPE_REF
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SHIJI_END)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SHIJI_END)
                                                                                '数値初期表示
                        Send_Text.Box_Type(3).INIT = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                                '初期カーソル位置
                        Send_Text.Box_Type(3).Start_Pos = ""
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                                '入力桁数
                        Send_Text.Box_Type(3).Max_Size = "00"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                                
                        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
                        '-----------------------------------------------４行目
                                                                                'BOX属性
                        Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                                                '表示内容
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_CAN_ANS)
                                                                                
                        Send_Text.Box_Type(4).INIT = ""                         '数値初期表示
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                                
                        Send_Text.Box_Type(4).Start_Pos = "20"                  '初期カーソル位置
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "20"
                                                                                
                         Send_Text.Box_Type(4).Max_Size = "01"                  '入力桁数
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "01"
                                                                                
                        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

                        Sendbuf = Text_Create_Proc()
                        KENPIN_OSAKA_NEW2_PROC = False
                        Exit Function
                            
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（YES or No）
            For i = 0 To M_Gyo - 1
            
                Select Case RTrim(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode))
                    Case LCD_CAN_ANS        'YES or No
                        ans = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        Select Case ans
                            Case "1"
                                
                                
                                '----------------------------------- データ更新処理開始 -----------
                                                                    
                                                                    'トランザクション開始
                                sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                                    Exit Function
                                End If
                                                                    
                                If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                                    MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                            
                                Else
                                            
                                    MENU_NO = ""
                                End If
                                
                                
                                
                                If KENPIN_OSAKA_Update_NEW_PROC(Sendbuf) Then
                                    
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    GoTo Abort_Tran
                                End If
                                
                                
                                
                                                                    'トランザクション終了
                                sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                                If sts <> BtNoErr Then
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpEndTransaction, "", 0)
                                    GoTo Abort_Tran
                                End If
                                
                                
                                
                                
                            Case "9"
                            Case Else
'2017.09.22
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ans, "(1 OR 9)", "を入力して下さい", "")
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                KENPIN_OSAKA_NEW2_PROC = False
                                Exit Function
                        End Select
                         
                         
                         
                         
                End Select
            
            Next i
            '次の作業要求
            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                    Exit Function
            End Select

            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
        
            Sendbuf = Text_Create_Proc()
        
        
    End Select
        

    KENPIN_OSAKA_NEW2_PROC = False
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function



Public Function SHIJI_END_PROC(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『指図表完了登録』
'       2018.04.26
'
'-------------------------------------------------------

Dim sts             As Integer



Dim SHIJI_No        As String * 8
Dim QTY             As Long



Dim MENU_NO         As String * 2

Dim ans             As String * 1

Dim i               As Integer

Dim j               As Integer




    SHIJI_END_PROC = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（指図票ａj
            For i = 0 To M_Gyo - 1
                
                Select Case i
                    Case 1      '指図票
    
    
                        SHIJI_No = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        
                        Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, SHIJI_No)
                        
                        
                        sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
                        Select Case sts
                            Case BtNoErr
                            Case BtErrKeyNotFound
                                
                                
                                Call SHIJI_END_Error_PROC(Sendbuf, SHIJI_No, 1)
                                
                                
                                
                                SHIJI_END_PROC = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Exit Function
                        End Select
                        
                        
                
                        'キャンセル済
                        If StrConv(P_SSHIJI_O_REC.CANCEL_F, vbUnicode) = "1" Then
                        
                            Call SHIJI_END_Error_PROC(Sendbuf, SHIJI_No, 3)
                            
                            
                            
                            SHIJI_END_PROC = False
                            Exit Function
                            
                        End If
                        
                        
                        
                        
                        
                        ID_KANRI_TBL(ING_No).SHIJI_No = SHIJI_No
                        ID_KANRI_TBL(ING_No).SHIJI_QTY = Val(StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))
                        
                        ID_KANRI_TBL(ING_No).S_JGYOBU = StrConv(P_SSHIJI_O_REC.JGYOBU, vbUnicode)
                        ID_KANRI_TBL(ING_No).S_NAIGAI = StrConv(P_SSHIJI_O_REC.NAIGAI, vbUnicode)
                        
                        ID_KANRI_TBL(ING_No).Hinban = StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)
                        
                        
                        ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
                        
                        
                        '完了済
                        If StrConv(P_SSHIJI_O_REC.KAN_F, vbUnicode) = "1" Then
                            Call SHIJI_END_In_PROC(Sendbuf, SHIJI_No, 2)
                            SHIJI_END_PROC = False
                            Exit Function
                        End If
                        
                        
                        
                        
                        
                        Call SHIJI_END_In_PROC(Sendbuf, SHIJI_No, 1)
                        
                        
                        
                        
                        
                        SHIJI_END_PROC = False
                        Exit Function
                            
    
                End Select
            Next i
        
        Case Step_Sagyo2_RES        '２回目の受信（完了数）
            For i = 0 To M_Gyo - 1
            
                Select Case i
                    Case 3        '完了数
                        
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "完了数を正しく入力", "して下さい", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SHIJI_END_PROC = False
                            Exit Function
                        End If
                        
                        QTY = Trim(ID_KANRI_TBL(ING_No).Recv_text(i))
                        
                        
                        If QTY > ID_KANRI_TBL(ING_No).SHIJI_QTY Then
                        
                        
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "完了数が予定数をオー", "バーしています。", "")
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                            SHIJI_END_PROC = False
                            Exit Function
                        
                        End If
                        
                                
                        ID_KANRI_TBL(ING_No).SHIJI_END_QTY = QTY
                        
                        
                        '----------------------------------- データ更新処理開始 -----------
                                                            
                                                            'トランザクション開始
                        sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                            Exit Function
                        End If
                                                                    
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                                
                                
                                
                        If SHIJI_END_Update_PROC(Sendbuf) Then
                            
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            GoTo Abort_Tran
                        End If
                        
                        
                        
                        
                        '作業ﾛｸﾞ出力    2018.05.14
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = " " Then
                            ID_KANRI_TBL(ING_No).SAGYO_LOG = "1"
                        End If
                        
                        If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                            MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
                                    
                        Else
                                    
                            MENU_NO = ""
                        End If
                        If Trim(MENU_NO) = "" Then
                        Else
                        '作業ﾛｸﾞ出力
                            
                            If P_SAGYO_LOG_OUTPUT_PROC(ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                                                (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                                                ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                                                ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                                                MENU_NO, _
                                                                (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                                                ID_KANRI_TBL(ING_No).Hinban, _
                                                                ID_KANRI_TBL(ING_No).SHIJI_END_QTY, , , , , , , , _
                                                                ID_KANRI_TBL(ING_No).SHIJI_No) Then
                                GoTo Abort_Tran
                            End If
                        End If
                        '作業ﾛｸﾞ出力    2018.05.14
                        
                  '========================================================================================================= 2019/12/24 商品化完了登録時在庫計上機能追加
                        '2019/12/5 向け先コード取得 (96010101在庫計上) SURYOをSHIJI_END_QTYに変更
                        Debug.Print ID_KANRI_TBL(ING_No).PARAM
                        If RTrim(ID_KANRI_TBL(ING_No).PARAM) <> "" Then
                            sts = Nyuko_Update_Proc(ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                ID_KANRI_TBL(ING_No).Hinban, _
                                Format(Now, "YYYYMMDD"), _
                                ID_KANRI_TBL(ING_No).PARAM, _
                                (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                ID_KANRI_TBL(ING_No).SHIJI_END_QTY, 0, _
                                Format(ID_KANRI_TBL(ING_No).ID, "000"), _
                                ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                , , , , , MENU_NO)
                            Select Case sts
                                Case False
                                Case True           '入庫時は発生しない
                                Case SYS_CANCEL
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, "処理中断", "", "", "")    '2017.09.22
                                    GoTo Abort_Tran
                                Case SYS_ERR
                                    Sendbuf = Text_Create_Proc()
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    GoTo Abort_Tran
                            End Select
                        End If
                  '===========================================================================================================
                        
                                                            'トランザクション終了
                        sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                        If sts <> BtNoErr Then
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Call File_Error(sts, BtOpEndTransaction, "", 0)
                            GoTo Abort_Tran
                        End If
                        
                End Select
            
            Next i

            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            
            Call SHIJI_END_Next_PROC(Sendbuf)
            Sendbuf = Text_Create_Proc()
        
        
    End Select
        

    SHIJI_END_PROC = False
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
Private Sub SHIJI_END_Error_PROC(Sendbuf As String, SHIJI_No As String, Error_type As Integer, Optional FileName As String, Optional sts As Integer)
'-------------------------------------------------------
'
'   『指図表完了登録 エラー再入力』
'       2018.04.26
'
'       Error__type 1:未登録
'                   2:BT Error
'                   3:Cancel
'-------------------------------------------------------
        
        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
        '-----------------------------------------------ヘッダー
        Send_Text.sts = Sts_OK                                  'ステータス　OK
        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

        Send_Text.FileName = ""                                 '送信データファイル名
        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""

        Send_Text.buzzer = Buzzer_DOUBLE                        'ブザー音　標準
        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                        
        '-----------------------------------------------１行目
                                                                'BOX属性
        Send_Text.Box_Type(0).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                
        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                
                                                                '数値初期表示
        Send_Text.Box_Type(0).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                '初期カーソル位置
        Send_Text.Box_Type(0).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                '入力桁数
        Send_Text.Box_Type(0).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                
        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""

        '-----------------------------------------------２行目
                                                'BOX属性
        Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                                                                '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, SHIJI_No)
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, SHIJI_No)
                                                                
        Send_Text.Box_Type(1).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                
        Send_Text.Box_Type(1).Start_Pos = "01"                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                
         Send_Text.Box_Type(1).Max_Size = "08"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                
        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""

        '-----------------------------------------------３行目
                                                'BOX属性
        Send_Text.Box_Type(2).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                '表示内容
        Select Case Error_type
        
            Case 1          '未登録
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "該当データなし")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "該当データなし")
            Case 2          'BT Error
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "Error:" & sts)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "Error:" & sts)
            Case 3          'Cancel
                Call UniCode_Conv(Send_Text.Box_Type(2).LCD, StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode))
        End Select
        
                                                                
        Send_Text.Box_Type(2).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                
        Send_Text.Box_Type(2).Start_Pos = ""                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                
         Send_Text.Box_Type(2).Max_Size = "00"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                
        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
        '-----------------------------------------------４行目
                                                'BOX属性
        Send_Text.Box_Type(3).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                '表示内容
        Select Case Error_type
        
            Case 1          '未登録
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
            Case 2          'BT Error
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, FileName)
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, FileName)
            Case 3          'Cancel
                Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "指示数：" & Val(StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode)))
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "指示数：" & Val(StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode)))
        End Select
        
                                                                
        Send_Text.Box_Type(3).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                
        Send_Text.Box_Type(3).Start_Pos = ""                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                
         Send_Text.Box_Type(3).Max_Size = "00"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                
        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

        '-----------------------------------------------５行目
                                                'BOX属性
        Send_Text.Box_Type(4).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                '表示内容
        Select Case Error_type
        
            Case 1          '未登録
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
            Case 2          'BT Error
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, FileName)
            Case 3          'Cancel
                Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "キャンセルです。")
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "キャンセルです。")
        End Select
        
                                                                
        Send_Text.Box_Type(4).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                
        Send_Text.Box_Type(4).Start_Pos = ""                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                
         Send_Text.Box_Type(4).Max_Size = "00"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                
        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

        Sendbuf = Text_Create_Proc()

End Sub
Private Sub SHIJI_END_In_PROC(Sendbuf As String, SHIJI_No As String, Input_type As Integer)
'-------------------------------------------------------
'
'   『指図表完了登録 入力画面』
'       2018.04.26
'
'       Input__type 1:正常入力
'                   2:BT Error
'
'-------------------------------------------------------
Dim QTY     As Long
        
        
        '-----------------------------------------------ヘッダー
        Send_Text.sts = Sts_OK                                  'ステータス　OK
        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

        Send_Text.FileName = ""                                 '送信データファイル名
        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""

        
        If Input_type = 1 Then
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
        Else
            Send_Text.buzzer = Buzzer_DOUBLE                        'ブザー音　連続
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
        End If
                        
                        
        '-----------------------------------------------１行目
                                                                'BOX属性
        Send_Text.Box_Type(0).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                
        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, SHIJI_No)
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, SHIJI_No)
                                                                
                                                                '数値初期表示
        Send_Text.Box_Type(0).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                '初期カーソル位置
        Send_Text.Box_Type(0).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                '入力桁数
        Send_Text.Box_Type(0).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                
        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""

        '-----------------------------------------------２行目
                                                'BOX属性
        Send_Text.Box_Type(1).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                                '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Trim(StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)))
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Trim(StrConv(P_SSHIJI_O_REC.HIN_GAI, vbUnicode)))
                                                                
        Send_Text.Box_Type(1).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                
        Send_Text.Box_Type(1).Start_Pos = "01"                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                
         Send_Text.Box_Type(1).Max_Size = "08"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                
        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""

        '-----------------------------------------------３行目
                                                'BOX属性
        Send_Text.Box_Type(2).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                '表示内容
        
        QTY = Val(StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))
        
        
        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, LCD_SHIJI_SHIJI_QTY & Space(M_Keta - (Len(LCD_SHIJI_SHIJI_QTY) * 2) - 5 + (5 - Len(Format(QTY, "#0")))) & Format(QTY, "#0"))
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, LCD_SHIJI_SHIJI_QTY & Space(M_Keta - (Len(LCD_SHIJI_SHIJI_QTY) * 2) - 5 + (5 - Len(Format(QTY, "#0")))) & Format(QTY, "#0"))
        
                                                                
        Send_Text.Box_Type(2).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                
        Send_Text.Box_Type(2).Start_Pos = ""                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                
         Send_Text.Box_Type(2).Max_Size = "00"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                
        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
        '-----------------------------------------------４行目
                                                'BOX属性
        Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                                '表示内容
        
        
        
        If Input_type = 1 Then
        
            QTY = Val(StrConv(P_SSHIJI_O_REC.SHIJI_QTY, vbUnicode))
        
        Else
        
            QTY = Val(StrConv(P_SSHIJI_O_REC.UKEIRE_QTY, vbUnicode))
        
        End If
        
        
        
        
        
        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SHIJI_END_QTY & Space(M_Keta - (Len(LCD_SHIJI_END_QTY) * 2) - 5 + (5 - Len(Format(QTY, "#0")))) & Format(QTY, "#0"))
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SHIJI_END_QTY & Space(M_Keta - (Len(LCD_SHIJI_END_QTY) * 2) - 5 + (5 - Len(Format(QTY, "#0")))) & Format(QTY, "#0"))
        
                                                                
        Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(QTY, "#0"))) & Format(QTY, "#0")                       '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(QTY, "#0"))) & Format(QTY, "#0")
                                                                
        Send_Text.Box_Type(3).Start_Pos = M_Keta - 4                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = M_Keta - 4
                                                                
         Send_Text.Box_Type(3).Max_Size = "05"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                
        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

        '-----------------------------------------------５行目
                                                'BOX属性
        Send_Text.Box_Type(4).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                '表示内容
        
        If Input_type = 1 Then
        
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "")
        Else
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "完了済みです。")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "完了済みです。")
        End If
        
        
                                                                
        Send_Text.Box_Type(4).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                
        Send_Text.Box_Type(4).Start_Pos = ""                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                
         Send_Text.Box_Type(4).Max_Size = "00"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                
        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

        Sendbuf = Text_Create_Proc()

End Sub

Public Function SHIJI_END_Update_PROC(Sendbuf As String) As Integer
'-------------------------------------------------------
'
'   『指図表完了登録 更新処理』
'       2018.04.26
'
'-------------------------------------------------------
Dim sts             As Integer
Dim com             As Integer

Dim MENU_NO         As String * 2

Dim DATA_CNT      As Long
Dim Save_SEQNO      As String * 3


    SHIJI_END_Update_PROC = True


'-----------------------------------------------------------------------    指図票データ更新
    '指図票データ(ﾍｯﾀﾞｰ)処理
    Call UniCode_Conv(K0_P_SSHIJI_O.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    sts = BTRV(BtOpGetEqual, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
            
    Select Case sts
        Case BtNoErr
        
            
        Case Else
            Call File_Error(sts, BtOpGetEqual, "商品化指図票ﾃﾞｰﾀ(親)", 0)
            Exit Function
    End Select


    Call UniCode_Conv(K0_P_UKEHARAI.UKEHARAI_CODE, StrConv(P_SSHIJI_O_REC.UKEHARAI_CODE, vbUnicode))
    sts = BTRV(BtOpGetEqual, P_UKEHARAI_POS, P_UKEHARAIREC, Len(P_UKEHARAIREC), K0_P_UKEHARAI, Len(K0_P_UKEHARAI), 0)
        
    Select Case sts
        Case BtNoErr
        Case BtErrKeyNotFound
            Call UniCode_Conv(P_UKEHARAIREC.TORI_KBN, "0")
        Case Else
            Call File_Error(sts, BtOpGetEqual, "受払先マスタ", 0)
            Exit Function
    End Select
    Call UniCode_Conv(P_SSHIJI_O_REC.TORI_KBN, StrConv(P_UKEHARAIREC.TORI_KBN, vbUnicode))

    Call UniCode_Conv(P_SSHIJI_O_REC.KAN_F, P_KAN_ON)                   '完了ﾌﾗｸﾞ
    Call UniCode_Conv(P_SSHIJI_O_REC.KAN_DT, Format(Now, "YYYYMMDD"))   '完了日

    Call UniCode_Conv(P_SSHIJI_O_REC.BUNNOU_CNT, "01")                  '分納回数
                                                                            
    Call UniCode_Conv(P_SSHIJI_O_REC.S_TANTO, "")                       '収単／担当者ｸﾗｽ
                                                                        '受入数量
    Call UniCode_Conv(P_SSHIJI_O_REC.UKEIRE_QTY, Format(ID_KANRI_TBL(ING_No).SHIJI_END_QTY, "00000000.000"))
                                                                        '更新日時
    Call UniCode_Conv(P_SSHIJI_O_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))

    sts = BTRV(BtOpUpdate, P_SSHIJI_O_POS, P_SSHIJI_O_REC, Len(P_SSHIJI_O_REC), K0_P_SSHIJI_O, Len(K0_P_SSHIJI_O), 0)
    
    Select Case sts
        Case BtNoErr
        Case Else
            Call File_Error(sts, BtOpUpdate, "商品化指図ﾃﾞｰﾀ(親)", 0)
            Exit Function
    End Select
    
'-----------------------------------------------------------------------    受入履歴ﾃﾞｰﾀ処理

    '受入履歴ﾃﾞｰﾀ削除
    Call UniCode_Conv(K0_P_SUKEIRE.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
    Call UniCode_Conv(K0_P_SUKEIRE.SEQNO, "")
    DATA_CNT = 0
    Save_SEQNO = ""
    
    com = BtOpGetGreater
    
    Do
    
        sts = BTRV(com, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
            
        Select Case sts
            Case BtNoErr
            
                If StrConv(P_SUKEIRE_REC.SHIJI_No, vbUnicode) <> ID_KANRI_TBL(ING_No).SHIJI_No Then
                    Exit Do
                End If
            
            
                DATA_CNT = DATA_CNT + 1
                If DATA_CNT = 1 Then
                    Save_SEQNO = StrConv(P_SUKEIRE_REC.SEQNO, vbUnicode)
                End If
            
            
            Case BtErrEOF
                Exit Do
            
            Case Else
                Call File_Error(sts, com, "商品化受入履歴", 0)
                Exit Function
        
        End Select
        
        If DATA_CNT > 1 Then
            sts = BTRV(BtOpDelete, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
            
            If sts <> BtNoErr Then
        
                Call File_Error(sts, com, "商品化受入履歴", 0)
                Exit Function
            End If
        End If
        
        com = BtOpGetNext
        
    Loop
        
            
    If Trim(Save_SEQNO) = "" Then
        Save_SEQNO = "001"
        com = BtOpInsert
    Else
        
        
        Call UniCode_Conv(K0_P_SUKEIRE.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)
        Call UniCode_Conv(K0_P_SUKEIRE.SEQNO, Save_SEQNO)
    
        
        sts = BTRV(BtOpGetEqual, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
            
        Select Case sts
            Case BtNoErr
            
            
                com = BtOpUpdate
            
            
            
            Case BtErrEOF
                com = BtOpInsert
            
            Case Else
                Call File_Error(sts, com, "商品化受入履歴", 0)
                Exit Function
        
        End Select
        
    End If
        
        
    If com = BtOpInsert Then
        
        
        Call UniCode_Conv(P_SUKEIRE_REC.SHIJI_No, ID_KANRI_TBL(ING_No).SHIJI_No)    '指図票
                                                                                    
        Call UniCode_Conv(P_SUKEIRE_REC.SEQNO, "001")                              'SEQNO
                                                                                    
                                                                                    
                                                                                    
                                                                                    
        '前1
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(4).NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(4).TIMES, "000.00")
            
        '前2
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(5).NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(5).TIMES, "000.00")
            
        '前3
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(6).NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(6).TIMES, "000.00")
        
        '作業1
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(0).NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(0).TIMES, "000.00")
            
        '作業2
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(1).NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(1).TIMES, "000.00")
            
        '作業3
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(2).NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(2).TIMES, "000.00")
            
        '後1
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(7).NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(7).TIMES, "000.00")
            
        '後2
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(8).NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(8).TIMES, "000.00")
            
        '加工1
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(9).NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.GENKA_TBL(9).TIMES, "000.00")
            
            
        Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_NAME, "")
        Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.JISEKI_TIMES, "000.00")
        
        Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_NAME, "")
        Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_NIN, "0.0")
        Call UniCode_Conv(P_SUKEIRE_REC.TASEKI_TIMES, "000.00")
                                                    
        Call UniCode_Conv(P_SUKEIRE_REC.BIKOU, "")                                  '備考
            
        Call UniCode_Conv(P_SUKEIRE_REC.FILLER, "")
    End If
                                                                                
                                                                                
                                                                                
                                                                                '仕向け先ｺｰﾄﾞ
    Call UniCode_Conv(P_SUKEIRE_REC.SHIMUKE_CODE, StrConv(P_SSHIJI_O_REC.SHIMUKE_CODE, vbUnicode))
                                                                                '受入日
    Call UniCode_Conv(P_SUKEIRE_REC.UKEIRE_DT, Format(Now, "YYYYMMDD"))
                                                                                '受入数量
    Call UniCode_Conv(P_SUKEIRE_REC.UKEIRE_QTY, Format(ID_KANRI_TBL(ING_No).SHIJI_END_QTY, "00000000.000"))
    
                                            
    Call UniCode_Conv(P_SUKEIRE_REC.LAST_F, P_UKEIRE_END)
                                                                                '取引先
    Call UniCode_Conv(P_SUKEIRE_REC.TORI_CODE, StrConv(P_SSHIJI_O_REC.UKEHARAI_CODE, vbUnicode))
                                                                                
                                                                                
                                                                                
                                                                                '更新日時
    Call UniCode_Conv(P_SUKEIRE_REC.UPD_DATETIME, Format(Now, "YYYYMMDD") & Format(Now, "HHMMSS"))
            
    
    
            
    sts = BTRV(com, P_SUKEIRE_POS, P_SUKEIRE_REC, Len(P_SUKEIRE_REC), K0_P_SUKEIRE, Len(K0_P_SUKEIRE), 0)
    Select Case sts
        Case BtNoErr
        Case BtErrDuplicates
        
        Case BtErrRECORD_INUSE, BtErrFILE_INUSE
                        
        Case Else
            Call File_Error(sts, BtOpInsert, "受入履歴", 0)
            Exit Function
    End Select

    SHIJI_END_Update_PROC = False
    
End Function


Private Sub SHIJI_END_Next_PROC(Sendbuf As String)
'-------------------------------------------------------
'
'   『指図表完了登録 次入力要求』
'       2018.04.26
'
'-------------------------------------------------------
        
        '-----------------------------------------------ヘッダー
        Send_Text.sts = Sts_OK                                  'ステータス　OK
        ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

        Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
        ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

        Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
        ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

        Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
        ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

        Send_Text.FileName = ""                                 '送信データファイル名
        ID_KANRI_TBL(ING_No).Send_Text.FileName = ""

        Send_Text.buzzer = Buzzer_DOUBLE                        'ブザー音　標準
        ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DOUBLE
                        
        '-----------------------------------------------１行目
                                                                'BOX属性
        Send_Text.Box_Type(0).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                                
        Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                                
                                                                '数値初期表示
        Send_Text.Box_Type(0).INIT = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                                '初期カーソル位置
        Send_Text.Box_Type(0).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                                '入力桁数
        Send_Text.Box_Type(0).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                
        Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""

        '-----------------------------------------------２行目
                                                'BOX属性
        Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                                                                '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, LCD_SHIJI)
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, LCD_SHIJI)
                                                                
        Send_Text.Box_Type(1).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                                
        Send_Text.Box_Type(1).Start_Pos = "01"                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                                
         Send_Text.Box_Type(1).Max_Size = "08"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                
        Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""

        '-----------------------------------------------３行目
                                                'BOX属性
        Send_Text.Box_Type(2).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                                '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "")
        
                                                                
        Send_Text.Box_Type(2).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                                
        Send_Text.Box_Type(2).Start_Pos = ""                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                                
         Send_Text.Box_Type(2).Max_Size = "00"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                                
        Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
        '-----------------------------------------------４行目
                                                'BOX属性
        Send_Text.Box_Type(3).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                                '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "")
        
                                                                
        Send_Text.Box_Type(3).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                                
        Send_Text.Box_Type(3).Start_Pos = ""                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
                                                                
         Send_Text.Box_Type(3).Max_Size = "00"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                                
        Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""

        '-----------------------------------------------５行目
                                                'BOX属性
        Send_Text.Box_Type(4).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                                '表示内容
        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, ID_KANRI_TBL(ING_No).SHIJI_No & " 完了OK")
        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, ID_KANRI_TBL(ING_No).SHIJI_No & " 完了OK")
        
                                                                
        Send_Text.Box_Type(4).INIT = ""                         '数値初期表示
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                                
        Send_Text.Box_Type(4).Start_Pos = ""                  '初期カーソル位置
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
                                                                
         Send_Text.Box_Type(4).Max_Size = "00"                  '入力桁数
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                                
        Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""


End Sub

Public Function nidumi(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'   荷積明細作成処理 2020/01/29
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8
Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1
Dim HIN_NO          As String * 13

Dim KAN_FLG         As String * 1

Dim i               As Integer

Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1

Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1


Dim DEN_ID_LOOP     As Integer      '2006.06.01
Dim DEN_ID_JGYOBU   As String * 1   '2006.06.01

Dim wkKENPIN_YMD    As String * 8   '検品日付   2007.10.10


Dim wkTEXT          As String           '2007.07.21

Dim MENU_NO         As String * 2

Dim wkNull_Check    As String       '2009.04.27

Dim Mod_Return      As Integer      '2010.12.09
Dim iNum            As Integer      '2010.12.09

Dim DelvNo          As String * 20

Dim com             As Integer

Dim LK_SEQ_NO       As Integer     '2020/03/10 パレットNO
Dim KENPIN_SURYO    As Integer     '2020/03/10 箱数

    nidumi = True

'----------------2020/03/05 ハンディカーソル位置初期化処理----------------▼
    For i = 0 To 4
        Send_Text.Box_Type(i).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = TYPE_REF
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
    Next
'----------------2020/03/05 ハンディカーソル位置初期化処理----------------▲
    
    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '1回目の受信(パレット)
        
            DelvNo = Trim(ID_KANRI_TBL(ING_No).Recv_text(1))

            If Trim(DelvNo) = "パレット" Then
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, DelvNo, "パレットｋ白です", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    nidumi = False
                    
'----------------2020/03/23 ハンディカーソル位置 パレット---------------▼
                    Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "パレットNo:" & "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "パレットNo:" & "")
                    Send_Text.Box_Type(1).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                    Send_Text.Box_Type(1).Max_Size = "12"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "12"
'----------------2020/03/23 ハンディカーソル位置 パレット---------------▲

            Exit Function
            Else
                    ID_KANRI_TBL(ING_No).LK_SEQ_NO = DelvNo
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            End If
            
'----------------2020/03/05 ハンディカーソル位置 ID---------------▼
            Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
            Send_Text.Box_Type(1).Max_Size = "12"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "12"
'----------------2020/03/05 ハンディカーソル位置 ID---------------▲

        Case Step_Sagyo2_RES        '2回目の受信(伝票ID)
                
        ID_NO = Trim(ID_KANRI_TBL(ING_No).Recv_text(1))
            '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
            sts = Y_Syuka_Chek_Proc(KAN_KBN_FIN, _
                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                    NAIGAI, _
                                    Hinban, _
                                    MTS_CODE, _
                                    SS_CODE, _
                                    CYU_KBN, _
                                    Y_SYU_CNT, _
                                    ID_NO, _
                                    SYUKA_QTY, _
                                    DEN_NO, _
                                    KAN_KBN, _
                                    JITU_QTY, , wkKENPIN_YMD)
                                    
            Select Case sts
                Case False          '正常
                    If Y_SYU_CNT = 0 Then   '対象データなし
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        nidumi = False
                        '----------------2020/03/18 ハンディカーソル位置 ID---------------▼
                        Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Send_Text.Box_Type(1).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                        Send_Text.Box_Type(1).Max_Size = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "12"
                        
                        '----------------2020/03/18 ハンディカーソル位置 ID---------------▲
                        Exit Function
                    End If
                Case True
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常:" & sts, "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Sendbuf = Text_Create_Proc()
                    nidumi = False
                    Exit Function
            End Select
            
'------------------------------ 出庫完了のチェック
            If Inspection_Flg = 0 Then
                If KAN_KBN <> KAN_KBN_FIN Then
'---------------------------    データ解放を追加    2011.07.29
                    
                    sts = Data_Clear_Proc(0, Sendbuf)
                    Select Case sts
                        Case SYS_CANCEL
                            Call Err_Send_Proc("データ使用中", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        
                        Case SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                    End Select
                    
'---------------------------    データ解放を追加    2011.07.29
                    Call Err_Send_Proc("", "伝票ID:" & ID_NO, "出庫作業が未完了です", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    nidumi = False
                    Exit Function
                End If
            End If
            ID_KANRI_TBL(ING_No).ID_NO = ID_NO
            ID_KANRI_TBL(ING_No).Hinban = Hinban
            ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
            ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
            ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
            ID_KANRI_TBL(ING_No).Y_SYU_CNT = Y_SYU_CNT
            ID_KANRI_TBL(ING_No).SYUKA_QTY = JITU_QTY
            ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU = DEN_ID_JGYOBU      '2006.06.01
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    
'----------------2020/03/06 ハンディカーソル位置 品番---------------▼
            Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).Hinban)
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
'----------------2020/03/06 ハンディカーソル位置 品番---------------▲

            
        Case Step_Sagyo3_RES        '3回目の受信(品番)

                        Hinban = Trim(ID_KANRI_TBL(ING_No).Recv_text(2))
                        If Trim(Hinban) <> Trim(ID_KANRI_TBL(ING_No).Hinban) Then
                                    Call Err_Send_Proc("", "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO, Hinban, "品番エラー", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    nidumi = False
                                    
                                    '----------------2020/03/18 ハンディカーソル位置 品番---------------▼
                                    Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).Hinban)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).Hinban)
                                    Send_Text.Box_Type(2).Start_Pos = "01"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                    Send_Text.Box_Type(2).Max_Size = "20"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                    '----------------2020/03/18 ハンディカーソル位置 品番---------------▲
                                
                                    Exit Function
                        End If
                        
                '----------------2020/03/06 ハンディカーソル位置 箱数---------------▼
                        Send_Text.Box_Type(4).Box_Type = "2" ' 2 = バーコード＆テンキー入力可能（ テンキー入力時、数字のみ可能 ）、TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = "2"
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "箱数：" & ID_KANRI_TBL(ING_No).KENPIN_SURYO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "箱数：" & ID_KANRI_TBL(ING_No).KENPIN_SURYO)
                        Send_Text.Box_Type(4).Start_Pos = "07"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "07"
                        Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                '----------------2020/03/06 ハンディカーソル位置 箱数---------------▲


        Case Step_Sagyo4_RES        '4回目の受信（Any Key）
        
            
            ID_KANRI_TBL(ING_No).KENPIN_SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(4)) '2020/03/11 箱数の受信
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)  '出荷予定読込
            If sts <> BtNoErr Then
                Call Err_Send_Proc("トランザクション開始 Err:" & sts, "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            '出荷予定の読み込み
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU)      '事業部
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)           'ID
    
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)
            
            sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                Case Else
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    nidumi = SYS_ERR
                    Call Err_Send_Proc("出荷予定Get Err:" & sts, "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    GoTo Abort_Tran
            End Select

            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
            Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
            Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
            Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
            Call UniCode_Conv(Y_SYUREC.LK_SEQ_NO, ID_KANRI_TBL(ING_No).LK_SEQ_NO)              '2020/03/11 パレットNOのセット
            Call UniCode_Conv(Y_SYUREC.KENPIN_SURYO, ID_KANRI_TBL(ING_No).KENPIN_SURYO)        '2020/03/11 箱数のセット
                                            
                                            '出荷予定書込み
            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                Case Else
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    nidumi = SYS_ERR
                    Call Err_Send_Proc("出荷予定upd Err:" & sts, "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    GoTo Abort_Tran
            End Select
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
            
            '2004.07.16 ↓
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        "", , , , , MENU_NO, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE, _
                                        ID_KANRI_TBL(ING_No).SS_CODE, _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("移動歴upd Err:" & sts, "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    nidumi = SYS_ERR
                    GoTo Abort_Tran
            End Select
            '2004.07.16 ↑
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)  '出荷予定読込
            
            If sts <> BtNoErr Then
                Call Err_Send_Proc("トランザクション終了 Err:" & sts, "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
            
'----------------2020/03/17 ハンディカーソル位置 ID---------------▼
            Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:")
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
            Send_Text.Box_Type(1).Max_Size = "12"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "12"
'----------------2020/03/17 ハンディカーソル位置 ID---------------▲

'----------------2020/03/17 IDスキャン2回目以降ハンディの表示をクリアにする---------------▼
            ID_KANRI_TBL(ING_No).ID_NO = ""
            ID_KANRI_TBL(ING_No).Hinban = ""
            ID_KANRI_TBL(ING_No).SYUKA_QTY = "0" '出荷予定数は数値が入っていないとエラーになる
            ID_KANRI_TBL(ING_No).KENPIN_SURYO = ""
'----------------2020/03/17 IDスキャン2回目以降ハンディの表示をクリアにする---------------▲
                        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ 'IDスキャン2回目の処理に移動
        End Select
        
    '-----------------------------------------------ヘッダー
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

    Send_Text.FileName = ""                                 '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""

    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
    
    '-----------------------------------------------1行目
                                                            'BOX属性
'    Send_Text.Box_Type(0).Box_Type = TYPE_REF
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "パレットNo:" & ID_KANRI_TBL(ING_No).LK_SEQ_NO)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "パレットNo:" & ID_KANRI_TBL(ING_No).LK_SEQ_NO)
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
'    Send_Text.Box_Type(0).Start_Pos = ""
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                            '入力桁数
'    Send_Text.Box_Type(0).Max_Size = "00"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    
    '-----------------------------------------------2行目
                                                            'BOX属性
'    Send_Text.Box_Type(1).Box_Type = TYPE_REF
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
'    Send_Text.Box_Type(1).Start_Pos = "01"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
'    Send_Text.Box_Type(1).Max_Size = "20"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "20"
    
    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    
    '-----------------------------------------------3行目
                                                            'BOX属性
'    Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).Hinban)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).Hinban)
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
'    Send_Text.Box_Type(2).Start_Pos = ""
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
'    Send_Text.Box_Type(2).Max_Size = "00"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                            
    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    
    '-----------------------------------------------4行目 出荷数
                                                            'BOX属性
'    Send_Text.Box_Type(3).Box_Type = TYPE_REF
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
'    Send_Text.Box_Type(3).Start_Pos = ""                    '数値は５桁固定
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
'                                                            '入力桁数
'     Send_Text.Box_Type(3).Max_Size = "00"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                            
    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
     
    '-----------------------------------------------5行目 箱数
                                                            'BOX属性
'    Send_Text.Box_Type(4).Box_Type = TYPE_REF
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "箱数：" & ID_KANRI_TBL(ING_No).KENPIN_SURYO)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "箱数：" & ID_KANRI_TBL(ING_No).KENPIN_SURYO)
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
'    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                                                            '入力桁数
'    Send_Text.Box_Type(4).Max_Size = "00"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                            
    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

    Sendbuf = Text_Create_Proc()

    nidumi = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If


End Function

Public Function SAGYOin(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'   作業時間インプット 2020/04/03 要因E
'-------------------------------------------------------
Dim sts             As Integer

Dim Tanaban         As String * 8
Dim Hinban          As String * 20      '2007.07.21 13-->20
Dim SYUKA_QTY       As Long
Dim JITU_QTY        As Long
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim MTS_CODE        As String * 8
Dim SS_CODE         As String * 8
Dim CYU_KBN         As String * 1
Dim NAIGAI          As String * 1
Dim HIN_NO          As String * 13
Dim KAN_FLG         As String * 1
Dim i               As Integer
Dim Y_SYU_CNT       As Integer
Dim ID_NO           As String * 12
Dim DEN_NO          As String * 6
Dim KAN_KBN         As String * 1
Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1
Dim DEN_ID_LOOP     As Integer      '2006.06.01
Dim DEN_ID_JGYOBU   As String * 1   '2006.06.01
Dim wkKENPIN_YMD    As String * 8   '検品日付   2007.10.10
Dim wkTEXT          As String           '2007.07.21
Dim MENU_NO         As String * 2
Dim wkNull_Check    As String       '2009.04.27
Dim Mod_Return      As Integer      '2010.12.09
Dim iNum            As Integer      '2010.12.09
Dim DelvNo          As String * 20
Dim com             As Integer
Dim LK_SEQ_NO       As Integer     '2020/03/10 パレットNO
Dim KENPIN_SURYO    As Integer     '2020/03/10 箱数
Dim sagyobi         As Integer     '2020/04/03 作業日
Dim komoku          As Integer     '2020/04/03 項目
Dim sagyofun        As Integer     '2020/04/03 作業時間(分)

    SAGYO = True

'----------------2020/03/05 ハンディカーソル位置初期化処理----------------▼
    For i = 0 To 4
        Send_Text.Box_Type(i).Box_Type = TYPE_REF
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Box_Type = TYPE_REF
        Send_Text.Box_Type(i).Start_Pos = ""
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Start_Pos = ""
        Send_Text.Box_Type(i).Max_Size = "00"
        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size = "00"
    Next
'----------------2020/03/05 ハンディカーソル位置初期化処理----------------▲
    
    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '1回目の受信(インプット日付)
        
            sagyobi = Trim(ID_KANRI_TBL(ING_No).Recv_text(1))

            If Trim(DelvNo) = "作業日" Then
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, DelvNo, "日付が空白です", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    kansetsu = False
                    
'----------------2020//04/03 ハンディカーソル位置 作業日---------------▼
                    Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "作業日:" & "")
                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "作業日:" & "")
                    Send_Text.Box_Type(1).Start_Pos = "01"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                    Send_Text.Box_Type(1).Max_Size = "12"
                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "12"
'----------------2020//04/03 ハンディカーソル位置 作業日---------------▲

            Exit Function
            Else
                    ID_KANRI_TBL(ING_No).LK_SEQ_NO = DelvNo
                    ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            End If
            
'----------------2020//04/03 ハンディカーソル位置 作業項目---------------▼
            Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "作業項目:" & ID_KANRI_TBL(ING_No).ID_NO)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "作業項目:" & ID_KANRI_TBL(ING_No).ID_NO)
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
            Send_Text.Box_Type(1).Max_Size = "12"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "12"
'----------------2020//04/03 ハンディカーソル位置 作業項目---------------▲

        Case Step_Sagyo2_RES        '2回目の受信(作業項目)
                
        koumoku = Trim(ID_KANRI_TBL(ING_No).Recv_text(1))
            '------------------ 使用可能な出荷予定の予約を行い、出荷予定数を獲得する
            sts = Y_Syuka_Chek_Proc(KAN_KBN_FIN, _
                                    ID_KANRI_TBL(ING_No).JGYOBU, _
                                    NAIGAI, _
                                    Hinban, _
                                    MTS_CODE, _
                                    SS_CODE, _
                                    CYU_KBN, _
                                    Y_SYU_CNT, _
                                    ID_NO, _
                                    SYUKA_QTY, _
                                    DEN_NO, _
                                    KAN_KBN, _
                                    JITU_QTY, , wkKENPIN_YMD)
                                    
            Select Case sts
                Case False          '正常
                    If Y_SYU_CNT = 0 Then   '対象データなし
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定無し", "", "")     '2017.09.22
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                        nidumi = False
                        '----------------2020/03/18 ハンディカーソル位置 作業項目---------------▼
                        Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
                        Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "作業項目:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "作業項目:" & ID_KANRI_TBL(ING_No).ID_NO)
                        Send_Text.Box_Type(1).Start_Pos = "01"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                        Send_Text.Box_Type(1).Max_Size = "12"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "12"
                        
                        '----------------2020/03/18 ハンディカーソル位置 作業項目---------------▲
                        Exit Function
                    End If
                Case True
                Case SYS_ERR
                    Call Err_Send_Proc("システム異常:" & sts, "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Exit Function
                Case SYS_CANCEL
                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_NO, "出荷予定使用中", "", "")       '2017.09.22
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    Sendbuf = Text_Create_Proc()
                    nidumi = False
                    Exit Function
            End Select
            
'------------------------------ 出庫完了のチェック
            If Inspection_Flg = 0 Then
                If KAN_KBN <> KAN_KBN_FIN Then
'---------------------------    データ解放を追加    2011.07.29
                    
                    sts = Data_Clear_Proc(0, Sendbuf)
                    Select Case sts
                        Case SYS_CANCEL
                            Call Err_Send_Proc("データ使用中", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                        
                        Case SYS_ERR
                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                            Sendbuf = Text_Create_Proc()
                            Exit Function
                    End Select
                    
'---------------------------    データ解放を追加    2011.07.29
                    Call Err_Send_Proc("", "伝票ID:" & ID_NO, "出庫作業が未完了です", "", "")
                    Sendbuf = Text_Create_Proc()
                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                    nidumi = False
                    Exit Function
                End If
            End If
            ID_KANRI_TBL(ING_No).ID_NO = ID_NO
            ID_KANRI_TBL(ING_No).Hinban = Hinban
            ID_KANRI_TBL(ING_No).MTS_CODE = MTS_CODE
            ID_KANRI_TBL(ING_No).SS_CODE = SS_CODE
            ID_KANRI_TBL(ING_No).CYU_KBN = CYU_KBN
            ID_KANRI_TBL(ING_No).Y_SYU_CNT = Y_SYU_CNT
            ID_KANRI_TBL(ING_No).SYUKA_QTY = JITU_QTY
            ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU = DEN_ID_JGYOBU      '2006.06.01
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo3_REQ
                    
'----------------2020/03/06 ハンディカーソル位置 作業時間(分)---------------▼
            Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "作業時間(分):" & ID_KANRI_TBL(ING_No).Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "作業時間(分):" & ID_KANRI_TBL(ING_No).Hinban)
            Send_Text.Box_Type(2).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
            Send_Text.Box_Type(2).Max_Size = "20"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
'----------------2020/03/06 ハンディカーソル位置 作業時間(分)---------------▲

            
        Case Step_Sagyo3_RES        '3回目の受信(品番)

                        sagyofun = Trim(ID_KANRI_TBL(ING_No).Recv_text(2))
                        If Trim(sagyofun) <> Trim(ID_KANRI_TBL(ING_No).sagyofun) Then
                                    Call Err_Send_Proc("", "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO, sagyofun, "品番エラー", "")
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    nidumi = False
                                    
                                    '----------------2020/03/18 ハンディカーソル位置 品番---------------▼
                                    Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).sagyofun)
                                    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).sagyofun)
                                    Send_Text.Box_Type(2).Start_Pos = "01"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = "01"
                                    Send_Text.Box_Type(2).Max_Size = "20"
                                    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "20"
                                    '----------------2020/03/18 ハンディカーソル位置 品番---------------▲
                                
                                    Exit Function
                        End If
                        
                '----------------2020/03/06 ハンディカーソル位置 箱数---------------▼
                        Send_Text.Box_Type(4).Box_Type = "2" ' 2 = バーコード＆テンキー入力可能（ テンキー入力時、数字のみ可能 ）、TYPE_BCANK
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = "2"
                        Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "箱数：" & ID_KANRI_TBL(ING_No).KENPIN_SURYO)
                        Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "箱数：" & ID_KANRI_TBL(ING_No).KENPIN_SURYO)
                        Send_Text.Box_Type(4).Start_Pos = "07"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = "07"
                        Send_Text.Box_Type(4).Max_Size = "05"
                        ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                '----------------2020/03/06 ハンディカーソル位置 箱数---------------▲


        Case Step_Sagyo4_RES        '4回目の受信（Any Key）
        
            
            ID_KANRI_TBL(ING_No).KENPIN_SURYO = Trim(ID_KANRI_TBL(ING_No).Recv_text(4)) '2020/03/11 箱数の受信
            
            '----------------------------------- データ更新処理開始 -----------
                                            'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)  '出荷予定読込
            If sts <> BtNoErr Then
                Call Err_Send_Proc("トランザクション開始 Err:" & sts, "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                            '出荷予定の読み込み
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU)      '事業部
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)           'ID
    
            Call UniCode_Conv(K0_Y_SYU.JGYOBU, ID_KANRI_TBL(ING_No).JGYOBU)
            Call UniCode_Conv(K0_Y_SYU.KEY_ID_NO, ID_KANRI_TBL(ING_No).ID_NO)
            
            sts = BTRV(BtOpGetEqual, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                Case Else
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    nidumi = SYS_ERR
                    Call Err_Send_Proc("出荷予定Get Err:" & sts, "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    GoTo Abort_Tran
            End Select

            Call UniCode_Conv(Y_SYUREC.WEL_ID, "")
            Call UniCode_Conv(Y_SYUREC.PRG_ID, "")
            Call UniCode_Conv(Y_SYUREC.KENPIN_YMD, Format(Now, "YYYYMMDD"))
            Call UniCode_Conv(Y_SYUREC.KENPIN_TANTO_CODE, ID_KANRI_TBL(ING_No).TANTO_CODE)
            Call UniCode_Conv(Y_SYUREC.KENPIN_HMS, Format(Now, "HHMMSS"))
            Call UniCode_Conv(Y_SYUREC.LK_SEQ_NO, ID_KANRI_TBL(ING_No).LK_SEQ_NO)              '2020/03/11 パレットNOのセット
            Call UniCode_Conv(Y_SYUREC.KENPIN_SURYO, ID_KANRI_TBL(ING_No).KENPIN_SURYO)        '2020/03/11 箱数のセット
                                            
                                            '出荷予定書込み
            sts = BTRV(BtOpUpdate, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)
            Select Case sts
                Case BtNoErr
                Case Else
                    Call File_Error(sts, BtOpUpdate, "出荷予定", 0)
                    nidumi = SYS_ERR
                    Call Err_Send_Proc("出荷予定upd Err:" & sts, "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    GoTo Abort_Tran
            End Select
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If
            
            '2004.07.16 ↓
            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).DEN_ID_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).NAIGAI, _
                                        ID_KANRI_TBL(ING_No).sagyofun, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        0, _
                                        0, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        "", , , , , MENU_NO, _
                                        ID_KANRI_TBL(ING_No).MTS_CODE, _
                                        ID_KANRI_TBL(ING_No).SS_CODE, _
                                        ID_KANRI_TBL(ING_No).ID_NO)
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("移動歴upd Err:" & sts, "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    nidumi = SYS_ERR
                    GoTo Abort_Tran
            End Select
            '2004.07.16 ↑
                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, Y_SYU_POS, Y_SYUREC, Len(Y_SYUREC), K0_Y_SYU, Len(K0_Y_SYU), 0)  '出荷予定読込
            
            If sts <> BtNoErr Then
                Call Err_Send_Proc("トランザクション終了 Err:" & sts, "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
            '次の作業要求
            
'----------------2020/03/17 ハンディカーソル位置 ID---------------▼
            Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_BCANK
            Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:")
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:")
            Send_Text.Box_Type(1).Start_Pos = "01"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
            Send_Text.Box_Type(1).Max_Size = "12"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "12"
'----------------2020/03/17 ハンディカーソル位置 ID---------------▲

'----------------2020/03/17 IDスキャン2回目以降ハンディの表示をクリアにする---------------▼
            ID_KANRI_TBL(ING_No).ID_NO = ""
            ID_KANRI_TBL(ING_No).sagyofun = ""
            ID_KANRI_TBL(ING_No).SYUKA_QTY = "0" '出荷予定数は数値が入っていないとエラーになる
            ID_KANRI_TBL(ING_No).KENPIN_SURYO = ""
'----------------2020/03/17 IDスキャン2回目以降ハンディの表示をクリアにする---------------▲
                        
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ 'IDスキャン2回目の処理に移動
        End Select
        
    '-----------------------------------------------ヘッダー
    Send_Text.sts = Sts_OK                                  'ステータス　OK
    ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK

    Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
    ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF

    Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
    ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only

    Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
    ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"

    Send_Text.FileName = ""                                 '送信データファイル名
    ID_KANRI_TBL(ING_No).Send_Text.FileName = ""

    Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
    ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
    
    '-----------------------------------------------1行目
                                                            'BOX属性
'    Send_Text.Box_Type(0).Box_Type = TYPE_REF
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(0).LCD, "パレットNo:" & ID_KANRI_TBL(ING_No).LK_SEQ_NO)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, "パレットNo:" & ID_KANRI_TBL(ING_No).LK_SEQ_NO)
                                                            '数値初期表示
    Send_Text.Box_Type(0).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            '初期カーソル位置
'    Send_Text.Box_Type(0).Start_Pos = ""
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
'                                                            '入力桁数
'    Send_Text.Box_Type(0).Max_Size = "00"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
'
    Send_Text.Box_Type(0).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
    
    '-----------------------------------------------2行目
                                                            'BOX属性
'    Send_Text.Box_Type(1).Box_Type = TYPE_REF
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, "伝票ID:" & ID_KANRI_TBL(ING_No).ID_NO)
                                                            '数値初期表示
    Send_Text.Box_Type(1).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            '初期カーソル位置
'    Send_Text.Box_Type(1).Start_Pos = "01"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = "01"
                                                            '入力桁数
'    Send_Text.Box_Type(1).Max_Size = "20"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "20"
    
    Send_Text.Box_Type(1).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
    
    '-----------------------------------------------3行目
                                                            'BOX属性
'    Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_BCANK
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).sagyofun)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, "品番:" & ID_KANRI_TBL(ING_No).sagyofun)
                                                            '数値初期表示
    Send_Text.Box_Type(2).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
'    Send_Text.Box_Type(2).Start_Pos = ""
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
'    Send_Text.Box_Type(2).Max_Size = "00"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "00"
                                                            
    Send_Text.Box_Type(2).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
    
    '-----------------------------------------------4行目 出荷数
                                                            'BOX属性
'    Send_Text.Box_Type(3).Box_Type = TYPE_REF
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, "出荷数：" & StrConv(Format(ID_KANRI_TBL(ING_No).SYUKA_QTY, "#0"), vbWide))
                                                            '数値初期表示
    Send_Text.Box_Type(3).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = ""
                                                            '初期カーソル位置
'    Send_Text.Box_Type(3).Start_Pos = ""                    '数値は５桁固定
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = ""
'                                                            '入力桁数
'     Send_Text.Box_Type(3).Max_Size = "00"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "00"
                                                            
    Send_Text.Box_Type(3).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
     
    '-----------------------------------------------5行目 箱数
                                                            'BOX属性
'    Send_Text.Box_Type(4).Box_Type = TYPE_REF
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_REF
                                                            '表示内容
    Call UniCode_Conv(Send_Text.Box_Type(4).LCD, "箱数：" & ID_KANRI_TBL(ING_No).KENPIN_SURYO)
    Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, "箱数：" & ID_KANRI_TBL(ING_No).KENPIN_SURYO)
                                                            '数値初期表示
    Send_Text.Box_Type(4).INIT = ""
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = ""
                                                            '初期カーソル位置
'    Send_Text.Box_Type(4).Start_Pos = ""                    '数値は５桁固定
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = ""
'                                                            '入力桁数
'    Send_Text.Box_Type(4).Max_Size = "00"
'    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "00"
                                                            
    Send_Text.Box_Type(4).MENU = ""                         'メニュ―番号
    ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""

    Sendbuf = Text_Create_Proc()

    nidumi = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function

Public Function kintais_Proc(Sendbuf As String, Ti As Integer, Tj As Integer) As Integer
'-------------------------------------------------------
'
'   『勤怠出社』2020/05/07
'
'-------------------------------------------------------
Dim sts             As Integer
Dim SUMI_QTY        As Long
Dim MI_QTY          As Long
Dim QTY             As Long
Dim i               As Integer
Dim Tanaban         As String * 8
Dim Hinban          As String * 20
Dim RET_JGYOBU      As String * 1
Dim RET_NAIGAI      As String * 1
Dim MEMO            As String
Dim MENU_NO         As String

    kintais_Proc = True

    Select Case ID_KANRI_TBL(ING_No).Step
        Case Step_Sagyo1_RES        '１回目の受信（棚番／品番）
            For i = 0 To M_Gyo - 1
                Select Case Trim(WEL_Para_Tbl(Ti, Tj).Wel_Para(i).LCD)
                    Case LCD_Tanaban        '棚番
                        Tanaban = Right(ID_KANRI_TBL(ING_No).Recv_text(i), Len(ID_KANRI_TBL(ING_No).Recv_text(i)) - 1)
                        If Trim(Tanaban) = Loc_OK_Para Then     '棚番OK
                        Else
                            '------------------ 倉庫マスタ読込み
                            Call UniCode_Conv(K0_SOKO.SOKO_NO, Left(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, SOKO_POS, SOKOREC, Len(SOKOREC), K0_SOKO, Len(K0_SOKO), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    'Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")        '2017.09.22
                                    Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2), "倉庫エラー", "", "")    '2017.09.22
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                                    Hin_Shogo_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "倉庫マスタ", 0)
                                    Exit Function
                            End Select
                            
                            '------------------ 棚マスタ読込み
                            Call UniCode_Conv(K0_TANA.SOKO_NO, Left(Tanaban, 2))
                            Call UniCode_Conv(K0_TANA.Retu, Mid(Tanaban, 3, 2))
                            Call UniCode_Conv(K0_TANA.Ren, Mid(Tanaban, 5, 2))
                            Call UniCode_Conv(K0_TANA.Dan, Right(Tanaban, 2))
                            sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                            Select Case sts
                                Case BtNoErr
                                Case BtErrKeyNotFound
                
                                '   -------------------------------- エラーメッセージ作成
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    If Len(Trim(Tanaban)) < 8 Then
                                        
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")    '2017.09.22
                                    Else
                                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                    End If
                                    '有効桁数により棚番の編集を変える   '2017.09.23
                                    
                                    Sendbuf = Text_Create_Proc()
                                    ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                    Hin_Shogo_Proc = False
                                    Exit Function
                                Case Else
                                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                    Sendbuf = Text_Create_Proc()
                                    Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                    Exit Function
                            End Select
           
                        End If
                    Case LCD_Hinban         '品番
                        Hinban = ID_KANRI_TBL(ING_No).Recv_text(i)
                
                        '------------------ 品目マスタ読込み
                        sts = Item_Read_Proc(ID_KANRI_TBL(ING_No).JGYOBU, ID_KANRI_TBL(ING_No).NAIGAI, Hinban, RET_JGYOBU, RET_NAIGAI)
                        Select Case sts
                            Case BtNoErr
                                If Trim(Tanaban) = Loc_OK_Para Then
                                    '棚番OK時の棚番チェック
                                    Call UniCode_Conv(K0_TANA.SOKO_NO, StrConv(ITEMREC.ST_SOKO, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Retu, StrConv(ITEMREC.ST_RETU, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Ren, StrConv(ITEMREC.ST_REN, vbUnicode))
                                    Call UniCode_Conv(K0_TANA.Dan, StrConv(ITEMREC.ST_DAN, vbUnicode))
                                    sts = BTRV(BtOpGetEqual, TANA_POS, TANAREC, Len(TANAREC), K0_TANA, Len(K0_TANA), 0)
                                    Select Case sts
                                        Case BtNoErr
                                            Tanaban = StrConv(TANAREC.SOKO_NO, vbUnicode) & StrConv(TANAREC.Retu, vbUnicode) & StrConv(TANAREC.Ren, vbUnicode) & StrConv(TANAREC.Dan, vbUnicode)
                                        Case BtErrKeyNotFound
                                        '   -------------------------------- エラーメッセージ作成
                                          
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                                            If Len(Trim(Tanaban)) < 8 Then
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Tanaban, "棚番エラー", "", "")    '2017.09.22
                                            Else
                                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2), "棚番エラー", "", "")    '2017.09.22
                                            End If
                                            '有効桁数により棚番の編集を変える   '2017.09.23
                    
                                            Sendbuf = Text_Create_Proc()
                                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                            Hin_Shogo_Proc = False
                                            Exit Function
                                        Case Else
                                            Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                            Sendbuf = Text_Create_Proc()
                                            Call File_Error(sts, BtOpGetEqual, "棚マスタ", 0)
                                            Exit Function
                                    End Select
                                End If
                            Case BtErrKeyNotFound
                                '   -------------------------------- エラーメッセージ作成
                                Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Hinban, "品番エラー", "", "")  '2017.09.22
                    
                                Sendbuf = Text_Create_Proc()
                                ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                                Hin_Shogo_Proc = False
                                Exit Function
                            Case Else
                                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                                Sendbuf = Text_Create_Proc()
                                Call File_Error(sts, BtOpGetEqual, "品目マスタ", 0)
                                Exit Function
                        End Select
        
                End Select
            Next i
            '   -------------------------------- 在庫数集計
            If Zaiko_Syukei_Proc(SUMI_QTY, _
                                    MI_QTY, _
                                    RET_JGYOBU, _
                                    RET_NAIGAI, Hinban) Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            '   -------------------------------- 送信テキスト作成
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo2_REQ
            
            ID_KANRI_TBL(ING_No).Tanaban = Tanaban          '棚番をセーブ
            
            
            ID_KANRI_TBL(ING_No).S_JGYOBU = RET_JGYOBU      '資材対応の事業部2006.01.06
            ID_KANRI_TBL(ING_No).S_NAIGAI = RET_NAIGAI      '資材対応の国内外2006.01.06
            
            
            ID_KANRI_TBL(ING_No).Hinban = Hinban            '品番をセーブ
            ID_KANRI_TBL(ING_No).Send_SUMI_QTY = SUMI_QTY   '送信する商品化済み数量
            ID_KANRI_TBL(ING_No).Send_MI_QTY = MI_QTY       '送信する未商品数量
                                                        
            '数量付きの送信メッセージを作成する
            Send_Text.sts = Sts_OK                                  'ステータス　OK
            ID_KANRI_TBL(ING_No).Send_Text.sts = Sts_OK
    
            Send_Text.Display_Flg = Display_DEF                     '表示画面フラグ 通常入力画面
            ID_KANRI_TBL(ING_No).Send_Text.Display_Flg = Display_DEF
    
            Send_Text.End_Menu = Menu_Only                          '最終メニューフラグ
            ID_KANRI_TBL(ING_No).Send_Text.End_Menu = Menu_Only
    
            Send_Text.Menu_Suu = "05"                               'メニュー項目数（05固定）
            ID_KANRI_TBL(ING_No).Send_Text.Menu_Suu = "05"
    
            Send_Text.FileName = ""                                 '送信データファイル名
            ID_KANRI_TBL(ING_No).Send_Text.FileName = ""
    
            Send_Text.buzzer = Buzzer_DEF                           'ブザー音　標準
            ID_KANRI_TBL(ING_No).Send_Text.buzzer = Buzzer_DEF
                                                                        
            '-----------------------------------------------１行目
                                                            'BOX属性
            Send_Text.Box_Type(0).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Box_Type = TYPE_REF
                                                            '表示内容
            
            Call UniCode_Conv(Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).LCD, ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME)
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(0).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(0).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(0).Max_Size = "00"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).Max_Size = "00"
                                                                                
            Send_Text.Box_Type(0).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(0).MENU = ""
            '-----------------------------------------------２行目
                                                            'BOX属性
            Send_Text.Box_Type(1).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Box_Type = TYPE_REF
                                                            '表示内容
                                                            
            If Len(Trim(Tanaban)) < 8 Then
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, Tanaban)
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, Tanaban)
            Else
                Call UniCode_Conv(Send_Text.Box_Type(1).LCD, _
                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
    
                Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).LCD, _
                                Left(Tanaban, 2) & "-" & Mid(Tanaban, 3, 2) & "-" & Mid(Tanaban, 5, 2) & "-" & Right(Tanaban, 2))
            End If
            '有効桁数により棚番の編集を変える   '2017.09.23
                                                            
                                                            '数値初期表示
            Send_Text.Box_Type(1).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).INIT = ""
                                                            
                                                            '初期カーソル位置
            Send_Text.Box_Type(1).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(1).Max_Size = "08"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).Max_Size = "08"
                                                                                
            Send_Text.Box_Type(1).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(1).MENU = ""
            '-----------------------------------------------３行目
                                                            'BOX属性
            Send_Text.Box_Type(2).Box_Type = TYPE_REF
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Box_Type = TYPE_REF
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(2).LCD, Hinban)
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).LCD, Hinban)
                                                            '数値初期表示
            Send_Text.Box_Type(2).INIT = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).INIT = ""
                                                            '初期カーソル位置
            Send_Text.Box_Type(2).Start_Pos = ""
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Start_Pos = ""
                                                            '入力桁数
            Send_Text.Box_Type(2).Max_Size = "13"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).Max_Size = "13"
                                                                                
            Send_Text.Box_Type(2).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(2).MENU = ""
            '-----------------------------------------------４行目
                                                            'BOX属性
            Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).LCD, LCD_SUMI_Suryo & Space(M_Keta - (Len(LCD_SUMI_Suryo) * 2) - 5 + (5 - Len(Format(SUMI_QTY, "#0")))) & Format(SUMI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).INIT = Space(10 - Len(Format(SUMI_QTY, "#0"))) & Format(SUMI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(3).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(3).MENU = ""                     'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(3).MENU = ""
            '-----------------------------------------------５行目
                                                            'BOX属性
            Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Box_Type = TYPE_BCNUM
                                                            '表示内容
            Call UniCode_Conv(Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
            Call UniCode_Conv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).LCD, LCD_MI_Suryo & Space(M_Keta - (Len(LCD_MI_Suryo) * 2) - 5 + (5 - Len(Format(MI_QTY, "#0")))) & Format(MI_QTY, "#0"))
                                                            '数値初期表示
            Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).INIT = Space(10 - Len(Format(MI_QTY, "#0"))) & Format(MI_QTY, "#0")
                                                            '初期カーソル位置
            Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")      '数値は５桁固定
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Start_Pos = Format(M_Keta - 4, "00")
                                                            '入力桁数
            Send_Text.Box_Type(4).Max_Size = "05"
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).Max_Size = "05"
                                                                                
            Send_Text.Box_Type(4).MENU = ""                 'メニュ―番号
            ID_KANRI_TBL(ING_No).Send_Text.Box_Type(4).MENU = ""
        
        
            Sendbuf = Text_Create_Proc()
        
        
        Case Step_Sagyo2_RES        '２回目の受信（商品／未商品数量）
            For i = 0 To M_Gyo - 1
            
                
                
                Select Case Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size)))
            
            
                    Case LCD_Suryo          '数量（ここは無い）
                        If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Shogo_Proc = False
                            Exit Function
                        End If
                
                        QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
            
            
                    Case LCD_SUMI_Suryo, LCD_MI_Suryo    '数量（商品化済み数量／未商品数量）
                
                       If Not IsNumeric(Trim(ID_KANRI_TBL(ING_No).Recv_text(i))) Then
                            Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, Trim(ID_KANRI_TBL(ING_No).Recv_text(i)), "数量入力ミス", "", "")   '2017.09.22
                            Sendbuf = Text_Create_Proc()
                            ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                            Hin_Shogo_Proc = False
                            Exit Function
                        End If
                
                
                        If Trim(Left(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode), Len(StrConv(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).LCD, vbUnicode)) - CInt(ID_KANRI_TBL(ING_No).Send_Text.Box_Type(i).Max_Size))) = LCD_SUMI_Suryo Then
                            SUMI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                            
                        Else
                            MI_QTY = CLng(Trim(ID_KANRI_TBL(ING_No).Recv_text(i)))
                        
                        End If
        
                End Select
            Next i
            '----------------------------------- データ更新処理開始 -----------
                                                        'トランザクション開始
            sts = BTRV(BtOpBeginConcurrentTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpBeginConcurrentTransaction, "", 0)
                Exit Function
            End If
                                        '品目マスタ読込み
            Call UniCode_Conv(K0_ITEM.JGYOBU, ID_KANRI_TBL(ING_No).S_JGYOBU)
            Call UniCode_Conv(K0_ITEM.NAIGAI, ID_KANRI_TBL(ING_No).S_NAIGAI)
            Call UniCode_Conv(K0_ITEM.HIN_GAI, ID_KANRI_TBL(ING_No).Hinban)
            Do
                sts = BTRV(BtOpGetEqual + BtSNoWait, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                    '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "") '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Hin_Shogo_Proc = False
                        GoTo Abort_Tran
                    Case BtErrKeyNotFound
                    '   -------------------------------- エラーメッセージ作成
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "品番未登録", "", "") '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Hin_Shogo_Proc = False
                        GoTo Abort_Tran
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpGetEqual + BtSNoWait, "品目マスタ", 0)
                        Hin_Shogo_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
        
            Loop
                                        '最終照合日付
            Call UniCode_Conv(ITEMREC.LAST_CHK_DT, Format(Date, "yyyymmdd"))
                                        '最終照合在庫数
            Call UniCode_Conv(ITEMREC.LAST_CHK_QTY, Format(SUMI_QTY + MI_QTY, "00000000"))
                                        '品目マスタ書き込み
            Do
                sts = BTRV(BtOpUpdate, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
                Select Case sts
                    Case BtNoErr
                        Exit Do
                    Case BtErrFILE_INUSE, BtErrRECORD_INUSE
                        Call Err_Send_Proc(ID_KANRI_TBL(ING_No).YOIN_LONG_DNAME, ID_KANRI_TBL(ING_No).Hinban, "他で使用中", "", "")     '2017.09.22
                    
                        Sendbuf = Text_Create_Proc()
                        ID_KANRI_TBL(ING_No).Step = ID_KANRI_TBL(ING_No).Step - 1
                
                        Hin_Shogo_Proc = False
                        GoTo Abort_Tran
            
                    Case Else
                        Call Err_Send_Proc("システム異常発生", "", "", "", "")
                        Sendbuf = Text_Create_Proc()
                        Call File_Error(sts, BtOpUpdate, "品目マスタ", 0)
                        Hin_Shogo_Proc = SYS_ERR
                        GoTo Abort_Tran
                End Select
            Loop
        
            If (SUMI_QTY + MI_QTY) = (ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY) Then
                MEMO = B2_MEMO & StrConv(Format((SUMI_QTY + MI_QTY), "#0"), vbWide) & "[OK]"
            Else
                MEMO = B2_MEMO & StrConv(Format((ID_KANRI_TBL(ING_No).Send_SUMI_QTY + ID_KANRI_TBL(ING_No).Send_MI_QTY), "#0"), vbWide) & "[" & StrConv(Format(SUMI_QTY + MI_QTY, "#0"), vbWide) & "]"
            End If
            '2006.01.30
            If ID_KANRI_TBL(ING_No).SAGYO_LOG = "1" Then
                MENU_NO = ID_KANRI_TBL(ING_No).MENU_LV1
            Else
                MENU_NO = ""
            End If

            sts = IDOREKI_OUTPUT_PROC("", _
                                        "", _
                                        ID_KANRI_TBL(ING_No).S_JGYOBU, _
                                        ID_KANRI_TBL(ING_No).S_NAIGAI, _
                                        ID_KANRI_TBL(ING_No).Hinban, _
                                        "", _
                                        (ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE & ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE), _
                                        SUMI_QTY, _
                                        MI_QTY, _
                                        (Format(ID_KANRI_TBL(ING_No).ID, "000")), _
                                        ID_KANRI_TBL(ING_No).TANTO_CODE, _
                                        FILE_RETRY, _
                                        , _
                                        MEMO, , , , , MENU_NO)
'>>>>>>>>>> 2017.09.21
            
            
            Select Case sts
                Case False      '正常終了
                Case Else
                    Call Err_Send_Proc("システム異常発生", "", "", "", "")
                    Sendbuf = Text_Create_Proc()
                    Hin_Shogo_Proc = SYS_ERR
                    GoTo Abort_Tran
            End Select

                                        'トランザクション終了
            sts = BTRV(BtOpEndTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
            If sts <> BtNoErr Then
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpEndTransaction, "", 0)
                GoTo Abort_Tran
            End If
                                        '次の作業要求

            Call UniCode_Conv(K0_YOIN.CODE_TYPE, ID_KANRI_TBL(ING_No).Sagyo_Code.CODE_TYPE)
            Call UniCode_Conv(K0_YOIN.YOIN_CODE, ID_KANRI_TBL(ING_No).Sagyo_Code.YOIN_CODE)
            sts = BTRV(BtOpGetEqual, YOIN_POS, YOINREC, Len(YOINREC), K0_YOIN, Len(K0_YOIN), 0)
            Select Case sts
                Case BtNoErr
                '   -------------------------------- エラーメッセージ作成
                Case Else
                '重要な要因なので未登録はシステム停止とする
                Call Err_Send_Proc("システム異常発生", "", "", "", "")
                Sendbuf = Text_Create_Proc()
                Call File_Error(sts, BtOpGetEqual, "要因マスタ", 0)
                Exit Function
            End Select
            
            ID_KANRI_TBL(ING_No).Step = Step_Sagyo1_REQ
            If Sagyo_Send_Proc() Then
                Sendbuf = Text_Create_Proc()
                Exit Function
            End If
            
            Sendbuf = Text_Create_Proc()
    
    End Select

    Hin_Shogo_Proc = False
    
    Exit Function

Abort_Tran:
    
    sts = BTRV(BtOpAbortTransaction, ITEM_POS, ITEMREC, Len(ITEMREC), K0_ITEM, Len(K0_ITEM), 0)
    If sts <> BtNoErr Then
        Call Err_Send_Proc("システム異常発生", "", "", "", "")
        Sendbuf = Text_Create_Proc()
        Call File_Error(sts, BtOpAbortTransaction, "", 0)
    End If

End Function
